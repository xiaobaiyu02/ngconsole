{"version":3,"sources":["webpack:///webpack/bootstrap 73c0292a4c28d0d1ccce","webpack:///./js/vdi/config.js","webpack:///./js/vdi/os-types.json","webpack:///./js/vdi/user/controllers.js","webpack:///./js/vdi/desktop/controllers.js","webpack:///./js/vdi/system/controllers.js","webpack:///./resources/info.json","webpack:///./js/ng/ng.controllers.js","webpack:///./js/vdi/template/modify.page.js","webpack:///./js/ng/ng.directives.js","webpack:///./js/vdi/vdi.js","webpack:///./js/vdi/template/controllers.js","webpack:///./js/vdi/template/controller.teach.js","webpack:///./js/vdi/template/controller.person.js","webpack:///./js/vdi/template/controller.hardware.js"],"names":["window","$$$storage","getSessionStorage","key","sessionStorage","getItem","setSessionStorage","value","setItem","clearSessionStorage","clear","codeData","i18nData","imagesData","firstKey","ng","angular","module","supportedOems","getSupportedOEMs","currentOEM","host","location","hostname","hasBootstrap","domain","protocol","controllerDomain","interfaceDomain","vdiEnvironment","origin","main","constant","splitDomain","service","get","load","langCode","cb","loadOEMResources","factory","languages","Object","keys","map","currentLang","require","config","$httpProvider","interceptors","push","$q","$root","$$$MSG","test","url","withCredentials","reject","console","log","info","arguments","code","message","res","data","$broadcast","href","replace","ignoreAnyRequestError","$","bigBox","title","content","color","icon","timeout","bootstrap","oem","oemData","alert","lang","images","$body","document","body","theme","pathname","addClass","attr","fadeIn","$$$MAIN_MODULE","concat","error","when","getJSON","done","codeResponse","langResponse","imagesResponse","registerLazyService","fail","statusXhr","langXhr","status_ha","statusResponse","haResponse","JSON","parse","current_lang_type","isSplitBrain","result","is_split_brain","isInitPage","isPersonalLoginPage","isControlNode","is_control_node","isSplitBrainPage","start","roles","ip","initCurrentUser","length","navigator","language","split","toLowerCase","list","resources","ret","forEach","item","flagCode","name","translation","userId","ajax","method","stringify","user_id","dataType","oldInfo","user","navigators","$$$UserRoles","User","lastSessionPromise","lastRequestTime","role","getNavigator","filter","reduce","userNavigators","indexOf","role_copy","sublist","currentUser","hasCache","Date","now","refreshSession","logined","Boolean","currentUserRoles","r","trim","isOwner","currentNavigator","currentSession","isAllowFilter","session","$promise","then","$Domain","query","isArray","update","edit","params","move","query_tree","add","delete","$resource","create","listDomain","asycing","controller","$scope","UseradminList","$modal","UserRole","$$$I18N","rows","loading","owner","loginName","users","_ip","row","last_login","Number","currentPage","pagesize","$watch","newvalue","sortIP","order","sort","a","b","reverse","selected_rows","_selected","_ignore","nodelete_rows","instance_num","delete_rows","open","template","$modalInstance","join","nodeleteName","ok","ids","id","index","splice","close","size","UsercommonList","$http","$timeout","customModal","Depart","$location","_scope","WIDTH","setData","full_path_map","children","d","parent","setTreeData","DATA","full_path","i","treeOptFun","arg","flag","opts","treedata","newData","expandnodes","selected","showSelected","node","queryCommon","islastGroup","departId","user_loading","department","undefined","treedata_loading","queryDepart","err","$$search","depart","username","searchText","decodeURIComponent","addDepartment","templateUrl","min_namelength","max_namelength","deleteDpartment","modalOptions","delTips","delParm","openModal","nodelTips","$on","e","val","modifyInfo","obj","moveTo","draggable","isSelectable","selectedPerson","arr","encodeHTML","txt","con","createElement","firstChild","removeChild","appendChild","ownerDocument","createTextNode","parentNode","innerHTML","format","tmpl","Array","prototype","slice","call","match","param","finishUpload","response","suc","errorData","errorMsg","detail","Server","pagesizes","servers","Domain","$routeParams","domainId","hash","parseInt","oneKeySycing","_controllerScope","powers","user_num","checked","_slide","_arrow","selectAll","slide","fatheritem","subitem","belong","select","set","allchecked","_this","save","desc","toString","redactor","updated_time","access_key","master","currentItem","access_roles","copy","POWER","permission","reload","isUnchanged","equals","reset","admin","schoolroom","min_passwordLe","max_passwordLe","_ischeckAll","sex","schoolroom_loading","querywithSimple","schoolrooms","pools_","DISABLED","changeRole","checkAll","scope","checkOne","p","pools","real_name","password","passwordConfirm","email","contact","sch","pool","myrole","schoolroom_id","$$childTail","PERMISSION","logInfor","Role","role_desc","submiting","afterSubmiting","unshift","status","ous","auto","base_dn","len","select_row","fullname","removeSelected","_item","active","powerOn","powerOff","forcePowerOff","haConfig","shutdown","pause","resume","reboots","screenshot","rename","reboot","migrate","saveAsTemplate","moveHostList","list_passive_disk","list_detail","update_instance","check_can_migrate_host","share_servers","base_url","shutdowns","list_snapshot","take_snapshot","restore_snapshot","delete_snapshot","get_live_move_hosts","live_move","list_template","field","_list","person_desktop","vm","$interval","$filter","$$$os_types","Admin","TreeInstances","hasTerminalpermission","hasTerminalManagepermission","hasClassroompermission","linkTerminal","inCurrentUserPool","filterSearch","filterSearchPage","$event","_rows","task_state","other_status","k","getObjLength","refresh","_s","desk","user_group","allRows","updateData","os","os_type","detailData","getDetail","it","loading_detail","finally","expand","_expand","openAddDomainDialog","is_domain_user","ad_server_name","modal","resolve","personExitDomain","domain_set_person","instance_ids","has_domain","text","type","dept_name","domain_name","selectMode","formatData","iteration","childName","getAdminNum","count","desktop_num","adminData","admins","domains","commons","all","instance_id","forceShutdown","natureShutdown","is_soft","restart","hasPausedStatus","_hasPaused","is_running","some","is_run","delete_disk","has_data_disk","local_gb","force_delete_data","moveto","can_migrate_rows","virtual_type","can_migrate_host","moveto_loading","hosts","hosts_loading","migration","migrationTip","view","viewStorage","$route","teach_desktop","getList","_id","current","_numa","_numb","get_num","tar","substring","display_name","mode_name","sortDesktopName","bool","alter","vm_hostname","post","dismiss","addZero","str_begin","str_end","end_len","hostNameType","hostNamePre","hostNameBegin","datas","scene","SchoolRoom","selectLoading","classrooms","_loginPool","_loginClassroom","user_ids","ownedIds","cachedPoolId","sceneData","modes","created_at","getRealTimeRows","filterPages","filterPagesAndSeatches","getTotalCount","instances_count","getRunningCount","running_count","getShutdownCount","shutdown_count","getPausedCount","paused_count","getNostateCount","nostate_count","getErrorCount","error_count","getOtherCount","other_count","cacheValue","v","pid","isInClassrooms","room","sceneExitServerDialog","domain_set_scene","action","event","active_loadding","sortScene","scenes","has_running","has_active","has_run","restartScene","net","teach","hardwares","server","ResourcePool","PersonDesktop","regXP","reg","regWin","step1","$parent","classroom","resource","resource_update","get_teach_template","allImages","templateNum","image","loading_template","rbd_enabled","winTable","win_images","linTable","linux_images","otherTable","other_images","step2","loading_server","nets","ip_address","network_id","subnet_id","share_server","updateHardware","is_win7UP","is_winXP","is_win","usb_version","usb_redir","usb3_disabled","isWin","step3","desktopNum2","get_host","loading_host","is_all","desktopNum","query_gpu_agent","enable_gpu","has_gpu","hosts_list","disabled_tips","disabled_desc","query_agent","gpu_auto_assignment","h","host_storages","openMoreDialog","_hostids","storage_uuid","moreDialog","step4","selectAllHost","_hosts","num","selectOneHost","every","getDesktopNumber2","_lis","clearRDP","RDP","userNameType","userNamePre","userNameBegin","clearDomain","step","setTimeout","popover","trigger","sameSceneName","sceneName","is_dirty","bodyForm1","$valid","system_alloc_disk","data_alloc_disk","data_alloc_disk_2","hardwareList","memory_mb","hardware","bodyForm2","MORE","hostType","bodyForm3","bodyForm4","steps","scopes","regWin10","postData","image_id","resource_pool_uuid","uuid","firmware_type","instance_type","rollback","data_rollback","rollback_weekday","rollback_monthday","data_rollback_weekday","data_rollback_monthday","instance_max","servers_storage","image_storage_capacity","image_storage_performance","storage_capacity","storage_performance","hostname_type","hostname_prefix","hostname_beginwith","is_exam","username_type","username_prefix","username_beginwith","enable_share","share_server_ip","share_server_id","expand_enabled","submitting","personDesktop","need_ha","selectedServer","raw_need_ha","rollbackChange","min_instances","disk_type","usb3_editable","is_windows","_rollback","_data_rollback","server_ids","Scene","auto_scene","s","is_auto","cur","_actived","cur_idx","pre_idx","t","up","down","idx","order_data","networks","Person","checkIP","max_instance","host_loading","IPmodes1","IPmodes2","get_subnet","network","subnets","query_sub","subnetworks","n","_desc","start_ip","end_ip","subnetwork","clearBindIp","get_personal_template","templates","IPmodes","IPmode","netid","is_gpu","host_loadding","stepScope","$$nextSibling","toStrLong","ips","_prefix","check_net","netmask","enable_dhcp","_startIP","_endIP","_bindStartIP","sameDesktopName","desktopName","is_valid","select_users","resource_pool","ip_choose","instance_type_id","rule_id","rule","hardwrare","IPs","btndisks","get_net","_network","get_sub_net","_subnetwork","first","get_disks","loading_disk","_user","disks","newval","expandedNodes","user_name","_is_last","oldlen","removeNoChildrenDeparts","noUserFilter","walk","dept_id","_is_open","admin_users","common_users","domain_users","commonUser","dus","groups","g","apply","all_users","is_dhcp","volumes","_local_gb","is_data_disk","vcpu","attach_volumes","get_list","snapshots","snapshot_name","display_description","editable","create_at","getTime","hasSaveButton","hasSubmit","_submitting","addNew","manuals","created_by","snapshot_volumes","restore","ad_server_id","recreate_sid","is_sid","Storage","Host","host_ids","phostids","pstore","get_luns","storage_hosts","storages","sto","_total_size","storage_metadata","capabilities","total_capacity_gb","toFixed","_free_size","free_capacity_gb","_used_size","change_host","sys_luns","data_luns","filterStorage","loading_lun","filter_storage","storage_id","device_type","node_uuid","_changed","okAll","virtualHost","networkWithHost","types1","types2","types","bind_ip_type","owners","o","currentItemDetail","getVirtualHost","host_name","getNetwork","switchIps","subnet","band_ips","getSubnets","Network","isFirst","network_loading","net_loading","host_uuid","switchSubnet","saveTemplate","type_code","description","band_type","band_ip","bind_ip","userPassword","userPasswordConfirm","DeskPool","getIds","online_count","total_count","DeskPoolSecond","model_name","cid","carr","searchName","breadPoolName","person_pool_name","traverse","getUserGroup","pool_name","user_group_id","get_instances","add_instances","config_instances","config_template","get_devices","register","backup","get_config","alter_config","upload","upgrade","stop","getInternetSync","internetSync","querySyncServer","updateSyncServer","queryZone","updateZone","quickstart","query_data_network","scan_iso","import_iso","complete_import","import_progress","list_system_images","list_sub_networks","list_ports","register_template","create_scene","first_deploy","quick_deploy_page","cancel","SystemDesktop","FenTemplate","PuTemplate","updateInfor","sync_status","updateSize","editSysdesktop","ins","get_rows","running","shutoff","sync_mode","teachNames","sameName","newRows","addTemplate","iso","CreateDistribute","vcpus","ram","system_gb","multifyNetsTips","source_pool","devices","isos","addNet","minusNet","newWindow","on","giveTip","array","devices_selected","me","iso_path","iso_id","pci_devices_node","compute_node_id","pci_devices_address","address","start_on_host_boot","alertFlag","temp","registerTemplate","sys_isos","system_image","sys_iso","old_data_isos","data_image","getDataImgs","filterDataISO","data_iso","data_iso2","data_isos2","data_isos","data_isos1","systemImg","is_init","alertTip","system_image_file","data_image_file","controller_scope","getURL","$rootScope","loadIso","origin_os_type","old_type","old_os_type","type_editable","os_editable","upload_id","uploadModal","progressName","isUploading","progressPercent","loaded","total","abortUpload","xhr","uploadPool","abort","filter_iso","os_types","change","new_item","support_auto_install","hideButton","uploadStart","last","search","timeStamp","fn_get_logs","_start","displayLength","displayStart","datetime","totalCount","totalDisplayRecords","totalRecords","logPageSizeChange","Math","floor","logPageChange","deleteAll","_data","versions","new_data","_idx","packtype","viewDetail","witch","modal_data","backdrop","finish","MESS","systemusb","class_id","sortClass_id","device","desktops","allow","priority","rule_name","product_id","vendor_id","group_id","SystemUpgrade","changeStatus","instance","cpu_num","is_cancel","addr","is_auto_up","is_on","cpu","creat_item","TeachTemplate","infor","SystemBackup","initTime","backup_weekday","backup_time","Outside","AlarmPlicy","enable_loading","save_loading","ips_loading","enable","IP","proxy_ip","hasIP","computer_ips","get_hosts","is_selected","isSubmiting","selected_length","RecycleTech","RecyclePer","RecycleCtrl","submit","setTechDefault","tecSave","getTech","techLoading","tecOpen","tecDesk","broken_min","tecStatus","run","onlyEnable","techenabling","techEdit","techSave","setPerDefault","perSave","getPerson","personLoading","perOpen","perDesk","perStatus","perenabling","personEdit","personSave","SystemTime","formDate","SyncCtrl","setInternetSync","loading_internet","used","loading_updateServer","time_server","loadZone","startDateOptions","formatYear","startingDay","openStartDate","preventDefault","stopPropagation","startDateOpened","matchInput","timeID","updateTime","time","new_time","timeArray","loopTime","hours","minutes","seconds","clearTimeout","loading_zone","choose_time","date","timestamp","zones","timezones","zone","offset","updating_zone","modifyTime","directive","$tooltip","restrict","placement","animation","isOpen","pos","lastIndexOf","units","$compile","$controller","css","modalRootElement","element","appendTo","modalScope","$new","$element","localize","init","quickMaskModel","currentIndex","unknowStep","showMask","firstDeployTips","hideStep","ha_mode","storage_type","ha_triggered","knowStep","setStep","formScope","$$childHead","imgForm","selectedSysImage","filename","registerForm","$error","ctrl","$setViewValue","wizardScope","targetScope","showLoading","showTemplateBlock","createForm","getValues","countArr","imglist","autoSelect","listSystemImages","imgmap","img","extend","selectSysImage","importByServer","imgs","loadData","selectIsoName","selectIsoByName","lastType","bind_ip_loading","callback","hit","browserRefresh","registerFormLoading","loadingTeachTemplates","teachTemplates","testTempateCreateDone","xp","isXP","onCreateTemplateDone","$eval","loopTemplateStatus","catch","timer","root","Promise","dereg","ostype","kwargs","addbtndisk","minusbtndisk","values","classroomName","instance_type_name","hardwareName","disk","showAdvanceSceneOptionDialog","isxp","options","getMaxInstance","modalInstance","rootScope","defaults","USBRedictTips","localizeText","auto_mountPersonalTips","hasOwnProperty","importedImgs","self","remote_imgs","refreshImgs","path","importSelected","upload_type","src_file","loopImportProgress","is_importing","imported","isAjaxOn","showRemain","yes","remain","doneCallback","failCallback","startTime","hasFeature","label","loop","filemap","remainSize","speed","remainTime","hour","minute","second","timeEnd","menuWidth","updateTimer","oldContentStyles","oldArrowStyles","opened","cleanDOM","updatePosition","alignTarget","pmenu","parents","hasClass","click","targetOffset","totalWidth","width","totalHeight","height","$content","$arrow","contentStyles","outerWidth","outerHeight","equalsRoughly","btn","find","btnOffset","contentLeft","left","arrowTop","top","arrowRight","arrowWidth","arrowHeight","arrowStyles","remove","$destroy","removeClass","obj1","obj2","eq","v1","v2","abs","USBPassThrough","devices_info","manufacturer","_SCOPE","through","dialog","throughItem","editThrough","cancelThrough","identify","AutoSnapshot","TeachDesktop","scene_id","old_instance_id","selectedUsers","changeType","selected_desktop","getScenesDektop","getCommonDektop","getSystemDektop","getTeaches","teachLoading","teaches","loadDesktops","adminUsers","u","adminDesktops","desktop_id","sys_desktops","sys_desktop","desktopsTreeOptions","dirSelectable","injectClasses","period","week_date","month_date","snapshot","snapshotItem","queryTreeInstances","need_rollback_desktops","recursionNode","calculateSelectedLeafs","cName","leafs","showManageSelected","$parentNode","$index","$first","$middle","$last","$odd","$even","$path","nodeChildren","_selectedNum","_middSelectedNum","selectedUsersNums","instances","all_desktops","initPeriod","desktopTreeOptions","checkNodeSelected","isAllSelected","hasSelected","hasMiddle","subNode","Spice","spiceCtrl","getSpiceConnect","mode","spice_jpeg_compression","saveSpiceConnect","Share","clearCtrl","getClearTime","day","saveClearTime","$animate","settings","setLang","$hashstr","substr","$hash","$id","$is_windows","$instance_id","$name","$is_personalTemp","$is_systemTemp","$sameIp","$locationProvider","html5Mode","vnc","selectIsos","isos_package","loadISO","personTemplate","desktop","scen","rfb","duplicatedIp","passwordRequired","msg","$D","setAttribute","setPassword","sendPassword","sendCtrlAltDel","init_params","vnc_host","vnc_token","port","token","WebUtil","getQueryVar","createCookie","RFB","updateState","connect","state","oldstate","sb","cad","level","save_as_temp","load_iso","is_template","installed","is_personalTemp","is_systemTemp","instance_count","getStatus","making_installed","oldBigBox","checkLoad","passwd","image_name","_rfb_state","_loop","get_image_vnc_info","CAD","updateTemplate","is_sys","is_update","update_tpl_tip","resp","hasSchool","schools","disconnect","saveTem_loading","p_scope","lang_code","link","attrs","ribbon","currentBreadcrumb","updateBreadcrumb","crumbs","breadCrumb","smartActions","userLogout","$this","SmartMessageBox","buttons","ButtonPressed","root_","logout","resetWidgets","widresetMSG","localStorage","launchFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","minifyMenu","toggleClass","effect","toggleMenu","toggleShortcut","shortcut_dropdown","is","shortcut_buttons_hide","shortcut_buttons_show","mouseup","target","has","animate","actionEvents","documentElement","isDefined","actionEvent","append","smartbgimage","fadeOut","prop","bind","$html","bgurl","$logo","removeClassPrefix","prepend","breadcrumbs","setBreadcrumb","newVal","oldVal","updateDOM","empty","crumb","li","$window","$RESOURCE","tmplReg","interestAttrReg","ready","currentLocaleData","getLangUrl","sourceText","translate","transkey","onAttrChange","myhtml","myattr","html","$observe","isReady","transclude","timer_handle","topmenu","jarvismenu","accordion","menu_speed","closedSign","openedSign","number","fn","slimScroll","getElement","navs","isChild","isActive","viewLocation","hasIcon","hasIconCaption","iconCaption","getItemUrl","getItemTarget","$emit","parentCtrls","navCtrl","navgroupCtrl","setActive","openParents","each","el","items","loadItem","loadedItem","onLoad","src","addItem","currentTarget","button","onRefresh","activityCtrl","next","mytest","$badge","currentContent","loadContent","footer","newContent","oldContent","contentCtrl","setup_widget_desktop","jarvisWidgets","enableJarvisWidgets","grid","widgets","deleteSettingsKey","settingsKeyLabel","deletePositionKey","positionKeyLabel","sortable","buttonsHidden","toggleButton","toggleSpeed","onToggle","deleteButton","deleteClass","deleteSpeed","onDelete","editButton","editPlaceholder","editClass","editSpeed","onEdit","colorButton","fullscreenButton","fullscreenClass","fullscreenDiff","onFullscreen","customButton","customClass","customStart","customEnd","buttonOrder","opacity","dragHandle","placeholderClass","indicator","indicatorTime","timestampPlaceholder","timestampFormat","refreshButton","refreshButtonClass","labelError","labelUpdated","labelRefresh","labelDelete","afterLoad","rtl","onChange","onSave","ajaxnav","navAsAjax","setup_widget_mobile","enableMobileWidgets","setup_widgets_desktop","class","$$$IMAGES","iElm","iAttrs","modelCtrl","validate","vals","isvalide","parser","formatter","viewChangeListener","$setValidity","$modelValue","$isEmpty","$parsers","$formatters","$viewChangeListeners","ngModel","isValid","fmt","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","RegExp","$1","getFullYear","deleteName","selecteduser","selectUser","contents","put","lun","isUndefined","vendor","type2str","local","iscsi","netfs","fc","stauts2str","building","stauts","$sce","trustAsHtml","slash","nat","bridge","vlan","input","outPut","$filterProvider","pageSize","totalPage","ceil","min","max","disabled","dialogUrl","dialogSize","___dialog","getPosition","ele","st","scrollTop","sl","scrollLeft","cw","clientWidth","ch","clientHeight","sw","scrollWidth","sh","scrollHeight","ow","offsetWidth","oh","offsetHeight","x","pageX","y","pageY","getCurrentPage","getCurrentRows","getPageSize","context_wrapper","hide","getFilterRows","_all","checkedAll","selectAllChange","asc","pageSizeChange","pageChange","de","handler","$apply","menu","conroller","ctrls","getStart","getEnd","end","currentCount","getCurrentCount","fn_update_help_info","$$path","help_text","myTips","show","contextmenuDisabled","contextmenuEventName","lastText","btnUnable","currentStep","moveWth","prevBtnText","nextBtnText","doneBtnText","stepIndex","go","getCurrentIndex","prev","getMarginValue","stepEventName","showPrev","isLast","doneEventName","addStep","jumpStep","removeStep","insertStep","wizardWth","_wth","testValid","wizard","Highcharts","setOptions","global","useUTC","init_data","refresh_time","hc_options","chart","renderTo","yAxis","series","highcharts","Chart","drawPoint","hc_series","drawpoint","reset_highcharts","destroy","delegate","ip_pattern","elm","ngmodelctl","ngrequiredctl","viewValue","keyCode","numKey","ctrlKey","which","nextValue","isNaN","ngModelCtrl","required","ipRequired","CHECKTOOLS","parts","numre","valid","ipformatNum","pow","ip2long","checkRange","s_ip","e_ip","c","popEl","$input","after","$render","modelVal","modelValArr","$setPristine","nextEles","nextAll","focus","prevAll","selectionStart","selectionEnd","filtertext","lastFilter","lastFiltedResult","add_selected","getUsers","filterUser","nodes","add_select_rows","APIadmin","APIuser","APIdomain","_users","seRows","rmRows","get_admin","deferred","defer","promise","get_user","get_domain","typeName","userData","_name","getLastLevelNodes","obj_levels","arrays","levels","remove_selected","lastRow2","shiftKey","begin_idx","end_idx","lastRow","add_remove_rows","ltor","rtol","menuItems","allMenuItems","$templateCache","userNumber","addMax","addMin","is_dot","String","ctrKey","keydown","_code","_valsplit","round","setValidation","exp","org","XMLHttpRequest","org_open","allowUpload","FormData","finishHandel","percent","uploadISOSize","uiWebUpload","btnName","uiUploadBtnName","uiWebUploadTest","degfn","disableTest","filetype","form","checkConfig","file","uiUploadType","maxSize","uiUploadLimit","uiUploadUrl","Error","typematch","clearDOM","clone","progressSize","success","files","uiWebUploadParams","uiWebUploadName","transformRequest","q","w","addEventListener","position","totalSize","headers","btnClass","iconClass","warn","task","warnBox","toggleTaskList","taskTimer","schedule","clients","manage_networks","personpools","lists","results","tasks","notifies","waringtype","ID","notify_id","Auth","desktopHelpBox","dms","dmsURL","$$$version","version","changeSkin","loginUser","userInfo","alarm","AlarmHistory","alarms","setRead","invalidArr","_data_dev","_dev","add_sub","get_sub","alter_sub","delete_sub","ports","handout","check","url_arry","urls","contentWindow","listModes","applyTemplate","modify","spiceConnectInfo","virtualStatus","download","get_image_rdp_info","sync","bt_before_edit_template","bt_save_template","bt_prev_save_template","bt_sync_retry","bt_sync_repair","teachdesktop","manageTemplate","allrows","orders","sortTem","syncFaildLen","syncDownloading","syncFaild","syncing","rows_active","instance_status","syncTem","thistmpl","Retry","server_ip","server_id","Repair","noScense","is_copy","temCopy","temData","bindIP","undoSync","disabled_gpu","oldData","getIps","cur_imgInfor","curr_ip","old_data_alloc_disk","old_data_alloc_disk_2","templateInfor","submit_loading","template_name","resetTemp","imgManage","IMG","imgType","formLocalData","dataResource","arry","host_ip","hostArry","storage_name","storageArry","image_uuid","image_type","image_type_desc","has_image","has_instance","volume_type","volume_uuid","volume_status","formRemoteData","imgArry","getLocal","local_loading","locals","getRemote","remote_loading","remotes","new_pool","getlocalImages","updateVolume","volume","storage","remote","sendImg","deleteImg","formData","volumeId","inst_volumes","auto_isos","all_isos","hardware_templates","names","install","isOther","step_pane0","$invalid","system_versions","system_version1","_types","_obj","FLAG","gotoUrl","step_pane3","auto_install","testWin10","userName","updateTem","isSuccess","getRegisterTemplateForm","data_image_file_2","is_64","child","personalNames","personal","useNum","addharddisk","deleteharddisk","itemindex"],"mappings":"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","file":"templateModify.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/devbuild/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 163);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 73c0292a4c28d0d1ccce","/**\r\n * 这个文件会在每个独立页面用到，如：init, index, templateXXX\r\n */\r\n\r\n// TODO: 移动到基础代码\r\nwindow.$$$storage = {\r\n\tgetSessionStorage(key){\r\n\t\treturn sessionStorage.getItem('vdi_'+ key);\r\n\t},\r\n\tsetSessionStorage(key, value){\r\n\t\tsessionStorage.setItem('vdi_'+ key, value);\r\n\t},\r\n\tclearSessionStorage(){\r\n\t\tsessionStorage.clear()\r\n\t}\r\n}\r\n\r\n// 提供翻译的闭包变量\r\nlet codeData = {};\r\nlet i18nData = {};\r\nlet imagesData = {};\r\n\r\nlet firstKey; // 记录第一个支持的 OEM，没有其它选择的时候使用这个\r\nlet ng = angular.module(\"ng\");\r\nlet supportedOems = getSupportedOEMs();\r\nlet currentOEM = null;\r\n\r\nlet host = location.hostname;\r\nlet hasBootstrap = false;\r\n\r\n\r\n// 定义后端接口地址\r\nlet domain = location.protocol + \"//\" + host + \":8081\"; // 多数用这个\r\nlet controllerDomain = location.protocol + \"//\" + host + \":19891\"; // 很少用\r\nlet interfaceDomain = location.protocol + \"//\" + host + \":19893\"; // 很少用\r\nif(window.vdiEnvironment === \"development\") {\r\n\thost = $$$storage.getSessionStorage('dev_host');\r\n\t// use dev_host\r\n\tif(host) {\r\n\t\tdomain = \"http://\" + host + \":8081\";\r\n\t\tcontrollerDomain = \"http://\" + host + \":19891\";\r\n\t\tinterfaceDomain = \"http://\" + host + \":19893\";\r\n\t} else {\r\n\t\t// use mock server\r\n\t\tdomain = controllerDomain = interfaceDomain = location.origin;\r\n\t}\r\n}\r\n\r\nmain();\r\n\r\n/* 定义一些 angular 服务 */\r\nng.constant(\"$Domain\", domain);\r\nng.constant(\"$controllerDomain\", controllerDomain);\r\nng.constant(\"$interfaceDomain\", interfaceDomain);\r\nng.constant(\"$splitDomain\", location.protocol + \"//\" + ($$$storage.getSessionStorage('splitIP') || domain) + \":8081\");\r\nlet splitDomain = location.protocol + \"//\" + ($$$storage.getSessionStorage('splitIP') || domain) + \":8081\";\r\nng.service(\"$RESOURCE\", [function(){\r\n\tthis.get = function(key){\r\n\t\treturn supportedOems[key];\r\n\t};\r\n\tthis.load = function(langCode, cb){\r\n\t\tloadOEMResources(langCode, cb);\r\n\t};\r\n}]);\r\n\r\nng.factory(\"settings\", [function(){\r\n\treturn {\r\n\t\tlanguages: Object.keys(supportedOems).map(function(key){\r\n\t\t\treturn supportedOems[key];\r\n\t\t}),\r\n\t\tcurrentLang: supportedOems[currentOEM]\r\n\t};\r\n}]);\r\n\r\nng.service(\"$$$MSG\", [function(){\r\n\tthis.get = function(key){\r\n\t\treturn codeData[key] || \"\";\r\n\t};\r\n}]);\r\n\r\nng.service(\"$$$I18N\", [function(){\r\n\tthis.get = function(key){\r\n\t\treturn i18nData[key] || \"\";\r\n\t};\r\n}]);\r\nng.service(\"$$$IMAGES\", [function(){\r\n\tthis.get = function(key){\r\n\t\treturn imagesData[key] || \"\";\r\n\t};\r\n}]);\r\nng.constant(\"$$$os_types\", require(\"./os-types\"));\r\nng.config([\"$httpProvider\", function($httpProvider){\r\n\t$httpProvider.interceptors.push([\"$q\", \"$rootScope\", \"$$$MSG\", function($q, $root, $$$MSG){\r\n\t\treturn {\r\n\t\t\t\"request\": function(config){\r\n\t\t\t\tif(/^https?\\:\\/\\//.test(config.url)){\r\n\t\t\t\t\tconfig.withCredentials = true;\r\n\t\t\t\t\treturn config;\r\n\t\t\t\t}\r\n\t\t\t\tif(/\\.html$/i.test(config.url)) {\r\n\t\t\t\t\treturn config;\r\n\t\t\t\t}\r\n\t\t\t\tif(!/^https?:\\/\\//.test(config.url)) {\r\n\t\t\t\t\tconfig.withCredentials = true;\r\n\t\t\t\t\tconfig.url = domain + config.url;\r\n\t\t\t\t}\r\n\t\t\t\treturn config;\r\n\t\t\t},\r\n\t\t\t\"requestError\": function(reject){\r\n\t\t\t\tconsole.log(\"REQ_ERROR\");\r\n\t\t\t\treturn $q.reject({\r\n\t\t\t\t\tinfo: reject\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\"responseError\": function(reject){\r\n\t\t\t\tconsole.log(\"RES_ERROR\", arguments);\r\n\t\t\t\treturn $q.reject({\r\n\t\t\t\t\tcode: 100,\r\n\t\t\t\t\tmessage: $$$MSG.get(\"返回信息格式错误\"),\r\n\t\t\t\t\tinfo: reject\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\"response\": function(res){\r\n\t\t\t\tif(/^https?\\:\\/\\//.test(res.config.url)){\r\n\t\t\t\t\tif(/\\/thor\\/toolkit\\//.test(res.config.url) || /\\/v1\\/(?:node|network)\\//.test(res.config.url)){\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tswitch(res.data.code){\r\n\t\t\t\t\t\t\tcase 17001:\r\n\t\t\t\t\t\t\t\t$root.$broadcast(\"NOAUTH\");\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 11011:\r\n\t\t\t\t\t\t\t\t$$$storage.setSessionStorage('returnUrl', location.href)\r\n\t\t\t\t\t\t\t\tlocation.replace(\"init.html\");\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tif(/\\/thor\\/home\\/tasklog/.test(res.config.url)){\r\n\t\t\t\t\t\t\t\t\treturn $q.reject(res);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(window.ignoreAnyRequestError) { return res; }\r\n\t\t\t\t\t\t\t\t$.bigBox && $.bigBox({\r\n\t\t\t\t\t\t\t\t\ttitle : $$$MSG.get(\"PAI_CODE\") + res.data.code,\r\n\t\t\t\t\t\t\t\t\tcontent : $$$MSG.get(res.data.code)==''?res.data.message:$$$MSG.get(res.data.code),\r\n\t\t\t\t\t\t\t\t\tcolor : \"#C46A69\",\r\n\t\t\t\t\t\t\t\t\ticon : \"fa fa-warning shake animated\",\r\n\t\t\t\t\t\t\t\t\ttimeout : 6000\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn $q.reject(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t};\r\n\t}]);\r\n}]);\r\n\r\n/**\r\n * 启动 angular app\r\n * @param {String} oem oem 名字\r\n */\r\nfunction bootstrap(oem){\r\n\tvar oemData = supportedOems ? supportedOems[oem] : null;\r\n\tif(!oemData) {\r\n\t\tif(window.vdiEnvironment === \"development\") {\r\n\t\t\treturn alert(\"加载资源出错！\");\r\n\t\t}\r\n\t}\r\n\tif(oemData.code && oemData.lang && oemData.images){\r\n\t\tvar $body = $(document.body);\r\n\t\tvar theme = $$$storage.getSessionStorage('current_theme') || \"smart-style-0\";\r\n\t\tif(!/personal_login/.test(location.pathname)) {\r\n\t\t\t$body.addClass(theme);\r\n\t\t\t$(\"#vdi_skins_url\").attr(\"href\", `/resources/pkg/${oem}/skins.css`);\r\n\t\t\t$body.fadeIn(1000);\r\n\t\t}\r\n\t\t\r\n\t\t// 仅开发模式提示\r\n\t\tif(window.vdiEnvironment === \"development\" && !window.$$$MAIN_MODULE) {\r\n\t\t\treturn alert(\"main module is not defined!\");\r\n\t\t}\r\n\t\tangular.bootstrap(document, [].concat(window.$$$MAIN_MODULE));\r\n\t\thasBootstrap = true;\r\n\t}\r\n}\r\n\r\n/**\r\n * 加载指定的 OEM 资源\r\n * @param {String} oem 要加载的 OEM 资源\r\n * @param {Function} cb 加载成功后的回调\r\n */\r\nfunction loadOEMResources(oem, cb){\r\n\tif(!oem) {\r\n\t\tif(window.vdiEnvironment === \"development\") {\r\n\t\t\treturn alert(\"获取资源 key 失败！\");\r\n\t\t}\r\n\t}\r\n\tif(!(oem in supportedOems)) {\r\n\t\tconsole.error(\"unsupported resource key:\", oem);\r\n\t\toem = Object.keys(supportedOems)[0];\r\n\t}\r\n\tlet oemData = supportedOems[oem];\r\n\t// 先检查后加载\r\n\tif(oemData.code && oemData.lang && oemData.images){\r\n\t\tcodeData = oemData.code;\r\n\t\ti18nData = oemData.lang;\r\n\t\timagesData = oemData.images;\r\n\t\treturn cb(oemData);\r\n\t}\r\n\t$.when(\r\n\t\t$.getJSON(`/resources/pkg/${oem}/code.js`),\r\n\t\t$.getJSON(`/resources/pkg/${oem}/lang.js`),\r\n\t\t$.getJSON(`/resources/pkg/${oem}/images.js`)\r\n\t).done(function(codeResponse, langResponse, imagesResponse){\r\n\t\tcodeData = oemData.code = codeResponse[0];\r\n\t\ti18nData = oemData.lang = langResponse[0];\r\n\t\timagesData = oemData.images = imagesResponse[0];\r\n\t\tif(!hasBootstrap) {\r\n\t\t\tregisterLazyService();\r\n\t\t\tbootstrap(oem);\r\n\t\t} else {\r\n\t\t\tcb && cb(oemData);\r\n\t\t}\r\n\t}).fail(function(){\r\n\t\tconsole.log(`load ${oem} resource error:`, arguments[2]);\r\n\t});\r\n\tcurrentOEM = oem;\r\n}\r\nfunction main(){\r\n\tvar statusXhr = $.get(controllerDomain + \"/v1/node/status\");\r\n\tvar langXhr = $.get(domain + \"/thor/init/lang\");\r\n\tvar status_ha = $.get(domain + \"/thor/get_controller_ha_status\");\r\n\t$.when(statusXhr, langXhr, status_ha).done(function(statusResponse, langResponse, haResponse){\r\n\t\tif(typeof statusResponse[0] === \"string\") {\r\n\t\t\tstatusResponse[0] = JSON.parse(statusResponse[0])\r\n\t\t}\r\n\t\tvar oem = langResponse[0].current_lang_type;\r\n\t\tvar isSplitBrain = haResponse[0].result.is_split_brain;\r\n\t\tvar isInitPage = /init\\.html$/.test(location.pathname);\r\n\t\tvar isPersonalLoginPage = location.pathname==='/personal_login/';\r\n\t\tvar isControlNode = statusResponse[0].is_control_node;\r\n\t\tvar isSplitBrainPage = /split\\.html$/.test(location.pathname);\r\n\t\tif(isSplitBrainPage) {\r\n\t\t\tif(!isSplitBrain) {\r\n\t\t\t\tlocation.replace(\"/\");\r\n\t\t\t}else{\r\n\t\t\t\tstart();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(isSplitBrain){\r\n\t\t\t\t// $$$storage.clearSessionStorage();\r\n\t\t\t\t$$$storage.setSessionStorage('splitIP', haResponse[0].result.roles[0].ip);\r\n\t\t\t\tlocation.replace(\"split.html\");\r\n\t\t\t} else {\r\n\t\t\t\tif(isControlNode) {\r\n\t\t\t\t\tif(isInitPage || isPersonalLoginPage) {\r\n\t\t\t\t\t\tstart();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstart(oem);\r\n\t\t\t\t\t\tinitCurrentUser();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(isInitPage || isPersonalLoginPage){\r\n\t\t\t\t\t\tstart();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tlocation.replace(\"init.html\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction start(oem){\r\n\t// 初始化页面默认没有语言\r\n\tif(!oem) {\r\n\t\t// NOTE: 版本是和语言相关的\r\n\t\t// 如果支持多个版本，优先使用系统默认语言\r\n\t\tif(Object.keys(supportedOems).length > 1) {\r\n\t\t\t// 仅仅我们自己的版本支持多语言\r\n\t\t\t// 参考：https://developer.mozilla.org/en-US/docs/Web/API/NavigatorLanguage/language\r\n\t\t\t// 调试时，使用这段代码将浏览器设置为其它语言\r\n\t\t\t//   navigator.__defineGetter__(\"language\", function(){ return \"en-us\" })\r\n\t\t\tlet lang = navigator.language;\r\n\t\t\tif(lang) {\r\n\t\t\t\tlang = lang.split(\"-\")[0].toLowerCase();\r\n\t\t\t}\r\n\t\t\tif(lang === \"zh\") {\r\n\t\t\t\toem = \"e-vdi\";\r\n\t\t\t} else if(lang === \"en\") {\r\n\t\t\t\toem = \"classEn\";\r\n\t\t\t}\r\n\t\t\tif(!supportedOems[oem]) {\r\n\t\t\t\toem = firstKey;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\toem = firstKey; // 否则的话使用仅支持的版本\r\n\t\t}\r\n\t}\r\n\tloadOEMResources(oem, supportedOems);\r\n}\r\n\r\nfunction getSupportedOEMs(){\r\n\tvar list = require(\"../../resources/info\").resources;\r\n\tvar ret = {};\r\n\tlist.forEach(function(item){\r\n\t\tret[item.key] = item;\r\n\t\t// 不知道旧代码为什么要这么做\r\n\t\titem.langCode = item.key;\r\n\t\titem.flagCode = item.key;\r\n\t\titem.language = item.name;\r\n\t\titem.translation = item.title;\r\n\t});\r\n\tfirstKey = list[0].key;\r\n\treturn ret;\r\n}\r\n\r\nfunction initCurrentUser(){\r\n\tvar userId = $$$storage.getSessionStorage('userId');\r\n\tif(!userId) { return; }\r\n\t$.ajax({\r\n\t\tmethod: \"POST\",\r\n\t\turl: domain + \"/thor/user/session\",\r\n\t\tdata: JSON.stringify({\r\n\t\t\tuser_id: userId\r\n\t\t}),\r\n\t\tdataType: 'json'\r\n\t}).done(function(res){\r\n\t\tif(res.code === 0){\r\n\t\t\t// res.user.keys = \"Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About\";\r\n\t\t\tvar oldInfo = JSON.parse($$$storage.getSessionStorage(\"loginInfo\")) || {};\r\n\t\t\tObject.keys(res.user).forEach(function(key){\r\n\t\t\t\toldInfo[key] = res.user[key];\r\n\t\t\t});\r\n\t\t\t$$$storage.setSessionStorage('loginInfo', JSON.stringify(oldInfo));\r\n\t\t\t$$$storage.setSessionStorage('power', res.user.keys);\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction registerLazyService(){\r\n\tng.constant(\"$$$version\", i18nData[\"GOD_VERSION\"] || \"dev\");\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/config.js","module.exports = [{\"key\":\"other\",\"icon\":\"other.png\",\"value\":\"Other\"},{\"key\":\"ArchLinux\",\"icon\":\"linux.png\",\"value\":\"Arch Linux\"},{\"key\":\"ArchLinux_64\",\"icon\":\"linux.png\",\"value\":\"Arch Linux (64 bit)\"},{\"key\":\"Debian\",\"icon\":\"debian.png\",\"value\":\"Debian\"},{\"key\":\"Debian_64\",\"icon\":\"debian.png\",\"value\":\"Debian (64 bit)\"},{\"key\":\"Fedora\",\"icon\":\"fedora.png\",\"value\":\"Fedora\"},{\"key\":\"Fedora_64\",\"icon\":\"fedora.png\",\"value\":\"Fedora (64 bit)\"},{\"key\":\"FreeBSD\",\"icon\":\"linux.png\",\"value\":\"FreeBSD\"},{\"key\":\"FreeBSD_64\",\"icon\":\"linux.png\",\"value\":\"FreeBSD (64 bit)\"},{\"key\":\"Gentoo\",\"icon\":\"linux.png\",\"value\":\"Gentoo\"},{\"key\":\"Gentoo_64\",\"icon\":\"linux.png\",\"value\":\"Gentoo (64 bit)\"},{\"key\":\"Linux\",\"icon\":\"linux.png\",\"value\":\"Other Linux\"},{\"key\":\"MacOS\",\"icon\":\"linux.png\",\"value\":\"Mac OS X Server\"},{\"key\":\"MacOS_64\",\"icon\":\"linux.png\",\"value\":\"Mac OS X Server (64 bit)\"},{\"key\":\"OpenBSD\",\"icon\":\"linux.png\",\"value\":\"OpenBSD\"},{\"key\":\"OpenBSD_64\",\"icon\":\"linux.png\",\"value\":\"OpenBSD (64 bit)\"},{\"key\":\"OpenSUSE\",\"icon\":\"linux.png\",\"value\":\"openSUSE\"},{\"key\":\"OpenSUSE_64\",\"icon\":\"linux.png\",\"value\":\"openSUSE (64 bit)\"},{\"key\":\"OpenSolaris\",\"icon\":\"linux.png\",\"value\":\"Oracle Solaris 10 10/09 and later\"},{\"key\":\"OpenSolaris_64\",\"icon\":\"linux.png\",\"value\":\"Oracle Solaris 10 10/09 and later (64 bit)\"},{\"key\":\"Oracle\",\"icon\":\"linux.png\",\"value\":\"Oracle\"},{\"key\":\"Oracle_64\",\"icon\":\"linux.png\",\"value\":\"Oracle (64 bit)\"},{\"key\":\"Other\",\"icon\":\"unknown.png\",\"value\":\"Other/Unknown\"},{\"key\":\"RedHat\",\"icon\":\"redhat.png\",\"value\":\"Red Hat\"},{\"key\":\"RedHat_64\",\"icon\":\"redhat.png\",\"value\":\"Red Hat (64 bit)\"},{\"key\":\"Solaris\",\"icon\":\"linux.png\",\"value\":\"Oracle Solaris 10 5/09 and earlier\"},{\"key\":\"Solaris_64\",\"icon\":\"linux.png\",\"value\":\"Oracle Solaris 10 5/09 and earlier (64 bit)\"},{\"key\":\"Ubuntu\",\"icon\":\"ubuntu.png\",\"value\":\"Ubuntu\"},{\"key\":\"Ubuntu_64\",\"icon\":\"ubuntu.png\",\"value\":\"Ubuntu (64 bit)\"},{\"key\":\"Windows2000\",\"icon\":\"win7.png\",\"value\":\"Windows 2000\"},{\"key\":\"Windows2003\",\"icon\":\"win2003.png\",\"value\":\"Windows 2003\"},{\"key\":\"Windows2003_64\",\"icon\":\"win2003.png\",\"value\":\"Windows 2003 (64 bit)\"},{\"key\":\"Windows2008\",\"icon\":\"win2008.png\",\"value\":\"Windows 2008\"},{\"key\":\"Windows2008_64\",\"icon\":\"win2008.png\",\"value\":\"Windows 2008 (64 bit)\"},{\"key\":\"Windows7\",\"icon\":\"win7.png\",\"value\":\"Windows 7\"},{\"key\":\"Windows7_64\",\"icon\":\"win7.png\",\"value\":\"Windows 7 (64 bit)\"},{\"key\":\"Windows8\",\"icon\":\"win8.png\",\"value\":\"Windows 8\"},{\"key\":\"Windows8_64\",\"icon\":\"win8.png\",\"value\":\"Windows 8 (64 bit)\"},{\"key\":\"WindowsNT\",\"icon\":\"win7.png\",\"value\":\"Other Windows\"},{\"key\":\"WindowsNT4\",\"icon\":\"win7.png\",\"value\":\"Windows NT 4\"},{\"key\":\"WindowsVista\",\"icon\":\"win7.png\",\"value\":\"Windows Vista\"},{\"key\":\"WindowsVista_64\",\"icon\":\"win7.png\",\"value\":\"Windows Vista (64 bit)\"},{\"key\":\"Windowsxp\",\"icon\":\"winxp.png\",\"value\":\"Windows XP\"},{\"key\":\"Windowsxp_64\",\"icon\":\"winxp.png\",\"value\":\"Windows XP (64 bit)\"},{\"key\":\"WindowsXP\",\"icon\":\"winxp.png\",\"value\":\"Windows XP\"},{\"key\":\"WindowsXP_64\",\"icon\":\"winxp.png\",\"value\":\"Windows XP (64 bit)\"},{\"key\":\"Windows 7\",\"icon\":\"win7.png\",\"value\":\"Windows 7 series\"},{\"key\":\"Windows10\",\"icon\":\"win8.png\",\"value\":\"Windows 10\"},{\"key\":\"Windows10_64\",\"icon\":\"win8.png\",\"value\":\"Windows 10 (64 bit)\"}]\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./js/vdi/os-types.json\n// module id = 1\n// module chunks = 0 1 2 3 4 5 6 7 8 9 10 11","angular.module(\"vdi.user\", [])\r\n\r\n.constant('$$$UserRoles', \"Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About\")\r\n\r\n.factory(\"UserRole\", [\"$$$UserRoles\", \"NavigatorLink\", \"$rootScope\", \"$$$UserRoles\", \"User\", function(roles, navigators, $root, $$$UserRoles, User){\r\n\tlet lastSessionPromise;\r\n\tlet lastRequestTime = 0;\r\n\tlet role = {\r\n\t\tgetNavigator(roles){\r\n\t\t\tif($$$storage.getSessionStorage(\"lang_code\") == 'pc')\r\n\t\t\t\tnavigators = navigators.filter(function(item){ return item.key !== 'Timetable' });\r\n\t\t\treturn navigators.reduce((userNavigators, role) => {\r\n\t\t\t\tif(roles.indexOf(role.key) > -1){\r\n\t\t\t\t\tlet role_copy = JSON.parse(JSON.stringify(role));\r\n\t\t\t\t\tuserNavigators.push(role_copy);\r\n\t\t\t\t\tif(role.sublist && role.sublist.length){\r\n\r\n\t\t\t\t\t\trole_copy.sublist = role.sublist.filter(role => roles.indexOf(role.key) > -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn userNavigators;\r\n\t\t\t}, []);\r\n\t\t},\r\n\t\tget currentUser(){\r\n\t\t\tvar hasCache = !!$$$storage.getSessionStorage(\"loginInfo\");\r\n\t\t\tif(hasCache && Date.now() - lastRequestTime > 1000 * 60 * 5) {\r\n\t\t\t\tthis.refreshSession();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(hasCache){\r\n\t\t\t\treturn JSON.parse($$$storage.getSessionStorage(\"loginInfo\"));\r\n\t\t\t}\r\n\t\t\t$root.$broadcast(\"NOAUTH\");\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tget logined(){\r\n\t\t\treturn Boolean($$$storage.getSessionStorage(\"loginInfo\"));\r\n\t\t},\r\n\t\tget currentUserRoles(){\r\n\t\t\tlet user = role.currentUser;\r\n\t\t\treturn user && user.keys ? user.keys.split(\",\").map(r => r.trim()) : [];\r\n\t\t},\r\n\t\tget isOwner(){\r\n\t\t\tlet user = role.currentUser;\r\n\t\t\treturn user && user.keys && user.keys===$$$UserRoles ? true:false;\r\n\t\t},\r\n\t\tget currentNavigator(){\r\n\t\t\treturn role.getNavigator(role.currentUserRoles);\r\n\t\t},\r\n\t\tget currentSession(){\r\n\t\t\treturn lastSessionPromise;\r\n\t\t},\r\n\t\tisAllowFilter(role){\r\n\t\t\tif(role.sublist && role.sublist.length){\r\n\t\t\t\trole.sublist.filter(isAllowFilter, this);\r\n\t\t\t}\r\n\t\t\treturn this.indexOf(role.key) > -1;\r\n\t\t},\r\n\t\trefreshSession(){\r\n\t\t\tlastSessionPromise = User.session({user_id: $$$storage.getSessionStorage(\"userId\")}).$promise;\r\n\t\t\tlastSessionPromise.then(function(res){\r\n\t\t\t\tvar oldInfo = JSON.parse($$$storage.getSessionStorage(\"loginInfo\")) || {};\r\n\t\t\t\t// test--\r\n                // res.user.keys = \"Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About\";\r\n\t\t\t\tObject.keys(res.user).forEach(function(key){\r\n\t\t\t\t\toldInfo[key] = res.user[key];\r\n\t\t\t\t});\r\n\t\t\t\t$$$storage.setSessionStorage('loginInfo', JSON.stringify(oldInfo));\r\n\t\t\t\t$$$storage.setSessionStorage('power', res.user.keys);\r\n\t\t\t});\r\n\t\t\tlastRequestTime = Date.now();\r\n\t\t\treturn lastSessionPromise;\r\n\t\t}\r\n\t};\r\n\treturn role;\r\n}])\r\n\r\n\r\n/* 用户 */\r\n.factory(\"Roles\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/permissions\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/permissions\", isArray: false},\r\n\t\tupdate:\r\n\t\t\t{method: \"PUT\", url: $Domain + \"/thor/user/permissions\" }\r\n\t});\r\n}])\r\n.factory(\"Admin\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/manager\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/manager\", isArray: false},\r\n\t\tupdate: \r\n\t\t\t{method: \"PUT\", url: $Domain + \"/thor/user/manager\" }\r\n\t});\r\n}])\r\n// .factory(\"User\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n// \treturn res($Domain + \"/thor/user/common\", null, {\r\n// \t\tquery:\r\n// \t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/common\", isArray: false},\r\n// \t\tupdate: \r\n// \t\t\t{method: \"PUT\", url: $Domain + \"/thor/user/common\" },\r\n// \t\tsession: {method: \"POST\", url: $Domain + \"/thor/user/session\"}\r\n// \t});\r\n// }])\r\n.factory(\"User\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/common\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/common\", isArray: false},\r\n\t\tedit: \r\n\t\t\t{method: \"PATCH\", url: $Domain + \"/thor/user/common/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\tmove:\r\n\t\t\t{method: \"PATCH\", url: $Domain + \"/thor/user/common/move\"},\r\n\t\tquery_tree :\r\n\t\t\t{method: \"GET\", url: $Domain + \"/thor/user/common/tree\"},\r\n\t\tsession: {method: \"POST\", url: $Domain + \"/thor/user/session\"}\r\n\t});\r\n}])\r\n/**\r\n * [description 部门]\r\n */\r\n .factory(\"Depart\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/departments\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/departments\", isArray: false},\r\n\t\tadd: \r\n\t\t\t{method: \"POST\", url: $Domain + \"/thor/user/departments\" },\r\n\t\tupdate: \r\n\t\t\t{method: \"PATCH\", url: $Domain + \"/thor/user/departments/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/user/departments/:id\", params: { \"id\": \"@id\" }, isArray:false}\r\n\t});\r\n}])\r\n.factory(\"Server\", [\"$resource\", \"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/user/server\", null, {\r\n\t\t// 读取域列表\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/server\"},\r\n\t\tget: \r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/info/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\t// 修改域基本信息\r\n\t\tupdate: \r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/user/server\"},\r\n\t\t//新增域\r\n\t\tcreate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/user/server\"},\r\n\t\t\"delete\":\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/user/server/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\tlistDomain:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/server/:id\", params: { \"id\": \"@id\" }},\r\n\r\n\t\t// 指定教学桌面设置域\r\n\t\t\"domain_set_scene\":\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/pool/mode/:id/change_domain\" , params:{\"id\": \"@id\"}},\r\n\t\t//个人桌面设置域\r\n\t\t\"domain_set_person\":\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/instances/change_domain\"}\r\n\t});\r\n}])\r\n.factory(\"Domain\", [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/user/domain/:id\", { \"id\": \"@id\" }, {\r\n\t\t// 域用户列表\r\n\t\tlist:\r\n\t\t\t{method: \"GET\", url: $Domain + \"/thor/user/get_users\"},\r\n\t\t// 查看特定域的用户信息\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/domain/:id\",params:{\"id\":\"@id\"}},\r\n\t\tasycing:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/user/domain/:id\", params: { \"auto\": \"@auto\" }, isArray: false},\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/domain/:id/ous\",params:{\"id\":\"@id\"}},\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/user/common\",isArray: false}\r\n\t});\r\n}])\r\n\r\n\r\n.controller(\"vdiUserAdminManageController\", [\r\n\"$scope\", \"Admin\",\"$modal\", \"UserRole\", \"$$$I18N\",\r\nfunction($scope, UseradminList, $modal, UserRole, $$$I18N){\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\t$scope.rows = [];\r\n\t// $scope.allRows = [];\r\n\t$scope.loading = true;\r\n\t$scope.owner = UserRole.isOwner;\r\n\t$scope.loginName = user.name;\r\n\t\r\n\tUseradminList.query(function(res){\r\n\t\tif(!$scope.owner){\r\n\t\t\t$scope.rows = res.users.filter(function(item){ return item.name == $scope.loginName });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.rows = res.users;\r\n\t\t}\r\n\t\t$scope.loading = false;\r\n\t\tvar _ip;\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tif(row.last_login !== null){\r\n\t\t\t\t_ip = row.last_login.split(\".\");\r\n\t\t\t\trow._ip = (_ip[0] << 16) + (_ip[1] << 8) + Number(_ip[2]) + (_ip[3] / 1000);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t_ip = null;\r\n\t\t\t\trow._ip = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// angular.copy($scope.rows,$scope.allRows);\r\n\t});\r\n\r\n    $scope.currentPage = 1;\r\n \t$scope.pagesize = Number($$$storage.getSessionStorage('admin_pagesize')) || 30;\r\n\t$scope.$watch(\"pagesize\" , function(newvalue){\r\n\t\t$scope.pagesize = newvalue || 0;\r\n\t\t$$$storage.setSessionStorage('admin_pagesize', newvalue ? newvalue : 0)\r\n\t}); \r\n\r\n\t// $scope.updateData = function(text){\r\n\t// \t$scope.rows = $scope.allRows.filter(function(row){\r\n\t// \t\trow._selected = false;\r\n\t// \t\tif(text){\r\n\t// \t\t\treturn row.name.indexOf(text) !== -1;\r\n\t// \t\t}\r\n\t// \t\treturn true;\r\n\t// \t});\r\n\t// };\r\n\r\n    $scope.sortIP = function(order){\r\n    \t$scope.rows.sort(function(a, b){\r\n\t\t\treturn (a._ip > b._ip) ? 1 : -1;\r\n\t\t});\r\n\t\tif(order){\r\n\t\t\t$scope.rows.reverse();\r\n\t\t}\r\n    };\r\n\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && !row._ignore; });\r\n\t\tvar nodelete_rows = selected_rows.filter(function(row){ return row.instance_num != 0; });\r\n\t\tvar delete_rows = selected_rows.filter(function(row){ return row.instance_num == 0; });\r\n\t\tvar rows = $scope.rows;\r\n\t\tif(delete_rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent : $$$I18N.get(\"ADMIN_TIP\"),\r\n\t\t\t\t\ttimeout : 6000\r\n\t\t\t\t});\r\n\t\t}\r\n\t\telse \r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除用户'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='USER_TIPGROUP2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.nodelete_rows = nodelete_rows;\r\n\t\t\t\t\t\t$scope.name = delete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t\t$scope.nodeleteName = nodelete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\tUseradminList.delete({\r\n\t\t\t\t\t\t\t\tids: delete_rows.map(function(row){ return row.id; })\r\n\t\t\t\t\t\t\t}, function(res){\r\n\t\t\t\t\t\t\t\tdelete_rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\t\tvar index = rows.indexOf(item);\r\n\t\t\t\t\t\t\t\t\trows.splice(index, 1);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t\t});\r\n\t};\r\n\r\n}])\r\n.controller(\"vdiUserCommonManageController\", [\r\n\"$scope\",\"User\",\"$modal\", \"$http\", \"$$$MSG\", \"$$$I18N\", \"$Domain\",\"$timeout\",\"customModal\", \"Depart\",\"User\",\"UserRole\",\"$location\",\r\nfunction($scope, UsercommonList, $modal, $http, $$$MSG, $$$I18N, $Domain,$timeout,customModal,Depart,User,UserRole,$location){\r\n\tvar _scope = $scope;\r\n\t$scope.rows = [];\r\n\tvar WIDTH = $$$I18N.get(\"GOD_VERSION\") == \"cloudClassEn\" || $$$I18N.get(\"GOD_VERSION\") == \"korean\" ? 66:50;\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesize = Number($$$storage.getSessionStorage('common_pagesize')) || 30;\r\n\t$scope.$watch(\"pagesize\" , function(newvalue){\r\n\t\t$scope.pagesize = newvalue || 0;\r\n\t\t$$$storage.setSessionStorage('common_pagesize', newvalue ? newvalue : 0)\r\n\t}); \r\n\t$scope.domain = $Domain;\r\n\t/**\r\n\t * [sortIP IP排序]\r\n\t */\r\n\t$scope.sortIP = function(order){\r\n\t\t$scope.rows.sort(function(a, b){\r\n\t\t\treturn (a._ip > b._ip) ? 1 : -1;\r\n\t\t});\r\n\t\tif(order){\r\n\t\t\t$scope.rows.reverse();\r\n\t\t}\r\n\t};\r\n\r\n\t // 组合json数据\r\n\t function setData(data, index){\r\n\t \tdata.filter(function(item){ return item.full_path_map.length == index }).forEach(function(item){\r\n\t \t\tvar children = data.filter(function(d){ return d.parent == item.id });\r\n\t \t\titem.children = children;\r\n\t \t});\r\n\t }\r\n\tfunction setTreeData(DATA){\r\n\t\tDATA.forEach(function(item){\r\n\t\t\titem.full_path_map = item.full_path.split('/');\r\n\t\t});\r\n\t\tDATA.sort(function(a,b){ return a.full_path_map.length>b.full_path_map.length?-1:1 });\r\n\t\tfor(var i=1; i<DATA[0].full_path_map.length; i++){\r\n\t\t\tsetData(DATA, i);\r\n\t\t}\r\n\t\treturn [DATA[DATA.length-1]];\r\n\t};\r\n\t// 初始化树状图\r\n\tfunction treeOptFun(arg,flag){\r\n\t\targ.opts = {};\r\n\t\targ.treedata = newData;\r\n\t\targ.expandnodes = DATA;\r\n\t\targ.selected = arg.treedata[0]?arg.treedata[0]:null;\r\n\t\tif(arg.selected){\r\n\t\t\targ.selected._selected = true;\r\n\t\t}\r\n\t\targ.showSelected = function(node, selected){\r\n\t\t\tnode._selected = selected;\r\n\t\t\targ.selected = node;\r\n\t\t\tif(arg.selected._selected && flag){\r\n\t\t\t\t$scope.queryCommon(arg.selected.id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar DATA = [], newData = [];\r\n\ttreeOptFun($scope,true);\r\n\r\n\t$scope.islastGroup = function(){\r\n\t\treturn $scope.selected && !DATA.filter(function(item){\r\n\t\t\t\t\treturn item.id!==$scope.selected.id;\r\n\t\t\t\t}).filter(function(item){\r\n\t\t\t\t\treturn (item.full_path+'/').indexOf($scope.selected.full_path+'/')>-1;\r\n\t\t\t\t}).length\r\n\t}\r\n\t$scope.queryCommon = function(departId){\r\n\t\t$scope.user_loading = true;\r\n\t\t$scope.rows = [];\r\n\t\tUsercommonList.query({department: departId?departId:undefined}, function(users){\r\n\t\t\t$scope.user_loading = false;\r\n\t\t\t$scope.rows = users.result;\r\n\t\t\t// $scope.rows.forEach(function(item){ item.department_desc = $scope.selected.full_path });\r\n\t\t\tvar _ip;\r\n\t\t\t$scope.rows.forEach(function(row){\r\n\t\t\t\tif(row.last_login !== null){\r\n\t\t\t\t\t_ip = row.last_login.split(\".\");\r\n\t\t\t\t\trow._ip = (_ip[0] << 16) + (_ip[1] << 8) + Number(_ip[2]) + (_ip[3] / 1000);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\t_ip = null;\r\n\t\t\t\t\trow._ip = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconsole.log(777, $scope.rows)\r\n\t\t},function(){\r\n\t\t\t$scope.user_loading = false;\r\n\t\t})\r\n\t}\r\n\t$scope.treedata_loading = true;\r\n\t$scope.queryDepart = function(){\r\n\t\tDepart.query(function(res){\r\n\t\t\t$scope.treedata_loading = false;\r\n\t\t\tDATA = res.result;\r\n\t\t\t$scope.treedata = newData = DATA.length?setTreeData(DATA):[];\r\n\t\t\t$scope.treedata[0].children && $scope.treedata[0].children.sort(function(a,b){ return a.name>b.name?-1:1 });\r\n\t\t\t$scope.expandnodes = DATA;\r\n\t\t\tvar selected = {};\r\n\t\t\tif($scope.selected){\r\n\t\t\t\tvar _selected = DATA.filter(function(item){ return item.id==$scope.selected.id })[0];\r\n\t\t\t\tselected = _selected?_selected:newData[0];\r\n\t\t\t}else{\r\n\t\t\t\tselected = newData[0];\r\n\t\t\t}\r\n\t\t\t$scope.selected = selected;\r\n\t\t\tif($scope.selected){\r\n\t\t\t\t$scope.selected._selected = true;\r\n\t\t\t\t$scope.queryCommon($scope.selected.id);\r\n\t\t\t}\r\n\t\t},function(err){\r\n\t\t\t$scope.treedata_loading = false;\r\n\t\t});\r\n\t}\r\n\tif($location.$$search.depart)\r\n\t\t$scope.selected = {id: Number($location.$$search.depart)};\r\n\tif($location.$$search.username)\r\n\t\t$scope.searchText = decodeURIComponent($location.$$search.username);\r\n\r\n\t$scope.queryDepart();\r\n\t\r\n\t\r\n\t/**\r\n\t * [addDepartment 添加部门]\r\n\t */\r\n\t$scope.addDepartment=function(){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/user/user_common_department_add.html\",\r\n\t\t\tsize: DATA.length ? \"md\":'sm',\r\n\t\t\tcontroller:function($scope,$modalInstance){\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\ttreeOptFun($scope);\r\n\t\t\t\t$scope.selected = null;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tDepart.add({\r\n\t\t\t\t\t\tname: this.name,\r\n\t\t\t\t\t\tparent: this.selected?this.selected.id:1\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t_scope.queryDepart();\r\n\t\t\t\t\t},function(){});\t\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * [deleteDpartment 删除部门]\r\n\t */\r\n\t$scope.deleteDpartment=function(){\r\n\t\tvar modalOptions = {\r\n\t\t\tkey: \"CommonDepartDel\",\r\n\t\t\ttitle: \"删除用户组\",\r\n\t\t\tdelTips: \"USER_TIPGROUP3\",\r\n\t\t\tdelete_rows: [$scope.selected],\r\n\t\t\tdelParm: 'name'\r\n\t\t}\r\n\t\tcustomModal.openModal(modalOptions);\r\n\t}\r\n\t/**\r\n\t * [delete 列表删除用户]\r\n\t */\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar nodelete_rows = selected_rows.filter(function(row){ return row.instance_num != 0; });\r\n\t\tvar delete_rows = selected_rows.filter(function(row){ return row.instance_num == 0; });\r\n\r\n\t\tif(delete_rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent : $$$I18N.get(\"ADMIN_TIP\"),\r\n\t\t\t\t\ttimeout: 6000\r\n\t\t\t\t});\r\n\t\t}else{\r\n\t\t\tvar modalOptions = {\r\n\t\t\t\tkey: \"CommonUserDel\",\r\n\t\t\t\ttitle: \"删除用户\",\r\n\t\t\t\tdelTips: \"USER_TIPGROUP1\",\r\n\t\t\t\tdelete_rows: delete_rows,\r\n\t\t\t\tdelParm: 'name',\r\n\t\t\t\tnodelete_rows: nodelete_rows,\r\n\t\t\t\tnodelTips: \"USER_TIPGROUP4\"\r\n\t\t\t}\r\n\t\t\tcustomModal.openModal(modalOptions);\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.$on('DELETE',function(e, val){\r\n\t\tif(val){\r\n\t\t\t// 删除部门\r\n\t\t\tif(val.key=='CommonDepartDel'){\r\n\t\t\t\tDepart.delete({\r\n\t\t\t\t\tid: val.data[0].id,\r\n\t\t\t\t},function(res){\r\n\t\t\t\t\t$scope.queryDepart();\r\n\t\t\t\t},function(){});\r\n\t\t\t}\r\n\t\t\t//删除部门用户\r\n\t\t\tif(val.key=='CommonUserDel'){\r\n\t\t\t\tUsercommonList.delete({\r\n\t\t\t\t\tid: val.data.map(function(row){ return row.id; })\r\n\t\t\t\t},\r\n\t\t\t\tfunction(res){\r\n\t\t\t\t\t$scope.queryDepart();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\t/**\r\n\t * [modifyInfo 修改部门名称]\r\n\t */\r\n\t$scope.modifyInfo=function(node){\r\n\t\tvar obj = node?node:$scope.selected;\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/user/user_common_department_modify.html\",\r\n\t\t\tsize:\"sm\",\r\n\t\t\tcontroller:function($scope,$modalInstance){\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\t$scope.name = obj.name;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tDepart.update({\r\n\t\t\t\t\t\tid: obj.id,\r\n\t\t\t\t\t\tname: this.name\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t_scope.queryDepart();\r\n\t\t\t\t\t},function(){});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$scope.close=function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * [moveTo 用户移动至部门]\r\n\t */\r\n\t$scope.moveTo=function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/user/user_common_moveTo.html\",\r\n\t\t\tsize:\"md\",\r\n\t\t\tdraggable:true,\r\n\t\t\tcontroller:function($scope,$modalInstance){\r\n\t\t\t\ttreeOptFun($scope);\r\n\t\t\t\t$scope.opts.isSelectable = function(node){\r\n\t\t\t\t\treturn\t!DATA.filter(function(item){\r\n\t\t\t\t\t\t\t\treturn item.id!==node.id;\r\n\t\t\t\t\t\t\t}).filter(function(item){\r\n\t\t\t\t\t\t\t\treturn (item.full_path+'/').indexOf(node.full_path+'/')>-1;\r\n\t\t\t\t\t\t\t}).length\r\n\t\t\t\t};\r\n\t\t\t\t$scope.selected = null;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tUser.move({\r\n\t\t\t\t\t\tid: selected_rows.map(function(item){ return item.id }),\r\n\t\t\t\t\t\tdepartment: this.selected.id\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t_scope.queryDepart();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t\t//勾选的人员姓名\r\n\t\t\t\t$scope.selectedPerson = selected_rows.map(function(item,index,arr){ return item.name }).join('，');\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * [description uploadify上传文件]\r\n\t */\r\n\tvar encodeHTML = function(txt, con){\r\n\t\tcon = con || document.createElement(\"div\");\r\n\t\twhile(con.firstChild){\r\n\t\t\tcon.removeChild(con.firstChild);\r\n\t\t}\r\n\t\treturn con.appendChild(con.ownerDocument.createTextNode(txt)).parentNode.innerHTML;\r\n\t};\r\n\tvar format = function(tmpl){\r\n\t\tvar data = Array.prototype.slice.call(arguments, 0);\r\n\t\treturn typeof tmpl === \"string\" ? tmpl.replace(/\\{\\{([^\\}]+)?\\}\\}/g, function(match, param){\r\n\t\t\tif(data[param]){\r\n\t\t\t\treturn encodeHTML(data[param]);\r\n\t\t\t}\r\n\t\t\treturn match;\r\n\t\t}) : \"\";\r\n\t};\r\n\t\r\n\t$scope.finishUpload = function(response){\r\n\t\t$scope.queryDepart();\r\n\t}\r\n\r\n\t$scope.$on(\"UploadError\", function (e, suc, errorData) {\r\n\t\tvar errorMsg = errorData.code==17041? $$$MSG.get(errorData.code)+errorData.detail : $$$MSG.get(errorData.code);\r\n\t\t$.bigBox({\r\n\t\t\ttitle : $$$MSG.get(\"PAI_CODE\") + errorData.code,\r\n\t\t\tcontent : errorMsg,\r\n\t\t\tcolor : \"#C46A69\",\r\n\t\t\ticon : \"fa fa-warning shake animated\",\r\n\t\t\ttimeout : 6000\r\n\t\t});\r\n\t});\r\n}])\r\n.controller(\"vdiUserDomainController\", [\"$scope\", \"$modal\", \"Server\", function($scope,$modal,Server){\r\n\t$scope.loading = true;\r\n\t$scope.rows = [];\r\n\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\t$scope.loading=false;\r\n\r\n\tServer.query(function(response){\r\n\t\t$scope.rows=response.servers;\r\n\t},function(){\r\n\t\t//console.log(arguments);\r\n\t});\r\n\r\n\tvar _scope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar rows = $scope.rows;\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除域控制器'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.name = selected_rows.map(function(row){ return row.host }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tServer.delete({\r\n\t\t\t\t\t\tids: selected_rows.map(function(row){ return row.id; })\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t\tServer.query(function(response){\r\n\t\t\t\t\t\t\t_scope.rows=response.servers;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\t\r\n}])\r\n.controller(\"vdiUserDomainListController\",[\"$scope\", \"$modal\",\"Domain\", \"User\",\"$routeParams\", \"$$$I18N\", function($scope, $modal,Domain,User,$routeParams,$$$I18N){\r\n\t$scope.loading = true;\r\n\t$scope.$root && $scope.$root.$broadcast(\"navItemSelected\", [\"用户\", \"域用户\",\"域用户列表\"]);\r\n\r\n\t// location.replace(\"#/user/domain/\");\r\n\t$scope.domainId = location.hash.match(/\\d+$/)? parseInt(location.hash.match(/\\d+$/)[0]):$routeParams.id;\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\t$scope.loading=false;\r\n\t$scope.rows=[];\r\n\t$scope.oneKeySycing=function(){\r\n\t\tDomain.asycing({\"auto\":1,\"id\":$scope.domainId},function(response){\r\n\t\t\tangular.forEach(response.result,function(item,index){\r\n\t\t\t\tvar i;\r\n\t\t\t\tfor(i=0;i<$scope.rows.length;i++){\r\n\t\t\t\t\tif(item.id==$scope.rows[i]){\r\n\t\t\t\t\t\t$scope.rows[i]=item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(i>=$scope.rows.length){\r\n\t\t\t\t\t$scope.rows.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t//$scope.rows.push(item);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    var _scope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar nodelete_rows = selected_rows.filter(function(row){ return row.instance_num != 0; });\r\n\t\tvar delete_rows = selected_rows.filter(function(row){ return row.instance_num == 0; });\r\n\t\tvar rows = $scope.rows;\r\n\t\t\r\n\t\tif(delete_rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent : $$$I18N.get(\"ADMIN_TIP\"),\r\n\t\t\t\t\ttimeout : 6000\r\n\t\t\t\t});\r\n\t\t}\r\n\t\telse \r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除用户'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;word-break: break-all;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='USER_TIPGROUP2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.nodelete_rows = nodelete_rows;\r\n\t\t\t\t\t\t$scope.name = delete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t\t$scope.nodeleteName = nodelete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tUser.delete({\r\n\t\t\t\t\t\t\tids: delete_rows.map(function(row){ return row.id; })\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t\t\tdelete_rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\tvar index = rows.indexOf(item);\r\n\t\t\t\t\t\t\t\trows.splice(index, 1);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\r\n\tDomain.query({\"id\":$scope.domainId},function(response){\r\n\t\t$scope.rows=response.users;\r\n\t},function(){\r\n\t});\r\n}])\r\n.controller(\"vdiUserRoleManageController\", [\"$scope\", \"$modal\", \"Roles\", \"$$$UserRoles\", \"$$$I18N\",function($scope, $modal, roles, $$$UserRoles, $$$I18N){\r\n\t$scope.rows = [];var _controllerScope = $scope;$scope.loading = true;\r\n\t// $scope.allRows = [];\r\n\t$scope.powers = $$$UserRoles;\r\n\troles.query(function(res){\r\n\t\t$scope.rows = res.result.sort(function(a,b){\r\n\t\t\tif(a.name === 'Administrator'){\r\n\t\t\t\treturn -1\r\n\t\t\t}else if(b.name === 'Administrator'){\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t});\r\n\t\t$scope.loading = false;\r\n\t\t// angular.copy($scope.rows,$scope.allRows);\r\n\t});\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesize = Number($$$storage.getSessionStorage('role_pagesize')) || 30;\r\n\t$scope.$watch(\"pagesize\" , function(newvalue){\r\n\t\t$scope.pagesize = newvalue || 0;\r\n\t\t$$$storage.setSessionStorage('role_pagesize', newvalue ? newvalue : 0)\r\n\t}); \r\n\r\n\t// $scope.updateData = function(text){\r\n\t// \t$scope.rows = $scope.allRows.filter(function(row){\r\n\t// \t\trow._selected = false;\r\n\t// \t\tif(text){\r\n\t// \t\t\treturn row.name.indexOf(text) !== -1;\r\n\t// \t\t}\r\n\t// \t\treturn true;\r\n\t// \t});\r\n\t// };\r\n\r\n    $scope.delete = function(item){\r\n    \tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && !row._ignore });\r\n    \tvar nodelete_rows = selected_rows.filter(function(row){ return row.user_num != 0; });\r\n    \tvar delete_rows = selected_rows.filter(function(row){ return row.user_num == 0; });\r\n    \tvar rows = $scope.rows;\r\n\r\n    \tif(delete_rows.length==0){\r\n    \t\t$.bigBox({\r\n    \t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n    \t\t\t\tcontent : $$$I18N.get(\"ROEL_TIP\"),\r\n    \t\t\t\ttimeout : 6000\r\n    \t\t\t});\r\n    \t}\r\n    \telse \r\n    \t\t$modal.open({\r\n    \t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除角色'>\"+\r\n    \t\t\t\t\t\"删除角色</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_ROLES1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='DELETE_ROLES2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n    \t\t\t\tcontroller : function($scope, $modalInstance){\r\n    \t\t\t\t\t$scope.nodelete_rows = nodelete_rows;\r\n    \t\t\t\t\t$scope.name = delete_rows.map(function(row){ return row.name }).join(', ');\r\n    \t\t\t\t\t$scope.nodeleteName = nodelete_rows.map(function(row){ return row.name }).join(', ');\r\n\r\n    \t\t\t\t\t$scope.ok = function(){\r\n    \t\t\t\t\t\troles.delete({\r\n    \t\t\t\t\t\t\tids: delete_rows.map(function(row){ return row.id; })\r\n    \t\t\t\t\t\t}, function(res){\r\n    \t\t\t\t\t\t\tdelete_rows.forEach(function(item){\r\n    \t\t\t\t\t\t\t\tvar index = rows.indexOf(item);\r\n    \t\t\t\t\t\t\t\trows.splice(index, 1);\r\n    \t\t\t\t\t\t\t});\r\n    \t\t\t\t\t\t\t$modalInstance.close();\r\n    \t\t\t\t\t\t});\r\n    \t\t\t\t\t}\r\n    \t\t\t\t\t$scope.close = function(){\r\n    \t\t\t\t\t\t$modalInstance.close();\r\n    \t\t\t\t\t}\r\n    \t\t\t\t},\r\n    \t\t\t\tsize : \"sm\"\r\n    \t\t\t});\r\n    \t};\r\n\r\n}])\r\n\r\n\r\n\r\n.controller(\"addUserRoleDialog\", [\"$scope\", \"$modalInstance\", \"Roles\", \"$$$I18N\", \"NavigatorLink\", function($scope, $modalInstance, role,$$$I18N, navigators){\r\n\t$scope.checked = true;$scope.roles = [];\r\n\tnavigators.forEach( item => {\r\n\t\tif(item.sublist){\r\n\t\t\t$scope.roles.push(item);\r\n\t\t\titem.sublist.forEach( data => { if(data.key!==\"Role_Manage\") $scope.roles.push(data);} )\r\n\t\t}\r\n\t\telse\r\n\t\t\t$scope.roles.push(item);\r\n\t});\r\n\t$scope.roles.forEach(function(item){\r\n\t\titem._selected = $scope.checked;\r\n\t\titem._slide = false;\r\n\t\titem._arrow = \"up\";\r\n\t})\r\n\t$scope.selectAll = function(){\r\n\t \t$scope.checked = !$scope.checked;\r\n\t \tif($scope.checked){\r\n\t \t\t$scope.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = true;\r\n\t \t\t})\r\n\t \t}\r\n\t \telse{\r\n\t \t\t$scope.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = false;\r\n\t \t\t})\r\n\t \t}\r\n\t }\r\n\t$scope.slide = function(name,checked){\r\n\t\tvar fatheritem = $scope.roles.filter(function(item){ return item.key === name })[0];\r\n\t\tvar subitem = $scope.roles.filter(function(item){ return item.belong === name })\r\n\t\tif(checked){\r\n\t\t\tfatheritem._arrow = \"down\";\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._slide = true;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tfatheritem._arrow = \"up\";\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._slide = false;\r\n\t\t\t})\r\n\t\t}\r\n\t };\r\n\t$scope.select = function(name){\r\n\t\t\tvar checked = $scope.roles.filter(function(item){ return item.key === name })[0]._selected;\r\n\t\t\tvar subitem = $scope.roles.filter(function(item){ return item.belong === name })\r\n\t\t\tif(!checked){\r\n\t\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\t\titem._selected = true;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\t\titem._selected = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tvar length = $scope.roles.filter(function(item){ return item._selected; }).length;\r\n\t\t\tif(length+1 == $scope.roles.length){\r\n\t\t\t\t$scope.checked = true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\t$scope.checked = false;\r\n\t\t };\r\n\t\t$scope.set = function(name){\r\n\t\t\tvar allchecked = false;\r\n\t\t\t$scope.roles.filter(function(item){ return item.belong === name }).forEach(function(item){ \r\n\t\t\t\tif(item._selected == true){\r\n\t\t\t\t\tallchecked = true;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tvar fatheritem = $scope.roles.filter(function(item){ return item.key === name })[0];\r\n\t\t\tif(fatheritem){\r\n\t\t\t\tif(!allchecked)\r\n\t\t\t\t\tfatheritem._selected = false;\r\n\t\t\t\telse{\r\n\t\t\t\t\tfatheritem._selected = true;\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\t\t\tvar length = $scope.roles.filter(function(item){ return item._selected; }).length;\r\n\t\t\tif(length == $scope.roles.length){\r\n\t\t\t\t$scope.checked = true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\t$scope.checked = false;\r\n\t\t\t\r\n\t\t}\r\n\r\n\r\n\r\n\t $scope.min_namelength=2;$scope.max_namelength=20;\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar _this = this;\r\n\t\tvar roles = this.roles.filter(function(item){ return item._selected == true }).map(function(item){ return item.key });\r\n\t\tif(roles.length){\r\n\t\t\trole.save({\r\n\t\t\t\t\t\"name\": this.data.name,\r\n\t\t\t\t\t\"desc\": this.data.desc,\r\n\t\t\t\t\t\"keys\": roles.toString()\r\n\t\t\t\t},\r\n\t\t\t\tfunction(data){\r\n\t\t\t\t\t$scope.rows.push({\r\n\t\t\t\t\t\tid: data.id,\r\n\t\t\t\t\t\tname: data.name,\r\n\t\t\t\t\t\tdesc: data.desc,\r\n\t\t\t\t\t\tuser_num: data.user_num,\r\n\t\t\t\t\t\tredactor: data.redactor,\r\n\t\t\t\t\t\tupdated_time: data.updated_time,\r\n\t\t\t\t\t\taccess_key: data.access_key\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t);\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"PERMISSION_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"editUserRoleDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Roles\", \"$$$I18N\", \"UserRole\",\"NavigatorLink\",\r\nfunction($scope, $modalInstance, role, $$$I18N, UserRole, navigators){\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.data = {};\r\n\t$scope.master = {};\r\n\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\tvar roles = [];\r\n\tnavigators.forEach( item => {\r\n\t\tif(item.sublist){\r\n\t\t\troles.push(item);\r\n\t\t\titem.sublist.forEach( data => { if(data.key!==\"Role_Manage\") roles.push(data);} )\r\n\t\t}\r\n\t\telse\r\n\t\t\troles.push(item);\r\n\t});\r\n\titem.roles = roles;\r\n\tvar access_roles = item.access_key.split(\",\");\r\n\titem.roles.forEach(function(item){\r\n\t\titem._selected = false;\r\n\t\titem._slide = false;\r\n\t\titem._arrow = \"up\";\r\n\t})\r\n\taccess_roles.forEach(function(role){\r\n\t\titem.roles.forEach(function(item){\r\n\t\t\tif(item.key === role) item._selected = true;\r\n\t\t})\r\n\t})\r\n\t$scope.data = angular.copy(item);\r\n\r\n\tif($scope.data.roles.filter(function(item){ return item._selected === true }).length === $scope.data.roles.length){\r\n\t\t$scope.checked = true;\r\n\t}\r\n\telse $scope.checked = false;\r\n\r\n\t$scope.selectAll = function(){\r\n\t \t$scope.checked = !$scope.checked;\r\n\t \tif($scope.checked){\r\n\t \t\t$scope.data.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = true;\r\n\t \t\t})\r\n\t \t}\r\n\t \telse{\r\n\t \t\t$scope.data.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = false;\r\n\t \t\t})\r\n\t \t}\r\n\t }\r\n\t $scope.slide = function(name,checked){\r\n\t \tvar fatheritem = $scope.data.roles.filter(function(item){ return item.key === name })[0];\r\n\t \tvar subitem = $scope.data.roles.filter(function(item){ return item.belong === name })\r\n\t \tif(checked){\r\n\t \t\tfatheritem._arrow = \"down\";\r\n\t \t\tsubitem.forEach(function(item){\r\n\t \t\t\titem._slide = true;\r\n\t \t\t})\r\n\t \t}\r\n\t \telse{\r\n\t \t\tfatheritem._arrow = \"up\";\r\n\t \t\tsubitem.forEach(function(item){\r\n\t \t\t\titem._slide = false;\r\n\t \t\t})\r\n\t \t}\r\n\t  };\r\n\t$scope.select = function(name){\r\n\t\tvar checked = $scope.data.roles.filter(function(item){ return item.key === name })[0]._selected;\r\n\t\tvar subitem = $scope.data.roles.filter(function(item){ return item.belong === name })\r\n\t\tif(!checked){\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._selected = true;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._selected = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\tvar length = $scope.data.roles.filter(function(item){ return item._selected; }).length;\r\n\t\tif(length+1 == $scope.data.roles.length){\r\n\t\t\t$scope.checked = true;\r\n\t\t}\r\n\t\telse\r\n\t\t\t$scope.checked = false;\r\n\t };\r\n\t$scope.set = function(name){\r\n\t\tvar allchecked = false;\r\n\t\t$scope.data.roles.filter(function(item){ return item.belong === name }).forEach(function(item){ \r\n\t\t\tif(item._selected == true){\r\n\t\t\t\tallchecked = true;\r\n\t\t\t}\r\n\t\t})\r\n\t\tvar fatheritem = $scope.data.roles.filter(function(item){ return item.key === name })[0];\r\n\t\tif(fatheritem){\r\n\t\t\tif(!allchecked)\r\n\t\t\t\tfatheritem._selected = false;\r\n\t\t\telse{\r\n\t\t\t\tfatheritem._selected = true;\r\n\t\t\t}\t\r\n\t\t}\r\n\t\tvar length = $scope.data.roles.filter(function(item){ return item._selected; }).length;\r\n\t\tif(length == $scope.data.roles.length){\r\n\t\t\t$scope.checked = true;\r\n\t\t}\r\n\t\telse\r\n\t\t\t$scope.checked = false;\r\n\t\t\r\n\t}\r\n\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar _this = this;\r\n\t\tvar roles = this.data.roles.filter(function(item){ return item._selected == true }).map(function(item){ return item.key });\r\n\t\tif(roles.length){\r\n\t\t\trole.update({\r\n\t\t\t\t\t\"id\": this.data.id,\r\n\t\t\t\t\t\"name\": this.data.name,\r\n\t\t\t\t\t\"desc\": this.data.desc,\r\n\t\t\t\t\t\"keys\": roles.toString()\r\n\t\t\t\t},\r\n\t\t\t\tfunction(data){\r\n\t\t\t\t\tvar POWER = item.access_key;\r\n\t\t\t\t\titem.name = data.name;\r\n\t\t\t\t\titem.desc = data.desc;\r\n\t\t\t\t\titem.access_key = data.access_key;\r\n\t\t\t\t\titem.redactor = data.redactor;\r\n\t\t\t\t\titem.updated_time = data.updated_time;\r\n\t\t\t\t\titem.user_num = data.user_num;\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tif(_this.data.id === user.permission && item.access_key != POWER){\r\n\t\t\t\t\t\t$$$storage.setSessionStorage('power', roles.toString())\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"PERMISSION_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem);\r\n\t\tif($scope.data.roles.filter(function(item){ return item._selected === true }).length === $scope.data.roles.length){\r\n\t\t\t$scope.checked = true;\r\n\t\t}\r\n\t\telse $scope.checked = false;\r\n\t};\r\n}])\r\n.controller(\"addUserAdminDialog\", [\"$scope\", \"$modalInstance\", \"Admin\", \"SchoolRoom\", \"Roles\",\"$$$I18N\", function($scope, $modalInstance, admin, schoolroom, role, $$$I18N){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope._ischeckAll = true;\r\n\t$scope.data = {\r\n\t\tsex:'true',\r\n\t};\r\n\t$scope.master = {sex:'true'};\r\n\r\n\t$scope.schoolroom_loading = true;\r\n\tschoolroom.querywithSimple(function(res){\r\n\t\t$scope.schoolroom_loading = false;\r\n\t\t$scope.data.schoolrooms = res.pools_;\r\n\t\t$scope.data.schoolrooms.forEach(function(item){ item._selected = true;  });\r\n\t})\r\n\trole.query(function(res){\r\n\t\t$scope.roles = res.result;\r\n\t\t// $scope.data.role = res.result.filter(function(item){ return item.name===\"Administrator\" })[0];\r\n\t})\r\n\t$scope.DISABLED = false;\r\n\t$scope.changeRole = function(role){\r\n\t\tif($scope.data.role && $scope.data.role.name == \"Administrator\"){\r\n\t\t\trole._ischeckAll = true;\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t});\r\n\t\t\t$scope.DISABLED = true;\r\n\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.DISABLED = false;\r\n\t\t}\r\n\t}\r\n\t$scope.checkAll = function(scope){\r\n\t\tif(scope._ischeckAll){\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.checkOne = function(scope){\r\n\t\tvar schoolrooms = $scope.data.schoolrooms.filter(function(p){ \r\n\t\t\treturn p._selected;\r\n\t\t});\r\n\t\tif(schoolrooms.length === $scope.data.schoolrooms.length){\r\n\t\t\tscope._ischeckAll = true;\r\n\t\t}else{\r\n\t\t\tscope._ischeckAll = false;\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.master);\r\n\t};\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.master,$scope.data);\r\n\t}\r\n\t$scope.ok = function(){\r\n\t\tvar pools = $scope.data.schoolrooms.filter(function(item){ if(item._selected) return item }).map(function(item){ return item.id });\r\n\t\tif(pools.length)\r\n\t\t\tadmin.save(\r\n\t\t\t\t{\r\n\t\t\t\t\tname: $scope.data.name,\r\n\t\t\t\t\treal_name: $scope.data.real_name,\r\n\t\t\t\t\tsex: $scope.data.sex,\r\n\t\t\t\t\tpermission: $scope.data.role.id,\r\n\t\t\t\t\tpassword: $scope.data.password,\r\n\t\t\t\t\tpasswordConfirm: $scope.data.passwordConfirm,\r\n\t\t\t\t\temail: $scope.data.email,\r\n\t\t\t\t\tcontact: $scope.data.contact,\r\n\t\t\t\t\tpools: pools\r\n\t\t\t\t},\r\n\t\t\t\tfunction(data){\r\n\t\t\t\t\tdata.result.instance_num = 0;\r\n\t\t\t\t\t$scope.rows.push(data.result);\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"POOL_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"editUserAdminDialog\", [\r\n\"$scope\", \"$modalInstance\",\"Admin\", \"SchoolRoom\", \"Roles\", \"$$$UserRoles\", \"$$$I18N\", \"UserRole\",\r\nfunction($scope, $modalInstance, admin, schoolroom, role, $$$UserRoles, $$$I18N, UserRole){\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.owner = UserRole.isOwner;\r\n\r\n\t$scope.master = {};\r\n\t$scope.data = {};\r\n\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\t$scope.schoolroom_loading = true;\r\n\tschoolroom.querywithSimple(function(res){\r\n\t\t$scope.schoolroom_loading = false;\r\n\t\titem.schoolrooms = res.pools_;\r\n\t\tvar i = 0;\r\n\t\titem.schoolrooms.forEach(function(sch){\r\n\t\t\titem.pool.forEach(function(id){\r\n\t\t\t\tif(sch.id === id){\r\n\t\t\t\t\tsch._selected = true;\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t\tif(i == item.schoolrooms.length){\r\n\t\t\t$scope._ischeckAll = true;\r\n\t\t}\r\n\t\trole.query(function(res){\r\n\t\t\titem.roles = res.result;\r\n\t\t\tvar myrole = res.result.filter(function(role){ return role.name === item.permission })[0];\r\n\t\t\t// if(myrole)\r\n\t\t\t\titem.myrole = res.result.filter(function(role){ return role.name === item.permission })[0];\r\n\t\t\t// else\r\n\t\t\t// \titem.myrole = res.result[0];\r\n\t\t\t$scope.data = angular.copy(item);\r\n\t\t})\r\n\t\t\r\n\t})\r\n\tif(!$scope.owner)\r\n\t\t$scope.DISABLED = true;\r\n\t$scope.changeRole = function(role){\r\n\t\tif($scope.data.myrole && $scope.data.myrole.name == \"Administrator\"){\r\n\t\t\trole._ischeckAll = true;\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t});\r\n\t\t\t$scope.DISABLED = true;\r\n\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data.schoolrooms.forEach(function(item){\r\n\t\t\t\t\titem._selected = false;\r\n\t\t\t})\r\n\t\t\titem.pool.forEach(function(schoolroom_id){\r\n\t\t\t\t$scope.data.schoolrooms.forEach(function(item){\r\n\t\t\t\t\tif(item.id === schoolroom_id){\r\n\t\t\t\t\t\titem._selected = true\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tif($scope.data.schoolrooms.filter(function(item){ return item._selected == true }).length == $scope.data.schoolrooms.length)\r\n\t\t\t\trole._ischeckAll = true;\r\n\t\t\telse role._ischeckAll = false;\r\n\t\t\t\r\n\t\t\t$scope.DISABLED = false;\r\n\t\t}\r\n\t}\r\n\t$scope.checkAll = function(scope){\r\n\t\tif(scope._ischeckAll){\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.checkOne = function(scope){\r\n\t\tvar schoolrooms = $scope.data.schoolrooms.filter(function(p){ \r\n\t\t\treturn p._selected;\r\n\t\t});\r\n\t\tif(schoolrooms.length === $scope.data.schoolrooms.length){\r\n\t\t\tscope._ischeckAll = true;\r\n\t\t}else{\r\n\t\t\tscope._ischeckAll = false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem);\r\n\t\tif($scope.data.schoolrooms.filter(function(item){ return item._selected === true }).length === $scope.data.schoolrooms.length){\r\n\t\t\t$scope.$$childTail._ischeckAll = true;\r\n\t\t}\r\n\t\telse {console.log($scope); $scope.$$childTail._ischeckAll = false;}\r\n\r\n\t};\r\n\r\n\t$scope.edit = function() {\r\n\t\tvar user_id = this.data.id;\r\n\t\tvar pools = this.data.schoolrooms.filter(function(item){ if(item._selected) return item }).map(function(item){ return item.id });\r\n\t\tif(pools.length)\r\n\t\t\tadmin.update(\r\n\t\t\t{\r\n\t\t\t\tid:this.data.id,\r\n\t\t\t\tcontact:this.data.contact,\r\n\t\t\t\temail:this.data.email,\r\n\t\t\t\tname:this.data.name,\r\n\t\t\t\treal_name:this.data.real_name,\r\n\t\t\t\tsex:this.data.sex,\r\n\t\t\t\tpassword:this.data.password,\r\n\t\t\t\tpools:pools,\r\n\t\t\t\tpermission: this.data.myrole.id\r\n\r\n\t\t\t},\r\n\t\t\t\tfunction(res){\r\n\t\t\t\t\tvar PERMISSION = item.permission;\r\n\t\t\t\t\titem.name = res.result.name;\r\n\t\t\t\t\titem.real_name = res.result.real_name;\r\n\t\t\t\t\titem.sex = res.result.sex;\r\n\t\t\t\t\titem.email = res.result.email;\r\n\t\t\t\t\titem.contact = res.result.contact;\r\n\t\t\t\t\titem.pool = res.result.pool;\r\n\t\t\t\t\titem.permission = res.name;\r\n\t\t\t\t\tif(user_id === user.id){\r\n\t\t\t\t\t\t$$$storage.setSessionStorage('power', $scope.data.roles.filter(item => item.name === res.name )[0].access_key)\r\n\t\t\t\t\t\tvar logInfor = UserRole.currentUser;\r\n\t\t\t\t\t\tlogInfor.keys = $$$storage.getSessionStorage(\"power\");\r\n\t\t\t\t\t\tlogInfor.pool = res.result.pool;\r\n\t\t\t\t\t\t$$$storage.setSessionStorage(\"loginInfo\", JSON.stringify(logInfor))\r\n\t\t\t\t\t\tif(item.permission != PERMISSION){ location.reload(); }\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\tfunction(){  }\r\n\t\t\t);\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"POOL_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.controller(\"addUserCommonDialog\", [\"$scope\", \"$modalInstance\",\"User\", \"UserRole\", function($scope, $modalInstance, user, Role){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.data = {\r\n\t\tsex:'true',\r\n\t\trole:'2',\r\n\t\tdepartment: $scope.selected.id,\r\n\t\tredactor: Role.currentUser.name\r\n\r\n\t};\r\n\t$scope.master = {sex:'true',role_desc:'教师'};\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.master);\r\n\t};\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.master,$scope.data);\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\tconsole.log(666666666, $scope.data)\r\n\t\tuser.save(\r\n\t\t\t$scope.data,\r\n\t\t\tfunction(data){\r\n\t\t\t\t$scope.queryDepart();\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.controller(\"editUserCommonDialog\", [\"$scope\", \"$modalInstance\", \"User\", function($scope, $modalInstance, user){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\t$scope.data = angular.copy(item);\r\n\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem);\r\n\t};\r\n\t$scope.edit = function() {\r\n\t\tuser.edit({\r\n\t\t\tid: this.data.id,\r\n\t\t\tcontact:this.data.contact,\r\n\t\t\temail:this.data.email,\r\n\t\t\tname:this.data.name,\r\n\t\t\treal_name:this.data.real_name,\r\n\t\t\tsex:this.data.sex,\r\n\t\t\tpassword:this.data.password,\r\n\t\t\tpasswordConfirm: this.data.password,\r\n\t\t\tdesc: this.data.desc\r\n\t\t},function(res){\r\n\t\t\t$scope.queryDepart();\r\n\t\t\t$modalInstance.close();\r\n\t\t},function(){});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.controller(\"addUserDomainDialog\", [\"$scope\", \"$modalInstance\", \"Server\", function($scope, $modalInstance, Server){\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem||{});\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\t\r\n\r\n\t$scope.ok=function(){\r\n\t\t$scope.submiting = true ;\r\n\t\t$scope.afterSubmiting =false ;\r\n\t\tServer.create($scope.data,function(response){\r\n\t\t\t$scope.submiting = false ;\r\n\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t$scope.rows.unshift(response.result[0]);\r\n\t\t\t$modalInstance.close();\r\n\t\t},function(){\r\n\t\t\t$scope.submiting = false ;\r\n\t\t\t$scope.afterSubmiting = false ;\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.data = {\"user\":\"\",\"passwd\":\"\"};\r\n}])\r\n.controller(\"editUserDomainDialog\", [\"$scope\", \"$modalInstance\", \"Server\", function($scope, $modalInstance, Server){\r\n\tvar item = $scope.item || $scope.currentItem||{};\r\n\t$scope.data = angular.copy(item);\r\n\tServer.get({\"id\":item.id},function(response){\r\n\t\tvar data=response;\r\n\t\tangular.forEach(data,function(value,key){\r\n\t\t\titem[key]=data[key];\r\n\t\t});\r\n\t},function(){\r\n\t});\r\n\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem||{});\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\t\r\n\r\n\t$scope.ok=function(){\r\n\t\t$scope.submiting = true ;\r\n\t\t$scope.afterSubmiting =false ;\r\n\t\tServer.update($scope.data,function(response){\r\n\t\t\tvar data=response.result[0];\r\n\t\t\tangular.forEach(data,function(value,key){\r\n\t\t\t\titem[key]=data[key];\r\n\t\t\t});\r\n\t\t\t$modalInstance.close();\r\n\t\t}, function(){\r\n\t\t\t$scope.submiting = false ;\r\n\t\t\t$scope.afterSubmiting = false ;\r\n\t\t});\r\n\t};\r\n}])\r\n.controller(\"userDoaminAscingDialog\", [\"$scope\", \"$modalInstance\", \"Domain\", function($scope, $modalInstance, Domain){\r\n\tvar domainId = parseInt(location.hash.match(/\\d+$/)[0]);\r\n\t$scope.selected=[];\r\n\r\n\tDomain.get({id: domainId},function(response){\r\n\t\t$scope.status = 'completed';\r\n\t\t$scope.ous = response.ous;\r\n\r\n\t},function(){\r\n\t\t$scope.status = 'completed';\r\n\t});\r\n\r\n\t$scope.ok = function(){\r\n\t\tDomain.asycing({\r\n\t\t\tid: domainId,\r\n\t\t\tauto: 0,\r\n\t\t\tous: $scope.selected.map(function(item){ return item.base_dn; })\r\n\t\t},function(response){\r\n\t\t\tresponse.result.map(function(item){\r\n\t\t\t\tvar len=$scope.rows.length,i;\r\n\t\t\t\tfor(i=0;i<len;i++){\r\n\t\t\t\t\tif(item.id==$scope.rows[i].id){\r\n\t\t\t\t\t\t$scope.rows[i]=item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(i>=len){\r\n\t\t\t\t\t$scope.rows.push(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$modalInstance.close();\r\n\t\t},function(){});\r\n\t};\r\n\r\n\t$scope.select_row = function(item){\r\n\t\titem._selected = true;\r\n\t};\r\n\t$scope.select = function(item){\r\n\t\tif(item){\r\n\t\t\tif($scope.selected.filter(function(d){ return d.fullname==item.fullname; }).length==0)\r\n\t\t\t\t$scope.selected.push(item);\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.ous.filter(function(item){ return item._selected }).forEach(function(d){\r\n\t\t\t\tif($scope.selected.filter(function(data){ return data.fullname==d.fullname; }).length==0)\r\n\t\t\t\t\t$scope.selected.push(d);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.removeSelected=function(_item){\r\n\t\tvar index;\r\n\t\tif(!_item){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tindex=$scope.selected.indexOf(_item);\r\n\t\tif(index>-1){\r\n\t\t\t$scope.selected.splice(index,1);\r\n\t\t}\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.constant(\"NavigatorLink\", [\r\n\t{\r\n\t\t\"key\": \"Summary\",\r\n\t\t\"value\": \"概要\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-home\",\r\n\t\t\"url\": \"/summary\"\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Resource\",\r\n\t\t\"value\": \"资源\",\r\n\t\ticon: \"icon-jj-cloud\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Console\",\r\n\t\t\t\t\"value\": \"主控管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Resource\",\r\n\t\t\t\t\"url\": \"/resource/console\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Pool\",\r\n\t\t\t\t\"value\": \"资源池管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Resource\",\r\n\t\t\t\t\"url\": \"/resource/pool\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Storage\",\r\n\t\t\t\t\"value\": \"存储管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Resource\",\r\n\t\t\t\t\"url\": \"/resource/storage\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Network\",\r\n\t\t\"value\": \"网络\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-017\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"ManageNetwork\",\r\n\t\t\t\t\"value\": \"管理网络\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/manageNetwork\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"VirtualSwitch\",\r\n\t\t\t\t\"value\": \"分布式虚拟交换机\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/virtualSwitch\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"DataNetwork\",\r\n\t\t\t\t\"value\": \"数据网络\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/dataNetwork\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"DHCP\",\r\n\t\t\t\t\"value\": \"DHCP\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/dhcp\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Desktop\",\r\n\t\t\"value\": \"桌面\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-pc\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Teaching_desktop\",\r\n\t\t\t\t\"value\": \"教学桌面\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Desktop\",\r\n\t\t\t\t\"url\": \"/desktop/scene\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Personal_desktop\",\r\n\t\t\t\t\"value\": \"个人桌面\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Desktop\",\r\n\t\t\t\t\"url\": \"/desktop/personal\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Personal_desktop_pool\",\r\n\t\t\t\t\"value\": \"个人桌面池\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Desktop\",\r\n\t\t\t\t\"url\": \"/desktop/pool\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Template\",\r\n\t\t\"value\": \"模板\",\r\n\t\ticon: \"icon-jj-Template\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Teaching_template\",\r\n\t\t\t\t\"value\": \"教学模板\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Template\",\r\n\t\t\t\t\"url\": \"/template/teach\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Personal_template\",\r\n\t\t\t\t\"value\": \"个人模板\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Template\",\r\n\t\t\t\t\"url\": \"/template/personal\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Hardware_template\",\r\n\t\t\t\t\"value\": \"硬件模板\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Template\",\r\n\t\t\t\t\"url\": \"/template/hardware\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Terminal\",\r\n\t\t\"value\": \"终端\",\r\n\t\ticon: \"icon-jj-Terminal\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Classroom\",\r\n\t\t\t\t\"value\": \"教室管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Terminal\",\r\n\t\t\t\t\"url\": \"/terminal/schoolroom\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Terminal_Manage\",\r\n\t\t\t\t\"value\": \"终端管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Terminal\",\r\n\t\t\t\t\"url\": \"/terminal/client\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"User\",\r\n\t\t\"value\": \"用户\",\r\n\t\ticon: \"icon-jj-men\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Role_Manage\",\r\n\t\t\t\t\"value\": \"角色管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/role\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Administrator\",\r\n\t\t\t\t\"value\": \"管理用户\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/admin\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Common_user\",\r\n\t\t\t\t\"value\": \"普通用户\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/common\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Domain_user\",\r\n\t\t\t\t\"value\": \"域用户\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/domain\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Monitor\",\r\n\t\t\"value\": \"监控\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-Monitor\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Host_monitoring\",\r\n\t\t\t\t\"value\": \"主机监控\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/host\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Desktop_monitoring\",\r\n\t\t\t\t\"value\": \"桌面监控\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/desktop\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Alarm_information\",\r\n\t\t\t\t\"value\": \"告警信息\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/alarm\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Alarm_policy\",\r\n\t\t\t\t\"value\": \"告警策略\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/policy\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Timetable\",\r\n\t\t\"value\": \"排课\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-paike\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Course_list\",\r\n\t\t\t\t\"value\": \"课程列表\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Timetable\",\r\n\t\t\t\t\"url\": \"/scheduler/view\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Plan\",\r\n\t\t\"value\": \"计划任务\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-012\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Timer_switch\",\r\n\t\t\t\t\"value\": \"定时开关机\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Plan\",\r\n\t\t\t\t\"url\": \"/plan/switch\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Host_switch\",\r\n\t\t\t\t\"value\": \"主机定时开关机\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Plan\",\r\n\t\t\t\t\"url\": \"/plan/hostSwitch\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"HA\",\r\n\t\t\"value\": \"高可用性\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-001\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"desktop_ha\",\r\n\t\t\t\t\"value\": \"桌面HA\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"HA\",\r\n\t\t\t\t\"url\": \"/HA/desktop\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"System\",\r\n\t\t\"value\": \"系统\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-Setup\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_deploy\",\r\n\t\t\t\t\"value\": \"快速部署\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/deploy\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_desktop\",\r\n\t\t\t\t\"value\": \"系统桌面\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/desktop\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_ISO\",\r\n\t\t\t\t\"value\": \"系统 ISO\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/iso\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"USB_redirection\",\r\n\t\t\t\t\"value\": \"USB 重定向\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/usb\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"USB_through\",\r\n\t\t\t\t\"value\": \"USB 透传\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/through\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"AutoSnapshot\",\r\n\t\t\t\t\"value\": \"自动快照\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/snapshot\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_set\",\r\n\t\t\t\t\"value\": \"系统设置\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/set\"\r\n\t\t\t},\r\n\t\t\t// {\r\n\t\t\t// \t\"key\": \"USB_device\",\r\n\t\t\t// \t\"value\": \"主机 USB 设备\",\r\n\t\t\t// \t\"is_group\": false,\r\n\t\t\t// \t\"belong\": \"System\",\r\n\t\t\t// \t\"url\": \"/system/device\"\r\n\t\t\t// },\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_backup\",\r\n\t\t\t\t\"value\": \"系统备份\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/backup\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_upgrade\",\r\n\t\t\t\t\"value\": \"系统升级\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/upgrade\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Operation_log\",\r\n\t\t\t\t\"value\": \"操作日志\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/logs\"\r\n\t\t\t}\r\n\t\t\t// {\r\n\t\t\t// \t\"key\": \"End_log\",\r\n\t\t\t// \t\"value\": \"后台日志\",\r\n\t\t\t// \t\"is_group\": false,\r\n\t\t\t// \t\"belong\": \"System\",\r\n\t\t\t// \t\"url\": \"/system/endlogs\"\r\n\t\t\t// }\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"About\",\r\n\t\t\"value\": \"关于\",\r\n\t\ticon: \"icon-jj-about-1\",\r\n\t\t\"is_group\": true,\r\n\t\t\"url\": \"/about\"\r\n\t}\r\n])\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/user/controllers.js","angular.module(\"vdi.desktop\", [])\r\n\r\n/* 场景 */\r\n.factory(\"Scene\", [\"$resource\", function($resource){\r\n\treturn $resource(\"/thor/pool/modes\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", isArray: false },\r\n\t\tsave :\r\n\t\t\t{ method: \"POST\"},\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url: \"/thor/pool/mode/:id\", params: {id: \"@id\"} },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: \"/thor/pool/mode/:id\", params: {id: \"@id\"} },\r\n\t\tactive:\r\n\t\t\t{ method: \"PUT\", url: \"/thor/pool/mode/:id\", params: {id: \"@id\"} },\r\n\t\tpowerOn:\r\n\t\t\t{ method: \"POST\", url: \"/thor/pool/mode/action\"},\r\n\t    powerOff:\r\n\t\t\t{ method: \"POST\", url: \"/thor/pool/mode/action\"},\r\n\t    forcePowerOff:\r\n\t\t\t{ method: \"POST\", url: \"/thor/pool/mode/action\"},\r\n\t\thaConfig:\r\n\t\t\t{ method: \"GET\", url: \"/thor/pool/mode/haConfig/:id\", params:{id: \"@id\"} },\r\n\t\tsort:\r\n\t\t\t{ method: \"POST\",url: \"/thor/pool/modes/order\"}\r\n\r\n\t});\r\n}])\r\n/*教学桌面 */\r\n.factory(\"TeachDesktop\", [\"$resource\", function($resource){\r\n\treturn $resource(\"/thor/instance/mode/:id\", { id: \"@id\" }, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", isArray: false },\r\n\t\tdelete:\r\n\t\t\t{ method:\"DELETE\", url: \"/thor/instances\" },\r\n\t\treset:\r\n\t\t\t{ method:\"POST\" , url:\"/thor/instance/mode/reset\"},\r\n\t\tsave:\r\n\t\t\t{ method:\"POST\" },\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url: \"/thor/instance/:id\", params: { id: \"@id\" }, isArray: false },\r\n\t\tstart:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instances/starts\" },\r\n\t\tshutdown:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instances/shutdowns\" },\r\n\t\tpause:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instances/pause\" },\r\n\t\tresume:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instances/unpause\" },\r\n\t\treboots:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instances/reboots\" },\r\n\t\tscreenshot:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instances/screenshot\" },\r\n\t\trename:\r\n\t\t\t{method:\"POST\", url: \"/thor/pool/mode/instance/rename\"}\r\n\t});\r\n}])\r\n/*个人桌面 */\r\n.factory(\"PersonDesktop\", [\"$resource\", function($resource){\r\n\treturn $resource(\"/thor/instance/:id\", { id: \"@id\" }, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: \"/thor/instances\", isArray: false },\r\n\t\tdelete:\r\n\t\t\t{ method:\"DELETE\", url: \"/thor/instances\" },\r\n\t\tsave:\r\n\t\t\t{ method:\"POST\", url: \"/thor/instance\" },\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", isArray: false },\r\n\t\tupdate:\r\n\t\t\t{ method: \"PUT\" },\r\n\t\tstart:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/starts\" },\r\n\t\tshutdown:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/shutdowns\" },\r\n\t\tpause:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/pause\" },\r\n\t\tresume:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/unpause\" },\r\n\t\treboot:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/reboots\" },\r\n\t\tmigrate : \r\n\t\t\t{ method: \"post\",url: \"/thor/instance/livemigration/:id\" , params: { \"id\": \"@id\" } },\r\n\t\tscreenshot:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instances/screenshot/:id\", params: { \"id\": \"@id\" } },\r\n\t\tsaveAsTemplate:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/saveTemplate\" },\r\n\t\t//移动至\r\n\t\tmoveHostList:\r\n\t\t\t{ method: \"GET\", url: \"/thor/ha/instance/move\"},\r\n\t\tmoveTo:\r\n\t\t\t{ method:\"POST\", url: \"/thor/ha/instance/move\"},\r\n\t\t//获取无源数据盘\r\n\t\tlist_passive_disk:\r\n\t\t\t{ method: \"GET\", url: \"/thor/list_passive_volume\"},\r\n\t\t//获取桌面详情信息\r\n\t\tlist_detail:\r\n\t\t\t{ method: \"GET\", url: \"/thor/get_instance_details/:id\", params:{ \"id\": \"@id\"} },\r\n\t\t// 个人模板获取有哪些个人桌面会更新\r\n\t\tupdate_instance:\r\n\t\t\t{ method: \"GET\", url: \"/thor/instance/image/:id\", params: { \"id\": \"@id\" } },\r\n\t\tcheck_can_migrate_host:\r\n\t\t\t{ method:\"POST\", url: \"/thor/check_can_migrate_host\" },\r\n\t\tshare_servers:\r\n\t\t\t{ method: \"GET\", url: \"/thor/share/servers\" }\r\n\t});\r\n}])\r\n/*个人桌面池*/\r\n.factory('DeskPool', ['$resource', function($resource){\r\n\treturn $resource(\"/thor/instances/pool/:id\", { id: \"@id\" }, {\r\n\t\t\tquery:\r\n\t\t\t\t{ method: \"GET\", isArray: false },\r\n\t\t\tdelete:\r\n\t\t\t\t{ method:\"DELETE\", url: \"/thor/instances/pool\" },\r\n\t\t\tsave:\r\n\t\t\t\t{ method:\"POST\", url: \"/thor/instances/pool\" },\r\n\t\t\tget:\r\n\t\t\t\t{ method: \"GET\", isArray: false },\r\n\t\t\tupdate:\r\n\t\t\t\t{ method: \"PUT\",url: \"/thor/instance/pool/:id\", params: { \"id\": \"@id\" }},\r\n\t\t\tstart:\r\n\t\t\t\t{ method: \"POST\", url: \"/thor/instances/pool/action\" },\r\n\t\t\tshutdown:\r\n\t\t\t\t{ method: \"POST\", url: \"/thor/instances/pool/action\" },\r\n\t\t\tpause:\r\n\t\t\t\t{ method: \"POST\", url: \"/thor/instances/pool/pause\" },\r\n\t\t\tresume:\r\n\t\t\t\t{ method: \"POST\", url: \"/thor/instances/pool/unpause\" },\r\n\t\t\treboot:\r\n\t\t\t\t{ method: \"POST\", url: \"/thor/instances/pool/reboots\" },\r\n\t\t\tmigrate : \r\n\t\t\t\t{ method: \"post\",url: \"/thor/instances/livemigration/:id\" , params: { \"id\": \"@id\" } },\r\n\t\t\tscreenshot:\r\n\t\t\t\t{ method: \"POST\", url: \"/thor/instances/screenshot/:id\", params: { \"id\": \"@id\" } },\r\n\t\t\tsaveAsTemplate:\r\n\t\t\t\t{ method: \"POST\", url: \"/thor/instances/saveTemplate\" },\r\n\t\t\t//移动至\r\n\t\t\tmoveHostList:\r\n\t\t\t\t{ method: \"GET\", url: \"/thor/ha/instances/pool/move\"},\r\n\t\t\tmoveTo:\r\n\t\t\t\t{ method:\"POST\", url: \"/thor/ha/instances/move\"},\r\n\t\t\t//获取无源数据盘\r\n\t\t\tlist_passive_disk:\r\n\t\t\t\t{ method: \"GET\", url: \"/thor/list_passive_volume\"},\r\n\t\t\t//获取桌面详情信息\r\n\t\t\tlist_detail:\r\n\t\t\t\t{ method: \"GET\", url: \"/thor/get_instance_details/:id\", params:{ \"id\": \"@id\"} },\r\n\t\t\t// 个人模板获取有哪些个人桌面会更新\r\n\t\t\tupdate_instance:\r\n\t\t\t\t{ method: \"GET\", url: \"/thor/instances/image/:id\", params: { \"id\": \"@id\" } }\r\n\t});\r\n}])\r\n/*个人桌面池详情*/\r\n.factory(\"DeskPoolSecond\", [\"$resource\", function($resource){\r\n\treturn $resource(\"/thor/instances/pool\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", isArray: false },\r\n\t\tsave :\r\n\t\t\t{ method: \"POST\"},\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url: \"/thor/instance/pool/:id\", params: {id: \"@id\"} },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/pool/:id\", params: {id: \"@id\"} },\r\n\t\tactive:\r\n\t\t\t{ method: \"PUT\", url: \"/thor/instance/pool/:id\", params: {id: \"@id\"} },\r\n\t\tstart:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/starts\" },\r\n\t\tshutdown:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/shutdowns\"},\r\n\t\tpause:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/pause\" },\r\n\t\tresume:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/unpause\" },\r\n\t\treboots:\r\n\t\t\t{ method: \"POST\", url: \"/thor/instance/reboots\" },\r\n\t\tmoveHostList:\r\n\t\t\t{ method: \"GET\", url: \"/thor/ha/instance/move\"},\r\n\t\tmoveTo:\r\n\t\t\t{ method:\"POST\", url: \"/thor/ha/instance/move\"},\r\n\t});\r\n}])\r\n//教学桌面--桌面修改\r\n.factory(\"SenceAlter\", [\"$resource\", function($resource){\r\n\tvar res = $resource(\"/thor/pool/mode/new\", null, {\r\n\t\tquery: \r\n\t\t    {method: \"GET\", isArray: false},\r\n\t\tsave: \r\n\t\t    {method: \"POST\"}\r\n\t});\r\n\treturn res;\r\n}])\r\n\r\n/* 教学、个人公用 */\r\n.factory(\"VMCommon\", [\"$resource\", function($resource){\r\n\tvar base_url = \"/thor/instance\";\r\n\treturn $resource(base_url, { id: \"@id\" }, {\r\n\t\tstart:\r\n\t\t\t{ method: \"POST\", url: base_url +\"/starts\"},\r\n\t\tshutdowns:\r\n\t\t\t{ method: \"POST\", url: base_url +\"/shutdowns\"},\r\n\t\tpause:\r\n\t\t\t{ method: \"POST\", url: base_url + \"/pause\"},\r\n\t\tresume:\r\n\t\t\t{ method: \"POST\", url: base_url + \"/unpause\"},\r\n\t\treboots:\r\n\t\t\t{ method: \"POST\", url: base_url + \"/reboots\"},\r\n\t\tscreenshot:\r\n\t\t\t{ method: \"POST\", url: base_url + \"/screenshot\"},\r\n\t\t// 列出桌面快照\r\n\t\tlist_snapshot:\r\n\t\t\t{ method: \"GET\", url:base_url + \"/snapshot\"},\r\n\t\t// 创建快照\r\n\t\ttake_snapshot:\r\n\t\t\t{ method:\"POST\", url:base_url + \"/snapshot\"},\r\n\t\trestore_snapshot:\r\n\t\t\t{ method:\"POST\", url:base_url + \"/snapshot\"},\r\n\t\tdelete_snapshot:\r\n\t\t\t{ method:\"DELETE\", url:base_url + \"/snapshot\"},\r\n\t\t// 获取在线迁移主机\r\n\t\tget_live_move_hosts:\r\n\t\t\t{ method: \"GET\", url: \"/thor/ha/instance/live/move\"},\r\n\t\t//在线迁移\r\n\t\tlive_move:\r\n\t\t\t{ method: \"POST\", url: \"/thor/ha/instance/live/move\"},\r\n\t\tlist_template:\r\n\t\t\t{ method: \"GET\", url: \"/thor/image/simple/:type\", params:{ \"type\": \"@type\"} },\r\n\t});\r\n}])\r\n// 筛选出选中的元素。若field参数存在，算出所有选中元素field字段的累计值\r\n.filter('selectedFilter',function(){\r\n\treturn function(list,field){\r\n\t\tif(list){\r\n\t\t\tif(field){\r\n\t\t\t\tvar _list = list.filter(function(item){ return item._selected }).map(function(item){ return item[field] });\r\n\t\t\t\treturn _list.length ? _list.reduce(function(a,b){return a + b}) : 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn list.filter(function(item){ return item._selected });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})\r\n// 个人桌面列表控制器\r\n.controller(\"vdiDesktopPersonalListController\", [\"$scope\",\"$modal\", \"PersonDesktop\", \"VMCommon\", \"$interval\", \"$filter\",\"PersonTemplate\",\"$$$os_types\",\"$$$I18N\",\"Server\",\"UserRole\",\"$location\",\"$q\",\"Admin\",\"User\",\"Depart\",\"TreeInstances\",\r\n\tfunction($scope,$modal, person_desktop, vm, $interval, $filter, tmpl,$$$os_types,$$$I18N,Server,UserRole,$location,$q,Admin,UsercommonList,Depart,TreeInstances){\r\n\tlet hasTerminalpermission = UserRole.currentUserRoles.filter(function(role){ return role=='Terminal' }).length;\r\n\tlet hasTerminalManagepermission = UserRole.currentUserRoles.filter(function(role){ return role=='Terminal_Manage' }).length;\r\n\tlet hasClassroompermission = UserRole.currentUserRoles.filter(function(role){ return role=='Classroom' }).length;\r\n\t$scope.linkTerminal = hasTerminalpermission && hasTerminalManagepermission && hasClassroompermission ? true:false;\r\n\t$scope.inCurrentUserPool = function(pool){\r\n\t\tif($$$storage.getSessionStorage(\"loginInfo\"))\r\n\t\t\treturn JSON.parse($$$storage.getSessionStorage(\"loginInfo\")).pool.indexOf(pool)>-1\r\n\t};\r\n\r\n\r\n\tif($location.$$search.name)\r\n\t\t$scope.searchText = decodeURIComponent($location.$$search.name);\r\n\r\n\t$interval(function(){\r\n\t\tvar filterSearch = $filter(\"filter\")($scope.rows || [], $scope.searchText);\r\n\t\tvar filterSearchPage = $filter(\"paging\")(filterSearch, $scope.currentPage, $scope.pagesize);\r\n\t\t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"instanceIDS\", filterSearchPage.map(item => item.id));\r\n\t}, 1000);\r\n\t$scope.$on(\"instancesRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(item.task_state){\r\n\t\t\t\titem.other_status = 'other';\r\n\t\t\t}else{\r\n\t\t\t\titem.other_status = 'certain';\r\n\t\t\t}\r\n\t\t\tif(item.status == 'updating' || item.status == 'making'){\r\n\t\t\t\titem._ignore = true;\r\n\t\t\t}else{\r\n\t\t\t\titem._ignore = false;\r\n\t\t\t}\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t// $scope.updateData(\"\", $scope.select, $scope.depart);\r\n\t});\r\n\t$scope.getObjLength = function(obj){\r\n\t\ttry{\r\n\t\t\treturn Object.keys(obj).length;\r\n\t\t}catch(err){\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.depart = {name: '全部', id: -1, full_path: 'root'};\r\n\t$scope.refresh = (_s = $scope) => {\r\n\t\t_s.depart = $$$storage.getSessionStorage('depart')?JSON.parse($$$storage.getSessionStorage('depart')):$scope.depart;\r\n\t\tperson_desktop.query(res => {\r\n\t\t\t// _s.rows = _s.select==''?res.result:res.result.filter(function(item){ return item.status == _s.select });\r\n\t\t\tres.result.forEach(function(desk){\r\n\t\t\t\tif(desk.user_group==\"\"){\r\n\t\t\t\t\tdesk.user_group=$$$I18N.get(\"管理用户\")\r\n\t\t\t\t}\r\n\t\t\t\tif(desk.task_state){\r\n\t\t\t\t\tdesk.other_status = 'other';\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdesk.other_status = 'certain';\r\n\t\t\t\t}\r\n\t\t\t\tif(desk.status == 'updating' || desk.status == 'making'){\r\n\t\t\t\t\tdesk._ignore = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdesk._ignore = false;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t_s.allRows = res.result;\r\n\t\t\t_s.updateData(\"\", _s.select, _s.depart);\r\n\t\t\t_s.rows.forEach(row => {\r\n\t\t\t\tlet os = $$$os_types.filter(item => item.key === row.os_type)[0];\r\n\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\trow.detailData = {};\r\n\t\t\t});\r\n\t\t\t_s.loading = false;\r\n\t\t});\r\n\t};\r\n\t$scope.getDetail = function(it){\r\n\t\t$scope.loading_detail = true;\r\n\t\tperson_desktop.list_detail({id:it.id},function(res){\r\n\t\t\tit.detailData = res.result;\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.loading_detail = false;\r\n\t\t});\r\n\t};\r\n\t$scope.expand = function(row){\r\n\t\t$scope.rows.forEach(r => {\r\n\t\t\tif(row.id === r.id){\r\n\t\t\t\tr._expand = !row._expand;\r\n\t\t\t\tif(r._expand){\r\n\t\t\t\t\t$scope.getDetail(row);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tr._expand = false;\r\n\t\t\t}\r\n\t\t})\r\n\t};\r\n\t$scope.pagesize    = Number($$$storage.getSessionStorage('personl_pagesize')) || 30;\r\n\t$scope.currentPage = 1;\r\n \t$scope.$watch(\"pagesize\",function(newvalue){\r\n \t\t$$$storage.setSessionStorage('personl_pagesize', newvalue);\r\n\t});\r\n\t$scope.loading = true;\r\n\t$scope.rows = [];\r\n\t$scope.refresh();\r\n\t$scope.openAddDomainDialog = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.is_domain_user && !row.ad_server_name });\r\n\t\tif(rows.length === 0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalDomain_TIP1\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar modal = $modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/add_server.html\",\r\n\t\t\tcontroller:\"personalAddServerDialog\",\r\n\t\t\tresolve:{param:function(){return angular.copy(rows);}}\r\n\t\t});\r\n\t\tmodal.result.then(function(res){\r\n\t\t\t$scope.refresh();\r\n\t\t});\r\n\t};\r\n\t$scope.personExitDomain = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.ad_server_name; });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalDomain_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='退域'>\"+\r\n\t\t\t\t\t\t\t\"退域</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='DOMAIN_EXIT_TIP'>所选桌面在下一次开机时，将自动执行退域的操作，是否确定？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\tServer.domain_set_person({\r\n\t\t\t\t\t\t\t\tinstance_ids:rows.map(function(row){ return row.id }),\r\n\t\t\t\t\t\t\t\thas_domain:false\r\n\t\t\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.updateData = function(text,select,depart){\r\n\t\t$$$storage.setSessionStorage('depart', JSON.stringify(depart));\r\n\t\t$scope.rows = $scope.allRows.filter(function(row){\r\n\t\t\trow._selected = false;\r\n\t\t\tif(select){\r\n\t\t\t\tif(text && text.trim()){\r\n\t\t\t\t\treturn row.status === select || row.other_status === select;\r\n\t\t\t\t}\r\n\t\t\t\treturn row.status === select || row.other_status === select;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tvar ids = [];\r\n\t\tif(depart.type=='common'){\r\n\t\t\t$scope.rows = $scope.rows.filter(it=>it.user_group.indexOf(depart.dept_name)>-1);\r\n\t\t}else if(depart.type=='domain'){\r\n\t\t\t$scope.rows = $scope.rows.filter(it=>it.user_group===depart.domain_name);\r\n\t\t}else if(depart.type=='admin'){\r\n\t\t\t$scope.rows = $scope.rows.filter(it=>it.user===depart.name);\r\n\t\t}else if(depart.type=='adminAll'){\r\n\t\t\t$scope.rows = $scope.rows.filter(it=>it.user_group==$$$I18N.get(\"管理用户\"));\r\n\t\t}\r\n\t};\r\n\r\n\tvar _controllerScope = $scope;\r\n\t/**\r\n\t* [selectMode 部门域选择]\r\n\t*/\r\n    $scope.selectMode = function(){\r\n         $modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/personal_user_group.html\",\r\n\t\t\tsize: 'sm-md',\r\n\t\t\tcontroller:function($scope,$modalInstance){\r\n\t\t\t\tfunction formatData(d,name){\r\n\t\t\t\t\titeration(d,name);\r\n\t\t\t\t\treturn d;\r\n\t\t\t\t}\r\n\t\t\t\tfunction iteration(data,childName){\r\n\t\t\t\t\tfor(var i = 0 ; i < data.length ; i++){\r\n\t\t\t\t\t\tdata[i]['type'] = 'common';\r\n\t\t\t\t\t\tdata[i]['name'] = data[i]['dept_name'];\r\n\t\t\t\t\t\t$scope.expandnodes.push(data[i]);\r\n\t\t\t\t\t\tif(data[i][childName] && data[i][childName].length){\r\n\t\t\t\t\t\t\tvar len = iteration(data[i][childName],childName);\r\n\t\t\t\t\t\t\tif(len === 0){\r\n\t\t\t\t\t\t\t\tdata[i] = undefined;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(data[i][childName] && data[i][childName].length === 0){\r\n\t\t\t\t\t\t\tdata[i]= undefined;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(i = 0 ; i < data.length ; i++){\r\n\t\t\t\t\t\tif(data[i] === undefined){\r\n\t\t\t\t\t\t\tdata.splice(i,1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn data.length;\r\n\t\t\t\t}\r\n\t\t\t    function getAdminNum(rows){\r\n\t\t\t\t\treturn rows.reduce(function(count, item){\r\n\t\t\t\t\t\treturn count + item.desktop_num;\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.loading = true;\r\n\t\t\t\tTreeInstances.query(function(res){\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\tres.result.forEach(function(item){\r\n\t\t\t\t\t\tif(item.dept_name){\r\n\t\t\t\t\t\t\titem.name = item.dept_name;\r\n\t\t\t\t\t\t}else if(item.domain_name){\r\n\t\t\t\t\t\t\titem.name = item.domain_name;\r\n\t\t\t\t\t\t}else{}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$scope.expandnodes = [];\r\n\t\t\t\t\tvar adminData = res.result.filter(function(item){ return item.type == 'admin' });\r\n\t\t\t\t\tvar admins = [{name: $$$I18N.get(\"管理用户\"), type: 'adminAll', children: adminData, desktop_num: getAdminNum(adminData)}];\r\n\t\t\t\t\tvar domains = res.result.filter(function(item){ return item.type == 'domain' });\r\n\t\t\t\t\tvar commons = res.result.filter(function(item){ return item.type == 'common' });\r\n\t\t\t\t\tcommons = formatData(commons,\"children\",$scope.expandnodes);\r\n\t\t\t\t\tvar all = [{id: -1, name:$$$I18N.get(\"全部\"), children: admins.concat(commons).concat(domains)}];\r\n\t\t\t\t\t$scope.treedata = all;\r\n\t\t\t\t\t$scope.expandnodes = $scope.expandnodes.concat(admins).concat(adminData).concat(domains).concat(all);\r\n\t\t\t\t\t$scope.selected = $scope.expandnodes.filter(function(item){ return item.name==_controllerScope.depart.name; })[0];\r\n\t\t\t\t\t$scope.selected._selected = true;\r\n\t\t\t\t\t$scope.showSelected = function(node, selected){\r\n\t\t\t\t\t\tnode._selected = selected;\r\n\t\t\t\t\t\t$scope.selected = node;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t    _controllerScope.depart = $scope.selected && $scope.selected._selected?$scope.selected:{name: $$$I18N.get(\"全部\"), id: -1, full_path: 'root'};\r\n\t\t\t\t    _controllerScope.updateData(_controllerScope.searchText, _controllerScope.select, _controllerScope.depart)\r\n\t\t\t\t    $modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t $modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n         })\r\n    }\r\n    /**\r\n\t* [selectMode 部门域选择]_____end\r\n\t*/\r\n\t\r\n\r\n\r\n\t$scope.start = item => {\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'shutdown' || row.status == 'suspended') && !row.task_state; });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP1\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tvm.start({instance_ids: rows.map(row => \r\n\t\t\t\t{return row.instance_id})}, () => \r\n\t\t\t{$scope.refresh();});\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.forceShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\tvm.shutdowns({instance_ids: rows.map(row => {\r\n\t\t\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t\t\t\treturn row.instance_id;\r\n\t\t\t\t\t\t\t\t})},() => { _controllerScope.refresh()});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.natureShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP3\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.shutdowns({is_soft:'true',instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.restart = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP4\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>\"+\r\n\t\t\t\t\t\t\t\"桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.reboots({is_soft:'true',instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.pause = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'running' && !row.task_state; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP5\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>\"+ \r\n\t\t\t\t\t\t\"桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.pause({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t$scope.resume = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'paused' && !row.task_state; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP6\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>\"+\r\n\t\t\t\t\t\t\"桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.resume({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.hasPausedStatus = function(){\r\n\t\tvar flag = false;\r\n\t\tvar _selected = $scope.rows.filter(function(row){ return row._selected });\r\n\t\tvar _hasPaused = _selected.filter(function(row){ return row.status=='paused' });\r\n\t\tif(_hasPaused.length==_selected.length){\r\n\t\t\tflag = true;\r\n\t\t}\r\n\t\treturn flag;\r\n\t}\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status!=='paused' });\r\n\t\tvar is_running = rows.some(function(row){ return row.status == 'running' && !row.task_state});\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面删除'>\"+\r\n\t\t\t\t\t\"桌面删除</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-show='!is_run' style='margin-bottom:20px;' localize='桌面删除后无法恢复，确定删除桌面吗'>桌面删除后无法恢复，确定删除桌面吗?</p><p ng-show='is_run' style='margin-bottom:20px;' localize='存在未关机的桌面，仍然删除桌面吗'>存在未关机的桌面，仍然删除桌面吗?</p><div ng-show='has_data_disk' style='margin-bottom:20px;'><label class='checkbox-inline'><input class='checkbox' ng-model='delete_disk' type='checkbox'/><span  localize='删除数据盘'>删除数据盘</span></label></div><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.is_run = is_running;\r\n\t\t\t\t$scope.delete_disk = true;\r\n\t\t\t\t$scope.has_data_disk = rows.some(function(d){ return d.local_gb});\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tperson_desktop.delete({\r\n\t\t\t\t\t\tinstance_ids: rows.map(function(row){ return row.instance_id; }),\r\n\t\t\t\t\t\tforce_delete_data: this.delete_disk\r\n\t\t\t\t\t}, function(data){\r\n\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t}, function(error){\r\n\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\t\t\t\r\n\t};\r\n\t$scope.moveto = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected});\r\n\t\tvar can_migrate_rows = rows.filter(function(item){ return item.virtual_type === 'kvm' && item.status=='shutdown' && !item.task_state });\r\n\t\tif(!can_migrate_rows.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"DESKTOP_MOVE_TIP1\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tvar can_migrate_host = [];\r\n\t\t\t$scope.moveto_loading = true;\r\n\t\t\tperson_desktop.check_can_migrate_host({instance_ids:can_migrate_rows.map(function(item){ return item.id })},function(res){\r\n\t\t\t\tfor(var i in res.result){can_migrate_host.push({id:i,value:res.result[i]})};\r\n\t\t\t\tcan_migrate_host = can_migrate_host.filter(function(item){ return item.value });\r\n\t\t\t\t$scope.moveto_loading = false;\r\n\t\t\t\tif(!can_migrate_host.length){\r\n\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\tcontent:$$$I18N.get(\"DESKTOP_MOVE_TIP1\"),\r\n\t\t\t\t\t\ttimeout:6000\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \r\n\t\t\t\t\t\t`<section id='widget-grid'>\r\n\t\t\t\t\t\t\t<div class='modal-content'>\r\n\t\t\t\t\t\t\t\t<div class='modal-header'>\r\n\t\t\t\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button>\r\n\t\t\t\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='桌面移动'>桌面移动</h4>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class='modal-body'>\r\n\t\t\t\t\t\t\t\t\t<form class='form-horizontal' novalidate name='movetoForm'>\r\n\t\t\t\t\t\t\t\t\t\t<div class='form-group'>\r\n\t\t\t\t\t\t\t\t\t\t\t<label class='control-label col-xs-4' localize='选择目标主机'>选择目标主机</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class='col-xs-4'>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize=\"--请选择--\"> --请选择-- </option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\r\n\t\t\t\t\t\t\t\t\t\t<button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定' ng-disabled='movetoForm.$invalid'>确定</button>\r\n\t\t\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer>\r\n\t\t\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>`,\t\t\t\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.hosts = [];\r\n\t\t\t\t\t\t$scope.hosts_loading = true;\r\n\t\t\t\t\t\tperson_desktop.moveHostList({instance_ids:rows.map(function(item){ return item.id })}, function(res){\r\n\t\t\t\t\t\t\t$scope.hosts = res.result;\r\n\t\t\t\t\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\t\t\t\t\t$scope.hosts_loading = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\tvar _this = this;\r\n\t\t\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\t\t\tperson_desktop.moveTo({instance_ids:can_migrate_host.map(function(item){ return item.id }),host:_this.host},function(){\r\n\t\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\t\t\t\tcontent:$$$I18N.get(\"桌面移动成功\"),\r\n\t\t\t\t\t\t\t\t\ttimeout:6000\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"md\"\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}\r\n\t};\r\n\t$scope.migration = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status === 'running' && !row.task_state});\r\n\t\tif(!rows.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"DESKTOP_MOVE_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \r\n\t\t\t\t`<section id='widget-grid'>\r\n\t\t\t\t\t<div class='modal-content'>\r\n\t\t\t\t\t\t<div class='modal-header'>\r\n\t\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button>\r\n\t\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='动态迁移'></h4>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class='modal-body'>\r\n\t\t\t\t\t\t\t<form class='form-horizontal' novalidate name='movetoForm'>\r\n\t\t\t\t\t\t\t\t<div class='form-group'>\r\n\t\t\t\t\t\t\t\t\t<label class='control-label col-xs-4' localize='选择目标主机'>选择目标主机</label>\r\n\t\t\t\t\t\t\t\t\t\t<div class='col-xs-4'>\r\n\t\t\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize=\"--请选择--\">请选择</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\r\n\t\t\t\t\t\t\t\t\t\t<a style=\"position: relative;top: 5px;\" ng-if=\"!hosts_loading && !hosts.length\" class=\"mypopover\" htmlpopover='{{migrationTip}}'><i class=\"fa fa-question-circle\"></i></a>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<footer class='text-right'>\r\n\t\t\t\t\t\t\t\t\t\t<img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\r\n\t\t\t\t\t\t\t\t\t\t<button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定' ng-disabled='movetoForm.$invalid'>确定</button>\r\n\t\t\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button>\r\n\t\t\t\t\t\t\t\t\t</footer>\r\n\t\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</section>`,\t\t\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.hosts = [];\r\n\t\t\t\t$scope.hosts_loading = true;\r\n\t\t\t\t$scope.migrationTip = $$$I18N.get('migrationTip');\r\n\t\t\t\tvm.get_live_move_hosts({instance_ids:rows.map(function(item){ return item.id })}, function(res){\r\n\t\t\t\t\t$scope.hosts = res.result;\r\n\t\t\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\t\t\t$scope.hosts_loading = false;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tvar _this = this;\r\n\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\tvm.live_move({\r\n\t\t\t\t\t\tinstance_ids:rows.map(function(item){ return item.id }),\r\n\t\t\t\t\t\thost:_this.host\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\t\tcontent:$$$I18N.get(\"桌面迁移成功\"),\r\n\t\t\t\t\t\t\ttimeout:6000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"md\"\r\n\t\t});\r\n\t};\r\n\t$scope.view = function(item){\r\n\t\twindow.open(\"desktopScreenshot.html#\" + item.id, \"person_desktop_\" + item.id);\r\n\t};\r\n\t$scope.viewStorage = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/view_storage.html\",\r\n\t\t\tcontroller:['$scope','$modalInstance',function($scope,$modalInstance){\r\n\t\t\t\tperson_desktop.list_detail({id:item.id},function(res){\r\n\t\t\t\t\t$scope.data = res.result;\r\n\t\t\t\t\t$scope.data.hostname = item.hostname;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}],\r\n\t\t});\r\n\t};\r\n\t\r\n}])\r\n\r\n.controller(\"vdiDesktopTeachListController\", [\r\n\"$scope\", \"$route\",\"$modal\", \"$routeParams\", \"TeachDesktop\",\"PersonDesktop\", \"VMCommon\", \"$interval\", \"$filter\",\"$$$I18N\", \"UserRole\",\"$location\",\r\nfunction($scope, $route,$modal, $routeParams,teach_desktop,person_desktop, vm, $interval, $filter, $$$I18N, UserRole, $location){\r\n\tif($location.$$search.name)\r\n\t\t$scope.searchText = decodeURIComponent($location.$$search.name);\r\n\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\t$scope.rows = [];\r\n\t$scope.loading = true;\r\n\t$scope.refresh = getList;\r\n\t$interval(function(){\r\n\t\tvar filterSearch = $filter(\"filter\")($scope.rows || [], $scope.searchText);\r\n\t\tvar filterSearchPage = $filter(\"paging\")(filterSearch, $scope.currentPage, $scope.pagesize);\r\n\t\t$scope.$root && $scope.rows && $scope.$root.$broadcast(\"instanceIDS\", filterSearchPage.map(function(item){ return item.id }));\r\n\t}, 1000);\r\n\t$scope.$on(\"instancesRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(item.task_state){\r\n\t\t\t\titem.other_status = 'other';\r\n\t\t\t}else{\r\n\t\t\t\titem.other_status = 'certain';\r\n\t\t\t}\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t// $scope.updateData($scope.searchText, $scope.select);\r\n\t});\r\n\r\n\tvar _controllerScope = $scope;\r\n\tvar _id =  $route.current.params.id;\r\n\tfunction getList(){\r\n\t\tteach_desktop.query({ id : _id }, function(res){\r\n\t\t\tres.result.forEach(function(desk){\r\n\t\t\t\tif(desk.task_state){\r\n\t\t\t\t\tdesk.other_status = 'other';\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdesk.other_status = 'certain';\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t_controllerScope.rows = res.result.sort(function(a,b){\r\n\t\t\t\tvar _numa,_numb;\r\n\t\t\t\tvar get_num = function(tar){\r\n\t\t\t\t\tfor(var i = tar.length - 1 ; i-- ; i >= 0 ){\r\n\t\t\t\t\t\tif(!Number(tar[i])){\r\n\t\t\t\t\t\t\treturn Number(tar.substring(i + 1,tar.length));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t_numa = get_num( a.display_name );\r\n\t\t\t\t_numb = get_num( b.display_name );\r\n\t\t\t\treturn (_numa - _numb) * (false ? -1 : 1);\r\n\t\t\t});\r\n\t\t\t_controllerScope.allRows = res.result;\r\n\t\t\t_controllerScope.res = res;\r\n\t\t\t_controllerScope.loading = false;\r\n\t\t\t_controllerScope.$root && $scope.$root.$broadcast(\"navItemSelected\", [\"桌面\", \"教学桌面\", res.mode_name]);\r\n\t\t},function(error){ \r\n\t\t\tlocation.replace(\"#desktop/scene/\");\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent : $$$I18N.get(\"NOEXSIT_SECNE_TIP\"),\r\n\t\t\t\ttimeout : 6000\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tgetList();\r\n\t$scope.refresh = getList;\r\n\t$scope.pagesize = parseInt($$$storage.getSessionStorage('teach_pagesize')) || 30;\r\n\t$scope.currentPage = 1;\r\n\r\n\t$scope.$watch(\"pagesize\",function(newvalue){\r\n\t\tif(newvalue){\r\n\t\t\t$$$storage.setSessionStorage('teach_pagesize', newvalue);\r\n\t\t}\r\n\t});\r\n\t// $scope.$watch(\"select\",function(newvalue){\r\n\t// \tif(newvalue && $scope.allRows){\r\n\t// \t\t$scope.rows = $scope.allRows.filter(function(item){ return item.status == newvalue});\r\n\t// \t\t$$$storage.setSessionStorage('status', newvalue);\r\n\t// \t}\r\n\t// });\t\r\n\t$scope.updateData = function(text,select){\r\n\t\t$scope.rows = $scope.allRows.filter(function(row){\r\n\t\t\trow._selected = false;\r\n\t\t\tif(select){\r\n\t\t\t\tif(text && text.trim()){\r\n\t\t\t\t\treturn row.status === select || row.other_status === select;\r\n\t\t\t\t}\r\n\t\t\t\treturn row.status === select || row.other_status === select;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t};\r\n\t$scope.sortDesktopName = function(name,bool){\r\n\t\t$scope.rows.sort(function(a,b){\r\n\t\t\tvar _numa,_numb;\r\n\t\t\tvar get_num = function(tar){\r\n\t\t\t\tfor(var i = tar.length - 1 ; i-- ; i >= 0 ){\r\n\t\t\t\t\tif(!Number(tar[i])){\r\n\t\t\t\t\t\treturn Number(tar.substring(i + 1,tar.length));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t_numa = get_num( a[name] );\r\n\t\t\t_numb = get_num( b[name] );\r\n\t\t\treturn (_numa - _numb) * (bool ? -1 : 1);\r\n\t\t});\r\n\t};\r\n\t\r\n\t$scope.start = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'shutdown' || row.status == 'suspended') && !row.task_state; });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopTeachList_TIP1\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\trows.map(function(row){\r\n\t\t\t\trow._selected = false ;\r\n\t\t\t});\r\n\t\t\tvm.start({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t_controllerScope.refresh();\t\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.forceShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopTeachList_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvm.shutdowns({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.natureShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopTeachList_TIP3\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.shutdowns({is_soft:'true',instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.restart = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopTeachList_TIP4\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>\"+\r\n\t\t\t\t\t\t\t\"桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.reboots({is_soft:'true',instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.pause = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'running' && !row.task_state; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopTeachList_TIP5\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>\"+ \r\n\t\t\t\t\t\t\"桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.pause({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t$scope.resume = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'paused' && !row.task_state; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopTeachList_TIP6\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>\"+\r\n\t\t\t\t\t\t\"桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.resume({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.reset = function(item){\r\n\t\tvar row = item;\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重置'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定重置桌面吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tteach_desktop.reset({instance_id: row.instance_id}, function(data){\r\n\t\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\t\ttitle:$$$I18N.get(\"操作结果\"),\r\n\t\t\t\t\t\t\tcontent:$$$I18N.get(\"重置成功\"),\r\n\t\t\t\t\t\t\ttimeout:5000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\t\t\t\r\n\t};\r\n\t$scope.alter = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/teach_alter.html\",\r\n\t\t\tcontroller: function($scope,$modalInstance){\r\n\t\t\t\t$scope.vm_hostname = item.vm_hostname;\r\n\t\t\t\t$scope.post = function(){\r\n\t\t\t\t\tvar _this= this;\r\n\t\t\t\t\tteach_desktop.rename({\r\n\t\t\t\t\t\t'instance_ids':[item.id],\r\n\t\t\t\t\t\t'instance_name':_this.vm_hostname\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t_controllerScope.refresh();\t\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.dismiss();\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t});\r\n\t};\r\n\t$scope.rename = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(r){ return r._selected && r.status == \"shutdown\" && !r.task_state });\r\n\t\tif(rows.length){\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/teach_rename.html\",\r\n\t\t\t\tcontroller: function($scope,$modalInstance){\r\n\t\t\t\t\t$scope.addZero = function(len,str_begin,str_end){\r\n\t\t\t\t\t\tif(str_end && str_begin){\r\n\t\t\t\t\t\t\tvar end_len = str_end.toString().length;\r\n\t\t\t\t\t\t\tif(end_len < len){\r\n\t\t\t\t\t\t\t\treturn  str_begin + new Array(len - end_len+1).join(\"0\") + str_end;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\treturn str_begin + str_end;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\t\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tvar _this= this;\r\n\t\t\t\t\t\tteach_desktop.rename({\r\n\t\t\t\t\t\t\t'instance_ids' : rows.map(function(row){ return row.instance_id}),\r\n\t\t\t\t\t\t\t'hostname_type' : _this.hostNameType,\r\n\t\t\t\t\t\t\t'hostname_prefix' :_this.hostNamePre,\r\n\t\t\t\t\t\t\t'hostname_beginwith':_this.hostNameBegin\r\n\t\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\t\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.dismiss();\r\n\t\t\t\t\t};\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopTeachList_TIP7\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.view = function(item){\r\n\t\twindow.open(\"desktopScreenshot.html#\" + item.id, \"person_desktop_\" + item.id);\r\n\t};\r\n\t$scope.moveto = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected});\r\n\t\tvar can_migrate_rows = rows.filter(function(item){ return item.virtual_type === 'kvm' && item.status=='shutdown' && !item.task_state });\r\n\t\tif(!can_migrate_rows.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"DESKTOP_MOVE_TIP1\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tvar can_migrate_host = [];\r\n\t\t\t$scope.moveto_loading = true;\r\n\t\t\tperson_desktop.check_can_migrate_host({instance_ids:can_migrate_rows.map(function(item){ return item.id })},function(res){\r\n\t\t\t\tvar datas = [];\r\n\t\t\t\tfor(var i in res.result){can_migrate_host.push({id:i,value:res.result[i]})};\r\n\t\t\t\tcan_migrate_host = can_migrate_host.filter(function(item){ return item.value });\r\n\t\t\t\t$scope.moveto_loading = false;\r\n\t\t\t\tif(!can_migrate_host.length){\r\n\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\tcontent:$$$I18N.get(\"DESKTOP_MOVE_TIP1\"),\r\n\t\t\t\t\t\ttimeout:6000\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \r\n\t\t\t\t\t\t`<section id='widget-grid'>\r\n\t\t\t\t\t\t\t<div class='modal-content'>\r\n\t\t\t\t\t\t\t\t<div class='modal-header'>\r\n\t\t\t\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button>\r\n\t\t\t\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='桌面移动'>桌面移动</h4>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class='modal-body'>\r\n\t\t\t\t\t\t\t\t\t<form class='form-horizontal' name='movetoForm' novalidate>\r\n\t\t\t\t\t\t\t\t\t\t<div class='form-group'>\r\n\t\t\t\t\t\t\t\t\t\t\t<label class='control-label col-xs-4' localize='选择目标主机'>选择目标主机</label>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class='col-xs-4'>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize='--请选择--'></option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<footer class='text-right'>\r\n\t\t\t\t\t\t\t\t\t\t\t<img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\r\n\t\t\t\t\t\t\t\t\t\t\t<button class='btn btn-primary' data-ng-click='ok()' ng-if='!loading' localize='确定' ng-disabled='movetoForm.$invalid'>确定</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button>\r\n\t\t\t\t\t\t\t\t\t\t</footer>\r\n\t\t\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>`,\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.hosts = [];\r\n\t\t\t\t\t\t$scope.hosts_loading = true;\r\n\t\t\t\t\t\tperson_desktop.moveHostList({instance_ids:rows.map(function(item){ return item.id })}, function(res){\r\n\t\t\t\t\t\t\t$scope.hosts = res.result;\r\n\t\t\t\t\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\t\t\t\t\t$scope.hosts_loading = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\tvar _this = this;\r\n\t\t\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\t\t\tperson_desktop.moveTo({instance_ids:can_migrate_host.map(function(item){ return item.id }),host:_this.host},function(){\r\n\t\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\t\t\t\tcontent:$$$I18N.get(\"桌面移动成功\"),\r\n\t\t\t\t\t\t\t\t\ttimeout:6000\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"md\"\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}\r\n\t};\r\n\t$scope.migration = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status === 'running' && !row.task_state});\r\n\t\tif(!rows.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"DESKTOP_MOVE_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \r\n\t\t\t`<section id='widget-grid'>\r\n\t\t\t\t<div class='modal-content'>\r\n\t\t\t\t\t<div class='modal-header'>\r\n\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button>\r\n\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='动态迁移'></h4>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class='modal-body'>\r\n\t\t\t\t\t\t<form class='form-horizontal' novalidate name='movetoForm'>\r\n\t\t\t\t\t\t\t<div class='form-group'><label class='control-label col-xs-4' localize='选择目标主机'>选择目标主机</label>\r\n\t\t\t\t\t\t\t\t<div class='col-xs-4'>\r\n\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize=\"--请选择--\">请选择</option>\r\n\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\r\n\t\t\t\t\t\t\t\t<a style=\"position: relative;top: 5px;\" ng-if=\"!hosts_loading && !hosts.length\" class=\"mypopover\" htmlpopover='{{migrationTip}}'><i class=\"fa fa-question-circle\"></i></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<footer class='text-right'>\r\n\t\t\t\t\t\t\t\t<img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\r\n\t\t\t\t\t\t\t\t<button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定' ng-disabled='movetoForm.$invalid'>确定</button>\r\n\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button>\r\n\t\t\t\t\t\t\t</footer>\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</section>`,\t\t\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.hosts = [];\r\n\t\t\t\t$scope.hosts_loading = true;\r\n\t\t\t\t$scope.migrationTip = $$$I18N.get('migrationTip');\r\n\t\t\t\tvm.get_live_move_hosts({instance_ids:rows.map(function(item){ return item.id })}, function(res){\r\n\t\t\t\t\t$scope.hosts = res.result;\r\n\t\t\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\t\t\t$scope.hosts_loading = false;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tvar _this = this;\r\n\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\tvm.live_move({\r\n\t\t\t\t\t\tinstance_ids:rows.map(function(item){ return item.id }),\r\n\t\t\t\t\t\thost:_this.host\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\t\tcontent:$$$I18N.get(\"桌面迁移成功\"),\r\n\t\t\t\t\t\t\ttimeout:6000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"md\"\r\n\t\t});\r\n\t};\r\n\t$scope.viewStorage = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/view_storage.html\",\r\n\t\t\tcontroller:['$scope','$modalInstance',function($scope,$modalInstance){\r\n\t\t\t\t$scope.loading = true;\r\n\t\t\t\tperson_desktop.list_detail({id:item.id},function(res){\r\n\t\t\t\t\t$scope.data = res.result;\r\n\t\t\t\t\t$scope.data.hostname = item.hostname;\r\n\t\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}],\r\n\t\t});\r\n\t};\r\n}])\r\n\r\n.controller(\"vdiDesktopSceneListController\", [\r\n\"$scope\", \"$modal\", \"Scene\", \"$filter\", \"TeachTemplate\", \"SchoolRoom\", \"$$$I18N\", \"UserRole\", \"$interval\", \"$q\", \"Server\",\r\nfunction($scope, $modal, scene, $filter, template, SchoolRoom, $$$I18N, UserRole,$interval, $q, Server){\r\n\t$interval(function(){\r\n\t\t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"modeIDS\", $filter(\"paging\")($scope.rows, $scope.currentPage, $scope.pagesize).map(function(item){ return item.id }));\r\n\t}, 1000);\r\n\t$scope.$on(\"modesRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(item.status == 'updating' || item.status == 'making'){\r\n\t\t\t\titem._ignore = true;\r\n\t\t\t}else{\r\n\t\t\t\titem._ignore = false;\r\n\t\t\t}\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\tlet user = UserRole.currentUser;\r\n\tif(user === null){ return }\r\n\t$scope.loading = true;\r\n\t$scope.searchText = \"\";\r\n\t$scope.selectLoading = true;\r\n\t$scope.rows = [];\r\n\t$scope.allRows = [];\r\n\t$scope.refresh = getList;\r\n\t$scope.classrooms = [];\r\n\r\n\tvar _controllerScope = $scope;\r\n\tvar _loginPool =  user.pool;\r\n\tvar _loginClassroom = $$$storage.getSessionStorage('classroom');\r\n\r\n\t\r\n\r\n\tgetList();\r\n\t\r\n\tfunction getList(){\r\n\t\t$q.all([\r\n\t\t\tUserRole.refreshSession(),\r\n\t\t\tSchoolRoom.query().$promise,\r\n\t\t\tscene.query().$promise\r\n\t\t]).then(function(arr){\r\n\t\t\tvar userId = user.id;\r\n\t\t\tvar session = arr[0];\r\n\t\t\t// filter by user\r\n\t\t\tvar schoolrooms = arr[1].pools_.filter(function(item){\r\n\t\t\t\treturn item.user_ids.some(function(id){\r\n\t\t\t\t\treturn id === userId;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tvar ownedIds = session.user.pool;\r\n\t\t\t// filter by schoolroom id\r\n\t\t\tschoolrooms = schoolrooms.filter(function(item){\r\n\t\t\t\treturn ownedIds.indexOf(item.id) > -1;\r\n\t\t\t});\r\n\t\t\tvar cachedPoolId = $$$storage.getSessionStorage('scene_page_classroom') * 1 || null;\r\n\t\t\tif(cachedPoolId && ownedIds.indexOf(cachedPoolId) > -1 && !_controllerScope.select) {\r\n\t\t\t\t_controllerScope.select = cachedPoolId;\r\n\t\t\t}\r\n\t\t\t_controllerScope.classrooms = schoolrooms;\r\n\t\t\t// 处理场景数据\r\n\t\t\tvar sceneData = arr[2];\r\n\t\t\t// 2017-08-18: 根据时间降序\r\n\t\t\tsceneData.modes.sort(function(a,b){\r\n\t\t\t\treturn a.created_at > b.created_at ? -1 : 1;\r\n\t\t\t});\r\n\t\t\tsceneData.modes.forEach(function(item){\r\n\t\t\t\tif(item.status == 'updating' || item.status == 'making'){\r\n\t\t\t\t\titem._ignore = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem._ignore = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t_controllerScope.allRows = sceneData.modes;\r\n\t\t\t// 过滤当前教室对应场景\r\n\t\t\t_controllerScope.updateData(\"\", _controllerScope.select);\r\n\t\t}).finally(function(){\r\n\t\t\t_controllerScope.selectLoading = false;\r\n\t\t\t_controllerScope.loading = false;\r\n\t\t});\r\n\t}\r\n\t$scope.refresh = getList;\r\n\r\n\tfunction getRealTimeRows(){\r\n\t\tvar filterPages = $filter(\"paging\")($scope.rows, $scope.currentPage, $scope.pagesize);\r\n\t\tvar filterPagesAndSeatches = $filter(\"filter\")(filterPages, $scope.searchText);\r\n\t\treturn filterPagesAndSeatches;\r\n\t}\r\n\t$scope.getTotalCount = function(rows){\t\t\r\n\t\treturn getRealTimeRows().reduce(function(count, item){\r\n\t\t\treturn count + item.instances_count;\r\n\t\t}, 0);\r\n\t};\r\n\r\n\t$scope.getRunningCount = function(rows){\r\n\t\treturn getRealTimeRows().reduce(function(count, item){\r\n\t\t\treturn count + item.running_count;\r\n\t\t}, 0);\r\n\t};\r\n\r\n\t$scope.getShutdownCount = function(rows){\r\n\t\treturn getRealTimeRows().reduce(function(count, item){\r\n\t\t\treturn count + item.shutdown_count;\r\n\t\t}, 0);\r\n\t};\r\n\t$scope.getPausedCount = function(rows){\r\n\t\treturn getRealTimeRows().reduce(function(count, item){\r\n\t\t\treturn count + item.paused_count;\r\n\t\t}, 0);\r\n\t};\r\n\t$scope.getNostateCount = function(rows){\r\n\t\treturn getRealTimeRows().reduce(function(count, item){\r\n\t\t\treturn count + item.nostate_count;\r\n\t\t}, 0);\r\n\t};\r\n\t$scope.getErrorCount = function(rows){\r\n\t\treturn getRealTimeRows().reduce(function(count, item){\r\n\t\t\treturn count + item.error_count;\r\n\t\t}, 0);\r\n\t};\r\n\t$scope.getOtherCount = function(rows){\r\n\t\treturn getRealTimeRows().reduce(function(count, item){\r\n\t\t\treturn count + item.other_count;\r\n\t\t}, 0);\r\n\t};\r\n\r\n\t$scope.cacheValue = function(v){\r\n\t\t$$$storage.setSessionStorage('scene_page_classroom', v);\r\n\t};\r\n\r\n\t$scope.updateData = function(text,pid){\r\n\t\tif(pid){\r\n\t\t\t$scope.rows = $scope.allRows.filter(function(row){ return row.pool === pid; })\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar _rows = [];\r\n\t\t\t$scope.allRows.forEach(function(item){\r\n\t\t\t\tvar isInClassrooms = _controllerScope.classrooms.filter(function(room){ return room.id === item.pool }).length;\r\n\t\t\t\tif(isInClassrooms){\r\n\t\t\t\t\t_rows.push(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$scope.rows = _rows;\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.pagesize = parseInt($$$storage.getSessionStorage('scene_pagesize')) || 30;\r\n\t$scope.currentPage = 1;\r\n\r\n\t$scope.$watch(\"pagesize\", function(newvalue){\r\n\t\tnewvalue && ($$$storage.setSessionStorage('scene_pagesize', newvalue))\r\n\t});\r\n\r\n\t$scope.openAddDomainDialog = function(item){\r\n\t\tvar modal = $modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/add_server.html\",\r\n\t\t\tcontroller:\"sceneAddServerDialog\",\r\n\t\t\tresolve:{param:function(){return angular.copy(item);}}\r\n\t\t});\r\n\t\tmodal.result.then(function(res){\r\n\t\t\tgetList();\r\n\t\t});\r\n\t};\r\n\t$scope.sceneExitServerDialog = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='退域'>\"+\r\n\t\t\t\t\t\"退域</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='DOMAIN_EXIT_TIP2'>该场景下的所有桌面在下一次开机时，将自动执行退域的操作，是否确定？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tServer.domain_set_scene({\r\n\t\t\t\t\t\tid:item.id,\r\n\t\t\t\t\t\thas_domain:false\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.start = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.shutdown_count <= row.instances_count && row.status!==\"making\" && row.status!==\"updating\" && row.status!==\"setting-recoverable\" && row.status!=='recovering'});\r\n\t\tvar flag = rows.some((it)=> it.shutdown_count>0);\r\n\t\tif(rows.length && !flag){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent : $$$I18N.get(\"vdiDesktopPersonalList_TIP1\"),\r\n\t\t\t\ttimeout : 6000\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tscene.powerOn({ids : rows.map(function(row){return row.id }),action : \"power-on\"},function(){\r\n\t\t\t// rows.forEach(function(row){\r\n\t\t\t\t// row.running_count = row.instances_count;\r\n\t\t\t\t// row._selected = false;\r\n\t\t\t// });\r\n\t\t});\r\n\t};\r\n\t$scope.forceShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.running_count > 0 && row.status!==\"updating\" && row.status!==\"setting-recoverable\"; })\r\n\t\tif(rows.length == 0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent : $$$I18N.get(\"vdiDesktopPersonalList_TIP2\"),\r\n\t\t\t\ttimeout : 6000\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>\"+\r\n\t\t\t\t\t\"桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定强制关闭场景吗'>确定强制关闭场景吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tscene.forcePowerOff({ids : rows.map(function(row){return row.id }),\r\n                        action : \"force-power-off\"}, function(){\r\n\t\t\t           \trows.forEach(function(row){\r\n\t\t\t\t\t\t\trow.running_count = 0;\r\n\t\t\t\t\t\t\t// row._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t        });  \r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.natureShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.running_count > 0 && row.status!==\"updating\" && row.status!==\"setting-recoverable\"; })\r\n\t\tif(rows.length == 0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent : $$$I18N.get(\"vdiDesktopPersonalList_TIP3\"),\r\n\t\t\t\ttimeout : 6000\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>\"+\r\n\t\t\t\t\t\"桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭场景吗'>确定自然关闭场景吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t        $modalInstance.close();\r\n\t\t\t\t\tscene.powerOff({ids : rows.map(function(row){return row.id }), action : \"power-off\"}, function(){\r\n                    \trows.forEach(function(row){\r\n\t\t\t\t\t\t\trow.running_count = 0;\r\n\t\t\t\t\t\t\t// row._selected = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t        })\t\t\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.active = function(id,event){\r\n\t\tvar _this = this;\r\n\t\t\r\n\t\tif(_this.item.active){\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='取消场景激活'>\"+\r\n\t\t\t\t\t\t\"取消场景激活</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='SCENE_CANCEL_COMFIRM'>取消激活该场景会同时关闭该场景内的所有桌面，是否确定?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t        $modalInstance.close();\r\n\t\t\t\t        _this.item.active_loadding= true;\r\n\t\t\t\t       \tscene.active({id :id},function(res){\r\n\t\t\t\t\t\t\t_this.item.active = _this.item.active ? false : true;\r\n\t\t\t\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t\t\t\t_this.item.active_loadding= false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t_this.item.active_loadding= true;\r\n\t\t\tscene.active({id :id},function(res){\r\n\t\t\t\t_this.item.active = _this.item.active ? false : true;\r\n\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t_this.item.active_loadding= false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.sortScene = function(){\r\n\t\tvar modal = $modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/scene_sort.html\",\r\n\t\t\tcontroller:\"sortSceneDialog\",\r\n\t\t\tresolve:{param:function(){\r\n\t\t\t\treturn {scenes:angular.copy(_controllerScope.rows),schoolroom:angular.copy(_controllerScope.select)}\r\n\t\t\t}}\r\n\t\t});\r\n\t\tmodal.result.then(function(res){\r\n\t\t\tgetList();\r\n\t\t});\r\n\t};\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && !(row.active); });\r\n\t\tvar has_running = rows.some(function(row){ return row.running_count});\r\n\t\tvar has_active = $scope.rows.some(function(row){ return row._selected && row.active; });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent : $$$I18N.get(\"vdiDesktopSceneList_TIP1\"),\r\n\t\t\t\ttimeout : 6000\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif(has_active) {\r\n\t\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent : $$$I18N.get(\"只有未激活状态下的场景才能被删除\"),\r\n\t\t\t\t\ttimeout : 6000\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'>\"\r\n\t\t\t\t\t\t+ \" <div class='modal-content'>\"\r\n\t\t\t\t\t\t+ \"  <div class='modal-header'>\"\r\n\t\t\t\t\t\t+ \"   <button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button>\"\r\n\t\t\t\t\t\t+ \"   <h4 class='modal-title' id='mySmallModalLabel' localize='删除场景'></h4>\"\r\n\t\t\t\t\t\t+ \"  </div>\"\r\n\t\t\t\t\t\t+ \"  <div class='modal-body'>\"\r\n\t\t\t\t\t\t+ \"   <form class='form-horizontal'>\"\r\n\t\t\t\t\t\t+ \"    <p ng-show='has_run' style='margin-bottom:10px;' localize='存在未关机的桌面,仍然删除场景吗'></p>\"\r\n\t\t\t\t\t\t+ \"    <p ng-show='!has_run' style='margin-bottom:10px;' localize='删除场景无法恢复，确定删除场景吗'></p>\"\r\n\t\t\t\t\t\t+ \"    <footer class='text-right'>\"\r\n\t\t\t\t\t\t+ \"     <button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button>\"\r\n\t\t\t\t\t\t+ \"     <button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button>\"\r\n\t\t\t\t\t\t+ \"    </footer>\"\r\n\t\t\t\t\t\t+ \"   </form>\"\r\n\t\t\t\t\t\t+ \"  </div>\"\r\n\t\t\t\t\t\t+ \" </div>\"\r\n\t\t\t\t\t\t+ \"</section>\",\r\n\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.has_active = has_active;\r\n\t\t\t\t\t$scope.has_run =  has_running;\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\tscene.delete({ids : rows.map(function(row){return row.id }), action : \"delete\"}, function(){\r\n\t\t\t\t\t\t\tgetList();\r\n\t\t\t\t        })\t\t\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.restartScene = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.running_count > 0 && row.status!==\"making\" && row.status!==\"updating\" && row.status!==\"setting-recoverable\" && row.status!=='recovering'});\r\n\t\tif(!rows.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent : $$$I18N.get(\"vdiDesktopPersonalList_TIP7\"),\r\n\t\t\t\ttimeout : 6000\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>\"+\r\n\t\t\t\t\t\t\"场景桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启场景下的桌面吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tscene.reboots({ids: rows.map(function(row){ return row.id; })},function(){\r\n\t\t\t\t\t\tgetList();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n}])\r\n\r\n.controller(\"newSceneDialog\", [\"$scope\", \"$modalInstance\", \"Host\", \"Scene\", \"SchoolRoom\", \"Network\", \"TeachTemplate\", \"HardwareTemplate\",\"TeachDesktop\",\"Server\",\"$$$I18N\",\"$$$MSG\", \"UserRole\",\"$filter\",\"ResourcePool\",\"$modal\",\"VMCommon\",\"PersonDesktop\",\r\n\tfunction($scope, $modalInstance, host, scene, schoolroom, net, teach, hardwares,list,server,$$$I18N,$$$MSG, UserRole,$filter,ResourcePool,$modal,vm, PersonDesktop){\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\r\n\t$scope.regXP = /WindowsXP|WindowsXP_64/;\r\n\t$scope.reg = /windows\\s*(7|8|10)/i;\r\n\t$scope.regWin = /Windows/;\r\n\t// 第一步\r\n\t$scope.step1 = {};\r\n\t$scope.classrooms = angular.copy($scope.$parent.classrooms);\r\n\t$scope.step1.classroom = $scope.classrooms[0];\r\n\t\r\n\tserver.query(function(data){\r\n\t\t$scope.domains = data.servers;\r\n\t});\r\n\r\n\tResourcePool.query(function(res){\r\n\t\t$scope.resources = res.result.filter(function(item){ return item.hosts.length > 0});\r\n\t\t$scope.step1.resource = $scope.resources[0];\r\n\t\t$scope.resource_update();\r\n\t});\r\n\t$scope.resource_update = function(){\r\n\t\t$scope.get_teach_template();\r\n\t};\r\n\r\n\t$scope.get_teach_template = function(){\r\n\t\t$scope.allImages = [];\r\n\t\t$scope.templateNum = undefined;\r\n\t\t$scope.step1.image = undefined;\r\n\t\t$scope.loading_template = true;\r\n\t\tvm.list_template({type:1,virtual_type:$scope.step1.resource.type,rbd_enabled:$scope.step1.resource.rbd_enabled}, function(data){\r\n\t\t\t$scope.loading_template = false;\r\n\t\t\t$scope.winTable = data.win_images\r\n\t\t\t\t.filter(function(item){ return item.status == \"alive\" });\r\n\t\t\t$scope.linTable = data.linux_images\r\n\t\t\t\t.filter(function(item){ return item.status == \"alive\" });\r\n\t\t\t$scope.otherTable = data.other_images\r\n\t\t\t\t.filter(function(item){ return item.status == \"alive\" });\r\n\t\t\t$scope.image = $scope.winTable[0];\r\n\t\t\t$scope.allImages = $scope.winTable.concat($scope.linTable).concat($scope.otherTable);\r\n\t\t\t$scope.templateNum = $scope.allImages.length;\r\n\t\t\t$scope.step1.image = $scope.allImages[0];\r\n\t\t});\r\n\t};\r\n\t// 第二步\r\n\t$scope.step2 = {};\r\n\t$scope.step2.loading_server = true;\r\n\tPersonDesktop.share_servers(function(res){\r\n\t\t$scope.step2.loading_server = false;\r\n\t\tvar servers = [];\r\n\t\tres.servers.forEach(function(server){\r\n\t\t\tserver.nets.forEach(function(net){\r\n\t\t\t\tservers.push({id: server.id, net: {ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id}})\r\n\t\t\t})\r\n\t\t});\r\n\t\t$scope.share_servers = servers;\r\n\t\t$scope.step2.share_server = $scope.share_servers[0];\r\n\t})\r\n\t$scope.updateHardware = function(){\r\n\t\tvar is_win7UP = $scope.reg.test($scope.step1.image.os_type);\r\n\t\tvar is_winXP = $scope.regXP.test($scope.step1.image.os_type);\r\n\t\tvar is_win = $scope.regWin.test($scope.step1.image.os_type);\r\n\t\t$scope.step2.usb_version = \"2.0\";\r\n\t\tif(is_win7UP){\r\n\t\t\t$scope.step2.usb_redir = true;\r\n\t\t\t$scope.step2.usb_version = \"3.0\";\r\n\t\t}else if(is_winXP){\r\n\t\t\t$scope.step2.usb_redir = true;\r\n\t\t}else{\r\n\t\t\t// $scope.step2.usb_redir = false;\r\n\t\t}\r\n\t\t$scope.step2.usb3_disabled = !is_win7UP ? true : false;\r\n\t\t$scope.step2.isWin = is_win;\r\n\t}\r\n\t// 第三步\r\n\t$scope.step3 = {};\r\n\t$scope.step3.desktopNum2 = 0;\r\n\t$scope.get_host = function(){\r\n\t\t$scope.hosts = undefined;\r\n\t\t$scope.loading_host = true;\r\n\t\t$scope.step3.is_all = undefined;\r\n\t\t$scope.step3.desktopNum = undefined;\r\n\t\t// $scope.bodyForm3.$setPristine();\r\n\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\thost.query_gpu_agent({\r\n\t\t\t\tid: $scope.step1.resource.id,\r\n\t\t\t\tnetwork_id: $scope.step1.classroom.network_id,\r\n\t\t\t\tenable_gpu: $scope.step2.has_gpu\r\n\t\t\t},function(data){\r\n\t\t\t\t$scope.hosts = data.hosts_list.map(function(item){\r\n\t\t\t\t\tif(item.disabled_tips !== ''){\r\n\t\t\t\t\t\titem.disabled_desc = $$$I18N.get(item.disabled_tips);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t});\r\n\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t$scope.loading_host = false;\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\thost.query_agent({\r\n\t\t\t\tid: $scope.step1.resource.id,\r\n\t\t\t\tnetwork_id: $scope.step1.classroom.network_id,\r\n\t\t\t\tenable_gpu: $scope.step2.gpu_auto_assignment\r\n\t\t\t},function(data){\r\n\t\t\t\t$scope.hosts = data.hosts_list.filter(function(h){ return h.status === 'active'});\r\n\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t$scope.loading_host = false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\tvar host_storages = {};\r\n\t$scope.openMoreDialog = function(){\r\n\t\tvar _hostids = $scope.hosts.filter(function(h){ return h._selected}).map(function(h){ return h.storage_uuid });\r\n\t\tvar moreDialog = $modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/host_config.html\",\r\n\t\t\tcontroller:\"hostConfigDialog\",\r\n\t\t\tresolve:{param:function(){return {\r\n\t\t\t\t\"phostids\":angular.copy(_hostids),\r\n\t\t\t\t\"pstore\":host_storages\r\n\t\t\t}}}\r\n\t\t});\r\n\t};\r\n\t// 第四步\r\n\t$scope.step4 = {};\r\n\t$scope.selectAllHost = function(bool){\r\n\t\tvar _hosts = $scope.hosts.filter(function(h){\r\n\t\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\t\treturn h.disabled_tips=='';\r\n\t\t\t}else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t_hosts.map(function(item){\r\n\t\t\titem._selected = bool;\r\n\t\t\treturn item;\r\n\t\t});\r\n\t\tvar num = $filter(\"selectedFilter\")(_hosts,'max_instance');\r\n\t\t$scope.step3.desktopNum = $scope.step2.has_gpu==\"through\"?num:0;\r\n\t};\r\n\t$scope.selectOneHost = function(){\r\n\t\tvar _hosts = $scope.hosts.filter(function(h){\r\n\t\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\t\treturn h.disabled_tips=='';\r\n\t\t\t}else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.step3.is_all = _hosts.every(function(item){\r\n\t\t\treturn item._selected === true;\r\n\t\t});\r\n\t\tvar num = $filter(\"selectedFilter\")(_hosts,'max_instance');\r\n\t\t$scope.step3.desktopNum = $scope.step2.has_gpu==\"through\"?num:0;\r\n\t};\r\n\t$scope.getDesktopNumber2 = function(){\r\n\t\tvar _lis = angular.copy($scope.hosts.filter(function(item){ return item.instance_num > 0 }));\r\n\t\tif(_lis.length > 0){\r\n\t\t\t$scope.step3.desktopNum2 = _lis.reduce(function(a,b){\r\n\t\t\t\ta.instance_num += b.instance_num;\r\n\t\t\t\treturn a;\r\n\t\t\t}).instance_num;\r\n\t\t}else{\r\n\t\t\t$scope.step3.desktopNum2 = 0;\r\n\t\t}\r\n\t};\r\n\t\r\n\t$scope.clearRDP = function(scope){\r\n\t\tscope.RDP = false;\r\n\t\t$scope.userNameType = 1;\r\n\t\t$scope.userNamePre = \"K\";\r\n\t\t$scope.userNameBegin = 1;\r\n\t};\r\n\t$scope.clearDomain = function(scope){\r\n\t\tif(scope.has_domain){\r\n\t\t\tscope.domain = $scope.domains[0];\r\n\t\t}else{\r\n\t\t\tscope.domain = null;\r\n\t\t}\r\n\t};\r\n\t$scope.addZero = function(len,str_begin,str_end){\r\n\t\tif(str_end && str_begin){\r\n\t\t\tvar end_len = str_end.toString().length;\r\n\t\t\tif(end_len < len){\r\n\t\t\t\treturn  str_begin + new Array(len - end_len+1).join(\"0\") + str_end;\r\n\t\t\t}else{\r\n\t\t\t\treturn str_begin + str_end;\r\n\t\t\t}\r\n\t\t}\r\n\t};\t\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\tsetTimeout(function(){\r\n\t\t\t$(\"[rel=popover-hover]\").popover({\r\n\t\t\t\ttrigger : \"hover\"\r\n\t\t\t});\r\n\t\t})\r\n\t\tvar sameSceneName = $scope.rows.filter(function(item){return item.name == $scope.step1.sceneName}).length;\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = scope.bodyForm1.$valid && !sameSceneName;\r\n\t\tif(sameSceneName){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"SAME_SCENE_NAME\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(step.done && !sameSceneName){\r\n\t\t\thardwares.filter({\r\n\t\t\t\t\"system_gb\": $scope.step1.image.system_alloc_disk,\r\n\t\t\t\t\"local_gb\": $scope.step1.image.data_alloc_disk,\r\n\t\t\t\t\"local_gb1\": $scope.step1.image.data_alloc_disk_2,\r\n\t\t\t},function(data){\r\n\t\t\t\t$scope.hardwareList = data.result.map(function(data){\r\n\t\t\t\t\tdata.memory_mb = data.memory_mb/1024;\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.step2.hardware = $scope.hardwareList[0];\r\n\t\t\t\t$scope.updateHardware();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\t$scope.get_host();\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = scope.bodyForm2.$valid;\r\n\t});\r\n\t$scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n\t\tif($scope.step1.resource.type =='hyper-v'){\r\n\t\t\t$scope.step4.MORE = true;\r\n\t\t\t$scope.step4.RDP = true;\r\n\t\t}else{\r\n\t\t\t$scope.step4.MORE = false;\r\n\t\t\t$scope.step4.RDP = false;\r\n\t\t}\r\n\t\tscope.error = step.is_dirty;\r\n\t\tif($scope.step3.hostType == 0){\r\n\t\t\tstep.done = scope.bodyForm3.$valid && $scope.step3.desktopNum <= $filter(\"selectedFilter\")($scope.hosts,'max_instance');\r\n\t\t}\r\n\t\tif($scope.step3.hostType==1){\r\n\t\t\tstep.done = scope.bodyForm3.$valid && Boolean($scope.step3.desktopNum2);\r\n\t\t}\r\n\t});\r\n\t$scope.$on(\"WizardStep_3\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = scope.bodyForm4.$valid;\r\n\t});\r\n\t$scope.$on(\"WizardDone\", function(e, steps, scopes){\r\n\t\tvar regWin10 = /Windows10/;\r\n\t\tvar postData = {};\r\n\t\tpostData.name          = $scope.step1.sceneName;\r\n\t\tpostData.image_id      = $scope.step1.image.id;\r\n\t\tpostData.pool          = $scope.step1.classroom.id;\r\n\t\tpostData.resource_pool_uuid  = $scope.step1.resource.uuid;\r\n\t\tif($scope.step1.domain){\r\n\t\t\tpostData.domain          = $scope.step1.domain.id;}\r\n\t\tif($scope.step1.resource.type === \"hyper-v\")\r\n\t\t\tpostData.enable_gpu      = $scope.step2.has_gpu;\r\n\t\tif($scope.step1.resource.type === \"kvm\"){\r\n\t\t\tpostData.gpu_auto_assignment = $scope.step2.gpu_auto_assignment;\r\n\t\t\tif(regWin10.test($scope.step1.image.os_type)){\r\n\t\t\t\tpostData.firmware_type = 'uefi';\r\n\t\t\t}\r\n\t\t}\r\n\t\tpostData.instance_type       = $scope.step2.hardware.id;\r\n\t\tpostData.usb_redir    = $scope.step2.usb_redir;\r\n\t\tpostData.usb_version  = ($scope.step2.usb_redir && $scope.step1.resource.type=='kvm') ? $scope.step2.usb_version : null;\r\n\t\tpostData.rollback      = Number($scope.step2.rollback);\r\n\t\tpostData.data_rollback = $scope.step2.hardware.local_gb>1 ? Number($scope.step2.data_rollback) : undefined;\r\n\t\tif(postData.rollback === 2){\r\n\t\t\tpostData.rollback_weekday = $scope.step2.rollback_weekday;}\r\n\t\tif(postData.rollback === 3){\r\n\t\t\tpostData.rollback_monthday = $scope.step2.rollback_monthday;}\r\n\t\tif(postData.data_rollback === 2){\r\n\t\t\tpostData.data_rollback_weekday = $scope.step2.data_rollback_weekday;}\r\n\t\tif(postData.data_rollback === 3){\r\n\t\t\tpostData.data_rollback_monthday = $scope.step2.data_rollback_monthday;}\r\n\t\t\r\n\t\tif($scope.step3.hostType == 0){\r\n\t\t\tpostData.servers = $scope.hosts.filter(function(item){ return item._selected }).map(function(item){\r\n\t\t\t\treturn {\"uuid\": item.id}\r\n\t\t\t});\r\n\t\t\tpostData.instance_max = $scope.step3.desktopNum;\r\n\t\t}\r\n\t\tif($scope.step3.hostType == 1){\r\n\t\t\tpostData.servers = $scope.hosts.filter(function(item){ return item.instance_num > 0 }).map(function(item){\r\n\t\t\t\treturn { \"uuid\":item.id,\"vm_count\":item.instance_num }\r\n\t\t\t});\r\n\t\t\tpostData.instance_max = $scope.step3.desktopNum2;\r\n\t\t}\r\n\t\tpostData.servers_storage = Object.keys(host_storages).map(function(key){\r\n\t\t\tvar host = host_storages[key];\r\n\t\t\treturn {\r\n\t\t\t\tuuid:host.id,\r\n\t\t\t\timage_storage_capacity: host.image_storage_capacity,\r\n\t\t\t\timage_storage_performance: host.image_storage_performance,\r\n\t\t\t\tstorage_capacity: host.storage_capacity,\r\n\t\t\t\tstorage_performance: host.storage_performance\r\n\t\t\t}\r\n\t\t});\r\n\t\tpostData.hostname_type      = Number($scope.step4.hostNameType);\r\n\t\tpostData.hostname_prefix    = $scope.step4.hostNamePre;\r\n\t\tpostData.hostname_beginwith = $scope.step4.hostNameBegin;\r\n\t\tif($scope.step1.resource.type === \"kvm\"){\r\n\t\t\tpostData.is_exam \t\t\t= $scope.step4.RDP;\r\n\t\t\tif($scope.step4.MORE){\r\n\t\t\t\tpostData.username_type         = $scope.step4.userNameType;\r\n\t\t\t\tpostData.username_prefix       = $scope.step4.userNamePre;\r\n\t\t\t\tpostData.username_beginwith    = $scope.step4.userNameBegin;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif($scope.step1.resource.type === \"hyper-v\"){\r\n\t\t\tpostData.is_exam \t\t\t= true;\r\n\t\t}\r\n\t\tpostData.enable_share = $scope.step2.enable_share;\r\n\t\tif($scope.step2.enable_share){\r\n\t\t\tpostData.share_server_ip = $scope.step2.share_server.net.ip_address;\r\n\t\t\tpostData.share_server_id = $scope.step2.share_server.id;\r\n\t\t}\r\n\t\tpostData.expand_enabled = $scope.step2.expand_enabled;\r\n\t\t$scope.submitting = true; \r\n\t\tscene.save(postData,function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t\t$scope.refresh();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.submitting = false;\r\n\t\t});\r\n\t\t\r\n\t});\r\n}])\r\n.controller(\"alterSceneDialog\", [\"$scope\", \"$modalInstance\", \"SchoolRoom\", \"Scene\",\"Host\",\"Server\", \"PersonDesktop\",function($scope, $modalInstance, schoolroom, scene,host,server,personDesktop){\r\n\t$scope.need_ha = false;\r\n\tvar selectedServer,raw_need_ha;\r\n\t$scope.rollbackChange = function(value){\r\n\t\tif(value != \"1\"){\r\n\t\t\t$scope.need_ha = false;\r\n\t\t}else{\r\n\t\t\tif(selectedServer&&selectedServer.length>0){\r\n\t\t\t\t$scope.need_ha = angular.copy(raw_need_ha);\r\n\t\t\t\t$scope.servers = selectedServer;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t$scope.name = $scope.currentItem.name;\r\n\t$scope.desktopNum = $scope.currentItem.instance_max ;\r\n\t$scope.min_instances = $scope.currentItem.instance_max;\r\n\t$scope.rollback = $scope.currentItem.rollback;\r\n\t$scope.rollback_monthday = $scope.currentItem.rollback_monthday ? $scope.currentItem.rollback_monthday : \"1\";\r\n\t$scope.rollback_weekday = $scope.currentItem.rollback_weekday ? $scope.currentItem.rollback_weekday :\"1\";\r\n\r\n\t$scope.disk_type = $scope.currentItem.disk_type;\r\n\t$scope.local_gb = $scope.currentItem.local_gb;\r\n\t$scope.data_rollback = $scope.currentItem.data_rollback;\r\n\t$scope.data_rollback_monthday = $scope.currentItem.data_rollback_monthday || \"1\";\r\n\t$scope.data_rollback_weekday = $scope.currentItem.data_rollback_weekday || \"1\";\r\n\r\n\t$scope.usb_redir = $scope.currentItem.usb_redir;\r\n\t$scope.usb3_disabled = !$scope.currentItem.usb3_editable;\r\n\t$scope.usb_version = $scope.currentItem.usb_version || \"2.0\";\r\n\r\n\t$scope.running_count = $scope.currentItem.running_count;\r\n\t$scope.has_domain=$scope.currentItem.has_domain||false;\r\n\t$scope.domain = $scope.currentItem.domain;\r\n\t$scope.need_ha = false;\r\n\t// $scope.enable_gpu = $scope.currentItem.enable_gpu;\r\n\t$scope.enable_share = $scope.currentItem.enable_share;\r\n\t$scope.share_server_ip = $scope.currentItem.share_server_ip;\r\n\t$scope.loading_server = true;\r\n\tpersonDesktop.share_servers(function(res){\r\n\t\t$scope.loading_server = false;\r\n\t\tvar servers = [];\r\n\t\tres.servers.forEach(function(server){\r\n\t\t\tserver.nets.forEach(function(net){\r\n\t\t\t\tservers.push({id: server.id, net: {ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id}})\r\n\t\t\t})\r\n\t\t});\r\n\t\t$scope.share_servers = servers;\r\n\t\tif($scope.enable_share){\r\n\t\t\t$scope.share_server = $scope.share_servers.filter(function(item){ return item.net.ip_address==$scope.share_server_ip })[0]\r\n\t\t}else{\r\n\t\t\t$scope.share_server = $scope.share_servers[0];\r\n\t\t}\r\n\t})\r\n\t$scope.is_windows = $scope.currentItem.is_windows;\r\n\t$scope.expand_enabled = $scope.currentItem.expand_enabled;\r\n\t$scope.ok = function(){\r\n\t\tvar _rollback = parseInt(this.rollback);\r\n\t\tvar _data_rollback = parseInt(this.data_rollback) >= 0 ? Number(this.data_rollback) : undefined;\r\n\t\tvar item = {};\r\n\t\titem.id = $scope.currentItem.id;\r\n\t\titem.pool = $scope.currentItem.pool;\r\n\t\titem.name = this.name;\r\n\t\titem.instance_max          = $scope.currentItem.instance_max;\r\n\t\titem.rollback              = _rollback;\r\n\t\titem.rollback_monthday \t   = _rollback == 3 ? this.rollback_monthday : undefined;\r\n\t\titem.rollback_weekday      = _rollback == 2 ? this.rollback_weekday : undefined;\r\n\t\titem.data_rollback         = _data_rollback;\r\n\t\titem.data_rollback_monthday= _data_rollback === 3 ? this.data_rollback_monthday : undefined;\r\n\t\titem.data_rollback_weekday = _data_rollback === 2 ? this.data_rollback_weekday : undefined;\r\n\t\titem.usb_redir \t\t\t   = this.usb_redir;\r\n\t\titem.usb_version  \t\t   = (item.usb_redir && $scope.currentItem.virtual_type=='kvm') ? this.usb_version : null;\r\n\t\titem.has_domain            = this.has_domain;\r\n\t\t// if($scope.currentItem.virtual_type === 'hyper-v')\r\n\t\t// \titem.enable_gpu\t\t\t   = this.enable_gpu;\r\n\t\titem.domain                = this.domain;\r\n\t\titem.need_ha               = item.rollback==1 &&  this.need_ha;\r\n\t\titem.enable_share = this.enable_share;\r\n\t\titem.share_server_ip = this.enable_share?this.share_server.net.ip_address:undefined;\r\n\t\titem.share_server_id = this.enable_share?this.share_server.id:undefined;\r\n\t\titem.expand_enabled = this.expand_enabled;\r\n\t\tif(item.rollback ==1 && item.need_ha){\r\n\t\t\titem.server_ids = $scope.servers.filter(function(value){\r\n\t\t\t\treturn value._selected;\r\n\t\t\t}).map(function(value){\r\n\t\t\t\treturn value.id;\r\n\t\t\t});\r\n\t\t\tif(item.server_ids<1){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\titem.server_ids = item.server_ids.join(',');\r\n\t\t}\r\n\t\t$scope.loading = true;\r\n\t\tscene.update(item, function(){\r\n\t\t\t$modalInstance.close();\r\n\t\t\t$scope.refresh();\r\n\t\t},function(){\r\n\t\t\t$scope.refresh();\r\n\t\t}).$promise.finally(res => {\r\n\t\t\t$scope.loading = false;\r\n\t\t});\t\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller('sortSceneDialog', ['$scope','param','$modalInstance','Scene', function($scope,param,$modalInstance,Scene){\r\n\r\n\t$scope.schoolroom = param.schoolroom;\r\n\t$scope.scenes = param.scenes;\r\n\t$scope.auto_scene = $scope.scenes.filter(function(s){ return s.is_auto })[0];\r\n\t// $scope.is_auto_enter = $scope.auto_scene ? true: false;\r\n\tfunction move(num){\r\n\t\tvar cur = $scope.scenes.filter(function(item){ return item._actived })[0];\r\n\t\tvar cur_idx = $scope.scenes.indexOf(cur);\r\n\t\tvar pre_idx = null;\r\n\t\tif(cur_idx + num < 0){\r\n\t\t\tpre_idx = $scope.scenes.length -1;\r\n\t\t}else if(cur_idx + num > $scope.scenes.length -1){\r\n\t\t\tpre_idx = 0;\r\n\t\t}else{\r\n\t\t\tpre_idx = cur_idx + num;\r\n\t\t}\r\n\t\tvar t = $scope.scenes.splice(cur_idx,1)[0];\r\n\t\t$scope.scenes.splice(pre_idx,0,t);\r\n\t};\r\n\t$scope.up = function(){\r\n\t\tmove(-1);\r\n\t};\r\n\t$scope.down = function(){\r\n\t\tmove(1);\r\n\t};\r\n\r\n\t$scope.select = function(item){\r\n\t\t$scope.scenes.map(function(i){\r\n\t\t\tif(i.id === item.id){\r\n\t\t\t\ti._actived = true;\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t\ti._actived = false;\r\n\t\t\treturn i;\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.ok = function(){\r\n\t\tvar _this = this;\r\n\t\tvar postData = $scope.scenes.map(function(s,idx){\r\n\t\t\tvar _item = {\r\n\t\t\t\torder:idx+1,\r\n\t\t\t\tname:s.name,\r\n\t\t\t\tid:s.id,\r\n\t\t\t\tis_auto:Boolean(_this.auto_scene && (_this.auto_scene.id === s.id)),\r\n\t\t\t};\r\n\t\t\treturn _item;\r\n\t\t});\r\n\t\tScene.sort({order_data:postData},function(){\r\n\t\t\t$modalInstance.close();\r\n\t\t});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller(\"newPersonDialog\", [\"$scope\", \"$modalInstance\", \"Host\",\"Network\", \"HardwareTemplate\",\"PersonTemplate\",\"User\",\"Admin\",\"Domain\",\"PersonDesktop\",\"Server\",\"$$$I18N\",\"$$$MSG\",\"ResourcePool\",\"$filter\",\"$modal\",\"VMCommon\",\"checkIP\",\r\n\tfunction($scope, $modalInstance, host, networks, hardwares, images,user,admin, domain,Person,server, $$$I18N, $$$MSG,ResourcePool,$filter, $modal, vm, checkIP){\r\n\t$scope.desktopNum = 1;\r\n\t$scope.max_instance = 0;\r\n\t$scope.host_loading = true;\r\n\t$scope.regXP = /WindowsXP|WindowsXP_64/;\r\n\t$scope.reg = /(windows\\s*7|8|10)/i;\r\n\t$scope.regWin = /Windows/;\r\n\t// 第一步\r\n\t$scope.step1 = {};\r\n\t$scope.IPmodes1 = [{name: $$$I18N.get('不分配'), value: 0}];\r\n\t$scope.IPmodes2 = [{name: $$$I18N.get('系统分配'), value: 1},{name: $$$I18N.get('固定IP'), value: 2}];\r\n\t$scope.get_subnet = function(network){\r\n\t\tif(network.subnets.length){\r\n\t\t\tnetworks.query_sub({\r\n\t\t\t\tid:network.id\r\n\t\t\t},function(res){\r\n\t\t\t\t$scope.subnetworks = res.result.map(function(n){\r\n\t\t\t\t\tn._desc = n.start_ip ?(n.name + \" (\" + n.start_ip +\" - \"+ n.end_ip + \") \") :  n.name;\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.step1.subnetwork = $scope.subnetworks[0];\r\n\t\t\t\t$scope.clearBindIp();\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$scope.subnetworks = [];\r\n\t\t\t$scope.step1.subnetwork = null;\r\n\t\t\t$scope.clearBindIp();\r\n\t\t}\r\n\t};\r\n\tnetworks.query(function(data){\r\n\t\t// $scope.networks = data.networks.filter(function(n){ return n.subnets.length > 0});\r\n\t\t$scope.networks = data.networks;\r\n\t\tif($scope.networks.length){\r\n\t\t\t$scope.step1.network = $scope.networks[0];\r\n\t\t\t$scope.get_subnet($scope.step1.network);\r\n\t\t}\r\n\t});\r\n\tResourcePool.query(function(res){\r\n\t\t$scope.resources = res.result.filter(function(item){ return item.hosts.length > 0});\r\n\t\t$scope.step1.resource = $scope.resources[0];\r\n\t\t$scope.resource_update();\r\n\t});\r\n\t$scope.resource_update = function(){\r\n\t\t$scope.get_personal_template();\r\n\t};\r\n\t$scope.get_personal_template = function(){\r\n\t\t$scope.templates = [];\r\n\t\t$scope.templateNum = undefined;\r\n\t\t$scope.step1.image = undefined;\r\n\t\t$scope.loading_template = true;\r\n\t\tvm.list_template({type:2,virtual_type:$scope.step1.resource.type,rbd_enabled:$scope.step1.resource.rbd_enabled}, function(data){\r\n\t\t\t$scope.loading_template = false;\r\n\t\t\t$scope.winTable = data.win_images\r\n\t\t\t\t.filter(function(item){ return item.status === \"alive\" })\r\n\r\n\t\t\t$scope.linTable = data.linux_images\r\n\t\t\t\t.filter(function(item){ return item.status === \"alive\" })\r\n\t\t\t$scope.otherTable = data.other_images\r\n\t\t\t\t.filter(function(item){ return item.status === \"alive\" })\r\n\t\t\t$scope.templates = $scope.winTable.concat($scope.linTable).concat($scope.otherTable);\r\n\t\t\t$scope.templateNum = $scope.templates.length;\r\n\t\t\t$scope.step1.image = $scope.templates[0];\r\n\t\t});\r\n\t};\r\n\t$scope.clearBindIp = function(){\r\n\t\tif($scope.step1.subnetwork){\r\n\t\t\t$scope.IPmodes = $scope.IPmodes2;\r\n\t\t}else{\r\n\t\t\t$scope.IPmodes = $scope.IPmodes1;\r\n\t\t}\r\n\t\t$scope.step1.IPmode= $scope.IPmodes[0];\r\n\t\t$scope.step1.ip = null;\r\n\t};\r\n\t// 第二步\r\n\t$scope.step2 = {};\r\n\t$scope.step2.loading_server = true;\r\n\tPerson.share_servers(function(res){\r\n\t\t$scope.step2.loading_server = false;\r\n\t\tvar servers = [];\r\n\t\tres.servers.forEach(function(server){\r\n\t\t\tserver.nets.forEach(function(net){\r\n\t\t\t\tservers.push({id: server.id, net: {ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id}})\r\n\t\t\t})\r\n\t\t});\r\n\t\t$scope.share_servers = servers;\r\n\t\t$scope.step2.share_server = $scope.share_servers[0];\r\n\t})\r\n\t$scope.updateHardware = function(){\r\n\t\tvar is_win7UP = $scope.reg.test($scope.step1.image.os_type);\r\n\t\tvar is_winXP = $scope.regXP.test($scope.step1.image.os_type);\r\n\t\tvar is_win = $scope.regWin.test($scope.step1.image.os_type);\r\n\t\t$scope.step2.usb_version = \"2.0\";\r\n\t\tif(is_win7UP){\r\n\t\t\t$scope.step2.usb_redir = true;\r\n\t\t\t$scope.step2.usb_version = \"3.0\";\r\n\t\t}else if(is_winXP){\r\n\t\t\t$scope.step2.usb_redir = true;\r\n\t\t}else{\r\n\t\t\t// $scope.step2.usb_redir = false;\r\n\t\t}\r\n\t\t$scope.step2.usb3_disabled = !is_win7UP ? true : false;\r\n\t\t$scope.step2.isWin = is_win;\r\n\t}\r\n\t// 第三步\r\n\t$scope.step3 = {};\r\n\t$scope.step3.desktopNum2 = 0;\r\n\t$scope.get_host = function(){\r\n\t\tvar uuid = $scope.step1.resource.uuid;\r\n\t\tvar netid = $scope.step1.network.id;\r\n\t\tvar is_gpu = $scope.step2.has_gpu;\r\n\t\t$scope.host_loadding = true;\r\n\t\t$scope.step3.is_all = undefined;\r\n\t\t$scope.hosts = undefined;\r\n\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\thost.query_gpu_agent({\r\n\t\t\t\tid: uuid,\r\n\t\t\t\tnetwork_id: netid,\r\n\t\t\t\tenable_gpu: is_gpu\r\n\t\t\t},function(data){\r\n\t\t\t\t$scope.host_loadding = false;\r\n\t\t\t\t$scope.hosts = data.hosts_list.map(function(item){\r\n\t\t\t\t\tif(item.disabled_tips !== ''){\r\n\t\t\t\t\t\titem.disabled_desc = $$$I18N.get(item.disabled_tips);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\thost.query_agent({\r\n\t\t\t\tid: uuid,\r\n\t\t\t\tnetwork_id: netid,\r\n\t\t\t\tenable_gpu: $scope.step2.gpu_auto_assignment\r\n\t\t\t},function(res){\r\n\t\t\t\t$scope.host_loadding = false;\r\n\t\t\t\t$scope.hosts = res.hosts_list.filter(function(h){ return h.status === 'active'});\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tvar host_storages = {};\r\n\t$scope.openMoreDialog = function(){\r\n\t\tvar _hostids;\r\n\t\tif($scope.step3.hostType=='0'){\r\n\t\t\t_hostids = $scope.hosts.filter(function(h){ return h._selected}).map(function(h){ return h.storage_uuid });\r\n\t\t}else{\r\n\t\t\t_hostids = $scope.hosts.filter(function(h){ return h.instance_num}).map(function(h){ return h.storage_uuid });\r\n\t\t}\r\n\t\tvar moreDialog = $modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/host_config.html\",\r\n\t\t\tcontroller:\"hostConfigDialog\",\r\n\t\t\tresolve:{param:function(){return {\r\n\t\t\t\t\"phostids\":angular.copy(_hostids),\r\n\t\t\t\t\"pstore\":host_storages\r\n\t\t\t}}}\r\n\t\t});\r\n\t\tmoreDialog.result.then(function(){\r\n\t\t});\r\n\t};\r\n\t\r\n\t$scope.selectAllHost = function(bool){\r\n\t\tvar _hosts = $scope.hosts.filter(function(h){\r\n\t\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\t\treturn h.disabled_tips=='';\r\n\t\t\t}else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t_hosts.map(function(item){\r\n\t\t\titem._selected = bool;\r\n\t\t\treturn item;\r\n\t\t});\r\n\t\tvar num = $filter(\"selectedFilter\")(_hosts,'max_instance');\r\n\t\t$scope.step3.desktopNum = $scope.step2.has_gpu==\"through\"?num:0;\r\n\t};\r\n\t$scope.selectOneHost = function(){\r\n\t\tvar _hosts = $scope.hosts.filter(function(h){\r\n\t\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\t\treturn h.disabled_tips=='';\r\n\t\t\t}else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.step3.is_all = _hosts.every(function(item){\r\n\t\t\treturn item._selected === true;\r\n\t\t});\r\n\t\tvar num = $filter(\"selectedFilter\")(_hosts,'max_instance');\r\n\t\t$scope.step3.desktopNum = $scope.step2.has_gpu==\"through\"?num:0;\r\n\t};\r\n\t$scope.getDesktopNumber2 = function(){\r\n\t\tvar _lis = angular.copy($scope.hosts.filter(function(item){ return item.instance_num > 0 }));\r\n\t\tif(_lis.length > 0){\r\n\t\t\t$scope.step3.desktopNum2 = _lis.reduce(function(a,b){\r\n\t\t\t\ta.instance_num += b.instance_num;\r\n\t\t\t\treturn a;\r\n\t\t\t}).instance_num;\r\n\t\t}else{\r\n\t\t\t$scope.step3.desktopNum2 = 0;\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.step4 = {};\r\n\t$scope.$on(\"selectStepChange\", function(e, arg){\r\n\t\tif(arg.index==0){\r\n\t\t\targ.stepScope.$$nextSibling.error = false;\r\n\t\t}\r\n\t})\r\n\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\tsetTimeout(function(){\r\n\t\t\t$(\"[rel=popover-hover]\").popover({\r\n\t\t\t\ttrigger : \"hover\"\r\n\t\t\t});\r\n\t\t})\r\n\t\tscope.error = step.is_dirty;\r\n\t\tfunction toStrLong(ip){\r\n\t\t\tvar ips;\r\n\t\t\tips = ip.split(\".\").map(function(item,idx){\r\n\t\t\t\tvar _prefix = '';\r\n\t\t\t\tfor(var i = 0;i < 8 - Number(item).toString(2).length;i++){\r\n\t\t\t\t\t_prefix += \"0\";\r\n\t\t\t\t}\r\n\t\t\t\treturn _prefix + Number(item).toString(2);\r\n\t\t\t});\r\n\t\t\treturn ips.join(\"\");\r\n\t\t}\r\n\t\tfunction check_net(){\r\n\t\t\t// 返回值为true时，invalid\r\n\t\t\tif($scope.step1.subnetwork && $scope.step1.subnetwork.netmask && $scope.step1.subnetwork.enable_dhcp && $scope.step1.ip){\r\n\t\t\t\tvar _startIP = toStrLong($scope.step1.subnetwork.start_ip);\r\n\t\t\t\tvar _endIP = toStrLong($scope.step1.subnetwork.end_ip);\r\n\t\t\t\tvar _bindStartIP = toStrLong($scope.step1.ip);\r\n\t\t\t\treturn (_bindStartIP < _startIP || _bindStartIP > _endIP);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif(check_net()){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$MSG.get(12061),\r\n\t\t\t\ttimeout\t:5000\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar sameDesktopName = $scope.rows.filter(function(item){return item.display_name == $scope.step1.desktopName}).length;\r\n\t\tvar is_valid = scope.bodyForm1.$valid && !check_net();\r\n\t\tstep.done = is_valid  && !sameDesktopName;\r\n\t\tif(sameDesktopName){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"SAME_PERSONAL_NAME\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(step.done && !sameDesktopName){\r\n\t\t\thardwares.filter({\r\n\t\t\t\t\"system_gb\": $scope.step1.image.system_alloc_disk,\r\n\t\t\t\t\"local_gb\": $scope.step1.image.data_alloc_disk,\r\n\t\t\t\t\"local_gb1\": $scope.step1.image.data_alloc_disk_2,\r\n\t\t\t},function(data){\r\n\t\t\t\t$scope.hardwareList = data.result.map(function(data){\r\n\t\t\t\t\tdata.memory_mb = data.memory_mb/1024;\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.step2.hardware = $scope.hardwareList[0];\r\n\t\t\t\t$scope.step2.hardware && $scope.updateHardware();\r\n\t\t\t});\r\n\t\t}\r\n\t\t//个人桌面创建不需要check_ip,后台会检测作出处理\r\n\t\t// if(step.done && scope.step1.ip){\r\n\t\t// \tstep.showLoading = true;\r\n\t\t// \tstep.done = false;\r\n\t\t// \tconsole.log('step23')\r\n\t\t// \tcheckIP.check({ip: scope.step1.ip, subnet_id: scope.step1.subnetwork.id},function(res){\r\n\t\t// \t\tif(!res.result){\r\n\t\t// \t\t\t$.bigBox({\r\n\t\t// \t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\t\t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n\t\t// \t\t\t\ttimeout\t: 6000\r\n\t\t// \t\t\t});\r\n\t\t// \t\t}else{\r\n\t\t// \t\t\t$scope.$broadcast(\"currentStepChange\", 1);\r\n\t\t// \t\t}\r\n\t\t// \t\tstep.showLoading = false;\r\n\t\t// \t},function(error){ step.showLoading = false; });\r\n\t\t// }\r\n\t});\r\n\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\tvar is_valid = scope.bodyForm2.$valid;\r\n\t\tif(is_valid){\r\n\t\t\t$scope.step3.desktopNum = undefined;\r\n\t\t\t$scope.step3.desktopNum2 = 0;\r\n\t\t\t$scope.get_host();\r\n\t\t}\r\n\t\tstep.done = is_valid;\r\n\t});\r\n\t$scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\t// number类型的input ，max属性是变量，不生效，手动判断\r\n\t\tif($scope.step3.hostType == 0){\r\n\t\t\tstep.done = scope.bodyForm3.$valid && $scope.step3.desktopNum <= $filter(\"selectedFilter\")($scope.hosts,'max_instance');\r\n\t\t}\r\n\t\tif($scope.step3.hostType==1){\r\n\t\t\tstep.done = scope.bodyForm3.$valid && Boolean($scope.step3.desktopNum2);\r\n\t\t}\r\n\t});\r\n\t$scope.$on(\"WizardStep_3\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = $scope.step4.select_users.length?true:false;\r\n\t});\r\n\t$scope.$on(\"WizardDone\", function(e, steps, scopes){\r\n\t\t var postData = {};\r\n\t\t var regWin10 = /Windows10/;\r\n\t\t \tpostData.display_name = $scope.step1.desktopName;\r\n\t\t\tpostData.network_id = $scope.step1.network.id;\r\n\t\t\tpostData.resource_pool\t  = $scope.step1.resource.uuid;\r\n\r\n\t\t if($scope.step1.subnetwork){\r\n\t\t \tpostData.subnet_id = $scope.step1.subnetwork.id;\r\n\t\t }else{ postData.subnet_id = ''; }\r\n\t\t \tpostData.ip_choose = Number($scope.step1.IPmode.value) ? true : false;\r\n\t\t if(postData.ip_choose && Number($scope.step1.IPmode.value) === 2){\r\n\t\t \tpostData.start_ip = $scope.step1.ip;}\r\n\t\t // if($scope.step1.domain){\r\n\t\t\t// postData.ad_server_id = $scope.step1.domain.id;}\r\n\t\t\tpostData.image_id     = $scope.step1.image.id;\r\n\t\t\t\r\n\t\t\tpostData.rollback      = Number($scope.step2.rollback);\r\n\t\t\tpostData.data_rollback = $scope.step2.hardware.local_gb>1 ? Number($scope.step2.data_rollback) : undefined;\r\n\t\t\tif(postData.rollback === 2){\r\n\t\t\t\tpostData.rollback_weekday = $scope.step2.rollback_weekday;}\r\n\t\t\tif(postData.rollback === 3){\r\n\t\t\t\tpostData.rollback_monthday = $scope.step2.rollback_monthday;}\r\n\t\t\tif(postData.data_rollback === 2){\r\n\t\t\t\tpostData.data_rollback_weekday = $scope.step2.data_rollback_weekday;}\r\n\t\t\tif(postData.data_rollback === 3){\r\n\t\t\t\tpostData.data_rollback_monthday = $scope.step2.data_rollback_monthday;}\r\n\r\n\t\t\tpostData.instance_type_id = $scope.step2.hardware.id;\r\n\t\t\tpostData.usb_redir \t\t  = $scope.step2.usb_redir;\r\n\t\t\tpostData.usb_version      = ($scope.step2.usb_redir && $scope.step1.resource.type=='kvm') ? $scope.step2.usb_version : null;\r\n\t\t\tif($scope.step1.resource.type === \"hyper-v\")\r\n\t\t\t\tpostData.enable_gpu       = $scope.step2.has_gpu;\r\n\t\t\tif($scope.step1.resource.type === \"kvm\"){\r\n\t\t\t\tpostData.gpu_auto_assignment = $scope.step2.gpu_auto_assignment;\r\n\t\t\t\tif(regWin10.test($scope.step1.image.os_type)){\r\n\t\t\t\t\tpostData.firmware_type = 'uefi';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\tif($scope.step3.hostType == 0){\r\n\t\t\tpostData.servers = $scope.hosts.filter(function(item){ return item._selected }).map(function(item){\r\n\t\t\t\treturn {\"uuid\": item.id}\r\n\t\t\t});\r\n\t\t\tpostData.count = $scope.step3.desktopNum;\r\n\t\t}\r\n\t\tif($scope.step3.hostType == 1){\r\n\t\t\tpostData.servers = $scope.hosts.filter(function(item){ return item.instance_num > 0 }).map(function(item){\r\n\t\t\t\treturn { \"uuid\":item.id,\"vm_count\":item.instance_num }\r\n\t\t\t});\r\n\t\t\tpostData.count = $scope.step3.desktopNum2;\r\n\t\t}\r\n\t\tpostData.servers_storage = Object.keys(host_storages).map(function(key){\r\n\t\t\tvar host = host_storages[key];\r\n\t\t\treturn {\r\n\t\t\t\tuuid:host.id,\r\n\t\t\t\timage_storage_capacity: host.image_storage_capacity,\r\n\t\t\t\timage_storage_performance: host.image_storage_performance,\r\n\t\t\t\tstorage_capacity: host.storage_capacity,\r\n\t\t\t\tstorage_performance: host.storage_performance\r\n\t\t\t}\r\n\t\t});\r\n\t\tpostData.user_id = $scope.step4.select_users.map(function(item){ return item.id?item.id:item.user_id });\r\n\t\tpostData.rule_id = $scope.step4.rule;\r\n\r\n\t\tpostData.enable_share = $scope.step2.enable_share;\r\n\t\tif($scope.step2.enable_share){\r\n\t\t\tpostData.share_server_ip = $scope.step2.share_server.net.ip_address;\r\n\t\t\tpostData.share_server_id = $scope.step2.share_server.id;\r\n\t\t}\r\n\t\tpostData.expand_enabled = $scope.step2.expand_enabled;\r\n\t\t$scope.submitting = true;\r\n\t\tPerson.save(postData, function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t\t$scope.refresh();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.submitting = false;\r\n\t\t});\r\n\t});\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"alterPersonalDialog\", [\"$scope\",\"$modalInstance\",\"Network\",\"HardwareTemplate\",\"User\",\"Admin\" ,\"PersonDesktop\",\"Domain\",\"$q\",\"$$$I18N\",\r\n\tfunction($scope, $modalInstance,net,hardwrare,user,admin,personDesktop,domain,$q,$$$I18N){\r\n\t$scope.IPs = [];\r\n\t$scope.IPmodes1 = [{name: $$$I18N.get('不分配'), value: 0}];\r\n\t$scope.IPmodes2 = [{name: $$$I18N.get('系统分配'), value: 1},{name: $$$I18N.get('固定IP'), value: 2}];\r\n\t$scope.datas = angular.copy($scope.currentItem);\r\n\tif($scope.datas.ips){\r\n\t\t$scope.IPmodes = $scope.IPmodes2;\r\n\t\t$scope.datas.IPmode = $scope.IPmodes[1];\r\n\t}else{\r\n\t\t$scope.IPmodes = $scope.IPmodes1;\r\n\t\t$scope.datas.IPmode = $scope.IPmodes[0];\r\n\t}\r\n\t$scope.datas.usb_version = $scope.datas.usb_redir?$scope.datas.usb_version:'2.0';\r\n\t$scope.datas.memory_mb = $scope.datas.memory_mb/1024;\r\n\t$scope.btndisks = [];\r\n\tpersonDesktop.list_detail({id:$scope.datas.id},function(res){\r\n\t\t$scope.detailData = res.result;\r\n\t\t[\"data_rollback_weekday\",\"data_rollback_monthday\",\"rollback_weekday\",\"rollback_monthday\"].forEach(key => {\r\n\t\t\t$scope.detailData[key] = $scope.detailData[key] || 1;\r\n\t\t});\r\n\t\t$scope.get_net(true);\r\n\t\t$scope.loading_server = true;\r\n\t\tpersonDesktop.share_servers(function(res){\r\n\t\t\t$scope.loading_server = false;\r\n\t\t\tvar servers = [];\r\n\t\t\tres.servers.forEach(function(server){\r\n\t\t\t\tserver.nets.forEach(function(net){\r\n\t\t\t\t\tservers.push({id: server.id, net: {ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id}})\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\t$scope.share_servers = servers;\r\n\t\t\tif($scope.detailData.share_server_ip){\r\n\t\t\t\t$scope.detailData.share_server = $scope.share_servers.filter(function(item){ return item.net.ip_address==$scope.detailData.share_server_ip })[0]\r\n\t\t\t}else{\r\n\t\t\t\t$scope.detailData.share_server = $scope.share_servers[0];\r\n\t\t\t}\r\n\t\t})\r\n\t});\r\n\t\r\n\t$scope.get_net = function(flag){\r\n\t\t$scope.loading = true;\r\n\t\tnet.query(function(res){\r\n\t\t\t// 过滤无子网网络\r\n\t\t\t$scope.loading = false;\r\n\t\t\t// $scope.networks = res.networks.filter(function(net){ return net.subnets.length > 0});\r\n\t\t\t$scope.networks = res.networks;\r\n\t\t\t$scope.datas._network = $scope.networks.filter(function(item){ return item.id === $scope.detailData.network.id })[0];\r\n\t\t\t$scope.get_sub_net($scope.datas._network, flag);\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.get_sub_net = function(network, flag){\r\n\t\tif(network.subnets.length){\r\n\t\t\t$scope.loading = true;\r\n\t\t\tnet.query_sub({id:network.id},function(res){\r\n\t\t\t\t$scope.loading = false;\r\n\t\t\t\t$scope.subnetworks = res.result;\r\n\t\t\t\tif(flag){\r\n\t\t\t\t\t$scope.datas._subnetwork = $scope.subnetworks.filter(function(item){ return item.id === $scope.detailData.subnet_id })[0]\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.datas._subnetwork = $scope.subnetworks[0];\r\n\t\t\t\t}\r\n\t\t\t\t$scope.clearBindIp();\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$scope.subnetworks = [];\r\n\t\t\t$scope.datas._subnetwork = null;\r\n\t\t\t$scope.clearBindIp();\r\n\t\t}\r\n\t\t\r\n\t};\r\n\tvar first = true;\r\n\t$scope.clearBindIp = function(){\r\n\t\tif(first){\r\n\t\t\tfirst = false;\r\n\t\t}else{\r\n\t\t\tif($scope.datas._subnetwork){\r\n\t\t\t\t$scope.IPmodes = $scope.IPmodes2;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.IPmodes = $scope.IPmodes1;\r\n\t\t\t}\r\n\t\t\t$scope.datas.IPmode= $scope.IPmodes[0];\r\n\t\t\t$scope.datas.ips = null;\r\n\t\t}\r\n\t};\r\n\t$scope.get_disks = function(){\r\n\t\t$scope.loading_disk = true;\r\n\t\tpersonDesktop.list_passive_disk({\r\n\t\t\tuser_id:$scope.datas._user.id,\r\n\t\t\tinstance_id:$scope.datas.instance_id\r\n\t\t},function(res){\r\n\t\t\t$scope.loading_disk = false;\r\n\t\t\t$scope.disks = res.result;\r\n\t\t});\r\n\t};\r\n\t$scope.$watch(\"datas._user\",function(newval){\r\n\t\tif(newval){\r\n\t\t\t$scope.get_disks();\r\n\t\t}\r\n\t});\r\n\t$scope.expandedNodes = [];\r\n\tfunction formatData(d,name){\r\n\t    iteration(d,name);\r\n\t    return d;\r\n\t}\r\n\tfunction iteration(data,childName,list){\r\n\t    for(var i = 0 ; i < data.length ; i++){\r\n\t        $scope.expandedNodes.push(data[i]);\r\n\t        if(data[i][childName] && data[i][childName].length){\r\n\t            var len = iteration(data[i][childName],childName);\r\n\t            if(len === 0){\r\n\t                data[i] = undefined;\r\n\t            }\r\n\t        }\r\n\t        if(!data[i]) { continue; }\r\n\t        if(data[i].users && data[i].users.length > 0){\r\n\t            data[i].users.map(user => {\r\n\t                user.name = user.name || user.user_name;\r\n\t                user._is_last = true;\r\n\t                return user;\r\n\t            });\r\n\t            data[i][childName] = data[i].users;\r\n\t        }\r\n\t        if(data[i][childName] && data[i][childName].length === 0){\r\n\t            data[i]= undefined;\r\n\t        }\r\n\t    }\r\n\t    while(data.length > 0) {\r\n\t        // 如果有数组元素为空，每次删除一个\r\n\t        var oldlen = data.length;\r\n\t        for(i = 0 ; i < oldlen ; i++){\r\n\t            if(data[i] === undefined){\r\n\t                data.splice(i,1);\r\n\t                break;\r\n\t            }\r\n\t        }\r\n\t        if(oldlen === data.length) {\r\n\t            break;\r\n\t        }\r\n\t    }\r\n\t    \r\n\t    return data.length;\r\n\t}\r\n\tfunction removeNoChildrenDeparts(data) {\r\n\t    data = data.filter(noUserFilter);\r\n\t    data.forEach(walk);\r\n\t    return data;\r\n\t    function walk(node) {\r\n\t        if(!node.dept_id) { return; }\r\n\t        // 用户上级是没有 children 的\r\n\t        if(node.children) {\r\n\t            node.children = node.children.filter(noUserFilter);\r\n\t            node.children.forEach(walk);\r\n\t        }\r\n\t    }\r\n\t    function noUserFilter(node) {\r\n\t        if(node.dept_id && !node.children && node.users.length === 0) {\r\n\t            return false;\r\n\t        }\r\n\t        return true;\r\n\t    }\r\n\t}\r\n\t$scope.$on('selectCommonUser', function(e, user){\r\n\t\t$scope.datas._is_open = false;\r\n\t\t$scope.datas._user = user;\r\n\t})\r\n\t$q.all([admin.query().$promise,user.query_tree().$promise,domain.list().$promise]).then(function(arr){\r\n\t\t$scope.admin_users = arr[0].users;\r\n\t\t$scope.common_users = arr[1].result;\r\n\t\t$scope.common_users = formatData(removeNoChildrenDeparts($scope.common_users),\"children\");\r\n\t\t$scope.domain_users = arr[2].result;\r\n\t\tvar commonUser = [];\r\n\t\t$scope.expandedNodes.forEach(function(node){\r\n\t\t\tnode.children.forEach(function(user){\r\n\t\t\t\tif(user.user_id && !user.dept_id){\r\n\t\t\t\t\tuser.id = user.user_id;\r\n\t\t\t\t\tcommonUser.push(user);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t\tvar dus = $scope.domain_users.reduce(function(arr,b){\r\n\t\t\tb.groups.forEach(function(g){\r\n\t\t\t\t[].push.apply(arr,g.users);\r\n\t\t\t});\r\n\t\t\treturn arr;\r\n\t\t},[]);\r\n\t\tvar all_users = $scope.admin_users\r\n\t\t\t.concat(commonUser)\r\n\t\t\t.concat(dus)\r\n\t\t$scope.datas._user = all_users.filter(function(user){ return user.id == $scope.datas.user_id})[0];\r\n\t})\r\n\t$scope.name = function(net){\r\n\t\tvar is_dhcp = net.enable_dhcp;\r\n\t\tif(is_dhcp){\r\n\t\t\treturn net.name + \" ( \" + net.start_ip + \" - \" + net.end_ip + \" ) \";\r\n\t\t}else{\r\n\t\t\treturn net.name;\r\n\t\t}\r\n\t};\r\n\t$scope.user_name = function(user){\r\n\t\treturn user.name + \" ( \" + user.real_name +\" ) \";\r\n\t};\r\n\t$scope.ok = function(){\r\n\t\t$scope.loading = true;\r\n\t\tvar volumes = $scope.disks.filter(function(d){ return d._selected});\r\n\t\tvar _local_gb = $scope.btndisks.length ? $scope.btndisks[0].local_gb : undefined\r\n\t\tvar is_data_disk = Boolean(_local_gb || $scope.datas.local_gb);\r\n\t\tvar postData = {\r\n\t\t\tid:$scope.datas.id,\r\n\t\t\tdisplay_name:$scope.datas.display_name,\r\n\t\t\tuser_id:$scope.datas._user.id,\r\n\t\t\tvcpu:$scope.datas.vcpu,\r\n\t\t\tmemory_mb:$scope.datas.memory_mb*1024,\r\n\t\t\tnetwork_id:$scope.datas._network.id,\r\n\t\t\tsubnet_id:$scope.datas._subnetwork?$scope.datas._subnetwork.id:'',\r\n\t\t\tlocal_gb:_local_gb,\r\n\t\t\tip:$scope.datas.ips?$scope.datas.ips: undefined,\r\n\t\t\tgpu_auto_assignment: $scope.datas.enable_gpu,\r\n\t\t\tvm_hostname:$scope.datas.vm_hostname,\r\n\t\t\trollback:$scope.detailData.rollback,\r\n\t\t\trollback_weekday:$scope.detailData.rollback == 2 ? $scope.detailData.rollback_weekday : undefined,\r\n\t\t\trollback_monthday:$scope.detailData.rollback == 3 ? $scope.detailData.rollback_monthday : undefined,\r\n\t\t\tattach_volumes:volumes,\r\n\t\t\tusb_redir:$scope.datas.usb_redir,\r\n\t\t\tusb_version:($scope.datas.usb_redir && $scope.datas.virtual_type == 'kvm') ? $scope.datas.usb_version : undefined,\r\n\t\t\tdata_rollback:is_data_disk ? $scope.detailData.data_rollback : undefined,\r\n\t\t\tenable_share: $scope.detailData.enable_share,\r\n\t\t\tshare_server_ip: $scope.detailData.enable_share?$scope.detailData.share_server.net.ip_address:undefined,\r\n\t\t\tshare_server_id: $scope.detailData.enable_share?$scope.detailData.share_server.id:undefined,\r\n\t\t\texpand_enabled: $scope.datas.expand_enabled\r\n\t\t};\r\n\t\tif(postData.data_rollback == 2){\r\n\t\t\tpostData.data_rollback_weekday = $scope.detailData.data_rollback_weekday;\r\n\t\t}\r\n\t\tif(postData.data_rollback == 3){\r\n\t\t\tpostData.data_rollback_monthday = $scope.detailData.data_rollback_monthday;\r\n\t\t}\r\n\t\tpersonDesktop.update(postData,function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t\t$scope.refresh();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"snapshotPersonalDialog\", [\"$scope\", \"$modalInstance\", \"PersonDesktop\", \"VMCommon\",\"$$$I18N\",function($scope, $modalInstance, personDesktop, vm, $$$I18N){\r\n\t$scope.rows = [];\r\n\tfunction get_list(){\r\n\t\t$scope.loading = true;\r\n\t\tvm.list_snapshot({ instance_id: $scope.currentItem.instance_id },function(res){\r\n\t\t\t$scope.rows = res.snapshots.map(function(item,index){\r\n\t\t\t\titem.snapshot_name = item.name;\r\n\t\t\t\titem.display_description = item.desc;\r\n\t\t\t\titem.editable = false;\r\n\t\t\t\treturn item;\r\n\t\t\t}).sort(function(a,b){\r\n\t\t\t\treturn (new Date(b.create_at)).getTime() - (new Date(a.create_at)).getTime() > 0 ? 1 : -1;\r\n\t\t\t});\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t});\r\n\t}\r\n\tget_list();\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.hasSaveButton = function(){\r\n\t\treturn $scope.rows.filter(function(item){ return item.editable }).length\r\n\t};\r\n\t$scope.hasSubmit = function(){\r\n\t\treturn $scope.rows.filter(function(item){ return item._submitting }).length\r\n\t};\r\n\t$scope.save = function(cur){\r\n\t\tcur._submitting = true;\r\n\t\tvm.take_snapshot({\r\n\t\t\tmethod:\"save\",\r\n\t\t\tname:cur.snapshot_name,\r\n\t\t\tinstance_id:$scope.currentItem.instance_id,\r\n\t\t\tdesc:cur.display_description\r\n\t\t}).$promise.then(function(){\r\n\t\t\t$modalInstance.close();\r\n\t\t\tget_list();\r\n\t\t})\r\n\t\t.finally(function(){\r\n\t\t\tcur._submitting = false;\r\n\t\t});\t\t\r\n\t}\r\n\r\n\t$scope.addNew = function(){\r\n\t\tvar manuals = $scope.rows.filter(function(item){ return item.created_by == 'manual' }).length;\r\n\t\tif(manuals==2){\r\n\t\t\t$.bigBox({\r\n\t\t\t    title : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t    content : $$$I18N.get(\"只能创建两个手动快照\"),\r\n\t\t\t    icon : \"fa fa-warning shake animated\",\r\n\t\t\t    timeout : 6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$scope.rows.unshift({\"editable\":true});\r\n\t\t}\r\n\t};\r\n\t$scope.delete = function(cur){\r\n\t\tcur._submitting = true;\r\n\t\tif(cur.editable){\r\n\t\t\tvar idx = $scope.rows.indexOf(cur);\r\n\t\t\t$scope.rows.splice(idx,1);\r\n\t\t}else{\r\n\t\t\tvm.delete_snapshot({\r\n\t\t\t\tsnapshot_name:cur.snapshot_name,\r\n\t\t\t\tsnapshot_volumes:cur.snapshot_volumes,\r\n\t\t\t\tinstance_id:$scope.currentItem.instance_id\r\n\t\t\t},function(res){\r\n\t\t\t\tvar idx = $scope.rows.indexOf(cur);\r\n\t\t\t\t$scope.rows.splice(idx,1); \r\n\t\t\t}).$promise.finally(function(){\r\n\t\t\t\tcur._submitting = false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.restore = function(cur){\r\n\t\tcur._submitting = true;\r\n\t\tvm.restore_snapshot({\r\n\t\t\tmethod:\"restore\",\r\n\t\t\tsnapshot_volumes:cur.snapshot_volumes,\r\n\t\t\tsnapshot_name:cur.snapshot_name,\r\n\t\t\tinstance_id:$scope.currentItem.instance_id\r\n\t\t}, function() {\r\n\t\t\t$modalInstance.close();\r\n\t\t\tget_list();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\tcur._submitting = false;\r\n\t\t\tget_list();\r\n\t\t});\r\n\t}\r\n}])\r\n.controller('sceneAddServerDialog', ['$scope', 'Server','$modalInstance','param',function($scope,Server,$modalInstance,param){\r\n\tServer.query(function(res){\r\n\t\t$scope.servers = res.servers;\r\n\t\t$scope.server = $scope.servers[0];\r\n\t});\r\n\t$scope.post = function(){\r\n\t\tvar _this = this;\r\n\t\t$scope.submiting = true;\r\n\t\tServer.domain_set_scene({\r\n\t\t\tid:param.id,\r\n\t\t\thas_domain:true,\r\n\t\t\tad_server_id:_this.server.id,\r\n\t\t\trecreate_sid:_this.is_sid\r\n\t\t},function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.submiting = false;\r\n\t\t});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller('personalAddServerDialog', ['$scope', 'Server','$modalInstance','param',function($scope,Server,$modalInstance,param){\r\n\tServer.query(function(res){\r\n\t\t$scope.servers = res.servers;\r\n\t\t$scope.server = $scope.servers[0];\r\n\t});\r\n\t$scope.post = function(){\r\n\t\tvar _this = this;\r\n\t\t$scope.submiting = true;\r\n\t\tServer.domain_set_person({\r\n\t\t\tinstance_ids:param.map(function(p){ return p.id }),\r\n\t\t\thas_domain:true,\r\n\t\t\tad_server_id:_this.server.id,\r\n\t\t\trecreate_sid:_this.is_sid\r\n\t\t},function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.submiting = false;\r\n\t\t});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller('hostConfigDialog', ['$scope','Storage','param','$modalInstance','Host', function($scope,Storage,param,$modalInstance,Host){\r\n\tvar host_ids = param.phostids;\r\n\tvar datas = {};\r\n\t$scope.datas = datas = param.pstore;\r\n\tObject.keys(datas).forEach(function(key){\r\n\t\tif(host_ids.indexOf(datas[key].storage_uuid) === -1){\r\n\t\t\tdatas[key] = undefined;\r\n\t\t\tdelete datas[key];\r\n\t\t}\r\n\t});\r\n\t$scope.loading = true;\r\n\tStorage.get_luns({\r\n\t\tstorage_hosts:host_ids\r\n\t},function(res){\r\n\t\tres.result.forEach(function(host){\r\n\t\t\tif(!datas[host.storage_uuid]){\r\n\t\t\t\thost.storages.forEach(function(sto){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tsto._total_size = Number(sto.storage_metadata.capabilities.total_capacity_gb).toFixed(0);\r\n\t\t\t\t\t\tsto._free_size = Number(sto.storage_metadata.capabilities.free_capacity_gb).toFixed(0);\r\n\t\t\t\t\t\tsto._used_size = Number(sto._total_size - sto._free_size).toFixed(0);\r\n\t\t\t\t\t}catch(err){}\r\n\t\t\t\t});\r\n\t\t\t\tdatas[host.storage_uuid] = host;\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar firstKey = Object.keys(datas)[0];\r\n\t\t$scope.host = datas[firstKey];\r\n\t\t$scope.change_host($scope);\r\n\t\t$scope.loading = false;\r\n\t});\r\n\t$scope.sys_luns = [];\r\n\t$scope.data_luns = [];\r\n\t$scope.filterStorage = function(_s,type,_scope){\r\n\t\t$scope.loading_lun = true;\r\n\t\tHost.filter_storage({\r\n\t\t\tstorage_id:_s.uuid,\r\n\t\t\tdevice_type:_s.device_type,\r\n\t\t\tnode_uuid:_s.node_uuid\r\n\t\t}).$promise.then(function(res){\r\n\t\t\t$scope.loading_lun = false;\r\n\t\t\tres.result.forEach(function(s){\r\n\t\t\t\ttry{\r\n\t\t\t\t\ts._total_size = Number(s.storage_metadata.capabilities.total_capacity_gb).toFixed(0);\r\n\t\t\t\t\ts._free_size =  Number(s.storage_metadata.capabilities.free_capacity_gb).toFixed(0);\r\n\t\t\t\t\ts._used_size =  Number(s._total_size - s._free_size).toFixed(0);\r\n\t\t\t\t}catch(err){}\r\n\t\t\t});\r\n\t\t\tswitch(type){\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\t$scope.sys_luns = res.result;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\t$scope.data_luns = res.result;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t_scope.storage_performance = ($scope.sys_luns.filter(function(item){ return item.uuid ===_scope.host.storage_performance })[0]) || $scope.sys_luns[0];\r\n\t\t\t_scope.storage_capacity = ($scope.data_luns.filter(function(item){ return item.uuid === _scope.host.storage_capacity})[0]) || $scope.data_luns[0];\r\n\t\t});\r\n\t};\r\n\t$scope.change_host = function(_scope){\r\n\t\t_scope.image_storage_performance = _scope.host.storages.filter(function(sto){ return sto.uuid === _scope.host.image_storage_performance})[0];\r\n\t\t_scope.image_storage_capacity = _scope.host.storages.filter(function(sto){ return sto.uuid === _scope.host.image_storage_capacity})[0];\r\n\t\t$scope.filterStorage(_scope.image_storage_performance,1,_scope);\r\n\t\t$scope.filterStorage(_scope.image_storage_capacity,2,_scope);\r\n\t};\r\n\t$scope.ok = function(_scope){\r\n\t\tvar d = _scope.host;\r\n\t\td._changed = true;\r\n\t\td.storage_performance = _scope.storage_performance.uuid;\r\n\t\td.storage_capacity = _scope.storage_capacity.uuid;\r\n\t\td.image_storage_performance = _scope.image_storage_performance.uuid;\r\n\t\td.image_storage_capacity = _scope.image_storage_capacity.uuid;\r\n\t}\r\n\t$scope.okAll = function(){\r\n\t\t$scope.ok(this);\r\n\t\t$scope.close();\r\n\t}\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t}\r\n\t$scope.dismiss = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t}\r\n}])\r\n.controller(\"saveTemplatePersonalDialog\", [\r\n\t\"$scope\", \"$modalInstance\", \"Admin\", \"PersonDesktop\",\"HardwareTemplate\", \"$$$os_types\",\"virtualHost\",\"networkWithHost\",\"Network\",\"$$$I18N\",\r\n\tfunction($scope, $modalInstance, admin, personDesktop,hardwares,$$$os_types,virtualHost,networkWithHost,network,$$$I18N){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\tvar currentItem = $scope.currentItem = angular.copy($scope.currentItem);\r\n\t$scope.type = 2;\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('固定IP'), value: 'static'},{name: $$$I18N.get('系统分配'), value: 'auto'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[1];\r\n\tadmin.query(function(res){\r\n\t\t$scope.owners = res.users;\r\n\t\t$scope.owner = $scope.owners.filter((o) => o.id === currentItem.user_id)[0] || $scope.owners[0];\r\n\t});\r\n\tpersonDesktop.list_detail({id:currentItem.instance_id}, function(res){\r\n\t\t$scope.currentItemDetail = res.result;\r\n\t}).$promise.then(function(){\r\n\t\t$scope.getVirtualHost($scope.type, currentItem.rbd_enabled);\r\n\t})\r\n\t$scope.getVirtualHost = function (type,rbd_enabled){\r\n\t\t$scope.host_loading = true;\r\n\t\tvirtualHost.query({\r\n\t\t\tvirtual_type: currentItem.virtual_type,\r\n\t\t\trbd_enabled: rbd_enabled\r\n\t\t\t// enable_gpu: currentItem.enable_gpu\r\n\t\t},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t$scope.host = $scope.hosts.filter((h) => h.host_name === currentItem.hostname)[0] || $scope.hosts[0];\r\n\t\t\t$scope.host && $scope.getNetwork($scope.host, true);\r\n\t\t});\r\n\t}\r\n\t\r\n\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\t$scope.port_loading = true;\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t$scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t$scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip = $scope.band_ips[0];\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t}).$promise.finally(() =>{\r\n\t// \t\t\t$scope.port_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[1];\r\n\t\t}\r\n\t\t\t\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope, isFirst){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\tif(isFirst){\r\n\t\t\t\t\t_scope.subnet = _scope.subnets.filter((s) => s.id === $scope.currentItemDetail.subnet_id)[0]\r\n\t\t\t\t}else{\r\n\t\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t}\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\t\t\r\n\t};\r\n\t$scope.getNetwork = function(host, isFirst){\r\n\t\tif(host){\r\n\t\t\t$scope.net_loading = true;\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks.filter((n) => n.id === $scope.currentItemDetail.network.id)[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope, isFirst);\r\n\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t$scope.net_loading = false;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\t$scope.submiting = true ;\r\n\t\t$scope.afterSubmiting =false ;\r\n\t\tvar _this = this;\r\n\t\tif(this.saveTemplate.$valid){\r\n\t\t\tvar postData = {\r\n\t\t\t\tinstance_id:currentItem.instance_id,\r\n\t\t\t\towner:_this.owner.id,\r\n\t\t\t\ttype_code:_this.type,\r\n\t\t\t\tname:_this.name,\r\n\t\t\t\tdescription:_this.description,\r\n\t\t\t\tnetwork:_this.network.id,\r\n\t\t\t\tsubnet:_this.subnet ? _this.subnet.id : \"\",\r\n\t\t\t\tband_type:_this.bind_ip_type.value,\r\n\t\t\t\tband_ip:_this.bind_ip_type.value === 'static'? _this.bind_ip.value : undefined,\r\n\t\t\t\thost_uuid:_this.host.host_uuid,\r\n\t\t\t\tusername: currentItem.virtual_type=='hyper-v'?_this.username:undefined,\r\n\t\t\t\tuserPassword: currentItem.virtual_type=='hyper-v'?_this.userPassword:undefined,\r\n\t\t\t\tuserPasswordConfirm: currentItem.virtual_type=='hyper-v'?_this.userPasswordConfirm:undefined\r\n\t\t\t\t// enable_gpu:currentItem.enable_gpu\r\n\t\t\t};\r\n\t\t\tpersonDesktop.saveAsTemplate(postData, function(res){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},function(){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n/* 个人桌面池 */\r\n.controller(\"vdiDesktopPoolController\", [\"$scope\",\"DeskPool\",\"$modal\",\"$timeout\",\"$interval\",\"$filter\",\"$$$I18N\", function($scope,DeskPool,$modal,$timeout,$interval,$filter,$$$I18N){\r\n\tvar _scope=$scope;\r\n\t$scope.rows=[],$scope.loading=true;\r\n\r\n\t//刷新机器执行后的状态\r\n\t$interval(function(){\r\n\t\tvar filterSearch = $filter(\"filter\")($scope.rows || [], $scope.searchText);\r\n\t\tvar filterSearchPage = $filter(\"paging\")(filterSearch, $scope.currentPage, $scope.pagesize);\r\n\t\t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"personpools\", filterSearchPage.map(item => item.id));\r\n\t}, 1000);\r\n\t$scope.$on(\"personpoolsRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(item.status == 'updating'){\r\n\t\t\t\titem._ignore = true;\r\n\t\t\t}else{\r\n\t\t\t\titem._ignore = false;\r\n\t\t\t}\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\t/*获取桌面池列表*/\r\n\t$scope.refresh=function(_s = $scope){\r\n\t\tDeskPool.query(function(res){\r\n\t\t\t$scope.loading=false;\r\n\t\t\t$scope.rows=res.result;\r\n\t\t});\r\n\t}\r\n\t$scope.refresh();\r\n\t$scope.pagesize = Number($$$storage.getSessionStorage('pool_pagesize')) || 30;\r\n\t$scope.currentPage = 1;\r\n \t$scope.$watch(\"pagesize\",function(newvalue){\r\n \t\t$$$storage.setSessionStorage('pool_pagesize', newvalue);\r\n\t});\r\n\r\n\r\n\t//删除个人桌面池\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面删除'>\"+\r\n\t\t\t\t\t\"个人桌面池删除</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-show='!is_run' style='margin-bottom:20px;' localize='确定删除此个人桌面池吗？'>确定删除此个人桌面池吗？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tDeskPool.delete({\r\n\t\t\t\t\t\tids: rows.map(function(row){ return row.id; }),\r\n\t\t\t\t\t}, function(data){\r\n\t\t\t\t\t\trows.forEach(function(r){\r\n\t\t\t\t\t\t\t_scope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, function(error){\r\n\t\t\t\t\t\trows.forEach(function(r){\r\n\t\t\t\t\t\t\t_scope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\t\t\t\r\n\t};\r\n\r\n\t//获取选中item的id\r\n\tfunction getIds(){\r\n\t\tvar params={};\r\n\t\tvar rows = $scope.rows.filter(function(row){ return row._selected && row.online_count<row.total_count ;});\r\n\t\tparams={\r\n\t\t\tids:rows.map(it => it.id)\r\n\t\t}\r\n\t\treturn params;\r\n\t}\r\n\r\n\t//桌面池开机\r\n\t$scope.start=function(item){\r\n\t\tvar params=getIds();\r\n\t\tparams.action='power-on';\r\n\t\tDeskPool.start(params,function(res){\r\n\t\t\tif(res.result){\r\n\t\t\t\t_scope.refresh();\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t//桌面池强制关机\r\n\t$scope.forceShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.online_count > 0;});\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\tvar params={\r\n\t\t\t\t\t\t\tids:rows.map(it => {return it.id}),\r\n\t\t\t\t\t\t\taction:\"force-power-off\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\tDeskPool.shutdown(params,() => { _scope.refresh(); });\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t//桌面池自然关机\r\n\t$scope.natureShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.online_count>0; })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP3\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tvar params={\r\n\t\t\t\t\t\t\tids:rows.map(it => {return it.id}),\r\n\t\t\t\t\t\t\taction:\"power-off\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\tDeskPool.shutdown(params,function(){\r\n\t\t\t\t\t\t\t_scope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}])\r\n/* 个人桌面池二级列表*/\r\n.controller(\"vdiDesktopPoolListController\", [\"$scope\",\"$modal\",\"$interval\",\"$filter\",\"DeskPool\",\"DeskPoolSecond\",\"$$$I18N\",\"UserRole\", function($scope,$modal,$interval,$filter,DeskPool,DeskPoolSecond,$$$I18N,UserRole){\r\n\tvar model_name,url,_scope=$scope,cid,carr,searchName,breadPoolName;\r\n\tlet hasTerminalpermission = UserRole.currentUserRoles.filter(function(role){ return role=='Terminal' }).length;\r\n\tlet hasTerminalManagepermission = UserRole.currentUserRoles.filter(function(role){ return role=='Terminal_Manage' }).length;\r\n\tlet hasClassroompermission = UserRole.currentUserRoles.filter(function(role){ return role=='Classroom' }).length;\r\n\t$scope.linkTerminal = hasTerminalpermission && hasTerminalManagepermission && hasClassroompermission ? true:false;\r\n\t$scope.inCurrentUserPool = function(pool){\r\n\t\tif($$$storage.getSessionStorage(\"loginInfo\"))\r\n\t\t\treturn JSON.parse($$$storage.getSessionStorage(\"loginInfo\")).pool.indexOf(pool)>-1\r\n\t};\r\n\turl=decodeURIComponent(location.href);\r\n\tif(url.indexOf('client')>=0){\r\n\t\tsearchName=model_name=url.split('?')[1].split('&')[0];\r\n\t\t// breadPoolName=url.split('=')[1];\r\n\t\t// $scope.$root.$broadcast(\"navItemSelected\", [\"桌面\", \"个人桌面池\", breadPoolName]);\r\n\t} else {\r\n\t\t// model_name=url.split('?')[1];\r\n\t\t// $scope.$root.$broadcast(\"navItemSelected\", [\"桌面\", \"个人桌面池\", model_name]);\r\n\t}\r\n\tcarr=url.split('?')[0].split('/');\r\n\tcid=carr[carr.length-1];\r\n\t$scope.rows=[],$scope.loading=true;\r\n\r\n\t//tasklog刷新机器执行后的状态\r\n\t$interval(function(){\r\n\t\tvar filterSearch = $filter(\"filter\")($scope.rows || [], $scope.searchText);\r\n\t\tvar filterSearchPage = $filter(\"paging\")(filterSearch, $scope.currentPage, $scope.pagesize);\r\n\t\t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"instanceIDS\", filterSearchPage.map(item => item.id));\r\n\t}, 1000);\r\n\t$scope.$on(\"instancesRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(item.status == 'updating'){\r\n\t\t\t\titem._ignore = true;\r\n\t\t\t}else{\r\n\t\t\t\titem._ignore = false;\r\n\t\t\t}\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t//桌面名排序\r\n\t$scope.sortDesktopName = function(name,bool){\r\n\t\t$scope.rows.sort(function(a,b){\r\n\t\t\tvar _numa,_numb;\r\n\t\t\tvar get_num = function(tar){\r\n\t\t\t\tfor(var i = tar.length - 1 ; i-- ; i >= 0 ){\r\n\t\t\t\t\tif(!Number(tar[i])){\r\n\t\t\t\t\t\treturn Number(tar.substring(i + 1,tar.length));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t_numa = get_num( a[name] );\r\n\t\t\t_numb = get_num( b[name] );\r\n\t\t\treturn (_numa - _numb) * (bool ? -1 : 1);\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.getObjLength = function(obj){\r\n\t\ttry{\r\n\t\t\treturn Object.keys(obj).length;\r\n\t\t}catch(err){\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t};\r\n\r\n\t//获取桌面列表|更新桌面列表\r\n\t_scope.refresh=function(){\r\n\t\tDeskPoolSecond.get({id:cid},function(res){\r\n\t\t\t_scope.loading=false;\r\n\t\t\t_scope.rows=res.result;\r\n\t\t\t$scope.$root.$broadcast(\"navItemSelected\", [\"桌面\", \"个人桌面池\", res.person_pool_name]);\r\n\t\t\t_scope.sortDesktopName('display_name');\r\n\t\t\t_scope.searchText=searchName;\r\n\t\t\t_scope.loading=false;\t\r\n\t\t})\r\n\t}\r\n\r\n\t_scope.refresh();\r\n\r\n\t$scope.pagesize    = Number($$$storage.getSessionStorage('pool_details_pagesize')) || 30;\r\n\t$scope.currentPage = 1;\r\n \t$scope.$watch(\"pagesize\",function(newvalue){\r\n \t\t$$$storage.setSessionStorage('pool_details_pagesize', newvalue);\r\n\t});\r\n\t// $scope.rows=mockData.result;\r\n\r\n\t//获取桌面池详情信息\r\n\t$scope.getDetail = function(it){\r\n\t\t$scope.loading_detail = true;\r\n\t\tDeskPool.list_detail({id:it.id},function(res){\r\n\t\t\tit.detailData = res.result;\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.loading_detail = false;\r\n\t\t});\r\n\t};\r\n\r\n\t//桌面池详情展开收起\r\n\t$scope.expand = function(row){\r\n\t\t$scope.rows.forEach(r => {\r\n\t\t\tif(row.id === r.id){\r\n\t\t\t\tr._expand = !row._expand;\r\n\t\t\t\tif(r._expand){\r\n\t\t\t\t\t$scope.getDetail(row);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tr._expand = false;\r\n\t\t\t}\r\n\t\t})\r\n\t};\r\n\r\n\t//searchText输入搜索\r\n\t$scope.updateData = function(text,select){\r\n\t\t$scope.rows = $scope.rows.filter(function(row){\r\n\t\t\trow._selected = false;\r\n\t\t\tif(select){\r\n\t\t\t\tif(text && text.trim()){\r\n\t\t\t\t\treturn row.status === select;\r\n\t\t\t\t}\r\n\t\t\t\treturn row.status === select;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t};\r\n\r\n\t//操作--查看桌面\r\n\t$scope.view = function(item){\r\n\t\twindow.open(\"desktopScreenshot.html#\" + item.id, \"person_desktop_\" + item.id);\r\n\t};\r\n\r\n\t//获取选中item的id\r\n\tfunction getIds(item){\r\n\t\tvar params={};\r\n\t\tvar rows = item ? [item] :$scope.rows.filter(function(row){ return row._selected  });\r\n\t\tparams={\r\n\t\t\tids:rows.map(it => it.id)\r\n\t\t}\r\n\t\treturn params;\r\n\t}\r\n\r\n\t//个人桌面池开机\r\n\t$scope.start = function(item) {\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'shutdown' || row.status == 'suspended') && !row.task_state; });\r\n\t\tvar params={\r\n\t\t\tinstance_ids:rows.map(it => {it._selected=false; return it.id})\r\n\t\t}\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP1\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tDeskPoolSecond.start(params,function(res){\r\n\t\t\t\t// _scope.refresh();//tasklog刷新，这里不需要再拉取列表\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t//桌面池强制关机\r\n\t$scope.forceShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tvar params={\r\n\t\t\t\t\t\t\tinstance_ids:rows.map(it => {it._selected=false; return it.id})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\tDeskPoolSecond.shutdown(params,() => {});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t//桌面池自然关机\r\n\t$scope.natureShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP3\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tvar params={\r\n\t\t\t\t\t\t\tinstance_ids:rows.map(it => {it._selected=false; return it.id})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\tDeskPoolSecond.shutdown(params,function(){\r\n\t\t\t\t\t\t\t// _scope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t//桌面池重启\r\n\t$scope.restart = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state; })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP4\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>\"+\r\n\t\t\t\t\t\t\t\"桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tvar params={\r\n\t\t\t\t\t\t\tinstance_ids:rows.map(it=> {it._selected=false; return it.id})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\tDeskPoolSecond.reboots(params,function(){\r\n\t\t\t\t\t\t\t// _scope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t//挂起状态\r\n\t$scope.pause = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'running' && !row.task_state; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP5\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>\"+ \r\n\t\t\t\t\t\t\"桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tvar params={\r\n\t\t\t\t\t\t\tinstance_ids:rows.map(it=> {it._selected=false; return it.id})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\tDeskPoolSecond.pause(params,function(){\r\n\t\t\t\t\t\t\t// _scope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t//唤醒\r\n\t$scope.resume = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'paused' && !row.task_state; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP6\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>\"+\r\n\t\t\t\t\t\t\"桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\tvar params={\r\n\t\t\t\t\t\t\tinstance_ids:rows.map(it=> {it._selected=false; return it.id})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tDeskPoolSecond.resume(params,function(){\r\n\t\t\t\t\t\t\t// _scope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}])\r\n/*新增个人桌面池dialog控制器*/\r\n.controller(\"newDeskPoolDialog\", [\"$scope\", \"$modalInstance\",\"$q\",\"DeskPool\", \"Host\",\"Network\", \"HardwareTemplate\",\"PersonTemplate\",\"User\",\"Admin\",\"Depart\",\"PersonDesktop\",\"Server\",\"$$$I18N\",\"$$$MSG\",\"ResourcePool\",\"$filter\",\"$modal\",\"VMCommon\",\r\n\tfunction($scope, $modalInstance,$q,DeskPool, host, networks, hardwares, images,user,Admin, Depart,Person,server, $$$I18N, $$$MSG,ResourcePool,$filter, $modal, vm){\r\n\t\tvar _scope=$scope;\r\n\t\t$scope.desktopNum = 1;\r\n\t\t$scope.max_instance = 0;\r\n\t\t$scope.host_loading = true;\r\n\t\t$scope.regXP = /WindowsXP|WindowsXP_64/;\r\n\t\t$scope.reg = /(windows\\s*7|8|10)/i;\r\n\t\t$scope.depart = {name: '全部', id: -1, full_path: 'root'};\r\n\t\t/**\r\n\t\t* [selectMode 部门域选择]\r\n\t\t*/\r\n\t\tfunction traverse(ids, obj){\r\n\t\t \tif(obj.children && obj.children.length>0){\r\n\t\t \t\tobj.children.forEach(function(item){\r\n\t\t \t\t\tids.push(item.id);\r\n\t\t \t\t\ttraverse(ids, item)\r\n\t\t \t\t})\r\n\t\t \t}\r\n\t\t}\r\n\t    function setData(data, index){\r\n\t        data.filter(function(item){ return item.full_path_map.length == index }).forEach(function(item){\r\n\t            var children = data.filter(function(d){ return d.parent == item.id });\r\n\t            item.children = children;\r\n\t        });\r\n\t    }\r\n\t    function setTreeData(DATA){\r\n\t        DATA.forEach(function(item){\r\n\t            item.full_path_map = item.full_path.split('/');\r\n\t        });\r\n\t        DATA.sort(function(a,b){ return a.full_path_map.length>b.full_path_map.length?-1:1 });\r\n\t        for(var i=1; i<DATA[0].full_path_map.length; i++){\r\n\t            setData(DATA, i);\r\n\t        }\r\n\t        return [DATA[DATA.length-1]];\r\n\t    };\r\n\r\n\t    //初始化树状图\r\n\t    function treeOptFun(arg,flag){\r\n\t    \targ.opts = {};\r\n\t    \targ.treedata = newData;\r\n\t    \targ.expandnodes = DATA;\r\n\t    \targ.selected = arg.treedata[0]?arg.treedata[0]:null;\r\n\t    \tif(arg.selected){\r\n\t    \t\targ.selected._selected = true;\r\n\t    \t}\r\n\t    \targ.showSelected = function(node, selected){\r\n\t    \t\tnode._selected = selected;\r\n\t    \t\targ.selected = node;\r\n\t    \t}\r\n\t    };\r\n\t    var DATA = [], newData = [];\r\n\r\n\t    treeOptFun($scope,true);\r\n\t    $scope.islastGroup = function(){\r\n\t    \treturn $scope.selected && !DATA.filter(function(item){\r\n\t    \t\t\t\treturn item.id!==$scope.selected.id;\r\n\t    \t\t\t}).filter(function(item){\r\n\t    \t\t\t\treturn (item.full_path+'/').indexOf($scope.selected.full_path+'/')>-1;\r\n\t    \t\t\t}).length\r\n\t    }\r\n\r\n\t    $scope.getUserGroup = function(){\r\n\t    \tDepart.query(function(res){\r\n\t    \t\tDATA = res.result;\r\n\t    \t\t$scope.treedata = newData = DATA.length?setTreeData(DATA):[];\r\n\t    \t\t$scope.treedata.sort(function(a,b){ return a.full_path>b.full_path?-1:1 });\r\n\t    \t\t$scope.expandnodes = DATA;\r\n\t    \t\tvar selected = {};\r\n\t    \t\tif($scope.selected){\r\n\t    \t\t\tvar _selected = DATA.filter(function(item){ return item.id==$scope.selected.id })[0];\r\n\t    \t\t\tselected = _selected?_selected:newData[0];\r\n\t    \t\t}else{\r\n\t    \t\t\tselected = DATA.filter(function(item){ return item.name=='default' })[0];\r\n\t    \t\t}\r\n\t    \t\t$scope.selected = selected;\r\n\t    \t\tif($scope.selected){\r\n\t    \t\t\t$scope.selected._selected = true;\r\n\t    \t\t}\r\n\t    \t},function(err){\r\n\r\n\t    \t});\r\n\t    }\r\n\r\n\r\n\t\t// 第一步\r\n\t\t$scope.step1 = {};\r\n\t\t$scope.IPmodes1 = [{name: $$$I18N.get('不分配'), value: 0}];\r\n\t\t$scope.IPmodes2 = [{name: $$$I18N.get('系统分配'), value: 1},{name: $$$I18N.get('固定IP'), value: 2}];\r\n\t\t$scope.get_subnet = function(network){\r\n\t\t\tif(network.subnets.length){\r\n\t\t\t\tnetworks.query_sub({\r\n\t\t\t\t\tid:network.id\r\n\t\t\t\t},function(res){\r\n\t\t\t\t\t$scope.subnetworks = res.result.map(function(n){\r\n\t\t\t\t\t\tn._desc = n.start_ip ?(n.name + \" (\" + n.start_ip +\" - \"+ n.end_ip + \") \") :  n.name;\r\n\t\t\t\t\t\treturn n;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$scope.step1.subnetwork = $scope.subnetworks[0];\r\n\t\t\t\t\t$scope.clearBindIp();\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\t$scope.subnetworks = [];\r\n\t\t\t\t$scope.step1.subnetwork = null;\r\n\t\t\t\t$scope.clearBindIp();\r\n\t\t\t}\r\n\t\t};\r\n\t\tnetworks.query(function(data){\r\n\t\t\t// $scope.networks = data.networks.filter(function(n){ return n.subnets.length > 0});\r\n\t\t\t$scope.networks = data.networks;\r\n\t\t\tif($scope.networks.length){\r\n\t\t\t\t$scope.step1.network = $scope.networks[0];\r\n\t\t\t\t$scope.get_subnet($scope.step1.network);\r\n\t\t\t}\r\n\t\t});\r\n\t\tResourcePool.query(function(res){\r\n\t\t\t$scope.resources = res.result.filter(function(item){ return item.hosts.length > 0});\r\n\t\t\t$scope.step1.resource = $scope.resources[0];\r\n\t\t\t$scope.resource_update();\r\n\t\t});\r\n\t\t$scope.resource_update = function(){\r\n\t\t\t$scope.get_personal_template();\r\n\t\t};\r\n\t\t$scope.get_personal_template = function(){\r\n\t\t\t$scope.templates = [];\r\n\t\t\t$scope.templateNum = undefined;\r\n\t\t\t$scope.step1.image = undefined;\r\n\t\t\t$scope.loading_template = true;\r\n\t\t\tvm.list_template({type:2,virtual_type:$scope.step1.resource.type,rbd_enabled:$scope.step1.resource.rbd_enabled}, function(data){\r\n\t\t\t\t$scope.loading_template = false;\r\n\t\t\t\t$scope.winTable = data.win_images\r\n\t\t\t\t\t.filter(function(item){ return item.status === \"alive\" })\r\n\r\n\t\t\t\t$scope.linTable = data.linux_images\r\n\t\t\t\t\t.filter(function(item){ return item.status === \"alive\" })\r\n\t\t\t\t$scope.otherTable = data.other_images\r\n\t\t\t\t\t.filter(function(item){ return item.status === \"alive\" })\r\n\t\t\t\t$scope.templates = $scope.winTable.concat($scope.linTable).concat($scope.otherTable);\r\n\t\t\t\t$scope.templateNum = $scope.templates.length;\r\n\t\t\t\t$scope.step1.image = $scope.templates[0];\r\n\t\t\t});\r\n\t\t};\r\n\t\t$scope.clearBindIp = function(){\r\n\t\t\tif($scope.step1.subnetwork){\r\n\t\t\t\t$scope.IPmodes = $scope.IPmodes2;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.IPmodes = $scope.IPmodes1;\r\n\t\t\t}\r\n\t\t\t$scope.step1.IPmode= $scope.IPmodes[0];\r\n\t\t\t$scope.step1.ip = null;\r\n\t\t};\r\n\t\t// 第二步\r\n\t\t$scope.step2 = {};\r\n\t\t$scope.updateHardware = function(){\r\n\t\t\tvar is_win7UP = $scope.reg.test($scope.step1.image.os_type);\r\n\t\t\tvar is_winXP = $scope.regXP.test($scope.step1.image.os_type);\r\n\t\t\t$scope.step2.usb_version = \"2.0\";\r\n\t\t\tif(is_win7UP){\r\n\t\t\t\t$scope.step2.usb_redir = true;\r\n\t\t\t\t$scope.step2.usb_version = \"3.0\";\r\n\t\t\t}else if(is_winXP){\r\n\t\t\t\t$scope.step2.usb_redir = true;\r\n\t\t\t}else{\r\n\t\t\t\t// $scope.step2.usb_redir = false;\r\n\t\t\t}\r\n\t\t\t$scope.step2.usb3_disabled = !is_win7UP ? true : false;\r\n\t\t}\r\n\t\t// 第三步\r\n\t\t$scope.step3 = {};\r\n\t\t$scope.step3.desktopNum2 = 0;\r\n\t\t$scope.get_host = function(){\r\n\t\t\t$scope.getUserGroup();\r\n\t\t\tvar uuid = $scope.step1.resource.uuid;\r\n\t\t\tvar netid = $scope.step1.network.id;\r\n\t\t\tvar is_gpu = $scope.step2.has_gpu;\r\n\t\t\t$scope.host_loadding = true;\r\n\t\t\t$scope.step3.is_all = undefined;\r\n\t\t\t$scope.hosts = undefined;\r\n\t\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\t\thost.query_gpu_agent({\r\n\t\t\t\t\tid: uuid,\r\n\t\t\t\t\tnetwork_id: netid,\r\n\t\t\t\t\tenable_gpu: is_gpu\r\n\t\t\t\t},function(data){\r\n\t\t\t\t\t$scope.host_loadding = false;\r\n\t\t\t\t\t$scope.hosts = data.hosts_list.map(function(item){\r\n\t\t\t\t\t\tif(item.disabled_tips !== ''){\r\n\t\t\t\t\t\t\titem.disabled_desc = $$$I18N.get(item.disabled_tips);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\thost.query_agent({\r\n\t\t\t\t\tid: uuid,\r\n\t\t\t\t\tnetwork_id: netid,\r\n\t\t\t\t\tenable_gpu: false\r\n\t\t\t\t},function(res){\r\n\t\t\t\t\t$scope.host_loadding = false;\r\n\t\t\t\t\t$scope.hosts = res.hosts_list.filter(function(h){ return h.status === 'active'});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar host_storages = {};\r\n\t\t$scope.openMoreDialog = function(){\r\n\t\t\tvar _hostids;\r\n\t\t\tif($scope.step3.hostType=='0'){\r\n\t\t\t\t_hostids = $scope.hosts.filter(function(h){ return h._selected}).map(function(h){ return h.storage_uuid });\r\n\t\t\t}else{\r\n\t\t\t\t_hostids = $scope.hosts.filter(function(h){ return h.instance_num}).map(function(h){ return h.storage_uuid });\r\n\t\t\t}\r\n\t\t\tvar moreDialog = $modal.open({\r\n\t\t\t\ttemplateUrl:\"views/vdi/dialog/desktop/host_config.html\",\r\n\t\t\t\tcontroller:\"hostConfigDialog\",\r\n\t\t\t\tresolve:{param:function(){return {\r\n\t\t\t\t\t\"phostids\":angular.copy(_hostids),\r\n\t\t\t\t\t\"pstore\":host_storages\r\n\t\t\t\t}}}\r\n\t\t\t});\r\n\t\t\tmoreDialog.result.then(function(){\r\n\t\t\t});\r\n\t\t};\r\n\t\t\r\n\t\t$scope.selectAllHost = function(bool){\r\n\t\t\tvar _hosts = $scope.hosts.filter(function(h){\r\n\t\t\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\t\t\treturn h.disabled_tips=='';\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t_hosts.map(function(item){\r\n\t\t\t\titem._selected = bool;\r\n\t\t\t\treturn item;\r\n\t\t\t});\r\n\t\t\tvar num = $filter(\"selectedFilter\")(_hosts,'max_instance');\r\n\t\t\t$scope.step3.desktopNum = $scope.step2.has_gpu==\"through\"?num:0;\r\n\t\t};\r\n\t\t$scope.selectOneHost = function(){\r\n\t\t\tvar _hosts = $scope.hosts.filter(function(h){\r\n\t\t\t\tif($scope.step1.resource.type=='hyper-v'){\r\n\t\t\t\t\treturn h.disabled_tips=='';\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$scope.step3.is_all = _hosts.every(function(item){\r\n\t\t\t\treturn item._selected === true;\r\n\t\t\t});\r\n\t\t\tvar num = $filter(\"selectedFilter\")(_hosts,'max_instance');\r\n\t\t\t$scope.step3.desktopNum = $scope.step2.has_gpu==\"through\"?num:0;\r\n\t\t};\r\n\t\t$scope.getDesktopNumber2 = function(){\r\n\t\t\tvar _lis = angular.copy($scope.hosts.filter(function(item){ return item.instance_num > 0 }));\r\n\t\t\tif(_lis.length > 0){\r\n\t\t\t\t$scope.step3.desktopNum2 = _lis.reduce(function(a,b){\r\n\t\t\t\t\ta.instance_num += b.instance_num;\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t}).instance_num;\r\n\t\t\t}else{\r\n\t\t\t\t$scope.step3.desktopNum2 = 0;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t$scope.step4 = {};\r\n\t\t$scope.$on(\"selectStepChange\", function(e, arg){\r\n\t\t\tif(arg.index==0){\r\n\t\t\t\targ.stepScope.$$nextSibling.error = false;\r\n\t\t\t}\r\n\t\t})\r\n\t\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\t$(\"[rel=popover-hover]\").popover({\r\n\t\t\t\t\ttrigger : \"hover\"\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\tfunction toStrLong(ip){\r\n\t\t\t\tvar ips;\r\n\t\t\t\tips = ip.split(\".\").map(function(item,idx){\r\n\t\t\t\t\tvar _prefix = '';\r\n\t\t\t\t\tfor(var i = 0;i < 8 - Number(item).toString(2).length;i++){\r\n\t\t\t\t\t\t_prefix += \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn _prefix + Number(item).toString(2);\r\n\t\t\t\t});\r\n\t\t\t\treturn ips.join(\"\");\r\n\t\t\t}\r\n\t\t\tfunction check_net(){\r\n\t\t\t\t// 返回值为true时，invalid\r\n\t\t\t\tif($scope.step1.subnetwork && $scope.step1.subnetwork.netmask && $scope.step1.subnetwork.enable_dhcp && $scope.step1.ip){\r\n\t\t\t\t\tvar _startIP = toStrLong($scope.step1.subnetwork.start_ip);\r\n\t\t\t\t\tvar _endIP = toStrLong($scope.step1.subnetwork.end_ip);\r\n\t\t\t\t\tvar _bindStartIP = toStrLong($scope.step1.ip);\r\n\t\t\t\t\treturn (_bindStartIP < _startIP || _bindStartIP > _endIP);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif(check_net()){\r\n\t\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent\t:$$$MSG.get(12061),\r\n\t\t\t\t\ttimeout\t:5000\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tvar sameDesktopName = $scope.rows.filter(function(item){return item.pool_name == $scope.step1.desktopName}).length;\r\n\t\t\tvar is_valid = scope.bodyForm1.$valid && !check_net();\r\n\t\t\tstep.done = is_valid  && !sameDesktopName;\r\n\t\t\tif(sameDesktopName){\r\n\t\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent\t: $$$I18N.get(\"SAME_POOL_NAME\"),\r\n\t\t\t\t\ttimeout\t: 6000\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(step.done && !sameDesktopName){\r\n\t\t\t\thardwares.filter({\r\n\t\t\t\t\t\"system_gb\": $scope.step1.image.system_alloc_disk,\r\n\t\t\t\t\t\"local_gb\": $scope.step1.image.data_alloc_disk,\r\n\t\t\t\t\t\"local_gb1\": $scope.step1.image.data_alloc_disk_2,\r\n\t\t\t\t},function(data){\r\n\t\t\t\t\t$scope.hardwareList = data.result.map(function(data){\r\n\t\t\t\t\t\tdata.memory_mb = data.memory_mb/1024;\r\n\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$scope.step2.hardware = $scope.hardwareList[0];\r\n\t\t\t\t\t$scope.step2.hardware && $scope.updateHardware();\r\n\t\t\t\t});\r\n\t\t\t}\t\r\n\t\t});\r\n\t\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\tvar is_valid = scope.bodyForm2.$valid;\r\n\t\t\tif(is_valid){\r\n\t\t\t\t$scope.step3.desktopNum = undefined;\r\n\t\t\t\t$scope.step3.desktopNum2 = 0;\r\n\t\t\t\t$scope.get_host();\r\n\t\t\t}\r\n\t\t\tstep.done = is_valid;\r\n\t\t});\r\n\t\t$scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\t// number类型的input ，max属性是变量，不生效，手动判断\r\n\t\t\tif($scope.step3.hostType == 0){\r\n\t\t\t\tstep.done = scope.bodyForm3.$valid && $scope.step3.desktopNum <= $filter(\"selectedFilter\")($scope.hosts,'max_instance');\r\n\t\t\t}\r\n\t\t\tif($scope.step3.hostType==1){\r\n\t\t\t\tstep.done = scope.bodyForm3.$valid && Boolean($scope.step3.desktopNum2);\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.$on(\"WizardStep_3\", function(e, step, scope){\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\t// step.done = $scope.step4.select_users.length?true:false;\r\n\t\t\tstep.done=$scope.selected?true:false;\r\n\t\t});\r\n\t\t$scope.$on(\"WizardDone\", function(e, steps, scopes){\r\n\t\t\t var postData = {};\r\n\t\t\t \tpostData.display_name = $scope.step1.desktopName;\r\n\t\t\t \tpostData.pool_name=$scope.step1.desktopName;\r\n\t\t\t\tpostData.network_id = $scope.step1.network.id;\r\n\t\t\t\tpostData.resource_pool\t  = $scope.step1.resource.uuid;\r\n\r\n\t\t\t if($scope.step1.subnetwork){\r\n\t\t\t \tpostData.subnet_id = $scope.step1.subnetwork.id;\r\n\t\t\t }else{ postData.subnet_id = ''; }\r\n\t\t\t \tpostData.ip_choose = Number($scope.step1.IPmode.value) ? true : false;\r\n\t\t\t if(postData.ip_choose && Number($scope.step1.IPmode.value) === 2){\r\n\t\t\t \tpostData.start_ip = $scope.step1.ip;}\r\n\t\t\t // if($scope.step1.domain){\r\n\t\t\t\t// postData.ad_server_id = $scope.step1.domain.id;}\r\n\t\t\t\tpostData.image_id     = $scope.step1.image.id;\r\n\t\t\t\t\r\n\t\t\t\tpostData.rollback      = Number($scope.step2.rollback);\r\n\t\t\t\tpostData.data_rollback = $scope.step2.hardware.local_gb>1 ? Number($scope.step2.data_rollback) : undefined;\r\n\t\t\t\tif(postData.rollback === 2){\r\n\t\t\t\t\tpostData.rollback_weekday = $scope.step2.rollback_weekday;}\r\n\t\t\t\tif(postData.rollback === 3){\r\n\t\t\t\t\tpostData.rollback_monthday = $scope.step2.rollback_monthday;}\r\n\t\t\t\tif(postData.data_rollback === 2){\r\n\t\t\t\t\tpostData.data_rollback_weekday = $scope.step2.data_rollback_weekday;}\r\n\t\t\t\tif(postData.data_rollback === 3){\r\n\t\t\t\t\tpostData.data_rollback_monthday = $scope.step2.data_rollback_monthday;}\r\n\r\n\t\t\t\tpostData.instance_type_id = $scope.step2.hardware.id;\r\n\t\t\t\tpostData.usb_redir \t\t  = $scope.step2.usb_redir;\r\n\t\t\t\tpostData.usb_version      = ($scope.step2.usb_redir && $scope.step1.resource.type=='kvm') ? $scope.step2.usb_version : null;\r\n\t\t\t\tif($scope.step1.resource.type === \"hyper-v\")\r\n\t\t\t\t\tpostData.enable_gpu       = $scope.step2.has_gpu;\r\n\t\t\t\t\r\n\t\t\tif($scope.step3.hostType == 0){\r\n\t\t\t\tpostData.servers = $scope.hosts.filter(function(item){ return item._selected }).map(function(item){\r\n\t\t\t\t\treturn {\"uuid\": item.id}\r\n\t\t\t\t});\r\n\t\t\t\tpostData.count = $scope.step3.desktopNum;\r\n\t\t\t}\r\n\t\t\tif($scope.step3.hostType == 1){\r\n\t\t\t\tpostData.servers = $scope.hosts.filter(function(item){ return item.instance_num > 0 }).map(function(item){\r\n\t\t\t\t\treturn { \"uuid\":item.id,\"vm_count\":item.instance_num }\r\n\t\t\t\t});\r\n\t\t\t\tpostData.count = $scope.step3.desktopNum2;\r\n\t\t\t}\r\n\t\t\tpostData.servers_storage = Object.keys(host_storages).map(function(key){\r\n\t\t\t\tvar host = host_storages[key];\r\n\t\t\t\treturn {\r\n\t\t\t\t\tuuid:host.id,\r\n\t\t\t\t\timage_storage_capacity: host.image_storage_capacity,\r\n\t\t\t\t\timage_storage_performance: host.image_storage_performance,\r\n\t\t\t\t\tstorage_capacity: host.storage_capacity,\r\n\t\t\t\t\tstorage_performance: host.storage_performance\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// postData.user_id = $scope.step4.select_users.map(function(item){ return item.id?item.id:item.user_id });\r\n\t\t\tpostData.user_group_id = $scope.selected.id;\r\n\t\t\t//相比个人桌面的新增 多了个人桌面池name，分组id参数\r\n\t\t\t$scope.submitting = true;\r\n\t\t\tif(!postData.user_group_id){\r\n\t\t\t\tconsole.log('用户分组ID\"user_group_id\"不能为空');\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tDeskPool.save(postData, function(res){\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t\t$scope.refresh();\r\n\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t$scope.submitting = false;\r\n\t\t\t});\r\n\t\t});\r\n\t\t$scope.close = function(){\r\n\t\t\t$modalInstance.close();\r\n\t\t};\r\n}])\r\n/*修改桌面池*/\r\n.controller('editPoolDialog', [\"$scope\",\"$modal\",\"$modalInstance\",\"DeskPool\" ,function($scope,$modal,$modalInstance,DeskPool){\r\n\t$scope.need_ha = false;\r\n\tvar selectedServer,raw_need_ha;\r\n\t$scope.rollbackChange = function(value){\r\n\t\tif(value != \"1\"){\r\n\t\t\t$scope.need_ha = false;\r\n\t\t}else{\r\n\t\t\tif(selectedServer&&selectedServer.length>0){\r\n\t\t\t\t$scope.need_ha = angular.copy(raw_need_ha);\r\n\t\t\t\t$scope.servers = selectedServer;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t$scope.name = $scope.currentItem.name;\r\n\t$scope.desktopNum = $scope.currentItem.instance_max ;\r\n\t$scope.min_instances = $scope.currentItem.instance_max;\r\n\t$scope.rollback = $scope.currentItem.rollback;\r\n\t$scope.rollback_monthday = $scope.currentItem.rollback_monthday ? $scope.currentItem.rollback_monthday : \"1\";\r\n\t$scope.rollback_weekday = $scope.currentItem.rollback_weekday ? $scope.currentItem.rollback_weekday :\"1\";\r\n\r\n\t$scope.disk_type = $scope.currentItem.disk_type;\r\n\t$scope.local_gb = $scope.currentItem.local_gb;\r\n\t$scope.data_rollback = $scope.currentItem.data_rollback;\r\n\t$scope.data_rollback_monthday = $scope.currentItem.data_rollback_monthday || \"1\";\r\n\t$scope.data_rollback_weekday = $scope.currentItem.data_rollback_weekday || \"1\";\r\n\r\n\t$scope.usb_redir = $scope.currentItem.usb_redir;\r\n\t// $scope.usb3_disabled = !$scope.currentItem.usb3_editable;\r\n\t$scope.usb_version = $scope.currentItem.usb_version || \"2.0\";\r\n\r\n\t$scope.running_count = $scope.currentItem.running_count;\r\n\t$scope.has_domain=$scope.currentItem.has_domain||false;\r\n\t$scope.domain = $scope.currentItem.domain;\r\n\t$scope.need_ha = false;\r\n\t// $scope.enable_gpu = $scope.currentItem.enable_gpu;\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar _rollback = parseInt(this.rollback);\r\n\t\tvar _data_rollback = parseInt(this.data_rollback) >= 0 ? Number(this.data_rollback) : undefined;\r\n\t\tvar item = {};\r\n\t\titem.id = $scope.currentItem.id;\r\n\t\titem.pool = $scope.currentItem.pool;\r\n\t\titem.name = this.name;\r\n\t\titem.instance_max          = $scope.currentItem.instance_max;\r\n\t\titem.rollback              = _rollback;\r\n\t\titem.rollback_monthday \t   = _rollback == 3 ? this.rollback_monthday : undefined;\r\n\t\titem.rollback_weekday      = _rollback == 2 ? this.rollback_weekday : undefined;\r\n\t\titem.data_rollback         = _data_rollback;\r\n\t\titem.data_rollback_monthday= _data_rollback === 3 ? this.data_rollback_monthday : undefined;\r\n\t\titem.data_rollback_weekday = _data_rollback === 2 ? this.data_rollback_weekday : undefined;\r\n\t\titem.usb_redir \t\t\t   = this.usb_redir;\r\n\t\titem.usb_version  \t\t   = (item.usb_redir && $scope.currentItem.virtual_type=='kvm') ? this.usb_version : null;\r\n\t\titem.has_domain            = this.has_domain;\r\n\t\t// if($scope.currentItem.virtual_type === 'hyper-v')\r\n\t\t// \titem.enable_gpu\t\t\t   = this.enable_gpu;\r\n\t\titem.domain                = this.domain;\r\n\t\titem.need_ha               = item.rollback==1 &&  this.need_ha;\r\n\t\tif(item.rollback ==1 && item.need_ha){\r\n\t\t\titem.server_ids = $scope.servers.filter(function(value){\r\n\t\t\t\treturn value._selected;\r\n\t\t\t}).map(function(value){\r\n\t\t\t\treturn value.id;\r\n\t\t\t});\r\n\t\t\tif(item.server_ids<1){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\titem.server_ids = item.server_ids.join(',');\r\n\t\t}\r\n\t\t$scope.loading = true;\r\n\t\tDeskPool.update(item, function(){\r\n\t\t\t$modalInstance.close();\r\n\t\t\t$scope.refresh();\r\n\t\t},function(){\r\n\t\t\t$scope.refresh();\r\n\t\t}).$promise.finally(res => {\r\n\t\t\t$scope.loading = false;\r\n\t\t});\t\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/desktop/controllers.js","angular.module(\"vdi.system\", [])\r\n\r\n/* 系统 */\r\n.factory(\"SystemISO\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/isos\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tupdate: { method: \"PUT\" }\r\n//        loadISO: {method: \"POST\", url:  $Domain + \"/thor/image/loadISO\"}\r\n\t});\r\n}])\r\n.factory(\"FenTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image?type_code=3&type_code=4&type_code=5\", isArray: false }\r\n\t});\r\n}])\r\n.factory(\"PuTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/4\", isArray: false }\r\n\t});\r\n}])\r\n.factory(\"addTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"get\", url: $Domain + \"/thor/image/register\" },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/register\" }\r\n\t});\r\n}])\r\n.factory(\"SystemDesktop\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/sysInsts\", null, {\r\n\t\tget_instances:{ method: \"GET\", url: $Domain + \"/thor/sysInsts/:id\",params:{id:\"@id\"}},\r\n\t\tadd_instances:{ method: \"POST\", url: $Domain + \"/thor/sysInsts/:id\",params:{id:\"@id\"}},\r\n\t\tconfig_instances:{ method: \"PUT\", url: $Domain + \"/thor/sysInst/:id\",params:{id:\"@id\"}},\r\n\t\tconfig_template:{ method: \"PUT\", url: $Domain + \"/thor/create_distribute_template\"},\r\n\t\tget_devices:{ method:\"POST\", url: $Domain + \"/thor/get_pci_devices\"},\r\n\t\tregister:{ method:\"POST\", url: $Domain + \"/thor/register_system_template\" },\r\n\t\tadd:{ method:\"POST\", url: $Domain + \"/thor/system_template\" },\r\n\t\tedit:{ method:\"PUT\", url: $Domain + \"/thor/system_template\" }\r\n\t});\r\n}])\r\n.factory(\"SystemBackup\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/admin/backup\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tbackup:\r\n\t\t\t{ method: \"POST\"},\r\n\t\trestore :\r\n\t\t\t{ method: \"POST\"},\r\n\t\tdelete :\r\n\t\t\t{ method: \"DELETE\"},\r\n\t\tget_config : \r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/admin/backup_config\"},\r\n\t\talter_config:\r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/admin/backup_config\"}\r\n\t});\r\n}])\r\n\r\n.factory(\"SystemUpgrade\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/admin/upgrade\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tupload: { method: \"POST\"},\r\n\t\tupgrade:\r\n\t\t\t{ method: \"PUT\" },\r\n\t\tdelete :\r\n\t\t\t{ method: \"DELETE\"}\r\n\r\n\t});\r\n}])\r\n.factory(\"SystemLog\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/log\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tdelete :\r\n\t\t\t{ method: \"DELETE\"}\r\n\t});\r\n}])\r\n.factory(\"SystemUSB\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/usb\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tsave: { method: \"POST\" },\r\n\t\tupdate: { method: \"PUT\" },\r\n\t\tdelete: { method: \"DELETE\"}\r\n\t});\r\n}])\r\n.factory(\"CreateDistribute\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/create_distribute_template\", null, {\r\n\t\tpost: { method: \"POST\"}\r\n\t});\r\n}])\r\n.factory(\"Outside\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/haproxy\", null, {\r\n\t\tquery: { method: \"GET\", url: $Domain + \"/thor/haproxy/info\", isArray: false },\r\n\t\tstart: { method: \"POST\", url: $Domain + \"/thor/haproxy/start\" },\r\n\t\tstop: { method: \"POST\", url: $Domain + \"/thor/haproxy/stop\" },\r\n\t\tsave: { method: \"POST\", url: $Domain + \"/thor/haproxy/save\" }\r\n\t});\r\n}])\r\n//系统资源回收接口\r\n.factory('RecycleTech', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/recycle/public\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tsave: { method: \"POST\" }\r\n\t});\r\n}])\r\n.factory('RecyclePer', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/recycle/person\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tsave: { method: \"POST\" }\r\n\t});\r\n}])\r\n//系统时间同步接口\r\n.factory('SystemTime', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/system-time\", null, {\r\n\t\tgetInternetSync: { method: \"GET\", url: $Domain + \"/thor/system-time/internet\", isArray: false}, // 获取Internet时间服务器同步\r\n\t\tinternetSync: { method: \"POST\", url: $Domain + \"/thor/system-time/internet\"}, // 与Internet时间服务器同步\r\n\t\tquerySyncServer: { method: \"GET\", url: $Domain + \"/thor/system-time/sync\", isArray: false }, // 获取同步服务列表\r\n\t\tupdateSyncServer: { method: \"POST\", url: $Domain + \"/thor/system-time/sync\"}, // 立即同步\r\n\t\tqueryZone: { method: \"GET\", url: $Domain + \"/thor/system-time\", isArray: false }, // 系统当前时间，以及时区列表\r\n\t\tupdateZone: { method: \"POST\", url: $Domain + \"/thor/system-time\"} // 更新操作系统时区、日期、时间\r\n\t\t\r\n\t});\r\n}])\r\n// 快速部署\r\n.factory('SystemDeploy', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/init\", null, {\r\n\t\tquickstart: {method: \"GET\", url: $Domain + \"/thor/init/quickstart\"},\r\n\t\tquery_data_network: {method: \"GET\", url: $Domain + \"/thor/networks\"},\r\n\t\t// 导入模板镜像\r\n        scan_iso: {method: \"GET\", url: $Domain + \"/thor/init/prepare_import_img\"},\r\n        import_iso: {method: \"POST\", url: $Domain + \"/thor/init/prepare_import_img\"},\r\n        complete_import: {method: \"POST\", url: $Domain + \"/thor/init/import_img\"},\r\n        import_progress: {method: \"POST\", url: $Domain + \"/thor/init/check_file\"},\r\n        // 注册教学模板\r\n        list_system_images: { method: \"get\", url: $Domain + \"/thor/image/register\" },\r\n        list_sub_networks: { method: \"GET\", url:$Domain + \"/thor/network/:id/subnets\", params: { id: \"@id\" }},\r\n        list_ports: { method: \"GET\", url:$Domain + \"/thor/network/subnet/:id/ports\", params: { id: \"@id\" }},\r\n        register_template: {method: \"POST\", url: $Domain + \"/thor/init/regit_template\"},\r\n        // 创建教学场景\r\n        create_scene: {method: \"POST\", url: $Domain + \"/thor/init/create_mode\"},\r\n        first_deploy: {method: \"GET\", url: $Domain + \"/thor/init/first_deploy\"},\r\n        //系统模块快速部署的界面展现\r\n        quick_deploy_page:{method:\"GET\",url:$Domain + \"/thor/controller/ha_storage_state\"}\r\n    });\r\n}])\r\n.factory('AutoSnapshot', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/admin/auto_snapshot\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tsave: { method: \"POST\" },\r\n\t\tupdate: { method: \"PUT\", url: $Domain + \"/thor/admin/auto_snapshot/detail/:id\", params: { id: \"@id\" } },\r\n\t\tactive: { method: \"POST\", url: $Domain + \"/thor/admin/auto_snapshot/detail/:id\", params: { id: \"@id\" } },\r\n\t\tdelete: { method: \"DELETE\"}\r\n\t});\r\n}])\r\n.factory('USBPassThrough', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/admin/thor/usb_pass_through\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tsave: { method: \"POST\" },\r\n\t\tcancel: { method: \"DELETE\"}\r\n\t});\r\n}])\r\n.factory('TreeInstances', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/tree_instances\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false}\r\n\t});\r\n}])\r\n.factory('Spice', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/spice_image_compression\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tsave: { method: \"POST\" }\r\n\t});\r\n}])\r\n.factory('Share', [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/share/settings\", null, {\r\n\t\tquery: { method: \"GET\", isArray: false},\r\n\t\tsave: { method: \"POST\" }\r\n\t});\r\n}])\r\n.controller(\"vdiSystemDesktopListController\", [\"$scope\", \"$modal\", \"SystemDesktop\", \"FenTemplate\", \"PuTemplate\", \"$$$os_types\", \"$Domain\", \"$interval\",\"$$$I18N\",function($scope, $modal, SystemDesktop, FenTemplate, PuTemplate, $$$os_types, $Domain, $interval,$$$I18N){\r\n\t$scope.domain = $Domain;\r\n\t$scope.rows = [];\r\n\t\r\n\t$scope.images = [];\r\n\t$scope.loading = true;\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesizes = [30,20,10];\r\n    $scope.pagesize = $scope.pagesizes[0];\r\n\r\n    $interval(function(){\r\n    \t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"imageIDS\", $scope.rows.map(function(item){ return item.id }));\r\n    }, 1000);\r\n    $scope.$on(\"imagesRowsUpdate\", function($event, data){\r\n    \tvar _rows = {};\r\n    \t$scope.rows.forEach(function(item){\r\n    \t\t_rows[item.id] = item;\r\n    \t});\r\n    \tdata.forEach(function(item){\r\n    \t\tif(_rows[item.id]){\r\n    \t\t\tfor(var k in item){\r\n    \t\t\t\t_rows[item.id][k] = item[k];\r\n    \t\t\t}\r\n    \t\t}\r\n    \t});\r\n    \t$scope.rows.forEach(function(row){\r\n    \t\tvar updateInfor = row.sync_status && row.sync_status.filter(function(item){ return item.type === \"image\" });\r\n    \t\tif(updateInfor && updateInfor.length!==0)\r\n    \t\t\trow.updateSize = (updateInfor[0].size/1024/1024/1024).toFixed(2);\r\n    \t})\r\n\r\n    });\r\n    $scope.editSysdesktop = function(item){\r\n    \tvar ins = $modal.open({\r\n    \t\ttemplateUrl:\"views/vdi/dialog/system/template_config.html\",\r\n    \t\tcontroller:\"systemTemplateConfigDialog\",\r\n    \t\tsize:\"lg\",\r\n    \t\tresolve:{param: function(){ return item }}\r\n    \t});\r\n    \tins.result.then(function(){\r\n    \t\t// $scope.changeType($scope.select);\r\n    \t});\r\n    }\r\n    function get_rows(){\r\n    \tFenTemplate.query(function(res){\r\n    \t\t$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\r\n    \t\t$scope.rows.forEach(function(row){\r\n    \t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n    \t\t\tos && os.icon && (row.icon = os.icon);\r\n    \t\t\tif(row.os_type && row.os_type.indexOf(\"_64\")>-1)\r\n    \t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n    \t\t\tif(row.os_type && row.os_type.indexOf(\"(64 bit)\")>-1)\r\n    \t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n    \t\t});\r\n    \t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n    \t\t$scope.running = res.running;\r\n    \t\t$scope.shutoff = res.shutoff;\r\n    \t\t$scope.sync_mode = res.sync_mode;\r\n    \t\t$scope.loading = false;\r\n    \t\t$scope.teachNames = $scope.rows.map(function(item){ return item.name });\r\n    \t\t$scope.sameName = false;\r\n    \t});\r\n    }\r\n    get_rows();\r\n\r\n\tvar _controllerScope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除系统桌面'>删除系统桌面\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_SYSDESK_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t$scope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tFenTemplate.delete({ id: rows.map(function(item){ return item.id }) },function(res){\r\n\t\t\t\t\t\trows.forEach(function(row){\r\n\t\t\t\t\t\t\t_controllerScope.rows.splice(_controllerScope.rows.indexOf(row), 1);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\ttemplate.query(function(res){\r\n\t\t\t\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t\t\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t\t\t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t\t\t\t\t\t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n}])\r\n.controller(\"addTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Admin\", \"addTemplate\", \"$$$os_types\", \"UserRole\", \"FenTemplate\", \"PuTemplate\", \"ResourcePool\", \"Host\",\"Network\", \"SystemISO\", \"SystemDesktop\", \"$filter\",\"CreateDistribute\",\"virtualHost\",\"$$$I18N\",\r\nfunction($scope, $modalInstance, admin, addTemplate, $$$os_types, UserRole, FenTemplate, PuTemplate, ResourcePool, host, Network, iso, SystemDesktop, $filter, CreateDistribute, virtualHost, $$$I18N){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.nets = [];\r\n\t$scope.min_namelength=2;\r\n\t$scope.max_namelength=20;\r\n\t$scope.vcpus = 1;\r\n\t$scope.ram = 32;\r\n\t$scope.system_gb = 10;\r\n\t$scope.local_gb = 5;\r\n\t\r\n\t$scope.multifyNetsTips = $$$I18N.get('multifyNetsTips');\r\n\r\n\t$scope.get_host = function(uuid){\r\n\t\thost.query_agent({ id:uuid },function(res){\r\n\t\t\t$scope.hosts = res.hosts_list.filter(function(h){ return h.status === 'active'});\r\n\t\t\t$scope.node = $scope.hosts[0];\r\n\t\t\t$scope.get_devices($scope.node.host);\r\n\t\t});\r\n\t}\r\n\tResourcePool.query(function(res){\r\n\t\t$scope.pools = res.result.filter(function(item){ return item.hosts.length > 0 && item.type=='kvm' });\r\n\t\tif($scope.pools.length){\r\n\t\t\t$scope.source_pool = $scope.pools[0];\r\n\t\t\t$scope.get_host($scope.source_pool.uuid);\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.hosts = [];\r\n\t\t}\r\n\t});\r\n\r\n\t$scope.IPmodes1 = [{name: $$$I18N.get('不分配'), value: 0}];\r\n\t$scope.IPmodes2 = [{name: $$$I18N.get('系统分配'), value: 1},{name: $$$I18N.get('固定IP'), value: 2}];\r\n\tfunction getNetwork(key){\r\n\t\t$scope.loading = true;\r\n\t\tNetwork.query(function(data){\r\n\t\t\tif(data.networks.length){\r\n\t\t\t\t$scope.nets.push({key: key, networks: data.networks, network: data.networks[0]});\r\n\t\t\t\t$scope.get_subnet(data.networks[0], key);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tgetNetwork(new Date());\r\n\t$scope.get_subnet = function(network, key){\r\n\t\tif(network.subnets.length){\r\n\t\t\tNetwork.query_sub({\r\n\t\t\t\tid:network.id\r\n\t\t\t},function(res){\r\n\t\t\t\tvar subnetworks = [];\r\n\t\t\t\tsubnetworks = res.result.map(function(n){\r\n\t\t\t\t\tn._desc = n.start_ip ?(n.name + \" (\" + n.start_ip +\" - \"+ n.end_ip + \") \") :  n.name;\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.nets.forEach(function(item){\r\n\t\t\t\t\tif(item.key===key){\r\n\t\t\t\t\t\titem.subnetworks = subnetworks;\r\n\t\t\t\t\t\titem.subnetwork = subnetworks[0];\r\n\t\t\t\t\t\t$scope.clearBindIp(key);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$scope.loading = false;\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$scope.loading = false;\r\n\t\t\t$scope.nets.forEach(function(item){\r\n\t\t\t\tif(item.key===key){\r\n\t\t\t\t\titem.subnetworks = [];\r\n\t\t\t\t\titem.subnetwork = null;\r\n\t\t\t\t\t$scope.clearBindIp(key);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.clearBindIp = function(key){\r\n\t\t$scope.nets.forEach(function(item){\r\n\t\t\tif(item.key===key){\r\n\t\t\t\tif(item.subnetwork){\r\n\t\t\t\t\titem.IPmodes = $scope.IPmodes2;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.IPmodes = $scope.IPmodes1;\r\n\t\t\t\t}\r\n\t\t\t\titem.IPmode= item.IPmodes[0];\r\n\t\t\t\titem.ip = null;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.host_loading = true;\r\n\t\r\n\t$scope.get_devices = function(hostname){\r\n\t\tSystemDesktop.get_devices({host:hostname},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.devices = res.result.filter(function(item){ return item.status === \"available\"});\r\n\t\t});\r\n\t};\r\n\t$scope.selectAllHost = function(bool){\r\n\t\t$scope.devices.map(function(item){\r\n\t\t\titem._selected = bool;\r\n\t\t\treturn item;\r\n\t\t});\r\n\t};\r\n\t$scope.selectOneHost = function(){\r\n\t\t$scope.is_all = $scope.devices.every(function(item){\r\n\t\t\treturn item._selected === true;\r\n\t\t});\r\n\t};\r\n\r\n\tiso.query(function(res){\r\n\t\t$scope.isos = res.isos.filter(function(iso){ return iso.os_type && iso.type!==\"package\" && iso.type!==\"other\" });\r\n\t\t$scope.isos.forEach(function(item){\r\n\t\t\titem.os_type = item.os_type.split(\",\");\r\n\t\t});\r\n\t\t$scope.iso = $scope.isos[0];\r\n\t});\r\n\r\n\t$scope.addNet = function(){\r\n\t\tgetNetwork(new Date());\r\n\t};\r\n\t$scope.minusNet = function(i){\r\n\t\tvar idx = $scope.nets.indexOf(i)\r\n\t\t$scope.nets.splice(idx,1);\r\n\t};\r\n\tvar newWindow;\r\n\tsetTimeout(function(){\r\n\t\t$(\"#finish\").on('click',function(){\r\n\t\t    newWindow = window.open('templateModifybt.html#0');\r\n\t\t})\r\n\t});\r\n\r\n\t// 判断网络数组中两两是否有两个相同的子网id\r\n\tfunction giveTip(array){\r\n\t\tvar flag = false;\r\n\t\tarray.forEach(function(item, index){\r\n\t\t for(var i=index+1; i<array.length; i++){\r\n\t\t\tconsole.log(array[index],array[i]);\r\n\t\t\tif(array[index]['subnetwork'] && array[i]['subnetwork'] && array[index]['subnetwork']['id'] == array[i]['subnetwork']['id']){\r\n\t\t\t\tflag = true;\r\n\t\t\t}\r\n\t\t  }\r\n\t\t});\r\n\t\treturn flag;\r\n\t}\r\n\t$scope.ok = function(){\r\n\t\t$scope.devices_selected = $filter(\"selectedFilter\")($scope.devices);\r\n\t\t// if($scope.devices_selected.length!==0){\r\n\t\t\tvar me = this;\r\n\t\t\t$scope.submiting = true ;\r\n\t\t\t$scope.afterSubmiting =false ;\r\n\t\t\tvar postData = {\r\n\t\t\t\tdisplay_name: this.display_name,\r\n\t\t\t\ttype_code: this.type,\r\n\t\t\t\tsource_pool: this.source_pool.uuid,\r\n\t\t\t\tnode: this.node.id,\r\n\t\t\t\tnetwork: this.nets.map(function(item){ if(!item.network.id) return \"\"; else return item.network.id }),\r\n\t\t\t\tsubnet: this.nets.map(function(item){ if(!item.subnetwork) return \"\"; else return item.subnetwork.id }),\r\n\t\t\t\tband_ip: this.nets.map(function(item){ if(!item.ip) return \"\"; else return item.ip }),\r\n\t\t\t\tiso_path:this.iso.name,\r\n\t\t\t\tiso_id:this.iso.id,\r\n\t\t\t\tvcpus: this.vcpus,\r\n\t\t\t\tram: this.ram*1024,\r\n\t\t\t\tpci_devices_node:$scope.devices_selected.map(function(item){ return item.compute_node_id }),\r\n\t\t\t\tpci_devices_address:$scope.devices_selected.map(function(item){ return item.address}),\r\n\t\t\t\tsystem_gb: this.system_gb,\r\n\t\t\t\tlocal_gb: this.local_gb,\r\n\t\t\t\tstart_on_host_boot: this.start_on_host_boot,\r\n\t\t\t\tvirtual_type: this.source_pool.type\r\n\t\t\t};\r\n\t\t\t//需求1651,新增和编辑模板都在新打开的vnc页面提示IP重复\r\n\t\t\t// if(giveTip(this.nets)){\r\n\t\t\t// \t$.bigBox({\r\n\t\t\t// \t\ttitle: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t// \t\tcontent:$$$I18N.get(\"不同网卡上不能存在相同网段的IP\"),\r\n\t\t\t// \t\ttimeout:6000\r\n\t\t\t// \t});\r\n\t\t\t// }\r\n\t\t\tSystemDesktop.add(postData, function(res){\r\n\t\t\t\tvar alertFlag = giveTip(me.nets);\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t\tFenTemplate.query(function(res){\r\n\t\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t\tvar template = $scope.rows.filter(function(temp){ return temp.name ==  postData.display_name})[0];\r\n\t\t\t\t\tif(res.sync_mode==='scp')\r\n\t\t\t\t\t\tnewWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name + '&sytem_desktop'+'&sameIp='+alertFlag);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tnewWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name + '&sytem_desktop'+'&sameIp='+alertFlag);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},function(res){\r\n\t\t\t\tnewWindow.close();\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t// }\r\n\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"systemTemplateRegisterDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Admin\", \"addTemplate\", \"$$$os_types\", \"UserRole\", \"FenTemplate\", \"PuTemplate\", \"ResourcePool\", \"Host\",\"Network\", \"SystemISO\", \"SystemDesktop\", \"$filter\",\"CreateDistribute\",\"virtualHost\",\"$$$I18N\",\"registerTemplate\",\r\nfunction($scope, $modalInstance, admin, addTemplate, $$$os_types, UserRole, FenTemplate, PuTemplate, ResourcePool, host, Network, iso, SystemDesktop, $filter, CreateDistribute, virtualHost, $$$I18N, registerTemplate){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.nets = [];\r\n\t$scope.min_namelength=2;\r\n\t$scope.max_namelength=20;\r\n\t$scope.vcpus = 1;\r\n\t$scope.ram = 32;\r\n\t$scope.system_gb = 10;\r\n\t$scope.local_gb = 5;\r\n\r\n\t$scope.multifyNetsTips = $$$I18N.get('multifyNetsTips');\r\n\r\n\t$scope.get_host = function(uuid){\r\n\t\thost.query_agent({ id:uuid },function(res){\r\n\t\t\t$scope.hosts = res.hosts_list.filter(function(h){ return h.status === 'active'});\r\n\t\t\t$scope.node = $scope.hosts[0];\r\n\t\t\t$scope.get_devices($scope.node.host);\r\n\t\t});\r\n\t}\r\n\tResourcePool.query(function(res){\r\n\t\t$scope.pools = res.result.filter(function(item){ return item.hosts.length > 0 && item.type=='kvm' });\r\n\t\tif($scope.pools.length){\r\n\t\t\t$scope.source_pool = $scope.pools[0];\r\n\t\t\t$scope.get_host($scope.source_pool.uuid);\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.hosts = [];\r\n\t\t}\r\n\t});\r\n\r\n\tregisterTemplate.query(function(res){\r\n\t\t$scope.sys_isos = res.system_image.filter(function(item){ return item.virtual_type=='kvm' });\r\n\t\t$scope.sys_iso = res.system_image[0];\r\n\t\t$scope.old_data_isos = res.data_image;\r\n\t\tif($scope.sys_iso){\r\n\t\t\t$scope.getDataImgs($scope.sys_iso);\r\n\t\t}\r\n\t})\r\n\t$scope.filterDataISO = function(data_iso, data_iso2){\r\n\t\tif(data_iso){\r\n\t\t\t$scope.data_isos2 = $scope.data_isos.filter(function(item){ return item.name !== data_iso.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos2 = $scope.data_isos;\r\n\t\t}\r\n\t\tif(data_iso2){\r\n\t\t\t$scope.data_isos1 = $scope.data_isos.filter(function(item){ return item.name !== data_iso2.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos1 = $scope.data_isos;\r\n\t\t}\r\n\t};\r\n\t$scope.getDataImgs = function(systemImg, is_init){\r\n\t\tif(systemImg){\r\n\t\t\tthis.data_iso = undefined;\r\n\t\t\tthis.data_iso2 = undefined;\r\n\t\t\t$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function(item){ return item.virtual_type == systemImg.virtual_type });\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.IPmodes1 = [{name: $$$I18N.get('不分配'), value: 0}];\r\n\t$scope.IPmodes2 = [{name: $$$I18N.get('系统分配'), value: 1},{name: $$$I18N.get('固定IP'), value: 2}];\r\n\tfunction getNetwork(key){\r\n\t\t$scope.loading = true;\r\n\t\tNetwork.query(function(data){\r\n\t\t\tif(data.networks.length){\r\n\t\t\t\t$scope.nets.push({key: key, networks: data.networks, network: data.networks[0]});\r\n\t\t\t\t$scope.get_subnet(data.networks[0], key);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tgetNetwork(new Date());\r\n\t$scope.get_subnet = function(network, key){\r\n\t\tif(network.subnets.length){\r\n\t\t\tNetwork.query_sub({\r\n\t\t\t\tid:network.id\r\n\t\t\t},function(res){\r\n\t\t\t\tvar subnetworks = [];\r\n\t\t\t\tsubnetworks = res.result.map(function(n){\r\n\t\t\t\t\tn._desc = n.start_ip ?(n.name + \" (\" + n.start_ip +\" - \"+ n.end_ip + \") \") :  n.name;\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.nets.forEach(function(item){\r\n\t\t\t\t\tif(item.key===key){\r\n\t\t\t\t\t\titem.subnetworks = subnetworks;\r\n\t\t\t\t\t\titem.subnetwork = subnetworks[0];\r\n\t\t\t\t\t\t$scope.clearBindIp(key);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$scope.loading = false;\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$scope.loading = false;\r\n\t\t\t$scope.nets.forEach(function(item){\r\n\t\t\t\tif(item.key===key){\r\n\t\t\t\t\titem.subnetworks = [];\r\n\t\t\t\t\titem.subnetwork = null;\r\n\t\t\t\t\t$scope.clearBindIp(key);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.clearBindIp = function(key){\r\n\t\t$scope.nets.forEach(function(item){\r\n\t\t\tif(item.key===key){\r\n\t\t\t\tif(item.subnetwork){\r\n\t\t\t\t\titem.IPmodes = $scope.IPmodes2;\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.IPmodes = $scope.IPmodes1;\r\n\t\t\t\t}\r\n\t\t\t\titem.IPmode= item.IPmodes[0];\r\n\t\t\t\titem.ip = null;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.host_loading = true;\r\n\t\r\n\t$scope.get_devices = function(hostname){\r\n\t\tSystemDesktop.get_devices({host:hostname},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.devices = res.result.filter(function(item){ return item.status === \"available\"});\r\n\t\t});\r\n\t};\r\n\t$scope.selectAllHost = function(bool){\r\n\t\t$scope.devices.map(function(item){\r\n\t\t\titem._selected = bool;\r\n\t\t\treturn item;\r\n\t\t});\r\n\t};\r\n\t$scope.selectOneHost = function(){\r\n\t\t$scope.is_all = $scope.devices.every(function(item){\r\n\t\t\treturn item._selected === true;\r\n\t\t});\r\n\t};\r\n\r\n\tiso.query(function(res){\r\n\t\t$scope.isos = res.isos.filter(function(iso){ return iso.os_type && iso.type!==\"package\" && iso.type!==\"other\" });\r\n\t\t$scope.isos.forEach(function(item){\r\n\t\t\titem.os_type = item.os_type.split(\",\");\r\n\t\t});\r\n\t\t$scope.iso = $scope.isos[0];\r\n\t});\r\n\r\n\t$scope.addNet = function(){\r\n\t\tgetNetwork(new Date());\r\n\t};\r\n\t$scope.minusNet = function(i){\r\n\t\tvar idx = $scope.nets.indexOf(i)\r\n\t\t$scope.nets.splice(idx,1);\r\n\t};\r\n\r\n\t// 判断网络数组中两两是否有两个相同的子网id\r\n\tfunction giveTip(array){\r\n\t\tvar flag = false;\r\n\t\tarray.forEach(function(item, index){\r\n\t\t for(var i=index+1; i<array.length; i++){\r\n\t\t\tif(array[index]['subnetwork']['id'] == array[i]['subnetwork']['id']){\r\n\t\t\t\tflag = true;\r\n\t\t\t}\r\n\t\t  }\r\n\t\t});\r\n\t\treturn flag;\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\t$scope.devices_selected = $filter(\"selectedFilter\")($scope.devices);\r\n\t\t// if($scope.devices_selected.length!==0){\r\n\t\t\tvar me = this, alertTip;\r\n\t\t\talertTip = giveTip(me.nets);\r\n\t\t\tvar postData = {\r\n\t\t\t\tdisplay_name: this.display_name,\r\n\t\t\t\ttype_code: this.type,\r\n\t\t\t\tsource_pool: this.source_pool.uuid,\r\n\t\t\t\tnode: this.node.id,\r\n\t\t\t\tnetwork: this.nets.map(function(item){ if(!item.network.id) return \"\"; else return item.network.id }),\r\n\t\t\t\tsubnet: this.nets.map(function(item){ if(!item.subnetwork) return \"\"; else return item.subnetwork.id }),\r\n\t\t\t\tband_ip: this.nets.map(function(item){ if(!item.ip) return \"\"; else return item.ip }),\r\n\t\t\t\tvcpus: this.vcpus,\r\n\t\t\t\tram: this.ram*1024,\r\n\t\t\t\tsystem_image_file: this.sys_iso,\r\n\t\t\t\tdata_image_file: this.data_iso?this.data_iso:undefined,\r\n\t\t\t\tpci_devices_node:$scope.devices_selected.map(function(item){ return item.compute_node_id }),\r\n\t\t\t\tpci_devices_address:$scope.devices_selected.map(function(item){ return item.address}),\r\n\t\t\t\tstart_on_host_boot: this.start_on_host_boot,\r\n\t\t\t\tvirtual_type: this.source_pool.type\r\n\t\t\t};\r\n\t\t\tif(alertTip){\r\n\t\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent:$$$I18N.get(\"不同网卡上不能存在相同网段的IP\"),\r\n\t\t\t\t\ttimeout:6000\r\n\t\t\t\t});\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t$scope.afterSubmiting =false ;\r\n\t\t\t$scope.submiting = true ;\r\n\t\t\tSystemDesktop.register(postData, function(res){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t\tFenTemplate.query(function(res){\r\n\t\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},function(){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t// }\r\n\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"vdiSystemBackupListController\", [\"$scope\",\"$modal\", \"SystemBackup\", \"$Domain\",function($scope,$modal, backup, $Domain){\r\n\t$scope.rows = [];$scope.loading = true;\r\n\t\r\n\t$scope.getList = function(){\r\n\t\tbackup.query(function(data){\r\n\t\t\t$scope.allRows = data.ret;\r\n\t\t\t$scope.rows = data.ret;\r\n\t\t\t$scope.loading = false;\r\n\t\t})\r\n\t};\r\n\t$scope.getList();\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\tvar controller_scope = $scope;\r\n\t$scope.getURL = function(item){\r\n\t\treturn $Domain + \"/thor/admin/download?file_name=\" + item.name;\r\n\t};\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(item => item._selected);\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='BACKUP_DE'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='BACKUP_DE_CONTENT'=></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\tbackup.delete({name:rows.map(row => row.name)}, function(data){\r\n\t\t\t\t\t\t\tcontroller_scope.getList();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.backup = function(){\r\n\t\t$scope.submitting = true;\r\n\t\tbackup.backup({method:\"backup\"}, function(data){\r\n\t\t\tcontroller_scope.getList();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.submitting  = false;\r\n\t\t})\r\n\t};\r\n\t$scope.config = function(){\r\n\t\t$modal.open({\r\n\t\t\tcontroller:\"systemBackupConfigController\",\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/system/system_backup_config.html\",\r\n\t\t\tsize:\"md\"\r\n\t\t});\r\n\t};\r\n}])\r\n.controller(\"vdiSystemISOListController\", [\r\n\t\"$scope\", \"SystemISO\", \"$modal\",\"$rootScope\", \"$filter\", \"$$$os_types\",\"$Domain\",\r\n\tfunction($scope, iso, $modal, $rootScope, $filter, $$$os_types,$Domain){\r\n\t$$$os_types = $$$os_types.filter(function(type){ return type.key !== 'Windows 7' });\r\n\t$scope.rows = [];$scope.loading = true;$scope.domain = $Domain;\r\n\tvar rows = [];\r\n\tfunction loadIso(){\r\n\t\tiso.query(function(res){\r\n\t\t\t$scope.rows = res.isos;\r\n\t\t\t$scope.loading = false;\r\n\t\t\tvar test = /Windows 7/;\r\n\t\t\t$scope.rows.forEach(function(item){\r\n\t\t\t\t//item.os_type = $$$os_types[Math.random() * $$$os_types.length ^ 0].key;\r\n\t\t\t\titem.origin_os_type = item.os_type;\r\n\t\t\t\tif(item.os_type){\r\n\t\t\t\t\tvar type = $$$os_types.filter(function(type){ return type.key === item.os_type; })[0];\r\n\t\t\t\t\tif(type){\r\n\t\t\t\t\t\titem.os_type = type;\r\n\t\t\t\t\t}else if (test.test(item.os_type)){\r\n\t\t\t\t\t\titem.os_type = {\"key\": \"Windows 7\",\"value\": \"Windows 7 series\"};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// item.editable = false;\r\n\t\t\t\titem.old_type = item.type;\r\n\t\t\t\titem.old_os_type = item.os_type;\r\n\t\t\t\titem.type_editable = false;\r\n\t\t\t\titem.os_editable = false;\r\n\t\t\t});\r\n\t\t\tangular.copy($scope.rows,rows);\r\n\t\t\t$scope.select = \"\";\r\n\t\t});\t\t\r\n\t}\r\n\tloadIso();\r\n\tvar upload_id = 'system_iso_upload';\r\n\tvar uploadModal;\r\n\t$scope.$on(\"progress\", function(e,size){\r\n\t\t if(size.id === upload_id){\r\n\t\t \tif(uploadModal){\r\n\t\t \t\tuploadModal.close();\r\n\t\t \t\tuploadModal = undefined;\r\n\t\t \t}\r\n            $scope.progressName = size.name\r\n            $scope.isUploading = true;\r\n            $scope.progressPercent = (size.loaded / size.total * 100).toFixed(2) + \"%\";\r\n            if($scope.progressPercent === \"100.00%\"){ \r\n            \t$scope.isUploading = false;\r\n            }\r\n        }\r\n\t});\r\n\t$scope.$on(\"finishISOUpload\",function(){\r\n\t\tconsole.log(\"finished refresh\")\r\n\t\tloadIso();\r\n\t});\r\n\t$scope.upload = function(){\r\n\t\tuploadModal = $modal.open({\r\n\t\t\ttemplateUrl:\"./views/vdi/dialog/system/upload_iso.html\",\r\n\t\t\tcontroller:\"systemUploadIsoDialog\",\r\n\t\t\tresolve: {\r\n\t\t\t\tparam: function(){\r\n\t\t\t\t\treturn {\"upload_id\":upload_id}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\t$scope.abortUpload = function(){\r\n\t\tvar xhr = $rootScope.uploadPool[upload_id];\r\n        xhr && xhr.abort();\r\n        $scope.isUploading = false;\r\n\t};\r\n\t$scope.filter_iso = function(item){\r\n\t\tif(!item){\r\n\t\t\t$scope.rows = rows;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t$scope.rows = rows.filter(function(row){\r\n\t\t\treturn row.type == $scope.select;\r\n\t\t});\r\n\t};\r\n\t$scope.updateData = function(text,select){\r\n\t\t$scope.rows = rows.filter(function(row){\r\n\t\t\tif(select){\r\n\t\t\t\treturn row.type === select;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t};\r\n\t$scope.os_types = $$$os_types;\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\t$scope.change = function(item){\r\n\t\tvar new_item = JSON.parse(JSON.stringify(item));\r\n\t\tif(new_item.os_type){\r\n\t\t\tnew_item.os_type = item.support_auto_install ? item.origin_os_type : item.os_type.key;\r\n\t\t}\r\n\t\tiso.update(new_item, function(res){\r\n\t\t\trows.map(function(row){\r\n\t\t\t\tif(res.result && row.id == res.result.id){\r\n\t\t\t\t\trow.os_type = item.os_type;\r\n\t\t\t\t\trow.type = item.type;\r\n\t\t\t\t\trow.old_type = item.type;\r\n\t\t\t\t\trow.old_os_type = item.os_type;\r\n\t\t\t\t\trow.type_editable = false;\r\n\t\t\t\t\trow.os_editable = false;\r\n\t\t\t\t}\r\n\t\t\t\treturn row;\r\n\t\t\t})\r\n\t\t}).$promise.finally(function(){\r\n\t\t\tloadIso();\r\n\t\t});\r\n\t\t$scope.filter_iso($scope.select);\r\n\t};\r\n\t$scope.hideButton = function(){\r\n\t\t$scope.uploadStart = false;\r\n\t}\r\n\tvar _scope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='ISO_DELETE'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_ISO_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.name = item.name;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tiso.delete({\r\n\t\t\t\t\t\tids: [item.id]\r\n\t\t\t\t\t}, function(res){\r\n\t\t\t\t\t\tloadIso();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.edit = function(item){\r\n\t\titem.os_editable = !item.support_auto_install;\r\n\t\titem.type_editable = true;\r\n\t};\r\n\t$scope.cancel = function(item){\r\n\t\titem.type = item.old_type;\r\n\t\titem.os_type = item.old_os_type;\r\n\t\tif(!item.support_auto_install)\r\n\t\t\titem.os_editable = !item.os_editable;\r\n\t\titem.type_editable = !item.type_editable;\r\n\t};\r\n}])\r\n.controller(\"vdiSystemLogListController\", [\"$scope\", \"SystemLog\", \"$modal\", function($scope, log, $modal){\r\n\t$scope.rows = [];\r\n\t$scope.loading = true;\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesize = Number($$$storage.getSessionStorage('log_pagesize')) || 30;\r\n\t$scope.$watch(\"pagesize\" , function(newvalue){\r\n\t\t$scope.pagesize = newvalue || 0;\r\n\t\t$$$storage.setSessionStorage('alarm_pagesize', newvalue ? newvalue : 0);\r\n\t});\r\n\r\n\tvar last;\r\n\t$scope.search = function(e){\r\n\t\tlast = e.timeStamp;\r\n\t\tsetTimeout(function(){\r\n\t\t\tif(last-e.timeStamp==0){\r\n\t\t\t\tfn_get_logs($scope.searchText)\r\n\t\t\t}\r\n\t\t}, 500)\r\n\t}\r\n\r\n\tvar _start = 0;\r\n\tvar fn_get_logs = function(searchText){\r\n\t\tvar size = Number($scope.pagesize) > 0 ? Number($scope.pagesize) : 0;\r\n\t\tlog.query({\r\n\t\t\tdisplayLength: size,\r\n\t\t\tdisplayStart: ($scope.currentPage - 1) * size,\r\n\t\t\tsearch: searchText?searchText:\"\"\r\n\t\t}, function(data){\r\n\t\t\t$scope.rows = data.data.sort(function(a,b){\r\n\t\t\t\treturn b.datetime - a.datetime;\r\n\t\t\t});\r\n\t\t\t$scope.totalCount = searchText?data.totalDisplayRecords:data.totalRecords;\r\n\t\t\t$scope.loading = false;\r\n\t\t\t_start = data.displayStart;\r\n\t\t});\r\n\t};\r\n\tfn_get_logs();\r\n\r\n\t$scope.logPageSizeChange = function(){\r\n\t\t$scope.currentPage = $scope.pagesize ? Math.floor(_start / $scope.pagesize) + 1 : 0;\r\n\t\tfn_get_logs();\r\n\t};\r\n\t$scope.logPageChange = function(){\r\n\t\tfn_get_logs($scope.searchText);\r\n\t};\r\n\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_LOG'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_LOG_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tlog.delete({ids:rows.map(function(row){ return row.id })},function(data){\r\n\t\t\t\t\t\tfn_get_logs();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.deleteAll = function(){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_RIZHI'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_RIZHI_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tlog.delete({ids:'all'}, function(data){\r\n\t\t\t\t\t\tfn_get_logs();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\r\n\t};\r\n}])\r\n// .controller(\"vdiSystemEndlogListController\", [\"$scope\", \"$modal\", function($scope, $modal){\r\n// \t$scope.rows = [];\r\n// \t$scope.loading = true;\r\n\r\n//     $scope.currentPage = 1;\r\n//     $scope.pagesize = Number(localStorage.log_pagesize) || 30;\r\n// \t$scope.$watch(\"pagesize\" , function(newvalue){\r\n// \t\t$scope.pagesize = newvalue || 0;\r\n// \t\tlocalStorage.log_pagesize = newvalue ? newvalue : 0;\r\n// \t});\r\n\r\n// \tvar _start = 0;\r\n// \tvar fn_get_logs = function(){\r\n// \t\tvar size = Number($scope.pagesize) > 0 ? Number($scope.pagesize) : 0;\r\n// \t\t// log.query({\r\n// \t\t// \tdisplayLength: size,\r\n// \t\t// \tdisplayStart: ($scope.currentPage - 1) * size,\r\n// \t\t// \tsearch: \"\"\r\n// \t\t// }, function(data){\r\n// \t\t// \t$scope.rows = data.data.sort(function(a,b){\r\n// \t\t// \t\treturn b.datetime - a.datetime;\r\n// \t\t// \t});\r\n// \t\t// \t$scope.totalCount = data.totalRecords;\r\n// \t\t// \t$scope.loading = false;\r\n// \t\t// \t_start = data.displayStart;\r\n// \t\t// });\r\n// \t};\r\n// \tfn_get_logs();\r\n\r\n// \t$scope.logPageSizeChange = function(){\r\n// \t\t$scope.currentPage = $scope.pagesize ? Math.floor(_start / $scope.pagesize) + 1 : 0;\r\n// \t\tfn_get_logs();\r\n// \t};\r\n// \t$scope.logPageChange = function(){\r\n// \t\tfn_get_logs();\r\n// \t};\r\n\r\n// \t$scope.delete = function(item){\r\n// \t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\r\n// \t\t$modal.open({\r\n// \t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_LOG'>\"+\r\n// \t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_LOG_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n// \t\t\tcontroller : function($scope, $modalInstance){\r\n// \t\t\t\t$scope.ok = function(){\r\n// \t\t\t\t\t// log.delete({ids:rows.map(function(row){ return row.id })},function(data){\r\n// \t\t\t\t\t// \tfn_get_logs();\r\n// \t\t\t\t\t// });\r\n// \t\t\t\t\t$modalInstance.close();\r\n// \t\t\t\t},\r\n// \t\t\t\t$scope.close = function(){\r\n// \t\t\t\t\t$modalInstance.close();\r\n// \t\t\t\t}\r\n// \t\t\t},\r\n// \t\t\tsize : \"sm\"\r\n// \t\t});\r\n// \t};\r\n// \t$scope.deleteAll = function(){\r\n// \t\t$modal.open({\r\n// \t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_RIZHI'>\"+\r\n// \t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_RIZHI_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n// \t\t\tcontroller : function($scope, $modalInstance){\r\n// \t\t\t\t$scope.ok = function(){\r\n// \t\t\t\t\t// log.delete({ids:'all'}, function(data){\r\n// \t\t\t\t\t// \tfn_get_logs();\r\n// \t\t\t\t\t// });\r\n// \t\t\t\t\t$modalInstance.close();\r\n// \t\t\t\t},\r\n// \t\t\t\t$scope.close = function(){\r\n// \t\t\t\t\t$modalInstance.close();\r\n// \t\t\t\t}\r\n// \t\t\t},\r\n// \t\t\tsize : \"sm\"\r\n// \t\t});\r\n\r\n// \t};\r\n// }])\r\n.controller(\"vdiSystemUpgradeListController\", [\"$scope\",\"SystemUpgrade\",\"$modal\",\"$$$I18N\", \"$$$MSG\", function($scope, upgrade, $modal,$$$I18N, $$$MSG){\r\n\tfunction getList(){\r\n\t\t$scope.loading = true;\r\n\t\t$scope.rows = [];\r\n\t\tupgrade.query(function(data){\r\n\t\t\tvar _data = data.versions;\r\n\t\t\tvar new_data = {};\r\n\t\t\t _data.forEach(function(d,idx){\r\n\t\t\t \td._idx = idx;\r\n\t\t\t \t// 上传包类型\r\n\t\t\t    // d.packtype = d.owner === 'win_client' ? 'zip' : 'bin';\r\n\t\t\t\tif(d.owner === 'win_client'){\r\n\t\t\t\t\td.packtype = 'zip';\r\n\t\t\t\t}\r\n\t\t\t\telse if(d.owner === 'android_client'){\r\n\t\t\t\t\td.packtype = 'apk';\r\n\t\t\t\t}\r\n\t\t\t\telse if(d.owner.indexOf('guesttool') !== -1){\r\n\t\t\t\t\td.packtype = 'iso';\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\td.packtype = 'bin';\r\n\t\t\t\t}\r\n\t\t\t \tif(new_data[d.owner]){\r\n\t\t\t \t\tnew_data[d.owner].push(d);\r\n\t\t\t \t}else{\r\n\t\t\t \t\tnew_data[d.owner] = [d];\r\n\t\t\t \t}\r\n\t\t\t });\r\n\t\t\t Object.keys(new_data).forEach(function(i){\r\n\t\t\t \t$scope.rows.push(new_data[i]);\r\n\t\t\t });\r\n\t\t\t$scope.loading = false;\r\n\t\t});\r\n\t}\r\n\tgetList();\r\n\t$scope.viewDetail = function(witch){\r\n\t\t$modal.open({\r\n\t\t\tresolve:{\r\n\t\t\t\tmodal_data: function(){\r\n\t\t\t\t\treturn witch;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tbackdrop:'static',\r\n\t\t\tcontroller:\"systemUpgradeDetailDialog\",\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/system/system_upgrade_detail.html\",\r\n\t\t\tsize:'lg'\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\t$scope.finish = function(){\r\n\t\tgetList();\r\n\t};\r\n\t$scope.upgrade = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='升级'>\"+\r\n\t\t\t\t\t\t\t\"升级</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;'>{{ MESS }}</p><footer class='text-right'><button ng-if='!submitting' class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><img src='img/loadingtext.gif' ng-if='submitting' height='24' width='24' alt=''><button  ng-if='!submitting'  class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\tswitch(item.owner){\r\n\t\t\t\t\tcase 'win_client':\r\n\t\t\t\t\tcase 'lin_client':\r\n\t\t\t\t\tcase 'arm_client':\r\n\t\t\t\t\tcase 'android_client':\r\n\t\t\t\t\t\t\t$scope.MESS = $$$I18N.get(\"2UPGRADEMESS\");\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'console':\r\n\t\t\t\t\tcase 'agent'  :\r\n\t\t\t\t\t\t\t$scope.MESS = $$$I18N.get(\"UPGRADEMESS\");\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault : \r\n\t\t\t\t\t\t\t$scope.MESS = $$$I18N.get(\"UPGRADEMESS\");\r\n\t\t\t\t\t\t\tbreak;\t\t\r\n\t\t\t\t}\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$scope.submitting = true;\r\n\t\t\t\t\titem['auto'] = true;\r\n\t\t\t\t\tupgrade.upgrade(item, function(){\r\n\t\t\t\t\t\tgetList();\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}).$promise.finally(function(){\r\n\t\t\t\t\t\t$scope.submitting = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"md\"\r\n\t\t});\r\n\t};\r\n}])\r\n.controller(\"vdiSystemUSBListController\", [\"$scope\", \"$modal\", \"SystemUSB\", \"$$$I18N\", function($scope, $modal, systemusb, $$$I18N){\r\n\t$scope.rows = [];\r\n\t// var allRows = [];\r\n\t$scope.loading = true;\r\n\tsystemusb.get(function(res){\r\n\t\t//$scope.rows = [{id: 1, class_id: '0x00', priority: 2, rule_name: \"ffff\", product_id: \"0x1111\", vendor_id: \"0x1234\", allow: true}];\r\n\t\t$scope.rows = res.result;\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\titem.class_id = { key: item.class_id, value: $$$I18N.get(item.class_id)};\r\n\t\t});\r\n\t\t$scope.loading = false;\r\n\t\t// angular.copy($scope.rows,allRows);\r\n\t})\r\n\t\r\n\t$scope.sortClass_id = function(order){\r\n    \t$scope.rows.sort(function(a, b){\r\n\t\t\treturn (a.class_id.key > b.class_id.key) ? 1 : -1;\r\n\t\t});\r\n\t\tif(order){\r\n\t\t\t$scope.rows.reverse();\r\n\t\t}\r\n    };\r\n\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected });\r\n\t\tvar rows = $scope.rows;\r\n\t\t\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELE_USB'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELE_USB_TIP'=></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tsystemusb.delete({ids: selected_rows.map(function(row){ return row.id; })},function(res){\r\n\t\t\t\t\t\t\tselected_rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\tvar index = rows.indexOf(item);\r\n\t\t\t\t\t\t\t\trows.splice(index, 1);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t\t\r\n\t};\r\n\t// $scope.updateData = function(text){\r\n\t// \t$scope.rows = allRows.filter(function(row){\r\n\t// \t\tif(text.trim()){\r\n\t// \t\t\treturn row.rule_name.indexOf(text.trim()) !== -1;\r\n\t// \t\t}\r\n\t// \t\treturn true;\r\n\t// \t});\r\n\t// };\r\n}])\r\n// .controller(\"vdiSystemDeviceListController\", [\"$scope\", \"$modal\", \"$$$I18N\", function($scope, $modal, $$$I18N){\r\n// \t$scope.rows = [];\r\n\r\n// \tvar get_rows = function(){\r\n// \t\t$scope.rows = [{name: 'iToken S3000', made: '天地融', PID: '3d45', VID: 'df45', host: \"agent1\", desktop: \"zhujianchen\", desc: \"是的法规法规\"}];\r\n// \t};\r\n// \tget_rows();\r\n\r\n// \t$scope.transmission = function(){\r\n// \t\tvar device = this.item;\r\n// \t\tvar dialog = $modal.open({\r\n// \t\t\ttemplateUrl: \"views/vdi/dialog/system/transmission.html\",\r\n// \t\t\tcontroller: \"transmissionDialog\",\r\n// \t\t\tsize: \"sm\",\r\n// \t\t\tresolve:{\r\n// \t\t\t\tparams : function(){\r\n// \t\t\t\t\treturn { device: angular.copy(device) };\r\n// \t\t\t\t}\r\n// \t\t\t}\r\n// \t\t});\r\n// \t\tdialog.result.then(function(data){\r\n// \t\t\tif(data){\r\n// \t\t\t\tget_rows();\r\n// \t\t\t}\r\n// \t\t});\r\n// \t}\r\n\r\n// \t$scope.currentPage = 1;\r\n// \t$scope.pagesizes = [10,20,30];\r\n// \t$scope.pagesize = $scope.pagesizes[0];\r\n// }])\r\n.controller(\"transmissionDialog\",[\"$scope\",\"$modalInstance\", \"$$$I18N\", \"params\",function($scope,$modalInstance,$$$I18N,params){\r\n\t$scope.device = params.device;\r\n\r\n\t$scope.desktops = [{id: \"df\", name: 'zhujianchen'},{id: \"fg\", name: 'egg'}];\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"addSystemUSBDialog\",[\"$scope\",\"$modalInstance\", \"SystemUSB\",\"$$$I18N\", function($scope,$modalInstance,systemusb, $$$I18N){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.data = { allow: 'true' };\r\n\t$scope.types = [];\r\n\tvar keys = ['0x01','0x02','0x03','0x05','0x06','0x07','0x08','0x09','0x0A','0x0B','0x0D','0x0E','0x0F','0x10','0x11','0xDC','0xE0','0xEF','0xFE','0xFF','-1'];\r\n\tkeys.forEach(function(item){\r\n\t\t$scope.types.push({key: item, value: $$$I18N.get(item)})\r\n\t});\r\n\t$scope.data.class_id = $scope.types[0];\r\n\t$scope.master = { allow: true, class_id: $scope.types[0]};\r\n\t$scope.reset = function() {\r\n\t\t$scope.data = $scope.master;\r\n\t};\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.master,$scope.data);\r\n\t}\r\n\t$scope.ok = function(){\r\n\t\tsystemusb.save({\r\n\t\t\tclass_id: $scope.data.class_id.key,\r\n\t\t\tpriority: $scope.data.priority,\r\n\t\t\trule_name: $scope.data.rule_name,\r\n\t\t\tproduct_id: $scope.data.product_id == '-1'? $scope.data.product_id: \"0x\" + $scope.data.product_id,\r\n\t\t\tvendor_id: $scope.data.vendor_id == '-1'? $scope.data.vendor_id: \"0x\" + $scope.data.vendor_id,\r\n\t\t\tallow: $scope.data.allow==\"true\"?true:false\r\n\t\t}, function(res){\r\n\t\t\tsystemusb.get(function(res){\r\n\t\t\t\tres.result.forEach(function(item){\r\n\t\t\t\t\titem.class_id = { key: item.class_id, value: $$$I18N.get(item.class_id)};\r\n\t\t\t\t})\r\n\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.rows,res.result);\r\n\t\t\t})\r\n\t\t\t\r\n\t\t});\r\n\t\t$modalInstance.close();\r\n\t}\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"editSystemUSBDialog\",[\"$scope\",\"$modalInstance\", \"SystemUSB\",\"$$$I18N\", function($scope,$modalInstance,systemusb, $$$I18N){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.types = [];\r\n\tvar keys = ['0x01','0x02','0x03','0x05','0x06','0x07','0x08','0x09','0x0A','0x0B','0x0D','0x0E','0x0F','0x10','0x11','0xDC','0xE0','0xEF','0xFE','0xFF','-1'];\r\n\tkeys.forEach(function(item){\r\n\t\t$scope.types.push({key: item, value: $$$I18N.get(item)})\r\n\t});\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\tif(item.product_id.indexOf(\"0x\")>-1){\r\n\t\titem.product_id = item.product_id == -1? \"-1\": item.product_id.substring(2);\r\n\t}\r\n\tif(item.vendor_id.indexOf(\"0x\")>-1){\r\n\t\titem.vendor_id = item.vendor_id == -1? \"-1\": item.vendor_id.substring(2);\r\n\t}\r\n\t$scope.data = angular.copy(item);\r\n\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem);\r\n\t};\r\n\r\n\t$scope.ok = function() {\r\n\t\tsystemusb.update(\r\n\t\t{\t\r\n\t\t\tgroup_id: $scope.data.id,\r\n\t\t\tclass_id: $scope.data.class_id.key,\r\n\t\t\tpriority: $scope.data.priority,\r\n\t\t\trule_name: $scope.data.rule_name,\r\n\t\t\tproduct_id: $scope.data.product_id == '-1'? $scope.data.product_id: \"0x\" + $scope.data.product_id,\r\n\t\t\tvendor_id: $scope.data.vendor_id == '-1'? $scope.data.vendor_id: \"0x\" + $scope.data.vendor_id,\r\n\t\t\tallow: $scope.data.allow\r\n\t\t},\r\n\t\t\tfunction(res){\r\n\t\t\t\tsystemusb.get(function(res){\r\n\t\t\t\t\tres.result.forEach(function(item){\r\n\t\t\t\t\t\titem.class_id = { key: item.class_id, value: $$$I18N.get(item.class_id)};\r\n\t\t\t\t\t})\r\n\t\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.rows,res.result);\r\n\t\t\t\t})\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},\r\n\t\t\tfunction(){  }\r\n\t\t);\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"systemUpgradeDetailDialog\", [\"$scope\", \"SystemUpgrade\",\"modal_data\",\"$modalInstance\",function($scope, SystemUpgrade,modal_data,$modalInstance){\r\n\r\n\tSystemUpgrade.query({owner:modal_data},function(res){\r\n\t\t$scope.rows = res.result;\r\n\t});\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t}\r\n}])\r\n.controller('vdiSystemDesktopDetailController', ['$scope','$modal','SystemDesktop','$routeParams','$interval','$filter','$$$os_types','VMCommon','PersonDesktop','$$$I18N',\r\n\tfunction($scope,$modal,SystemDesktop,$routeParams,$interval,$filter,$$$os_types,vm, person_desktop,$$$I18N){\r\n\t$scope.$root && $scope.$root.$broadcast(\"navItemSelected\", [\"系统\", \"系统桌面\",\"桌面详情\"]);\r\n\r\n    $interval(function(){\r\n\t\t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"instanceIDS\", $filter(\"paging\")($scope.rows, $scope.currentPage, $scope.pagesize).map(item => item.id));\r\n\t}, 1000);\r\n\t$scope.$on(\"instancesRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\t\r\n\t$scope.refresh = (_s = $scope) => {\r\n\t\tvar _id = $routeParams.id;\r\n\t\t_s.select = ''\r\n\t\tSystemDesktop.get_instances({id: _id}, res => {\r\n\t\t\t_s.rows = res.result.result;\r\n\t\t\t_s.allRows = res.result.result;\r\n\t\t\t_s.rows.forEach(row => {\r\n\t\t\t\tlet os = $$$os_types.filter(item => item.key === row.os_type)[0];\r\n\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t});\r\n\t\t\t_s.loading = false;\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.pagesize = Number($$$storage.getSessionStorage('personl_pagesize')) || 30;\r\n\t$scope.currentPage = 1;\r\n\r\n\t$scope.$watch(\"pagesize\",function(newvalue){\r\n\t\t$$$storage.setSessionStorage('personl_pagesize', newvalue);\r\n\t});\r\n\r\n\t$scope.loading = true;\r\n\t$scope.rows = [];\r\n\t$scope.refresh();\r\n\r\n\t$scope.changeStatus = function(){\r\n\t\t$scope.rows = $filter(\"filter\")($scope.allRows,$scope.select).map(item => { item._selected = false;return item });\r\n\t};\r\n\r\n\tvar _controllerScope = $scope;\t\r\n\t$scope.start = item => {\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'shutdown' || row.status == 'suspended'); });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP1\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tvm.start({instance_ids: rows.map(row => \r\n\t\t\t\t{row.status = \"building\";return row.instance_id})}, () => \r\n\t\t\t{$scope.refresh();});\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.forceShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended'); });\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP2\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\tvm.shutdowns({instance_ids: rows.map(row => {\r\n\t\t\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t\t\t\trow.status = \"building\";\r\n\t\t\t\t\t\t\t\t\treturn row.instance_id;\r\n\t\t\t\t\t\t\t\t})},() => { _controllerScope.refresh()});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.natureShutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended'); })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP3\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>\"+\r\n\t\t\t\t\t\t\t\"桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t\trow.status = \"building\" ;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.shutdowns({is_soft:'true',instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.restart = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && (row.status == 'running' || row.status == 'suspended'); })\r\n\t\tif(rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP4\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>\"+\r\n\t\t\t\t\t\t\t\"桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\t\t\t\t\t\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t\trow.status = \"building\";\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.reboots({is_soft:'true',instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.pause = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'running'; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP5\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>\"+ \r\n\t\t\t\t\t\t\"桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t\trow.status = \"building\";\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.pause({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t$scope.resume = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && row.status == 'paused'; })\r\n\t\tif(rows.length ==0 ){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"vdiDesktopPersonalList_TIP6\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>\"+\r\n\t\t\t\t\t\t\"桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\trows.map(function(row){\r\n\t\t\t\t\t\t\trow._selected = false;\r\n\t\t\t\t\t\t\trow.status = \"building\";\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tvm.resume({instance_ids: rows.map(function(row){ return row.instance_id; })},function(){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected });\r\n\t\tvar is_running = rows.some(function(row){ return row.status == 'running'});\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面删除'>\"+\r\n\t\t\t\t\t\"桌面删除</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-show='!is_run' style='margin-bottom:20px;' localize='桌面删除后无法恢复，确定删除桌面吗'>桌面删除后无法恢复，确定删除桌面吗?</p><p ng-show='is_run' style='margin-bottom:20px;' localize='存在未关机的桌面，仍然删除桌面吗'>存在未关机的桌面，仍然删除桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.is_run = is_running;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tperson_desktop.delete({instance_ids: rows.map(function(row){ return row.instance_id; })}, function(data){\r\n\t\t\t\t\t\trows.forEach(function(r){\r\n\t\t\t\t\t\t\t_controllerScope.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\t\t\t\r\n\t};\r\n\r\n\t$scope.add = function(){\r\n\t\tvar instance = $modal.open({\r\n\t\t\t\ttemplateUrl:\"views/vdi/dialog/system/system_desktop_add.html\",\r\n\t\t\t\tcontroller:\"systemDesktopAddDialog\",\r\n\t\t\t\tsize:\"md\"\r\n\t\t\t});\r\n\t\t\tinstance.result.then(function(){\r\n\t\t\t\t_controllerScope.refresh();\r\n\t\t\t});\r\n\t\t};\r\n\t\r\n\t$scope.config = function(item){\r\n\t\tvar instance = $modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/system/system_desktop_config.html\",\r\n\t\t\tcontroller:\"systemDesktopConfigDialog\",\r\n\t\t\tsize:\"md\",\r\n\t\t\tresolve:{param:function(){\r\n\t\t\t\treturn item;\r\n\t\t\t}}\r\n\t\t});\r\n\t\tinstance.result.then(function(){\r\n\t\t\t_controllerScope.refresh();\r\n\t\t});\r\n\t};\r\n}])\r\n.controller('systemDesktopConfigDialog', ['$scope','param','SystemDesktop','Host','$filter','$modalInstance',\r\n function($scope, param, SystemDesktop,Host,$filter,$modalInstance){\r\n\t$scope.data = {\r\n\t\tid:param.id,\r\n\t\tmemory_mb:param.memory_mb/1024,\r\n\t\tcpu_num:param.vcpu,\r\n\t\thostname:param.hostname\r\n\t};\r\n\t$scope.host_loading = true;\r\n\t\r\n\r\n\t$scope.get_devices = function(hostname){\r\n\t\tSystemDesktop.get_devices({host:hostname},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.devices = res.result.filter(function(item){ return item.status === \"available\"});\r\n\t\t});\r\n\t};\r\n\t$scope.get_devices($scope.data.hostname);\r\n\t$scope.selectAllHost = function(bool){\r\n\t\t$scope.devices.map(function(item){\r\n\t\t\titem._selected = bool;\r\n\t\t\treturn item;\r\n\t\t});\r\n\t};\r\n\t$scope.selectOneHost = function(){\r\n\t\t$scope.data.is_all = $scope.devices.every(function(item){\r\n\t\t\treturn item._selected === true;\r\n\t\t});\r\n\t};\r\n\t$scope.ok = function(){\r\n\t\tvar devices = $filter(\"selectedFilter\")($scope.devices);\r\n\t\tvar node = $scope.data.is_cancel ? -1 : devices.map(function(item){ return item.compute_node_id });\r\n\t\tvar addr = $scope.data.is_cancel ? -1 : devices.map(function(item){ return item.address});\r\n\t\tvar postData ={\r\n\t\t\tid:$scope.data.id,\r\n\t\t\tis_auto_up:$scope.data.is_on,\r\n\t\t\tpci_devices_node:node,\r\n\t\t\tpci_devices_address:addr,\r\n\t\t\tcpu:$scope.data.cpu_num,\r\n\t\t\tram:$scope.data.memory_mb\r\n\t\t};\r\n\t\t$scope.loading = true;\r\n\t\tSystemDesktop.config_instances(postData,function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller('systemDesktopAddDialog', ['$scope','Host','$filter','SystemDesktop','$modalInstance','$routeParams',\r\n\tfunction($scope, Host ,$filter,SystemDesktop, $modalInstance, $routeParams){\r\n\t\t\r\n\t$scope.data = {};\r\n\t$scope.host_loading = true;\r\n\tHost.query({ type: 'kvm' }, function(res){\r\n\t\t$scope.hosts = res.hosts_list.filter(function(host){ return host.status == 'active'});\r\n\t}).$promise.finally(function(){\r\n\t\t$scope.host_loading = false;\r\n\t});\r\n\t$scope.selectAllHost = function(bool){\r\n\t\t$scope.hosts.map(function(item){\r\n\t\t\titem._selected = bool;\r\n\t\t\treturn item;\r\n\t\t});\r\n\t};\r\n\t$scope.selectOneHost = function(){\r\n\t\t$scope.data.is_all = $scope.hosts.every(function(item){\r\n\t\t\treturn item._selected === true;\r\n\t\t});\r\n\t};\r\n\t$scope.ok = function(){\r\n\t\tvar _id = $routeParams.id ? $routeParams.id : $scope.creat_item.id;\r\n\t\tvar postData = {\r\n\t\t\tid:_id,\r\n\t\t\tname: $scope.data.name,\r\n\t\t\thost_ids: $filter(\"selectedFilter\")($scope.hosts).map(function(item){ return item.id }),\r\n\t\t\tcpu: $scope.data.cpu_num,\r\n\t\t\tram: $scope.data.memory_mb\r\n\t\t};\r\n\t\t$scope.loading = true;\r\n\t\tSystemDesktop.add_instances(postData,function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t});\r\n\t};\r\n\t$scope.close =function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n\t\r\n}])\r\n\r\n.controller('systemTemplateConfigDialog', ['$scope','$modalInstance','param','SystemDesktop','$filter','TeachTemplate', \"Network\", \"$$$I18N\",function($scope, $modalInstance, param, SystemDesktop, $filter, TeachTemplate, Network, $$$I18N){\r\n\tvar me = this;\r\n\t$scope.min_namelength=2;\r\n\t$scope.max_namelength=20;\r\n\t$scope.data = {\r\n\t\tinstance_id:param.instance_id,\r\n\t\tid:param.id,\r\n\t\tcpu_num: 1,\r\n\t\tmemory_mb: 1\r\n\t};\r\n\t$scope.host_loading = true;\r\n\t\r\n\t$scope.multifyNetsTips = $$$I18N.get('multifyNetsTips');\r\n\r\n\tTeachTemplate.infor({image_id:$scope.data.id},function(res){\r\n\t\t$scope.data.cpu_num = res.vcpus;\r\n\t\t$scope.data.memory_mb = res.ram/1024;\r\n\t\t$scope.data.display_name = res.name;\r\n\t\t$scope.data.type = res.type_code;\r\n\t\t$scope.data.host = res.host;\r\n\t\t$scope.data.start_on_host_boot = res.start_on_host_boot;\r\n\t\t$scope.get_devices($scope.data.host);\r\n\t\tres.nets.forEach(function(net){\r\n\t\t\tgetNetwork(net, new Date());\r\n\t\t});\r\n\t});\r\n\r\n\t$scope.nets = [];\r\n\t$scope.IPmodes1 = [{name: $$$I18N.get('不分配'), value: 0}];\r\n\t$scope.IPmodes2 = [{name: $$$I18N.get('系统分配'), value: 1},{name: $$$I18N.get('固定IP'), value: 2}];\r\n\tfunction getNetwork(net, key){\r\n\t\t$scope.network_loading = true;\r\n\t\tNetwork.query(function(data){\r\n\t\t\tif(data.networks.length){\r\n\t\t\t\tvar _network = net?data.networks.filter(function(n){ return n.id == net.network_id })[0]:data.networks[0];\r\n\t\t\t\t$scope.nets.push({key: key, networks: data.networks, network: _network});\r\n\t\t\t\t$scope.get_subnet(net, _network, key);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t$scope.get_subnet = function(net, network, key){\r\n\t\tif(network.subnets.length){\r\n\t\t\tNetwork.query_sub({\r\n\t\t\t\tid:network.id\r\n\t\t\t},function(res){\r\n\t\t\t\tvar subnetworks = [];\r\n\t\t\t\tsubnetworks = res.result.map(function(n){\r\n\t\t\t\t\tn._desc = n.start_ip ?(n.name + \" (\" + n.start_ip +\" - \"+ n.end_ip + \") \") :  n.name;\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t});\r\n\t\t\t\t$scope.nets.forEach(function(item){\r\n\t\t\t\t\tif(item.key===key){\r\n\t\t\t\t\t\titem.subnetworks = subnetworks;\r\n\t\t\t\t\t\tvar _subnetwork;\r\n\t\t\t\t\t\tif(net){\r\n\t\t\t\t\t\t\t _subnetwork = net.subnet_id?subnetworks.filter(function(n){ return n.id == net.subnet_id })[0]:null;\r\n\t\t\t\t\t\t}else{ _subnetwork = subnetworks[0] };\r\n\t\t\t\t\t\titem.subnetwork = _subnetwork;\r\n\t\t\t\t\t\t$scope.clearBindIp(net, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$scope.network_loading = false;\r\n\t\t\t$scope.nets.forEach(function(item){\r\n\t\t\t\tif(item.key===key){\r\n\t\t\t\t\titem.subnetworks = [];\r\n\t\t\t\t\titem.subnetwork = null;\r\n\t\t\t\t\t$scope.clearBindIp(net,key);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.clearBindIp = function(net, key){\r\n\t\t$scope.nets.forEach(function(item){\r\n\t\t\tif(item.key===key){\r\n\t\t\t\tif(item.subnetwork){\r\n\t\t\t\t\titem.IPmodes = $scope.IPmodes2;\r\n\t\t\t\t\tif(net.ip_address){\r\n\t\t\t\t\t\titem.IPmode= item.IPmodes[1];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\titem.IPmode= item.IPmodes[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\titem.IPmodes = $scope.IPmodes1;\r\n\t\t\t\t\titem.IPmode= item.IPmodes[0];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\titem.ip = net.ip_address;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.addNet = function(){\r\n\t\tgetNetwork(false, new Date());\r\n\t};\r\n\t$scope.minusNet = function(i){\r\n\t\tvar idx = $scope.nets.indexOf(i)\r\n\t\t$scope.nets.splice(idx,1);\r\n\t};\r\n\t$scope.get_devices = function(hostname){\r\n\t\tSystemDesktop.get_devices({host:hostname},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.devices = res.result.filter(function(item){ return item.status === \"available\"});\r\n\t\t});\r\n\t};\r\n\t$scope.selectAllHost = function(bool){\r\n\t\t$scope.devices.map(function(item){\r\n\t\t\titem._selected = bool;\r\n\t\t\treturn item;\r\n\t\t});\r\n\t};\r\n\t$scope.selectOneHost = function(){\r\n\t\t$scope.data.is_all = $scope.devices.every(function(item){\r\n\t\t\treturn item._selected === true;\r\n\t\t});\r\n\t};\r\n\r\n\t// 判断网络数组中两两是否有两个相同的子网id\r\n\tfunction giveTip(array){\r\n\t\tvar flag = false;\r\n\t\tarray.forEach(function(item, index){\r\n\t\t for(var i=index+1; i<array.length; i++){\r\n\t\t\tconsole.log(array[index],array[i]);\r\n\t\t\tif(array[index]['subnetwork']['id'] == array[i]['subnetwork']['id']){\r\n\t\t\t\tflag = true;\r\n\t\t\t}\r\n\t\t  }\r\n\t\t});\r\n\t\treturn flag;\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar me = this, alertTip = giveTip(me.nets);\r\n\t\tvar devices = $filter(\"selectedFilter\")($scope.devices);\r\n\t\tvar node = $scope.data.is_cancel ? -1 : devices.map(function(item){ return item.compute_node_id });\r\n\t\tvar addr = $scope.data.is_cancel ? -1 : devices.map(function(item){ return item.address});\r\n\t\tvar postData = {\r\n\t\t\timage_id:$scope.data.id,\r\n\t\t\tinstance_id:$scope.data.instance_id,\r\n\t\t\tdisplay_name:$scope.data.display_name,\r\n\t\t\ttype_code: this.data.type,\r\n\t\t\tnetwork: this.nets.map(function(item){ if(!item.network.id) return \"\"; else return item.network.id }),\r\n\t\t\tsubnet: this.nets.map(function(item){ if(!item.subnetwork) return \"\"; else return item.subnetwork.id }),\r\n\t\t\tband_ip: this.nets.map(function(item){ if(!item.ip) return \"\"; else return item.ip }),\r\n\t\t\tpci_devices_node:node,\r\n\t\t\tpci_devices_address:addr,\r\n\t\t\tvcpus:$scope.data.cpu_num,\r\n\t\t\tram:$scope.data.memory_mb,\r\n\t\t\tstart_on_host_boot: $scope.data.start_on_host_boot\r\n\t\t};\r\n\t\tif(alertTip){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent:$$$I18N.get(\"不同网卡上不能存在相同网段的IP\"),\r\n\t\t\t\ttimeout:6000\r\n\t\t\t});\r\n\t\t\treturn false ;\r\n\t\t}\r\n\t\t$scope.loading = true;\r\n\t\tSystemDesktop.edit(postData,function(res){\r\n\t\t\t$modalInstance.close();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.loading = false;\r\n\t\t});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller('systemBackupConfigController', ['$scope','$modalInstance','SystemBackup', function($scope, $modalInstance,SystemBackup){\r\n\t$scope.data = {};\r\n\tSystemBackup.get_config(function(res){\r\n\t\t$scope.data = res.result;\r\n\t\tvar initTime = new Date();\r\n\t\t$scope.data.backup_weekday = $scope.data.backup_weekday  || \"\";\r\n\t\t$scope.data.backup_time = $scope.data.backup_time  || initTime;\r\n\t});\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.ok = function(){\r\n\t\t$scope.submiting = true;\r\n\t\tSystemBackup.alter_config($scope.data , function(){\r\n\t\t\t$modalInstance.close();\r\n\t\t}).$promise.finally(function(){\r\n\t\t\t$scope.submiting = false;\r\n\t\t});\r\n\t};\r\n}])\r\n.controller(\"vdiSystemOutsideController\", [\"$scope\", \"$modal\", \"$$$I18N\", \"Outside\", 'AlarmPlicy', function($scope, $modal, $$$I18N, Outside, AlarmPlicy){\r\n\t$scope.enable_loading = false;\r\n\t$scope.save_loading = false;\r\n\t$scope.ips_loading = true;\r\n\r\n\tOutside.query(function(res){\r\n\t\t// var res = {\r\n\t\t// \tenable: true,\r\n\t\t// \tproxy_ip: \"10.1.41.188\",\r\n\t\t// \tcomputer_ips: [\"10.1.41.17\"]\r\n\t\t// };\r\n\t\t// var res = {\r\n\t\t// \tenable: false,\r\n\t\t// \tproxy_ip: \"\",\r\n\t\t// \tcomputer_ips: []\r\n\t\t// };\r\n\t\t$scope.enable = res.enable;\r\n\t\t$scope.IP = res.proxy_ip;\r\n\t\t$scope.hasIP = res.proxy_ip==''?false:true;\r\n\t\t$scope.computer_ips = res.computer_ips;\r\n\r\n\t\tAlarmPlicy.get_hosts(function(result){\r\n\t\t\t$scope.ips_loading = false;\r\n\t\t\t// var consoleIP = result.result.filter(function(r){ return r.type==\"control\"; })[0].hosts[0].ip;\r\n\t\t\t// result.result.forEach(function(item){\r\n\t\t\t// \titem.hosts = item.hosts.filter(function(i){ return i.ip!==consoleIP })\r\n\t\t\t// });\r\n\t\t\t$scope.pools = result.result.filter(function(r){\r\n\t\t\t\treturn r.hosts.length && r.type!==\"control\";\r\n\t\t\t});\r\n\t\t});\r\n\t})\r\n\r\n\t$scope.start = function(){\r\n\t\tif(!$scope.enable){\r\n\t\t\t$scope.enable_loading = true;\r\n\t\t\tOutside.stop(function(res){\r\n\t\t\t\t$scope.enable_loading = false;\r\n\t\t\t\t$scope.IP = null;\r\n\t\t\t\t$scope.computer_ips = [];\r\n\t\t\t},function(error){\r\n\t\t\t\t$scope.enable_loading = false;\r\n\t\t\t\t$scope.enable = !$scope.enable;\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t$scope.save = function(){\r\n\t\tvar computer_ips = [];\r\n\t\tif(!$scope.hasIP){\r\n\t\t\t$scope.pools.forEach(function(item){\r\n\t\t\t\titem.hosts.forEach(function(host){\r\n\t\t\t\t\tcomputer_ips.push(host.ip);\r\n\t\t\t\t})\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.pools.forEach(function(item){\r\n\t\t\t\titem.hosts.forEach(function(host){\r\n\t\t\t\t\tvar is_selected = $scope.computer_ips.filter(function(i){ return i === host.ip }).length;\r\n\t\t\t\t\tif(is_selected){\r\n\t\t\t\t\t\tcomputer_ips.push(host.ip)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(computer_ips.length){\r\n\t\t\t$scope.save_loading = true;\r\n\t\t\tOutside.save({\r\n\t\t\t\tproxy_ip: $scope.IP,\r\n\t\t\t\tcomputer_ips: computer_ips\r\n\t\t\t}, function(res){\r\n\t\t\t\t$scope.hasIP = true;\r\n\t\t\t\t$scope.save_loading = false;\r\n\t\t\t\t$scope.computer_ips = computer_ips;\r\n\t\t\t},function(error){\r\n\t\t\t\t$scope.save_loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"NO_OUSIDEIP\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}])\r\n.controller('outsideAdvancedDialog', ['$scope','$modalInstance', 'AlarmPlicy', \"Outside\", function($scope, $modalInstance, AlarmPlicy, Outside){\r\n\t$scope.ips_loading = true;\r\n\t$scope.isSubmiting = false;\r\n\tAlarmPlicy.get_hosts(function(result){\r\n\t\t$scope.ips_loading = false;\r\n\r\n\t\t// var consoleIP = result.result.filter(function(r){ return r.type==\"control\"; })[0].hosts[0].ip;\r\n\t\t// result.result.forEach(function(item){\r\n\t\t// \titem.hosts = item.hosts.filter(function(i){ return i.ip!==consoleIP })\r\n\t\t// });\r\n\t\tvar pools = result.result.filter(function(r){\r\n\t\t\treturn r.hosts.length && r.type!==\"control\";\r\n\t\t});\r\n\t\t$scope.pools.splice(0);\r\n\t\tArray.prototype.push.apply($scope.pools, pools);\r\n\r\n\t\tif(!$scope.hasIP){\r\n\t\t\t$scope.pools.forEach(function(item){\r\n\t\t\t\titem.hosts.forEach(function(host){\r\n\t\t\t\t\thost._selected = true;\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.pools.forEach(function(item){\r\n\t\t\t\titem.hosts.forEach(function(host){\r\n\t\t\t\t\tvar is_selected = $scope.computer_ips.filter(function(i){ return i === host.ip }).length;\r\n\t\t\t\t\tif(is_selected){\r\n\t\t\t\t\t\thost._selected = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t}\r\n\t\t$scope.pools.forEach(function(item){\r\n\t\t\tvar selected_length = item.hosts.filter(function(host){ return host._selected }).length;\r\n\t\t\tif(selected_length == item.hosts.length){\r\n\t\t\t\titem._selected = true;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t$scope.checkOne = function(pool){\r\n\t    pool._selected = pool.hosts.every(function(h){ return h._selected});\r\n\t};\r\n\t$scope.checkAll = function(pool){\r\n\t    pool.hosts.forEach(function(h){\r\n\t        h._selected = pool._selected;\r\n\t    });\r\n\t};\r\n\t$scope.checked = function(){\r\n\t\tvar computer_ips = []\r\n\t\t$scope.pools && $scope.pools.forEach(function(item){\r\n\t\t\titem.hosts.forEach(function(host){\r\n\t\t\t\tif(host._selected){\r\n\t\t\t\t\tcomputer_ips.push(host.ip)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t\treturn computer_ips.length?true:false;\r\n\t};\r\n\t$scope.ok = function(){\r\n\t\tvar computer_ips = []\r\n\t\t$scope.pools.forEach(function(item){\r\n\t\t\titem.hosts.forEach(function(host){\r\n\t\t\t\tif(host._selected){\r\n\t\t\t\t\tcomputer_ips.push(host.ip)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t\t$scope.isSubmiting = true;\r\n\t\tOutside.save({\r\n\t\t\tproxy_ip: $scope.IP,\r\n\t\t\tcomputer_ips: computer_ips\r\n\t\t}, function(res){\r\n\t\t\t$scope.hasIP = true;\r\n\t\t\t$scope.computer_ips.splice(0);\r\n\t\t\tArray.prototype.push.apply($scope.computer_ips,computer_ips);\r\n\t\t\t$modalInstance.close();\r\n\t\t\t$scope.isSubmiting = false;\r\n\t\t},function(error){\r\n\r\n\t\t})\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller(\"systemUploadIsoDialog\", ['$scope','$modalInstance','param','$rootScope',function($scope,$modalInstance,param,$rootScope){\r\n\t$scope.id = param.upload_id;\r\n\t$scope.finishUpload = function(){\r\n\t\t$rootScope.$broadcast(\"finishISOUpload\");\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t}\r\n}])\r\n/**\r\n * [description vdiSystemRecycleController 系统资源回收控制器]\r\n */\r\n.controller('vdiSystemRecycleController', ['$scope','$modal','$location','$route','RecycleTech','RecyclePer',function($scope,$modal,$location,$route,RecycleTech,RecyclePer){\r\n\tvar RecycleCtrl=this;\r\n\tRecycleCtrl.data={},RecycleCtrl.submit={};\r\n\r\n\tRecycleCtrl.setTechDefault = function(val){\r\n\t\tRecycleCtrl.tecSave(true);\r\n\t}\r\n\tRecycleCtrl.getTech = function(){\r\n\t\tRecycleCtrl.techLoading = true;\r\n\t\tRecycleTech.query(function(res){\r\n\t\t\tRecycleCtrl.data.tecOpen = res.value.active;\r\n\t\t\tRecycleCtrl.data.tecDesk = res.value.broken_min;\r\n\t\t\tRecycleCtrl.data.tecStatus = res.value.run;\r\n\t\t\tRecycleCtrl.techLoading = false;\r\n\t\t},function(){ RecycleCtrl.techLoading = false; })\r\n\t}\r\n\tRecycleCtrl.getTech();\r\n\tRecycleCtrl.tecSave=function(onlyEnable){\r\n\t\t//提交请求\r\n\t\tif(onlyEnable){\r\n\t\t\tRecycleCtrl.techenabling = true;\r\n\t\t\tRecycleTech.save({value: {active:RecycleCtrl.data.tecOpen}},function(res){\r\n\t\t\t\tRecycleCtrl.techenabling = false;\r\n\t\t\t\tRecycleCtrl.getTech();\r\n\t\t\t\tif(!RecycleCtrl.data.tecOpen){\r\n\t\t\t\t\tRecycleCtrl.techEdit = false;\r\n\t\t\t\t}\r\n\t\t\t},function(){ RecycleCtrl.techenabling = false; })\r\n\t\t}else{\r\n\t\t\tRecycleCtrl.data.tecDesk = Number(RecycleCtrl.data.tecDesk);\r\n\t\t\tvar params={\r\n\t\t\t\tactive:RecycleCtrl.data.tecOpen,\r\n\t\t\t\tbroken_min:RecycleCtrl.data.tecDesk,\r\n\t\t\t\trun:RecycleCtrl.data.tecStatus\r\n\t\t\t};\r\n\t\t\tRecycleCtrl.techSave = true;\r\n\t\t\tRecycleTech.save({value:params},function(res){\r\n\t\t\t\tRecycleCtrl.techSave = false;\r\n\t\t\t\tRecycleCtrl.techEdit = false;\r\n\t\t\t},function(){ RecycleCtrl.techSave = false; })\r\n\t\t}\r\n\t}\r\n\r\n\tRecycleCtrl.setPerDefault = function(val){\r\n\t\tRecycleCtrl.perSave(true);\r\n\t}\r\n\tRecycleCtrl.getPerson = function(){\r\n\t\tRecycleCtrl.personLoading = true;\r\n\t\tRecyclePer.query(function(res){\r\n\t\t\tRecycleCtrl.submit.perOpen = res.value.active;\r\n\t\t\tRecycleCtrl.submit.perDesk = res.value.broken_min/60;\r\n\t\t\tRecycleCtrl.submit.perStatus = res.value.run;\r\n\t\t\tRecycleCtrl.personLoading = false;\r\n\t\t},function(){ RecycleCtrl.personLoading = false; })\r\n\t}\r\n\tRecycleCtrl.getPerson();\r\n\tRecycleCtrl.perSave = function(onlyEnable){\r\n\t\t//提交请求\r\n\t\tif(onlyEnable){\r\n\t\t\tRecycleCtrl.perenabling = true;\r\n\t\t\tRecyclePer.save({value: {active:RecycleCtrl.submit.perOpen}},function(res){\r\n\t\t\t\tRecycleCtrl.perenabling = false;\r\n\t\t\t\tRecycleCtrl.getPerson();\r\n\t\t\t\tif(!RecycleCtrl.submit.perOpen){\r\n\t\t\t\t\tRecycleCtrl.personEdit = false;\r\n\t\t\t\t}\r\n\t\t\t},function(){ RecycleCtrl.perenabling = false; })\r\n\t\t}else{\r\n\t\t\tRecycleCtrl.submit.perDesk = Number(RecycleCtrl.submit.perDesk);\r\n\t\t\tvar params={\r\n\t\t\t\tactive:RecycleCtrl.submit.perOpen,\r\n\t\t\t\tbroken_min:RecycleCtrl.submit.perOpen?RecycleCtrl.submit.perDesk*60:undefined,\r\n\t\t\t\trun:RecycleCtrl.submit.perOpen?RecycleCtrl.submit.perStatus:undefined\r\n\t\t\t};\r\n\t\t\tRecycleCtrl.personSave = true;\r\n\t\t\tRecyclePer.save({value:params},function(res){\r\n\t\t\t\tRecycleCtrl.personSave = false;\r\n\t\t\t\tRecycleCtrl.personEdit = false;\r\n\t\t\t},function(){ RecycleCtrl.personSave = false; })\r\n\t\t}\r\n\t}\r\n}])\r\n\r\n/**\r\n * [description vdiSystemtimeSyncController 系统时间同步控制器]\r\n */\r\n.controller('vdiSystemtimeSyncController', ['$scope','$modal','$route','SystemTime','$$$I18N','formDate',function($scope,$modal,$route,SystemTime,$$$I18N,formDate){\r\n\tvar SyncCtrl=this;\r\n\t// var oldSyncServer;\r\n\tSystemTime.getInternetSync(function(res){\r\n\t\tSyncCtrl.internetSync = res.enable;\r\n\t},function(){});\r\n\r\n\tSyncCtrl.setInternetSync = function(value){\r\n\t\tSyncCtrl.loading_internet = true;\r\n\t\tSystemTime.internetSync({enable: value}, function(){\r\n\t\t\tSyncCtrl.loading_internet = false;\r\n\t\t},function(){ SyncCtrl.loading_internet = false; })\r\n\t\tif(value){\r\n\t\t\tSyncCtrl.updateSyncServer();\r\n\t\t}\r\n\t};\r\n\t\r\n\tSystemTime.querySyncServer(function(res){\r\n\t\tSyncCtrl.servers = res.result;\r\n\t\tSyncCtrl.server = res.used!==''?res.used:res.result[0];\r\n\t\t// 保持对旧 server 引用\r\n        // oldSyncServer = res.used;\r\n\t},function(){});\r\n\r\n\t// SyncCtrl.isSyncServerChanged = function(){\r\n\t// \t// 不允许选择空值\r\n\t// \tif(!this.server) { return false; }\r\n\t// \t// 判断变化\r\n\t// \tif(oldSyncServer) {\r\n\t// \t\treturn oldSyncServer !== this.server;\r\n\t// \t}\r\n\t// };\r\n\r\n\tSyncCtrl.updateSyncServer = function(){\r\n\t\tSyncCtrl.loading_updateServer = true;\r\n\t\tSystemTime.updateSyncServer({time_server: SyncCtrl.server},function(res){\r\n\t\t\t// oldSyncServer = SyncCtrl.server;\r\n\t\t\tSyncCtrl.loading_updateServer = false;\r\n\t\t\tSyncCtrl.loadZone();\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent : $$$I18N.get(\"同步时间成功\"),\r\n\t\t\t\ttimeout : 6000\r\n\t\t\t});\r\n\t\t},function(){\r\n\t\t\tSyncCtrl.loading_updateServer = false;\r\n\t\t\tSyncCtrl.loadZone();\r\n\t\t})\r\n\t}\r\n\t\r\n\t// 时区\r\n\tSyncCtrl.startDateOptions = {\r\n\t\tformatYear: 'yyyy-MM-dd',\r\n\t\tstartingDay: 1\r\n\t};\r\n\tSyncCtrl.openStartDate=function($event){\r\n\t\t$event.preventDefault();\r\n\t\t$event.stopPropagation();\r\n\t\tSyncCtrl.startDateOpened = true;\r\n\t}\r\n\t$scope.$on('matchInput', function(e,v){\r\n\t\t$scope.matchInput = v;\r\n\t})\r\n\tvar timeID;\r\n\tfunction updateTime(time){\r\n\t\tvar new_time = time;\r\n\t\tvar timeArray = formDate.format(new Date(time), \"hh:mm:ss\").split(':');\r\n\t\tif(SyncCtrl.loopTime){\r\n\t\t\tSyncCtrl.hours = timeArray[0];\r\n\t\t\tSyncCtrl.minutes = timeArray[1];\r\n\t\t\tSyncCtrl.seconds = timeArray[2];\r\n\t\t\tnew_time = time+1000;\r\n\t\t\ttimeID = setTimeout(function(){\r\n\t\t\t\tupdateTime(new_time);\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tclearTimeout(timeID);\r\n\t\t}\r\n\t};\r\n\r\n\tSyncCtrl.loadZone = function(){\r\n\t\tclearTimeout(timeID);\r\n\t\tSyncCtrl.loading_zone = true;\r\n\t\tSystemTime.queryZone(function(res){\r\n\t\t\tSyncCtrl.choose_time = res.date;\r\n\t\t\tSyncCtrl.loopTime = true;\r\n\t\t\tupdateTime(res.timestamp);\r\n\t\t\tSyncCtrl.zones = res.timezones.map(function(item){\r\n\t\t\t\titem.value = $$$I18N.get(item.zones[0]);\r\n\t\t\t\treturn item;\r\n\t\t\t});\r\n\t\t\tSyncCtrl.zone = SyncCtrl.zones.filter(function(item){ return item.offset == res.zone })[0];\r\n\t\t\tSyncCtrl.loading_zone = false;\r\n\t\t},function(){ SyncCtrl.loading_zone = false; })\r\n\t};\r\n\tSyncCtrl.loadZone();\r\n\tSyncCtrl.updateZone = function(){\r\n\t\tSyncCtrl.updating_zone = true;\r\n\t\t// 格式化时间，0-9时前面加0\r\n\t\tif(SyncCtrl.hours.length==1 && Number(SyncCtrl.hours)>=0 && Number(SyncCtrl.hours)<=9){\r\n\t\t\tSyncCtrl.hours = \"0\"+SyncCtrl.hours\r\n\t\t}\r\n\t\tif(SyncCtrl.minutes.length==1 && Number(SyncCtrl.minutes)>=0 && Number(SyncCtrl.minutes)<=9){\r\n\t\t\tSyncCtrl.minutes = \"0\"+SyncCtrl.minutes\r\n\t\t}\r\n\t\tif(SyncCtrl.seconds.length==1 && Number(SyncCtrl.seconds)>=0 && Number(SyncCtrl.seconds)<=9){\r\n\t\t\tSyncCtrl.seconds = \"0\"+SyncCtrl.seconds\r\n\t\t}\r\n\t\tvar time = formDate.format(new Date(SyncCtrl.choose_time), \"yyyy-MM-dd\");\r\n\t\tSystemTime.updateZone({\r\n\t\t\t\"date\": time,\r\n\t\t\t\"time\": SyncCtrl.hours+':'+SyncCtrl.minutes+\":\"+SyncCtrl.seconds,\r\n\t\t\t\"zone\": SyncCtrl.zone.offset\r\n\t\t},function(res){\t\r\n\t\t\tSyncCtrl.updating_zone = false;\r\n\t\t\tSyncCtrl.modifyTime = false;\r\n\t\t\tSyncCtrl.loadZone();\r\n\t\t},function(){ SyncCtrl.updating_zone = false; SyncCtrl.modifyTime = false; SyncCtrl.loadZone();})\r\n\r\n\t}\r\n\r\n}])\r\n.controller('vdiSystemSetController', ['$scope', '$modal', function($scope, $modal){\r\n}])\r\n// 快速部署\r\n.directive('htmlpopover', ['$tooltip', function ($tooltip) {\r\n    return $tooltip( 'htmlpopover', 'htmlpopover', 'mouseenter' );\r\n}])\r\n.directive('htmlpopoverPopup', function () {\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: { title: '@', content: '@', placement: '@', animation: '&', isOpen: '&' },\r\n        template: \"<div class=\\\"popover {{placement}}\\\" ng-class=\\\"{ in: isOpen(), fade: animation() }\\\">\\n\" +\r\n        \"  <div class=\\\"arrow\\\"></div>\\n\" +\r\n        \"\\n\" +\r\n        \"  <div class=\\\"popover-inner\\\">\\n\" +\r\n        \"      <h3 class=\\\"popover-title\\\" ng-bind=\\\"title\\\" ng-show=\\\"title\\\"></h3>\\n\" +\r\n        \"      <div class=\\\"popover-content\\\" bind-html-unsafe=\\\"content\\\"></div>\\n\" +\r\n        \"  </div>\\n\" +\r\n        \"</div>\"\r\n    };\r\n})\r\n.filter(\"filename\", function(){\r\n    return function(text){\r\n        if(!text) { return text; }\r\n        var pos = text.lastIndexOf(\"/\");\r\n        if(pos === -1) {\r\n            pos = text.lastIndexOf(\"\\\\\");\r\n        }\r\n        if(pos > -1) {\r\n            return text.substring(pos + 1);\r\n        } else {\r\n            return text;\r\n        }\r\n    }\r\n})\r\n.filter(\"filesize\", function(){\r\n\treturn function(num){\r\n\t\tvar units = ['B', 'KB', 'MB', 'GB', 'TB'];\r\n\t\tvar index = 0;\r\n\t\tnum = num || 0;\r\n\t\twhile(num > 1024) {\r\n\t\t\tnum = num / 1024;\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\treturn num.toFixed(2) + units[index];\r\n\t};\r\n})\r\n.service('quickMaskModel', [\"$$$I18N\", \"$location\", \"$compile\", \"$rootScope\", \"$controller\", function($$$I18N, $location, $compile, $rootScope, $controller){\r\n    this.open = function(){\r\n    \tvar $body = $(document.body);\r\n    \t$body.css('overflow', 'hidden');\r\n        var modalRootElement = angular.element(\"\"\r\n        \t+ \"<div id='quickMaskModel'>\"\r\n        \t+ \"  <div class='content'>\"\r\n        \t+ \"    <p localize='quickstartTip'></p>\"\r\n        \t+ \"    <footer class='text-right'>\"\r\n        \t+ \"      <a ng-click='ok()' class='btn btn-md btn-primary deploy'><i class='fa-arrow-right fa'></i> <span localize='快速部署'></span></a>\"\r\n        \t+ \"      <a ng-click='close()' class='btn btn-md btn-default nodeploy'><span localize='暂不部署'></span></a>\"\r\n        \t+ \"    </footer>\"\r\n        \t+ \"  </div>\"\r\n        \t+ \"  <span class='jiantou'></span>\"\r\n        \t+ \"</div>\"\r\n        );\r\n        modalRootElement.appendTo($body);\r\n        var modalScope = $rootScope.$new();\r\n        $compile(modalRootElement)(modalScope);\r\n        $controller(\"quickstartController\", {$scope: modalScope, $element: modalRootElement});\r\n    \tmodalScope.$on(\"$destroy\", function(){\r\n    \t\t$body.css('overflow', 'auto');\r\n    \t});\r\n    }\r\n}])\r\n.controller('vdiSystemDeployController', ['$scope', '$interval', '$q', '$location', '$modal', '$$$os_types', '$filter', 'localize', 'TeachTemplate', 'SystemDeploy', 'quickMaskModel', function($scope, $interval, $q, $location, $modal, $$$os_types, $filter, localize, TeachTemplate, init, quickMaskModel){\r\n\t$scope.currentIndex = 0;\r\n\t$scope.unknowStep = true;\r\n\t$scope.showMask = false;\r\n\t$scope.firstDeployTips = true;\r\n\t$scope.hideStep = false;\r\n\t//系统模块快速部署的界面展现\r\n\tinit.quick_deploy_page(function(res){\r\n\t\tif(res.result.ha_mode===\"active_passive\" && res.result.storage_type===\"local\" && res.result.ha_triggered){\r\n\t\t\t$scope.showMask = true;\r\n\t\t\t$scope.firstDeployTips = false;\r\n\t\t}\r\n\t\t$scope.hideStep = true;\r\n\t});\r\n\t// 设置当前步骤\r\n\tinit.quickstart(function(res){\r\n\t\tvar step = parseInt(res.step);\r\n\t\tif(step && step > 1) {\r\n\t\t\t$scope.$broadcast(\"currentStepChange\", step - 1);\r\n\t\t\t$scope.$broadcast(\"browser refresh\", step - 1, res);\r\n\t\t} else {\r\n\t\t\t$scope.unknowStep = false;\r\n\t\t}\r\n\t});\r\n\r\n\t$scope.knowStep = function(){\r\n\t\t$scope.unknowStep = false;\r\n\t};\r\n\t$scope.setStep = function(i){\r\n\t\t$scope.$broadcast(\"currentStepChange\", i);\r\n\t};\r\n\r\n\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\tvar formScope = scope.$$childHead;\r\n    \tstep.done = formScope.imgForm.$valid && !!formScope.selectedSysImage\r\n    \tif(!step.done) { return; }\r\n    \t$scope.$broadcast(\"deploy:set\", \"system-image\", formScope.selectedSysImage.filename);\r\n    });\r\n\r\n\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\tvar formScope = scope.$$childHead;\r\n\t\tstep.done = formScope.registerForm.$valid  && !formScope.network_loading\r\n    \tif(!step.done) {\r\n    \t\tangular.forEach(formScope.registerForm.$error, function(arr){\r\n    \t\t\tarr && arr.forEach(function(ctrl){ ctrl.$setViewValue(\"\"); });\r\n    \t\t});\r\n    \t\treturn;\r\n    \t}\r\n    \tvar wizardScope = e.targetScope;\r\n    \tstep.done = false;\r\n    \tstep.showLoading = true;\r\n    \tformScope.ok(function(res){\r\n    \t\tstep.showLoading = false;\r\n    \t\tif(res === null) { return; }\r\n    \t\tformScope.showTemplateBlock(res);\r\n    \t});\r\n    });\r\n\r\n    $scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n    \tvar formScope = scope.$$childHead;\r\n    \tstep.done = formScope.createForm.$valid;\r\n    \tif(!step.done) {\r\n    \t\tangular.forEach(formScope.createForm.$error, function(arr){\r\n    \t\t\tarr.forEach(function(ctrl){ ctrl.$setViewValue(\"\"); });\r\n    \t\t});\r\n    \t\treturn;\r\n    \t}\r\n    \tvar data = formScope.getValues();\r\n    \tinit.create_scene(data, function(res){\r\n    \t\t$$$storage.setSessionStorage('scene_page_classroom', '');\r\n    \t\t$location.url(\"/desktop/scene\");\r\n    \t});\r\n    });\r\n\r\n    var countArr = [0, 0, 0];\r\n\t$scope.$on(\"selectStepChange\", function(e, arg){\r\n\t\tvar index = arg.index;\r\n\t\t$scope.currentIndex = index;\r\n\t\tcountArr[index]++;\r\n\t\tif(countArr[index] > 1) {\r\n\t\t\t$scope.$broadcast(\"deploy:step\" + index + \".refresh\");\r\n\t\t}\r\n\t});\r\n}])\r\n// 第一步：导入模板镜像\r\n.controller('importImageStepController', ['$scope', '$modal', 'SystemDeploy', '$timeout', function($scope, $modal, init, $timeout){\r\n\t// = 导入模板镜像 =\r\n    // 扫描后产生的镜像列表\r\n    $scope.imglist = [];\r\n    // 选中的镜像\r\n\tvar autoSelect = true;\r\n    $scope.selectedSysImage;\r\n\r\n\r\n    $scope.listSystemImages = function(){\r\n    \tinit.list_system_images(function(res){\r\n    \t\tvar imgmap = {};\r\n    \t\tangular.forEach($scope.imglist, function(img){\r\n    \t\t\timgmap[img.name] = img;\r\n    \t\t});\r\n    \t\tangular.forEach(res.system_image, function(img){\r\n    \t\t\tif(img.name in imgmap) {\r\n    \t\t\t\tangular.extend(imgmap[img.name], img);\r\n    \t\t\t} else {\r\n    \t\t\t\timg.filename = img.name;\r\n    \t\t\t\t$scope.imglist.push(img);\r\n    \t\t\t}\r\n    \t\t});\r\n\t\t\tif(autoSelect) {\r\n\t\t\t\t$scope.selectedSysImage = $scope.imglist[0];\r\n\t\t\t}\r\n    \t}).$promise.finally(function(){\r\n    \t\t$scope.loading = false;\r\n    \t});\r\n    \t$scope.loading = true;\r\n    };\r\n\r\n    $scope.selectSysImage = function(img){\r\n    \t$scope.selectedSysImage = img;\r\n\t\t$scope.autoSelect = false;\r\n    };\r\n\r\n    $scope.importByServer = function(){\r\n    \t$modal.open({\r\n    \t\ttemplateUrl: \"/views/vdi/dialog/system/system_deploy_import_by_server.html\",\r\n    \t\tcontroller: \"importByServerController as ctrl\"\r\n    \t}).result.then(function(imgs){\r\n    \t\t(imgs.length > 0) && $scope.listSystemImages();\r\n    \t});\r\n    };\r\n\r\n    $scope.listSystemImages();\r\n\r\n    $scope.$on(\"finishUpload\", function(e, suc, filename){\r\n        $scope.listSystemImages();\r\n    });\r\n\r\n    $scope.$on(\"deploy:step0.refresh\", function(){\r\n    \t$scope.listSystemImages();\r\n    });\r\n}])\r\n// 第二步：注册教学模板\r\n.controller('registerTeachTemplateStepController', [\r\n\t'$scope', '$interval', '$modal', 'SystemDeploy', \"registerTemplate\", \"TeachTemplate\", \"HardwareTemplate\", \"SystemISO\", \"Admin\", \"$$$os_types\",\"$$$I18N\", \"UserRole\",\"Network\", \"virtualHost\", \"networkWithHost\", \"$rootScope\",\r\n\tfunction($scope, $interval, $modal, init, registerTemplate, TeachTemplate, hardware, iso, admin, $$$os_types,$$$I18N, UserRole, network, virtualHost, networkWithHost, $root){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength = 2;\r\n\t$scope.max_namelength = 20;\r\n\t$scope.type = '1';\r\n\t$scope.name = \"default\";\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[0];\r\n\r\n\t// controller 实例化的时候不应当获取数据，每次 $scope 收到 deploy:set 事件的时候初始化\r\n\tfunction loadData(){\r\n\t\tadmin.query(function(res){\r\n\t\t\t$scope.users = res.users;\r\n\t\t\tangular.forEach($scope.users, function(item){\r\n\t\t\t\tif(item.name === user.name)\r\n\t\t\t\t\t$scope.owner = item;\r\n\t\t\t})\r\n\t\t});\r\n\t\tregisterTemplate.query(function(res){\r\n\t\t\t$scope.sys_isos = res.system_image;\r\n\t\t\tif($scope.selectIsoName && !selectIsoByName($scope.selectIsoName)) {\r\n\t\t\t\t$scope.sys_iso = res.system_image[0];\r\n\t\t\t}\r\n\t\t\t$scope.old_data_isos = res.data_image;\r\n\t\t\tif($scope.sys_iso){\r\n\t\t\t\t$scope.getDataImgs($scope.sys_iso);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\t$scope.filterDataISO = function(data_iso, data_iso2){\r\n\t\tif(data_iso){\r\n\t\t\t$scope.data_isos2 = $scope.data_isos.filter(function(item){ return item.name !== data_iso.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos2 = $scope.data_isos;\r\n\t\t}\r\n\t\tif(data_iso2){\r\n\t\t\t$scope.data_isos1 = $scope.data_isos.filter(function(item){ return item.name !== data_iso2.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos1 = $scope.data_isos;\r\n\t\t}\r\n\t};\r\n\t$scope.getDataImgs = function(systemImg, is_init){\r\n\t\tif(systemImg){\r\n\t\t\tthis.data_iso = undefined;\r\n\t\t\tthis.data_iso2 = undefined;\r\n\t\t\t$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function(item){ return item.virtual_type == systemImg.virtual_type });\r\n\t\t\t// $scope.data_iso = $scope.data_isos[0];\r\n\t\t\t// $scope.data_iso2 = $scope.data_isos[0];\r\n\t\t\t$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar lastType;\r\n\t$scope.getVirtualHost = function (type, rbd_enabled){\r\n\t\tif(type === lastType) { return; }\r\n\t\t$scope.host_loading = true;\r\n\t\tvirtualHost.query({virtual_type: type, rbd_enabled: rbd_enabled}, function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\t$scope.getNetwork($scope.host);\r\n\t\t\tlastType = type;\r\n\t\t}, function(){\r\n\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.os_types = $$$os_types.filter(function(item){ return item.key!==\"package\" });\r\n\t$scope.os_type = $scope.os_types[0];\r\n\t// $scope.enable_gpu = false;\r\n\t$scope.bind_ip_type = \"static\";\r\n\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t$scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\r\n\t\t}\r\n\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\r\n\t$scope.ok = function(callback){\r\n\t\t// if(this.bind_ip_type.value === 'static' && this.bind_ip === '无可用IP'){\r\n\t\t// \t$.bigBox({\r\n\t\t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n\t\t// \t\ttimeout\t: 6000\r\n\t\t// \t});\r\n\t\t// } else{\r\n\t\t\t$scope.submiting = true ;\r\n\t\t\t$scope.afterSubmiting =false ;\r\n\t\t\tvar _ip = this.bind_ip_type.value === 'static' ? this.bind_ip.value : undefined;\r\n\t\t\tvar host_uuid = this.host.host_uuid;\r\n\t\t\tvar postData = {\r\n\t\t\t\tsystem_image_file: this.sys_iso,\r\n\t\t\t\tname: this.name,\r\n\t\t\t\tos: this.os_type.key,\r\n\t\t\t\towner: this.owner.id,\r\n\t\t\t\tnetwork: this.network.id,\r\n\t\t\t\tsubnet: this.subnet?this.subnet.id:\"\",\r\n\t\t\t\tband_ip: _ip,\r\n\t\t\t\tband_type: this.bind_ip_type.value,\r\n\t\t\t\thost_uuid: host_uuid\r\n\t\t\t};\r\n\t\t\tinit.register_template(postData, function(res){\r\n\t\t\t\t$scope.submiting = false;\r\n\t\t\t\t$scope.afterSubmiting = true;\r\n\t\t\t\tcallback({\r\n\t\t\t\t\timage_id: res.image_id,\r\n\t\t\t\t\tservers: [{uuid: host_uuid}]\r\n\t\t\t\t});\r\n\t\t\t}, function(){\r\n\t\t\t\tcallback(null);\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t// }\r\n\t};\r\n\r\n    \r\n    $scope.$on(\"deploy:set\", function(e, name, value){\r\n    \tif(name === \"system-image\") {\r\n    \t\t$scope.selectIsoName = value;\r\n    \t\tloadData();\r\n    \t\t// if(selectIsoByName(value)) {\r\n    \t\t// \t$scope.getVirtualHost($scope.sys_iso.virtual_type, $scope.sys_iso.rbd_enabled);\r\n    \t\t// }\r\n    \t}\r\n    });\r\n\r\n    function selectIsoByName(name) {\r\n    \tvar iso = $scope.sys_iso;\r\n    \tvar hit = false;\r\n    \tif(iso && iso.name === name) {\r\n    \t\treturn true;\r\n    \t}\r\n    \tangular.forEach($scope.sys_isos, function(iso){\r\n    \t\tif(iso.name === name) {\r\n    \t\t\tthis.sys_iso = iso;\r\n    \t\t\thit = true;\r\n    \t\t}\r\n    \t}, $scope);\r\n    \treturn hit;\r\n    }\r\n\r\n    $scope.showTemplateBlock = function(data, browserRefresh){\r\n    \t// 切换视图\r\n    \t$scope.registerFormLoading = true;\r\n    \t$scope.loadingTeachTemplates = true;\r\n    \tTeachTemplate.query({ids: [data.image_id]}, function(res){\r\n    \t\tvar teachTemplates = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\r\n    \t\tteachTemplates.forEach(function(row){\r\n    \t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n    \t\t\tos && os.icon && (row.icon = os.icon);\r\n    \t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n    \t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n    \t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n    \t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n    \t\t});\r\n    \t\tteachTemplates.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\r\n    \t\t$scope.teachTemplates = teachTemplates;\r\n    \t\tif(testTempateCreateDone(teachTemplates)) {\r\n    \t\t\tdata.xp = isXP(teachTemplates[0]);\r\n    \t\t\tonCreateTemplateDone(data, browserRefresh);\r\n    \t\t} else {\r\n    \t\t\tif(browserRefresh) {\r\n    \t\t\t\t$scope.$eval(\"knowStep()\");\r\n    \t\t\t}\r\n    \t\t\tloopTemplateStatus(data).then(function(v){\r\n    \t\t\t\tdata.xp = v;\r\n    \t\t\t\tonCreateTemplateDone(data, browserRefresh);\r\n    \t\t\t}).catch(function(err){\r\n    \t\t\t\t$.bigBox({\r\n    \t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n    \t\t\t\t\tcolor : \"#C46A69\",\r\n    \t\t\t\t\tcontent\t: err,\r\n    \t\t\t\t\ttimeout\t: 6000\r\n    \t\t\t\t});\r\n    \t\t\t});\r\n    \t\t}\r\n    \t}).$promise.finally(function(){\r\n    \t\t$scope.loadingTeachTemplates = false;\r\n    \t});\r\n    };\r\n\r\n\t$scope.delete = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除教学模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: [\"$scope\", \"$modalInstance\", function(modalScope, $modalInstance){\r\n\t\t\t\tvar template = TeachTemplate;\r\n\t\t\t\tvar rows = [item];\r\n\t\t\t\tmodalScope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\tmodalScope.ok = function(){\r\n\t\t\t\t\ttemplate.delete({ id: [item.id] }, function(res){\r\n\t                \t$scope.$eval(\"setStep(0)\");\r\n\t                \t$scope.registerFormLoading = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\tmodalScope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}],\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\r\n    function loopTemplateStatus(res){\r\n    \tvar timer = $interval(function(){\r\n\t\t\tvar root = $scope.$root;\r\n\t\t\t// TODO: 某些情况这里还是会报错\r\n\t\t\tif(root) {\r\n\t\t\t\troot.$broadcast(\"imageIDS\", [res.image_id]);\r\n\t\t\t} else {\r\n\t\t\t\t$interval.cancel(timer);\r\n\t\t\t\ttimer = null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}, 1000);\r\n\t\treturn new Promise(function(resolve, reject){\r\n\t\t\tvar dereg = $scope.$on(\"imagesRowsUpdate\", function(e, data){\r\n\t\t\t\tvar templates = $scope.teachTemplates;\r\n\t\t\t\tvar _rows = {};\r\n\t\t\t\ttemplates.forEach(function(item){\r\n\t\t\t\t\t_rows[item.id] = item;\r\n\t\t\t\t});\r\n\t\t\t\tdata.forEach(function(item){\r\n\t\t\t\t\tif(_rows[item.id]){\r\n\t\t\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\ttemplates = templates.filter(function(item){ return item.type_code ===1 });\r\n\t\t\t\ttemplates.forEach(function(row){\r\n\t\t\t\t\tif(row.sync_status){\r\n\t\t\t\t\t\tvar updateInfor = row.sync_status.filter(function(item){ return item.type === \"image\" });\r\n\t\t\t\t\t\tif(updateInfor.length!==0)\r\n\t\t\t\t\t\t\trow.updateSize = (updateInfor[0].size/1024/1024/1024).toFixed(2);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t$scope.teachTemplates = templates;\r\n\t\t\t\tif(testTempateCreateDone(templates)) {\r\n\t\t\t\t\t$interval.cancel(timer);\r\n\t\t\t\t\tdereg();\r\n\t\t\t\t\ttimer = null;\r\n\t\t\t\t\tresolve(isXP(templates[0]));\r\n\t\t\t\t}\r\n\t\t\t\tif(templates[0].status === \"register failed\") {\r\n\t\t\t\t\t$interval.cancel(timer);\r\n\t\t\t\t\tdereg();\r\n\t\t\t\t\ttimer = null;\r\n\t\t\t\t\treject($$$I18N.get(\"REGISTER_FAILED\"));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t$scope.$on(\"$destroy\", function(){\r\n\t\t\ttimer && $interval.cancel(timer);\r\n\t\t});\r\n    };\r\n\r\n    function testTempateCreateDone(templates){\r\n    \treturn templates && templates.length > 0 && templates[0].status === \"alive\";\r\n    }\r\n\r\n    function onCreateTemplateDone(res, browserRefresh){\r\n    \tvar root = $scope.$root;\r\n    \troot.$broadcast(\"currentStepChange\", 2);\r\n\t\troot.$broadcast(\"deploy:set\", \"image_id\", res.image_id);\r\n\t\troot.$broadcast(\"deploy:set\", \"servers\", res.servers);\r\n\t\troot.$broadcast(\"deploy:set\", \"isxp\", res.xp);\r\n\t\tif(res.max_instance) {\r\n\t\t\troot.$broadcast(\"deploy:set\", \"max_instance\", res.max_instance);\r\n\t\t} else {\r\n\t\t\t// force trigger request `/thor/init/quickstart`\r\n\t\t\troot.$broadcast(\"deploy:set\", \"max_instance\", false);\r\n\t\t}\r\n\t\t\r\n\t\t$scope.registerFormLoading = false;\r\n\t\tif(browserRefresh === true) {\r\n\t\t\t$scope.$eval(\"knowStep()\");\r\n\t\t}\r\n    }\r\n\r\n    function isXP(template) {\r\n    \tvar ostype = template.os_type || \"\";\r\n    \treturn /^Windows\\s*XP/.test(ostype);\r\n    }\r\n    // 快速部署过程中浏览器重新刷新，自动进入轮训\r\n    $scope.$on(\"browser refresh\", function(e, step, res){\r\n    \tif(step !== 1) { return; }\r\n    \t// 显示模板\r\n    \t$scope.showTemplateBlock(res, true);\r\n    });\r\n}])\r\n// 第三步：创建教学场景\r\n.controller('createTeachSceneController', [\r\n\t'$scope', '$modal', 'SystemDeploy', \"TeachTemplate\", \"SchoolRoom\", \"HardwareTemplate\", \"SystemISO\", \"Admin\", \"$$$os_types\",\"$$$I18N\", \"UserRole\",\"Network\", \"virtualHost\", \"networkWithHost\", \"$rootScope\", \"$q\",\r\n\tfunction($scope, $modal, init, teach, SchoolRoom, hardware, iso, admin, $$$os_types,$$$I18N, UserRole, network, virtualHost, networkWithHost, $root, $q){\r\n\t\t$scope.min_namelength=2;\r\n\t\t$scope.max_namelength=20;\r\n\r\n\t\tvar data = $scope.data = {\r\n\t\t\tname: \"default\",\r\n\t\t\tcpu_num: 2,\r\n\t\t\tmemory_mb: 2,\r\n\t\t\tsystem_gb: 20,\r\n\t\t\tkwargs: {\r\n\t\t\t\tdata_rollback: 1,\r\n\t\t\t\thostname_beginwith: 1,\r\n\t\t\t\thostname_prefix: \"PC\",\r\n\t\t\t\thostname_type: 1,\r\n\t\t\t\tis_exam: false,\r\n\t\t\t\trollback: 1,\r\n\t\t\t\tusb_redir: true\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t$scope.btndisks = [];\r\n\t\t$scope.master = {};\r\n\r\n\t\tSchoolRoom.querywithSimple(function(res){\r\n\t\t\t$scope.classrooms = res.pools_.concat([{\r\n\t\t\t\tid: -1,\r\n\t\t\t\tname: $$$I18N.get(\"新增自定义教室\")\r\n\t\t\t}]);\r\n\t\t\t$scope.classroom = $scope.classrooms[0];\r\n\t\t});\r\n\r\n\t\thardware.query(function(res){\r\n\t\t\t$scope.hardwareList = res.result.concat([{\r\n\t\t\t\tid: -1,\r\n\t\t\t\tname: $$$I18N.get(\"新增自定义模板\")\r\n\t\t\t}]);\r\n\t\t\t$scope.hardware = $scope.hardwareList[0];\r\n\t\t});\r\n\r\n\t\tnetwork.query(function(data){\r\n\t\t\t$scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t$scope.data.network = $scope.networks[0];\r\n\t\t\tgetSubnets($scope.data.network);\r\n\t\t});\r\n\r\n\t\t$scope.addbtndisk = function(){\r\n\t\t\t$scope.btndisks.push({local_gb: 5});\r\n\t\t};\r\n\t\t$scope.minusbtndisk = function(){\r\n\t\t\t// var idx = $scope.btndisks.indexOf(i)\r\n\t\t\t$scope.btndisks.splice($scope.btndisks.length-1,1);\r\n\t\t};\r\n\r\n\t\t$scope.switchSubnet = function(val){\r\n\t\t\tgetSubnets(val);\r\n\t\t};\r\n\t\t\t\r\n\r\n\t\tfunction getSubnets(Network){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t$scope.subnets = res.result;\r\n\t\t\t\t$scope.data.subnet = $scope.subnets[0];\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t});\r\n\t\t}\r\n\t\t\t\r\n\t\t\r\n\t\t$scope.getValues = function(){\r\n\t\t\tvar values = angular.extend({\r\n\t\t\t\tname: data.name,\r\n\t\t\t\tinstance_max: data.instance_max,\r\n\t\t\t\tservers: data.servers,\r\n\t\t\t\timage_id: data.image_id\r\n\t\t\t}, data.kwargs);\r\n\t\t\tif($scope.classroom.id === -1) {\r\n\t\t\t\tangular.extend(values, {\r\n\t\t\t\t\tpool_name: data.classroomName,\r\n\t\t\t\t\tdesc: data.desc,\r\n\t\t\t\t\tnetwork_id: data.network.id,\r\n\t\t\t\t\tsubnet_id: data.subnet.id\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tvalues.pool = $scope.classroom.id;\r\n\t\t\t}\r\n\t\t\tif($scope.hardware.id === -1) {\r\n\t\t\t\tangular.extend(values, {\r\n\t\t\t\t\tinstance_type_name: data.hardwareName,\r\n\t\t\t\t\tcpu_num: data.cpu_num,\r\n\t\t\t\t\tmemory_mb: data.memory_mb * 1024,\r\n\t\t\t\t\tsystem_gb: data.system_gb\r\n\t\t\t\t});\r\n\t\t\t\tangular.forEach([0, 1], function(i){\r\n\t\t\t\t\tvar disk = $scope.btndisks[i];\r\n\t\t\t\t\tif(i === 0) {\r\n\t\t\t\t\t\tvalues.local_gb = disk ? disk.local_gb : 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalues['local_gb' + i] = disk ? disk.local_gb : 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tvalues.instance_type = $scope.hardware.id;\r\n\t\t\t}\r\n\t\t\treturn values;\r\n\t\t};\r\n\r\n\t\t$scope.showAdvanceSceneOptionDialog = function(){\r\n\t\t\tvar isxp = data.isxp;\r\n\t\t    $modal.open({\r\n\t\t        templateUrl: \"views/vdi/dialog/system/system_deploy_advance_options.html\",\r\n\t\t        controller: \"teachSceneOptionDialog\",\r\n\t\t        resolve: {\r\n\t\t        \tisxp: function(){ return isxp; },\r\n\t\t        \tkwargs: function(){ return data.kwargs; }\r\n\t\t        }\r\n\t\t    }).result.then(function(options){\r\n\t\t    \tdata.kwargs = options;\r\n\t\t    });\r\n\t\t};\r\n\r\n\t\t$scope.getMaxInstance = function(){\r\n\t\t\tinit.quickstart(function(res){\r\n\t\t\t\tdata.max_instance = res.max_instance;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.$on(\"deploy:set\", function(e, name, value){\r\n\t\t\tdata[name] = value;\r\n\t\t\tif(value === false && name === \"max_instance\") {\r\n\t\t\t\t$scope.getMaxInstance();\r\n\t\t\t}\r\n\t\t});\r\n\t}])\r\n// 高级 dialog\r\n.controller(\"teachSceneOptionDialog\", [\"$scope\", \"$modalInstance\", \"$rootScope\", \"localize\", \"isxp\", \"kwargs\", \"PersonDesktop\", function(scope, modalInstance, rootScope, localize, isxp, kwargs, PersonDesktop){\r\n\tvar defaults = {\r\n        usb_redir: true,\r\n        usb_version: isxp ? '2.0' : '3.0',\r\n        rollback: '1',\r\n        rollback_weekday: '1',\r\n        rollback_monthday: '1',\r\n        data_rollback: '1',\r\n        data_rollback_weekday: '1',\r\n        data_rollback_monthday: '1',\r\n        hostname_type: '1',\r\n        hostname_prefix: 'PC',\r\n        hostname_beginwith: 1,\r\n        username_type: '1',\r\n        username_prefix: 'K',\r\n        username_beginwith: 1,\r\n        isxp: isxp,\r\n        enable_share: false\r\n    };\r\n\tvar data = scope.data = angular.extend(defaults, kwargs || {});\r\n\tscope.loading_server = true;\r\n\tPersonDesktop.share_servers(function(res){\r\n\t\tscope.loading_server = false;\r\n\t\tvar servers = [];\r\n\t\tres.servers.forEach(function(server){\r\n\t\t\tserver.nets.forEach(function(net){\r\n\t\t\t\tservers.push({id: server.id, net: {ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id}})\r\n\t\t\t})\r\n\t\t});\r\n\t\tscope.share_servers = servers;\r\n\t\tscope.data.share_server = scope.share_servers[0];\r\n\t})\r\n\r\n\tscope.USBRedictTips = localize.localizeText(\"USBRedictTips\");\r\n\tscope.auto_mountPersonalTips = localize.localizeText(\"auto_mountPersonalTips\");\r\n    data.RDP = kwargs.is_exam;\r\n    if(kwargs.username_prefix) {\r\n    \tdata.MORE = true;\r\n    \tangular.forEach([\"username_prefix\", \"username_beginwith\", \"username_type\"], function(s){\r\n    \t\tscope[s] = kwargs[s];\r\n    \t});\r\n    }\r\n    if(kwargs.hostname_prefix) {\r\n    \tangular.forEach([\"hostname_beginwith\", \"hostname_prefix\", \"hostname_type\"], function(s){\r\n    \t\tscope[s] = kwargs[s];\r\n    \t});\r\n    }\r\n    angular.forEach({\r\n    \trollback_weekday: \"2\",\r\n    \trollback_monthday: \"3\",\r\n    }, function(v, k){\r\n    \tif(kwargs.hasOwnProperty(k)) {\r\n    \t\tscope.rollback = v;\r\n    \t\tscope[k] = kwargs[k];\r\n    \t}\r\n    });\r\n    angular.forEach({\r\n    \tdata_rollback_weekday: \"2\",\r\n    \tdata_rollback_monthday: \"3\",\r\n    }, function(v, k){\r\n    \tif(kwargs.hasOwnProperty(k)) {\r\n    \t\tscope.data_rollback = v;\r\n    \t\tscope[k] = kwargs[k];\r\n    \t}\r\n    });\r\n    scope.addZero = function(len,str_begin,str_end){\r\n        if(str_end && str_begin){\r\n            var end_len = str_end.toString().length;\r\n            if(end_len < len){\r\n                return  str_begin + new Array(len - end_len+1).join(\"0\") + str_end;\r\n            }else{\r\n                return str_begin + str_end;\r\n            }\r\n        }\r\n    };\r\n    \r\n    scope.ok = function () {\r\n        var postData = {};\r\n        // 这里的 this 引用了真正的 scope\r\n        postData.enable_share = data.enable_share,\r\n        postData.share_server_ip = data.enable_share ? data.share_server.net.ip_address : undefined;\r\n        postData.share_server_id =  data.enable_share ? data.share_server.id : undefined;\r\n        postData.usb_redir    = data.usb_redir;\r\n        postData.usb_version  = data.usb_redir ? data.usb_version : null;\r\n        postData.rollback      = data.rollback;\r\n        postData.data_rollback = data.data_rollback;\r\n        if(postData.rollback === \"2\"){\r\n            postData.rollback_weekday = data.rollback_weekday;\r\n        }\r\n        if(postData.rollback === \"3\"){\r\n            postData.rollback_monthday = data.rollback_monthday;\r\n        }\r\n        if(postData.data_rollback === \"2\"){\r\n            postData.data_rollback_weekday = data.data_rollback_weekday;\r\n        }\r\n        if(postData.data_rollback === \"3\"){\r\n            postData.data_rollback_monthday = data.data_rollback_monthday;\r\n        }\r\n\r\n        angular.forEach([\"hostname_beginwith\", \"hostname_prefix\", \"hostname_type\"], function(s){\r\n    \t\tpostData[s] = data[s];\r\n    \t});\r\n        postData.is_exam = !!data.RDP;\r\n        if(data.MORE){\r\n            angular.forEach([\"username_prefix\", \"username_beginwith\", \"username_type\"], function(s){\r\n            \tpostData[s] = data[s];\r\n            });\r\n        }\r\n        rootScope.$broadcast(\"scene-options\", postData);\r\n        modalInstance.close(postData);\r\n    };\r\n    scope.close = function () {\r\n        modalInstance.dismiss();\r\n    };\r\n}])\r\n.controller(\"importByServerController\", [\"$scope\", \"$timeout\", \"$modalInstance\", \"SystemDeploy\", function($scope, $timeout, $modalInstance, init){\r\n\tvar importedImgs = [];\r\n\tvar self = this;\r\n\tself.selected = null;\r\n\tself.remote_imgs = [];\r\n\tself.loading = false;\r\n\r\n\tself.refreshImgs = function(){\r\n\t\tinit.scan_iso(function (res) {\r\n\t\t\tvar imgs = {};\r\n\t\t    angular.forEach(self.remote_imgs, function(img){\r\n\t\t    \timgs[img.path] = img;\r\n\t\t    });\r\n\t\t    angular.forEach(res.result, function(img){\r\n\t\t    \tif(imgs.hasOwnProperty(img.path)) {\r\n\t\t    \t\tangular.extend(imgs[img.path], img);\r\n\t\t    \t} else {\r\n\t\t    \t\tself.remote_imgs.push(img);\r\n\t\t    \t}\r\n\t\t    });\r\n\t\t}).$promise.finally(function(){\r\n\t\t\tself.loading = false;\r\n\t\t});\r\n\t\tself.loading = true;\r\n\t};\r\n\r\n\tself.importSelected = function () {\r\n\t\tvar img = self.selected;\r\n\t\tif(!img) { return; }\r\n\t    init.import_iso({\r\n\t        upload_type: 'local',\r\n\t        src_file: [img.path]\r\n\t    }, function (res) {\r\n\t    \tloopImportProgress(angular.copy(img), function(){\r\n\t    \t\timportedImgs.push(img);\r\n\t    \t\tself.is_importing = false;\r\n\t    \t\timg.imported = true;\r\n\t    \t\tdelete self.selected;\r\n\t    \t\tself.close();\r\n\t    \t}, function(){\r\n\t    \t\tself.is_importing = false;\r\n\t    \t});\r\n\t    }, function(){\r\n\t    \tself.is_importing = false;\r\n\t    });\r\n\t    self.is_importing = true;\r\n\t};\r\n\t\r\n\tself.close = function(){\r\n\t\t$modalInstance.close(importedImgs);\r\n\t};\r\n\r\n\tself.isAjaxOn = function(){\r\n\t\treturn self.loading || self.is_importing;\r\n\t};\r\n\r\n\tself.showRemain = function(){\r\n\t\tvar yes = self.is_importing;\r\n\t\tyes = yes && self.hasOwnProperty(\"remain\");\r\n\t\tif(yes) {\r\n\t\t\tyes = self.remain.hasOwnProperty(\"hour\");\r\n\t\t}\r\n\t\treturn yes;\r\n\t};\r\n\r\n\tself.refreshImgs();\r\n\r\n\tfunction loopImportProgress(img, doneCallback, failCallback){\r\n\t\tvar time = self.remain = {};\r\n\t\timg.total = img.size;\r\n\t\timg.startTime = Date.now();\r\n\t\tvar hasFeature = !!console.time;\r\n\t\tvar label = \"[upload \" + img.path + \"]\";\r\n\t\thasFeature && console.time(label);\r\n\t\tloop();\r\n\t\tfunction loop(){\r\n\t\t\tinit.import_progress(function(res){\r\n\t\t\t\tvar filemap = {};\r\n\t\t\t\tangular.forEach(res.result, function(item){\r\n\t\t\t\t\tif(item.filename === img.filename) {\r\n\t\t\t\t\t\tangular.extend(img, item);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// 还没有开始导入，此时不显示数据\r\n\t\t\t\tif(img.size === 0) {\r\n\t\t\t\t\t$timeout(loop, 1000);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar remainSize = img.total - img.size;\r\n\t\t\t\tvar speed = img.size / (Date.now() - img.startTime);\r\n\t\t\t\tvar remainTime = Math.floor(remainSize / speed / 1000);\r\n\t\t\t\ttime.hour = Math.floor(remainTime / 3600);\r\n\t\t\t\ttime.minute = Math.floor(remainTime / 60);\r\n\t\t\t\ttime.second = Math.floor(remainTime % 60);\r\n\t\t\t\tif(img.total === img.size) {\r\n\t\t\t\t\thasFeature && console.timeEnd(label);\r\n\t\t\t\t\tdoneCallback();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$timeout(loop, 1000);\r\n\t\t\t\t}\r\n\t\t\t}, failCallback);\r\n\t\t}\r\n\t}\r\n}])\r\n.controller(\"quickstartController\", [\"$scope\", \"$element\", \"$location\", function($scope, $element, $location){\r\n\tvar menuWidth = 220;\r\n\t// 循环计时器\r\n\tvar updateTimer;\r\n\t// 缓存的样式\r\n\tvar oldContentStyles = {};\r\n\tvar oldArrowStyles = {};\r\n\t// 是否需要手动点击快速部署父菜单的标记\r\n\tvar opened = false;\r\n\t$scope.ok = function(){\r\n\t\tcleanDOM();\r\n\t\t$location.url(\"/system/deploy\");\r\n\t};\r\n\t$scope.close = function(){\r\n\t\tcleanDOM();\r\n\t\t$location.url(\"/summary\");\r\n\t};\r\n\t$scope.$on(\"NOAUTH\", cleanDOM);\r\n\r\n    updatePosition();\r\n\r\n\tfunction updatePosition(){\r\n\t\tvar alignTarget = $(\"li[nav-title='快速部署']\");\r\n\t\tif(alignTarget.length === 0) {\r\n\t\t\tupdateTimer = setTimeout(updatePosition, 100);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// 高亮 快速部署 菜单项\r\n\t\talignTarget.addClass(\"left-menu-item-on\");\r\n\t\t// 如果父菜单没有展开，手动展开\r\n\t\tvar pmenu = alignTarget.parents(\"li\");\r\n\t\tif(!pmenu.hasClass(\"open\") && !opened) {\r\n\t\t\tpmenu.children(\"a\")[0].click();\r\n\t\t\topened = true;\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tif(!pmenu.hasClass(\"opened\")) {\r\n\t\t\t\t\topened = false;\r\n\t\t\t\t}\r\n\t\t\t}, 300);\r\n\t\t}\r\n\t\tvar targetOffset = alignTarget.offset();\r\n\t\tvar totalWidth = $(window).width();\r\n\t\tvar totalHeight = $(window).height();\r\n\t    var $content = $(\"#quickMaskModel .content\");\r\n\t    var $arrow = $(\"#quickMaskModel .jiantou\");\r\n\t    if(!$content || !$arrow) { return; }\r\n\t    // 水平垂直居中\r\n\t    var contentStyles = {\r\n\t\t\t'margin-left': $content.outerWidth() / -2,\r\n\t\t\t'margin-top': $content.outerHeight() / -2\r\n\t\t};\r\n\t\tif(!equalsRoughly(contentStyles, oldContentStyles)) {\r\n\t\t\t$content.css(contentStyles);\r\n\t\t\toldContentStyles = contentStyles;\r\n\t\t}\r\n\t\t$arrow[totalWidth < 979 ? 'hide' : 'show']();\r\n\t\tvar btn = $content.find(\".btn-primary\");\r\n\t\tvar btnOffset = btn.offset();\r\n\t\tvar contentLeft = $content.offset().left;\r\n\t\tvar arrowTop = btnOffset.top + btn.outerHeight() + 5;\r\n\t\t// var arrowRight = (btnOffset.left - contentLeft) / 2 + contentLeft;\r\n\t\tvar arrowRight = btnOffset.left + btn.outerWidth() / 2;\r\n\t\tif(totalWidth > 1460) {\r\n\t\t\tarrowRight = $content.offset().left + parseInt($content.css(\"padding-left\"));\r\n\t\t}\r\n\t\tvar arrowWidth = arrowRight - menuWidth;\r\n\t\tvar arrowHeight = targetOffset.top + alignTarget.outerHeight() / 2 - arrowTop;\r\n\t\tvar arrowStyles = {\r\n\t\t\tleft: menuWidth,\r\n\t\t\ttop: arrowTop + 6,\r\n\t\t\twidth: arrowWidth,\r\n\t\t\theight: arrowHeight > 0 ? arrowHeight : 0,\r\n\t\t\t\"background-position-x\": totalWidth > 1460 ? \"right\" : \"left\"\r\n\t\t};\r\n\t\t// 仅在计算的样式与之上一次计算的样式不同时才应用样式\r\n\t\tif(!equalsRoughly(arrowStyles, oldArrowStyles)) {\r\n\t\t\t$arrow.css(arrowStyles);\r\n\t\t\toldArrowStyles = arrowStyles;\r\n\t\t}\r\n\t\tupdateTimer = setTimeout(updatePosition, 100);\r\n\t}\r\n\r\n\tfunction cleanDOM() {\r\n\t\t$element.remove();\r\n\t\t$scope.$destroy();\r\n\t\t$(\"li[nav-title='快速部署']\").removeClass(\"left-menu-item-on\");\r\n\t\tclearTimeout(updateTimer);\r\n\t}\r\n\r\n\tfunction equalsRoughly(obj1, obj2) {\r\n\t\tvar eq = true;\r\n\t\tvar keys = Object.keys(obj1);\r\n\t\tangular.forEach(keys, function(key){\r\n\t\t\tvar v1 = obj1[key] || 0;\r\n\t\t\tvar v2 = obj2[key] || 0;\r\n\t\t\tif(typeof v1 !== \"number\" || typeof v2 !== \"number\") {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(Math.abs(v1 - v2) >= 5) {\r\n\t\t\t\teq = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn eq;\r\n\t}\r\n}])\r\n.controller(\"vdiSystemUSBThroughController\", [\"$scope\", \"$modal\", \"USBPassThrough\",function($scope, $modal,USBPassThrough){\r\n\r\n\t$scope.rows = [];\r\n\t$scope.loading = true;\r\n\r\n\tvar get_rows = function(){\r\n\t\tUSBPassThrough.query(function(res){\r\n\t\t\t$scope.rows = res.devices_info.sort(function(a,b){ return a.manufacturer>b.manufacturer?1:-1 });\r\n\t\t\t$scope.loading = false;\r\n\t\t});\r\n\t};\r\n\tget_rows();\r\n\t\r\n\t$scope.pagesizes = [10, 20, 30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\t$scope.currentPage = 1;\r\n\tvar _SCOPE = $scope;\r\n\r\n\t$scope.through = function(item){\r\n\t\tvar dialog = $modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/system/through_add.html\",\r\n\t\t\tcontroller: \"USBthroughDialog\",\r\n\t\t\tscope: $scope,\r\n\t\t\tsize: \"md\",\r\n\t\t\tresolve:{\r\n\t\t\t\tparams : function(){\r\n\t\t\t\t\treturn { throughItem: angular.copy(item) };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tdialog.result.then(function(data){\r\n\t\t\tif(data){\r\n\t\t\t\tget_rows();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t$scope.editThrough = function(item){\r\n\t\titem.edit = true;\r\n\t\tvar dialog = $modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/system/through_add.html\",\r\n\t\t\tcontroller: \"USBthroughDialog\",\r\n\t\t\tscope: $scope,\r\n\t\t\tsize: \"md\",\r\n\t\t\tresolve:{\r\n\t\t\t\tparams : function(){\r\n\t\t\t\t\treturn { throughItem: angular.copy(item) };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tdialog.result.then(function(data){\r\n\t\t\tif(data){\r\n\t\t\t\tget_rows();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t$scope.cancelThrough = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='取消绑定'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='CANCEL_THROUGH'></p><footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''><button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\tvar data = {\r\n\t\t\t\t\t\tcompute_node_id: item.compute_node_id,\r\n\t\t\t\t\t\tidentify: item.identify,\r\n\t\t\t\t\t\tinstance_id: item.instance_id\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUSBPassThrough.cancel(data,function(res){\r\n\t\t\t\t\t\tget_rows();\r\n\t\t\t\t\t\t$modalInstance && $modalInstance.close();\r\n\t\t\t\t\t}).$promise.finally(res => {\r\n\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n}])\r\n.controller('USBthroughDialog', ['$scope',\"$modalInstance\",\"AutoSnapshot\",\"ResourcePool\", \"params\", \"Scene\",\"TeachDesktop\",\"FenTemplate\",\"$$$I18N\",\"TreeInstances\",\"USBPassThrough\",function($scope,$modalInstance,AutoSnapshot,ResourcePool,params,Scene,TeachDesktop,FenTemplate,$$$I18N,TreeInstances,USBPassThrough){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.data = params.throughItem;\r\n\tif(!$scope.data.edit){\r\n\t\t$scope.data.type = null;\r\n\t\t$scope.data.scene_id = null;\r\n\t}\r\n\tvar old_instance_id = $scope.data.instance_id;\r\n\t$scope.data.expandedNodes = [];\r\n\t$scope.all_users = [];\r\n\t$scope.selectedUsers = {};\r\n\r\n\t$scope.changeType = function(type, flag){\r\n\t\tif(!flag){\r\n\t\t\t$scope.data.scene_id = null;\r\n\t\t\t$scope.data.instance_id = null;\r\n\t\t\t$scope.data.selected_desktop = null;\r\n\t\t}\r\n\t\tif(type=='2'){\r\n\t\t\tgetScenesDektop();\r\n\t\t}else if(type=='1'){\r\n\t\t\tgetCommonDektop();\r\n\t\t}else{\r\n\t\t\tgetSystemDektop();\r\n\t\t}\r\n\t}\r\n\tif($scope.data.edit){\r\n\t\t$scope.changeType($scope.data.type, true)\r\n\t}\r\n\tfunction getScenesDektop(){\r\n\t\tScene.query(function(res){\r\n\t\t\t$scope.scenes = res.modes.filter(function(item){ return item.virtual_type == 'kvm' });\r\n\t\t\tif($scope.data.scene_id){\r\n\t\t\t\t$scope.data.scene = $scope.scenes.filter(function(item){ return item.id == $scope.data.scene_id })[0];\r\n\t\t\t}else{ $scope.data.scene = $scope.scenes[0]; }\r\n\t\t\t$scope.getTeaches($scope.data.scene);\r\n\t\t},function(){  })\r\n\t}\r\n\t$scope.getTeaches = function(scene){\r\n\t\tif(scene){\r\n\t\t\t$scope.teachLoading = true;\r\n\t\t\tTeachDesktop.query({ id : scene.id },function(res){\r\n\t\t\t\t$scope.teachLoading = false;\r\n\t\t\t\t$scope.teaches = res.result;\r\n\t\t\t\tif($scope.data.instance_id){\r\n\t\t\t\t\t$scope.data.teach = $scope.teaches.filter(function(item){ return item.instance_id == $scope.data.instance_id })[0];\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.data.teach = $scope.teaches[0];\r\n\t\t\t\t}\r\n\t\t\t},function(){ $scope.teachLoading = false; })\r\n\t\t}\r\n\t}\r\n\tfunction getCommonDektop(){\r\n\t\t$scope.loadDesktops = true;\r\n\t\tTreeInstances.query({resource_pool: $scope.data.resource_pool_uuid}, function(res){\r\n\t\t\tvar adminUsers = res.result.filter(function(u){ return u.type=='admin'&&u.desktop_num });\r\n\t\t\tvar adminDesktops = [];\r\n\t\t\tadminUsers.forEach(function(u){\r\n\t\t\t\tu.desktops.forEach(function(desk){adminDesktops.push(desk)})\r\n\t\t\t})\r\n\t\t\tvar datas = [];\r\n\t\t\tif(getAdminNum(adminUsers)){\r\n\t\t\t\tdatas.push({name: $$$I18N.get('管理用户关联桌面'),desktop_num: getAdminNum(adminUsers), desktops: adminDesktops})\r\n\t\t\t}\r\n\t\t\tres.result.forEach(function(item){\r\n\t\t\t\tif(item.type=='common' && item.desktop_num){\r\n\t\t\t\t\tdatas.push(item);\r\n\t\t\t\t}else if(item.type=='domain' && item.desktop_num){\r\n\t\t\t\t\tdatas.push(item);\r\n\t\t\t\t}else{}\r\n\t\t\t});\r\n\t\t\t$scope.desktops = formatData(removeNoChildrenDeparts(datas),\"children\");\r\n\t\t\tif($scope.data.instance_id){\r\n\t\t\t\t$scope.data.selected_desktop = $scope.all_users.filter(d => {\r\n\t\t\t\t\treturn d.desktop_id === $scope.data.instance_id;\r\n\t\t\t\t})[0];\r\n\t\t\t}\r\n\t\t\t$scope.loadDesktops = false;\r\n\t\t});\r\n\t}\r\n\tfunction getSystemDektop(){\r\n\t\tFenTemplate.query(function(res){\r\n\t\t\t$scope.sys_desktops = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t\tif($scope.data.instance_id){\r\n\t\t\t\t$scope.data.sys_desktop = $scope.sys_desktops.filter(function(item){ return item.id == $scope.data.instance_id })[0];\r\n\t\t\t}else{\r\n\t\t\t\t$scope.data.sys_desktop = $scope.sys_desktops[0];\r\n\t\t\t}\r\n\t\t\t$scope.data.sys_desktop = $scope.sys_desktops[0];\r\n\t\t},function(){})\r\n\r\n\t}\r\n\r\n\t/* 个人桌面数据拉取及配置 */\r\n\t$scope.desktopsTreeOptions = {\r\n         dirSelectable:false,\r\n         injectClasses:{\r\n         \t\"liSelected\":\"tree-leaf-active\"\r\n         }\r\n    };\r\n\tfunction getAdminNum(rows){\r\n\t\treturn rows.reduce(function(count, item){\r\n\t\t\treturn count + item.desktop_num;\r\n\t\t}, 0);\r\n\t}\r\n\tfunction removeNoChildrenDeparts(data) {\r\n\t\tdata = data.filter(noUserFilter);\r\n\t\tdata.forEach(walk);\r\n\t\treturn data;\r\n\t\tfunction walk(node) {\r\n\t\t\tif(!node.dept_id) { return; }\r\n\t\t\tif(node.children) {\r\n                node.children = node.children.filter(noUserFilter);\r\n                node.children.forEach(walk);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction noUserFilter(node) {\r\n            if(node.dept_id && !node.children && node.desktops.length === 0) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n\tfunction formatData(d,name){\r\n\t\titeration(d,name);\r\n\t\treturn d;\r\n\t}\r\n\tfunction iteration(data,childName,list){\r\n\t\tfor(var i = 0 ; i < data.length ; i++){\r\n\t\t\t$scope.data.expandedNodes.push(data[i]);\r\n\t\t\tif(data[i][childName] && data[i][childName].length){\r\n\t\t\t\tvar len = iteration(data[i][childName],childName);\r\n\t\t\t\tif(len === 0){\r\n\t\t\t\t\tdata[i] = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!data[i]) { continue; }\r\n\t\t\tif(data[i].desktops && data[i].desktops.length > 0){\r\n\t\t\t\tdata[i].desktops.map(user => {\r\n\t\t\t\t\tuser.name = user.name || user.user_name;\r\n\t\t\t\t\tuser.id = user.id || user.desktop_id;\r\n\t\t\t\t\tuser._is_last = true;\r\n\t\t\t\t\t$scope.all_users.push(user);\r\n\t\t\t\t\treturn user;\r\n\t\t\t\t});\r\n\t\t\t\tdata[i][childName] = data[i].desktops;\r\n\t\t\t}\r\n\t\t\tif(data[i][childName] && data[i][childName].length === 0){\r\n\t\t\t\tdata[i]= undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\twhile(data.length > 0) {\r\n\t\t\t// 如果有数组元素为空，每次删除一个\r\n\t\t\tvar oldlen = data.length;\r\n\t\t\tfor(var i = 0 ; i < oldlen ; i++){\r\n\t\t\t\tif(data[i] === undefined){\r\n\t\t\t\t\tdata.splice(i,1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(oldlen === data.length) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn data.length;\r\n\t}\r\n\t/* 个人桌面数据拉取及配置---------------end */\r\n\r\n\t$scope.ok = function(){\r\n\t\t$scope.submiting = true;\r\n\t\tvar instance_id = \"\";\r\n\t\tif(this.data.type=='2'){\r\n\t\t\tinstance_id = this.data.teach.instance_id;\r\n\t\t}else if(this.data.type=='1'){\r\n\t\t\tinstance_id = this.data.selected_desktop.desktop_id;\r\n\t\t}else{\r\n\t\t\tinstance_id = this.data.sys_desktop.instance_id;\r\n\t\t}\r\n\t\tvar data = {\r\n\t\t\tcompute_node_id: this.data.compute_node_id,\r\n\t\t\tidentify: this.data.identify,\r\n\t\t\tinstance_id: instance_id,\r\n\t\t\told_instance_id: this.data.edit?old_instance_id:undefined\r\n\t\t};\r\n\t\tconsole.log(11111, data)\r\n\t\tUSBPassThrough.save(data,function(res){\r\n\t\t\t$scope.submiting = false;\r\n\t\t\t$modalInstance.close(res);\r\n\t\t},function(){\r\n\t\t\t$scope.submiting = false;\r\n\t\t})\r\n\r\n\t}\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller(\"vdiSystemAutoSnapshotController\", [\"$scope\", \"AutoSnapshot\", \"$modal\",function($scope, AutoSnapshot, $modal){\r\n\t$scope.rows = [];\r\n\t$scope.loading = true;\r\n\tvar get_rows = function(){\r\n\t\tAutoSnapshot.query(function(res){\r\n\t\t\t$scope.rows = res.result.sort(function(a,b){ return a.name>b.name?1:-1 });\r\n\t\t\t$scope.rows.forEach(function(item){\r\n\t\t\t\tif(item.period=='weekly'){\r\n\t\t\t\t\titem.date = 'weekly' + item.week_date;\r\n\t\t\t\t}else if(item.period=='monthly'){\r\n\t\t\t\t\titem.date = 'monthly' + item.month_date;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t$scope.loading = false;\r\n\t\t});\r\n\t};\r\n\tget_rows();\r\n\t\r\n\t$scope.pagesizes = [10, 20, 30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\t$scope.currentPage = 1;\r\n\tvar _SCOPE = $scope;\r\n\r\n\t$scope.active = function(snapshot){\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\tif(item.id == snapshot.id){\r\n\t\t\t\titem.active_loadding = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\tAutoSnapshot.active({ id: snapshot.id, active: !snapshot.active }, function(res){\r\n\t\t\tget_rows();\r\n\t\t\t$scope.rows.forEach(function(item){\r\n\t\t\t\tif(item.id == snapshot.id){\r\n\t\t\t\t\titem.active = !snapshot.active;\r\n\t\t\t\t\titem.active_loadding = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, function(err){\r\n\t\t\tget_rows();\r\n\t\t\t$scope.rows.forEach(function(item){\r\n\t\t\t\tif(item.id == snapshot.id){\r\n\t\t\t\t\titem.active = snapshot.active;\r\n\t\t\t\t\titem.active_loadding = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\t$scope.add = function(){\r\n\t\tvar dialog = $modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/system/snapshot_add.html\",\r\n\t\t\tcontroller: \"addSnapshotDialog\",\r\n\t\t\tsize: \"md\"\r\n\t\t});\r\n\t\tdialog.result.then(function(res){\r\n\t\t\tif(res){\r\n\t\t\t\tget_rows();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t$scope.edit = function(item){\r\n\t\titem.edit = true;\r\n\t\tvar dialog = $modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/system/snapshot_edit.html\",\r\n\t\t\tcontroller: \"editSnapshotDialog\",\r\n\t\t\tscope: $scope,\r\n\t\t\tsize: \"md\",\r\n\t\t\tresolve:{\r\n\t\t\t\tparams : function(){\r\n\t\t\t\t\treturn { snapshotItem: angular.copy(item) };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tdialog.result.then(function(data){\r\n\t\t\tif(data){\r\n\t\t\t\tget_rows();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t$scope.view = function(item){\r\n\t\titem.edit = false;\r\n\t\tvar dialog = $modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/system/snapshot_edit.html\",\r\n\t\t\tcontroller: \"editSnapshotDialog\",\r\n\t\t\tscope: $scope,\r\n\t\t\tsize: \"md\",\r\n\t\t\tresolve:{\r\n\t\t\t\tparams : function(){\r\n\t\t\t\t\treturn { snapshotItem: angular.copy(item) };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除自动快照策略'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='DELETE_AUTO_SNAPSHOT'></p><footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''><button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\tAutoSnapshot.delete({ids: selected_rows.map(function(row){ return row.id; })},function(res){\r\n\t\t\t\t\t\tget_rows();\r\n\t\t\t\t\t\t$modalInstance && $modalInstance.close();\r\n\t\t\t\t\t}).$promise.finally(res => {\r\n\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n}])\r\n.controller('addSnapshotDialog', ['$scope',\"$modalInstance\",\"AutoSnapshot\",\"ResourcePool\",\"$$$I18N\",\"TreeInstances\",function($scope,$modalInstance,AutoSnapshot,ResourcePool,$$$I18N,TreeInstances){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\r\n\t$scope.data = {expandedNodes: []};\r\n\r\n\tResourcePool.query(function(res){\r\n\t\t// $scope.resources = res.result.filter(function(item){ return item.hosts.length > 0});\r\n\t\t$scope.resources = res.result\r\n\t\t$scope.data.resource = $scope.resources[0];\r\n\t\t$scope.data.resource && $scope.queryTreeInstances($scope.data.resource)\r\n\t});\r\n\r\n\t/* 个人桌面数据拉取及配置 */\r\n\t$scope.selectedUsers = {};\r\n\tfunction getAdminNum(rows){\r\n\t\treturn rows.reduce(function(count, item){\r\n\t\t\treturn count + item.desktop_num;\r\n\t\t}, 0);\r\n\t}\r\n\t\r\n\t$scope.queryTreeInstances = function(resource){\r\n\t\t$scope.loadDesktops = true;\r\n\t\tTreeInstances.query({resource_pool: resource.id, need_rollback_desktops: 0}, function(res){\r\n\t\t\tvar adminUsers = res.result.filter(function(u){ return u.type=='admin'&&u.desktop_num });\r\n\t\t\tvar adminDesktops = [];\r\n\t\t\tadminUsers.forEach(function(u){\r\n\t\t\t\tu.desktops.forEach(function(desk){\r\n\t\t\t\t\tadminDesktops.push(desk);\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\tvar datas = [];\r\n\t\t\tif(getAdminNum(adminUsers)){\r\n\t\t\t\tdatas.push({name: $$$I18N.get('管理用户关联桌面'),desktop_num: getAdminNum(adminUsers), desktops: adminDesktops})\r\n\t\t\t}\r\n\t\t\tres.result.forEach(function(item){\r\n\t\t\t\tif(item.type=='common' && item.desktop_num){\r\n\t\t\t\t\tdatas.push(item);\r\n\t\t\t\t}else if(item.type=='domain' && item.desktop_num){\r\n\t\t\t\t\tdatas.push(item);\r\n\t\t\t\t}else{}\r\n\t\t\t});\r\n\t\t\t$scope.desktops = formatData(removeNoChildrenDeparts(datas),\"children\");\r\n\t\t\t$scope.loadDesktops = false;\r\n\t\t\tconsole.log(1111111, $scope.data.expandedNodes)\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction removeNoChildrenDeparts(data) {\r\n\t\tdata = data.filter(noUserFilter);\r\n\t\tdata.forEach(walk);\r\n\t\treturn data;\r\n\t\tfunction walk(node) {\r\n\t\t\tif(!node.dept_id) { return; }\r\n\t\t\tif(node.children) {\r\n                node.children = node.children.filter(noUserFilter);\r\n                node.children.forEach(walk);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction noUserFilter(node) {\r\n            if(node.dept_id && !node.children && node.desktops.length === 0) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n\tfunction formatData(d,name){\r\n\t\titeration(d,name);\r\n\t\treturn d;\r\n\t}\r\n\r\n\tfunction iteration(data,childName,list){\r\n\t\tfor(var i = 0 ; i < data.length ; i++){\r\n\t\t\t$scope.data.expandedNodes.push(data[i]);\r\n\t\t\tif(data[i][childName] && data[i][childName].length){\r\n\t\t\t\tvar len = iteration(data[i][childName],childName);\r\n\t\t\t\tif(len === 0){\r\n\t\t\t\t\tdata[i] = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!data[i]) { continue; }\r\n\t\t\tif(data[i].desktops && data[i].desktops.length > 0){\r\n\t\t\t\tdata[i].desktops.map(user => {\r\n\t\t\t\t\tuser.name = user.name || user.user_name;\r\n\t\t\t\t\tuser._is_last = true;\r\n\t\t\t\t\treturn user;\r\n\t\t\t\t});\r\n\t\t\t\tdata[i][childName] = data[i].desktops;\r\n\t\t\t}\r\n\t\t\tif(data[i][childName] && data[i][childName].length === 0){\r\n\t\t\t\tdata[i]= undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\twhile(data.length > 0) {\r\n\t\t\t// 如果有数组元素为空，每次删除一个\r\n\t\t\tvar oldlen = data.length;\r\n\t\t\tfor(var i = 0 ; i < oldlen ; i++){\r\n\t\t\t\tif(data[i] === undefined){\r\n\t\t\t\t\tdata.splice(i,1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(oldlen === data.length) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn data.length;\r\n\t}\r\n\r\n\tfunction recursionNode(obj, selected,name){\r\n\t\tif(obj[name]){\r\n\t\t\tobj[name].forEach(function(item){\r\n\t\t\t\titem._selected = selected;\r\n\t\t\t\trecursionNode(item, selected,name);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction calculateSelectedLeafs(node,cName,leafs){\r\n\t\t// 计算每一次点击有多少用户被选中\r\n\t\tvar _id = node.id || node.desktop_id;\r\n\t\tif(node[cName] && node[cName].length){\r\n\t\t\tnode[cName].forEach(n => {\r\n\t\t\t\tcalculateSelectedLeafs(n,cName,leafs)\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tnode._selected ? ($scope.selectedUsers[_id] = node) : (delete $scope.selectedUsers[_id]);\r\n\t\t}\r\n\t}\r\n\r\n\t$scope.showManageSelected = function(node, selected, $parentNode, $index, $first, $middle, $last, $odd, $even, $path,nodeChildren){\r\n\t\tvar childName = nodeChildren || \"children\";\r\n\t\tnode._selected = !node._selected;\r\n\t\trecursionNode(node, node._selected,childName);\r\n\t\tcalculateSelectedLeafs(node,childName,$scope.selectedUsers);\r\n\t\t$path().forEach(function(item,index){\r\n\t\t\tif(index!==0){\r\n\t\t\t\tvar _selectedNum = item[childName].filter(function(item){ return item._selected==true }).length;\r\n\t\t\t\tvar _middSelectedNum = item[childName].filter(function(item){ return item._selected=='middle' }).length;\r\n\t\t\t\tif(!_selectedNum){\r\n\t\t\t\t\titem._selected = false;\r\n\t\t\t\t}\r\n\t\t\t\tif(_selectedNum == item[childName].length){ item._selected = true; }\r\n\t\t\t\tif(_middSelectedNum || (_selectedNum && _selectedNum !== item[childName].length)){ item._selected = 'middle'; }\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.selectedUsersNums = function(){\r\n\t\treturn Object.keys($scope.selectedUsers).length;\r\n\t}\r\n\t$scope.ok = function(){\r\n\t\t$scope.submiting = true;\r\n\t\tvar data = {\r\n\t\t\tname: this.data.name,\r\n\t\t\tdescription: this.data.description,\r\n\t\t\tresource_pool: this.data.resource.uuid,\r\n\t\t\tperiod: this.data.period,\r\n\t\t\tweek_date: this.data.period=='weekly'?this.data.week_date:undefined,\r\n\t\t\tmonth_date: this.data.period=='monthly'?this.data.month_date:undefined,\r\n\t\t\tinstances: Object.keys($scope.selectedUsers)\r\n\t\t};\r\n\t\tAutoSnapshot.save(data,function(res){\r\n\t\t\t$scope.submiting = false;\r\n\t\t\t$modalInstance.close(res);\r\n\t\t},function(){\r\n\t\t\t$scope.submiting = false;\r\n\t\t})\r\n\t}\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller('editSnapshotDialog', ['$scope',\"$modalInstance\",\"AutoSnapshot\",\"ResourcePool\",\"$$$I18N\",\"TreeInstances\",\"params\",function($scope,$modalInstance,AutoSnapshot,ResourcePool,$$$I18N,TreeInstances,params){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.data = params.snapshotItem;\r\n\t$scope.data.expandedNodes = [];\r\n\t$scope.all_desktops = [];\r\n\r\n\tResourcePool.query(function(res){\r\n\t\t// $scope.resources = res.result.filter(function(item){ return item.hosts.length > 0});\r\n\t\t$scope.resources = res.result\r\n\t\t$scope.data.resource = $scope.resources.filter(function(item){ return item.uuid == $scope.data.resource_pool })[0];\r\n\t\t$scope.data.resource && $scope.queryTreeInstances($scope.data.resource);\r\n\t});\r\n\t$scope.initPeriod = function(period){\r\n\t\tif(period=='weekly'){\r\n\t\t\t$scope.data.week_date = '1';\r\n\t\t}else if(period=='monthly'){\r\n\t\t\t$scope.data.month_date = '1';\r\n\t\t}\r\n\t}\r\n\t/* 个人桌面数据拉取及配置 */\r\n\t$scope.selectedUsers = {};\r\n\tif($scope.data.edit){\r\n\t\t$scope.desktopTreeOptions = {\r\n\t\t\tisSelectable: function(node) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t};\r\n\t}else{\r\n\t\t$scope.desktopTreeOptions = {\r\n\t\t\tisSelectable: function(node) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tfunction getAdminNum(rows){\r\n\t\treturn rows.reduce(function(count, item){\r\n\t\t\treturn count + item.desktop_num;\r\n\t\t}, 0);\r\n\t}\r\n\r\n\t$scope.queryTreeInstances = function(resource){\r\n\t\t$scope.loadDesktops = true;\r\n\t\tTreeInstances.query({resource_pool: resource.id, need_rollback_desktops: 0}, function(res){\r\n\t\t\tvar adminUsers = res.result.filter(function(u){ return u.type=='admin'&&u.desktop_num });\r\n\t\t\tvar adminDesktops = [];\r\n\t\t\tadminUsers.forEach(function(u){\r\n\t\t\t\tu.desktops.forEach(function(desk){\r\n\t\t\t\t\tadminDesktops.push(desk);\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\tvar datas = [];\r\n\t\t\tif(getAdminNum(adminUsers)){\r\n\t\t\t\tdatas.push({name: $$$I18N.get('管理用户关联桌面'),desktop_num: getAdminNum(adminUsers), desktops: adminDesktops})\r\n\t\t\t}\r\n\t\t\tres.result.forEach(function(item){\r\n\t\t\t\tif(item.type=='common' && item.desktop_num){\r\n\t\t\t\t\tdatas.push(item);\r\n\t\t\t\t}else if(item.type=='domain' && item.desktop_num){\r\n\t\t\t\t\tdatas.push(item);\r\n\t\t\t\t}else{}\r\n\t\t\t});\r\n\t\t\t$scope.desktops = formatData(removeNoChildrenDeparts(datas),\"children\");\r\n\t\t\t$scope.all_desktops.forEach(function(item){\r\n\t\t\t\t$scope.data.instances.forEach(function(instance){\r\n\t\t\t\t\tif(instance.instance_id == item.desktop_id){\r\n\t\t\t\t\t\titem._selected = true;\r\n\t\t\t\t\t\t$scope.selectedUsers[item.desktop_id] = item;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tcheckNodeSelected($scope.desktops)\r\n\t\t\t$scope.loadDesktops = false;\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction removeNoChildrenDeparts(data) {\r\n\t\tdata = data.filter(noUserFilter);\r\n\t\tdata.forEach(walk);\r\n\t\treturn data;\r\n\t\tfunction walk(node) {\r\n\t\t\tif(!node.dept_id) { return; }\r\n\t\t\tif(node.children) {\r\n                node.children = node.children.filter(noUserFilter);\r\n                node.children.forEach(walk);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction noUserFilter(node) {\r\n            if(node.dept_id && !node.children && node.desktops.length === 0) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n\tfunction formatData(d,name){\r\n\t\titeration(d,name);\r\n\t\treturn d;\r\n\t}\r\n\tfunction checkNodeSelected(arr) {\r\n\t\tarr.forEach(function(node){\r\n\t\t\tif(node.children) {\r\n\t\t\t\tcheckNodeSelected(node.children);\r\n\t\t\t\tvar isAllSelected = true;\r\n\t\t\t\tvar hasSelected = false;\r\n\t\t\t\tvar hasMiddle = false;\r\n\t\t\t\tnode.children.forEach(function(subNode){\r\n\t\t\t\t\tif(subNode._selected == 'middle') {\r\n\t\t\t\t\t\thasMiddle = true;\r\n\t\t\t\t\t\tisAllSelected = false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(subNode._selected) {\r\n\t\t\t\t\t\thasSelected = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tisAllSelected = isAllSelected && subNode._selected;\r\n\t\t\t\t});\r\n\t\t\t\tif(isAllSelected) {\r\n\t\t\t\t\tnode._selected = true;\r\n\t\t\t\t} else if(hasMiddle) {\r\n\t\t\t\t\tnode._selected = \"middle\";\r\n\t\t\t\t} else if(hasSelected) {\r\n\t\t\t\t\tnode._selected = \"middle\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn arr;\r\n\t}\r\n\tfunction iteration(data,childName,list){\r\n\t\tfor(var i = 0 ; i < data.length ; i++){\r\n\t\t\t$scope.data.expandedNodes.push(data[i]);\r\n\t\t\tif(data[i][childName] && data[i][childName].length){\r\n\t\t\t\tvar len = iteration(data[i][childName],childName);\r\n\t\t\t\tif(len === 0){\r\n\t\t\t\t\tdata[i] = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!data[i]) { continue; }\r\n\t\t\tif(data[i].desktops && data[i].desktops.length > 0){\r\n\t\t\t\tdata[i].desktops.map(user => {\r\n\t\t\t\t\tuser.name = user.name || user.user_name;\r\n\t\t\t\t\tuser.id = user.id || user.desktop_id;\r\n\t\t\t\t\tuser._is_last = true;\r\n\t\t\t\t\t$scope.all_desktops.push(user);\r\n\t\t\t\t\treturn user;\r\n\t\t\t\t});\r\n\t\t\t\tdata[i][childName] = data[i].desktops;\r\n\t\t\t}\r\n\t\t\tif(data[i][childName] && data[i][childName].length === 0){\r\n\t\t\t\tdata[i]= undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\twhile(data.length > 0) {\r\n\t\t\t// 如果有数组元素为空，每次删除一个\r\n\t\t\tvar oldlen = data.length;\r\n\t\t\tfor(var i = 0 ; i < oldlen ; i++){\r\n\t\t\t\tif(data[i] === undefined){\r\n\t\t\t\t\tdata.splice(i,1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(oldlen === data.length) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn data.length;\r\n\t}\r\n\tfunction recursionNode(obj, selected,name){\r\n\t\tif(obj[name]){\r\n\t\t\tobj[name].forEach(function(item){\r\n\t\t\t\titem._selected = selected;\r\n\t\t\t\trecursionNode(item, selected,name);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tfunction calculateSelectedLeafs(node,cName,leafs){\r\n\t\t// 计算每一次点击有多少用户被选中\r\n\t\tvar _id = node.id || node.desktop_id;\r\n\t\tif(node[cName] && node[cName].length){\r\n\t\t\tnode[cName].forEach(n => {\r\n\t\t\t\tcalculateSelectedLeafs(n,cName,leafs)\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tnode._selected ? ($scope.selectedUsers[_id] = node) : (delete $scope.selectedUsers[_id]);\r\n\t\t}\r\n\t}\r\n\t$scope.showManageSelected = function(node, selected, $parentNode, $index, $first, $middle, $last, $odd, $even, $path,nodeChildren){\r\n\t\tvar childName = nodeChildren || \"children\";\r\n\t\tnode._selected = !node._selected;\r\n\t\trecursionNode(node, node._selected,childName);\r\n\t\tcalculateSelectedLeafs(node,childName,$scope.selectedUsers);\r\n\t\t$path().forEach(function(item,index){\r\n\t\t\tif(index!==0){\r\n\t\t\t\tvar _selectedNum = item[childName].filter(function(item){ return item._selected==true }).length;\r\n\t\t\t\tvar _middSelectedNum = item[childName].filter(function(item){ return item._selected=='middle' }).length;\r\n\t\t\t\tif(!_selectedNum){\r\n\t\t\t\t\titem._selected = false;\r\n\t\t\t\t}\r\n\t\t\t\tif(_selectedNum == item[childName].length){ item._selected = true; }\r\n\t\t\t\tif(_middSelectedNum || (_selectedNum && _selectedNum !== item[childName].length)){ item._selected = 'middle'; }\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.selectedUsersNums = function(){\r\n\t\treturn Object.keys($scope.selectedUsers).length;\r\n\t}\r\n\t$scope.ok = function(){\r\n\t\t$scope.submiting = true;\r\n\t\tvar data = {\r\n\t\t\tid: this.data.id,\r\n\t\t\tname: this.data.name,\r\n\t\t\tdescription: this.data.description,\r\n\t\t\tresource_pool: this.data.resource.uuid,\r\n\t\t\tperiod: this.data.period,\r\n\t\t\tweek_date: this.data.period=='weekly'?this.data.week_date:undefined,\r\n\t\t\tmonth_date: this.data.period=='monthly'?this.data.month_date:undefined,\r\n\t\t\tinstances: Object.keys($scope.selectedUsers)\r\n\t\t};\r\n\t\tAutoSnapshot.update(data,function(res){\r\n\t\t\t$scope.submiting = false;\r\n\t\t\t$modalInstance.close(res);\r\n\t\t},function(){\r\n\t\t\t$scope.submiting = false;\r\n\t\t})\r\n\t}\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.dismiss();\r\n\t};\r\n}])\r\n.controller(\"spiceConnectController\", [\"$scope\", \"$modal\", \"$$$I18N\", \"Spice\",function($scope, $modal, $$$I18N, Spice){\r\n\tvar spiceCtrl = this;\r\n\tspiceCtrl.getSpiceConnect = function(){\r\n\t\tspiceCtrl.loading = true;\r\n\t\tSpice.query(function(res){\r\n\t\t\tspiceCtrl.mode = res.spice_jpeg_compression;\r\n\t\t\tspiceCtrl.loading = false;\r\n\t\t},function(error){\r\n\t\t\tspiceCtrl.loading = false;\r\n\t\t})\r\n\t};\r\n\tspiceCtrl.getSpiceConnect();\r\n\tspiceCtrl.saveSpiceConnect = function(){\r\n\t\tspiceCtrl.save = true;\r\n\t\tSpice.save({spice_jpeg_compression: spiceCtrl.mode},function(res){\r\n\t\t\tspiceCtrl.save = false;\r\n\t\t\tspiceCtrl.getSpiceConnect();\r\n\t\t\tspiceCtrl.edit = false;\r\n\t\t},function(error){\r\n\t\t\tspiceCtrl.save = false;\r\n\t\t})\r\n\t};\r\n}])\r\n.controller(\"vdiSystemAutoclearController\", [\"$scope\", \"$modal\", \"$$$I18N\", \"Share\",function($scope, $modal, $$$I18N, Share){\r\n\tvar clearCtrl = this;\r\n\tclearCtrl.getClearTime = function(){\r\n\t\tclearCtrl.loading = true;\r\n\t\tShare.query(function(res){\r\n\t\t\tclearCtrl.day = res.value.day;\r\n\t\t\tvar time = res.value.time.split(\":\");\r\n\t\t\tclearCtrl.hours = time[0];\r\n\t\t\tclearCtrl.minutes = time[1];\r\n\t\t\tclearCtrl.seconds = time[2];\r\n\t\t\tclearCtrl.loading = false;\r\n\t\t},function(error){\r\n\t\t\tclearCtrl.loading = false;\r\n\t\t})\r\n\t};\r\n\tclearCtrl.getClearTime();\r\n\tclearCtrl.saveClearTime = function(){\r\n\t\tif(clearCtrl.hours.length==1 && Number(clearCtrl.hours)>=0 && Number(clearCtrl.hours)<=9){\r\n\t\t\tclearCtrl.hours = \"0\"+clearCtrl.hours\r\n\t\t}\r\n\t\tif(clearCtrl.minutes.length==1 && Number(clearCtrl.minutes)>=0 && Number(clearCtrl.minutes)<=9){\r\n\t\t\tclearCtrl.minutes = \"0\"+clearCtrl.minutes\r\n\t\t}\r\n\t\tif(clearCtrl.seconds.length==1 && Number(clearCtrl.seconds)>=0 && Number(clearCtrl.seconds)<=9){\r\n\t\t\tclearCtrl.seconds = \"0\"+clearCtrl.seconds\r\n\t\t}\r\n\t\tvar time = clearCtrl.hours + \":\" + clearCtrl.minutes + \":\" + clearCtrl.seconds;\r\n\t\tclearCtrl.save = true;\r\n\t\tShare.save({value: {day: clearCtrl.day, time: time}},function(res){\r\n\t\t\tclearCtrl.save = false;\r\n\t\t\tclearCtrl.getClearTime();\r\n\t\t\tclearCtrl.edit = false;\r\n\t\t},function(error){\r\n\t\t\tclearCtrl.save = false;\r\n\t\t})\r\n\t};\r\n}])\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/system/controllers.js","module.exports = {\"resource_template\":{\"key\":\"0\",\"title\":\"dev\"},\"resources\":[{\"key\":\"e-vdi\",\"name\":\"E-VDI\",\"title\":\"E-VDI\",\"langType\":\"cn\",\"langDes\":\"中文\",\"clientKey\":\"public\",\"public\":true},{\"key\":\"pc\",\"name\":\"云PC\",\"title\":\"云PC\",\"langType\":\"cn\",\"langDes\":\"中文\",\"clientKey\":\"public\",\"public\":true},{\"key\":\"classCh\",\"name\":\"云教室\",\"title\":\"云教室中文\",\"langType\":\"cn\",\"langDes\":\"中文\",\"clientKey\":\"public\",\"public\":true},{\"key\":\"classEn\",\"name\":\"Cloud Class\",\"title\":\"云教室英文\",\"langType\":\"en\",\"langDes\":\"English\",\"clientKey\":\"public\",\"public\":true}]}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./resources/info.json\n// module id = 2\n// module chunks = 0 1 2 3 4 5 6 7 8 9 10 11","angular.module(\"app.controllers\", [])\r\n\r\n.controller(\"PageViewController\", [\"$scope\", \"$route\", \"$animate\", function($scope, $route, $animate) {\r\n\t// controler of the dynamically loaded views, for DEMO purposes only.\r\n\t// $scope.$on(\"$viewContentLoaded\", function() {\r\n\t// \tconsole.log(\"ffffffff\")\r\n\t// })\r\n}])\r\n.controller(\"LangController\", [\"$scope\", \"settings\", \"localize\", function($scope, settings, localize) {\r\n\t$scope.languages = settings.languages;\r\n\t$scope.currentLang = settings.currentLang || $scope.languages[0];\r\n\t$scope.setLang = function(lang) {\r\n\t\tsettings.currentLang = lang;\r\n\t\t$scope.currentLang = lang;\r\n\t\tlocalize.setLang(lang);\r\n\t\t$$$storage.setSessionStorage('lang_code', lang.langCode)\r\n\t};\r\n\t// set the default language\r\n\t$scope.setLang($scope.currentLang);\r\n}]);\n\n\n// WEBPACK FOOTER //\n// ./js/ng/ng.controllers.js","var $hashstr = location.hash.substr(1) || \"\";\r\nvar $hash = $hashstr.replace(/^\\/+/, \"\").split(\"&\");\r\nvar $id = parseInt($hash[0]);\r\nvar $is_windows = $hash[1] && $hash[1].indexOf('Windows') > -1;\r\nvar $instance_id;\r\nvar $name = $hash[2]?decodeURIComponent($hash[2]):'';\r\nvar $is_personalTemp = $hash[3]==\"personal\"?true:false;\r\nvar $is_systemTemp = $hash[3]==\"sytem_desktop\"?true:false;\r\nvar $sameIp = $hashstr.split('=')[1] === \"true\" ? true : false;\r\nangular.module(\"vdi.vnc\", [\r\n    \"app.controllers\",\r\n    \"app.localize\",\r\n    \"ngResource\",\r\n    \"ui.bootstrap\",\r\n    \"vdi\",\r\n    \"vdi.desktop\",\r\n    \"vdi.template\",\r\n    \"vdi.template.teach\",\r\n    \"vdi.template.person\",\r\n    \"vdi.template.hardware\",\r\n    \"vdi.system\",\r\n    \"vdi.user\"\r\n])\r\n.config([\"$locationProvider\", function($locationProvider){\r\n    $locationProvider.html5Mode(true);\r\n}])\r\n.controller(\"isoListController\", [\"$scope\", \"$modalInstance\", \"SystemISO\", \"VNC\", function($scope, $modalInstance, isos, vnc){\r\n    $scope.isos = [];\r\n    isos.get(function(data){\r\n        // console.log(data);\r\n        $scope.isos = data.isos;\r\n        $scope.selectIsos = {\r\n            'package': [],\r\n            'other': [],\r\n            'system': []\r\n        };\r\n        $scope.isos_package = data.isos.filter(function(item){\r\n            return item.type == 'package';\r\n        });\r\n        angular.forEach(data.isos,function(item){\r\n            if(item['type'] == 'package'){\r\n                $scope.selectIsos['package'].push(item);\r\n            }else if(item['type'] == 'other'){\r\n                $scope.selectIsos['other'].push(item);\r\n            }else{\r\n                $scope.selectIsos['system'].push(item);\r\n            }\r\n        });\r\n    });\r\n\r\n    $scope.ok = function(iso){\r\n        /*  thor/image/loadISO post instance_id iso_name */\r\n        console.log($scope, iso);\r\n\r\n        vnc.loadISO({\r\n            instance_id: $instance_id,\r\n            id: iso ? iso.id : \"-1\"\r\n        }, function(){\r\n            $modalInstance.close();\r\n        }, function(err){\r\n            //alert(err);\r\n        });\r\n\r\n    };\r\n    $scope.close = function(){\r\n        $modalInstance.close();\r\n    };\r\n}])\r\n.controller(\"updateTemplateController\", [\"$scope\", \"$modalInstance\",\"SystemISO\", function($scope, $modalInstance, isos){\r\n    $scope.isos = [];\r\n    isos.get(function(data){\r\n        $scope.isos = data.isos;\r\n    })\r\n\r\n    $scope.ok = function(){\r\n        $modalInstance.close();\r\n    };\r\n    $scope.close = function(){\r\n        $modalInstance.close();\r\n    };\r\n    \r\n}])\r\n\r\n.controller(\"vncController\", [\r\n    \"$scope\", \"VMCommon\", \"VNC\", \"TeachTemplate\", \"PersonTemplate\", \"SystemISO\", \"Admin\", \"PersonDesktop\", \"$modal\", \"$timeout\", \"Scene\", \"$$$os_types\", \"UserRole\", \"$$$I18N\",\r\n    function($scope, vm, vnc, template, personTemplate, iso, admin, desktop, $modal, $timeout, scen, $$$os_types, UserRole, $$$I18N){\r\n    var rfb;\r\n    var it = $scope;\r\n    //不同网卡上不能存在相同网段的IP提示框\r\n    function  duplicatedIp(){\r\n        if($sameIp){\r\n            $.bigBox({\r\n                title: $$$I18N.get(\"INFOR_TIP\"),\r\n                content:$$$I18N.get(\"不同网卡上不能存在相同网段的IP\"),\r\n                timeout:6000\r\n            });\r\n        }   \r\n    }\r\n    duplicatedIp();\r\n    function passwordRequired(rfb) {\r\n        var msg;\r\n        msg = '<form onsubmit=\"return setPassword();\"';\r\n        msg += '  style=\"margin-bottom: 0px\">';\r\n        msg += 'Password Required: ';\r\n        msg += '<input type=password size=10 id=\"password_input\" class=\"noVNC_status\">';\r\n        msg += '<\\/form>';\r\n        $D('noVNC_status_bar').setAttribute(\"class\", \"noVNC_status_warn\");\r\n        $D('noVNC_status').innerHTML = msg;\r\n    }\r\n    function setPassword() {\r\n        rfb.sendPassword($D('password_input').value);\r\n        return false;\r\n    }\r\n    function sendCtrlAltDel() {\r\n        rfb.sendCtrlAltDel();\r\n        return false;\r\n    }\r\n    function init_params(password, instance_id, vnc_host, vnc_token){\r\n        var host, port, path, token;\r\n        host = WebUtil.getQueryVar('host', vnc_host); // vnc_host\r\n        port = WebUtil.getQueryVar('port', 6080);\r\n        password = WebUtil.getQueryVar('password', password);\r\n        //path = WebUtil.getQueryVar('path', 'websockify?instance_id=' + instance_id);\r\n        token = WebUtil.getQueryVar('token', null);\r\n        if (token) {\r\n           WebUtil.createCookie('token', token, 1)\r\n        }       \r\n        path = WebUtil.getQueryVar('path', 'websockify?token=' + vnc_token);\r\n\r\n        rfb = new RFB({'target':       $D('noVNC_canvas'),\r\n                       'encrypt':      WebUtil.getQueryVar('encrypt',\r\n                                (window.location.protocol === \"https:\")),\r\n                       'repeaterID':   WebUtil.getQueryVar('repeaterID', ''),\r\n                       'true_color':   WebUtil.getQueryVar('true_color', true),\r\n                       'local_cursor': WebUtil.getQueryVar('cursor', true),\r\n                       'shared':       WebUtil.getQueryVar('shared', false),\r\n                       'view_only':    WebUtil.getQueryVar('view_only', false),\r\n                       'onUpdateState':  updateState,\r\n                       // 'onXvpInit':    xvpInit,\r\n                       'onPasswordRequired':  passwordRequired});\r\n\r\n        // rfb = new RFB({'target': $D('noVNC_canvas'),\r\n        //     'encrypt':    WebUtil.getQueryVar('encrypt',\r\n        //             (window.location.protocol === \"https:\")),\r\n        //     'true_color':   WebUtil.getQueryVar('true_color', true),\r\n        //     'local_cursor': WebUtil.getQueryVar('cursor', true),\r\n        //     'shared':      WebUtil.getQueryVar('shared', false),\r\n        //     'view_only':    WebUtil.getQueryVar('view_only', false),\r\n        //     'updateState':  updateState,\r\n        //     'onPasswordRequired':  passwordRequired});\r\n\r\n\r\n        rfb.connect(host, port, password, path);\r\n    }\r\n    function updateState(rfb, state, oldstate, msg) {\r\n        var s, sb, cad, level,save_as_temp,load_iso;\r\n        s = $D('noVNC_status');\r\n        sb = $D('noVNC_status_bar');\r\n        cad = $D('sendCtrlAltDelButton');\r\n        save_as_temp = $D('save_as_template');\r\n        load_iso = $D('load_iso')\r\n        switch (state) {\r\n            case 'failed':     level = \"error\";  break;\r\n            case 'fatal':       level = \"error\";  break;\r\n            case 'normal':     level = \"normal\"; break;\r\n            case 'disconnected': level = \"normal\"; break;\r\n            case 'loaded':     level = \"normal\"; break;\r\n            default:             level = \"warn\";   break;\r\n        }\r\n\r\n        if (typeof(msg) !== 'undefined') {\r\n        //    sb.setAttribute(\"class\", \"noVNC_status_\" + level);\r\n            s.innerHTML = msg;\r\n        }\r\n    }\r\n\r\n    $scope.instance_id = \"\";\r\n    $scope.os_type = \"\";\r\n    $scope.is_template = false;\r\n    $scope.installed = false;\r\n    $scope.is_windows = $is_windows;\r\n    $scope.is_personalTemp = $is_personalTemp;\r\n    $scope.is_systemTemp = $is_systemTemp;\r\n    $scope.instance_count = 0;\r\n    $scope.name = $name;\r\n    \r\n    function getStatus(){\r\n        $timeout(function(){\r\n            personTemplate.status({ id: $id }, function(res){\r\n                $scope.installed = (res.status === \"installed\" || res.status === \"alive\") ? true : false;\r\n                $scope.making_installed = res.status === \"making\" || res.status === \"installed\" ? true : false;\r\n                getStatus();\r\n            }, function(){\r\n            });\r\n        }, 3000);\r\n    }\r\n\r\n    var flag = false;\r\n    var oldBigBox = $.bigBox;\r\n    $.bigBox = null;\r\n    function checkLoad(){\r\n        $timeout(function(){\r\n            if(!flag){\r\n                template.update(\r\n                    { id: $id },\r\n                    function(res){\r\n                        flag = true;\r\n                        $scope.is_template = res.is_template;\r\n                        $scope.instance_id = res.instance_id;\r\n                        $scope.os_type = res.os_type;\r\n                        $instance_id =  res.instance_id;\r\n                        $scope.passwd = res.passwd;\r\n                        $scope.vnc_host = res.vnc_host;\r\n                        $scope.image_name = res.image_name;\r\n                        $scope.instance_count = res.instance_count;\r\n                        init_params(res.passwd, res.instance_id, res.vnc_host, res.vnc_token);\r\n                        getStatus();\r\n                        $.bigBox = oldBigBox;\r\n                    },\r\n                    function(){\r\n                        checkLoad();\r\n                    }\r\n                );\r\n\r\n            }\r\n        }, 3000);\r\n    }\r\n    checkLoad();\r\n    \r\n    $scope.status = function(){\r\n        console.log(5555,rfb)\r\n        return rfb ? rfb._rfb_state : \"\";\r\n    }\r\n    $scope.start = function(){\r\n        \r\n        if($scope.status() !== \"normal\"){\r\n            vm.start({instance_ids:[$scope.instance_id]},function(){\r\n                function _loop(){\r\n                    template.get_image_vnc_info({instance_id:$instance_id},function(res){\r\n                        init_params(res.result.password, $scope.instance_id, $scope.vnc_host, res.result.token);\r\n                        setTimeout(function(){\r\n                            console.log($scope.status());\r\n                            if($scope.status() !== \"normal\"){\r\n                                _loop();\r\n                            }\r\n                        }, 1000);\r\n                    },function(){alert(\"start error\")});\r\n                }\r\n                _loop();\r\n            })\r\n        }\r\n        else{\r\n            alert(\"System has been in the boot state\")\r\n        }\r\n    };\r\n    $scope.shutdown = function(){\r\n        var instance_id = $scope.instance_id;\r\n        if($scope.status() === \"normal\"){\r\n            $modal.open({\r\n            template: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机确认'>\"+\r\n                    \"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CLIENTMODIFY_SHUT'></p><footer class='text-right'><img data-ng-if='loading' src='./img/building.gif' width='24px'><button class='btn btn-primary' data-ng-if='!loading' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n                controller : function($scope, $modalInstance){\r\n                    $scope.ok = function(){\r\n                        $scope.loading = true;\r\n                        vm.shutdowns(\r\n                            {instance_ids:[instance_id]},\r\n                            function(){\r\n                                $scope.loading = false;\r\n                                $modalInstance.close();\r\n                            },\r\n                            function(){ $scope.loading = false; alert(\"shutdown error\") }\r\n                        );\r\n                    },\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    }\r\n                },\r\n                size : \"sm\"\r\n            });\r\n        }\r\n        else{\r\n            alert(\"System has been in the under off state\")\r\n        }\r\n    };\r\n    $scope.CAD = function(){\r\n        rfb.sendCtrlAltDel();\r\n    };\r\n    $scope.updateTemplate = function(is_sys){\r\n        var instance_id = $scope.instance_id;\r\n        var image_name = $scope.image_name;\r\n        var is_personalTemp = $scope.is_personalTemp;\r\n        var instance_count = $scope.instance_count;\r\n        /*4.5.0添加模板更新提示*/\r\n        var is_update = false;\r\n        template.update_tpl_tip(function(res){\r\n            var resp = res.result;\r\n            if(resp.storage_type!==\"remote\" && resp.ha_mode===\"active_passive\"){\r\n                is_update = true;\r\n            }\r\n        })\r\n        if(is_update){\r\n            $.bigBox({\r\n                title: $$$I18N.get(\"INFOR_TIP\"),\r\n                content:$$$I18N.get(\"HA_MODE_REMOTE\"),\r\n                timeout:6000\r\n            });\r\n            return false; \r\n        }\r\n        if(!is_sys && $scope.is_template){\r\n            $modal.open({\r\n                templateUrl: \"views/vdi/dialog/template/template_update.html\",\r\n                size: \"md\",\r\n                controller: [\"$scope\", \"$modalInstance\", function($scope, $modalInstance){\r\n                    $scope.hasSchool = false;\r\n                    $scope.is_personalTemp = is_personalTemp;\r\n                    $scope.instance_count = instance_count;\r\n                    if($scope.is_personalTemp){\r\n                        desktop.update_instance({id: $id},function(res){\r\n                            $scope.instance = res.values;\r\n                        })\r\n                    }else{\r\n                        scen.query(function(res){\r\n                            var schools = [];$scope.schools=[];\r\n                            res.modes.filter(function(item){\r\n                                if(item.image_name === image_name)\r\n                                    return item;\r\n                            }).forEach(function(item){\r\n                                if(!schools[item.schoolroom]){\r\n                                    schools[item.schoolroom] = {name: item.schoolroom, modes: [item]};\r\n                                    $scope.schools.push({name: item.schoolroom, modes: [item]});\r\n                                }\r\n                                else{\r\n                                    schools[item.schoolroom].modes.push(item);\r\n                                    $scope.schools.forEach(function(sch){\r\n                                        if(sch.name == item.schoolroom){\r\n                                            sch.modes.push(item);\r\n                                        }\r\n                                    })\r\n                                }\r\n                            });\r\n                            if($scope.schools.length){ $scope.hasSchool = true; }\r\n                        })\r\n                    }\r\n                    $scope.ok = function(){\r\n                        $scope.loading = true;\r\n                        vnc.save({\r\n                            instance_id: instance_id,\r\n                            image_id: $id\r\n                        }, function(){\r\n                            $scope.loading = false;\r\n                            $D('noVNC_status').innerHTML = \"Update directive has been sent\";\r\n                            rfb.disconnect();\r\n                            $modalInstance.close();\r\n                            window.close();\r\n                        }, function(){\r\n                            $scope.loading = false;\r\n                            rfb.disconnect();\r\n                            $modalInstance.close();\r\n                            $D('noVNC_status').innerHTML = \"Update failed\";\r\n                            // window.close();\r\n                        });\r\n                    };\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    };\r\n                } ]\r\n            });\r\n\r\n        }\r\n        else if(!is_sys && !$scope.is_template){\r\n            $scope.saveTem_loading = true;\r\n            var p_scope = $scope;\r\n            vnc.save({\r\n                instance_id: p_scope.instance_id,\r\n                image_id: $id\r\n            }, function(res){\r\n                rfb.disconnect();\r\n                window.close();\r\n            },function(){ $scope.saveTem_loading = false; });\r\n            // $modal.open({\r\n            //     templateUrl: \"views/vdi/dialog/desktop/personal_save_template.html\",\r\n            //     size: \"md\",\r\n            //     controller: [\"$scope\", \"$modalInstance\", \"UserRole\", function($scope, $modalInstance, UserRole){\r\n            //         let user = UserRole.currentUser;\r\n            //         $scope.min_namelength=2;\r\n            //         $scope.max_namelength=20;\r\n            //         $scope.saveTemp = true;\r\n            //         if(user){\r\n            //             var userName = user.name || \"admin\";\r\n            //         }\r\n            //         admin.query(function(res){\r\n            //             $scope.owners = res.users;\r\n            //             $scope.owner = $scope.owners.filter(function(item){ return item.name === userName })[0];\r\n            //         });\r\n            //         $scope.classifys = $$$os_types;\r\n            //         $scope.classify = $scope.classifys[0];\r\n\r\n            //         $scope.selectTemplate = function(item){\r\n            //             $scope.template = item;\r\n            //         };\r\n            //         $scope.ok = function(){\r\n            //             var aa = {\r\n            //                     instance_id: p_scope.instance_id,\r\n            //                     image_id: $id\r\n            //                 }\r\n            //                 vnc.save({\r\n            //                     instance_id: p_scope.instance_id,\r\n            //                     image_id: $id\r\n            //                 }, function(res){\r\n            //                     //console.log(124124);\r\n            //                     $modalInstance.close();\r\n            //                 });\r\n            //         };\r\n            //         $scope.close = function(){\r\n            //             location.reload();\r\n            //             $modalInstance.close();\r\n            //             init_params(it.passwd, it.instance_id);\r\n            //         };\r\n            //     } ]\r\n            // });\r\n        }\r\n        else{\r\n            $modal.open({\r\n                template: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='安装完成确认'>\"+\r\n                        \"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='我已安装完成确认' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n                controller: function($scope, $modalInstance){\r\n                    $scope.ok = function(){\r\n                        $modalInstance.close();\r\n                        it.saveTem_loading = true;\r\n                        vnc.save({\r\n                            instance_id: instance_id,\r\n                            image_id: $id\r\n                        }, function(res){\r\n\r\n                        },function(){ it.saveTem_loading = false; });\r\n                    };\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    }\r\n                },\r\n                size: \"sm\"\r\n            });\r\n        }\r\n    };\r\n    $scope.loadISO = function(){\r\n        $modal.open({\r\n            templateUrl: \"/select-iso.html\",\r\n            controller: \"isoListController\",\r\n            size: \"md\"\r\n        });\r\n    };\r\n\r\n}])\r\n.run([\"$rootScope\", \"settings\", \"localize\", function($rootScope, settings, localize){\r\n    var lang_code = $$$storage.getSessionStorage('lang_code');\r\n    settings.currentLang = settings.languages.filter(function(lang){\r\n        return lang.langCode === lang_code;\r\n    })[0] || settings.languages[0]; // zh_cn\r\n    //console.log(settings.currentLang, settings, localize);\r\n    localize.setLang(settings.currentLang);\r\n}]);\r\n\r\n;\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/modify.page.js","angular.module('app.main', [])\r\n// initiate body\r\n.directive('body', function() {\r\n\treturn {\r\n\t\trestrict: 'E',\r\n\t\tlink: function(scope, element, attrs) {\r\n\t\t\telement.on('click', 'a[href=\"#\"], [data-toggle]', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n})\r\n\r\n.factory('ribbon', ['$rootScope', function($rootScope) {\r\n\tvar ribbon = {\r\n\t\tcurrentBreadcrumb: [],\r\n\t\tupdateBreadcrumb: function(crumbs) {\r\n\t\t\tvar breadCrumb = crumbs.reverse();\r\n\t\t\tribbon.currentBreadcrumb = breadCrumb;\r\n\t\t\t$rootScope.$broadcast('navItemSelected', breadCrumb);\r\n\t\t}\r\n\t};\r\n\r\n\treturn ribbon;\r\n}])\r\n\r\n.directive('action', function() {\r\n\treturn {\r\n\t\trestrict: 'A',\r\n\t\tlink: function(scope, element, attrs) {\r\n\t\t\t/*\r\n\t\t\t * SMART ACTIONS\r\n\t\t\t */\r\n\t\t\tvar smartActions = {\r\n    \r\n\t\t\t    // LOGOUT MSG \r\n\t\t\t    userLogout: function($this){\r\n\t\t\t\r\n\t\t\t\t\t// ask verification\r\n\t\t\t\t\t$.SmartMessageBox({\r\n\t\t\t\t\t\ttitle : \"<i class='fa fa-sign-out txt-color-orangeDark'></i> Logout <span class='txt-color-orangeDark'><strong>\" + $('#show-shortcut').text() + \"</strong></span> ?\",\r\n\t\t\t\t\t\tcontent : $this.data('logout-msg') || \"You can improve your security further after logging out by closing this opened browser\",\r\n\t\t\t\t\t\tbuttons : '[No][Yes]'\r\n\t\t\t\r\n\t\t\t\t\t}, function(ButtonPressed) {\r\n\t\t\t\t\t\tif (ButtonPressed == \"Yes\") {\r\n\t\t\t\t\t\t\t$.root_.addClass('animated fadeOutUp');\r\n\t\t\t\t\t\t\tsetTimeout(logout, 1000);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tfunction logout() {\r\n\t\t\t\t\t\twindow.location = $this.attr('href');\r\n\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// RESET WIDGETS\r\n\t\t\t    resetWidgets: function($this){\r\n\t\t\t\t\t$.widresetMSG = $this.data('reset-msg');\r\n\t\t\t\t\t\r\n\t\t\t\t\t$.SmartMessageBox({\r\n\t\t\t\t\t\ttitle : \"<i class='fa fa-refresh' style='color:green'></i> Clear Local Storage\",\r\n\t\t\t\t\t\tcontent : $.widresetMSG || \"Would you like to RESET all your saved widgets and clear LocalStorage?\",\r\n\t\t\t\t\t\tbuttons : '[No][Yes]'\r\n\t\t\t\t\t}, function(ButtonPressed) {\r\n\t\t\t\t\t\tif (ButtonPressed == \"Yes\" && localStorage) {\r\n\t\t\t\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t    },\r\n\t\t\t    \r\n\t\t\t    // LAUNCH FULLSCREEN \r\n\t\t\t    launchFullscreen: function(element){\r\n\t\t\t\r\n\t\t\t\t\tif (!$.root_.hasClass(\"full-screen\")) {\r\n\t\t\t\t\r\n\t\t\t\t\t\t$.root_.addClass(\"full-screen\");\r\n\t\t\t\t\r\n\t\t\t\t\t\tif (element.requestFullscreen) {\r\n\t\t\t\t\t\t\telement.requestFullscreen();\r\n\t\t\t\t\t\t} else if (element.mozRequestFullScreen) {\r\n\t\t\t\t\t\t\telement.mozRequestFullScreen();\r\n\t\t\t\t\t\t} else if (element.webkitRequestFullscreen) {\r\n\t\t\t\t\t\t\telement.webkitRequestFullscreen();\r\n\t\t\t\t\t\t} else if (element.msRequestFullscreen) {\r\n\t\t\t\t\t\t\telement.msRequestFullscreen();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$.root_.removeClass(\"full-screen\");\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (document.exitFullscreen) {\r\n\t\t\t\t\t\t\tdocument.exitFullscreen();\r\n\t\t\t\t\t\t} else if (document.mozCancelFullScreen) {\r\n\t\t\t\t\t\t\tdocument.mozCancelFullScreen();\r\n\t\t\t\t\t\t} else if (document.webkitExitFullscreen) {\r\n\t\t\t\t\t\t\tdocument.webkitExitFullscreen();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t   },\r\n\t\t\t\r\n\t\t\t   // MINIFY MENU\r\n\t\t\t    minifyMenu: function($this){\r\n\t\t\t    \tif (!$.root_.hasClass(\"menu-on-top\")){\r\n\t\t\t\t\t\t$.root_.toggleClass(\"minified\");\r\n\t\t\t\t\t\t$.root_.removeClass(\"hidden-menu\");\r\n\t\t\t\t\t\t$('html').removeClass(\"hidden-menu-mobile-lock\");\r\n\t\t\t\t\t\t$this.effect(\"highlight\", {}, 500);\r\n\t\t\t\t\t}\r\n\t\t\t    },\r\n\t\t\t    \r\n\t\t\t    // TOGGLE MENU \r\n\t\t\t    toggleMenu: function(){\r\n\t\t\t    \tif (!$.root_.hasClass(\"menu-on-top\")){\r\n\t\t\t\t\t\t$('html').toggleClass(\"hidden-menu-mobile-lock\");\r\n\t\t\t\t\t\t$.root_.toggleClass(\"hidden-menu\");\r\n\t\t\t\t\t\t$.root_.removeClass(\"minified\");\r\n\t\t\t    \t} else if ( $.root_.hasClass(\"menu-on-top\") && $.root_.hasClass(\"mobile-view-activated\") ) {\r\n\t\t\t    \t\t$('html').toggleClass(\"hidden-menu-mobile-lock\");\r\n\t\t\t\t\t\t$.root_.toggleClass(\"hidden-menu\");\r\n\t\t\t\t\t\t$.root_.removeClass(\"minified\");\r\n\t\t\t    \t}\r\n\t\t\t    },     \r\n\t\t\t\r\n\t\t\t    // TOGGLE SHORTCUT \r\n\t\t\t    toggleShortcut: function(){\r\n\t\t\t    \t\r\n\t\t\t\t\tif (shortcut_dropdown.is(\":visible\")) {\r\n\t\t\t\t\t\tshortcut_buttons_hide();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tshortcut_buttons_show();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// SHORT CUT (buttons that appear when clicked on user name)\r\n\t\t\t\t\tshortcut_dropdown.find('a').click(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\twindow.location = $(this).attr('href');\r\n\t\t\t\t\t\tsetTimeout(shortcut_buttons_hide, 300);\r\n\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t\t// SHORTCUT buttons goes away if mouse is clicked outside of the area\r\n\t\t\t\t\t$(document).mouseup(function(e) {\r\n\t\t\t\t\t\tif (!shortcut_dropdown.is(e.target) && shortcut_dropdown.has(e.target).length === 0) {\r\n\t\t\t\t\t\t\tshortcut_buttons_hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// SHORTCUT ANIMATE HIDE\r\n\t\t\t\t\tfunction shortcut_buttons_hide() {\r\n\t\t\t\t\t\tshortcut_dropdown.animate({\r\n\t\t\t\t\t\t\theight : \"hide\"\r\n\t\t\t\t\t\t}, 300, \"easeOutCirc\");\r\n\t\t\t\t\t\t$.root_.removeClass('shortcut-on');\r\n\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\t// SHORTCUT ANIMATE SHOW\r\n\t\t\t\t\tfunction shortcut_buttons_show() {\r\n\t\t\t\t\t\tshortcut_dropdown.animate({\r\n\t\t\t\t\t\t\theight : \"show\"\r\n\t\t\t\t\t\t}, 200, \"easeOutCirc\");\r\n\t\t\t\t\t\t$.root_.addClass('shortcut-on');\r\n\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t    }  \r\n\t\t\t   \r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tvar actionEvents = {\r\n\t\t\t\tuserLogout: function(e) {\r\n\t\t\t\t\tsmartActions.userLogout(element);\r\n\t\t\t\t},\r\n\t\t\t\tresetWidgets: function(e) {\r\n\t\t\t\t\tsmartActions.resetWidgets(element);\r\n\t\t\t\t},\r\n\t\t\t\tlaunchFullscreen: function(e) {\r\n\t\t\t\t\tsmartActions.launchFullscreen(document.documentElement);\r\n\t\t\t\t},\r\n\t\t\t\tminifyMenu: function(e) {\r\n\t\t\t\t\tsmartActions.minifyMenu(element);\r\n\t\t\t\t},\r\n\t\t\t\ttoggleMenu: function(e) {\r\n\t\t\t\t\tsmartActions.toggleMenu();\r\n\t\t\t\t},\r\n\t\t\t\ttoggleShortcut: function(e) {\r\n\t\t\t\t\tsmartActions.toggleShortcut();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (angular.isDefined(attrs.action) && attrs.action != '') {\r\n\t\t\t\tvar actionEvent = actionEvents[attrs.action];\r\n\t\t\t\tif (typeof actionEvent === 'function') {\r\n\t\t\t\t\telement.on('click', function(e) {\r\n\t\t\t\t\t\tactionEvent(e);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t};\r\n})\r\n\r\n.directive('header', function() {\r\n\treturn {\r\n\t\trestrict: 'EA',\r\n\t\tlink: function(scope, element, attrs) {\r\n\t\t\t// SHOW & HIDE MOBILE SEARCH FIELD\r\n\t\t\tangular.element('#search-mobile').click(function() {\r\n\t\t\t\t$.root_.addClass('search-mobile');\r\n\t\t\t});\r\n\r\n\t\t\tangular.element('#cancel-search-js').click(function() {\r\n\t\t\t\t$.root_.removeClass('search-mobile');\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n})\r\n\r\n.directive('ribbon', function() {\r\n\treturn {\r\n\t\trestrict: 'A',\r\n\t\tlink: function(scope, element, attrs) {\r\n\t\t\treturn;\r\n\t\t\telement.append('<div class=\"demo\"><span id=\"demo-setting\"><i class=\"fa fa-cog txt-color-blueDark\"></i></span> <form><legend class=\"no-padding margin-bottom-10\">Layout Options</legend><section><label><input name=\"subscription\" id=\"smart-fixed-header\" type=\"checkbox\" class=\"checkbox style-0\"><span>Fixed Header</span></label><label><input type=\"checkbox\" name=\"terms\" id=\"smart-fixed-navigation\" class=\"checkbox style-0\"><span>Fixed Navigation</span></label><label><input type=\"checkbox\" name=\"terms\" id=\"smart-fixed-ribbon\" class=\"checkbox style-0\"><span>Fixed Ribbon</span></label><label><input type=\"checkbox\" name=\"terms\" id=\"smart-fixed-footer\" class=\"checkbox style-0\"><span>Fixed Footer</span></label><label><input type=\"checkbox\" name=\"terms\" id=\"smart-fixed-container\" class=\"checkbox style-0\"><span>Inside <b>.container</b> <div class=\"font-xs text-right\">(non-responsive)</div></span></label><label style=\"display:block;\"><input type=\"checkbox\" id=\"smart-topmenu\" class=\"checkbox style-0\"><span>Menu on <b>top</b></span></label> <span id=\"smart-bgimages\"></span></section><section><h6 class=\"margin-top-10 semi-bold margin-bottom-5\">Clear Localstorage</h6><a href=\"javascript:void(0);\" class=\"btn btn-xs btn-block btn-primary\" id=\"reset-smart-widget\"><i class=\"fa fa-refresh\"></i> Factory Reset</a></section> <h6 class=\"margin-top-10 semi-bold margin-bottom-5\">SmartAdmin Skins</h6><section id=\"smart-styles\"><a href=\"javascript:void(0);\" id=\"smart-style-0\" data-skinlogo=\"img/logo.png\" class=\"btn btn-block btn-xs txt-color-white margin-right-5\" style=\"background-color:#4E463F;\"><i class=\"fa fa-check fa-fw\" id=\"skin-checked\"></i>Smart Default</a><a href=\"javascript:void(0);\" id=\"smart-style-1\" data-skinlogo=\"img/logo-white.png\" class=\"btn btn-block btn-xs txt-color-white\" style=\"background:#3A4558;\">Dark Elegance</a><a href=\"javascript:void(0);\" id=\"smart-style-2\" data-skinlogo=\"img/logo-blue.png\" class=\"btn btn-xs btn-block txt-color-darken margin-top-5\" style=\"background:#fff;\">Ultra Light</a><a href=\"javascript:void(0);\" id=\"smart-style-3\" data-skinlogo=\"img/logo-pale.png\" class=\"btn btn-xs btn-block txt-color-white margin-top-5\" style=\"background:#f78c40\">Google Skin</a></section></form> </div>')\r\n\r\n\t\t\t// hide bg options\r\n\t\t\tvar smartbgimage = \"<h6 class='margin-top-10 semi-bold'>Background</h6><img src='img/pattern/graphy-xs.png' data-htmlbg-url='img/pattern/graphy.png' width='22' height='22' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/tileable_wood_texture-xs.png' width='22' height='22' data-htmlbg-url='img/pattern/tileable_wood_texture.png' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/sneaker_mesh_fabric-xs.png' width='22' height='22' data-htmlbg-url='img/pattern/sneaker_mesh_fabric.png' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/nistri-xs.png' data-htmlbg-url='img/pattern/nistri.png' width='22' height='22' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/paper-xs.png' data-htmlbg-url='img/pattern/paper.png' width='22' height='22' class='bordered cursor-pointer'>\";\r\n\t\t\t$(\"#smart-bgimages\")\r\n\t\t\t    .fadeOut();\r\n\r\n\t\t\t$('#demo-setting')\r\n\t\t\t    .click(function () {\r\n\t\t\t        $('#ribbon .demo')\r\n\t\t\t            .toggleClass('activate');\r\n\t\t\t    })\r\n\t\t\t/*\r\n\t\t\t * FIXED HEADER\r\n\t\t\t */\r\n\t\t\t$('input[type=\"checkbox\"]#smart-fixed-header')\r\n\t\t\t    .click(function () {\r\n\t\t\t        if ($(this)\r\n\t\t\t            .is(':checked')) {\r\n\t\t\t            //checked\r\n\t\t\t            $.root_.addClass(\"fixed-header\");\r\n\t\t\t        } else {\r\n\t\t\t            //unchecked\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-ribbon')\r\n\t\t\t                .prop('checked', false);\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-navigation')\r\n\t\t\t                .prop('checked', false);\r\n\r\n\t\t\t            $.root_.removeClass(\"fixed-header\");\r\n\t\t\t            $.root_.removeClass(\"fixed-navigation\");\r\n\t\t\t            $.root_.removeClass(\"fixed-ribbon\");\r\n\r\n\t\t\t        }\r\n\t\t\t    });\r\n\r\n\t\t\t/*\r\n\t\t\t * FIXED NAV\r\n\t\t\t */\r\n\t\t\t$('input[type=\"checkbox\"]#smart-fixed-navigation')\r\n\t\t\t    .click(function () {\r\n\t\t\t        if ($(this)\r\n\t\t\t            .is(':checked')) {\r\n\t\t\t            //checked\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-header')\r\n\t\t\t                .prop('checked', true);\r\n\r\n\t\t\t            $.root_.addClass(\"fixed-header\");\r\n\t\t\t            $.root_.addClass(\"fixed-navigation\");\r\n\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-container')\r\n\t\t\t                .prop('checked', false);\r\n\t\t\t            $.root_.removeClass(\"container\");\r\n\r\n\t\t\t        } else {\r\n\t\t\t            //unchecked\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-ribbon')\r\n\t\t\t                .prop('checked', false);\r\n\t\t\t            $.root_.removeClass(\"fixed-navigation\");\r\n\t\t\t            $.root_.removeClass(\"fixed-ribbon\");\r\n\t\t\t        }\r\n\t\t\t    });\r\n\r\n\t\t\t/*\r\n\t\t\t * FIXED RIBBON\r\n\t\t\t */\r\n\t\t\t$('input[type=\"checkbox\"]#smart-fixed-ribbon')\r\n\t\t\t    .click(function () {\r\n\t\t\t        if ($(this)\r\n\t\t\t            .is(':checked')) {\r\n\r\n\t\t\t            //checked\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-header')\r\n\t\t\t                .prop('checked', true);\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-navigation')\r\n\t\t\t                .prop('checked', true);\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-ribbon')\r\n\t\t\t                .prop('checked', true);\r\n\r\n\t\t\t            //apply\r\n\t\t\t            $.root_.addClass(\"fixed-header\");\r\n\t\t\t            $.root_.addClass(\"fixed-navigation\");\r\n\t\t\t            $.root_.addClass(\"fixed-ribbon\");\r\n\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-container')\r\n\t\t\t                .prop('checked', false);\r\n\t\t\t            $.root_.removeClass(\"container\");\r\n\r\n\t\t\t        } else {\r\n\t\t\t            //unchecked\r\n\t\t\t            $.root_.removeClass(\"fixed-ribbon\");\r\n\t\t\t        }\r\n\t\t\t    });\r\n\r\n\t\t\t/*\r\n\t\t\t * RTL SUPPORT\r\n\t\t\t */\r\n\t\t\t$('input[type=\"checkbox\"]#smart-fixed-footer')\r\n\t\t\t    .click(function () {\r\n\t\t\t        if ($(this)\r\n\t\t\t            .is(':checked')) {\r\n\r\n\t\t\t            //checked\r\n\t\t\t            $.root_.addClass(\"fixed-page-footer\");\r\n\r\n\t\t\t        } else {\r\n\t\t\t            //unchecked\r\n\t\t\t            $.root_.removeClass(\"fixed-page-footer\");\r\n\t\t\t        }\r\n\t\t\t    });\r\n\r\n\r\n\t\t\t/*\r\n\t\t\t * RTL SUPPORT\r\n\t\t\t */\r\n\t\t\t$('input[type=\"checkbox\"]#smart-rtl')\r\n\t\t\t    .click(function () {\r\n\t\t\t        if ($(this)\r\n\t\t\t            .is(':checked')) {\r\n\r\n\t\t\t            //checked\r\n\t\t\t            $.root_.addClass(\"smart-rtl\");\r\n\r\n\t\t\t        } else {\r\n\t\t\t            //unchecked\r\n\t\t\t            $.root_.removeClass(\"smart-rtl\");\r\n\t\t\t        }\r\n\t\t\t    });\r\n\r\n\t\t\t/*\r\n\t\t\t * MENU ON TOP\r\n\t\t\t */\r\n\r\n\t\t\t$('#smart-topmenu')\r\n\t\t\t    .on('change', function (e) {\r\n\t\t\t        if ($(this)\r\n\t\t\t            .prop('checked')) {\r\n\t\t\t            //window.location.href = '?menu=top';\r\n\t\t\t            localStorage.setItem('sm-setmenu', 'top');\r\n\t\t\t            location.reload();\r\n\t\t\t        } else {\r\n\t\t\t            //window.location.href = '?';\r\n\t\t\t            localStorage.setItem('sm-setmenu', 'left');\r\n\t\t\t            location.reload();\r\n\t\t\t        }\r\n\t\t\t    });\r\n\r\n\t\t\tif (localStorage.getItem('sm-setmenu') == 'top') {\r\n\t\t\t    $('#smart-topmenu')\r\n\t\t\t        .prop('checked', true);\r\n\t\t\t} else {\r\n\t\t\t    $('#smart-topmenu')\r\n\t\t\t        .prop('checked', false);\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\t * INSIDE CONTAINER\r\n\t\t\t */\r\n\t\t\t$('input[type=\"checkbox\"]#smart-fixed-container')\r\n\t\t\t    .click(function () {\r\n\t\t\t        if ($(this)\r\n\t\t\t            .is(':checked')) {\r\n\t\t\t            //checked\r\n\t\t\t            $.root_.addClass(\"container\");\r\n\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-ribbon')\r\n\t\t\t                .prop('checked', false);\r\n\t\t\t            $.root_.removeClass(\"fixed-ribbon\");\r\n\r\n\t\t\t            $('input[type=\"checkbox\"]#smart-fixed-navigation')\r\n\t\t\t                .prop('checked', false);\r\n\t\t\t            $.root_.removeClass(\"fixed-navigation\");\r\n\r\n\t\t\t            if (smartbgimage) {\r\n\t\t\t                $(\"#smart-bgimages\")\r\n\t\t\t                    .append(smartbgimage)\r\n\t\t\t                    .fadeIn(1000);\r\n\t\t\t                $(\"#smart-bgimages img\")\r\n\t\t\t                    .bind(\"click\", function () {\r\n\t\t\t                        var $this = $(this);\r\n\t\t\t                        var $html = $('html')\r\n\t\t\t                        bgurl = ($this.data(\"htmlbg-url\"));\r\n\t\t\t                        $html.css(\"background-image\", \"url(\" + bgurl + \")\");\r\n\t\t\t                    })\r\n\t\t\t                smartbgimage = null;\r\n\t\t\t            } else {\r\n\t\t\t                $(\"#smart-bgimages\")\r\n\t\t\t                    .fadeIn(1000);\r\n\t\t\t            }\r\n\r\n\t\t\t        } else {\r\n\t\t\t            //unchecked\r\n\t\t\t            $.root_.removeClass(\"container\");\r\n\t\t\t            $(\"#smart-bgimages\")\r\n\t\t\t                .fadeOut();\r\n\t\t\t        }\r\n\t\t\t    });\r\n\r\n\t\t\t/*\r\n\t\t\t * REFRESH WIDGET\r\n\t\t\t */\r\n\t\t\t$(\"#reset-smart-widget\")\r\n\t\t\t    .bind(\"click\", function () {\r\n\t\t\t        $('#refresh')\r\n\t\t\t            .click();\r\n\t\t\t        return false;\r\n\t\t\t    });\r\n\r\n\t\t\t/*\r\n\t\t\t * STYLES\r\n\t\t\t */\r\n\t\t\t$(\"#smart-styles > a\")\r\n\t\t\t   .on('click', function() {\r\n\t\t\t        var $this = $(this);\r\n\t\t\t        var $logo = $(\"#logo img\");\r\n\t\t\t        $.root_.removeClassPrefix('smart-style')\r\n\t\t\t            .addClass($this.attr(\"id\"));\r\n\t\t\t        $logo.attr('src', $this.data(\"skinlogo\"));\r\n\t\t\t        $(\"#smart-styles > a #skin-checked\")\r\n\t\t\t            .remove();\r\n\t\t\t        $this.prepend(\"<i class='fa fa-check fa-fw' id='skin-checked'></i>\");\r\n\t\t\t    });\r\n\t\t}\r\n\t};\r\n})\r\n\r\n.controller('breadcrumbController', ['$scope', function($scope) {\r\n\t$scope.breadcrumbs = [];\r\n\t$scope.$on('navItemSelected', function(name, crumbs) {\r\n\t\t$scope.setBreadcrumb(crumbs);\r\n\t});\r\n\r\n\t$scope.setBreadcrumb = function(crumbs) {\r\n\t\t$scope.breadcrumbs = crumbs;\r\n\t}\r\n}])\r\n\r\n.directive('breadcrumb', ['ribbon', 'localize', '$compile', function(ribbon, localize, $compile) {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\tcontroller: 'breadcrumbController',\r\n\t\treplace: true,\r\n\t\tlink: function(scope, element, attrs) {\r\n\t\t\tscope.$watch('breadcrumbs', function(newVal, oldVal) {\r\n\t\t\t\tif (newVal !== oldVal || !element.text()) {\r\n\t\t\t\t\t// update DOM\r\n\t\t\t\t\tscope.updateDOM();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tscope.updateDOM = function() {\r\n\t\t\t\telement.empty();\r\n\t\t\t\tangular.forEach(scope.breadcrumbs, function(crumb) {\r\n\t\t\t\t\tvar li = angular.element('<li data-localize=\"' + crumb + '\">' + crumb + '</li>');\r\n\t\t\t\t\tli.text(localize.localizeText(crumb));\r\n\t\t\t\t\t\r\n\t\t\t\t\t$compile(li)(scope);\r\n\t\t\t\t\telement.append(li);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// set the current breadcrumb on load\r\n\t\t\tscope.setBreadcrumb(ribbon.currentBreadcrumb);\r\n\t\t\tscope.updateDOM();\r\n\t\t},\r\n\t\ttemplate: '<ol class=\"breadcrumb\"></ol>'\r\n\t}\r\n}])\r\n;\r\n\r\n// directives for localization\r\nangular.module('app.localize', [])\r\n.factory('localize', ['$http', '$rootScope', '$window', \"settings\", \"$RESOURCE\", function($http, $rootScope, $window, settings, $RESOURCE){\r\n\t// shared variables for `translate`\r\n\tvar encodeHTML = function(txt){\r\n\t\treturn txt.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n\t}\r\n\tvar tmplReg = /\\{\\{([^\\}]+)\\}\\}/g;\r\n\tvar interestAttrReg = /^param\\d+$/;\r\n\t// internal flag\r\n\tvar ready = false;\r\n\t// factory\r\n\tvar localize = {\r\n\t\tcurrentLocaleData: {},\r\n\t\tcurrentLang: {},\r\n\t\tsetLang: function(lang) {\r\n\t\t\tif(!lang){\r\n\t\t\t\tlang = settings.languages[0];\r\n\t\t\t}\r\n\t\t\t$RESOURCE.load(lang.key, function(data){\r\n\t\t\t\tlocalize.currentLocaleData = data.lang;\r\n\t\t\t\tlocalize.currentLang = lang;\r\n\t\t\t\tready = true;\r\n\t\t\t\t$rootScope.$broadcast('localizeLanguageChanged');\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetLangUrl: function(lang) {\r\n\t\t\treturn \"resources/pkg/\" + lang.langCode + \"/lang.js\";\r\n\t\t},\r\n\r\n\t\tlocalizeText: function(sourceText) {\r\n\t\t\treturn localize.currentLocaleData[sourceText];\r\n\t\t},\r\n\t\ttranslate: function(scope, element, attrs, transkey){\r\n\t\t\tvar onAttrChange = function(e){\r\n\t\t\t\tif(!ready) { return; }\r\n\t\t\t\tvar tmpl = localize.localizeText(attrs[transkey]);\r\n\t\t\t\t// 无效的翻译\r\n\t\t\t\tif(!tmpl) {\r\n\t\t\t\t\t// debug\r\n\t\t\t\t\t// return console.error(\"invalid \" + transkey + \"=\\\"\" + attrs[transkey] + \"\\\"\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar myhtml = tmplReg.test(tmpl) ? tmpl.replace(tmplReg, function(match, index){\r\n\t\t\t\t\tvar myattr = \"param\" + index;\r\n\t\t\t\t\tvar value = attrs[myattr];\r\n\t\t\t\t\treturn encodeHTML(value);\r\n\t\t\t\t}) : tmpl;\r\n\t\t\t\tswitch(transkey) {\r\n\t\t\t\t\tcase \"localize\":\r\n\t\t\t\t\t\tif(element.is(\"input, textarea\")){\r\n\t\t\t\t\t\t\telement.attr(\"placeholder\", myhtml);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\telement.html(myhtml);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"localizeHref\":\r\n\t\t\t\t\t\telement.attr(\"href\", myhtml); break;\r\n\t\t\t\t\tcase \"localizeTitle\":\r\n\t\t\t\t\t\telement.attr(\"title\", myhtml); break;\r\n\t\t\t\t\tcase \"localizePlaceholder\":\r\n\t\t\t\t\t\telement.attr(\"placeholder\", myhtml); break;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tangular.forEach(attrs, function(v, k){\r\n\t\t\t\tif(interestAttrReg.test(k)) {\r\n\t\t\t\t\tattrs.$observe(k, onAttrChange);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(ready) {\r\n\t\t\t\tonAttrChange();\r\n\t\t\t}\r\n\t\t\tscope.$on(\"localizeLanguageChanged\", onAttrChange);\r\n\t\t},\r\n\t\tisReady: function(){\r\n\t\t\treturn ready;\r\n\t\t}\r\n\t};\r\n\r\n\treturn localize;\r\n}])\r\n.directive('localize', ['localize', function(localize) {\r\n\treturn {\r\n\t\trestrict: \"A\",\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\tlocalize.translate(scope, element, attrs, \"localize\");\r\n\t\t}\r\n\t};\r\n}])\r\n.directive(\"localizeTitle\", [\"localize\", function(localize){\r\n\treturn {\r\n\t\trestrict: \"A\",\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\tlocalize.translate(scope, element, attrs, \"localizeTitle\");\r\n\t\t}\r\n\t};\r\n}])\r\n.directive(\"localizePlaceholder\", [\"localize\", function(localize){\r\n\treturn {\r\n\t\trestrict: \"A\",\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\tlocalize.translate(scope, element, attrs, \"localizePlaceholder\");\r\n\t\t}\r\n\t};\r\n}])\r\n.directive(\"localizeHref\", [\"localize\", function(localize){\r\n\treturn {\r\n\t\trestrict: \"A\",\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\tlocalize.translate(scope, element, attrs, \"localizeHref\");\r\n\t\t}\r\n\t};\r\n}])\r\n;\r\n\r\n// directives for navigation\r\nangular.module('app.navigation', [])\r\n.directive('navigation', [\"$timeout\",  function($timeout) {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\tcontroller: ['$scope', function($scope) {\r\n\t\t\t//$scope.version = $$$version;\r\n\t\t}],\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\tvar timer = null;\r\n\t\t\tlet timer_handle = function(){\r\n\t\t\t\tif (!topmenu) {\r\n\t\t\t\t\tif (!null) {\r\n\t\t\t\t\t\telement.first().jarvismenu({\r\n\t\t\t\t\t\t\taccordion : true,\r\n\t\t\t\t\t\t\tspeed : $.menu_speed,\r\n\t\t\t\t\t\t\tclosedSign : '<em class=\"fa icon-jj-xiala\"></em>',\r\n\t\t\t\t\t\t\topenedSign : '<em class=\"fa icon-jj-sou\"></em>'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//alert(\"Error - menu anchor does not exist\");\r\n\t\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\t\ttitle : \"Error\",\r\n\t\t\t\t\t\t\tcontent : \"menu anchor does not exist\",\r\n\t\t\t\t\t\t\tcolor : \"#C46A69\",\r\n\t\t\t\t\t\t\ticon : \"fa fa-warning shake animated\",\r\n\t\t\t\t\t\t\tnumber : \"1\",\r\n\t\t\t\t\t\t\ttimeout : 6000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// SLIMSCROLL FOR NAV\r\n\t\t\t\tif ($.fn.slimScroll) {\r\n\t\t\t\t\telement.slimScroll({\r\n\t\t\t\t        height: '100%'\r\n\t\t\t\t    });\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.getElement = function() {\r\n\t\t\t\t\treturn element;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tscope.$on(\"updateNavData\", function(name, navs){\r\n\t\t\t\tscope.navs = navs;\r\n\t\t\t});\r\n\t\t\tscope.$on(\"renderNavItem\", function(name){\r\n\t\t\t\t$timeout.cancel(timer);\r\n\t\t\t\ttimer = $timeout(timer_handle, 100);\r\n\t\t\t});\r\n\t\t},\r\n\t\ttemplate: \"<nav><ul data-ng-transclude></ul></nav>\"\r\n\t};\r\n}])\r\n\r\n\r\n.controller('NavItemController', ['$rootScope', '$scope', '$location', function($rootScope, $scope, $location) {\r\n\t$scope.isChild = false;\r\n\t$scope.active = false;\r\n\t$scope.isActive = function (viewLocation) {\r\n        $scope.active = viewLocation === $location.path();\r\n        return $scope.active;\r\n    };\r\n    $scope.hasIcon = angular.isDefined($scope.icon);\r\n    $scope.hasIconCaption = angular.isDefined($scope.iconCaption);\r\n\r\n    $scope.getItemUrl = function(view) {\r\n    \tif (angular.isDefined($scope.href)) return $scope.href;\r\n    \tif (!angular.isDefined(view)) return '';\r\n    \treturn '#' + view;\r\n    };\r\n\r\n    $scope.getItemTarget = function() {\r\n    \treturn angular.isDefined($scope.target) ? $scope.target : '_self';\r\n    };\r\n\t$scope.$emit(\"renderNavItem\");\r\n\r\n}])\r\n.directive('navItem', ['ribbon', \"$rootScope\", function(ribbon, $root) {\r\n\treturn {\r\n\t\trequire: ['^navigation'],\r\n\t\trestrict: 'AE',\r\n\t\tcontroller: 'NavItemController',\r\n\t\tscope: {\r\n\t\t\ttitle: '@navTitle',\r\n\t\t\tview: '@',\r\n\t\t\ticon: '@',\r\n\t\t\ticonCaption: '@',\r\n\t\t\thref: '@',\r\n\t\t\ttarget: '@'\r\n\t\t},\r\n\t\tlink: function(scope, element, attrs, parentCtrls) {\r\n\t\t\tvar navCtrl = parentCtrls[0],\r\n\t\t\t\tnavgroupCtrl = parentCtrls[1];\r\n\t\t\tif(attrs.view){\r\n\t\t\t\telement.find(\"ul\").remove();\r\n\t\t\t}\r\n\t\t\tscope.$watch('active', function(newVal, oldVal) {\r\n\t\t\t\tif (newVal) {\r\n\t\t\t\t\tnavgroupCtrl && navgroupCtrl.setActive(true);\r\n\t\t\t\t\t$root.$broadcast(\"updateDocumentTitle\", scope.title);\r\n\t\t\t\t\tscope.setBreadcrumb();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnavgroupCtrl && navgroupCtrl.setActive(false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tscope.openParents = scope.isActive(scope.view);\r\n\t\t\tscope.isChild = angular.isDefined(navgroupCtrl);\r\n\t\t\t\r\n\t\t\tscope.setBreadcrumb = function() {\r\n    \t\t\tvar crumbs = [];\r\n    \t\t\tcrumbs.push(scope.title);\r\n    \t\t\t// get parent menus\r\n\t\t\t\tvar test = element.parents('nav li').each(function() {\r\n\t\t\t\t\tvar el = angular.element(this);\r\n\t\t\t\t\tvar parent = el.find('.menu-item-parent:eq(0)');\r\n\t\t\t\t\tcrumbs.push(parent.data('localize').trim());\r\n\t\t\t\t\tif (scope.openParents) {\r\n\t\t\t\t\t\t// open menu on first load\r\n\t\t\t\t\t\tparent.trigger('click');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// this should be only fired upon first load so let's set this to false now\r\n\t\t\t\tscope.openParents = false;\r\n\t\t\t\tribbon.updateBreadcrumb(crumbs);\r\n    \t\t};\r\n\r\n    \t\telement.on('click', 'a[href!=\"#\"]', function() {\r\n    \t\t\tif ($.root_.hasClass('mobile-view-activated')) {\r\n    \t\t\t\t$.root_.removeClass('hidden-menu');\r\n    \t\t\t\t$('html').removeClass(\"hidden-menu-mobile-lock\");\r\n    \t\t\t}\r\n    \t\t});\r\n\t\t},\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\ttemplate: `\r\n\t\t\t<li data-ng-class=\"{active: isActive(view)}\">\r\n\t\t\t\t<a href=\"{{ getItemUrl(view) }}\" target=\"{{ getItemTarget() }}\">\r\n\t\t\t\t\t<i data-ng-if=\"hasIcon\" class=\"{{ icon }}\"><em data-ng-if=\"hasIconCaption\"> {{ iconCaption }} </em></i>\r\n\t\t\t\t\t<span ng-class=\"{'menu-item-parent': !isChild}\" data-localize=\"{{ title }}\"></span>\r\n\t\t\t\t</a>\r\n\t\t\t\t<ul data-ng-transclude=\"\"></ul>\r\n\t\t\t</li>`\r\n\t};\r\n}])\r\n;\r\n\r\n// directives for activity\r\nangular.module('app.activity', [])\r\n.controller('ActivityController', ['$scope', '$http' , function($scope, $http) {\r\n\tvar ctrl = this,\r\n\t\titems = ctrl.items = $scope.items = [];\r\n\r\n\tctrl.loadItem = function(loadedItem, callback) {\r\n\t\tangular.forEach(items, function(item) {\r\n\t      \tif (item.active && item !== loadedItem) {\r\n\t        \titem.active = false;\r\n\t        \t//item.onDeselect();\r\n\t      \t}\r\n\t    });\r\n\r\n\t\tloadedItem.active = true;\r\n\t\tif (angular.isDefined(loadedItem.onLoad)) {\r\n\t\t\tloadedItem.onLoad(loadedItem);\r\n\t\t}\r\n\r\n\t\t$http.get(loadedItem.src).then(function(result) {\r\n\t\t\tvar content = result.data;\r\n\t\t\tif (angular.isDefined(callback)) {\r\n\t\t\t\tcallback(content);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tctrl.addItem = function(item) {\r\n\t\titems.push(item);\r\n\t\tif (!angular.isDefined(item.active)) {\r\n\t\t\t// set the default\r\n\t\t\titem.active = false;\r\n\t\t} else if (item.active) {\r\n\t\t\tctrl.loadItem(item);\r\n\t\t}\r\n\t};\r\n\r\n\tctrl.refresh = function(e) {\r\n\t\tvar btn = angular.element(e.currentTarget);\r\n\t\tbtn.button('loading');\r\n\r\n\t\tif (angular.isDefined($scope.onRefresh)) {\r\n\t\t\t$scope.onRefresh($scope, function() {\r\n\t\t\t\tbtn.button('reset');\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tbtn.button('reset');\r\n\t\t}\r\n\t};\r\n}])\r\n\r\n.directive('activity', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\treplace: true,\r\n\t\ttransclude: true,\r\n\t\tcontroller: 'ActivityController',\r\n\t\tscope: {\r\n\t\t\tonRefresh: '=onrefresh',\r\n\t\t},\r\n\t\ttemplate: '<span data-ng-transclude=\"\"></span>'\r\n\t};\r\n})\r\n\r\n.directive('activityButton', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\trequire: '^activity',\r\n\t\treplace: true,\r\n\t\ttransclude: true,\r\n\t\tcontroller: function($scope) {\r\n\r\n\t\t},\r\n\t\tscope: {\r\n\t\t\ticon: '@',\r\n\t\t\ttotal: '='\r\n\t\t},\r\n\t\ttemplate: '\\\r\n\t\t\t\t<span id=\"activity\" class=\"activity-dropdown\">\\\r\n\t\t\t\t\t<i ng-class=\"icon\"></i>\\\r\n\t\t\t\t\t<b class=\"badge\"> {{ total }} </b>\\\r\n\t\t\t\t</span>',\r\n\t\tlink: function(scope, element, attrs, activityCtrl) {\r\n\r\n\t\t\tattrs.$observe('icon', function(value) {\r\n\t\t\t\tif (!angular.isDefined(value))\r\n\t\t\t\t\tscope.icon = 'fa fa-user';\r\n\t\t\t});\r\n\r\n\t\t\telement.on('click', function(e) {\r\n\t\t\t\tvar $this = $(this);\r\n\r\n\t\t\t\tif ($this.find('.badge').hasClass('bg-color-red')) {\r\n\t\t\t\t\t$this.find('.badge').removeClassPrefix('bg-color-');\r\n\t\t\t\t\t$this.find('.badge').text(\"0\");\r\n\t\t\t\t\t// console.log(\"Ajax call for activity\")\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!$this.next('.ajax-dropdown').is(':visible')) {\r\n\t\t\t\t\t$this.next('.ajax-dropdown').fadeIn(150);\r\n\t\t\t\t\t$this.addClass('active');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$this.next('.ajax-dropdown').fadeOut(150);\r\n\t\t\t\t\t$this.removeClass('active');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar mytest = $this.next('.ajax-dropdown').find('.btn-group > .active > input').attr('id');\r\n\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\r\n\t\t\tif (scope.total > 0) {\r\n\t\t\t\tvar $badge = element.find('.badge');\r\n\t\t\t\t$badge.addClass(\"bg-color-red bounceIn animated\");\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n})\r\n\r\n.controller('ActivityContentController', ['$scope' , function($scope) {\r\n\tvar ctrl = this;\r\n\t$scope.currentContent = '';\r\n\tctrl.loadContent = function(content) {\r\n\t\t$scope.currentContent = content;\r\n\t}\r\n}])\r\n\r\n.directive('activityContent', ['$compile', function($compile) {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\ttransclude: true,\r\n\t\trequire: '^activity',\r\n\t\treplace: true,\r\n\t\tscope: {\r\n\t\t\tfooter: '=?'\r\n\t\t},\r\n\t\tcontroller: 'ActivityContentController',\r\n\t\ttemplate: '\\\r\n\t\t\t<div class=\"ajax-dropdown\">\\\r\n\t\t\t\t<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\" data-ng-transclude=\"\"></div>\\\r\n\t\t\t\t<div class=\"ajax-notifications custom-scroll\">\\\r\n\t\t\t\t\t<div class=\"alert alert-transparent\">\\\r\n\t\t\t\t\t\t<h4>Click a button to show messages here</h4>\\\r\n\t\t\t\t\t\tThis blank page message helps protect your privacy, or you can show the first message here automatically.\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<i class=\"fa fa-lock fa-4x fa-border\"></i>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<span> {{ footer }}\\\r\n\t\t\t\t\t<button type=\"button\" data-loading-text=\"Loading...\" data-ng-click=\"refresh($event)\" class=\"btn btn-xs btn-default pull-right\" data-activty-refresh-button=\"\">\\\r\n\t\t\t\t\t<i class=\"fa fa-refresh\"></i>\\\r\n\t\t\t\t\t</button>\\\r\n\t\t\t\t</span>\\\r\n\t\t\t</div>',\r\n\t\tlink: function(scope, element, attrs, activityCtrl) {\r\n\t\t\tscope.refresh = function(e) {\r\n\t\t\t\tactivityCtrl.refresh(e);\r\n\t\t\t};\r\n\r\n\t\t\tscope.$watch('currentContent', function(newContent, oldContent) {\r\n\t\t\t\tif (newContent !== oldContent) {\r\n\t\t\t\t\tvar el = element.find('.ajax-notifications').html(newContent);\r\n\t\t\t\t\t$compile(el)(scope);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}])\r\n\r\n.directive('activityItem', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\trequire: ['^activity', '^activityContent'],\r\n\t\tscope: {\r\n\t\t\tsrc: '=',\r\n\t\t\tonLoad: '=onload',\r\n\t\t\tactive: '=?'\r\n\t\t},\r\n\t\tcontroller: function() {\r\n\r\n\t\t},\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\ttemplate: '\\\r\n\t\t\t<label class=\"btn btn-default\" data-ng-click=\"loadItem()\" ng-class=\"{active: active}\">\\\r\n\t\t\t\t<input type=\"radio\" name=\"activity\">\\\r\n\t\t\t\t<span data-ng-transclude=\"\"></span>\\\r\n\t\t\t</label>',\r\n\t\tlink: function(scope, element, attrs, parentCtrls) {\r\n\t\t\tvar activityCtrl = parentCtrls[0],\r\n\t\t\t\tcontentCtrl = parentCtrls[1];\r\n\r\n\t\t\tscope.$watch('active', function(active) {\r\n\t\t\t\tif (active) {\r\n\t\t\t\t\tactivityCtrl.loadItem(scope, function(content) {\r\n\t\t\t\t\t\tcontentCtrl.loadContent(content);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tactivityCtrl.addItem(scope);\r\n\r\n\t\t\tscope.loadItem = function() {\r\n\t\t\t\tscope.active = true;\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n})\r\n;\r\n\r\nangular.module('app.smartui', [])\r\n.directive('widgetGrid', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\tlink: function(scope, element, attrs) {\r\n\t\t\tscope.setup_widget_desktop = function() {\r\n\t\t\t\tif ($.fn.jarvisWidgets && $.enableJarvisWidgets) {\r\n\t\t\t\t\telement.jarvisWidgets({\r\n\t\t\t\t\t\tgrid : 'article',\r\n\t\t\t\t\t\twidgets : '.jarviswidget',\r\n\t\t\t\t\t\tlocalStorage : true,\r\n\t\t\t\t\t\tdeleteSettingsKey : '#deletesettingskey-options',\r\n\t\t\t\t\t\tsettingsKeyLabel : 'Reset settings?',\r\n\t\t\t\t\t\tdeletePositionKey : '#deletepositionkey-options',\r\n\t\t\t\t\t\tpositionKeyLabel : 'Reset position?',\r\n\t\t\t\t\t\tsortable : true,\r\n\t\t\t\t\t\tbuttonsHidden : false,\r\n\t\t\t\t\t\t// toggle button\r\n\t\t\t\t\t\ttoggleButton : true,\r\n\t\t\t\t\t\ttoggleClass : 'fa fa-minus | fa fa-plus',\r\n\t\t\t\t\t\ttoggleSpeed : 200,\r\n\t\t\t\t\t\tonToggle : function() {\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t// delete btn\r\n\t\t\t\t\t\tdeleteButton : true,\r\n\t\t\t\t\t\tdeleteClass : 'fa fa-times',\r\n\t\t\t\t\t\tdeleteSpeed : 200,\r\n\t\t\t\t\t\tonDelete : function() {\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t// edit btn\r\n\t\t\t\t\t\teditButton : true,\r\n\t\t\t\t\t\teditPlaceholder : '.jarviswidget-editbox',\r\n\t\t\t\t\t\teditClass : 'fa fa-cog | fa fa-save',\r\n\t\t\t\t\t\teditSpeed : 200,\r\n\t\t\t\t\t\tonEdit : function() {\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t// color button\r\n\t\t\t\t\t\tcolorButton : true,\r\n\t\t\t\t\t\t// full screen\r\n\t\t\t\t\t\tfullscreenButton : true,\r\n\t\t\t\t\t\tfullscreenClass : 'fa fa-expand | fa fa-compress',\r\n\t\t\t\t\t\tfullscreenDiff : 3,\r\n\t\t\t\t\t\tonFullscreen : function() {\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t// custom btn\r\n\t\t\t\t\t\tcustomButton : false,\r\n\t\t\t\t\t\tcustomClass : 'folder-10 | next-10',\r\n\t\t\t\t\t\tcustomStart : function() {\r\n\t\t\t\t\t\t\talert('Hello you, this is a custom button...');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcustomEnd : function() {\r\n\t\t\t\t\t\t\talert('bye, till next time...');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t// order\r\n\t\t\t\t\t\tbuttonOrder : '%refresh% %custom% %edit% %toggle% %fullscreen% %delete%',\r\n\t\t\t\t\t\topacity : 1.0,\r\n\t\t\t\t\t\tdragHandle : '> header',\r\n\t\t\t\t\t\tplaceholderClass : 'jarviswidget-placeholder',\r\n\t\t\t\t\t\tindicator : true,\r\n\t\t\t\t\t\tindicatorTime : 600,\r\n\t\t\t\t\t\tajax : true,\r\n\t\t\t\t\t\ttimestampPlaceholder : '.jarviswidget-timestamp',\r\n\t\t\t\t\t\ttimestampFormat : 'Last update: %m%/%d%/%y% %h%:%i%:%s%',\r\n\t\t\t\t\t\trefreshButton : true,\r\n\t\t\t\t\t\trefreshButtonClass : 'fa fa-refresh',\r\n\t\t\t\t\t\tlabelError : 'Sorry but there was a error:',\r\n\t\t\t\t\t\tlabelUpdated : 'Last Update:',\r\n\t\t\t\t\t\tlabelRefresh : 'Refresh',\r\n\t\t\t\t\t\tlabelDelete : 'Delete widget:',\r\n\t\t\t\t\t\tafterLoad : function() { },\r\n\t\t\t\t\t\trtl : false, // best not to toggle this!\r\n\t\t\t\t\t\tonChange : function() {\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonSave : function() {\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tajaxnav : $.navAsAjax // declears how the localstorage should be saved (HTML or AJAX page)\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tscope.setup_widget_mobile = function() {\r\n\t\t\t\tif ($.enableMobileWidgets && $.enableJarvisWidgets) {\r\n\t\t\t\t\tscope.setup_widgets_desktop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ($.device === \"desktop\") {\r\n\t\t\t\tscope.setup_widget_desktop();\r\n\t\t\t} else {\r\n\t\t\t\tscope.setup_widget_mobile();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n})\r\n\r\n.directive('widget', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\ttemplate: '<div class=\"jarviswidget\" data-ng-transclude=\"\"></div>'\r\n\t}\r\n})\r\n\r\n.directive('widgetHeader', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\tscope: {\r\n\t\t\ttitle: '@',\r\n\t\t\ticon: '@'\r\n\t\t},\r\n\t\ttemplate: '\\\r\n\t\t\t<header>\\\r\n\t\t\t\t<span class=\"widget-icon\"> <i data-ng-class=\"icon\"></i> </span>\\\r\n\t\t\t\t<h2>{{ title }}</h2>\\\r\n\t\t\t\t<span data-ng-transclude></span>\\\r\n\t\t\t</header>'\r\n\t}\r\n})\r\n\r\n.directive('widgetToolbar', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\ttemplate: '<div class=\"widget-toolbar\" data-ng-transclude=\"\"></div>'\r\n\t}\r\n})\r\n\r\n.directive('widgetEditbox', function() {\r\n\treturn {\r\n\t\trestrict: 'AE', \r\n\t\ttransclude: true, \r\n\t\treplace: true,\r\n\t\ttemplate: '<div class=\"jarviswidget-editbox\" data-ng-transclude=\"\"></div>'\r\n\t}\r\n})\r\n\r\n.directive('widgetBody', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\ttemplate: '<div data-ng-transclude=\"\"></div>'\r\n\t}\r\n})\r\n\r\n.directive('widgetBodyToolbar', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\tscope: {\r\n\t\t\tclass: '@'\r\n\t\t},\r\n\t\ttemplate: '<div class=\"widget-body-toolbar\" data-ng-transclude=\"\"></div>'\r\n\t}\r\n})\r\n\r\n.directive('widgetContent', function() {\r\n\treturn {\r\n\t\trestrict: 'AE',\r\n\t\ttransclude: true,\r\n\t\treplace: true,\r\n\t\ttemplate: '<div class=\"widget-body\" data-ng-transclude=\"\"></div>'\r\n\t}\r\n})\r\n\r\n.directive(\"base64\", [\"$$$IMAGES\", function($$$IMAGES){\r\n\treturn {\r\n\t\trestrict: \"AE\",\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\telement.attr(\"src\", $$$IMAGES.get(attrs.key));\r\n\t\t\tscope.$on(\"localizeLanguageChanged\", function(){\r\n\t\t\t\telement.attr(\"src\", $$$IMAGES.get(attrs.key));\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}])\r\n.directive('textareaEmail', [function(){\r\n\treturn {\r\n\t\trequire: 'ngModel',\r\n\t\trestrict: 'A',\r\n\t\tlink: function($scope, iElm, iAttrs, controller) {\r\n\t\t\tvar modelCtrl = controller;\r\n\t\t\tfunction validate(val){\r\n\t\t\t\tvar vals = Array.isArray(val) ? val : [val];\r\n\t\t\t\tvar reg = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\\.[a-zA-Z0-9_-]{2,3}){1,2})$/;\r\n\t\t\t\tvar isvalide = vals.every(function(v){ return reg.test(v)});\r\n\t\t\t\treturn isvalide;\r\n\t\t\t}\r\n\t\t\tfunction parser(value){\r\n\t\t\t\tif(value){\r\n\t\t\t\t\treturn value.split('\\n').reduce(function(arr,b){\r\n\t\t\t\t\t\tif(b.trim().length){\r\n\t\t\t\t\t\t\tarr.push(b);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn arr;\r\n\t\t\t\t\t},[]);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfunction formatter(value){\r\n\t\t\t\treturn validate(value) ? value.join(\"\\n\") : undefined;\r\n\t\t\t}\r\n\t\t\tfunction viewChangeListener(){\r\n\t\t\t\tmodelCtrl.$setValidity('email',validate(modelCtrl.$modelValue));\r\n\t\t\t}\r\n\t\t\tmodelCtrl.$isEmpty = function(val){\r\n\t\t\t\tif(Array.isArray(val) && val.length === 0){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tif(!val){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmodelCtrl.$parsers.push(parser);\r\n\t\t\tmodelCtrl.$formatters.push(formatter);\r\n\t\t\tmodelCtrl.$viewChangeListeners.push(viewChangeListener);\r\n\t\t}\r\n\t};\r\n}])\r\n.directive('schedulerInput',['$rootScope',function($rootScope){\r\n\treturn {\r\n\t    require: \"ngModel\",\r\n\t    link: function(scope,element,attrs,ngModel){\r\n\t    \t$rootScope.$broadcast('matchInput', true);\r\n\t        element.bind('keyup',function(value){\r\n\t            // var isValid = this.value.match(/^[0-9]{4}-(((0[13578]|(10|12))-(0[1-9]|[1-2][0-9]|3[0-1]))|(02-(0[1-9]|[1-2][0-9]))|((0[469]|11)-(0[1-9]|[1-2][0-9]|30)))$/);\r\n\t            var isValid = this.value.match(/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/);\r\n\t            $rootScope.$broadcast('matchInput', isValid);\r\n\t        });\r\n\t    }\r\n\t}\r\n}])\r\n.service(\"formDate\",[function(){\r\n\tthis.format = function(date, fmt){\r\n\t\tvar o = {\r\n\t\t  \"M+\" : date.getMonth()+1,                 //月份   \r\n\t\t  \"d+\" : date.getDate(),                    //日   \r\n\t\t  \"h+\" : date.getHours(),                   //小时   \r\n\t\t  \"m+\" : date.getMinutes(),                 //分   \r\n\t\t  \"s+\" : date.getSeconds(),                 //秒   \r\n\t\t  \"q+\" : Math.floor((date.getMonth()+3)/3), //季度   \r\n\t\t  \"S\"  : date.getMilliseconds()             //毫秒   \r\n\t\t};   \r\n\t\tif(/(y+)/.test(fmt))   \r\n\t\t  fmt=fmt.replace(RegExp.$1, (date.getFullYear()+\"\").substr(4 - RegExp.$1.length));   \r\n\t\tfor(var k in o)   \r\n\t\t  if(new RegExp(\"(\"+ k +\")\").test(fmt))   \r\n\t\tfmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : ((\"00\"+ o[k]).substr((\"\"+ o[k]).length)));   \r\n\t\treturn fmt;\r\n\t}\r\n}])\r\n.service(\"customModal\",[\"$modal\",\"$rootScope\",function($modal,$root){\r\n\tthis.openModal=function(obj){\r\n\t\t/**\r\n\t\t * [init 模态框配置]\r\n\t\t */\r\n\t\tvar init={\r\n\t\t\ttitle: obj.title, \t\t\t\t\t\t\t\t\t\t// 标题，必传\r\n\t\t\tdelTips: obj.delTips,\t\t\t\t\t\t\t\t\t// 删除提示，必传\r\n\t\t\tkey: obj.key?obj.key:'',\t\t\t\t\t\t\t\t// 删除标志，一个页面可能有多个删除，可不传\r\n\t\t\tdelete_rows: obj.delete_rows?obj.delete_rows:[],\t\t// 可删除的数据，可不传，如清空操作\r\n\t\t\tdelParm: obj.delParm?obj.delParm:'',\t\t\t\t\t// 删除数据的名字key，可不传\r\n\t\t\tnodelete_rows: obj.nodelete_rows?obj.nodelete_rows:[],   // 不可删除的数据，可不传\r\n\t\t\tnodelTips: obj.nodelTips?obj.nodelTips:\"\"\t\t\t\t// 不可删除提示，可不传\r\n\t\t}\r\n\r\n\t\t$modal.open({\r\n\t\t\ttemplate: [\r\n\t\t\t\t\t\t\"<section id='widget-grid' ><div class='modal-content'>\",\r\n\t\t\t\t\t\t\"<div class='modal-header'><a type='button' class='close' data-ng-click='close()'>\",\r\n\t\t\t\t\t\t\"<span aria-hidden='true'>×</span><span class='sr-only'>\",\r\n\t\t\t\t\t\t\"Close</span></a><h4 class='modal-title' id='mySmallModalLabel' data-localize=\"+init.title+\"></h4></div><div class='modal-body'>\",\r\n\t\t\t\t\t\t\"<form class='form-horizontal'>\",\r\n\t\t\t\t\t\t\"<p style='margin-bottom:20px;' data-localize='\"+init.delTips+\"' param1='{{deleteName}}'></p>\",\r\n\t\t\t\t\t\t\"<p style='margin-bottom:20px;' data-ng-if='\"+init.nodelete_rows.length+\"' data-localize='\"+init.nodelTips+\"' param1='{{nodeleteName}}'></p>\",\r\n\t\t\t\t\t\t\"<footer class='text-right'><a class='btn btn-primary' data-ng-click='ok()'  data-localize='确定'>确定\",\r\n\t\t\t\t\t\t\"</a><a class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'>取消\",\r\n\t\t\t\t\t\t\"</a></footer></form></div></div></section>\"].join(''),\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.deleteName = init.delete_rows.map(function(row){ return row[init.delParm] }).join(', ');\r\n\t\t\t\t$scope.nodeleteName = init.nodelete_rows.map(function(row){ return row[init.delParm] }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t$root.$broadcast(\"DELETE\", init.key===''?init.delete_rows:{key: init.key, data: init.delete_rows});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t}\r\n}])\r\n.directive(\"treeSelectNodeParent\", [\"$compile\", function($compile){\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {users: '=', selecteduser: '='},\r\n        template: `<dd class=\"group\" ng-repeat=\"item in users\">\r\n\t\t\t\t\t<dl class=\"group\">\r\n\t\t\t\t\t\t<dt class=\"group-title\">{{item.dept_name}}</dt>\r\n\t\t\t\t\t\t<tree-select-node ng-repeat=\"node in item.children\" data-selecteduser=\"selecteduser\" data-node=\"node\"></tree-select-node>\r\n\t\t\t\t\t</dl>\r\n\t\t\t\t  </dd>`,\r\n        controller: function($scope){\r\n\r\n        },\r\n        link: function(scope, element, attrs){\r\n        }\r\n    };\r\n}])\r\n.directive(\"treeSelectNode\", [\"$compile\", function($compile){\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {node: '=', selecteduser: '='},\r\n        template: '<dd></dd>',\r\n        controller: function($scope){\r\n        \t$scope.selectUser = function(user){\r\n        \t\t$scope.$emit('selectCommonUser', user);\r\n        \t}\r\n        },\r\n        link: function(scope, element, attrs){\r\n            if(scope.node.children) {\r\n            \telement.append('<dl class=\"group\">'+\r\n\t\t\t\t\t\t\t\t\t'<dt class=\"group-title\">{{node.dept_name}}</dt>'+\r\n\t\t\t\t\t\t\t\t\t'<tree-select-node ng-repeat=\"sub in node.children\" data-selecteduser=\"selecteduser\" data-nodes=\"node.children\" data-node=\"sub\"></tree-select-node>'+\r\n\t\t\t\t\t\t\t\t'</dl>')\r\n            }else{\r\n            \telement.append('<dd class=\"group-item\" titile=\"{{selecteduser}}\" url=\"{{ node }}\" ng-class=\"{active:selecteduser.user_id === node.user_id}\" ng-click=\"selectUser(node)\">{{node.name}}({{node.real_name}})</dd>')\r\n            }\r\n            $compile(element.contents())(scope)\r\n        }\r\n    };\r\n}])\n\n\n// WEBPACK FOOTER //\n// ./js/ng/ng.directives.js","angular.module(\"vdi\", [])\r\n\r\n.factory(\"Task\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n    return $resource($Domain + \"/thor/home/tasklog\", null, {\r\n        query: { method: \"GET\", isArray: false },\r\n        post: { method: \"POST\" },\r\n        put: { method: \"PUT\" }\r\n    });\r\n}])\r\n\r\n\r\n.factory(\"VNC\", [\"$resource\", \"$Domain\", function($resource, $Domain) {\r\n    return $resource($Domain + \"/thor/instance/vnc/:id\", { id: \"@id\" }, {\r\n        loadISO:\r\n            { method: \"POST\", url: $Domain + \"/thor/image/loadISO\" },\r\n        save:\r\n            { method: \"POST\", url: $Domain + \"/thor/image/update_template\" }\r\n    });\r\n}])\r\n\r\n.factory(\"loginResource\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n    return $resource($Domain + \"/thor/version\", null, {\r\n        query: { method: \"GET\"}\r\n    })\r\n}])\r\n\r\n\r\n.filter('lun_name', function () {\r\n    return function (lun) {\r\n        if (!angular.isUndefined(lun)) {\r\n            lun.map(function (item) {\r\n                item.value = item.vendor + \" lun-\" + item.lun + \" \" + item.size;\r\n            });\r\n        }\r\n        return lun;\r\n    };\r\n})\r\n.filter('storage_type', function () {\r\n    var type2str = {\r\n        local: \"本地磁盘\",\r\n        iscsi: 'iscsi 磁盘',\r\n        netfs: '网络文件系统',\r\n        fc: 'FC 光纤存储'\r\n    };\r\n    return function (type) {\r\n        return type2str[type]\r\n    }\r\n})\r\n.filter('storage_status', function () {\r\n    var stauts2str = {\r\n        running: \"正常\",\r\n        building:\"准备中\",\r\n        error:'异常'\r\n    };\r\n    return function (stauts) {\r\n        return stauts2str[stauts]\r\n    }\r\n})\r\n.filter('unsafe', function($sce) {\r\n    return function(val) {\r\n        return $sce.trustAsHtml(val+\"\");\r\n    };\r\n})\r\n.filter('join', function() {\r\n    return function(val,slash) {\r\n      return val.filter(function(d){\r\n        return d;\r\n      }).join(slash)\r\n    };\r\n})\r\n.filter('network_type', function () {\r\n    var type2str = {\r\n      nat:'NAT',\r\n      bridge:'桥接',\r\n      vlan:'VLAN'\r\n    };\r\n    return function (val) {\r\n      return type2str[val];\r\n    };\r\n})\r\n.filter('yesorno', function () {\r\n    return function (val) {\r\n      return val ? '是' : '否';\r\n    };\r\n})\r\n.filter('to_mb', function () {\r\n    return function (val) {\r\n      return (val/1024/1024).toFixed(2);\r\n    };\r\n})\r\n.filter('reverse', function() {\r\n  return function(input,searchText,searchName) {\r\n    if(input && searchText){\r\n        var outPut = [];\r\n        outPut = input.filter(function(item){\r\n            if(item[searchName].indexOf(searchText)>-1)\r\n                return item;\r\n        })\r\n        return outPut;\r\n    }\r\n    return input;\r\n  };\r\n})\r\n.config([\"$filterProvider\", function($filterProvider){\r\n\t$filterProvider.register(\"paging\", function(){\r\n\t\treturn function(items, index, pageSize){\r\n\t\t\tif(!angular.isArray(items)){\r\n                return items;\r\n            }\r\n            if(pageSize > 0 && index > 0){\r\n    \t\t\tvar total = items.length;\r\n    \t\t\tvar totalPage = Math.ceil(total / pageSize);\r\n    \t\t\tindex = Math.min(totalPage, Math.max(1, index));\r\n    \t\t\treturn items.slice((index - 1) * pageSize, index * pageSize);\r\n            }\r\n            return items;\r\n\t\t};\r\n\t});\r\n}])\r\n\r\n.directive(\"dialog\", [\"$modal\", \"$rootScope\", \"$$$I18N\", function ($modal, $rootScope, $$$I18N) {\r\n    return {\r\n        restrict: \"A\",\r\n        link: function ($scope, element, attrs) {\r\n            element.click(function () {\r\n                if(attrs.disabled){\r\n                    $.bigBox({\r\n                        title:$$$I18N.get(\"INFOR_TIP\"),\r\n                        content:attrs.error\r\n                    });\r\n                }else{\r\n                    var dialog = $modal.open({\r\n                        templateUrl: \"views/vdi/dialog/\" + attrs.dialogUrl,\r\n                        controller: attrs.dialog,\r\n                        scope: $scope,\r\n                        size: attrs.dialogSize\r\n                    });\r\n                    $scope.close = dialog.dismiss.bind(dialog);\r\n                    window.___dialog = dialog;\r\n                }\r\n                \r\n            });\r\n        }\r\n    };\r\n}])\r\n.directive(\"widgetGrid\", [\"$filter\", \"$modal\", function($filter, $modal){\r\n    function getPosition(e, ele) {\r\n        var st = Math.max(\r\n            document.documentElement.scrollTop,\r\n            document.body.scrollTop\r\n        );\r\n        var sl = Math.max(\r\n            document.documentElement.scrollLeft,\r\n            document.body.scrollLeft\r\n        );\r\n        var cw = document.documentElement.clientWidth;\r\n        var ch = document.documentElement.clientHeight;\r\n        var sw = Math.max(\r\n            document.documentElement.scrollWidth,\r\n            document.body.scrollWidth\r\n        );\r\n        var sh = Math.max(\r\n            document.documentElement.scrollHeight,\r\n            document.body.scrollHeight\r\n        );\r\n        var ow = ele.offsetWidth;\r\n        var oh = ele.offsetHeight;\r\n        return {\r\n            x: Math.max(0, e.pageX + ow > sl + cw ? sl + cw - ow : e.pageX),\r\n            y: Math.max(0, e.pageY + oh > st + ch ? st + ch - oh : e.pageY)\r\n        }\r\n    }\r\n    return {\r\n        restrict: \"A\",\r\n        controller: function($scope){\r\n            this.getCurrentPage = function(){\r\n                return Number($scope.currentPage) > 0 ? $scope.currentPage : 0;\r\n            };\r\n            this.getCurrentRows = function(){\r\n                return $scope.getCurrentRows();\r\n            }\r\n            this.getPageSize = function(){\r\n                return Number($scope.pagesize) > 0 ? Number($scope.pagesize) : 0;\r\n            };\r\n        },\r\n        link: function ($scope, element, attrs) {\r\n            var context_wrapper = element.find(\".context_wrapper\");\r\n            context_wrapper.on(\"mousedown\", function (e) {\r\n                if (e.target === this) {\r\n                    context_wrapper.hide();\r\n                    element.find(\".contextmenu_selected\").removeClass(\"contextmenu_selected\");\r\n                }\r\n            }).on(\"click\", function () {\r\n                context_wrapper.hide();\r\n                element.find(\".contextmenu_selected\").removeClass(\"contextmenu_selected\");\r\n            });\r\n            context_wrapper.hide();\r\n\r\n            // $scope.searchText = \"\";\r\n            //$scope.pagesize = 5;\r\n            $scope.currentPage = 1;\r\n\r\n            $scope.getCurrentRows = function(){\r\n                return $filter(\"paging\")(\r\n                    $scope.getFilterRows(),\r\n                    $scope.currentPage, $scope.pagesize\r\n                );\r\n            };\r\n            $scope.getFilterRows = function(){\r\n                return $filter(\"filter\")($scope.rows || [], $scope.searchText);\r\n            };\r\n\r\n            $scope.checkAll = function(){\r\n                var rows = $scope.getCurrentRows();\r\n                var _all = rows.length && rows\r\n                    .filter(item => !item._ignore ).length && rows\r\n                    .filter(item => !item._ignore )\r\n                    .every(row => row._selected );\r\n                $scope.checkedAll = _all;\r\n                return _all;\r\n            };\r\n            $scope.selectAllChange = function (checkAll) {\r\n                var rows = $scope.getCurrentRows();\r\n                rows.filter(item => !item._ignore ).forEach(function (row) {\r\n                    row._selected = checkAll;\r\n                });\r\n                $scope.checkedAll = checkAll;\r\n            };\r\n            $scope.checkOne = function () {\r\n                var rows = $scope.getCurrentRows();\r\n                return rows.filter(item => !item._ignore ).some(function (row) {\r\n                    return row._selected;\r\n                });\r\n            };\r\n            $scope.sort = function(name, asc){\r\n                $scope.rows.sort(function(a, b){\r\n                    return (a[name] > b[name] ? 1 : -1) * (asc ? 1 : -1);\r\n                });\r\n            };\r\n            $scope.pageSizeChange =\r\n            $scope.pageChange = function(){\r\n                $scope.rows.forEach(function(item, i){\r\n                    item._selected = false;\r\n                });\r\n            };\r\n            $scope.currentItem = null;\r\n            $scope.$on(\"contextmenu\", function (e, item, de, handler) {\r\n                $scope.currentItem = item;\r\n                handler.addClass(\"contextmenu_selected\");\r\n                $scope.rows.forEach(function (item) {\r\n                    item._selected = false;\r\n                });\r\n                item._selected = true;\r\n                $scope.$apply();\r\n                context_wrapper.fadeIn(200);\r\n                var menu = element.find(\".grid_context_menu\");\r\n                var offset = context_wrapper.offset();\r\n                var pos = getPosition(de, menu[0]);\r\n                menu.css({\r\n                    top: pos.y - offset.top + \"px\",\r\n                    left: pos.x - offset.left + \"px\"\r\n                });\r\n                $scope.rows.forEach(function (item) {\r\n                    item._selected = false;\r\n                });\r\n                item._selected = true;\r\n                $scope.$apply();\r\n                e.stopPropagation();\r\n                de.preventDefault();\r\n            });\r\n        }\r\n    };\r\n}])\r\n.directive(\"gridPagination\", [function(){\r\n    return {\r\n        restrict: \"A\",\r\n        require: [\"^widgetGrid\"],\r\n        conroller: function($scope){\r\n\r\n        },\r\n        link: function($scope, element, attrs, ctrls){\r\n            var grid = ctrls[0];\r\n            $scope.getStart = function(){\r\n                var current = grid.getCurrentPage();\r\n                var pagesize = grid.getPageSize();\r\n                return pagesize > 0 ? (current - 1) * pagesize + 1 : 0;\r\n            };\r\n            $scope.getEnd = function(){\r\n                var current = $scope.currentPage;\r\n                var pagesize = grid.getPageSize();\r\n                var end = current * pagesize;\r\n                var currentCount = $scope.getFilterRows().length;\r\n                return end < currentCount ? end : currentCount;\r\n            };\r\n            $scope.getCurrentCount = function(){\r\n                return $scope.getCurrentRows().length;\r\n            };\r\n        }\r\n    }\r\n}])\r\n.directive(\"ribbonTips\", [\"localize\", \"$route\", \"$location\", \"$interval\", function(localize, $route, $location, $interval){\r\n    return {\r\n        restrict: \"A\",\r\n        link: function($scope, element, attrs){\r\n            var timer, dereg;\r\n            var fn_update_help_info = function(){\r\n                var path = $location.$$path;\r\n                if(/^\\/resource\\/network\\/\\d+\\/?$/.test(path)){\r\n                    path = \"/resource/network/:id\";\r\n                }\r\n                if(/^\\/desktop\\/teach\\/\\d+\\/?$/.test(path)){\r\n                    path = \"/desktop/teach/:id\";\r\n                }\r\n                var help_text = attrs.myTips?localize.localizeText(attrs.myTips):localize.localizeText(path);\r\n                element.attr(\"data-content\", help_text);\r\n                if(help_text) {\r\n                    element.parent().show();\r\n                } else {\r\n                    element.parent().hide();\r\n                }\r\n            };\r\n            $scope.$on(\"$routeChangeSuccess\", function(){\r\n                fn_update_help_info();\r\n            });\r\n            if(localize.isReady()) {\r\n                fn_update_help_info();\r\n            }\r\n            $scope.$on(\"localizeLanguageChanged\", fn_update_help_info);\r\n        }\r\n    };\r\n}])\r\n.directive(\"contextmenu\", [function(){\r\n    return {\r\n        restrict: \"A\",\r\n        link: function ($scope, element, attrs) {\r\n            if (attrs.contextmenuDisabled !== \"true\") {\r\n                element.bind(\"contextmenu\", function (e) {\r\n                    $scope.$emit(attrs.contextmenuEventName || \"contextmenu\", $scope.item, e, element);\r\n                });\r\n            }\r\n        }\r\n    };\r\n}])\r\n\r\n.directive(\"wizard\", [function () {\r\n    return {\r\n        restrict: \"A\",\r\n        transclude: true,\r\n        scope: {\r\n            lastText: \"@\",\r\n            btnUnable:\"=\"\r\n        },\r\n        controller: function ($scope, localize, $$$I18N) {\r\n            var steps = $scope.steps = [];\r\n            $scope.currentStep = null;\r\n            $scope.moveWth = 0;\r\n            var defaults = {\r\n                prevBtnText: \"上一步\",\r\n                nextBtnText: \"下一步\",\r\n                doneBtnText: \"完成\",\r\n            };\r\n            $scope.$on(\"currentStepChange\", function(e, stepIndex){\r\n                $scope.go(stepIndex);\r\n            });\r\n            $scope.select = function (step) {\r\n                var index;\r\n                steps.forEach(function (s, i) {\r\n                    s.selected = s === step;\r\n                    if(s.selected) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                $scope.currentStep = step;\r\n                [\"prev\", \"next\", \"done\"].forEach(function(s){\r\n                    var key = s + \"BtnText\";\r\n                    $scope[key] = $$$I18N.get(step[key] || defaults[key]);\r\n                });\r\n                $scope.$emit(\"selectStepChange\", {index: index, stepScope: step});\r\n            };\r\n            $scope.getCurrentIndex = function () {\r\n                return steps.indexOf($scope.currentStep);\r\n            };\r\n\r\n            $scope.prev = function () {\r\n                var index = $scope.getCurrentIndex();\r\n                //var e = $scope.$emit(($scope.stepEventName || \"WizardStep\"), $scope.currentStep);\r\n                var prev = steps[index - 1];\r\n                prev && $scope.select(prev);\r\n                $scope.moveWth = $scope.getMarginValue();\r\n\r\n            };\r\n            $scope.next = function () {\r\n                var index = $scope.getCurrentIndex();\r\n                $scope.currentStep.is_dirty = true;\r\n                var e = $scope.$emit(($scope.stepEventName || \"WizardStep\") + \"_\" + index, $scope.currentStep, $scope.currentStep.$$nextSibling);\r\n                if ($scope.currentStep.done !== false) {\r\n                    var next = steps[index + 1];\r\n                    next && $scope.select(next);\r\n                    $scope.moveWth = $scope.getMarginValue();\r\n                };\r\n\r\n            };\r\n            $scope.go = function(index){\r\n                $scope.select(steps[index]);\r\n                $scope.moveWth = $scope.getMarginValue();\r\n            }\r\n            $scope.showPrev = function () {\r\n                return steps.indexOf($scope.currentStep) > 0 && $scope.currentStep.prevBtnText !== \"\";\r\n            };\r\n            $scope.isLast = function () {\r\n                return steps.indexOf($scope.currentStep) >= steps.length - 1;\r\n            };\r\n            $scope.done = function () {\r\n                var index = $scope.getCurrentIndex();\r\n                $scope.currentStep.is_dirty = true;\r\n                var e = $scope.$emit(($scope.stepEventName || \"WizardStep\") + \"_\" + index, $scope.currentStep, $scope.currentStep.$$nextSibling); \r\n                if ($scope.currentStep.done !== false) {\r\n                    var next = steps[index + 1];\r\n                    next && $scope.select(next);\r\n                    $scope.$emit($scope.doneEventName || \"WizardDone\", steps, steps.map(function (step) {\r\n                        return step.$$nextSibling\r\n                    }));\r\n                }\r\n            };\r\n            this.addStep = function (step) {\r\n                steps.push(step);\r\n                if (steps.length === 1) {\r\n                    $scope.select(step);\r\n                }\r\n            };\r\n            this.jumpStep = function (index) {\r\n\r\n            };\r\n            this.removeStep = function (index) {\r\n\r\n            };\r\n            this.insertStep = function (step) {\r\n\r\n            };\r\n        },\r\n        link : function($scope, element, attrs){\r\n            $scope.getMarginValue = function(){\r\n                var _idx = $scope.getCurrentIndex();\r\n                var wizardWth = element.find('.wizard').outerWidth();\r\n                var _wth = 60;\r\n                for(var i = 0; i<=_idx+1 ; i++){\r\n                    _wth+=element.find(\".steps>li\").eq(i).outerWidth();\r\n                }\r\n                if(wizardWth - _wth < 0){\r\n                    return (wizardWth - _wth) ;\r\n                }else{\r\n                    return 0;\r\n                }\r\n            };\r\n            // if(attrs.disableNav !== \"true\") {\r\n            //     element.find(\".steps\").delegate(\"li.complete\",\"click\",function(e){\r\n            //         var _idx = $(this).index();\r\n            //         $scope.go(_idx);\r\n            //     });\r\n            // }\r\n        },\r\n        template: `<div class=\"wizard\" style=\"margin-bottom:20px;\">\r\n            <ul class=\"steps\" style=\"margin-left:{{moveWth}}px\">\r\n                <li data-ng-repeat=\"step in steps\" data-target=\"#step{{ $index }}\" data-ng-class=\"{ active: getCurrentIndex() >= $index ,complete:getCurrentIndex() > $index }\">\r\n                    <span class=\"badge badge-info\">{{ $index + 1 }}</span><span localize=\"{{step.name}}\"></span><span class=\"chevron\"></span>\r\n                </li>\r\n            </ul>\r\n            <div class=\"actions\">\r\n                <button ng-show=\"!btnUnable\" type=\"button\" data-ng-if=\"showPrev()\" data-ng-click=\"prev()\" ng-disabled=\"currentStep.showLoading === true\" class=\"btn btn-sm btn-primary btn-prev\">\r\n                    <i class=\"fa fa-arrow-left\"></i><span ng-bind=\"prevBtnText\"></span>\r\n                </button>\r\n                <button ng-show=\"!btnUnable\" type=\"button\" data-ng-if=\"!isLast()\" data-ng-click=\"next()\" ng-disabled=\"currentStep.showLoading === true\" class=\"btn btn-sm btn-success btn-next\">\r\n                    <span ng-bind=\"nextBtnText\"></span> <i class=\"fa fa-arrow-right\"></i>\r\n                </button>\r\n                <button id='finish' ng-show=\"!btnUnable && isLast()\" type=\"button\" data-ng-click=\"done()\" ng-disabled=\"currentStep.showLoading === true\" class=\"btn btn-sm btn-success btn-next\">\r\n                    <span ng-bind=\"doneBtnText\"></span><i class=\"fa fa-check\" ></i>\r\n                </button>\r\n                <img ng-show=\"btnUnable\" src=\"img/loadingtext.gif\" width=\"24px\" height=\"24px\"/>\r\n                <img ng-show=\"currentStep.showLoading === true\" src=\"img/loadingtext.gif\" width=\"24px\" height=\"24px\"/>\r\n            </div>\r\n        </div>\r\n        <div class=\"step-content\">\r\n            <form data-ng-transclude class=\"form-horizontal\" id=\"fuelux-wizard\" method=\"post\" novalidate>\r\n            </form>\r\n        </div>\r\n        <div ng-show=\"currentStep.showLoading === true\" style=\"position: absolute;top:0;right:0;bottom:0;left:0;z-index:999;\"></div>`\r\n    };\r\n}])\r\n.directive(\"wizardStep\", [function () {\r\n    return {\r\n        restrict: \"A\",\r\n        require: \"^wizard\",\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            name: \"@\",\r\n            prevBtnText: \"@\",\r\n            nextBtnText: \"@\",\r\n            doneBtnText: \"@\",\r\n            testValid: \"=\"\r\n        },\r\n        controller: function ($scope) {},\r\n        link: function (scope, element, attrs, wizard) {\r\n            wizard.addStep(scope);\r\n        },\r\n        template: `<div class=\"step-pane\" data-ng-class=\"{ active: selected }\" data-ng-show=\"selected\" data-ng-transclude></div>`\r\n    };\r\n}])\r\n\r\n.directive('areaTraffic', function ($interval,$http) {\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope:{\r\n            options : \"=\"\r\n        },\r\n        link: function (scope, e, attrs) {\r\n            Highcharts.setOptions({    //disable utc time\r\n                global: {    \r\n                    useUTC: false    \r\n                }    \r\n            }); \r\n            function init_data(){\r\n                // generate init data\r\n                var data = [],\r\n                    time = (new Date()).getTime(),\r\n                    i;\r\n\r\n                for (i = -40; i <= 0; i += 1) {\r\n                    data.push({\r\n                        x: time + i * scope.$parent.refresh_time,\r\n                        y: 0\r\n                    });\r\n                }\r\n                return data;\r\n            }\r\n            var hc_options = scope.options.options;\r\n            hc_options.chart.renderTo = e[0];\r\n            hc_options.yAxis.min = 0;\r\n            angular.forEach(hc_options.series,function(s){\r\n                s.data = init_data();\r\n            });\r\n\r\n            var highcharts = new Highcharts.Chart(hc_options);\r\n\r\n            function drawPoint(data) {\r\n                var datetime = (new Date()).getTime();\r\n                var hc_series = highcharts.series;\r\n\r\n                scope.options.drawpoint(hc_series,data,datetime);\r\n\r\n            }\r\n\r\n            function reset_highcharts(){\r\n                //reset highcharts\r\n                highcharts.destroy();\r\n                angular.forEach(hc_options.series,function(s){\r\n                    s.data = init_data();\r\n                });\r\n                highcharts = new Highcharts.Chart(hc_options);\r\n            }\r\n\r\n            scope.$watch('$parent.metric_data',function(newvalue){\r\n                if(newvalue){\r\n                    drawPoint(newvalue);\r\n                }\r\n            });\r\n\r\n            scope.$watch('$parent.refresh_time',function(newvalue){\r\n                reset_highcharts();\r\n            });\r\n\r\n            scope.$watch('$parent.item',function(newvalue){\r\n                reset_highcharts();\r\n            });\r\n\r\n        }\r\n    }\r\n})\r\n.directive(\"monitorTree\", [function(){\r\n    return {\r\n        restrict: \"A\",\r\n        transclude: true,\r\n        template: `<div class=\"portlet-title clearfix padding-5\">\r\n                <div class=\"pull-left\">\r\n                    <a href=\"javascript:\" id=\"collape\" class=\"btn btn-default btn-xs\"><i class=\"fa  icon-jj-Shrinkfrom\"></i> </a>\r\n                    <a href=\"javascript:\" id=\"open\" class=\"btn btn-default  btn-xs\"><i class=\"fa icon-jj-Open\"></i></a>\r\n                </div>\r\n                <div class=\"pull-right\"><a href=\"javascript:\"class=\"btn btn-default  btn-xs\" ng-init=\"ishow=false\" ng-click=\"ishow==true?ishow=false:ishow=true;open()\"><i class=\"fa fa-search\"></i></a></div> \r\n            </div>\r\n            <div class=\"search\" ng-show=\"ishow\"><input type=\"search\" localize=\"桌面名\" ng-model=\"searchText\"></div>\r\n            <div class=\"portlet-body fuelux monitor-tree\" data-ng-transclude></div>\r\n        `,\r\n        link: function(scope, element, attrs){\r\n            element.delegate('#open', 'click', function(event) {\r\n                element.find(\".parent\").addClass('in');\r\n            });\r\n            element.delegate('#collape', 'click', function(event) {\r\n                element.find(\".parent\").removeClass('in');\r\n            });\r\n            element.delegate (\".tree-toggle\",\"click\",function(event){\r\n                var parent =$(this).parent().parent(\".parent\");\r\n                if(parent.hasClass('in')){\r\n                    parent.removeClass('in');\r\n                }else{\r\n                    parent.addClass(\"in\");\r\n                }\r\n            });\r\n            element.delegate(\".tree-it\",\"click\",function(event){\r\n                element.find(\"li\").removeClass('active');\r\n                $(this).parent(\"li\").addClass('active');\r\n            });\r\n            scope.open = function(){\r\n                element.find(\".parent\").addClass('in');\r\n            };\r\n        }\r\n    };\r\n}])\r\n.directive('ipPattern',function (ip_pattern) {\r\n\r\n    return {\r\n      require: ['ngModel','?ngRequired'],\r\n      link: function (scope, elm, attrs, ctrls) {\r\n        var ngmodelctl = ctrls[0];\r\n        var ngrequiredctl = ctrls[1];\r\n\r\n        ngmodelctl.$parsers.push(function (viewValue) {\r\n\r\n          if (ip_pattern.test(viewValue)||(!ngrequiredctl&&!viewValue)) {\r\n\r\n            ngmodelctl.$setValidity('ipcheck', true);\r\n            return viewValue;\r\n          } else {\r\n\r\n            ngmodelctl.$setValidity('ipcheck', false);\r\n            return undefined;\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n})\r\n.directive(\"preventSpace\", [function(){\r\n    return {\r\n      restrict: \"A\",\r\n      link: function(scope, element, attrs){\r\n        element.on(\"keypress\",function(e){\r\n          if(e.keyCode === 32){\r\n            e.preventDefault();\r\n          }\r\n        })\r\n      }\r\n    };\r\n  }])\r\n.directive(\"inputNumber\", [function(){\r\n    return {\r\n        restrict: \"AE\",\r\n        link: function(scope, element, attrs){\r\n            var numKey = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105];\r\n            var ctrlKey = [\r\n                8, // backspace\r\n                46,// delete\r\n                37,// left arrow\r\n                39 // right arrow\r\n            ];\r\n            element.on(\"keydown\", function(e){\r\n                var code = e.which || e.keyCode;\r\n                if(numKey.indexOf(code) > -1) {\r\n                    var num = code < 60 ? code - 48 : code - 96;\r\n                    var nextValue = this.value + num;\r\n                    if(!attrs.max) { return; }\r\n                    var max = attrs.max * 1;\r\n                    if(!isNaN(max) && nextValue <= max) {\r\n                        return;\r\n                    }\r\n                } else if(ctrlKey.indexOf(code) > -1) {\r\n                    return;\r\n                }\r\n                e.preventDefault();\r\n                return false;\r\n            });\r\n        }\r\n    };\r\n}])\r\n// .directive(\"inputDot\", [function(){\r\n//     return {\r\n//         restrict: \"AE\",\r\n//         link: function(scope, element, attrs){\r\n//             element.on(\"keydown\",function(e){\r\n//                 if(attrs.inputDot == 'true'){\r\n//                    if(e.keyCode === 190 || e.keyCode === 110 || e.keyCode === 69){\r\n//                         e.preventDefault();\r\n//                    }\r\n//                 }\r\n//                 else{\r\n//                     if(e.keyCode === 69){\r\n//                         e.preventDefault();\r\n//                     }\r\n//                 }\r\n\r\n//             });\r\n//         }\r\n//     };\r\n// }])\r\n.directive(\"formatIp\", [\"$compile\",function($compile){\r\n    return {\r\n        restrict:\"EA\",\r\n        require:\"ngModel\",\r\n        scope:{\r\n            start:\"=\",\r\n            end:\"=\"\r\n        },\r\n        link:function(scope,element,attrs,ctrl){\r\n            var ngModelCtrl = ctrl;\r\n            var required = attrs.ipRequired ? scope.$eval(attrs.ipRequired) : true;\r\n\r\n            if(!ngModelCtrl){\r\n                return;\r\n            };\r\n            var CHECKTOOLS = {};\r\n\r\n            CHECKTOOLS.checkIP = function(ip){\r\n                if(!ip) { return false; }\r\n                var parts = ip.split(\".\");\r\n                //9029bug 0.0.0.0不合法IP\r\n                var numre = /^(0|[1-9][0-9]*)$/;\r\n                var i, valid = true;\r\n                if(parts.length !== 4) { return false; }\r\n                for(i = 0; i < 4; i++) {\r\n                    if(numre.test(parts[i]) && parseInt(parts[i]) <= 255) {\r\n                        continue;\r\n                    } else {\r\n                        valid = false;\r\n                    }\r\n                }\r\n                valid = valid && (ipformatNum(ip) > ipformatNum('1.0.0.0'));\r\n                return valid;\r\n            };\r\n\r\n            function ipformatNum(ip){\r\n                var arr = ip.split('.').map(function(item){ return Number(item)});\r\n                return arr[0]*Math.pow(256,3) + arr[1]*Math.pow(256,2) + arr[2]*Math.pow(256,1) + arr[3];   \r\n            }\r\n\r\n            CHECKTOOLS.ip2long = function(ip){\r\n                if(CHECKTOOLS.checkIP(ip)){\r\n                    var arr = ip.split('.').map(function(item){ return Number(item)});\r\n                    return arr[0]*Math.pow(256,3) + arr[1]*Math.pow(256,2) + arr[2]*Math.pow(256,1) + arr[3];\r\n                }\r\n            };\r\n            CHECKTOOLS.checkRange = function(ip,s_ip,e_ip){\r\n                if(CHECKTOOLS.checkIP(ip),CHECKTOOLS.checkIP(s_ip) && CHECKTOOLS.checkIP(e_ip)){\r\n                     var s = CHECKTOOLS.ip2long(s_ip);\r\n                     var e = CHECKTOOLS.ip2long(e_ip);\r\n                     var c = CHECKTOOLS.ip2long(ip);\r\n                     return c >= s && c <= e;\r\n                 }else{\r\n                    return false;\r\n                 }\r\n            };\r\n            var popEl = angular.element(\"<div format-ip-wrap></div>\");\r\n            var $input = $compile(popEl)(scope);\r\n            element.addClass(\"ng-hide\");\r\n            element.after($input);\r\n\r\n            // model -- ui\r\n            \r\n            ngModelCtrl.$render = function(){\r\n                var modelVal = ngModelCtrl.$modelValue;\r\n                var modelValArr;\r\n                try{\r\n                    if(modelVal === null) {\r\n                        modelValArr = [];\r\n                        ngModelCtrl.$setPristine();\r\n                    } else {\r\n                        modelValArr = modelVal.split(\".\");\r\n                    }\r\n                    [1,2,3,4].forEach(function(i,idx){\r\n                        scope[\"seg\" + i] = modelValArr[idx] || \"\";\r\n                    });\r\n                }catch(err){\r\n                }\r\n                // setValidate();\r\n            };\r\n            /*\r\n            function setValidate(){\r\n                var isValid;\r\n                if(ngModelCtrl.$modelValue){\r\n                    if(scope.start && scope.end){\r\n                        isValid = CHECKTOOLS.checkRange(ngModelCtrl.$modelValue,scope.start,scope.end)\r\n                    }else{\r\n                        isValid = CHECKTOOLS.checkIP(ngModelCtrl.$modelValue);\r\n                    }\r\n                    ngModelCtrl.$setValidity(\"ip\",isValid);\r\n                }else{\r\n                    ngModelCtrl.$setValidity(\"ip\",true);\r\n                }\r\n            };\r\n\r\n            // ui -- model\r\n            $input.on(\"input\",function(e){\r\n                scope.$apply(function(){\r\n                    var val = [1,2,3,4].map(function(i){ return scope[\"seg\" + i] || \"\"; }).join(\".\");\r\n                    var isNull = val.split(\".\").every(function(item){ return item.length===0 });\r\n                    if(isNull){\r\n                        ngModelCtrl.$setViewValue(\"\");\r\n                    }else{\r\n                        ngModelCtrl.$setViewValue(val);\r\n                    }\r\n                    ngModelCtrl.$render();\r\n                })\r\n            });\r\n\r\n            */\r\n\r\n            scope.$watch(\"seg1 + '.' + seg2 + '.' + seg3 + '.' + seg4\", function(ip){\r\n                var value = ngModelCtrl.$modelValue;\r\n                if(ip === \"...\") {\r\n                    if(value) {\r\n                        ngModelCtrl.$setViewValue(\"\");\r\n                    }\r\n                    if(!value || !required) {\r\n                        return ngModelCtrl.$setValidity(\"ip\", true);\r\n                    }\r\n                    ngModelCtrl.$setValidity(\"ip\", false);\r\n                } else {\r\n                    var isValid = false;\r\n                    if(scope.start && scope.end){\r\n                        isValid = CHECKTOOLS.checkRange(ip, scope.start, scope.end);\r\n                    }else{\r\n                        isValid = CHECKTOOLS.checkIP(ip);\r\n                    }\r\n                    ngModelCtrl.$setValidity(\"ip\", isValid);\r\n                    ngModelCtrl.$setViewValue(ip);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}])\r\n.directive(\"formatIpWrap\",function(){\r\n    return {\r\n        restrict: \"AE\",\r\n        replace: true,\r\n        template: `<span role=\"ipgroup\"><input type=\"text\" ng-model=\"seg1\"><span class=\"dot\">.</span><input type=\"text\" ng-model=\"seg2\"><span class=\"dot\">.</span><input type=\"text\" ng-model=\"seg3\"><span class=\"dot\">.</span><input type=\"text\" ng-model=\"seg4\"></span>`,\r\n        link: function(scope,element,attrs){\r\n            element.on(\"keydown\", \"input\", function(event){\r\n                switch(event.keyCode){\r\n                    case 110:\r\n                    case 190:\r\n                        var nextEles = $(this).nextAll(\"input\");\r\n                        nextEles.length && nextEles.eq(0).focus();\r\n                        event.preventDefault();\r\n                        break;\r\n                    case 8:\r\n                        if(!$(this).val()){\r\n                            $(this).prevAll(\"input\").length && $(this).prevAll(\"input\").eq(0).focus();\r\n                        }\r\n                        break;\r\n                    case 37:\r\n                        if(this.selectionStart === 0){\r\n                            $(this).prevAll(\"input\").length && $(this).prevAll(\"input\").eq(0).focus();\r\n                        };\r\n                        break;\r\n                    case 39:\r\n                        if(this.selectionStart === $(this).val().length){\r\n                            $(this).nextAll(\"input\").length && $(this).nextAll(\"input\").eq(0).focus();\r\n                        }\r\n                        break;\r\n                    case 32:\r\n                    case 229:\r\n                        event.preventDefault();\r\n                        event.stopPropagation();\r\n                        break;\r\n                }\r\n            });\r\n            element.on(\"keypress\", \"input\",function(e){\r\n                if(e.keyCode < 48 || e.keyCode > 57){\r\n                    e.preventDefault();\r\n                }\r\n                if($(this).val().length > 2 && this.selectionStart === this.selectionEnd){\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            element.on(\"paste\",function(e){\r\n                e.preventDefault();\r\n            });\r\n            element.on(\"focus\", \"input\", function(e){\r\n                element.addClass(\"focus\");\r\n            });\r\n            element.on(\"blur\", \"input\", function(e){\r\n                element.removeClass(\"focus\");\r\n            });\r\n        }\r\n    }\r\n})\r\n.directive(\"treeNodeParent\", [\"$compile\", function($compile){\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {users: '=', filtertext: '='},\r\n        template: '<ul role=\"tree\" class=\"menu menu-tree\" ng-repeat=\"item in getUsers()\">'+\r\n                    '<div class=\"menu_header\">'+\r\n                        '<span class=\"fa icon-jj\"></span>'+\r\n                        '<span class=\"menu-name\">{{item.dept_name}}</span>'+\r\n                        '<span class=\"pull-right fa icon-jj-add\" data-ng-click=\"add_selected(item);$event.stopPropagation()\"></span>'+\r\n                    '</div>'+\r\n                    '<div class=\"menu_body\">'+\r\n                        '<tree-node ng-repeat=\"node in item.children\" data-nodes=\"item.children\" data-node=\"node\"></tree-node>'+\r\n                    '</div>'+\r\n                '</ul>',\r\n        controller: function($scope){\r\n            var lastFilter;\r\n            var lastFiltedResult;\r\n            $scope.add_selected = function(children){\r\n                $scope.$emit('add_selected', children);\r\n            }\r\n\r\n            $scope.getUsers = function(){\r\n                var text = $scope.filtertext || \"\";\r\n                var users = $scope.users;\r\n                text = text.trim();\r\n                if(!text) { return users; }\r\n                if(text !== lastFilter) {\r\n                    lastFilter = text;\r\n                    lastFiltedResult = filterUser(angular.copy(users), text);\r\n                }\r\n                return lastFiltedResult;\r\n            };\r\n\r\n            function filterUser(users, text) {\r\n                return users.filter(function(user){\r\n                    if(user.children) {\r\n                        user.children = filterUser(user.children, text);\r\n                        return user.children.length > 0;\r\n                    } else {\r\n                        return user.user_name.indexOf(text) > -1 || user.real_name.indexOf(text) > -1;\r\n                    }\r\n                });\r\n            }\r\n        },\r\n        link: function(scope, element, attrs){\r\n        }\r\n    };\r\n}])\r\n.directive(\"treeNode\", [\"$compile\", function($compile){\r\n    return {\r\n        restrict: 'EA',\r\n        replace: true,\r\n        scope: {node: '=', nodes: '='},\r\n        template: '<div></div>',\r\n        controller: function($scope){\r\n            $scope.add_selected = function(children){\r\n                $scope.$emit('add_selected', children);\r\n            }\r\n            $scope.add_select_rows = function($event,node,nodes){\r\n                $scope.$emit('add_select_rows', $event,node,nodes);\r\n            }\r\n        },\r\n        link: function(scope, element, attrs){\r\n            if(scope.node.children) {\r\n                element.append('<ul role=\"group\" class=\"menu menu-tree\">'+\r\n                    '<div class=\"menu_header\">'+\r\n                        '<span class=\"fa icon-jj\"></span>'+\r\n                        '<span class=\"menu-name\">{{node.dept_name}}</span>'+\r\n                        '<span class=\"pull-right fa icon-jj-add\" data-ng-click=\"add_selected(node);$event.stopPropagation()\"></span>'+\r\n                    '</div>'+\r\n                    '<div class=\"menu_body\">'+\r\n                        '<tree-node ng-repeat=\"sub in node.children\" data-nodes=\"node.children\" data-node=\"sub\"></tree-node>'+\r\n                    '</div>'+\r\n                '</ul>')\r\n            }else{\r\n                element.append('<li class=\"menuitem\" ng-click=\"add_select_rows($event,node,nodes)\" ng-dblclick=\"add_selected(node)\">'+\r\n                    '<span class=\"text-overflow text-overflow-half\">{{node.name}}</span>'+\r\n                    '<span class=\"text-overflow text-overflow-half\">{{node.real_name}}</span>'+\r\n                  '</li>')\r\n            }\r\n            $compile(element.contents())(scope)\r\n        }\r\n    };\r\n}])\r\n.directive(\"uiMenuList\", [\"Admin\",\"User\",\"Domain\",\"$q\",\"$$$I18N\",function(APIadmin,APIuser,APIdomain,$q,$$$I18N){\r\n    return {\r\n        restrict: \"AE\",\r\n        scope:{\r\n            selected: \"=menuListData\",\r\n            // domain:\"=menuListDomain\"\r\n        },\r\n        templateUrl: \"includes/userMenu.html\",\r\n        controller: function($scope){\r\n            $scope.expandedNodes = [];\r\n            $scope._users = [];\r\n            $scope.selected = $scope.selected || [];\r\n            $scope.seRows = [];\r\n            $scope.rmRows = [];\r\n            $scope.common_users = [];\r\n            function formatData(d,name){\r\n                iteration(d,name);\r\n                return d;\r\n            }\r\n            function iteration(data,childName,list){\r\n                for(var i = 0 ; i < data.length ; i++){\r\n                    $scope.expandedNodes.push(data[i]);\r\n                    if(data[i][childName] && data[i][childName].length){\r\n                        var len = iteration(data[i][childName],childName);\r\n                        if(len === 0){\r\n                            data[i] = undefined;\r\n                        }\r\n                    }\r\n                    if(!data[i]) { continue; }\r\n                    if(data[i].users && data[i].users.length > 0){\r\n                        data[i].users.map(user => {\r\n                            user.name = user.name || user.user_name;\r\n                            user._is_last = true;\r\n                            return user;\r\n                        });\r\n                        data[i][childName] = data[i].users;\r\n                    }\r\n                    if(data[i][childName] && data[i][childName].length === 0){\r\n                        data[i]= undefined;\r\n                    }\r\n                }\r\n                while(data.length > 0) {\r\n                    // 如果有数组元素为空，每次删除一个\r\n                    var oldlen = data.length;\r\n                    for(var i = 0 ; i < oldlen ; i++){\r\n                        if(data[i] === undefined){\r\n                            data.splice(i,1);\r\n                            break;\r\n                        }\r\n                    }\r\n                    if(oldlen === data.length) {\r\n                        break;\r\n                    }\r\n                }\r\n                \r\n                return data.length;\r\n            }\r\n            function removeNoChildrenDeparts(data) {\r\n                data = data.filter(noUserFilter);\r\n                data.forEach(walk);\r\n                return data;\r\n                function walk(node) {\r\n                    if(!node.dept_id) { return; }\r\n                    // 用户上级是没有 children 的\r\n                    if(node.children) {\r\n                        node.children = node.children.filter(noUserFilter);\r\n                        node.children.forEach(walk);\r\n                    }\r\n                }\r\n                function noUserFilter(node) {\r\n                    if(node.dept_id && !node.children && node.users.length === 0) {\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                }\r\n            }\r\n            function get_admin(){\r\n                var deferred = $q.defer();\r\n                APIadmin.query(function(res){\r\n                    deferred.resolve(res);\r\n                });\r\n                return deferred.promise;\r\n            }\r\n            function get_user(){\r\n                var deferred = $q.defer();\r\n                APIuser.query_tree(function(res){\r\n                    deferred.resolve(res);\r\n                });\r\n                return deferred.promise;\r\n            }\r\n            function get_domain(){\r\n                var deferred = $q.defer();\r\n                APIdomain.list(function(res){\r\n                    deferred.resolve(res);\r\n                });\r\n                return deferred.promise;\r\n            }\r\n            $q.all([get_admin(),get_user(),get_domain()]).then(function(arr){\r\n                $scope._users = [{\r\n                    typeName: $$$I18N.get(\"管理用户\"),\r\n                    userData: arr[0].users\r\n                }];\r\n                $scope.domain_users = arr[2].result.map(function(res){\r\n                    res._name = $$$I18N.get(\"域\") + \"(\" + res.name + \")\";\r\n                    return res;\r\n                });\r\n                $scope.common_users = formatData(removeNoChildrenDeparts(arr[1].result),\"children\");\r\n                console.log($scope.common_users)\r\n            });\r\n            function getLastLevelNodes(obj_levels, arrays){\r\n                if(obj_levels.children){\r\n                    obj_levels.children.forEach(function(item){\r\n                        getLastLevelNodes(item, arrays);\r\n                    })\r\n                }else{\r\n                    arrays.push(obj_levels);\r\n                }\r\n            }\r\n\r\n            $scope.$on('add_selected', function(e, levels){\r\n                var arrays = [];\r\n                getLastLevelNodes(levels, arrays);\r\n                $scope.add_selected(arrays);\r\n            })\r\n            $scope.$on('add_select_rows', function(e,$event,node,nodes){\r\n                console.log(555555, $event,node, nodes);\r\n                $scope.add_select_rows($event,node, nodes);\r\n            })\r\n            $scope.add_selected = function(items){\r\n                var rows = items instanceof Array ? items : [items];\r\n                rows.forEach(function(i){\r\n                    if($scope.selected.indexOf(i) === -1){\r\n                        $scope.selected.push(i);\r\n                    }\r\n                });\r\n            };\r\n            $scope.remove_selected = function(items){\r\n                var rows = items instanceof Array ? items : [items];\r\n                rows.forEach(function(i){\r\n                    $scope.selected.splice($scope.selected.indexOf(i),1);\r\n                });\r\n                $scope.rmRows = [];\r\n            };\r\n            var lastRow2 = null;\r\n            $scope.add_select_rows = function(e,item,items){\r\n                var idx = $scope.seRows.indexOf(item);\r\n                if(e.ctrlKey){\r\n                    idx === -1 ? $scope.seRows.push(item) : $scope.seRows.splice(idx,1);\r\n                    lastRow2 = item;\r\n                }else if(e.shiftKey){\r\n                    var begin_idx = items.indexOf(lastRow2);\r\n                    var end_idx = items.indexOf(item);\r\n                    if(begin_idx === -1){\r\n                        lastRow2 = item;\r\n                        $scope.seRows = [item];\r\n                    }else{\r\n                        $scope.seRows = items.slice(Math.min(begin_idx,end_idx),Math.max(begin_idx,end_idx)+1);\r\n                        console.log(1111111,$scope.seRows)\r\n                    }\r\n                }else{\r\n                    $scope.seRows.splice(0,$scope.seRows.length,item);\r\n                    lastRow2 = item;\r\n                }\r\n            };\r\n            var lastRow = null;\r\n            $scope.add_remove_rows = function(e,item){\r\n                var idx = $scope.rmRows.indexOf(item);\r\n                if(e.ctrlKey){\r\n                    idx === -1 ? $scope.rmRows.push(item) : $scope.rmRows.splice(idx,1);\r\n                    lastRow = item;\r\n                }else if(e.shiftKey){\r\n                    var begin_idx = $scope.selected.indexOf(lastRow);\r\n                    var end_idx = $scope.selected.indexOf(item);\r\n                    if(begin_idx !== -1 && end_idx !== -1){\r\n                        $scope.rmRows = $scope.selected.slice(Math.min(begin_idx,end_idx),Math.max(begin_idx,end_idx)+1); \r\n                    }else{\r\n                        $scope.rmRows = [item];\r\n                        lastRow = item;\r\n                    }\r\n                }\r\n                else{\r\n                    $scope.rmRows.splice(0,$scope.rmRows.length,item);\r\n                    lastRow = item;\r\n                }\r\n            };\r\n            $scope.ltor = function(){\r\n                $scope.add_selected($scope.seRows);\r\n            };\r\n            $scope.rtol = function(){\r\n                $scope.remove_selected($scope.rmRows);\r\n            }\r\n        },\r\n        link: function(scope, element, attrs){\r\n            var last = null;\r\n            element.on(\"keyup\",'input[ng-model=\"searchText\"]',function(e){\r\n                $(\".menu_header\").addClass(\"open\");\r\n            });\r\n            element.on(\"click\",\".menu_header\",function(e){\r\n                $(this).toggleClass(\"open\");\r\n            });\r\n            element.on(\"click\",\".menuitem\", function(e){\r\n                var ele = $(this);\r\n                var menuItems = ele.parent().parent(\".menu_body\").find(\".menuitem\");\r\n                var allMenuItems = ele.parents(\".menus\").find(\".menuitem\");\r\n                if(e.ctrlKey){\r\n                    ele.hasClass(\"itemActive\") ? ele.removeClass(\"itemActive\") : ele.addClass(\"itemActive\");\r\n                    last = ele;\r\n                }else if(e.shiftKey){\r\n                    var begin_idx = [].indexOf.apply(menuItems,last);\r\n                    var end_idx = [].indexOf.apply(menuItems,ele);\r\n                    allMenuItems.removeClass(\"itemActive\");\r\n                    if(begin_idx !== -1 && end_idx !== -1){\r\n                        for(var i = 0; i < menuItems.length; i++){\r\n                            if(i > Math.max(begin_idx,end_idx) || i < Math.min(begin_idx,end_idx)){\r\n                                menuItems.eq(i).removeClass(\"itemActive\");\r\n                            }else{\r\n                                menuItems.eq(i).addClass(\"itemActive\");\r\n                            }\r\n                        }\r\n                    }else{\r\n                        ele.addClass(\"itemActive\");\r\n                        last = ele;\r\n                    }\r\n                }else{\r\n                    allMenuItems.removeClass(\"itemActive\");\r\n                    ele.addClass(\"itemActive\");\r\n                    last = ele;\r\n                }\r\n                \r\n            });\r\n        }\r\n    };\r\n}])\r\n.directive(\"uiInputNumber\", [\"$http\",\"$compile\",\"$templateCache\",function($http,$compile,$templateCache){\r\n    return {\r\n        restrict: \"AE\",\r\n        scope:{\r\n            step:\"@\",\r\n            max:\"@\",\r\n            userNumber: \"=ngModel\",\r\n            min:\"@\"\r\n        },\r\n        priority: 2,\r\n        require: \"ngModel\",\r\n        controller: function($scope){\r\n\r\n        },\r\n        link: function(scope, element, attrs,ctrl){\r\n\r\n            scope.addStep = Number(scope.step) || 1;\r\n            scope.addMax  = Number(scope.max) || null;\r\n            scope.addMin  = Number(scope.min) || null;\r\n\r\n            var is_dot = String(Number(scope.step)).indexOf(\".\") === -1 ? false : true; \r\n\r\n            var modelCtrl = ctrl;\r\n            var temp = $compile($(\"<div ui-input-number-wrapper></div>\")[0])(scope);\r\n            element.hide();\r\n            element.after(temp);\r\n           \r\n            var numKey = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105];\r\n            var ctrKey = [8,9,13,35,36,37,38,39,40,45,46,144,112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,110,190];\r\n            scope.keydown = function(e){\r\n                var _code = e.keyCode;\r\n                var _valsplit = e.target.value.split(\".\"); \r\n\r\n                if(numKey.indexOf(_code) === -1 && ctrKey.indexOf(_code) === -1){\r\n                    e.preventDefault();\r\n                }\r\n                // 小数点后只能输入一位\r\n                if(numKey.indexOf(_code) > -1 && _valsplit.length > 1 && _valsplit[1].length > 0 && e.target.selectionStart > e.target.value.indexOf(\".\")){\r\n                    e.preventDefault();\r\n                }\r\n                // 屏蔽小数点\r\n                if(_code === 110 || _code === 190){\r\n                    if(!is_dot){\r\n                        e.preventDefault();\r\n                    }else{\r\n                        if(e.target.value.indexOf(\".\") !== -1){\r\n                            e.preventDefault();\r\n                        }\r\n                    }\r\n                    \r\n                }\r\n                // 键盘上键加法\r\n                if(_code === 38){\r\n                    e.preventDefault();\r\n                    scope.add(scope.addStep);\r\n                    scope.round();\r\n                }\r\n                // 键盘下键减法\r\n                if(_code === 40){\r\n                    e.preventDefault();\r\n                    scope.add(-scope.addStep);\r\n                    scope.round();\r\n                }\r\n                \r\n            };\r\n            scope.round = function(){\r\n                scope.userNumber = is_dot ? Math.round(Number(scope.userNumber)*2)/2 : Math.round(scope.userNumber);\r\n            }\r\n\r\n            modelCtrl.$render = function(){\r\n                scope.setValidation();\r\n            };\r\n            scope.setValidation = function(){\r\n                var newval = modelCtrl.$modelValue;\r\n                var exp = /^-?([1-9]\\d*\\.?\\d*|0\\.?\\d*[1-9]\\d*|0?\\.?0+|0)$/;\r\n                if(exp.test(newval)){\r\n                    if((Math.abs(scope.addMax) >= 0 && newval > scope.addMax) || (Math.abs(scope.addMin) >= 0 && newval < scope.addMin) ){\r\n                        modelCtrl.$setValidity(\"number\",false);\r\n                    }else{\r\n                        modelCtrl.$setValidity(\"number\",true);\r\n                    }\r\n                }else{\r\n                    if(newval){\r\n                        modelCtrl.$setValidity(\"number\",false);\r\n                    }else{\r\n                        modelCtrl.$setValidity(\"number\",true);\r\n                    }\r\n                }\r\n            };\r\n            scope.add = function(num){\r\n                scope.userNumber = Number(scope.userNumber) ? Number(scope.userNumber) + Number(num) : Number(num);\r\n                scope.setValidation();\r\n            };\r\n        }\r\n    };\r\n}])\r\n.directive(\"uiInputNumberWrapper\", [function(){\r\n    return {\r\n        restrict: \"A\",\r\n        replace:true,\r\n        templateUrl: \"./views/vdi/common/input-number-temp.html\",\r\n        link: function(scope,element){\r\n        }\r\n    };\r\n}])\r\n.directive(\"uiInputNumberFormatter\", [function(){\r\n    return {\r\n        restrict: \"A\",\r\n        require:\"ngModel\",\r\n        link: function(scope, element, attrs,ctrl){\r\n            var exp = /^-?([1-9]\\d*\\.?\\d*|0\\.?\\d*[1-9]\\d*|0?\\.?0+|0)$/;\r\n\r\n            ctrl.$parsers.push(function(value){\r\n                if(exp.test(value)){\r\n                    return Number(value);\r\n                }\r\n            });\r\n            ctrl.$formatters.push(function(value){\r\n\r\n                if(exp.test(value)){\r\n                    return Number(value);\r\n                }\r\n            });\r\n        }\r\n    };\r\n}])\r\n.directive(\"uiWebUpload\", [\"$http\", \"$rootScope\", \"$$$I18N\", \"$Domain\", function($http, $rootScope, $$$I18N, $Domain){\r\n    var org = XMLHttpRequest;\r\n    var org_open = org.prototype.open;\r\n    var allowUpload = window.FormData && typeof window.FormData === \"function\";\r\n    $rootScope.uploadPool = $rootScope.uploadPool || {};\r\n    return {\r\n        restrict: \"A\",\r\n        templateUrl: function(ele, attrs){\r\n            if(attrs.templateUrl){\r\n                return attrs.templateUrl;\r\n            }\r\n            return \"views/vdi/common/ui-web-upload.html\";\r\n        },\r\n        scope: {\r\n            config:\"=uiUploadConfig\",\r\n            finishHandel:\"&\"\r\n        },\r\n        controller: [\"$scope\", function(scope){\r\n            scope.$on(\"progress\", function(e, size){\r\n                if(size.id === scope.upload_id){\r\n                    scope.progressName = size.name\r\n                    scope.isUploading = true;\r\n                    var percent = size.loaded / size.total * 100;\r\n                    if(isNaN(percent)) {\r\n                        percent = 0;\r\n                    }\r\n                    scope.progressPercent = percent.toFixed(2) + \"%\";\r\n                    if(scope.progressPercent === \"100.00%\"){ scope.isUploading = false; }\r\n                    // 初始化页面上传不更新问题\r\n                    scope.$apply();\r\n                }\r\n            });\r\n            scope.allowUpload = allowUpload;\r\n            scope.uploadISOSize = null;\r\n\r\n        }],\r\n        link: function(scope, element, attrs){\r\n            scope.upload_id = attrs.uiWebUpload;\r\n            scope.btnName = $$$I18N.get(attrs.uiUploadBtnName);\r\n            scope.$on(\"localizeLanguageChanged\", function(){\r\n                // 重新apply数据才会更新视图，加定时器，调用apply才不会报错\r\n                setTimeout(function(){\r\n                     scope.btnName = $$$I18N.get(attrs.uiUploadBtnName);\r\n                     scope.$apply();\r\n                });\r\n            });\r\n\r\n            // 绑定一个测试提交，如果条件为 true 则按钮可点击，否则不可点击\r\n            // 这种方式需要父 scope 配合\r\n            if(attrs.uiWebUploadTest) {\r\n                var degfn = scope.$parent.$watch(attrs.uiWebUploadTest, function (v) {\r\n                    scope.disableTest = v;\r\n                });\r\n                scope.$on(\"$destroy\", degfn);\r\n                scope.disableTest = false;\r\n            } else {\r\n                scope.disableTest = true;\r\n            }\r\n\r\n            var filetype,url;\r\n            var form = element.find(\"form\");\r\n            form.attr(\"action\", url);\r\n            function checkConfig(file,config){\r\n                var filetype = attrs.uiUploadType;\r\n                var maxSize = attrs.uiUploadLimit;\r\n                var url = attrs.uiUploadUrl;\r\n\r\n                if(!url){\r\n                    throw new Error(\"no url config\");\r\n                    return false;\r\n                }\r\n                var typematch = true;\r\n                if(filetype && file) {\r\n                    typematch = (new RegExp(\"\\\\.(\" + filetype + \")$\")).test(file.name);\r\n                    if(!typematch) {\r\n                        $.bigBox({\r\n                            title : $$$I18N.get(\"INFOR_TIP\"),\r\n                            content : $$$I18N.get(\"不是一个可接受的文件类型\"),\r\n                            icon : \"fa fa-warning shake animated\",\r\n                            timeout : 6000\r\n                        });\r\n                        return false;\r\n                    }\r\n                }\r\n\r\n                if(maxSize){\r\n                    maxSize = parseInt(maxSize);\r\n                    if(isNaN(maxSize)) {\r\n                        return console.error(\"invalid upload limit:\", attrs.uiUploadLimit);\r\n                    }\r\n                    if(file.size > maxSize * Math.pow(2,30)) {\r\n                        $.bigBox({\r\n                            title : $$$I18N.get(\"INFOR_TIP\"),\r\n                            content : $$$I18N.get(\"超出文件大小限制\") + \"(\"+ maxSize +\"G)\",\r\n                            icon : \"fa fa-warning shake animated\",\r\n                            timeout : 6000\r\n                        });\r\n                        return false;\r\n                    }\r\n                }\r\n                if(file.size === 0){\r\n                    $.bigBox({\r\n                        title : $$$I18N.get(\"INFOR_TIP\"),\r\n                        content : $$$I18N.get(\"文件为空\"),\r\n                        icon : \"fa fa-warning shake animated\",\r\n                        timeout : 6000\r\n                    });\r\n                    return false;\r\n                }\r\n                else{\r\n                    return true;\r\n                }\r\n            }\r\n            function clearDOM(){\r\n                var input = element.find(\"input[type=file]\");\r\n                input.after(input.clone(true).val(''));\r\n                input.remove();\r\n                scope.isUploading = false;\r\n                scope.progressSize = 0;\r\n            }\r\n            function finish(){\r\n                $rootScope.uploadPool[attrs.uiWebUpload] = undefined;\r\n                delete $rootScope.uploadPool[attrs.uiWebUpload];\r\n            }\r\n            function success(res){\r\n                if(typeof scope.finishHandel === \"function\"){\r\n                    scope.finishHandel({response: res});\r\n                }\r\n            }\r\n            element.find(\"input[type=file]\").on(\"change\", function(e){\r\n                var file = e.target.files[0];\r\n                if(!file){\r\n                    return ;\r\n                }\r\n                // var conf = scope.config;\r\n                var isValid = checkConfig(file);\r\n                \r\n                if(isValid){\r\n                    // $.bigBox({\r\n                    //  title : $$$I18N.get(\"INFOR_TIP\"),\r\n                    //  content : $$$I18N.get(\"INFOR_UPISO\"),\r\n                    //  iconSmall : \"fa fa-warning shake animated\",\r\n                    //  timeout : 5000\r\n                    // });\r\n\r\n                    var data = new FormData();\r\n                    // 允许绑定额外的参数\r\n                    if(attrs.uiWebUploadParams) {\r\n                        $.each(scope.$eval(attrs.uiWebUploadParams), function(k, v){\r\n                            data.append(k, v);\r\n                        });\r\n                    }\r\n                    data.append(attrs.uiWebUploadName || e.target.name, file);\r\n                    scope.progressName = file.name;\r\n                    scope.progressSize = \"(\" + (file.size / Math.pow(2,20)).toFixed(2) + \"M)\";\r\n\r\n                    $http.post($Domain + attrs.uiUploadUrl, data, {\r\n                        transformRequest: function(config){\r\n                            window.XMLHttpRequest = function(a, b, c, e){\r\n                                window.XMLHttpRequest = org;\r\n                                var xhr = new org(a, b, c, e);\r\n                                $rootScope.uploadPool[attrs.uiWebUpload] = xhr;\r\n                                xhr.open = function(q,w,e,r,t,y){\r\n                                    xhr.open = undefined;\r\n                                    delete xhr.open;\r\n                                    if(xhr.upload){\r\n                                        xhr.upload.addEventListener(\"progress\", function(e){\r\n                                            $rootScope.$broadcast(\"progress\", {\r\n                                                id: attrs.uiWebUpload,\r\n                                                name: file.name,\r\n                                                loaded: e.loaded,\r\n                                                position: e.position,\r\n                                                total: e.total,\r\n                                                totalSize: e.totalSize\r\n                                            });\r\n                                            \r\n                                        });\r\n                                        xhr.addEventListener(\"abort\", finish);\r\n                                    }\r\n                                    return org_open.call(xhr, q, w, e, r, t, y);\r\n                                }\r\n                                return xhr;\r\n                            };\r\n                            return config;\r\n                        },\r\n                        headers: {\"Content-Type\": undefined}\r\n                    }).then(function(res){\r\n                        clearDOM();\r\n                        finish(res);\r\n                        success(res);\r\n                        $rootScope.$broadcast(\"finishUpload\", true, file.name);\r\n                    },function(){\r\n                        clearDOM();\r\n                        finish();\r\n                    });\r\n                }\r\n            });\r\n                \r\n            element.find(\"button[type='button']\").on(\"click\", function(e){\r\n                $(this).prev(\"input[type=file]\").click();\r\n            });\r\n            if(attrs.btnClass) {\r\n                element.find(\"button[type='button']\").removeClass(\"btn-primary\").addClass(attrs.btnClass);\r\n            }\r\n            if(attrs.iconClass) {\r\n                element.find(\".icon\").removeClass(\"icon-jj-Upload\").addClass(attrs.iconClass);\r\n            }\r\n\r\n            element.find(\"#abortBtn\").on(\"click\", function(e){\r\n                var xhr = $rootScope.uploadPool[attrs.uiWebUpload];\r\n                xhr && xhr.abort();\r\n                clearDOM();\r\n                scope.$apply();\r\n            });\r\n        }\r\n    };\r\n}])\r\n.service(\"warnBox\",[function(){\r\n    this.warn = function(content, id, callback){\r\n        if(!$(\"#warnBox\").length){\r\n            $(\"body\").append(\"<div id='warnBox'></div>\");\r\n        }else{\r\n            $(\"#warnBox\").show();\r\n        }\r\n        $(\"body #warnBox\").append(\"<div class='box warnBox\"+id+\"'><i class='fa fa-bell'></i><div class='content'><div class='btn-close'><span>×</span></div><p class='detail' title=\"+content+\">\"+content+\"</p></div></div>\")\r\n        if($(\"body .warnBox\"+id+\" .detail\").height()>38){\r\n            $(\"body .warnBox\"+id+\" .detail\").addClass('highHeight');\r\n        }\r\n        $(\"#warnBox .warnBox\"+id+\" .btn-close\").click(function(e){\r\n            callback(id);\r\n        })\r\n        setTimeout(function(){\r\n            if($(\"#warnBox .warnBox\"+id+\"\")){\r\n                callback(id);\r\n            }\r\n        }, 30000)\r\n    },\r\n    this.close = function(id){\r\n        $(\"body .box.warnBox\"+id+\"\").remove();\r\n        if(!$(\"#warnBox\").children().length){\r\n            $(\"#warnBox\").hide();\r\n        }else{ $(\"#warnBox\").show(); }\r\n    }\r\n}])\r\n.controller(\"TaskListController\", [\"$scope\", \"Task\", \"$location\",\"$$$I18N\", \"UserRole\",\"$rootScope\", \"warnBox\", function($scope, task, $location, $$$I18N, UserRole,$rootScope,warnBox){\r\n    $scope.toggleTaskList = function(){\r\n        $(\"body\").toggleClass(\"show_prog\");\r\n    };\r\n    let user;\r\n    let taskTimer = null;\r\n    $scope.$on(\"NOAUTH\", () => {\r\n        user = null;\r\n        clearTimeout(taskTimer);\r\n    });\r\n    $scope.$on(\"STOPLOG\", function(){\r\n        clearTimeout(taskTimer);\r\n    });\r\n    $scope.$on(\"AUTHED\", () => {\r\n        user = UserRole.currentUser;\r\n        schedule();\r\n    });\r\n    if(UserRole.currentUser){\r\n        user = UserRole.currentUser;\r\n        schedule();\r\n    }\r\n    $scope.rows = [];\r\n    var data = {};\r\n    $scope.$on(\"instanceIDS\", function($event, ids){\r\n        data.instances = ids;\r\n    });\r\n    $scope.$on(\"imageIDS\", function($event, ids){\r\n        data.images = ids;\r\n    });\r\n    $scope.$on(\"clientIDS\", function($event, ids){\r\n        data.clients = ids;\r\n    });\r\n    $scope.$on('modeIDS', function($event, ids){\r\n        data.modes = ids;\r\n    });\r\n    $scope.$on('nodes', function($event, ids){\r\n        data.nodes = ids;\r\n    });\r\n    $scope.$on('manageNetworkIDS', function($event, ids){\r\n        data.manage_networks = ids;\r\n    })\r\n    $scope.$on('personpools',function($event,ids){\r\n        data.personpools=ids;\r\n    })\r\n    var lists = [], flag = false;\r\n    function schedule(){\r\n        var postData = data && Object.keys(data).map(function(key){\r\n            // if(key !== \"clients\"){\r\n                return {\r\n                    key: key,\r\n                    ids: data[key]\r\n                };                \r\n            // }\r\n            // else{\r\n            //     return {\r\n            //         key: key,\r\n            //         ids: []\r\n            //     };    \r\n            // }\r\n        });\r\n        task.post(postData,\r\n            function(res){\r\n                $scope.rows = res.results.tasks.filter(item => user.real_name ===  item.user);\r\n                \r\n                Object.keys(res.results).forEach(function(key){\r\n                    if(key !== \"tasks\"){\r\n                        $scope.$root && $scope.$root.$broadcast(key + \"RowsUpdate\", res.results[key]);\r\n                    }\r\n                });\r\n                for(var i in res.results.notifies){\r\n                    var item = res.results.notifies[i], color = '#004d60', content;\r\n                    if( lists[item.id] == undefined ){\r\n                        lists[item.id] = item;\r\n                        if(item.waringtype === 0){\r\n                            warnBox.warn(item.content, item.id, function(ID){\r\n                                warnBox.close(ID);\r\n                                task.put({notify_id: ID}, function(res){  })\r\n                            })\r\n                        }\r\n                        else{\r\n                            if(item.waringtype === 1){\r\n                                color = \"#004d60\";\r\n                                content = $$$I18N.get(item.name) + ' (' + item.target + ')';\r\n\r\n                            }\r\n                            else{\r\n                                color = \"#C46A69\";\r\n                                content = $$$I18N.get(item.name) + ' (' + item.target + ')';\r\n                            }\r\n                            $.bigBox({\r\n                                title:$$$I18N.get('waringtype'+item.waringtype),\r\n                                content:content,\r\n                                color : color,\r\n                                timeout : 3000\r\n                            }, function(){\r\n                                task.put({notify_id: item.id}, function(res){\r\n                                })\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                taskTimer = setTimeout(schedule, 3000);\r\n            },\r\n            function(){\r\n                taskTimer = setTimeout(schedule, 10000);\r\n            }\r\n        );\r\n        for(var k in data){\r\n            data[k] = undefined;\r\n            delete data[k];\r\n        }\r\n    }\r\n\r\n}])\r\n.controller(\"pageHeaderController\", [\"$scope\", \"UserAuth\", \"Task\", \"$location\",\"$$$I18N\", \"UserRole\", \"desktopHelpBox\",function($scope, Auth, task, $location, $$$I18N, UserRole, desktopHelpBox){\r\n    $scope.logout = function(){\r\n        Auth.logout();\r\n        desktopHelpBox.close();\r\n    };\r\n    $scope.$on(\"NOAUTH\", function(){\r\n        desktopHelpBox.close();\r\n    });\r\n    $scope.$on(\"DMS\", function(e,dms){\r\n        $scope.dmsURL = dms;\r\n        $$$storage.setSessionStorage('DMS', dms);\r\n    })\r\n    $scope.dmsURL = $$$storage.getSessionStorage('DMS') || 'nodms';\r\n    \r\n}])\r\n.controller(\"LogoController\", [\"$scope\",\"settings\", \"$Domain\", \"$$$version\", function($scope, settings, $Domain, $$$version){\r\n    $scope.domain = $Domain;\r\n    $scope.version = $$$version;\r\n    $scope.languages = settings.languages;\r\n    $scope.currentLang = settings.currentLang;\r\n}])\r\n.controller(\"SkinController\", [\"$scope\", function($scope){\r\n    $scope.changeSkin = function(theme){\r\n        $scope.$root.$broadcast(\"changeSkin\", theme)\r\n    }\r\n}])\r\n.controller(\"userLoginInfoController\", [\"$scope\", \"UserRole\", function($scope, Role){\r\n    $scope.loginUser = Role.currentUser;\r\n    $scope.$on(\"AUTHED\", function(name, userInfo){\r\n        $scope.loginUser = userInfo;\r\n    });\r\n    $scope.$on(\"NOAUTH\", function(){\r\n        $scope.loginUser = null;\r\n    });\r\n}])\r\n.controller(\"AlarmController\", [\"$scope\", \"$modal\", \"SystemAlarm\", \"AlarmHistory\", function($scope, $modal, alarm, AlarmHistory){\r\n    $scope.isOpen = false;\r\n    $scope.open = function(){\r\n        $scope.isOpen = true;\r\n    }\r\n    $scope.close = function(e){\r\n        if(e)\r\n            e.stopPropagation();\r\n        $scope.isOpen = false;\r\n    }\r\n    // function findDif(oldArray, newArray, difAttr){\r\n    //     if(newArray.length){\r\n    //         var length = oldArray.length>=newArray.length?oldArray.length:newArray.length;\r\n    //         var difs = [];\r\n    //         for(var i=0; i<length; i++){\r\n    //             if(newArray[i]){\r\n    //                 var different = oldArray.filter(function(item){ return item[difAttr] == newArray[i][difAttr] })[0];\r\n    //                 if(!different){ difs.push(newArray[i]) };\r\n    //             }\r\n    //         }\r\n    //         return difs;\r\n    //     }else{ return []; }\r\n    // };\r\n\r\n    // var oldAlarms = [];\r\n    $scope.$on(\"alarmsRowsUpdate\", function($event, data){\r\n        $scope.alarms = data;\r\n        // if(!$scope.isOpen){\r\n        //     var unreads = [];\r\n        //     data.forEach(function(item){\r\n        //         if(!item.is_read){ unreads.push(item) }\r\n        //     })\r\n        //     if(unreads.length){\r\n        //         $scope.open();\r\n        //         setTimeout(function(){\r\n        //             $scope.close();\r\n        //         }, 30000)\r\n        //     }\r\n        // }\r\n\r\n        // var difs = findDif(oldAlarms, data, 'id');\r\n        // if(!$scope.isOpen && difs.length){\r\n        //     oldAlarms = data;\r\n        //     $scope.open();\r\n        //     setTimeout(function(){\r\n        //         $scope.close();\r\n        //     }, 30000)\r\n        // }\r\n    })\r\n    $scope.delete = function(){\r\n        AlarmHistory.setRead({ids: $scope.alarms.map(function(item){ return item.id; })},function(res){\r\n            $scope.alarms = [];\r\n            $scope.isOpen = false;\r\n        })\r\n    }\r\n}])\r\n.filter(\"interfaceFilter\",[function(){\r\n    return function(data,idx,nets){\r\n        var invalidArr = [];\r\n        nets.forEach((n,i) => {\r\n            if(i !== idx && n._data_dev && n._data_dev._dev){\r\n                invalidArr.push(n._data_dev._dev);\r\n            }\r\n        });\r\n        return data.filter(function(d){\r\n           if(invalidArr.indexOf(d._dev) === -1){\r\n                return true;\r\n           }\r\n           return false;\r\n        });\r\n    }\r\n}])\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/vdi.js","angular.module(\"vdi.template\", [])\r\n\r\n/* 模板 */\r\n.factory(\"registerTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"get\", url: $Domain + \"/thor/image/register\" },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/register\" }\r\n\t});\r\n}])\r\n.factory(\"Network\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/networks\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", isArray: false, params: null},\r\n\t\tadd:\r\n\t\t\t{ method: \"POST\", isArray: false},\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/:id\", params: { id: \"@id\" }, isArray: false},\r\n\t\talter:\r\n\t\t\t{ method: \"PUT\", url:$Domain + \"/thor/network/:id\", params: { id: \"@id\" }, isArray: false},\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url:$Domain + \"/thor/network/:id\", params: { id: \"@id\" }, isArray: false},\r\n\r\n\t\tquery_sub:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/:id/subnets\", params: { id: \"@id\" }},\r\n\t\tadd_sub:\r\n\t\t\t{ method: \"POST\", url:$Domain + \"/thor/network/:id/subnets\", params: { id: \"@id\" }},\r\n\r\n\t\tget_sub:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/subnet/:id\", params: { id: \"@id\" }},\r\n\t\talter_sub:\r\n\t\t\t{ method: \"PUT\", url:$Domain + \"/thor/network/subnet/:id\", params: { id: \"@id\" }},\r\n\t\tdelete_sub:\r\n\t\t\t{ method: \"DELETE\", url:$Domain + \"/thor/network/subnet/:id\", params: { id: \"@id\" }},\r\n\t\tports:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/subnet/:id/ports\", params: { id: \"@id\" }}\r\n\r\n\t});\r\n}])\r\n\r\n.factory('ResourcePool', [\"$resource\", \"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/resource\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\"}\r\n\t});\r\n}])\r\n/* 模板镜像分发 */\r\n.factory(\"manageTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/manage/:id\", params: { id: \"@id\" } },\r\n\t\thandout:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/manage/:id\", params: { id: \"@id\" } },\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/image/manage/:id\", params: { id: \"@id\" } }\r\n\t});\r\n}])\r\n/* 根据虚拟化类型返回可用主机列表 */\r\n.factory(\"virtualHost\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/hosts_with_virtual_type\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/hosts_with_virtual_type\" }\r\n\t});\r\n}])\r\n/* 根据主机查找可用网络 */\r\n.factory(\"networkWithHost\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/list_network_with_host\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/list_network_with_host\" }\r\n\t});\r\n}])\r\n\r\n.factory(\"checkIP\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/check_ip\", null, {\r\n\t\tcheck:\r\n\t\t\t{ method: \"GET\" }\r\n\t});\r\n}])\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controllers.js","angular.module(\"vdi.template.teach\", [\"vdi.template\"])\r\n.directive(\"downloadUrl\", ['$http', function($http){\r\n\treturn {\r\n\t\trestrict: \"A\",\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\tvar url_arry = JSON.parse(attrs.urls.split(\",\"));\r\n\t\t\turl_arry.forEach(function(item){\r\n\t\t\t\t$(element).append('<iframe style=\"width: 0; height: 0;\" src=\"\" id=\"'+ item +'\" frameborder=\"0\"></iframe>')\r\n\t\t\t});\r\n\t\t\t$(element).click(function(e){\r\n\t\t\t\turl_arry.forEach(function(item){\r\n\t\t\t\t\t$(element).find('#'+item)[0].contentWindow.location = scope.domain +'/thor/image/download/'+ item;\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n}])\r\n.factory(\"TeachTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/1\", isArray: false },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/modify_template/:id\", params: { id: \"@id\" } },\r\n\t\tlistModes:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" }, isArray: false },\r\n\t\tapplyTemplate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" } },\r\n\t\tstatus:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/status/:id\", params: { id: \"@id\" } },\r\n\t\tcopy:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/clone_template\"},\r\n\t\tmodify:\r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/image/1\", isArray: false },\r\n\t\tinfor:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/info\" },\r\n\t\tspiceConnectInfo:\r\n\t\t\t{ method:\"GET\", url: $Domain + \"/compute/v1/instances/connection\"},\r\n\t\tvirtualStatus:\r\n\t\t\t{method:\"GET\", url: $Domain + \"/compute/v1/instances/:id/status\",params:{id:\"@id\"}},\r\n\t\tdownload:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/download/:id\", params: { id: \"@id\" } },\r\n\t\treset:\r\n\t\t\t{ method: \"post\", url: $Domain + \"/thor/image/reset_template\" },\r\n\t\tget_image_vnc_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_vnc_info\" },\r\n\t\tget_image_rdp_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_rdp_info\" },\r\n\t\tsync:\r\n\t\t\t{ method: \"post\", url: $Domain + \"/thor/image/bt_sync_template\" },\r\n\t\tsync_status:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/bt_sync_status\" },\r\n\t\tbt_before_edit_template:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_before_edit_template\" },\r\n\t\tbt_save_template:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_save_template\" },\r\n\t\tbt_prev_save_template:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_prev_save_template\" },\r\n\t\tbt_sync_retry:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_sync_retry\" },\r\n\t\tbt_sync_repair:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_sync_repair\" },\r\n\t\tupdate_tpl_tip:\r\n\t\t\t{method:\"GET\",url:$Domain + \"/thor/controller/ha_storage_state\"}\r\n\t});\r\n}])\r\n\r\n.controller(\"vdiTemplateTeachDesktopListController\",[\r\n\"$scope\", \"$modal\", \"TeachTemplate\", \"PersonTemplate\", \"$route\", \"Admin\", \"TeachDesktop\", \"$interval\", \"$filter\", \"$$$os_types\", \"$Domain\", \"Network\", \"$http\", \"$$$I18N\", \"ResourcePool\", \"manageTemplate\", \"VMCommon\", \"networkWithHost\", \"virtualHost\",\"UserRole\", \r\nfunction($scope, $modal, template, tmpl, $route,  admin, teachdesktop,$interval, $filter, $$$os_types, $Domain, network,$http, $$$I18N, ResourcePool, manageTemplate, vm, networkWithHost, virtualHost, UserRole){\r\n\t// teachdesktop.query({ id : $route.current.params.id }, function(res){\r\n\t// \tconsole.log(787878,res.result)\r\n\t// });\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.domain = $Domain;\r\n\t$scope.rows = []; $scope.allrows = [];\r\n\t\r\n\t$scope.images = [];\r\n\t$scope.loading = true;\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesizes = [30,20,10];\r\n    $scope.pagesize = $scope.pagesizes[0];\r\n\r\n    $scope.orders = [ {name: $$$I18N.get(\"按创建时间排序\"), val: 'time'}, {name: $$$I18N.get(\"按模板名称排序\"), val: 'name'}];\r\n    $scope.order = $scope.orders[0];\r\n    $scope.sortTem = function(val){\r\n    \tif(val == 'time'){\r\n    \t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n    \t}\r\n    \telse{\r\n    \t\t$scope.rows.sort(function(a,b){ return a.name>b.name? 1:-1 });\r\n    \t}\r\n    }\r\n\r\n\t$interval(function(){\r\n\t\t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"imageIDS\", $scope.rows.map(function(item){ return item.id }));\r\n\t}, 1000);\r\n\t$scope.$on(\"imagesRowsUpdate\", function($event, data){\r\n\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.rows = $scope.rows.filter(function(item){ return item.type_code ===1 });\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tif($scope.sync_mode==='bt'){\r\n\t\t\t\tif(row.sync_status){\r\n\t\t\t\t\tvar syncFaildLen = row.sync_status.filter(function(item){ return item.status === \"sync failed\" || item.status === \"no space left\" || item.sch == 'time out'}).length;\r\n\t\t\t\t\tvar syncDownloading = row.sync_status.filter(function(item){ return item.status === \"downloading\" }).length;\r\n\t\t\t\t\tif(syncFaildLen){\r\n\t\t\t\t\t\trow.sync_status.syncFaild = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(syncDownloading && !syncFaildLen){\r\n\t\t\t\t\t\trow.sync_status.syncing = true;\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tif(row.sync_status){\r\n\t\t\t\t\tvar updateInfor = row.sync_status.filter(function(item){ return item.type === \"image\" });\r\n\t\t\t\t\tif(updateInfor.length!==0)\r\n\t\t\t\t\t\trow.updateSize = (updateInfor[0].size/1024/1024/1024).toFixed(2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\t$scope.$root.$broadcast(\"syncTempl\", $scope.rows);\r\n\t\t// $scope.allrows = $scope.rows;\r\n\r\n\t});\r\n\r\n\ttemplate.query(function(res){\r\n\t\t$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t});\r\n\t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t$scope.sync_mode = res.sync_mode;\r\n\t\t$scope.loading = false;\r\n\t\t$scope.teachNames = $scope.rows.map(function(item){ return item.name });\r\n\t\t$scope.sameName = false;\r\n\r\n\t\t$scope.allrows = $scope.rows;\r\n\t\tif($$$storage.getSessionStorage('virtual_type_T')!=='all')\r\n\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === $$$storage.getSessionStorage('virtual_type_T') });\r\n\t});\r\n\r\n\t$scope.select = $$$storage.getSessionStorage('virtual_type_T') || 'all';\r\n\t$scope.$watch(\"select\",function(newvalue){\r\n\t\tif(newvalue){\r\n\t\t\tif(newvalue!=='all'){\r\n\t\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === newvalue });\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t$scope.rows = $scope.allrows;\r\n\t\t\t}\r\n\t\t\t$$$storage.setSessionStorage('virtual_type_T', newvalue);\r\n\t\t}\r\n\t});\r\n\tvar _controllerScope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除教学模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t$scope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.delete({ id: rows.map(function(item){ return item.id }) },function(res){\r\n\t                \ttemplate.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\ttemplate.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.shutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar rows_active = rows.filter(function(item){ return item.instance_status === 'running' });\r\n\t\tif(!rows_active.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"SHUTOFF_TIP\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='shutdown_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><img data-ng-if='loading' src='./img/building.gif' width='24px'><button class='btn btn-primary' data-ng-if='!loading' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t\t$scope.name = rows_active.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\t\tvm.shutdowns({ instance_ids: rows_active.map(function(item){ return item.instance_id }) },function(res){\r\n\t\t\t\t\t\t\trows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\t\tif(item.id === row.id){\r\n\t\t\t\t\t\t\t\t\t\titem.instance_status = \"shutdown\";\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize: \"sm\"\r\n\t\t\t});\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.syncTem = function(item){\r\n\t\t$scope.loading = false;\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_sync.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\tif(!$scope.sync_status){\r\n\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t}\r\n\t\t\t\t$scope.name = item.name;\r\n\t\t\t\t$scope.$on(\"syncTempl\", function($event, data){\r\n\t\t\t\t\tvar thistmpl = data.filter(function(r){ return r.id === item.id })[0];\r\n\t\t\t\t\t$scope.sync_status = thistmpl.sync_status;\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.Retry = function(temp){\r\n\t\t\t\t\tvar data = {image_id: temp.image, server_ip: temp.server_ip, server_id: temp.server_id, version: temp.version}\r\n\t\t\t\t\ttemplate.bt_sync_retry(data, function(res){\r\n\r\n\t\t\t\t\t}, function(){})\r\n\t\t\t\t};\r\n\t\t\t\t$scope.Repair = function(temp){\r\n\t\t\t\t\tvar data = {image_id: temp.image, server_ip: temp.server_ip, server_id: temp.server_id, version: temp.version};\r\n\t\t\t\t\ttemplate.bt_sync_repair(data, function(res){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}, function(){})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"lg\"\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\r\n\t$scope.update = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_mode_list.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.modes = [];\r\n\t\t\t\ttemplate.listModes({ id: item.id }, function(res){\r\n\t\t\t\t\t$scope.modes = res.modes;\r\n\t\t\t\t},function(){ $scope.noScense = true });\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.applyTemplate({ id: item.id }, function(res){\r\n\t\t\t\t\t\t/* doSTH */\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.trigger = function(){\r\n\t\t$scope.rows.some(function(row){\r\n\t\t\trow._selected;\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.copy = function(item){\r\n\t\t $modal.open({\r\n                templateUrl: \"views/vdi/dialog/template/template_copy.html\",\r\n                size: \"md\",\r\n                controller: [\"$scope\", \"$modalInstance\", function($scope, $modalInstance){\r\n                    $scope.min_namelength=2;$scope.max_namelength=20;\r\n                    $scope.is_copy = true;\r\n                    $scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n                    $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n                    $scope.types = $scope.types2;\r\n                    $scope.bind_ip_type = $scope.types2[0];\r\n                    admin.query(function(res){\r\n                        $scope.owners = res.users;\r\n                        angular.forEach($scope.owners, function(item){\r\n                        \tif(item.name == user.name){\r\n                        \t\t$scope.owner = item;\r\n                        \t}\r\n                        });\r\n                        if(!$scope.owner) {\r\n                        \t$scope.owner = $scope.users[0]\r\n                        }\r\n                    });\r\n                    $scope.type = '1';\r\n                    $scope.temCopy = false;\r\n                    \r\n                    $scope.temData = item;\r\n                    $scope.getVirtualHost = function (type,rbd_enabled){\r\n                    \t$scope.host_loading = true;\r\n                    \tvirtualHost.query({\r\n                    \t\tvirtual_type: type,\r\n                    \t\trbd_enabled: rbd_enabled\r\n                    \t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n                    \t},function(res){\r\n                    \t\t$scope.host_loading = false;\r\n                    \t\t$scope.hosts = res.result;\r\n                    \t\t$scope.host = $scope.hosts[0];\r\n                    \t\t$scope.getNetwork($scope.host);\r\n                    \t},function(){\r\n\r\n                    \t});\r\n                    }\r\n                    $scope.getVirtualHost(item.virtual_type,item.rbd_enabled);\r\n\r\n                    // function getIps(subnet_id, _scope){\r\n                    // \tif(subnet_id)\r\n                    // \t\tnetwork.ports({ id: subnet_id },function(res){\r\n                    // \t\t\tif(res.unused_ips.length){\r\n                    // \t\t\t\t_scope.band_ips = res.unused_ips;\r\n                    // \t\t\t}\r\n                    // \t\t\telse{\r\n                    // \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n                    // \t\t\t}\r\n                    // \t\t\t_scope.bind_ip_loading = false;\r\n                    // \t\t})\r\n                    // };\r\n                    $scope.switchIps = function(subnet,_scope){\r\n                    \t// _scope.bind_ip_loading = true;\r\n                    \tif(subnet){\r\n                    \t\t// getIps(subnet.id, _scope);\r\n                    \t\t_scope.types = _scope.types2;\r\n                    \t\t_scope.bind_ip_type = _scope.types2[0];\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.types = _scope.types1;\r\n                    \t\t_scope.band_ips = [];\r\n                    \t\t_scope.bind_ip_type = _scope.types1[0];\r\n                    \t\t// _scope.bind_ip_loading = false;\r\n                    \t}\r\n                    };\r\n                    function getSubnets(Network,_scope){\r\n                    \tif(Network.subnets.length){\r\n                    \t\t$scope.network_loading = true;\r\n                    \t\t// $scope.bind_ip_loading = true;\r\n                    \t\tnetwork.query_sub({id: Network.id }, function(res){\r\n                    \t\t\t_scope.subnets = res.result;\r\n                    \t\t\t_scope.subnet = _scope.subnets[0];\r\n                    \t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t\t\t$scope.network_loading = false;\r\n                    \t\t})\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.subnets = [];\r\n                    \t\t_scope.subnet = null;\r\n                    \t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t}\r\n                    };\r\n                    $scope.getNetwork = function(host){\r\n                    \tif(host){\r\n                    \t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n                    \t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n                    \t\t\t$scope.networks = res.result;\r\n                    \t\t\t$scope.network = $scope.networks[0];\r\n                    \t\t\tgetSubnets($scope.network, $scope);\r\n                    \t\t}, function(){});\r\n                    \t}\r\n                    }\r\n\r\n                    $scope.switchSubnet = function(val, _scope){\r\n                    \tgetSubnets(val,_scope);\r\n                    }\r\n                    $scope.bind_ip = {value: null};\r\n                    $scope.ok = function(){\r\n                    \tvar bindIP = this.bind_ip.value;\r\n                    \t// var unUseIP = this.band_ips.filter(function(item){ return item===bindIP });\r\n                    \t// if(this.bind_ip_type.value === 'static' && bindIP === '无可用IP'){\r\n                    \t// \t$.bigBox({\r\n                    \t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n                    \t// \t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n                    \t// \t\ttimeout\t: 6000\r\n                    \t// \t});\r\n                    \t// }else if(this.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){\r\n                    \t// \t$.bigBox({\r\n                    \t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n                    \t// \t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n                    \t// \t\ttimeout\t: 6000\r\n                    \t// \t});\r\n                    \t// }else{\r\n\t                \t\t$scope.temCopy = true;\r\n\t                \t\tvar _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;\r\n\t                        template.copy({\r\n\t                    \t\tname: this.name,\r\n\t                    \t\tdescription: this.description,\r\n\t                    \t\timage_id : item.id,\r\n\t                    \t    type_code: this.type,\r\n\t                    \t    owner: $scope.owner.id,\r\n\t                    \t    network: this.network.id,\r\n\t                    \t    subnet: this.subnet?this.subnet.id:'',\r\n\t                    \t    band_ip: _ip,\r\n\t                    \t    band_type: this.bind_ip_type.value,\r\n\t                    \t    host_uuid: this.host.host_uuid\r\n\t                    \t    // enable_gpu: item.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n\t                        }, function(res){\r\n\t                        \ttemplate.query(function(res){\r\n\t                        \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n\t        \t\t\t\t\t\t\t\treturn item;\r\n\t        \t\t\t\t\t\t\t}\r\n\t        \t\t\t\t\t\t\telse{\r\n\t        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n\t        \t\t\t\t\t\t\t}\r\n\t        \t\t\t\t\t\t});\r\n\t                        \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t                        \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t                        \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t                        \t});\r\n\t                        \t$modalInstance.close(); \r\n\t                        }, function(){\r\n\t                        \t$scope.temCopy = false;\r\n\t                        });\r\n\t                    \t// }\r\n\t                    }\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    };\r\n                } ]\r\n            });\r\n\t};\r\n\r\n\t$scope.sync = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='SYNC_TEM'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='SYNC_TEM_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.sync({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.undoSync = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='UNDO_SYNC_TEM'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='TEM_UNDOSYNC' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.bt_before_edit_template({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.modify = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_modify.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t\t\t\t$scope.types = $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t\t\t\t$scope.virtual_type = item.virtual_type;\r\n\t\t\t\t$scope.disabled_gpu = item.disabled_gpu;\r\n\t\t\t\t$scope.data = {vcpus: 1, ram: 1.5, system_alloc_disk: 10, bind_ip_type: $scope.types2[1]};\r\n\t\t\t\tvar oldData = {};\r\n\t\t\t\tfunction getSubnets(Network, subnet_id, flag){\r\n\t\t\t\t\tif(Network.subnets.length){\r\n\t\t\t\t\t\t$scope.network_loading = true;\r\n\t\t\t\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t\t\t\t$scope.data.subnets = res.result;\r\n\t\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\t\toldData.subnets = $scope.data.subnets;\r\n\t\t\t\t\t\t\t\toldData.subnet = $scope.data.subnet = $scope.data.subnets.filter(function(data){ return data.id === subnet_id })[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = $scope.data.subnets[0];\r\n\t\t\t\t\t\t\t\tif($scope.data.subnet)\r\n\t\t\t\t\t\t\t\t\tgetIps($scope.data.subnet.id, $scope.cur_imgInfor.nets.ip_address, false);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$scope.network_loading = false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.data.subnets = [];\r\n\t\t\t\t\t\t$scope.data.subnet = null;\r\n\t\t\t\t\t\t$scope.switchIps($scope.data.subnet);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tfunction getIps(subnet_id, curr_ip, flag){\r\n\t\t\t\t\tif(subnet_id){\r\n\t\t\t\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];\r\n\t\t\t\t\t\t\toldData.band_ips = $scope.data.band_ips;\r\n\t\t\t\t\t\t\toldData.band_ip = $scope.data.band_ip = curr_ip;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// network.ports({ id: subnet_id },function(res){\r\n\t\t\t\t\t\t// \tif(res.unused_ips.length){\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ips = res.unused_ips;\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ips = [\"无可用IP\"];\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t// \tif(subnet_id===$scope.cur_imgInfor.nets[0].subnet_id){\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ips.push(curr_ip);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \tif(flag){\r\n\t\t\t\t\t\t// \t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];\r\n\t\t\t\t\t\t// \t\toldData.band_ips = $scope.data.band_ips;\r\n\t\t\t\t\t\t// \t\toldData.band_ip = $scope.data.band_ip = curr_ip;\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \t$scope.bind_ip_loading = false;\r\n\t\t\t\t\t\t// });\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.switchSubnet = function(val){\r\n\t\t\t\t\tgetSubnets(val, $scope.cur_imgInfor.nets.network_id, false);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.switchIps = function(subnet){\r\n\t\t\t\t\tif(subnet){\r\n\t\t\t\t\t\tgetIps(subnet.id,$scope.cur_imgInfor.nets.ip_address, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.addbtndisk = function(){\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.minusbtndisk = function(){\r\n\t\t\t\t\tif($scope.old_data_alloc_disk && !$scope.old_data_alloc_disk_2){\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(templateInfor){\r\n\r\n\t\t\t\t\t$scope.cur_imgInfor = templateInfor;\r\n\t\t\t\t\toldData.name = $scope.data.name = templateInfor.name;\r\n\t\t\t\t\toldData.description = $scope.data.description = templateInfor.description;\r\n\t\t\t\t\tgetIps(templateInfor.nets[0].subnet_id, templateInfor.nets[0].ip_address, true);\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t$scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t\t\t$scope.networks = data.networks;\r\n\t\t\t\t\t\toldData.network = $scope.data.network = $scope.networks.filter(function(data){ return data.id===templateInfor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tgetSubnets($scope.data.network,templateInfor.nets[0].subnet_id, true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\toldData.enable_gpu = $scope.data.enable_gpu= templateInfor.enable_gpu;\r\n\t\t\t\t\toldData.vcpus = $scope.data.vcpus= templateInfor.vcpus;\r\n\t\t\t\t\toldData.ram = $scope.data.ram= templateInfor.ram/1024;\r\n\t\t\t\t\toldData.system_alloc_disk = $scope.data.system_alloc_disk= templateInfor.system_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk = $scope.data.data_alloc_disk= templateInfor.data_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk_2 = $scope.data.data_alloc_disk_2= templateInfor.data_alloc_disk_2;\r\n\t\t\t\t\t$scope.old_data_alloc_disk = templateInfor.data_alloc_disk;\r\n\t\t\t\t\t$scope.old_data_alloc_disk_2 = templateInfor.data_alloc_disk_2;\r\n\r\n\t\t\t\t})\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\t$scope.oldData = angular.copy($scope.data);\r\n\t\t\t\t\r\n\t\t\t\t$scope.isUnchanged = function(){\r\n\t\t\t\t\treturn angular.equals(oldData,$scope.data)\r\n\t\t\t\t}\r\n\t\t\t\t$scope.reset = function(){\r\n\t\t\t\t\tif(oldData.bind_ip_type.value!=='none'){\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.data = angular.copy(oldData);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t// if($scope.data.system_alloc_disk < oldData.system_alloc_disk || $scope.data.data_alloc_disk_2 < oldData.data_alloc_disk_2 || $scope.data.data_alloc_disk < oldData.data_alloc_disk){\r\n\t\t\t\t\t// \t$.bigBox({\r\n\t\t\t\t\t// \t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t// \t\t\tcontent : $$$I18N.get(\"modifyTemTip\"),\r\n\t\t\t\t\t// \t\t\ttimeout : 6000\r\n\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t// var bindIP = $scope.data.band_ip;\r\n     //            \tvar unUseIP = $scope.data.band_ips.filter(function(item){ return item===bindIP });\r\n     //            \tif($scope.data.bind_ip_type.value === 'static' && bindIP === '无可用IP'){\r\n     //            \t\t$.bigBox({\r\n     //            \t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n     //            \t\t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n     //            \t\t\ttimeout\t: 6000\r\n     //            \t\t});\r\n     //            \t}else if($scope.data.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){\r\n     //            \t\t$.bigBox({\r\n     //            \t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n     //            \t\t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n     //            \t\t\ttimeout\t: 6000\r\n     //            \t\t});\r\n     //            \t}else{\r\n\t\t\t\t\t\t$scope.submit_loading = true;\r\n\t\t\t\t\t\ttemplate.modify({\r\n\t\t\t\t\t\t\timage_id: item.id,\r\n\t\t\t\t\t\t\tinstance_id: item.instance_id,\r\n\t\t\t\t\t\t\ttemplate_name: $scope.data.name,\r\n\t\t\t\t\t\t\tdescription: $scope.data.description,\r\n\t\t\t\t\t\t\tnetwork: $scope.data.network.id,\r\n\t\t\t\t\t\t\tsubnet: $scope.data.subnet?$scope.data.subnet.id:\"\",\r\n\t\t\t\t\t\t\tband_ip: $scope.data.bind_ip_type.value === 'static' ? $scope.data.band_ip:undefined,\r\n\t\t\t\t\t\t\tband_type: $scope.data.bind_ip_type.value,\r\n\t\t\t\t\t\t\tvcpus: $scope.data.vcpus,\r\n\t\t\t\t\t\t\tram: $scope.data.ram,\r\n\t\t\t\t\t\t\tenable_gpu: item.virtual_type=='hyper-v' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tgpu_auto_assignment: item.virtual_type=='kvm' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tsystem_alloc_disk: $scope.data.system_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk: $scope.data.data_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk_2: $scope.data.data_alloc_disk_2\r\n\t\t\t\t\t\t}, function(res){\r\n\t\t\t\t\t\t\t$scope.submit_loading = false;\r\n\t\t\t\t\t\t\ttemplate.query(function(res){\r\n\t                    \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n        \t\t\t\t\t\t\t\treturn item;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t\telse{\r\n        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t});\r\n\t                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t                    \t});\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t},function(){ $scope.submit_loading = false; });\r\n\t\t\t\t\t// }\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.resetTemp = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重置模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='REST_TEMP_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.reset({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.imgManage = function(IMG){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_imgManage.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.imgType = IMG.virtual_type;\r\n\t\t\t\tfunction formLocalData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.host_ip]){\r\n\t\t\t\t\t\t\tlet obj = {host_ip: item.host_ip, hostname: item.hostname, resource_pool_uuid: item.resource_pool_uuid, storages: []};\r\n\t\t\t\t\t\t\tarry[item.host_ip] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet hostArry = dataResource.filter(function(data){ return data.host_ip == item.host_ip });\r\n\t\t\t\t\t\thostArry.forEach(function(data){\r\n\t\t\t\t\t\t\tif(!item.storages[data.storage_name]){\r\n\t\t\t\t\t\t\t\tlet obj = {storage_name: data.storage_name, storage_uuid: data.storage_uuid, storage_type: data.storage_type, imgs: []};\r\n\t\t\t\t\t\t\t\titem.storages[data.storage_name] = obj;\r\n\t\t\t\t\t\t\t\titem.storages.push(obj);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\titem.storages.forEach(function(data){\r\n\t\t\t\t\t\t\tlet storageArry = dataResource.filter(function(d){ return item.host_ip == d.host_ip && d.storage_name == data.storage_name });\r\n\t\t\t\t\t\t\tstorageArry.forEach(function(d){\r\n\t\t\t\t\t\t\t\tdata.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\titem.storages.sort(function(a,b){ return a.storage_name>b.storage_name?1:-1 });\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction formRemoteData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.storage_name+\"_remote\"]){\r\n\t\t\t\t\t\t\tlet obj = {storage_name: item.storage_name, storage_uuid: item.storage_uuid, storage_type: item.storage_type, host_ip: item.host_ip, imgs: []};\r\n\t\t\t\t\t\t\tarry[item.storage_name+\"_remote\"] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet imgArry = dataResource.filter(function(d){ return item.storage_name == d.storage_name });\r\n\t\t\t\t\t\timgArry.forEach(function(d){\r\n\t\t\t\t\t\t\titem.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction getLocal(resource_pool_uuid){\r\n\t\t\t\t\t$scope.local_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: resource_pool_uuid},function(res){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t\t$scope.locals = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tfunction getRemote(){\r\n\t\t\t\t\t$scope.remote_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\tconsole.log(res.result);\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t\t$scope.remotes = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tvar new_pool = {};\r\n\t\t\t\tgetRemote();\r\n\t\t\t\tResourcePool.query(function(res){\r\n\t\t\t\t\t$scope.pools = res.result.filter(function(p){ return p.type == IMG.virtual_type });\r\n\t\t\t\t\tnew_pool = $scope.pool = $scope.pools[0];\r\n\t\t\t\t\tgetLocal($scope.pool.uuid);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$scope.getlocalImages = function(pool){\r\n\t\t\t\t\tnew_pool = pool;\r\n\t\t\t\t\tgetLocal(pool.uuid);\r\n\t\t\t\t};\r\n\t\t\t\t$scope.$on(\"syncTempl\", function($event, data){\r\n\t\t\t\t\tvar updateVolume = data.filter(function(item){ return item.id==IMG.id })[0].volume;\r\n\t\t\t\t\tif(updateVolume.length!==0){\r\n\t\t\t\t\t\tupdateVolume.forEach(function(volume){\r\n\t\t\t\t\t\t\tif(volume.storage_type=='local'){\r\n\t\t\t\t\t\t\t\t$scope.locals && $scope.locals.forEach(function(local){\r\n\t\t\t\t\t\t\t\t\tlocal.storages.forEach(function(storage){\r\n\t\t\t\t\t\t\t\t\t\tstorage.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.remotes && $scope.remotes.forEach(function(remote){\r\n\t\t\t\t\t\t\t\t\tremote.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t$scope.sendImg = function(storage_type, resource_pool_uuid, image_type, image_uuid, storage_uuid, img, pool){\r\n\t\t\t\t\timg.volume_status = 'sending';\r\n\t\t\t\t\tmanageTemplate.handout({\r\n\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\tresource_pool_uuid: storage_type=='local'?resource_pool_uuid:undefined,\r\n\t\t\t\t\t\timage_type: image_type,\r\n\t\t\t\t\t\timage_uuid: image_uuid,\r\n\t\t\t\t\t\tstorage_uuid: storage_uuid,\r\n\t\t\t\t\t\tstorage_type: storage_type\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\tif(storage_type=='local'){\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: pool.uuid},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.locals.splice(0, $scope.locals.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.locals,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.remotes.splice(0, $scope.remotes.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.remotes,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t// img.status = 'sended failed';\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\t$scope.deleteImg = function(storage_type, volume_uuid, img, storage_uuid, pool){\r\n\t\t\t\t\tif(!img.has_instance){\r\n\t\t\t\t\t\timg.volume_status = 'deleting';\r\n\t\t\t\t\t\tmanageTemplate.delete({\r\n\t\t\t\t\t\t\tstorage_type: storage_type,\r\n\t\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\t\tvolume_uuid: volume_uuid,\r\n\t\t\t\t\t\t\timage_uuid: img.image_uuid,\r\n\t\t\t\t\t\t\tstorage_uuid: storage_uuid\r\n\t\t\t\t\t\t},function(res){\r\n\r\n\t\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t\timg.volume_status = 'delete failed';\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.detail = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_detail.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(infor){\r\n\t\t\t\t\t$scope.data = infor;\r\n\t\t\t\t\tfunction formData(obj){\r\n\t\t\t\t\t\tobj.imgs = [];\r\n\t\t\t\t\t\tfor(var i in obj){\r\n\t\t\t\t\t\t\tif(i!=='imgs'){\r\n\t\t\t\t\t\t\t\tvar img = {};\r\n\t\t\t\t\t\t\t\timg.location = i;\r\n\t\t\t\t\t\t\t\timg.volumeId = obj[i];\r\n\t\t\t\t\t\t\t\tobj.imgs.push(img);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tfor(var i in $scope.data.inst_volumes){\r\n\t\t\t\t\t\tformData($scope.data.inst_volumes[i]);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t$scope.data.network = data.networks.filter(function(data){ return data.id===infor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tif(infor.nets[0].subnet_id){\r\n\t\t\t\t\t\t\tnetwork.query_sub({id: infor.nets[0].network_id }, function(res){\r\n\t\t\t\t\t\t\t\tvar subnet = res.result.filter(function(data){ return data.id === infor.nets[0].subnet_id })[0];\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = subnet.name +\" (\"+ subnet.start_ip + \"~\" + subnet.end_ip +\")\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}, function(){});\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}])\r\n\r\n.controller(\"addTeachTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"TeachTemplate\", \"HardwareTemplate\", \"SystemISO\", \"Admin\", \"$$$os_types\",\"$$$I18N\", \"UserRole\",\"Network\", \"virtualHost\", \"networkWithHost\", \"$rootScope\",\"checkIP\",\r\nfunction($scope, $modalInstance, teach, hardware, iso, admin, $$$os_types,$$$I18N, UserRole, network, virtualHost, networkWithHost, $root, checkIP){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.auto_isos = [];$scope.all_isos = [];\r\n\t$scope.iso = [];\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name === user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t})\r\n\t\tif(!$scope.owner) $scope.owner = $scope.users[0]\r\n\t});\r\n\thardware.query(function(res){\r\n\t\t$scope.hardware_templates = res.result;\r\n\t\t$scope.template = $scope.hardware_templates[0];\r\n\t});\r\n\tiso.query(function(res){\r\n\t\t$scope.all_isos = res.isos.filter(function(iso){ return iso.type && iso.type!==\"package\" && iso.type!==\"other\"; });\r\n\t\t\r\n\t\t$scope.all_isos.forEach(function(item){\r\n\t\t\titem.os_type = item.os_type.split(\",\");\r\n\t\t});\r\n\t\t$scope.isos = $scope.all_isos;\r\n\t\t$scope.iso = [$scope.isos[0]];\r\n\t\tangular.forEach($scope.isos, function(item){\r\n\t\t\tif(item.support_auto_install == true)\r\n\t\t\t\t$scope.auto_isos.push(item);\r\n\t\t})\r\n\t});\r\n\r\n\t$scope.type = 'kvm';\r\n\t$scope.enable_gpu = false;\r\n\t$scope.gpu_auto_assignment = false;\r\n\t$scope.getVirtualHost = function (type){\r\n\t\tvar _this = this;\r\n\t\t$scope.host_loading = true;\r\n\t\tvar data = {};\r\n\t\tdata.type = type;\r\n\t\tif(type=='hyper-v'){\r\n\t\t\tdata.enable_gpu = _this.enable_gpu;\r\n\t\t\t_this.gpu_auto_assignment = false;\r\n\t\t}else{\r\n\t\t\tdata.enable_gpu = _this.gpu_auto_assignment;\r\n\t\t\t_this.enable_gpu = false;\r\n\t\t}\r\n\t\tvirtualHost.query(data,function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t_this.host = $scope.hosts[0];\r\n\t\t\t_this.host && $scope.getNetwork(_this.host);\r\n\t\t},function(){\r\n\r\n\t\t});\r\n\t}\r\n\t$scope.getVirtualHost($scope.type);\r\n\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\r\n\t\t}\r\n\t}\r\n\t// network.query(function(data){\r\n\t// \t$scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });\r\n\t// \t$scope.network = $scope.networks[0];\r\n\t// \tgetSubnets($scope.network, $scope);\r\n\t// })\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\t$scope.names = $scope.rows.map(function(item){ return item.name });\r\n\t$scope.sameName = false;\r\n\tvar _scope = $scope;\r\n\t$scope.install = \"manualinstall\";\r\n\t$scope.isOther = false;\r\n\t$scope.$on(\"selectStepChange\", function(e, arg){\r\n\t\tif(arg.index==0){\r\n\t\t\targ.stepScope.$$nextSibling.error = false;\r\n\t\t}\r\n\t})\r\n\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\t_scope.type = scope.type;\r\n\t\tscope.error = step.is_dirty;\r\n\t\tvar flag = false;\r\n\t\t_scope.names.forEach(function(item){\r\n\t\t\tif(scope.name == item){ flag = true; }\r\n\t\t})\r\n\t\tif(flag){\r\n\t\t\t_scope.sameName = true;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"WRONG_NAME\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse { _scope.sameName = false; }\r\n\t\tstep.done = !scope.step_pane0.$invalid && !_scope.sameName && !scope.network_loading;\r\n\r\n\t\tif(step.done && scope.$$childTail && scope.$$childTail.bind_ip){\r\n\t\t\tstep.showLoading = true;\r\n\t\t\tstep.done = false;\r\n\t\t\tcheckIP.check({ip: scope.$$childTail.bind_ip, subnet_id: scope.subnet.id},function(res){\r\n\t\t\t\tif(!res.result){\r\n\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n\t\t\t\t\t\ttimeout\t: 6000\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.$broadcast(\"currentStepChange\", 1);\r\n\t\t\t\t}\r\n\t\t\t\tstep.showLoading = false;\r\n\t\t\t},function(error){ step.showLoading = false; });\r\n\t\t}\r\n\t});\r\n\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\tif(scope.template.system_gb == 0)\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"模板系统盘不能为0\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\tstep.done = !(scope.template.system_gb == 0);\r\n\t});\r\n\t$scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n\t\tsetTimeout(function(){\r\n\t\t\t$(\"[rel=popover-hover]\").popover({\r\n\t\t\t\ttrigger : \"hover\"\r\n\t\t\t});\r\n\t\t})\r\n\t\t_scope.install = scope.install;\r\n\t\tif(scope.iso != undefined && scope.iso[0] != undefined){\r\n\t\t\tif(scope.iso[0].os_type[0] == 'other'){\r\n\t\t\t\tscope.$parent.system_versions = $$$os_types;\r\n\t\t\t\tscope.$parent.system_version1 = scope.$parent.system_versions[0];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tvar _types = [];\r\n\t\t\t\tscope.iso[0].os_type.forEach(function(item){\r\n\t\t\t\t\tvar _obj = {};\r\n\t\t\t\t\t_obj.key = item;\r\n\t\t\t\t\t_obj.value = item;\r\n\t\t\t\t\t_types.push(_obj);\r\n\t\t\t\t})\r\n\t\t\t\tscope.$parent.system_versions = _types;\r\n\t\t\t\tscope.$parent.system_version1 = _types[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = (scope.iso != undefined && scope.iso[0] != undefined);\r\n\t});\r\n\tvar newWindow;\r\n\tvar FLAG = false;\r\n\tfunction gotoUrl(val){\r\n\t\tif(val){\r\n\t\t\tnewWindow = window.open('templateModify.html#0');\r\n\t\t\t// newWindow = window.open('js/vdi-spice/spiceModify.html#?id=0');\r\n\t\t}\r\n\t}\r\n\tsetTimeout(function(){\r\n\t\t$(\"#finish\").on('click',function(){\r\n\t\t    gotoUrl(FLAG);\r\n\t\t})\r\n\t})\r\n\t\r\n\t$scope.$on(\"WizardStep_3\", function(e, step, scope){\r\n\t\tif(scope.step_pane3.$invalid){\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\tstep.done = false;\r\n\t\t}\r\n\t\telse if(scope.userPassword && scope.userPasswordConfirm && scope.userPassword !== scope.userPasswordConfirm){\r\n\t\t\tstep.done = false;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"两次输入密码不一致\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tstep.done = true;\r\n\t\tFLAG = step.done;\r\n\t});\r\n\t$scope.$on(\"WizardDone\", function(e, steps, scopes){\r\n\t\tvar auto_install = scopes[2].install === \"autoinstall\" ? true : false;\r\n\t\tvar _ip = scopes[0].bind_ip_type.value === 'static' ? scopes[0].$$childHead.bind_ip : undefined;\r\n\t\tvar testWin10 = /Windows10/;\r\n\t\tvar item = {\r\n\t\t\ttemplate_name: scopes[0].name,\r\n\t\t\tdescription: scopes[0].description,\r\n\t\t\towner: scopes[0].owner.id,\r\n\t\t\ttype_code : 1,\r\n\t\t\tvcpus: scopes[1].template.cpu_num,\r\n\t\t\tsystem_gb: scopes[1].template.system_gb,\r\n\t\t\tlocal_gb: scopes[1].template.local_gb,\r\n\t\t\tmemory_mb: scopes[1].template.memory_mb,\r\n\t\t\tiso_path:scopes[2].iso[0].name,\r\n\t\t\tiso_id:scopes[2].iso[0].id,\r\n\t\t\tos_type: scopes[3].system_version1.key,\r\n\t\t\tinstance_type: scopes[1].template.id,\r\n\t\t\tauto_install: auto_install,\r\n\t\t\tnetwork: scopes[0].network.id,\r\n\t\t\tsubnet: scopes[0].subnet?scopes[0].subnet.id:'',\r\n\t\t\tband_ip: _ip,\r\n\t\t\tband_type: scopes[0].bind_ip_type.value,\r\n\t\t\tkey:scopes[3].key,\r\n\t\t\tusername:scopes[3].userName,\r\n\t\t\tuserPassword:scopes[3].userPassword,\r\n\t\t\tuserPasswordConfirm:scopes[3].userPasswordConfirm,\r\n\t\t\tvirtual_type: scopes[0].type,\r\n\t\t\tenable_gpu: scopes[0].type == 'hyper-v'? scopes[0].enable_gpu:undefined,\r\n\t\t\tgpu_auto_assignment: scopes[0].type == 'kvm'? scopes[0].gpu_auto_assignment:undefined,\r\n\t\t\tfirmware_type: scopes[0].type == 'kvm' && testWin10.test(scopes[3].system_version1.key)?'uefi':undefined,\r\n\t\t\thost_uuid: scopes[0].host.host_uuid\r\n\t\t};\r\n\t\tfunction updateTem(isSuccess){\r\n\t\t\tteach.query(function(res){\r\n\t\t\t\tconsole.log(res, 'teachDesktop', item.virtual_type)\r\n\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\treturn item.virtual_type === scopes[0].type;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\r\n\t\t\t\t// if(!auto_install){\r\n\t\t\t\t\tvar template = $scope.rows.filter(function(temp){ return temp.name ==  item.template_name})[0];\r\n\t\t\t\t\tif(template && isSuccess){\r\n\t\t\t\t\t\tif(scopes[0].type == \"hyper-v\"){\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5 \r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModify_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModifybt_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModify.html#?id=' + template.id + '&os_type' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t\t// newWindow.location.reload();\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\tnewWindow.location.reload();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModifybt.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t// }\r\n\t\t\t});\r\n\t\t};\r\n\t\te.targetScope.currentStep.showLoading = true;\r\n\t\t$modalInstance.close();\r\n\t\tteach.save(item, function(res){ updateTem(true); }, function(){ newWindow.close(); updateTem(); }).$promise.finally(function(){\r\n\t\t\te.targetScope.currentStep.showLoading = false;\r\n\t\t});\r\n\t});\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.cpu_num = 1;\r\n}])\r\n\r\n.controller(\"registerTeachTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Admin\", \"registerTemplate\", \"TeachTemplate\", \"$$$os_types\", \"UserRole\",\"Network\", \"virtualHost\",\"networkWithHost\", \"$$$I18N\",\r\nfunction($scope, $modalInstance, admin, registerTemplate, teach, $$$os_types, UserRole, network, virtualHost, networkWithHost, $$$I18N){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;\r\n\t$scope.max_namelength=20;\r\n\t$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.type = '1';\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name === user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t})\r\n\t});\r\n\tregisterTemplate.query(function(res){\r\n\t\t$scope.sys_isos = res.system_image;\r\n\t\t$scope.sys_iso = res.system_image[0];\r\n\t\t$scope.old_data_isos = res.data_image;\r\n\t\tif($scope.sys_iso){\r\n\t\t\t$scope.getDataImgs($scope.sys_iso);\r\n\t\t}\r\n\t})\r\n\t$scope.filterDataISO = function(data_iso, data_iso2){\r\n\t\tif(data_iso){\r\n\t\t\t$scope.data_isos2 = $scope.data_isos.filter(function(item){ return item.name !== data_iso.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos2 = $scope.data_isos;\r\n\t\t}\r\n\t\tif(data_iso2){\r\n\t\t\t$scope.data_isos1 = $scope.data_isos.filter(function(item){ return item.name !== data_iso2.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos1 = $scope.data_isos;\r\n\t\t}\r\n\t};\r\n\t$scope.getDataImgs = function(systemImg, is_init){\r\n\t\tif(systemImg){\r\n\t\t\tthis.data_iso = undefined;\r\n\t\t\tthis.data_iso2 = undefined;\r\n\t\t\t$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function(item){ return item.virtual_type == systemImg.virtual_type });\r\n\t\t\t// $scope.data_iso = $scope.data_isos[0];\r\n\t\t\t// $scope.data_iso2 = $scope.data_isos[0];\r\n\t\t\t$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.getVirtualHost = function (type, rbd_enabled){\r\n\t\t$scope.host_loading = true;\r\n\t\tvirtualHost.query({\r\n\t\t\tvirtual_type: type,\r\n\t\t\trbd_enabled: rbd_enabled\r\n\t\t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n\t\t},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\tif(res.result.length === 0) {\r\n\t\t\t\tvar form = getRegisterTemplateForm();\r\n\t\t\t\tform.host.$setViewValue(\"\");\r\n\t\t\t}\r\n\t\t\t$scope.getNetwork($scope.host);\r\n\t\t},function(){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.os_types = $$$os_types.filter(function(item){ return item.key!==\"package\" });\r\n\t$scope.os_type = $scope.os_types[0];\r\n\t// $scope.enable_gpu = false;\r\n\t$scope.bind_ip = {value: null};\r\n\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t},function(){ $scope.network_loading = false; })\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar bindIP = this.bind_ip.value;\r\n\t\t// var unUseIP = this.band_ips.filter(function(item){ return item===bindIP });\r\n\t\t// if(this.bind_ip_type.value === 'static' && bindIP === '无可用IP'){\r\n\t\t// \t$.bigBox({\r\n\t\t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n\t\t// \t\ttimeout\t: 6000\r\n\t\t// \t});\r\n\t\t// }else if(this.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){\r\n\t\t// \t$.bigBox({\r\n\t\t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n\t\t// \t\ttimeout\t: 6000\r\n\t\t// \t});\r\n\t\t// }else{\r\n\t\t\t$scope.submiting = true ;\r\n\t\t\t$scope.afterSubmiting =false ;\r\n\t\t\tvar _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;\r\n\t\t\tvar postData = {\r\n\t\t\t\tsystem_image_file: this.sys_iso,\r\n\t\t\t\tdata_image_file: this.data_iso?this.data_iso:undefined,\r\n\t\t\t\tdata_image_file_2: this.data_iso2?this.data_iso2:undefined,\r\n\t\t\t\tname: this.name,\r\n\t\t\t\tdescription: this.description,\r\n\t\t\t\ttype_code: this.type,\r\n\t\t\t\tos: this.os_type.key,\r\n\t\t\t\tis_64: this.os_type.value.indexOf(\"64 bit\")>-1?true: false,\r\n\t\t\t\towner: this.owner.id,\r\n\t\t\t\tnetwork: this.network.id,\r\n\t\t\t\tsubnet: this.subnet?this.subnet.id:'',\r\n\t\t\t\tband_ip: _ip,\r\n\t\t\t\tband_type: this.bind_ip_type.value,\r\n\t\t\t\thost_uuid: this.host.host_uuid,\r\n\t\t\t\tusername: this.sys_iso.virtual_type=='hyper-v'?this.username:undefined,\r\n\t\t\t\tuserPassword: this.sys_iso.virtual_type=='hyper-v'?this.userPassword:undefined,\r\n\t\t\t\tuserPasswordConfirm: this.sys_iso.virtual_type=='hyper-v'?this.userPasswordConfirm:undefined\r\n\t\t\t\t// enable_gpu: this.sys_iso.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n\t\t\t};\r\n\t\t\tregisterTemplate.update(postData, function(res){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t\tteach.query(function(res){\r\n\t\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn item.virtual_type === $scope.select;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},function(){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t// }\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\tfunction getRegisterTemplateForm(){\r\n\t\tvar child = $scope.$$childHead;\r\n\t\tvar form = null;\r\n\t\twhile(child && !form) {\r\n\t\t\tform = child.registerTemplate;\r\n\t\t\tchild = child.$$nextSibling;\r\n\t\t}\r\n\t\treturn form;\r\n\t}\r\n}])\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controller.teach.js","angular.module(\"vdi.template.person\", [\"vdi.template\"])\r\n.factory(\"PersonTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/2\", isArray: false },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/modify_template/:id\", params: { id: \"@id\" } },\r\n\t\tlistModes:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" }, isArray: false },\r\n\t\tapplyTemplate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" } },\r\n\t\tstatus:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/status/:id\", params: { id: \"@id\" } },\r\n\t\tcopy:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/clone_template\"},\r\n\t\tmodify:\r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/image/2\", isArray: false },\r\n\t\tdownload:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/download/:id\", params: { id: \"@id\" } },\r\n\t\treset:\r\n\t\t\t{ method: \"post\", url: $Domain + \"/thor/image/reset_template\" },\r\n\t\tget_image_vnc_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_vnc_info\" },\r\n\t\tget_image_rdp_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_rdp_info\" },\r\n\t\tupdate_tpl_tip:\r\n\t\t\t{method:\"GET\",url:$Domain + \"/thor/controller/ha_storage_state\"}\r\n\t});\r\n}])\r\n\r\n.controller(\"vdiTemplatePresonalDesktopListController\",[\r\n\"$scope\", \"$modal\", \"TeachTemplate\", \"PersonTemplate\", \"Admin\", \"$interval\", \"$filter\", \"$$$os_types\", \"$Domain\", \"Network\", \"$$$I18N\", \"ResourcePool\", \"manageTemplate\", \"VMCommon\", \"networkWithHost\", \"virtualHost\",\"UserRole\", \r\nfunction($scope, $modal, template, tmpl, admin, $interval, $filter, $$$os_types, $Domain, network, $$$I18N, ResourcePool, manageTemplate, vm, networkWithHost, virtualHost, UserRole){\r\n\t$scope.domain = $Domain;\r\n\t$scope.rows = []; $scope.allrows = [];\r\n\tvar _controllerScope = $scope;\r\n\t$scope.loading = true;\r\n\tlet user = UserRole.currentUser;\r\n    $scope.currentPage = 1;\r\n    $scope.pagesizes = [30,20,10];\r\n    $scope.pagesize = $scope.pagesizes[0];\r\n\r\n    $scope.orders = [ {name: $$$I18N.get(\"按创建时间排序\"), val: 'time'}, {name: $$$I18N.get(\"按模板名称排序\"), val: 'name'}];\r\n    $scope.order = $scope.orders[0];\r\n    $scope.sortTem = function(val){\r\n    \tif(val == 'time'){\r\n    \t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n    \t}\r\n    \telse{\r\n    \t\t$scope.rows.sort(function(a,b){ return a.name>b.name? 1:-1 });\r\n    \t}\r\n    }\r\n\r\n\t$interval(function(){\r\n\t\t$scope.$root && $scope.$root.$broadcast(\"imageIDS\", $scope.rows && $scope.rows.map(function(item){ return item.id }));\r\n\t}, 1000);\r\n\t$scope.$on(\"imagesRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows && $scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.rows = $scope.rows.filter(function(item){ return item.type_code ===2 });\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tif(row.sync_status){\r\n\t\t\t\tvar updateInfor = row.sync_status.filter(function(item){ return item.type === \"image\" });\r\n\t\t\t\tif(updateInfor.length!==0)\r\n\t\t\t\t\trow.updateSize = (updateInfor[0].size/1024/1024/1024).toFixed(2);\t\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.$root.$broadcast(\"syncTempl\", $scope.rows);\r\n\t});\r\n\r\n\ttmpl.query(function(res){\r\n\t\t$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t});\r\n\t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t$scope.loading = false;\r\n\t\t$scope.personalNames = $scope.rows.map(function(item){ return item.name });\r\n\t\t$scope.sameName = false;\r\n\r\n\t\t$scope.allrows = $scope.rows;\r\n\t\tif($$$storage.getSessionStorage('virtual_type_P')!=='all')\r\n\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === $$$storage.getSessionStorage('virtual_type_P') });\r\n\t});\r\n\r\n\t$scope.select = $$$storage.getSessionStorage('virtual_type_P') || 'all';\r\n\t$scope.$watch(\"select\",function(newvalue){\r\n\t\tif(newvalue){\r\n\t\t\tif(newvalue!=='all'){\r\n\t\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === newvalue });\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t$scope.rows = $scope.allrows;\r\n\t\t\t}\r\n\t\t\t$$$storage.setSessionStorage('virtual_type_P', newvalue);\r\n\t\t}\r\n\t});\r\n\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除个人模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_P' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t$scope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttmpl.delete({ id: rows.map(function(item){ return item.id }) },function(res){\r\n\t                \ttmpl.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\ttmpl.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.shutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar rows_active = rows.filter(function(item){ return item.instance_status === 'running' });\r\n\t\tif(!rows_active.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"SHUTOFF_TIP\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='shutdown_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><img data-ng-if='loading' src='./img/building.gif' width='24px'><button class='btn btn-primary' data-ng-if='!loading' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t\t$scope.name = rows_active.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\t\tvm.shutdowns({ instance_ids: rows_active.map(function(item){ return item.instance_id }) },function(res){\r\n\t\t\t\t\t\t\trows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\t\tif(item.id === row.id){\r\n\t\t\t\t\t\t\t\t\t\titem.instance_status = \"shutdown\";\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize: \"sm\"\r\n\t\t\t});\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.copy = function(item){\r\n\t\t $modal.open({\r\n                templateUrl: \"views/vdi/dialog/template/template_copy.html\",\r\n                size: \"md\",\r\n                controller: [\"$scope\", \"$modalInstance\", function($scope, $modalInstance){\r\n                    $scope.min_namelength=2;$scope.max_namelength=20;\r\n                    $scope.is_copy = true;\r\n                    $scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n                    $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n                    $scope.types = $scope.types2;\r\n                    $scope.bind_ip_type = $scope.types2[0];\r\n                    admin.query(function(res){\r\n                        $scope.owners = res.users;\r\n                        angular.forEach($scope.owners, function(item){\r\n                        \tif(item.name == user.name){\r\n                        \t\t$scope.owner = item;\r\n                        \t}\r\n                        });\r\n                        if(!$scope.owner) {\r\n                        \t$scope.owner = $scope.users[0]\r\n                        }\r\n                    });\r\n                    $scope.type = '2';\r\n                    $scope.temCopy = false;\r\n\r\n                    $scope.temData = item;\r\n                    $scope.getVirtualHost = function (type,rbd_enabled){\r\n                    \t$scope.host_loading = true;\r\n                    \tvirtualHost.query({\r\n                    \t\tvirtual_type: type,\r\n                    \t\trbd_enabled: rbd_enabled\r\n                    \t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n                    \t},function(res){\r\n                    \t\t$scope.host_loading = false;\r\n                    \t\t$scope.hosts = res.result;\r\n                    \t\t$scope.host = $scope.hosts[0];\r\n                    \t\t$scope.getNetwork($scope.host);\r\n                    \t},function(){\r\n\r\n                    \t});\r\n                    }\r\n                    $scope.getVirtualHost(item.virtual_type,item.rbd_enabled);\r\n\r\n                    // function getIps(subnet_id, _scope){\r\n                    // \tif(subnet_id)\r\n                    // \t\tnetwork.ports({ id: subnet_id },function(res){\r\n                    // \t\t\t_scope.band_ips = res.unused_ips;\r\n                    // \t\t\t_scope.bind_ip = _scope.band_ips[0];\r\n                    // \t\t\t_scope.bind_ip_loading = false;\r\n                    // \t\t})\r\n                    // };\r\n                    $scope.switchIps = function(subnet,_scope){\r\n                    \t// _scope.bind_ip_loading = true;\r\n                    \tif(subnet){\r\n                    \t\t// getIps(subnet.id, _scope);\r\n                    \t\t_scope.types = _scope.types2;\r\n                    \t\t_scope.bind_ip_type = _scope.types2[0];\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.types = _scope.types1;\r\n                    \t\t_scope.band_ips = [];\r\n                    \t\t_scope.bind_ip_type = _scope.types1[0];\r\n                    \t\t// _scope.bind_ip_loading = false;\r\n                    \t}\r\n                    };\r\n                    function getSubnets(Network,_scope){\r\n                    \tif(Network.subnets.length){\r\n                    \t\t$scope.network_loading = true;\r\n                    \t\t// $scope.bind_ip_loading = true;\r\n                    \t\tnetwork.query_sub({id: Network.id }, function(res){\r\n                    \t\t\t_scope.subnets = res.result;\r\n                    \t\t\t_scope.subnet = _scope.subnets[0];\r\n                    \t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t\t\t$scope.network_loading = false;\r\n                    \t\t})\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.subnets = [];\r\n                    \t\t_scope.subnet = null;\r\n                    \t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t}\r\n                    };\r\n                    $scope.getNetwork = function(host){\r\n                    \tif(host){\r\n                    \t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n                    \t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n                    \t\t\t$scope.networks = res.result;\r\n                    \t\t\t$scope.network = $scope.networks[0];\r\n                    \t\t\tgetSubnets($scope.network, $scope);\r\n                    \t\t}, function(){});\r\n                    \t}\r\n                    }\r\n                    $scope.switchSubnet = function(val, _scope){\r\n                    \tgetSubnets(val,_scope);\r\n                    }\r\n                    $scope.ok = function(){\r\n                \t\t$scope.temCopy = true;\r\n                \t\tvar _ip = this.bind_ip_type.value === 'static' ? this.bind_ip.value : undefined;\r\n                        tmpl.copy({\r\n                    \t\tname: this.name,\r\n                    \t\tdescription: this.description,\r\n                    \t\timage_id : item.id,\r\n                    \t    type_code: this.type,\r\n                    \t    owner: $scope.owner.id,\r\n                    \t    network: this.network.id,\r\n                    \t    subnet: this.subnet?this.subnet.id:\"\",\r\n                    \t    band_ip: _ip,\r\n                    \t    band_type: this.bind_ip_type.value,\r\n                    \t    host_uuid: this.host.host_uuid\r\n                    \t    // enable_gpu: item.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n                        }, function(res){\r\n                        \ttmpl.query(function(res){\r\n                        \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n        \t\t\t\t\t\t\t\treturn item;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t\telse{\r\n        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t});\r\n                        \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                        \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                        \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                        \t});\r\n                        \t$modalInstance.close();\r\n                        }, function(){\r\n                        \t$scope.temCopy = false;\r\n                        });\r\n                    \t}\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    };\r\n                } ]\r\n            });\r\n\t};\r\n\t$scope.modify = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_modify.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t\t\t\t$scope.types = $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t\t\t\t$scope.virtual_type = item.virtual_type;\r\n\t\t\t\t$scope.disabled_gpu = item.disabled_gpu;\r\n\t\t\t\t$scope.data = {vcpus: 1, ram: 1.5, system_alloc_disk: 10, bind_ip_type: $scope.types2[1]};\r\n\t\t\t\tvar oldData = {};\r\n\t\t\t\tfunction getSubnets(Network, subnet_id, flag){\r\n\t\t\t\t\tif(Network.subnets.length){\r\n\t\t\t\t\t\t$scope.network_loading = true;\r\n\t\t\t\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t\t\t\t$scope.data.subnets = res.result;\r\n\t\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\t\toldData.subnets = $scope.data.subnets;\r\n\t\t\t\t\t\t\t\toldData.subnet = $scope.data.subnet = $scope.data.subnets.filter(function(data){ return data.id === subnet_id })[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = $scope.data.subnets[0];\r\n\t\t\t\t\t\t\t\tif($scope.data.subnet)\r\n\t\t\t\t\t\t\t\t\tgetIps($scope.data.subnet.id, $scope.cur_imgInfor.nets.ip_address, false);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$scope.network_loading = false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.data.subnets = [];\r\n\t\t\t\t\t\t$scope.data.subnet = null;\r\n\t\t\t\t\t\t$scope.switchIps($scope.data.subnet);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tfunction getIps(subnet_id, curr_ip, flag){\r\n\t\t\t\t\tif(subnet_id){\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];\r\n\t\t\t\t\t\t\toldData.band_ips = $scope.data.band_ips;\r\n\t\t\t\t\t\t\toldData.band_ip = $scope.data.band_ip = curr_ip;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.switchSubnet = function(val){\r\n\t\t\t\t\tgetSubnets(val, $scope.cur_imgInfor.nets.network_id, false);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.switchIps = function(subnet){\r\n\t\t\t\t\tif(subnet)\r\n\t\t\t\t\t\tgetIps(subnet.id,$scope.cur_imgInfor.nets.ip_address, false)\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.addbtndisk = function(){\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.minusbtndisk = function(){\r\n\t\t\t\t\tif($scope.old_data_alloc_disk && !$scope.old_data_alloc_disk_2){\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t};\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(templateInfor){\r\n\t\t\t\t\t$scope.cur_imgInfor = templateInfor;\r\n\t\t\t\t\toldData.name = $scope.data.name = templateInfor.name;\r\n\t\t\t\t\toldData.description = $scope.data.description = templateInfor.description;\r\n\t\t\t\t\tgetIps(templateInfor.nets[0].subnet_id, templateInfor.nets[0].ip_address, true);\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t// $scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t\t\t$scope.networks = data.networks;\r\n\t\t\t\t\t\toldData.network = $scope.data.network = $scope.networks.filter(function(data){ return data.id===templateInfor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tgetSubnets($scope.data.network,templateInfor.nets[0].subnet_id, true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\toldData.enable_gpu = $scope.data.enable_gpu= templateInfor.enable_gpu;\r\n\t\t\t\t\toldData.vcpus = $scope.data.vcpus= templateInfor.vcpus;\r\n\t\t\t\t\toldData.ram = $scope.data.ram= templateInfor.ram/1024;\r\n\t\t\t\t\toldData.system_alloc_disk = $scope.data.system_alloc_disk= templateInfor.system_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk = $scope.data.data_alloc_disk= templateInfor.data_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk_2 = $scope.data.data_alloc_disk_2= templateInfor.data_alloc_disk_2;\r\n\t\t\t\t\t$scope.old_data_alloc_disk = templateInfor.data_alloc_disk;\r\n\t\t\t\t\t$scope.old_data_alloc_disk_2 = templateInfor.data_alloc_disk_2;\r\n\t\t\t\t})\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\t$scope.oldData = angular.copy($scope.data);\r\n\t\t\t\t$scope.isUnchanged = function(){\r\n\t\t\t\t\treturn angular.equals(oldData,$scope.data)\r\n\t\t\t\t}\r\n\t\t\t\t$scope.reset = function(){\r\n\t\t\t\t\tif(oldData.bind_ip_type.value!=='none'){\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.data = angular.copy(oldData);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t// if($scope.data.system_alloc_disk < oldData.system_alloc_disk || $scope.data.data_alloc_disk_2 < oldData.data_alloc_disk_2 || $scope.data.data_alloc_disk < oldData.data_alloc_disk){\r\n\t\t\t\t\t// \t$.bigBox({\r\n\t\t\t\t\t// \t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t// \t\t\tcontent : $$$I18N.get(\"modifyTemTip\"),\r\n\t\t\t\t\t// \t\t\ttimeout : 6000\r\n\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t// else{\r\n\t\t\t\t\t\t$scope.submit_loading = true;\r\n\t\t\t\t\t\ttmpl.modify({\r\n\t\t\t\t\t\t\timage_id: item.id,\r\n\t\t\t\t\t\t\tinstance_id: item.instance_id,\r\n\t\t\t\t\t\t\ttemplate_name: $scope.data.name,\r\n\t\t\t\t\t\t\tdescription: $scope.data.description,\r\n\t\t\t\t\t\t\tnetwork: $scope.data.network.id,\r\n\t\t\t\t\t\t\tsubnet: $scope.data.subnet?$scope.data.subnet.id:\"\",\r\n\t\t\t\t\t\t\tband_ip: $scope.data.bind_ip_type.value === 'static' ? $scope.data.band_ip:undefined,\r\n\t\t\t\t\t\t\tband_type: $scope.data.bind_ip_type.value,\r\n\t\t\t\t\t\t\tvcpus: $scope.data.vcpus,\r\n\t\t\t\t\t\t\tram: $scope.data.ram,\r\n\t\t\t\t\t\t\tenable_gpu: item.virtual_type=='hyper-v' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tgpu_auto_assignment: item.virtual_type=='kvm' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tsystem_alloc_disk: $scope.data.system_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk: $scope.data.data_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk_2: $scope.data.data_alloc_disk_2\r\n\t\t\t\t\t\t}, function(res){\r\n\t\t\t\t\t\t\t$scope.submit_loading = false;\r\n\t\t\t\t\t\t\ttmpl.query(function(res){\r\n\t                    \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n        \t\t\t\t\t\t\t\treturn item;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t\telse{\r\n        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t});\r\n\t                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t                    \t});\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t},function(){ $scope.submit_loading = false; });\r\n\t\t\t\t\t// }\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.resetTemp = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重置模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='REST_TEMP_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttmpl.reset({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.imgManage = function(IMG){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_imgManage.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.imgType = IMG.virtual_type;\r\n\t\t\t\tfunction formLocalData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.host_ip]){\r\n\t\t\t\t\t\t\tlet obj = {host_ip: item.host_ip, hostname: item.hostname, resource_pool_uuid: item.resource_pool_uuid, storages: []};\r\n\t\t\t\t\t\t\tarry[item.host_ip] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet hostArry = dataResource.filter(function(data){ return data.host_ip == item.host_ip });\r\n\t\t\t\t\t\thostArry.forEach(function(data){\r\n\t\t\t\t\t\t\tif(!item.storages[data.storage_name]){\r\n\t\t\t\t\t\t\t\tlet obj = {storage_name: data.storage_name, storage_uuid: data.storage_uuid, storage_type: data.storage_type, imgs: []};\r\n\t\t\t\t\t\t\t\titem.storages[data.storage_name] = obj;\r\n\t\t\t\t\t\t\t\titem.storages.push(obj);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\titem.storages.forEach(function(data){\r\n\t\t\t\t\t\t\tlet storageArry = dataResource.filter(function(d){ return item.host_ip == d.host_ip && d.storage_name == data.storage_name });\r\n\t\t\t\t\t\t\tstorageArry.forEach(function(d){\r\n\t\t\t\t\t\t\t\tdata.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\titem.storages.sort(function(a,b){ return a.storage_name>b.storage_name?1:-1 });\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction formRemoteData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.storage_name+\"_remote\"]){\r\n\t\t\t\t\t\t\tlet obj = {storage_name: item.storage_name, storage_uuid: item.storage_uuid, storage_type: item.storage_type, host_ip: item.host_ip, imgs: []};\r\n\t\t\t\t\t\t\tarry[item.storage_name+\"_remote\"] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet imgArry = dataResource.filter(function(d){ return item.storage_name == d.storage_name });\r\n\t\t\t\t\t\timgArry.forEach(function(d){\r\n\t\t\t\t\t\t\titem.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction getLocal(resource_pool_uuid){\r\n\t\t\t\t\t$scope.local_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: resource_pool_uuid},function(res){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t\t$scope.locals = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tfunction getRemote(){\r\n\t\t\t\t\t$scope.remote_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\tconsole.log(res.result);\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t\t$scope.remotes = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tvar new_pool = {};\r\n\t\t\t\tgetRemote();\r\n\t\t\t\tResourcePool.query(function(res){\r\n\t\t\t\t\t$scope.pools = res.result.filter(function(p){ return p.type == IMG.virtual_type });\r\n\t\t\t\t\tnew_pool = $scope.pool = $scope.pools[0];\r\n\t\t\t\t\tgetLocal($scope.pool.uuid);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$scope.getlocalImages = function(pool){\r\n\t\t\t\t\tnew_pool = pool;\r\n\t\t\t\t\tgetLocal(pool.uuid);\r\n\t\t\t\t};\r\n\t\t\t\t$scope.$on(\"syncTempl\", function($event, data){\r\n\t\t\t\t\tvar updateVolume = data.filter(function(item){ return item.id==IMG.id })[0].volume;\r\n\t\t\t\t\tif(updateVolume.length!==0){\r\n\t\t\t\t\t\tupdateVolume.forEach(function(volume){\r\n\t\t\t\t\t\t\tif(volume.storage_type=='local'){\r\n\t\t\t\t\t\t\t\t$scope.locals && $scope.locals.forEach(function(local){\r\n\t\t\t\t\t\t\t\t\tlocal.storages.forEach(function(storage){\r\n\t\t\t\t\t\t\t\t\t\tstorage.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.remotes && $scope.remotes.forEach(function(remote){\r\n\t\t\t\t\t\t\t\t\tremote.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t$scope.sendImg = function(storage_type, resource_pool_uuid, image_type, image_uuid, storage_uuid, img, pool){\r\n\t\t\t\t\timg.volume_status = 'sending';\r\n\t\t\t\t\tmanageTemplate.handout({\r\n\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\tresource_pool_uuid: storage_type=='local'?resource_pool_uuid:undefined,\r\n\t\t\t\t\t\timage_type: image_type,\r\n\t\t\t\t\t\timage_uuid: image_uuid,\r\n\t\t\t\t\t\tstorage_uuid: storage_uuid,\r\n\t\t\t\t\t\tstorage_type: storage_type\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\tif(storage_type=='local'){\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: pool.uuid},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.locals.splice(0, $scope.locals.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.locals,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.remotes.splice(0, $scope.remotes.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.remotes,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t// img.status = 'sended failed';\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\t$scope.deleteImg = function(storage_type, volume_uuid, img, storage_uuid, pool){\r\n\t\t\t\t\tif(!img.has_instance){\r\n\t\t\t\t\t\timg.volume_status = 'deleting';\r\n\t\t\t\t\t\tmanageTemplate.delete({\r\n\t\t\t\t\t\t\tstorage_type: storage_type,\r\n\t\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\t\tvolume_uuid: volume_uuid,\r\n\t\t\t\t\t\t\timage_uuid: img.image_uuid,\r\n\t\t\t\t\t\t\tstorage_uuid: storage_uuid\r\n\t\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t\timg.volume_status = 'delete failed';\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.detail = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_detail.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(infor){\r\n\t\t\t\t\t$scope.data = infor;\r\n\t\t\t\t\tfunction formData(obj){\r\n\t\t\t\t\t\tobj.imgs = [];\r\n\t\t\t\t\t\tfor(var i in obj){\r\n\t\t\t\t\t\t\tif(i!=='imgs'){\r\n\t\t\t\t\t\t\t\tvar img = {};\r\n\t\t\t\t\t\t\t\timg.location = i;\r\n\t\t\t\t\t\t\t\timg.volumeId = obj[i];\r\n\t\t\t\t\t\t\t\tobj.imgs.push(img);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tfor(var i in $scope.data.inst_volumes){\r\n\t\t\t\t\t\tformData($scope.data.inst_volumes[i]);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t$scope.data.network = data.networks.filter(function(data){ return data.id===infor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tif(infor.nets[0].subnet_id){\r\n\t\t\t\t\t\t\tnetwork.query_sub({id: infor.nets[0].network_id }, function(res){\r\n\t\t\t\t\t\t\t\tvar subnet = res.result.filter(function(data){ return data.id === infor.nets[0].subnet_id })[0];\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = subnet.name +\" (\"+ subnet.start_ip + \"~\" + subnet.end_ip +\")\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}, function(){});\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}])\r\n\r\n.controller(\"addPersonalTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"PersonTemplate\", \"HardwareTemplate\", \"SystemISO\", \"Admin\", \"$$$os_types\",\"$$$I18N\", \"UserRole\",\"Network\", \"virtualHost\", \"networkWithHost\", \"checkIP\",\r\nfunction($scope, $modalInstance, personal, hardware, iso, admin, $$$os_types,$$$I18N, UserRole, network, virtualHost, networkWithHost, checkIP){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.auto_isos = [];$scope.all_isos = [];\r\n\t$scope.iso = [];\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name == user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t});\r\n\t\tif(!$scope.owner) $scope.owner = $scope.users[0]\r\n\t});\r\n\thardware.query(function(res){\r\n\t\t$scope.hardware_templates = res.result;\r\n\t\t$scope.template = $scope.hardware_templates[0];\r\n\t});\r\n\tiso.query(function(res){\r\n\t\t$scope.all_isos = res.isos.filter(function(iso){ return iso.type && iso.type!==\"package\" && iso.type!==\"other\"; });\r\n\t\t$scope.all_isos.forEach(function(item){\r\n\t\t\titem.os_type = item.os_type.split(\",\");\r\n\t\t});\r\n\t\t$scope.isos = $scope.all_isos;\r\n\t\t$scope.iso = [$scope.isos[0]];\r\n\t\tangular.forEach($scope.isos, function(item){\r\n\t\t\tif(item.support_auto_install == true)\r\n\t\t\t\t$scope.auto_isos.push(item);\r\n\t\t})\r\n\t});\r\n\r\n\t$scope.type = 'kvm';\r\n\t$scope.enable_gpu = false;\r\n\t$scope.getVirtualHost = function (type){\r\n\t\tvar _this = this;\r\n\t\t$scope.host_loading = true;\r\n\t\tvar data = {};\r\n\t\tdata.type = type;\r\n\t\tif(type=='hyper-v'){\r\n\t\t\tdata.enable_gpu = _this.enable_gpu;\r\n\t\t\t_this.gpu_auto_assignment = false;\r\n\t\t}else{\r\n\t\t\tdata.enable_gpu = _this.gpu_auto_assignment;\r\n\t\t\t_this.enable_gpu = false;\r\n\t\t}\r\n\t\tvirtualHost.query(data,function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t_this.host = $scope.hosts[0];\r\n\t\t\t_this.host && $scope.getNetwork(_this.host);\r\n\t\t},function(){\r\n\r\n\t\t});\r\n\t}\r\n\t$scope.getVirtualHost($scope.type);\r\n\t\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip = _scope.band_ips[0];\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\r\n\t\t}\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\t$scope.names = $scope.rows.map(function(item){ return item.name });\r\n\t$scope.sameName = false;\r\n\tvar _scope = $scope;\r\n\t$scope.install = \"manualinstall\";\r\n\t$scope.isOther = false;\r\n\t$scope.$on(\"selectStepChange\", function(e, arg){\r\n\t\tif(arg.index==0){\r\n\t\t\targ.stepScope.$$nextSibling.error = false;\r\n\t\t}\r\n\t})\r\n\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\t_scope.type = scope.type;\r\n\t\tvar flag = false;\r\n\t\t_scope.names.forEach(function(item){\r\n\t\t\tif(scope.name == item){ flag = true; }\r\n\t\t})\r\n\t\tif(flag){\r\n\t\t\t_scope.sameName = true;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"WRONG_NAME\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse { _scope.sameName = false; }\r\n\t\tstep.done = !scope.step_pane0.$invalid && !_scope.sameName && !scope.network_loading;\r\n\r\n\t\tif(step.done && scope.$$childTail && scope.$$childTail.bind_ip){\r\n\t\t\tstep.showLoading = true;\r\n\t\t\tstep.done = false;\r\n\t\t\tcheckIP.check({ip: scope.$$childTail.bind_ip, subnet_id: scope.subnet.id},function(res){\r\n\t\t\t\tif(!res.result){\r\n\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n\t\t\t\t\t\ttimeout\t: 6000\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.$broadcast(\"currentStepChange\", 1);\r\n\t\t\t\t}\r\n\t\t\t\tstep.showLoading = false;\r\n\t\t\t},function(error){ step.showLoading = false; });\r\n\t\t}\r\n\t});\r\n\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\tif(scope.template.system_gb == 0)\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent\t: $$$I18N.get(\"模板系统盘不能为0\"),\r\n\t\t\t\t\tcolor\t: \"#C46A69\",\r\n\t\t\t\t\ticon\t: \"fa fa-warning shake animated\",\r\n\t\t\t\t\ttimeout\t: 6000\r\n\t\t\t\t});\r\n\t\tstep.done = !(scope.template.system_gb == 0);\r\n\t});\r\n\t$scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n\t\tsetTimeout(function(){\r\n\t\t\t$(\"[rel=popover-hover]\").popover({\r\n\t\t\t\ttrigger : \"hover\"\r\n\t\t\t});\r\n\t\t})\r\n\t\t_scope.install = scope.install;\r\n\t\tif(scope.iso != undefined && scope.iso[0] != undefined){\r\n\t\t\tif(scope.iso[0].os_type[0] == 'other'){\r\n\t\t\t\t_scope.isOther = true;\r\n\t\t\t\tscope.$parent.system_versions = $$$os_types;\r\n\t\t\t\tscope.$parent.system_version1 = scope.$parent.system_versions[0];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tvar _types = [];\r\n\t\t\t\tscope.iso[0].os_type.forEach(function(item){\r\n\t\t\t\t\tvar _obj = {};\r\n\t\t\t\t\t_obj.key = item;\r\n\t\t\t\t\t_obj.value = item;\r\n\t\t\t\t\t_types.push(_obj);\r\n\t\t\t\t})\r\n\t\t\t\tscope.$parent.system_versions = _types;\r\n\t\t\t\tscope.$parent.system_version1 = _types[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = (scope.iso != undefined && scope.iso[0] != undefined);\r\n\t\t\r\n\t});\r\n\tvar newWindow;\r\n\tvar FLAG = false;\r\n\tfunction gotoUrl(val){\r\n\t\tif(val){\r\n\t\t\tnewWindow = window.open('templateModify.html#0');\r\n\t\t\t// newWindow = window.open('js/vdi-spice/spiceModify.html#?id=0');\r\n\t\t}\r\n\t}\r\n\tsetTimeout(function(){\r\n\t\t$(\"#finish\").on('click',function(){\r\n\t\t    gotoUrl(FLAG);\r\n\t\t})\r\n\t})\r\n\r\n\t$scope.$on(\"WizardStep_3\", function(e, step, scope){\r\n\t\tif(scope.step_pane3.$invalid){\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\tstep.done = false;\r\n\t\t}\r\n\t\telse if(scope.userPassword && scope.userPasswordConfirm && scope.userPassword !== scope.userPasswordConfirm){\r\n\t\t\tstep.done = false;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"两次输入密码不一致\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tstep.done = true;\r\n\t\tFLAG = step.done;\r\n\t});\r\n\t$scope.$on(\"WizardDone\", function(e, steps, scopes){\r\n\t\tvar auto_install = scopes[2].install === \"autoinstall\" ? true : false;\r\n\t\tvar _ip = scopes[0].bind_ip_type.value === 'static' ? scopes[0].$$childHead.bind_ip : undefined;\r\n\t\tvar testWin10 = /Windows10/;\r\n\t\tvar item = {\r\n\t\t\ttemplate_name: scopes[0].name,\r\n\t\t\tdescription: scopes[0].description,\r\n\t\t\towner: scopes[0].owner.id,\r\n\t\t\ttype_code : 2,\r\n\t\t\tvcpus: scopes[1].template.cpu_num,\r\n\t\t\tsystem_gb: scopes[1].template.system_gb,\r\n\t\t\tlocal_gb: scopes[1].template.local_gb,\r\n\t\t\tmemory_mb: scopes[1].template.memory_mb,\r\n\t\t\tiso_path:scopes[2].iso[0].name,\r\n\t\t\tiso_id:scopes[2].iso[0].id,\r\n\t\t\tos_type: scopes[3].system_version1.key,\r\n\t\t\tinstance_type: scopes[1].template.id,\r\n\t\t\tauto_install: auto_install,\r\n\t\t\tnetwork: scopes[0].network.id,\r\n\t\t\tsubnet: scopes[0].subnet?scopes[0].subnet.id:'',\r\n\t\t\tband_ip: _ip,\r\n\t\t\tband_type: scopes[0].bind_ip_type.value,\r\n\t\t\tkey:scopes[3].key,\r\n\t\t\tusername:scopes[3].userName,\r\n\t\t\tuserPassword:scopes[3].userPassword,\r\n\t\t\tuserPasswordConfirm:scopes[3].userPasswordConfirm,\r\n\t\t\tvirtual_type: scopes[0].type,\r\n\t\t\tenable_gpu: scopes[0].type == 'hyper-v'? scopes[0].enable_gpu:undefined,\r\n\t\t\tgpu_auto_assignment: scopes[0].type == 'kvm'? scopes[0].gpu_auto_assignment:undefined,\r\n\t\t\tfirmware_type: scopes[0].type == 'kvm' && testWin10.test(scopes[3].system_version1.key)?'uefi':undefined,\r\n\r\n\t\t\thost_uuid: scopes[0].host.host_uuid\r\n\t\t};\r\n\t\tfunction updateTem(isSuccess){\r\n\t\t\tpersonal.query(function(res){\r\n\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\treturn item.virtual_type === scopes[0].type;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t// if(!auto_install){\r\n\t\t\t\t\tvar template = $scope.rows.filter(function(temp){ return temp.name ==  item.template_name})[0];\r\n\t\t\t\t\tif(template && isSuccess){\r\n\t\t\t\t\t\tif(scopes[0].type == \"hyper-v\"){\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t\tnewWindow.location.reload();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// if(scopes[0].type == \"hyper-v\"){\r\n\t\t\t\t\t\t// \tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModify_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModifybt_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t// else{\r\n\t\t\t\t\t\t// \tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t// newWindow.location.reload();\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModify.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t\tnewWindow.location.reload();\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModifybt.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t}\r\n\t\t\t\t// }\r\n\t\t\t});\r\n\t\t};\r\n\t\te.targetScope.currentStep.showLoading = true;\r\n\t\t$modalInstance.close();\r\n\t\tpersonal.save(item, function(res){ updateTem(true); }, function(){ newWindow.close(); updateTem(); }).$promise.finally(function(){\r\n\t\t\te.targetScope.currentStep.showLoading = false;\r\n\t\t});;\r\n\t});\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.cpu_num = 1;\r\n}])\r\n\r\n.controller(\"registerPersonalTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Admin\", \"registerTemplate\", \"PersonTemplate\", \"$$$os_types\", \"UserRole\", \"Network\", \"virtualHost\",\"networkWithHost\", \"$$$I18N\",\r\nfunction($scope, $modalInstance, admin, registerTemplate, personal, $$$os_types, UserRole, network, virtualHost, networkWithHost, $$$I18N){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.type = '2';\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name === user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t})\r\n\t});\r\n\tregisterTemplate.query(function(res){\r\n\t\t$scope.sys_isos = res.system_image;\r\n\t\t$scope.sys_iso = res.system_image[0];\r\n\t\t$scope.old_data_isos = res.data_image;\r\n\t\tif($scope.sys_iso){\r\n\t\t\t$scope.getDataImgs($scope.sys_iso);\r\n\t\t}\r\n\t})\r\n\t$scope.filterDataISO = function(data_iso, data_iso2){\r\n\t\tif(data_iso){\r\n\t\t\t$scope.data_isos2 = $scope.data_isos.filter(function(item){ return item.name !== data_iso.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos2 = $scope.data_isos;\r\n\t\t}\r\n\t\tif(data_iso2){\r\n\t\t\t$scope.data_isos1 = $scope.data_isos.filter(function(item){ return item.name !== data_iso2.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos1 = $scope.data_isos;\r\n\t\t}\r\n\t};\r\n\t$scope.getDataImgs = function(systemImg){\r\n\t\tif(systemImg){\r\n\t\t\tthis.data_iso = undefined;\r\n\t\t\tthis.data_iso2 = undefined;\r\n\t\t\t$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function(item){ return item.virtual_type == systemImg.virtual_type });\r\n\t\t\t// $scope.data_iso = $scope.data_isos[0];\r\n\t\t\t// $scope.data_iso2 = $scope.data_isos[0];\r\n\t\t\t$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.getVirtualHost = function (type, rbd_enabled){\r\n\t\t$scope.host_loading = true;\r\n\t\tvirtualHost.query({\r\n\t\t\tvirtual_type: type,\r\n\t\t\trbd_enabled: rbd_enabled\r\n\t\t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n\t\t},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\t$scope.getNetwork($scope.host);\r\n\t\t},function(){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.os_types = $$$os_types.filter(function(item){ return item.key!==\"package\" });\r\n\t$scope.os_type = $scope.os_types[0];\r\n\t// $scope.enable_gpu = false;\r\n\t$scope.bind_ip = {value: null};\r\n\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip = _scope.band_ips[0];\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope)\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t}, function(){ $scope.network_loading = false; })\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar bindIP = this.bind_ip.value;\r\n\t\t// if(this.bind_ip_type.value === 'static' && this.bind_ip === '无可用IP'){\r\n\t\t// \t$.bigBox({\r\n\t\t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n\t\t// \t\ttimeout\t: 6000\r\n\t\t// \t});\r\n\t\t// }\r\n\t\t// else{\r\n\t\t\t$scope.submiting = true ;\r\n\t\t\t$scope.afterSubmiting =false ;\r\n\t\t\tvar _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;\r\n\t\t\tvar postData = {\r\n\t\t\t\tsystem_image_file: this.sys_iso,\r\n\t\t\t\tdata_image_file: this.data_iso?this.data_iso:undefined,\r\n\t\t\t\tdata_image_file_2: this.data_iso2?this.data_iso2:undefined,\r\n\t\t\t\tname: this.name,\r\n\t\t\t\tdescription: this.description,\r\n\t\t\t\ttype_code: this.type,\r\n\t\t\t\tos: this.os_type.key,\r\n\t\t\t\tis_64: this.os_type.value.indexOf(\"64 bit\")>-1?true: false,\r\n\t\t\t\towner: this.owner.id,\r\n\t\t\t\tnetwork: this.network.id,\r\n\t\t\t\tsubnet: this.subnet?this.subnet.id:'',\r\n\t\t\t\tband_ip: _ip,\r\n\t\t\t\tband_type: this.bind_ip_type.value,\r\n\t\t\t\thost_uuid: this.host.host_uuid,\r\n\t\t\t\tusername: this.sys_iso.virtual_type=='hyper-v'?this.username:undefined,\r\n\t\t\t\tuserPassword: this.sys_iso.virtual_type=='hyper-v'?this.userPassword:undefined,\r\n\t\t\t\tuserPasswordConfirm: this.sys_iso.virtual_type=='hyper-v'?this.userPasswordConfirm:undefined\r\n\t\t\t\t// enable_gpu: this.sys_iso.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n\t\t\t};\r\n\t\t\tconsole.log(postData)\r\n\t\t\tregisterTemplate.update(postData, function(res){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t\tpersonal.query(function(res){\r\n\t\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn item.virtual_type === $scope.select;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},function(){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t// }\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controller.person.js","angular.module(\"vdi.template.hardware\", [\"vdi.template\"])\r\n\r\n.factory(\"HardwareTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/hardwares\", isArray: false },\r\n\t\t\"delete\":\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/image/hardwares\" },\r\n\t\tsave:\r\n\t\t\t{ method: \"POST\",url: $Domain + \"/thor/image/hardwares\" },\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/hardwares/:id\", params: { id: \"@id\"}, isArray: false },\r\n\t\tupdate:\r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/image/hardware/:id\", params: { id: \"@id\"}, isArray: false },\r\n\t\t// 过滤模板\r\n\t\tfilter:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/image/hardwares\"}\r\n\t});\r\n}])\r\n\r\n.controller(\"vdiTemplateHardwareListController\", [\"$scope\", \"$modal\", \"HardwareTemplate\", function($scope, $modal, hardware){\r\n\t$scope.rows = [];\r\n\t$scope.loading = true;\r\n\tvar _controllerScope = $scope;\r\n\thardware.query(function(res){\r\n\t\t$scope.rows = res.result;\r\n\t\t$scope.loading = false;\r\n\t});\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesizes = [30,20,10];\r\n    $scope.pagesize = $scope.pagesizes[0];\r\n\t\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除硬件模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_H' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\thardware.delete(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"instance_type_id\": rows.map(function(item){ return item.id })\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(){\r\n\t\t\t\t\t\t\thardware.query(function(res){\r\n\t\t\t\t\t\t\t\tvar newRows = res.result;\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(error){\r\n\t\t\t\t\t\t\thardware.query(function(res){\r\n\t\t\t\t\t\t\t\tvar newRows = res.result;\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n}])\r\n\r\n.controller(\"addHardwareTemplateDialog\", [\"$scope\", \"$modalInstance\",\"HardwareTemplate\",function($scope,$modalInstance,hardware){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.data = {\r\n\t\tcpu_num:1,\r\n\t\tmemory_mb:1,\r\n\t\tsystem_gb:10\r\n\t\t// system_disk_type: \"2\",\r\n\t\t// local_disk_type: \"3\"\r\n\t};\r\n\t$scope.btndisks = [];\r\n\t// $scope.data.system_disk_type = \"2\";$scope.data.local_disk_type = \"3\";\r\n\tvar _controllerScope = $scope;\r\n\t$scope.ok = function(){\r\n\t\tvar _this = this;\r\n\t\thardware.save({\r\n\t\t\t\t\"name\" : this.data.name,\r\n\t\t\t\t\"cpu_num\" : this.data.cpu_num,\r\n\t\t\t\t\"memory_mb\": this.data.memory_mb*1024,\r\n\t\t\t\t\"system_gb\" :this.data.system_gb,\r\n\t\t\t\t\"local_gb\" : this.btndisks[0]?this.btndisks[0].local_gb:0,\r\n\t\t\t\t\"local_gb1\" : this.btndisks[1]?this.btndisks[1].local_gb:0\r\n\t\t\t\t// \"system_disk_type\": this.data.system_disk_type,\r\n\t\t\t\t// \"local_disk_type\": this.data.local_disk_type\r\n\t\t\t},\r\n\t\t\tfunction(data){\r\n\t\t\t\t// $scope.rows.unshift({\r\n\t\t\t\t// \tid: data.id,\r\n\t\t\t\t// \tname : _this.data.name,\r\n\t\t\t\t// \tcpu_num : _this.data.cpu_num,\r\n\t\t\t\t// \tmemory_mb: _this.data.memory_mb*1024,\r\n\t\t\t\t// \tsystem_gb : _this.data.system_gb,\r\n\t\t\t\t// \tlocal_gb : _this.data.local_gb,\r\n\t\t\t\t// \t\"system_disk_type\": _this.data.system_disk_type,\r\n\t\t\t\t// \t\"local_disk_type\": _this.data.local_disk_type\r\n\t\t\t\t// });\r\n\t\t\t\thardware.query(function(res){\r\n\t\t\t\t\tvar newRows = res.result;\r\n\t\t\t\t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\r\n\t$scope.addbtndisk = function(){\r\n\t\t$scope.btndisks.push({local_gb: 5});\r\n\t};\r\n\t$scope.minusbtndisk = function(){\r\n\t\t// var idx = $scope.btndisks.indexOf(i)\r\n\t\t$scope.btndisks.splice($scope.btndisks.length-1,1);\r\n\t};\r\n\t\r\n}])\r\n\r\n.controller(\"editHardwareTemplateDialog\", [\"$scope\", \"$modalInstance\",\"HardwareTemplate\", function($scope, $modalInstance, hardware){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\t$scope.data = angular.copy(item);\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data = angular.copy($scope.item || $scope.currentItem);\r\n\t};\r\n\t$scope.edit = function(){\r\n\t\thardware.update(\r\n\t\t\t$scope.data,\r\n\t\t\tfunction(res){\r\n\t\t\t\titem.name = res.name;\r\n\t\t\t\titem.cpu_num = res.cpu_num;\r\n\t\t\t\titem.memory_mb = res.memory_mb;\r\n\t\t\t\titem.local_gb = res.local_gb;\r\n\t\t\t\titem.system_gb = res.system_gb;\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},\r\n\t\t\tfunction(){\r\n\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\r\n\t$scope.useNum=\"1\"\r\n\t$scope.btndisks = [];\r\n\t$scope.addharddisk = function(){\r\n\t\t$scope.useNum-=1\r\n\t\t$scope.btndisks.push(new String);\r\n\t};\r\n\t$scope.deleteharddisk = function(itemindex){\r\n\t\t$scope.useNum+=1\r\n\t\t$scope.btndisks.splice(itemindex, 1);\r\n\t};\r\n}])\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controller.hardware.js"],"sourceRoot":""}