{"version":3,"sources":["webpack:///webpack/bootstrap 73c0292a4c28d0d1ccce","webpack:///./js/vdi/user/controllers.js","webpack:///./js/vdi/template/modify.bt.page.js","webpack:///./js/vdi/template/controllers.js","webpack:///./js/vdi/template/controller.teach.js","webpack:///./js/vdi/template/controller.person.js","webpack:///./js/vdi/template/controller.hardware.js"],"names":["angular","module","constant","factory","roles","navigators","$root","$$$UserRoles","User","lastSessionPromise","lastRequestTime","role","getNavigator","$$$storage","getSessionStorage","filter","item","key","reduce","userNavigators","indexOf","role_copy","JSON","parse","stringify","push","sublist","length","currentUser","hasCache","Date","now","refreshSession","$broadcast","logined","Boolean","currentUserRoles","user","keys","split","map","r","trim","isOwner","currentNavigator","currentSession","isAllowFilter","session","user_id","$promise","then","res","oldInfo","Object","forEach","setSessionStorage","$Domain","query","method","url","isArray","update","edit","params","move","query_tree","add","delete","$resource","get","create","listDomain","list","asycing","controller","$scope","UseradminList","$modal","UserRole","$$$I18N","rows","loading","owner","loginName","name","users","_ip","row","last_login","Number","currentPage","pagesize","$watch","newvalue","sortIP","order","sort","a","b","reverse","selected_rows","_selected","_ignore","nodelete_rows","instance_num","delete_rows","$","bigBox","title","content","timeout","open","template","$modalInstance","join","nodeleteName","ok","ids","id","index","splice","close","size","UsercommonList","$http","$$$MSG","$timeout","customModal","Depart","$location","_scope","WIDTH","domain","setData","data","full_path_map","children","d","parent","setTreeData","DATA","full_path","i","treeOptFun","arg","flag","opts","treedata","newData","expandnodes","selected","showSelected","node","queryCommon","islastGroup","departId","user_loading","department","undefined","result","console","log","treedata_loading","queryDepart","err","$$search","depart","username","searchText","decodeURIComponent","addDepartment","templateUrl","min_namelength","max_namelength","deleteDpartment","modalOptions","delTips","delParm","openModal","nodelTips","$on","e","val","modifyInfo","obj","moveTo","draggable","isSelectable","selectedPerson","arr","encodeHTML","txt","con","document","createElement","firstChild","removeChild","appendChild","ownerDocument","createTextNode","parentNode","innerHTML","format","tmpl","Array","prototype","slice","call","arguments","replace","match","param","finishUpload","response","suc","errorData","errorMsg","code","detail","color","icon","Server","pagesizes","servers","host","Domain","$routeParams","domainId","location","hash","parseInt","oneKeySycing","_controllerScope","powers","user_num","checked","_slide","_arrow","selectAll","slide","fatheritem","subitem","belong","select","set","allchecked","_this","save","desc","toString","redactor","updated_time","access_key","master","currentItem","access_roles","copy","POWER","permission","reload","isUnchanged","equals","reset","admin","schoolroom","min_passwordLe","max_passwordLe","_ischeckAll","sex","schoolroom_loading","querywithSimple","schoolrooms","pools_","DISABLED","changeRole","checkAll","scope","checkOne","p","pools","real_name","password","passwordConfirm","email","contact","sch","pool","myrole","schoolroom_id","$$childTail","PERMISSION","logInfor","Role","role_desc","submiting","afterSubmiting","unshift","value","status","ous","auto","base_dn","len","select_row","fullname","removeSelected","_item","$hashstr","substr","$hash","$id","$is_windows","$instance_id","$is_personalTemp","$sameIp","isos","vnc","selectIsos","isos_package","type","iso","loadISO","instance_id","vm","personTemplate","desktop","$$$os_types","rfb","it","duplicatedIp","passwordRequired","msg","$D","setAttribute","setPassword","sendPassword","sendCtrlAltDel","init_params","vnc_host","vnc_token","port","path","token","WebUtil","getQueryVar","createCookie","RFB","window","protocol","updateState","connect","state","oldstate","s","sb","cad","level","save_as_temp","load_iso","is_template","saveDisabled","undoDisabled","is_windows","is_personalTemp","instance_count","getStatus","checkLoad","os_type","passwd","image_name","_rfb_state","start","instance_ids","_loop","get_image_vnc_info","setTimeout","alert","shutdown","shutdowns","CAD","p_scope","bt_save_template","image_id","saveAsTemplate","instance_type","type_code","undo","bt_prev_save_template","expand","disconnect","run","$rootScope","settings","localize","lang_code","currentLang","languages","lang","langCode","setLang","alter","query_sub","add_sub","get_sub","alter_sub","delete_sub","ports","handout","check","directive","restrict","link","element","attrs","url_arry","urls","append","click","find","contentWindow","listModes","applyTemplate","modify","infor","spiceConnectInfo","virtualStatus","download","get_image_rdp_info","sync","sync_status","bt_before_edit_template","bt_sync_retry","bt_sync_repair","update_tpl_tip","$route","teachdesktop","$interval","$filter","network","ResourcePool","manageTemplate","networkWithHost","virtualHost","allrows","images","orders","sortTem","created_at","$event","_rows","k","sync_mode","syncFaildLen","syncDownloading","syncFaild","syncing","updateInfor","updateSize","toFixed","win_images","concat","linux_images","other_images","os","teachNames","sameName","virtual_type","$q","newRows","apply","error","rows_active","instance_status","syncTem","thistmpl","Retry","temp","image","server_ip","server_id","version","Repair","modes","noScense","trigger","some","is_copy","types1","types2","types","bind_ip_type","owners","temCopy","temData","getVirtualHost","rbd_enabled","host_loading","hosts","getNetwork","switchIps","subnet","band_ips","getSubnets","Network","subnets","network_loading","host_uuid","networks","switchSubnet","bind_ip","bindIP","description","band_ip","band_type","undoSync","disabled_gpu","vcpus","ram","system_alloc_disk","oldData","subnet_id","getIps","cur_imgInfor","nets","ip_address","curr_ip","network_id","addbtndisk","data_alloc_disk","data_alloc_disk_2","minusbtndisk","old_data_alloc_disk","old_data_alloc_disk_2","templateInfor","enable_gpu","submit_loading","template_name","gpu_auto_assignment","resetTemp","imgManage","IMG","imgType","formLocalData","dataResource","arry","host_ip","hostname","resource_pool_uuid","storages","hostArry","storage_name","storage_uuid","storage_type","imgs","storageArry","image_uuid","image_type","image_type_desc","has_image","has_instance","volume_type","volume_uuid","volume_status","formRemoteData","imgArry","getLocal","local_loading","locals","getRemote","remote_loading","remotes","new_pool","uuid","getlocalImages","updateVolume","volume","local","storage","img","remote","sendImg","deleteImg","formData","volumeId","inst_volumes","start_ip","end_ip","teach","hardware","checkIP","auto_isos","all_isos","hardware_templates","support_auto_install","names","install","isOther","stepScope","$$nextSibling","step","is_dirty","done","step_pane0","$invalid","showLoading","ip","system_gb","popover","$parent","system_versions","system_version1","_types","_obj","newWindow","FLAG","gotoUrl","on","step_pane3","userPassword","userPasswordConfirm","steps","scopes","auto_install","$$childHead","testWin10","cpu_num","local_gb","memory_mb","iso_path","iso_id","userName","firmware_type","test","updateTem","isSuccess","targetScope","currentStep","finally","registerTemplate","sys_isos","system_image","sys_iso","old_data_isos","data_image","getDataImgs","filterDataISO","data_iso","data_iso2","data_isos2","data_isos","data_isos1","systemImg","is_init","form","getRegisterTemplateForm","$setViewValue","os_types","postData","system_image_file","data_image_file","data_image_file_2","is_64","child","personalNames","personal","btndisks","useNum","addharddisk","String","deleteharddisk","itemindex"],"mappings":"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","file":"templateModifybt.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/devbuild/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 164);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 73c0292a4c28d0d1ccce","angular.module(\"vdi.user\", [])\r\n\r\n.constant('$$$UserRoles', \"Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About\")\r\n\r\n.factory(\"UserRole\", [\"$$$UserRoles\", \"NavigatorLink\", \"$rootScope\", \"$$$UserRoles\", \"User\", function(roles, navigators, $root, $$$UserRoles, User){\r\n\tlet lastSessionPromise;\r\n\tlet lastRequestTime = 0;\r\n\tlet role = {\r\n\t\tgetNavigator(roles){\r\n\t\t\tif($$$storage.getSessionStorage(\"lang_code\") == 'pc')\r\n\t\t\t\tnavigators = navigators.filter(function(item){ return item.key !== 'Timetable' });\r\n\t\t\treturn navigators.reduce((userNavigators, role) => {\r\n\t\t\t\tif(roles.indexOf(role.key) > -1){\r\n\t\t\t\t\tlet role_copy = JSON.parse(JSON.stringify(role));\r\n\t\t\t\t\tuserNavigators.push(role_copy);\r\n\t\t\t\t\tif(role.sublist && role.sublist.length){\r\n\r\n\t\t\t\t\t\trole_copy.sublist = role.sublist.filter(role => roles.indexOf(role.key) > -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn userNavigators;\r\n\t\t\t}, []);\r\n\t\t},\r\n\t\tget currentUser(){\r\n\t\t\tvar hasCache = !!$$$storage.getSessionStorage(\"loginInfo\");\r\n\t\t\tif(hasCache && Date.now() - lastRequestTime > 1000 * 60 * 5) {\r\n\t\t\t\tthis.refreshSession();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(hasCache){\r\n\t\t\t\treturn JSON.parse($$$storage.getSessionStorage(\"loginInfo\"));\r\n\t\t\t}\r\n\t\t\t$root.$broadcast(\"NOAUTH\");\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tget logined(){\r\n\t\t\treturn Boolean($$$storage.getSessionStorage(\"loginInfo\"));\r\n\t\t},\r\n\t\tget currentUserRoles(){\r\n\t\t\tlet user = role.currentUser;\r\n\t\t\treturn user && user.keys ? user.keys.split(\",\").map(r => r.trim()) : [];\r\n\t\t},\r\n\t\tget isOwner(){\r\n\t\t\tlet user = role.currentUser;\r\n\t\t\treturn user && user.keys && user.keys===$$$UserRoles ? true:false;\r\n\t\t},\r\n\t\tget currentNavigator(){\r\n\t\t\treturn role.getNavigator(role.currentUserRoles);\r\n\t\t},\r\n\t\tget currentSession(){\r\n\t\t\treturn lastSessionPromise;\r\n\t\t},\r\n\t\tisAllowFilter(role){\r\n\t\t\tif(role.sublist && role.sublist.length){\r\n\t\t\t\trole.sublist.filter(isAllowFilter, this);\r\n\t\t\t}\r\n\t\t\treturn this.indexOf(role.key) > -1;\r\n\t\t},\r\n\t\trefreshSession(){\r\n\t\t\tlastSessionPromise = User.session({user_id: $$$storage.getSessionStorage(\"userId\")}).$promise;\r\n\t\t\tlastSessionPromise.then(function(res){\r\n\t\t\t\tvar oldInfo = JSON.parse($$$storage.getSessionStorage(\"loginInfo\")) || {};\r\n\t\t\t\t// test--\r\n                // res.user.keys = \"Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About\";\r\n\t\t\t\tObject.keys(res.user).forEach(function(key){\r\n\t\t\t\t\toldInfo[key] = res.user[key];\r\n\t\t\t\t});\r\n\t\t\t\t$$$storage.setSessionStorage('loginInfo', JSON.stringify(oldInfo));\r\n\t\t\t\t$$$storage.setSessionStorage('power', res.user.keys);\r\n\t\t\t});\r\n\t\t\tlastRequestTime = Date.now();\r\n\t\t\treturn lastSessionPromise;\r\n\t\t}\r\n\t};\r\n\treturn role;\r\n}])\r\n\r\n\r\n/* 用户 */\r\n.factory(\"Roles\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/permissions\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/permissions\", isArray: false},\r\n\t\tupdate:\r\n\t\t\t{method: \"PUT\", url: $Domain + \"/thor/user/permissions\" }\r\n\t});\r\n}])\r\n.factory(\"Admin\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/manager\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/manager\", isArray: false},\r\n\t\tupdate: \r\n\t\t\t{method: \"PUT\", url: $Domain + \"/thor/user/manager\" }\r\n\t});\r\n}])\r\n// .factory(\"User\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n// \treturn res($Domain + \"/thor/user/common\", null, {\r\n// \t\tquery:\r\n// \t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/common\", isArray: false},\r\n// \t\tupdate: \r\n// \t\t\t{method: \"PUT\", url: $Domain + \"/thor/user/common\" },\r\n// \t\tsession: {method: \"POST\", url: $Domain + \"/thor/user/session\"}\r\n// \t});\r\n// }])\r\n.factory(\"User\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/common\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/common\", isArray: false},\r\n\t\tedit: \r\n\t\t\t{method: \"PATCH\", url: $Domain + \"/thor/user/common/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\tmove:\r\n\t\t\t{method: \"PATCH\", url: $Domain + \"/thor/user/common/move\"},\r\n\t\tquery_tree :\r\n\t\t\t{method: \"GET\", url: $Domain + \"/thor/user/common/tree\"},\r\n\t\tsession: {method: \"POST\", url: $Domain + \"/thor/user/session\"}\r\n\t});\r\n}])\r\n/**\r\n * [description 部门]\r\n */\r\n .factory(\"Depart\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/user/departments\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/departments\", isArray: false},\r\n\t\tadd: \r\n\t\t\t{method: \"POST\", url: $Domain + \"/thor/user/departments\" },\r\n\t\tupdate: \r\n\t\t\t{method: \"PATCH\", url: $Domain + \"/thor/user/departments/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/user/departments/:id\", params: { \"id\": \"@id\" }, isArray:false}\r\n\t});\r\n}])\r\n.factory(\"Server\", [\"$resource\", \"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/user/server\", null, {\r\n\t\t// 读取域列表\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/server\"},\r\n\t\tget: \r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/info/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\t// 修改域基本信息\r\n\t\tupdate: \r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/user/server\"},\r\n\t\t//新增域\r\n\t\tcreate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/user/server\"},\r\n\t\t\"delete\":\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/user/server/:id\", params: { \"id\": \"@id\" }, isArray:false},\r\n\t\tlistDomain:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/server/:id\", params: { \"id\": \"@id\" }},\r\n\r\n\t\t// 指定教学桌面设置域\r\n\t\t\"domain_set_scene\":\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/pool/mode/:id/change_domain\" , params:{\"id\": \"@id\"}},\r\n\t\t//个人桌面设置域\r\n\t\t\"domain_set_person\":\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/instances/change_domain\"}\r\n\t});\r\n}])\r\n.factory(\"Domain\", [\"$resource\",\"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/user/domain/:id\", { \"id\": \"@id\" }, {\r\n\t\t// 域用户列表\r\n\t\tlist:\r\n\t\t\t{method: \"GET\", url: $Domain + \"/thor/user/get_users\"},\r\n\t\t// 查看特定域的用户信息\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/domain/:id\",params:{\"id\":\"@id\"}},\r\n\t\tasycing:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/user/domain/:id\", params: { \"auto\": \"@auto\" }, isArray: false},\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/user/domain/:id/ous\",params:{\"id\":\"@id\"}},\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/user/common\",isArray: false}\r\n\t});\r\n}])\r\n\r\n\r\n.controller(\"vdiUserAdminManageController\", [\r\n\"$scope\", \"Admin\",\"$modal\", \"UserRole\", \"$$$I18N\",\r\nfunction($scope, UseradminList, $modal, UserRole, $$$I18N){\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\t$scope.rows = [];\r\n\t// $scope.allRows = [];\r\n\t$scope.loading = true;\r\n\t$scope.owner = UserRole.isOwner;\r\n\t$scope.loginName = user.name;\r\n\t\r\n\tUseradminList.query(function(res){\r\n\t\tif(!$scope.owner){\r\n\t\t\t$scope.rows = res.users.filter(function(item){ return item.name == $scope.loginName });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.rows = res.users;\r\n\t\t}\r\n\t\t$scope.loading = false;\r\n\t\tvar _ip;\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tif(row.last_login !== null){\r\n\t\t\t\t_ip = row.last_login.split(\".\");\r\n\t\t\t\trow._ip = (_ip[0] << 16) + (_ip[1] << 8) + Number(_ip[2]) + (_ip[3] / 1000);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t_ip = null;\r\n\t\t\t\trow._ip = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// angular.copy($scope.rows,$scope.allRows);\r\n\t});\r\n\r\n    $scope.currentPage = 1;\r\n \t$scope.pagesize = Number($$$storage.getSessionStorage('admin_pagesize')) || 30;\r\n\t$scope.$watch(\"pagesize\" , function(newvalue){\r\n\t\t$scope.pagesize = newvalue || 0;\r\n\t\t$$$storage.setSessionStorage('admin_pagesize', newvalue ? newvalue : 0)\r\n\t}); \r\n\r\n\t// $scope.updateData = function(text){\r\n\t// \t$scope.rows = $scope.allRows.filter(function(row){\r\n\t// \t\trow._selected = false;\r\n\t// \t\tif(text){\r\n\t// \t\t\treturn row.name.indexOf(text) !== -1;\r\n\t// \t\t}\r\n\t// \t\treturn true;\r\n\t// \t});\r\n\t// };\r\n\r\n    $scope.sortIP = function(order){\r\n    \t$scope.rows.sort(function(a, b){\r\n\t\t\treturn (a._ip > b._ip) ? 1 : -1;\r\n\t\t});\r\n\t\tif(order){\r\n\t\t\t$scope.rows.reverse();\r\n\t\t}\r\n    };\r\n\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && !row._ignore; });\r\n\t\tvar nodelete_rows = selected_rows.filter(function(row){ return row.instance_num != 0; });\r\n\t\tvar delete_rows = selected_rows.filter(function(row){ return row.instance_num == 0; });\r\n\t\tvar rows = $scope.rows;\r\n\t\tif(delete_rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent : $$$I18N.get(\"ADMIN_TIP\"),\r\n\t\t\t\t\ttimeout : 6000\r\n\t\t\t\t});\r\n\t\t}\r\n\t\telse \r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除用户'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='USER_TIPGROUP2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t\t$scope.nodelete_rows = nodelete_rows;\r\n\t\t\t\t\t\t$scope.name = delete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t\t$scope.nodeleteName = nodelete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t\tUseradminList.delete({\r\n\t\t\t\t\t\t\t\tids: delete_rows.map(function(row){ return row.id; })\r\n\t\t\t\t\t\t\t}, function(res){\r\n\t\t\t\t\t\t\t\tdelete_rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\t\tvar index = rows.indexOf(item);\r\n\t\t\t\t\t\t\t\t\trows.splice(index, 1);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize : \"sm\"\r\n\t\t\t\t});\r\n\t};\r\n\r\n}])\r\n.controller(\"vdiUserCommonManageController\", [\r\n\"$scope\",\"User\",\"$modal\", \"$http\", \"$$$MSG\", \"$$$I18N\", \"$Domain\",\"$timeout\",\"customModal\", \"Depart\",\"User\",\"UserRole\",\"$location\",\r\nfunction($scope, UsercommonList, $modal, $http, $$$MSG, $$$I18N, $Domain,$timeout,customModal,Depart,User,UserRole,$location){\r\n\tvar _scope = $scope;\r\n\t$scope.rows = [];\r\n\tvar WIDTH = $$$I18N.get(\"GOD_VERSION\") == \"cloudClassEn\" || $$$I18N.get(\"GOD_VERSION\") == \"korean\" ? 66:50;\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesize = Number($$$storage.getSessionStorage('common_pagesize')) || 30;\r\n\t$scope.$watch(\"pagesize\" , function(newvalue){\r\n\t\t$scope.pagesize = newvalue || 0;\r\n\t\t$$$storage.setSessionStorage('common_pagesize', newvalue ? newvalue : 0)\r\n\t}); \r\n\t$scope.domain = $Domain;\r\n\t/**\r\n\t * [sortIP IP排序]\r\n\t */\r\n\t$scope.sortIP = function(order){\r\n\t\t$scope.rows.sort(function(a, b){\r\n\t\t\treturn (a._ip > b._ip) ? 1 : -1;\r\n\t\t});\r\n\t\tif(order){\r\n\t\t\t$scope.rows.reverse();\r\n\t\t}\r\n\t};\r\n\r\n\t // 组合json数据\r\n\t function setData(data, index){\r\n\t \tdata.filter(function(item){ return item.full_path_map.length == index }).forEach(function(item){\r\n\t \t\tvar children = data.filter(function(d){ return d.parent == item.id });\r\n\t \t\titem.children = children;\r\n\t \t});\r\n\t }\r\n\tfunction setTreeData(DATA){\r\n\t\tDATA.forEach(function(item){\r\n\t\t\titem.full_path_map = item.full_path.split('/');\r\n\t\t});\r\n\t\tDATA.sort(function(a,b){ return a.full_path_map.length>b.full_path_map.length?-1:1 });\r\n\t\tfor(var i=1; i<DATA[0].full_path_map.length; i++){\r\n\t\t\tsetData(DATA, i);\r\n\t\t}\r\n\t\treturn [DATA[DATA.length-1]];\r\n\t};\r\n\t// 初始化树状图\r\n\tfunction treeOptFun(arg,flag){\r\n\t\targ.opts = {};\r\n\t\targ.treedata = newData;\r\n\t\targ.expandnodes = DATA;\r\n\t\targ.selected = arg.treedata[0]?arg.treedata[0]:null;\r\n\t\tif(arg.selected){\r\n\t\t\targ.selected._selected = true;\r\n\t\t}\r\n\t\targ.showSelected = function(node, selected){\r\n\t\t\tnode._selected = selected;\r\n\t\t\targ.selected = node;\r\n\t\t\tif(arg.selected._selected && flag){\r\n\t\t\t\t$scope.queryCommon(arg.selected.id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar DATA = [], newData = [];\r\n\ttreeOptFun($scope,true);\r\n\r\n\t$scope.islastGroup = function(){\r\n\t\treturn $scope.selected && !DATA.filter(function(item){\r\n\t\t\t\t\treturn item.id!==$scope.selected.id;\r\n\t\t\t\t}).filter(function(item){\r\n\t\t\t\t\treturn (item.full_path+'/').indexOf($scope.selected.full_path+'/')>-1;\r\n\t\t\t\t}).length\r\n\t}\r\n\t$scope.queryCommon = function(departId){\r\n\t\t$scope.user_loading = true;\r\n\t\t$scope.rows = [];\r\n\t\tUsercommonList.query({department: departId?departId:undefined}, function(users){\r\n\t\t\t$scope.user_loading = false;\r\n\t\t\t$scope.rows = users.result;\r\n\t\t\t// $scope.rows.forEach(function(item){ item.department_desc = $scope.selected.full_path });\r\n\t\t\tvar _ip;\r\n\t\t\t$scope.rows.forEach(function(row){\r\n\t\t\t\tif(row.last_login !== null){\r\n\t\t\t\t\t_ip = row.last_login.split(\".\");\r\n\t\t\t\t\trow._ip = (_ip[0] << 16) + (_ip[1] << 8) + Number(_ip[2]) + (_ip[3] / 1000);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\t_ip = null;\r\n\t\t\t\t\trow._ip = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconsole.log(777, $scope.rows)\r\n\t\t},function(){\r\n\t\t\t$scope.user_loading = false;\r\n\t\t})\r\n\t}\r\n\t$scope.treedata_loading = true;\r\n\t$scope.queryDepart = function(){\r\n\t\tDepart.query(function(res){\r\n\t\t\t$scope.treedata_loading = false;\r\n\t\t\tDATA = res.result;\r\n\t\t\t$scope.treedata = newData = DATA.length?setTreeData(DATA):[];\r\n\t\t\t$scope.treedata[0].children && $scope.treedata[0].children.sort(function(a,b){ return a.name>b.name?-1:1 });\r\n\t\t\t$scope.expandnodes = DATA;\r\n\t\t\tvar selected = {};\r\n\t\t\tif($scope.selected){\r\n\t\t\t\tvar _selected = DATA.filter(function(item){ return item.id==$scope.selected.id })[0];\r\n\t\t\t\tselected = _selected?_selected:newData[0];\r\n\t\t\t}else{\r\n\t\t\t\tselected = newData[0];\r\n\t\t\t}\r\n\t\t\t$scope.selected = selected;\r\n\t\t\tif($scope.selected){\r\n\t\t\t\t$scope.selected._selected = true;\r\n\t\t\t\t$scope.queryCommon($scope.selected.id);\r\n\t\t\t}\r\n\t\t},function(err){\r\n\t\t\t$scope.treedata_loading = false;\r\n\t\t});\r\n\t}\r\n\tif($location.$$search.depart)\r\n\t\t$scope.selected = {id: Number($location.$$search.depart)};\r\n\tif($location.$$search.username)\r\n\t\t$scope.searchText = decodeURIComponent($location.$$search.username);\r\n\r\n\t$scope.queryDepart();\r\n\t\r\n\t\r\n\t/**\r\n\t * [addDepartment 添加部门]\r\n\t */\r\n\t$scope.addDepartment=function(){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/user/user_common_department_add.html\",\r\n\t\t\tsize: DATA.length ? \"md\":'sm',\r\n\t\t\tcontroller:function($scope,$modalInstance){\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\ttreeOptFun($scope);\r\n\t\t\t\t$scope.selected = null;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tDepart.add({\r\n\t\t\t\t\t\tname: this.name,\r\n\t\t\t\t\t\tparent: this.selected?this.selected.id:1\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t_scope.queryDepart();\r\n\t\t\t\t\t},function(){});\t\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * [deleteDpartment 删除部门]\r\n\t */\r\n\t$scope.deleteDpartment=function(){\r\n\t\tvar modalOptions = {\r\n\t\t\tkey: \"CommonDepartDel\",\r\n\t\t\ttitle: \"删除用户组\",\r\n\t\t\tdelTips: \"USER_TIPGROUP3\",\r\n\t\t\tdelete_rows: [$scope.selected],\r\n\t\t\tdelParm: 'name'\r\n\t\t}\r\n\t\tcustomModal.openModal(modalOptions);\r\n\t}\r\n\t/**\r\n\t * [delete 列表删除用户]\r\n\t */\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar nodelete_rows = selected_rows.filter(function(row){ return row.instance_num != 0; });\r\n\t\tvar delete_rows = selected_rows.filter(function(row){ return row.instance_num == 0; });\r\n\r\n\t\tif(delete_rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent : $$$I18N.get(\"ADMIN_TIP\"),\r\n\t\t\t\t\ttimeout: 6000\r\n\t\t\t\t});\r\n\t\t}else{\r\n\t\t\tvar modalOptions = {\r\n\t\t\t\tkey: \"CommonUserDel\",\r\n\t\t\t\ttitle: \"删除用户\",\r\n\t\t\t\tdelTips: \"USER_TIPGROUP1\",\r\n\t\t\t\tdelete_rows: delete_rows,\r\n\t\t\t\tdelParm: 'name',\r\n\t\t\t\tnodelete_rows: nodelete_rows,\r\n\t\t\t\tnodelTips: \"USER_TIPGROUP4\"\r\n\t\t\t}\r\n\t\t\tcustomModal.openModal(modalOptions);\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.$on('DELETE',function(e, val){\r\n\t\tif(val){\r\n\t\t\t// 删除部门\r\n\t\t\tif(val.key=='CommonDepartDel'){\r\n\t\t\t\tDepart.delete({\r\n\t\t\t\t\tid: val.data[0].id,\r\n\t\t\t\t},function(res){\r\n\t\t\t\t\t$scope.queryDepart();\r\n\t\t\t\t},function(){});\r\n\t\t\t}\r\n\t\t\t//删除部门用户\r\n\t\t\tif(val.key=='CommonUserDel'){\r\n\t\t\t\tUsercommonList.delete({\r\n\t\t\t\t\tid: val.data.map(function(row){ return row.id; })\r\n\t\t\t\t},\r\n\t\t\t\tfunction(res){\r\n\t\t\t\t\t$scope.queryDepart();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\t/**\r\n\t * [modifyInfo 修改部门名称]\r\n\t */\r\n\t$scope.modifyInfo=function(node){\r\n\t\tvar obj = node?node:$scope.selected;\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/user/user_common_department_modify.html\",\r\n\t\t\tsize:\"sm\",\r\n\t\t\tcontroller:function($scope,$modalInstance){\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\t$scope.name = obj.name;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tDepart.update({\r\n\t\t\t\t\t\tid: obj.id,\r\n\t\t\t\t\t\tname: this.name\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t_scope.queryDepart();\r\n\t\t\t\t\t},function(){});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$scope.close=function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * [moveTo 用户移动至部门]\r\n\t */\r\n\t$scope.moveTo=function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl:\"views/vdi/dialog/user/user_common_moveTo.html\",\r\n\t\t\tsize:\"md\",\r\n\t\t\tdraggable:true,\r\n\t\t\tcontroller:function($scope,$modalInstance){\r\n\t\t\t\ttreeOptFun($scope);\r\n\t\t\t\t$scope.opts.isSelectable = function(node){\r\n\t\t\t\t\treturn\t!DATA.filter(function(item){\r\n\t\t\t\t\t\t\t\treturn item.id!==node.id;\r\n\t\t\t\t\t\t\t}).filter(function(item){\r\n\t\t\t\t\t\t\t\treturn (item.full_path+'/').indexOf(node.full_path+'/')>-1;\r\n\t\t\t\t\t\t\t}).length\r\n\t\t\t\t};\r\n\t\t\t\t$scope.selected = null;\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tUser.move({\r\n\t\t\t\t\t\tid: selected_rows.map(function(item){ return item.id }),\r\n\t\t\t\t\t\tdepartment: this.selected.id\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t_scope.queryDepart();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t\t//勾选的人员姓名\r\n\t\t\t\t$scope.selectedPerson = selected_rows.map(function(item,index,arr){ return item.name }).join('，');\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * [description uploadify上传文件]\r\n\t */\r\n\tvar encodeHTML = function(txt, con){\r\n\t\tcon = con || document.createElement(\"div\");\r\n\t\twhile(con.firstChild){\r\n\t\t\tcon.removeChild(con.firstChild);\r\n\t\t}\r\n\t\treturn con.appendChild(con.ownerDocument.createTextNode(txt)).parentNode.innerHTML;\r\n\t};\r\n\tvar format = function(tmpl){\r\n\t\tvar data = Array.prototype.slice.call(arguments, 0);\r\n\t\treturn typeof tmpl === \"string\" ? tmpl.replace(/\\{\\{([^\\}]+)?\\}\\}/g, function(match, param){\r\n\t\t\tif(data[param]){\r\n\t\t\t\treturn encodeHTML(data[param]);\r\n\t\t\t}\r\n\t\t\treturn match;\r\n\t\t}) : \"\";\r\n\t};\r\n\t\r\n\t$scope.finishUpload = function(response){\r\n\t\t$scope.queryDepart();\r\n\t}\r\n\r\n\t$scope.$on(\"UploadError\", function (e, suc, errorData) {\r\n\t\tvar errorMsg = errorData.code==17041? $$$MSG.get(errorData.code)+errorData.detail : $$$MSG.get(errorData.code);\r\n\t\t$.bigBox({\r\n\t\t\ttitle : $$$MSG.get(\"PAI_CODE\") + errorData.code,\r\n\t\t\tcontent : errorMsg,\r\n\t\t\tcolor : \"#C46A69\",\r\n\t\t\ticon : \"fa fa-warning shake animated\",\r\n\t\t\ttimeout : 6000\r\n\t\t});\r\n\t});\r\n}])\r\n.controller(\"vdiUserDomainController\", [\"$scope\", \"$modal\", \"Server\", function($scope,$modal,Server){\r\n\t$scope.loading = true;\r\n\t$scope.rows = [];\r\n\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\t$scope.loading=false;\r\n\r\n\tServer.query(function(response){\r\n\t\t$scope.rows=response.servers;\r\n\t},function(){\r\n\t\t//console.log(arguments);\r\n\t});\r\n\r\n\tvar _scope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar rows = $scope.rows;\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除域控制器'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t$scope.name = selected_rows.map(function(row){ return row.host }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\tServer.delete({\r\n\t\t\t\t\t\tids: selected_rows.map(function(row){ return row.id; })\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t\tServer.query(function(response){\r\n\t\t\t\t\t\t\t_scope.rows=response.servers;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\t\r\n}])\r\n.controller(\"vdiUserDomainListController\",[\"$scope\", \"$modal\",\"Domain\", \"User\",\"$routeParams\", \"$$$I18N\", function($scope, $modal,Domain,User,$routeParams,$$$I18N){\r\n\t$scope.loading = true;\r\n\t$scope.$root && $scope.$root.$broadcast(\"navItemSelected\", [\"用户\", \"域用户\",\"域用户列表\"]);\r\n\r\n\t// location.replace(\"#/user/domain/\");\r\n\t$scope.domainId = location.hash.match(/\\d+$/)? parseInt(location.hash.match(/\\d+$/)[0]):$routeParams.id;\r\n\t$scope.currentPage = 1;\r\n\t$scope.pagesizes = [10,20,30];\r\n\t$scope.pagesize = $scope.pagesizes[0];\r\n\r\n\t$scope.loading=false;\r\n\t$scope.rows=[];\r\n\t$scope.oneKeySycing=function(){\r\n\t\tDomain.asycing({\"auto\":1,\"id\":$scope.domainId},function(response){\r\n\t\t\tangular.forEach(response.result,function(item,index){\r\n\t\t\t\tvar i;\r\n\t\t\t\tfor(i=0;i<$scope.rows.length;i++){\r\n\t\t\t\t\tif(item.id==$scope.rows[i]){\r\n\t\t\t\t\t\t$scope.rows[i]=item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(i>=$scope.rows.length){\r\n\t\t\t\t\t$scope.rows.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t//$scope.rows.push(item);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    var _scope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar nodelete_rows = selected_rows.filter(function(row){ return row.instance_num != 0; });\r\n\t\tvar delete_rows = selected_rows.filter(function(row){ return row.instance_num == 0; });\r\n\t\tvar rows = $scope.rows;\r\n\t\t\r\n\t\tif(delete_rows.length==0){\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent : $$$I18N.get(\"ADMIN_TIP\"),\r\n\t\t\t\t\ttimeout : 6000\r\n\t\t\t\t});\r\n\t\t}\r\n\t\telse \r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除用户'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;word-break: break-all;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='USER_TIPGROUP2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n\t\t\t\tcontroller : function($scope, $modalInstance){\r\n\t\t\t\t\t$scope.nodelete_rows = nodelete_rows;\r\n\t\t\t\t\t\t$scope.name = delete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t\t$scope.nodeleteName = nodelete_rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\tUser.delete({\r\n\t\t\t\t\t\t\tids: delete_rows.map(function(row){ return row.id; })\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t\t\tdelete_rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\tvar index = rows.indexOf(item);\r\n\t\t\t\t\t\t\t\trows.splice(index, 1);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize : \"sm\"\r\n\t\t});\r\n\t};\r\n\r\n\tDomain.query({\"id\":$scope.domainId},function(response){\r\n\t\t$scope.rows=response.users;\r\n\t},function(){\r\n\t});\r\n}])\r\n.controller(\"vdiUserRoleManageController\", [\"$scope\", \"$modal\", \"Roles\", \"$$$UserRoles\", \"$$$I18N\",function($scope, $modal, roles, $$$UserRoles, $$$I18N){\r\n\t$scope.rows = [];var _controllerScope = $scope;$scope.loading = true;\r\n\t// $scope.allRows = [];\r\n\t$scope.powers = $$$UserRoles;\r\n\troles.query(function(res){\r\n\t\t$scope.rows = res.result.sort(function(a,b){\r\n\t\t\tif(a.name === 'Administrator'){\r\n\t\t\t\treturn -1\r\n\t\t\t}else if(b.name === 'Administrator'){\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t});\r\n\t\t$scope.loading = false;\r\n\t\t// angular.copy($scope.rows,$scope.allRows);\r\n\t});\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesize = Number($$$storage.getSessionStorage('role_pagesize')) || 30;\r\n\t$scope.$watch(\"pagesize\" , function(newvalue){\r\n\t\t$scope.pagesize = newvalue || 0;\r\n\t\t$$$storage.setSessionStorage('role_pagesize', newvalue ? newvalue : 0)\r\n\t}); \r\n\r\n\t// $scope.updateData = function(text){\r\n\t// \t$scope.rows = $scope.allRows.filter(function(row){\r\n\t// \t\trow._selected = false;\r\n\t// \t\tif(text){\r\n\t// \t\t\treturn row.name.indexOf(text) !== -1;\r\n\t// \t\t}\r\n\t// \t\treturn true;\r\n\t// \t});\r\n\t// };\r\n\r\n    $scope.delete = function(item){\r\n    \tvar selected_rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected && !row._ignore });\r\n    \tvar nodelete_rows = selected_rows.filter(function(row){ return row.user_num != 0; });\r\n    \tvar delete_rows = selected_rows.filter(function(row){ return row.user_num == 0; });\r\n    \tvar rows = $scope.rows;\r\n\r\n    \tif(delete_rows.length==0){\r\n    \t\t$.bigBox({\r\n    \t\t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n    \t\t\t\tcontent : $$$I18N.get(\"ROEL_TIP\"),\r\n    \t\t\t\ttimeout : 6000\r\n    \t\t\t});\r\n    \t}\r\n    \telse \r\n    \t\t$modal.open({\r\n    \t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除角色'>\"+\r\n    \t\t\t\t\t\"删除角色</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_ROLES1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='DELETE_ROLES2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\r\n    \t\t\t\tcontroller : function($scope, $modalInstance){\r\n    \t\t\t\t\t$scope.nodelete_rows = nodelete_rows;\r\n    \t\t\t\t\t$scope.name = delete_rows.map(function(row){ return row.name }).join(', ');\r\n    \t\t\t\t\t$scope.nodeleteName = nodelete_rows.map(function(row){ return row.name }).join(', ');\r\n\r\n    \t\t\t\t\t$scope.ok = function(){\r\n    \t\t\t\t\t\troles.delete({\r\n    \t\t\t\t\t\t\tids: delete_rows.map(function(row){ return row.id; })\r\n    \t\t\t\t\t\t}, function(res){\r\n    \t\t\t\t\t\t\tdelete_rows.forEach(function(item){\r\n    \t\t\t\t\t\t\t\tvar index = rows.indexOf(item);\r\n    \t\t\t\t\t\t\t\trows.splice(index, 1);\r\n    \t\t\t\t\t\t\t});\r\n    \t\t\t\t\t\t\t$modalInstance.close();\r\n    \t\t\t\t\t\t});\r\n    \t\t\t\t\t}\r\n    \t\t\t\t\t$scope.close = function(){\r\n    \t\t\t\t\t\t$modalInstance.close();\r\n    \t\t\t\t\t}\r\n    \t\t\t\t},\r\n    \t\t\t\tsize : \"sm\"\r\n    \t\t\t});\r\n    \t};\r\n\r\n}])\r\n\r\n\r\n\r\n.controller(\"addUserRoleDialog\", [\"$scope\", \"$modalInstance\", \"Roles\", \"$$$I18N\", \"NavigatorLink\", function($scope, $modalInstance, role,$$$I18N, navigators){\r\n\t$scope.checked = true;$scope.roles = [];\r\n\tnavigators.forEach( item => {\r\n\t\tif(item.sublist){\r\n\t\t\t$scope.roles.push(item);\r\n\t\t\titem.sublist.forEach( data => { if(data.key!==\"Role_Manage\") $scope.roles.push(data);} )\r\n\t\t}\r\n\t\telse\r\n\t\t\t$scope.roles.push(item);\r\n\t});\r\n\t$scope.roles.forEach(function(item){\r\n\t\titem._selected = $scope.checked;\r\n\t\titem._slide = false;\r\n\t\titem._arrow = \"up\";\r\n\t})\r\n\t$scope.selectAll = function(){\r\n\t \t$scope.checked = !$scope.checked;\r\n\t \tif($scope.checked){\r\n\t \t\t$scope.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = true;\r\n\t \t\t})\r\n\t \t}\r\n\t \telse{\r\n\t \t\t$scope.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = false;\r\n\t \t\t})\r\n\t \t}\r\n\t }\r\n\t$scope.slide = function(name,checked){\r\n\t\tvar fatheritem = $scope.roles.filter(function(item){ return item.key === name })[0];\r\n\t\tvar subitem = $scope.roles.filter(function(item){ return item.belong === name })\r\n\t\tif(checked){\r\n\t\t\tfatheritem._arrow = \"down\";\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._slide = true;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tfatheritem._arrow = \"up\";\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._slide = false;\r\n\t\t\t})\r\n\t\t}\r\n\t };\r\n\t$scope.select = function(name){\r\n\t\t\tvar checked = $scope.roles.filter(function(item){ return item.key === name })[0]._selected;\r\n\t\t\tvar subitem = $scope.roles.filter(function(item){ return item.belong === name })\r\n\t\t\tif(!checked){\r\n\t\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\t\titem._selected = true;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\t\titem._selected = false;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tvar length = $scope.roles.filter(function(item){ return item._selected; }).length;\r\n\t\t\tif(length+1 == $scope.roles.length){\r\n\t\t\t\t$scope.checked = true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\t$scope.checked = false;\r\n\t\t };\r\n\t\t$scope.set = function(name){\r\n\t\t\tvar allchecked = false;\r\n\t\t\t$scope.roles.filter(function(item){ return item.belong === name }).forEach(function(item){ \r\n\t\t\t\tif(item._selected == true){\r\n\t\t\t\t\tallchecked = true;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tvar fatheritem = $scope.roles.filter(function(item){ return item.key === name })[0];\r\n\t\t\tif(fatheritem){\r\n\t\t\t\tif(!allchecked)\r\n\t\t\t\t\tfatheritem._selected = false;\r\n\t\t\t\telse{\r\n\t\t\t\t\tfatheritem._selected = true;\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\t\t\tvar length = $scope.roles.filter(function(item){ return item._selected; }).length;\r\n\t\t\tif(length == $scope.roles.length){\r\n\t\t\t\t$scope.checked = true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\t$scope.checked = false;\r\n\t\t\t\r\n\t\t}\r\n\r\n\r\n\r\n\t $scope.min_namelength=2;$scope.max_namelength=20;\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar _this = this;\r\n\t\tvar roles = this.roles.filter(function(item){ return item._selected == true }).map(function(item){ return item.key });\r\n\t\tif(roles.length){\r\n\t\t\trole.save({\r\n\t\t\t\t\t\"name\": this.data.name,\r\n\t\t\t\t\t\"desc\": this.data.desc,\r\n\t\t\t\t\t\"keys\": roles.toString()\r\n\t\t\t\t},\r\n\t\t\t\tfunction(data){\r\n\t\t\t\t\t$scope.rows.push({\r\n\t\t\t\t\t\tid: data.id,\r\n\t\t\t\t\t\tname: data.name,\r\n\t\t\t\t\t\tdesc: data.desc,\r\n\t\t\t\t\t\tuser_num: data.user_num,\r\n\t\t\t\t\t\tredactor: data.redactor,\r\n\t\t\t\t\t\tupdated_time: data.updated_time,\r\n\t\t\t\t\t\taccess_key: data.access_key\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t);\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"PERMISSION_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"editUserRoleDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Roles\", \"$$$I18N\", \"UserRole\",\"NavigatorLink\",\r\nfunction($scope, $modalInstance, role, $$$I18N, UserRole, navigators){\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.data = {};\r\n\t$scope.master = {};\r\n\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\tvar roles = [];\r\n\tnavigators.forEach( item => {\r\n\t\tif(item.sublist){\r\n\t\t\troles.push(item);\r\n\t\t\titem.sublist.forEach( data => { if(data.key!==\"Role_Manage\") roles.push(data);} )\r\n\t\t}\r\n\t\telse\r\n\t\t\troles.push(item);\r\n\t});\r\n\titem.roles = roles;\r\n\tvar access_roles = item.access_key.split(\",\");\r\n\titem.roles.forEach(function(item){\r\n\t\titem._selected = false;\r\n\t\titem._slide = false;\r\n\t\titem._arrow = \"up\";\r\n\t})\r\n\taccess_roles.forEach(function(role){\r\n\t\titem.roles.forEach(function(item){\r\n\t\t\tif(item.key === role) item._selected = true;\r\n\t\t})\r\n\t})\r\n\t$scope.data = angular.copy(item);\r\n\r\n\tif($scope.data.roles.filter(function(item){ return item._selected === true }).length === $scope.data.roles.length){\r\n\t\t$scope.checked = true;\r\n\t}\r\n\telse $scope.checked = false;\r\n\r\n\t$scope.selectAll = function(){\r\n\t \t$scope.checked = !$scope.checked;\r\n\t \tif($scope.checked){\r\n\t \t\t$scope.data.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = true;\r\n\t \t\t})\r\n\t \t}\r\n\t \telse{\r\n\t \t\t$scope.data.roles.forEach(function(item){\r\n\t \t\t\tif(item.key != \"Administrator\" && item.key != \"User\" && item.key != \"Summary\")\r\n\t \t\t\t\titem._selected = false;\r\n\t \t\t})\r\n\t \t}\r\n\t }\r\n\t $scope.slide = function(name,checked){\r\n\t \tvar fatheritem = $scope.data.roles.filter(function(item){ return item.key === name })[0];\r\n\t \tvar subitem = $scope.data.roles.filter(function(item){ return item.belong === name })\r\n\t \tif(checked){\r\n\t \t\tfatheritem._arrow = \"down\";\r\n\t \t\tsubitem.forEach(function(item){\r\n\t \t\t\titem._slide = true;\r\n\t \t\t})\r\n\t \t}\r\n\t \telse{\r\n\t \t\tfatheritem._arrow = \"up\";\r\n\t \t\tsubitem.forEach(function(item){\r\n\t \t\t\titem._slide = false;\r\n\t \t\t})\r\n\t \t}\r\n\t  };\r\n\t$scope.select = function(name){\r\n\t\tvar checked = $scope.data.roles.filter(function(item){ return item.key === name })[0]._selected;\r\n\t\tvar subitem = $scope.data.roles.filter(function(item){ return item.belong === name })\r\n\t\tif(!checked){\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._selected = true;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tsubitem.forEach(function(item){\r\n\t\t\t\titem._selected = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\tvar length = $scope.data.roles.filter(function(item){ return item._selected; }).length;\r\n\t\tif(length+1 == $scope.data.roles.length){\r\n\t\t\t$scope.checked = true;\r\n\t\t}\r\n\t\telse\r\n\t\t\t$scope.checked = false;\r\n\t };\r\n\t$scope.set = function(name){\r\n\t\tvar allchecked = false;\r\n\t\t$scope.data.roles.filter(function(item){ return item.belong === name }).forEach(function(item){ \r\n\t\t\tif(item._selected == true){\r\n\t\t\t\tallchecked = true;\r\n\t\t\t}\r\n\t\t})\r\n\t\tvar fatheritem = $scope.data.roles.filter(function(item){ return item.key === name })[0];\r\n\t\tif(fatheritem){\r\n\t\t\tif(!allchecked)\r\n\t\t\t\tfatheritem._selected = false;\r\n\t\t\telse{\r\n\t\t\t\tfatheritem._selected = true;\r\n\t\t\t}\t\r\n\t\t}\r\n\t\tvar length = $scope.data.roles.filter(function(item){ return item._selected; }).length;\r\n\t\tif(length == $scope.data.roles.length){\r\n\t\t\t$scope.checked = true;\r\n\t\t}\r\n\t\telse\r\n\t\t\t$scope.checked = false;\r\n\t\t\r\n\t}\r\n\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar _this = this;\r\n\t\tvar roles = this.data.roles.filter(function(item){ return item._selected == true }).map(function(item){ return item.key });\r\n\t\tif(roles.length){\r\n\t\t\trole.update({\r\n\t\t\t\t\t\"id\": this.data.id,\r\n\t\t\t\t\t\"name\": this.data.name,\r\n\t\t\t\t\t\"desc\": this.data.desc,\r\n\t\t\t\t\t\"keys\": roles.toString()\r\n\t\t\t\t},\r\n\t\t\t\tfunction(data){\r\n\t\t\t\t\tvar POWER = item.access_key;\r\n\t\t\t\t\titem.name = data.name;\r\n\t\t\t\t\titem.desc = data.desc;\r\n\t\t\t\t\titem.access_key = data.access_key;\r\n\t\t\t\t\titem.redactor = data.redactor;\r\n\t\t\t\t\titem.updated_time = data.updated_time;\r\n\t\t\t\t\titem.user_num = data.user_num;\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\tif(_this.data.id === user.permission && item.access_key != POWER){\r\n\t\t\t\t\t\t$$$storage.setSessionStorage('power', roles.toString())\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"PERMISSION_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem);\r\n\t\tif($scope.data.roles.filter(function(item){ return item._selected === true }).length === $scope.data.roles.length){\r\n\t\t\t$scope.checked = true;\r\n\t\t}\r\n\t\telse $scope.checked = false;\r\n\t};\r\n}])\r\n.controller(\"addUserAdminDialog\", [\"$scope\", \"$modalInstance\", \"Admin\", \"SchoolRoom\", \"Roles\",\"$$$I18N\", function($scope, $modalInstance, admin, schoolroom, role, $$$I18N){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope._ischeckAll = true;\r\n\t$scope.data = {\r\n\t\tsex:'true',\r\n\t};\r\n\t$scope.master = {sex:'true'};\r\n\r\n\t$scope.schoolroom_loading = true;\r\n\tschoolroom.querywithSimple(function(res){\r\n\t\t$scope.schoolroom_loading = false;\r\n\t\t$scope.data.schoolrooms = res.pools_;\r\n\t\t$scope.data.schoolrooms.forEach(function(item){ item._selected = true;  });\r\n\t})\r\n\trole.query(function(res){\r\n\t\t$scope.roles = res.result;\r\n\t\t// $scope.data.role = res.result.filter(function(item){ return item.name===\"Administrator\" })[0];\r\n\t})\r\n\t$scope.DISABLED = false;\r\n\t$scope.changeRole = function(role){\r\n\t\tif($scope.data.role && $scope.data.role.name == \"Administrator\"){\r\n\t\t\trole._ischeckAll = true;\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t});\r\n\t\t\t$scope.DISABLED = true;\r\n\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.DISABLED = false;\r\n\t\t}\r\n\t}\r\n\t$scope.checkAll = function(scope){\r\n\t\tif(scope._ischeckAll){\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.checkOne = function(scope){\r\n\t\tvar schoolrooms = $scope.data.schoolrooms.filter(function(p){ \r\n\t\t\treturn p._selected;\r\n\t\t});\r\n\t\tif(schoolrooms.length === $scope.data.schoolrooms.length){\r\n\t\t\tscope._ischeckAll = true;\r\n\t\t}else{\r\n\t\t\tscope._ischeckAll = false;\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.master);\r\n\t};\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.master,$scope.data);\r\n\t}\r\n\t$scope.ok = function(){\r\n\t\tvar pools = $scope.data.schoolrooms.filter(function(item){ if(item._selected) return item }).map(function(item){ return item.id });\r\n\t\tif(pools.length)\r\n\t\t\tadmin.save(\r\n\t\t\t\t{\r\n\t\t\t\t\tname: $scope.data.name,\r\n\t\t\t\t\treal_name: $scope.data.real_name,\r\n\t\t\t\t\tsex: $scope.data.sex,\r\n\t\t\t\t\tpermission: $scope.data.role.id,\r\n\t\t\t\t\tpassword: $scope.data.password,\r\n\t\t\t\t\tpasswordConfirm: $scope.data.passwordConfirm,\r\n\t\t\t\t\temail: $scope.data.email,\r\n\t\t\t\t\tcontact: $scope.data.contact,\r\n\t\t\t\t\tpools: pools\r\n\t\t\t\t},\r\n\t\t\t\tfunction(data){\r\n\t\t\t\t\tdata.result.instance_num = 0;\r\n\t\t\t\t\t$scope.rows.push(data.result);\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"POOL_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n.controller(\"editUserAdminDialog\", [\r\n\"$scope\", \"$modalInstance\",\"Admin\", \"SchoolRoom\", \"Roles\", \"$$$UserRoles\", \"$$$I18N\", \"UserRole\",\r\nfunction($scope, $modalInstance, admin, schoolroom, role, $$$UserRoles, $$$I18N, UserRole){\r\n\tlet user = UserRole.currentUser;\r\n\tif(!user){ return }\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.owner = UserRole.isOwner;\r\n\r\n\t$scope.master = {};\r\n\t$scope.data = {};\r\n\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\t$scope.schoolroom_loading = true;\r\n\tschoolroom.querywithSimple(function(res){\r\n\t\t$scope.schoolroom_loading = false;\r\n\t\titem.schoolrooms = res.pools_;\r\n\t\tvar i = 0;\r\n\t\titem.schoolrooms.forEach(function(sch){\r\n\t\t\titem.pool.forEach(function(id){\r\n\t\t\t\tif(sch.id === id){\r\n\t\t\t\t\tsch._selected = true;\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t\tif(i == item.schoolrooms.length){\r\n\t\t\t$scope._ischeckAll = true;\r\n\t\t}\r\n\t\trole.query(function(res){\r\n\t\t\titem.roles = res.result;\r\n\t\t\tvar myrole = res.result.filter(function(role){ return role.name === item.permission })[0];\r\n\t\t\t// if(myrole)\r\n\t\t\t\titem.myrole = res.result.filter(function(role){ return role.name === item.permission })[0];\r\n\t\t\t// else\r\n\t\t\t// \titem.myrole = res.result[0];\r\n\t\t\t$scope.data = angular.copy(item);\r\n\t\t})\r\n\t\t\r\n\t})\r\n\tif(!$scope.owner)\r\n\t\t$scope.DISABLED = true;\r\n\t$scope.changeRole = function(role){\r\n\t\tif($scope.data.myrole && $scope.data.myrole.name == \"Administrator\"){\r\n\t\t\trole._ischeckAll = true;\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t});\r\n\t\t\t$scope.DISABLED = true;\r\n\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data.schoolrooms.forEach(function(item){\r\n\t\t\t\t\titem._selected = false;\r\n\t\t\t})\r\n\t\t\titem.pool.forEach(function(schoolroom_id){\r\n\t\t\t\t$scope.data.schoolrooms.forEach(function(item){\r\n\t\t\t\t\tif(item.id === schoolroom_id){\r\n\t\t\t\t\t\titem._selected = true\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tif($scope.data.schoolrooms.filter(function(item){ return item._selected == true }).length == $scope.data.schoolrooms.length)\r\n\t\t\t\trole._ischeckAll = true;\r\n\t\t\telse role._ischeckAll = false;\r\n\t\t\t\r\n\t\t\t$scope.DISABLED = false;\r\n\t\t}\r\n\t}\r\n\t$scope.checkAll = function(scope){\r\n\t\tif(scope._ischeckAll){\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = true;\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\t$scope.data.schoolrooms.map(function(schoolroom){\r\n\t\t\t\treturn schoolroom._selected = false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.checkOne = function(scope){\r\n\t\tvar schoolrooms = $scope.data.schoolrooms.filter(function(p){ \r\n\t\t\treturn p._selected;\r\n\t\t});\r\n\t\tif(schoolrooms.length === $scope.data.schoolrooms.length){\r\n\t\t\tscope._ischeckAll = true;\r\n\t\t}else{\r\n\t\t\tscope._ischeckAll = false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem);\r\n\t\tif($scope.data.schoolrooms.filter(function(item){ return item._selected === true }).length === $scope.data.schoolrooms.length){\r\n\t\t\t$scope.$$childTail._ischeckAll = true;\r\n\t\t}\r\n\t\telse {console.log($scope); $scope.$$childTail._ischeckAll = false;}\r\n\r\n\t};\r\n\r\n\t$scope.edit = function() {\r\n\t\tvar user_id = this.data.id;\r\n\t\tvar pools = this.data.schoolrooms.filter(function(item){ if(item._selected) return item }).map(function(item){ return item.id });\r\n\t\tif(pools.length)\r\n\t\t\tadmin.update(\r\n\t\t\t{\r\n\t\t\t\tid:this.data.id,\r\n\t\t\t\tcontact:this.data.contact,\r\n\t\t\t\temail:this.data.email,\r\n\t\t\t\tname:this.data.name,\r\n\t\t\t\treal_name:this.data.real_name,\r\n\t\t\t\tsex:this.data.sex,\r\n\t\t\t\tpassword:this.data.password,\r\n\t\t\t\tpools:pools,\r\n\t\t\t\tpermission: this.data.myrole.id\r\n\r\n\t\t\t},\r\n\t\t\t\tfunction(res){\r\n\t\t\t\t\tvar PERMISSION = item.permission;\r\n\t\t\t\t\titem.name = res.result.name;\r\n\t\t\t\t\titem.real_name = res.result.real_name;\r\n\t\t\t\t\titem.sex = res.result.sex;\r\n\t\t\t\t\titem.email = res.result.email;\r\n\t\t\t\t\titem.contact = res.result.contact;\r\n\t\t\t\t\titem.pool = res.result.pool;\r\n\t\t\t\t\titem.permission = res.name;\r\n\t\t\t\t\tif(user_id === user.id){\r\n\t\t\t\t\t\t$$$storage.setSessionStorage('power', $scope.data.roles.filter(item => item.name === res.name )[0].access_key)\r\n\t\t\t\t\t\tvar logInfor = UserRole.currentUser;\r\n\t\t\t\t\t\tlogInfor.keys = $$$storage.getSessionStorage(\"power\");\r\n\t\t\t\t\t\tlogInfor.pool = res.result.pool;\r\n\t\t\t\t\t\t$$$storage.setSessionStorage(\"loginInfo\", JSON.stringify(logInfor))\r\n\t\t\t\t\t\tif(item.permission != PERMISSION){ location.reload(); }\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t},\r\n\t\t\t\tfunction(){  }\r\n\t\t\t);\r\n\t\telse{\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t:$$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t:$$$I18N.get(\"POOL_TIP\"),\r\n\t\t\t\ttimeout\t:6000\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.controller(\"addUserCommonDialog\", [\"$scope\", \"$modalInstance\",\"User\", \"UserRole\", function($scope, $modalInstance, user, Role){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.data = {\r\n\t\tsex:'true',\r\n\t\trole:'2',\r\n\t\tdepartment: $scope.selected.id,\r\n\t\tredactor: Role.currentUser.name\r\n\r\n\t};\r\n\t$scope.master = {sex:'true',role_desc:'教师'};\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.master);\r\n\t};\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.master,$scope.data);\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\tconsole.log(666666666, $scope.data)\r\n\t\tuser.save(\r\n\t\t\t$scope.data,\r\n\t\t\tfunction(data){\r\n\t\t\t\t$scope.queryDepart();\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.controller(\"editUserCommonDialog\", [\"$scope\", \"$modalInstance\", \"User\", function($scope, $modalInstance, user){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\t$scope.data = angular.copy(item);\r\n\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem);\r\n\t};\r\n\t$scope.edit = function() {\r\n\t\tuser.edit({\r\n\t\t\tid: this.data.id,\r\n\t\t\tcontact:this.data.contact,\r\n\t\t\temail:this.data.email,\r\n\t\t\tname:this.data.name,\r\n\t\t\treal_name:this.data.real_name,\r\n\t\t\tsex:this.data.sex,\r\n\t\t\tpassword:this.data.password,\r\n\t\t\tpasswordConfirm: this.data.password,\r\n\t\t\tdesc: this.data.desc\r\n\t\t},function(res){\r\n\t\t\t$scope.queryDepart();\r\n\t\t\t$modalInstance.close();\r\n\t\t},function(){});\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.controller(\"addUserDomainDialog\", [\"$scope\", \"$modalInstance\", \"Server\", function($scope, $modalInstance, Server){\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem||{});\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\t\r\n\r\n\t$scope.ok=function(){\r\n\t\t$scope.submiting = true ;\r\n\t\t$scope.afterSubmiting =false ;\r\n\t\tServer.create($scope.data,function(response){\r\n\t\t\t$scope.submiting = false ;\r\n\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t$scope.rows.unshift(response.result[0]);\r\n\t\t\t$modalInstance.close();\r\n\t\t},function(){\r\n\t\t\t$scope.submiting = false ;\r\n\t\t\t$scope.afterSubmiting = false ;\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.data = {\"user\":\"\",\"passwd\":\"\"};\r\n}])\r\n.controller(\"editUserDomainDialog\", [\"$scope\", \"$modalInstance\", \"Server\", function($scope, $modalInstance, Server){\r\n\tvar item = $scope.item || $scope.currentItem||{};\r\n\t$scope.data = angular.copy(item);\r\n\tServer.get({\"id\":item.id},function(response){\r\n\t\tvar data=response;\r\n\t\tangular.forEach(data,function(value,key){\r\n\t\t\titem[key]=data[key];\r\n\t\t});\r\n\t},function(){\r\n\t});\r\n\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\r\n\t$scope.reset = function() {\r\n\t\t$scope.data=angular.copy($scope.item || $scope.currentItem||{});\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\t\r\n\r\n\t$scope.ok=function(){\r\n\t\t$scope.submiting = true ;\r\n\t\t$scope.afterSubmiting =false ;\r\n\t\tServer.update($scope.data,function(response){\r\n\t\t\tvar data=response.result[0];\r\n\t\t\tangular.forEach(data,function(value,key){\r\n\t\t\t\titem[key]=data[key];\r\n\t\t\t});\r\n\t\t\t$modalInstance.close();\r\n\t\t}, function(){\r\n\t\t\t$scope.submiting = false ;\r\n\t\t\t$scope.afterSubmiting = false ;\r\n\t\t});\r\n\t};\r\n}])\r\n.controller(\"userDoaminAscingDialog\", [\"$scope\", \"$modalInstance\", \"Domain\", function($scope, $modalInstance, Domain){\r\n\tvar domainId = parseInt(location.hash.match(/\\d+$/)[0]);\r\n\t$scope.selected=[];\r\n\r\n\tDomain.get({id: domainId},function(response){\r\n\t\t$scope.status = 'completed';\r\n\t\t$scope.ous = response.ous;\r\n\r\n\t},function(){\r\n\t\t$scope.status = 'completed';\r\n\t});\r\n\r\n\t$scope.ok = function(){\r\n\t\tDomain.asycing({\r\n\t\t\tid: domainId,\r\n\t\t\tauto: 0,\r\n\t\t\tous: $scope.selected.map(function(item){ return item.base_dn; })\r\n\t\t},function(response){\r\n\t\t\tresponse.result.map(function(item){\r\n\t\t\t\tvar len=$scope.rows.length,i;\r\n\t\t\t\tfor(i=0;i<len;i++){\r\n\t\t\t\t\tif(item.id==$scope.rows[i].id){\r\n\t\t\t\t\t\t$scope.rows[i]=item;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(i>=len){\r\n\t\t\t\t\t$scope.rows.push(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$modalInstance.close();\r\n\t\t},function(){});\r\n\t};\r\n\r\n\t$scope.select_row = function(item){\r\n\t\titem._selected = true;\r\n\t};\r\n\t$scope.select = function(item){\r\n\t\tif(item){\r\n\t\t\tif($scope.selected.filter(function(d){ return d.fullname==item.fullname; }).length==0)\r\n\t\t\t\t$scope.selected.push(item);\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.ous.filter(function(item){ return item._selected }).forEach(function(d){\r\n\t\t\t\tif($scope.selected.filter(function(data){ return data.fullname==d.fullname; }).length==0)\r\n\t\t\t\t\t$scope.selected.push(d);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\t$scope.removeSelected=function(_item){\r\n\t\tvar index;\r\n\t\tif(!_item){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tindex=$scope.selected.indexOf(_item);\r\n\t\tif(index>-1){\r\n\t\t\t$scope.selected.splice(index,1);\r\n\t\t}\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n.constant(\"NavigatorLink\", [\r\n\t{\r\n\t\t\"key\": \"Summary\",\r\n\t\t\"value\": \"概要\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-home\",\r\n\t\t\"url\": \"/summary\"\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Resource\",\r\n\t\t\"value\": \"资源\",\r\n\t\ticon: \"icon-jj-cloud\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Console\",\r\n\t\t\t\t\"value\": \"主控管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Resource\",\r\n\t\t\t\t\"url\": \"/resource/console\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Pool\",\r\n\t\t\t\t\"value\": \"资源池管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Resource\",\r\n\t\t\t\t\"url\": \"/resource/pool\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Storage\",\r\n\t\t\t\t\"value\": \"存储管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Resource\",\r\n\t\t\t\t\"url\": \"/resource/storage\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Network\",\r\n\t\t\"value\": \"网络\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-017\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"ManageNetwork\",\r\n\t\t\t\t\"value\": \"管理网络\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/manageNetwork\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"VirtualSwitch\",\r\n\t\t\t\t\"value\": \"分布式虚拟交换机\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/virtualSwitch\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"DataNetwork\",\r\n\t\t\t\t\"value\": \"数据网络\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/dataNetwork\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"DHCP\",\r\n\t\t\t\t\"value\": \"DHCP\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Network\",\r\n\t\t\t\t\"url\": \"/network/dhcp\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Desktop\",\r\n\t\t\"value\": \"桌面\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-pc\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Teaching_desktop\",\r\n\t\t\t\t\"value\": \"教学桌面\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Desktop\",\r\n\t\t\t\t\"url\": \"/desktop/scene\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Personal_desktop\",\r\n\t\t\t\t\"value\": \"个人桌面\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Desktop\",\r\n\t\t\t\t\"url\": \"/desktop/personal\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Personal_desktop_pool\",\r\n\t\t\t\t\"value\": \"个人桌面池\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Desktop\",\r\n\t\t\t\t\"url\": \"/desktop/pool\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Template\",\r\n\t\t\"value\": \"模板\",\r\n\t\ticon: \"icon-jj-Template\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Teaching_template\",\r\n\t\t\t\t\"value\": \"教学模板\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Template\",\r\n\t\t\t\t\"url\": \"/template/teach\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Personal_template\",\r\n\t\t\t\t\"value\": \"个人模板\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Template\",\r\n\t\t\t\t\"url\": \"/template/personal\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Hardware_template\",\r\n\t\t\t\t\"value\": \"硬件模板\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Template\",\r\n\t\t\t\t\"url\": \"/template/hardware\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Terminal\",\r\n\t\t\"value\": \"终端\",\r\n\t\ticon: \"icon-jj-Terminal\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Classroom\",\r\n\t\t\t\t\"value\": \"教室管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Terminal\",\r\n\t\t\t\t\"url\": \"/terminal/schoolroom\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Terminal_Manage\",\r\n\t\t\t\t\"value\": \"终端管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Terminal\",\r\n\t\t\t\t\"url\": \"/terminal/client\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"User\",\r\n\t\t\"value\": \"用户\",\r\n\t\ticon: \"icon-jj-men\",\r\n\t\t\"is_group\": true,\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Role_Manage\",\r\n\t\t\t\t\"value\": \"角色管理\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/role\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Administrator\",\r\n\t\t\t\t\"value\": \"管理用户\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/admin\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Common_user\",\r\n\t\t\t\t\"value\": \"普通用户\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/common\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Domain_user\",\r\n\t\t\t\t\"value\": \"域用户\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"User\",\r\n\t\t\t\t\"url\": \"/user/domain\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Monitor\",\r\n\t\t\"value\": \"监控\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-Monitor\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Host_monitoring\",\r\n\t\t\t\t\"value\": \"主机监控\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/host\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Desktop_monitoring\",\r\n\t\t\t\t\"value\": \"桌面监控\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/desktop\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Alarm_information\",\r\n\t\t\t\t\"value\": \"告警信息\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/alarm\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Alarm_policy\",\r\n\t\t\t\t\"value\": \"告警策略\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Monitor\",\r\n\t\t\t\t\"url\": \"/monitor/policy\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Timetable\",\r\n\t\t\"value\": \"排课\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-paike\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Course_list\",\r\n\t\t\t\t\"value\": \"课程列表\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Timetable\",\r\n\t\t\t\t\"url\": \"/scheduler/view\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"Plan\",\r\n\t\t\"value\": \"计划任务\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-012\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Timer_switch\",\r\n\t\t\t\t\"value\": \"定时开关机\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Plan\",\r\n\t\t\t\t\"url\": \"/plan/switch\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Host_switch\",\r\n\t\t\t\t\"value\": \"主机定时开关机\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"Plan\",\r\n\t\t\t\t\"url\": \"/plan/hostSwitch\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"HA\",\r\n\t\t\"value\": \"高可用性\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-001\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"desktop_ha\",\r\n\t\t\t\t\"value\": \"桌面HA\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"HA\",\r\n\t\t\t\t\"url\": \"/HA/desktop\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"System\",\r\n\t\t\"value\": \"系统\",\r\n\t\t\"is_group\": true,\r\n\t\ticon: \"icon-jj-Setup\",\r\n\t\t\"sublist\": [\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_deploy\",\r\n\t\t\t\t\"value\": \"快速部署\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/deploy\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_desktop\",\r\n\t\t\t\t\"value\": \"系统桌面\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/desktop\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_ISO\",\r\n\t\t\t\t\"value\": \"系统 ISO\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/iso\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"USB_redirection\",\r\n\t\t\t\t\"value\": \"USB 重定向\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/usb\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"USB_through\",\r\n\t\t\t\t\"value\": \"USB 透传\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/through\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"AutoSnapshot\",\r\n\t\t\t\t\"value\": \"自动快照\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/snapshot\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_set\",\r\n\t\t\t\t\"value\": \"系统设置\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/set\"\r\n\t\t\t},\r\n\t\t\t// {\r\n\t\t\t// \t\"key\": \"USB_device\",\r\n\t\t\t// \t\"value\": \"主机 USB 设备\",\r\n\t\t\t// \t\"is_group\": false,\r\n\t\t\t// \t\"belong\": \"System\",\r\n\t\t\t// \t\"url\": \"/system/device\"\r\n\t\t\t// },\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_backup\",\r\n\t\t\t\t\"value\": \"系统备份\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/backup\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"System_upgrade\",\r\n\t\t\t\t\"value\": \"系统升级\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/upgrade\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"key\": \"Operation_log\",\r\n\t\t\t\t\"value\": \"操作日志\",\r\n\t\t\t\t\"is_group\": false,\r\n\t\t\t\t\"belong\": \"System\",\r\n\t\t\t\t\"url\": \"/system/logs\"\r\n\t\t\t}\r\n\t\t\t// {\r\n\t\t\t// \t\"key\": \"End_log\",\r\n\t\t\t// \t\"value\": \"后台日志\",\r\n\t\t\t// \t\"is_group\": false,\r\n\t\t\t// \t\"belong\": \"System\",\r\n\t\t\t// \t\"url\": \"/system/endlogs\"\r\n\t\t\t// }\r\n\t\t]\r\n\t},\r\n\t{\r\n\t\t\"key\": \"About\",\r\n\t\t\"value\": \"关于\",\r\n\t\ticon: \"icon-jj-about-1\",\r\n\t\t\"is_group\": true,\r\n\t\t\"url\": \"/about\"\r\n\t}\r\n])\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/user/controllers.js","var $hashstr = location.hash.substr(1) || \"\";\r\nvar $hash = $hashstr.replace(/^\\/+/, \"\").split(\"&\");\r\nvar $id = parseInt($hash[0]);\r\nvar $is_windows = $hash[1].indexOf('Windows') > -1;\r\nvar $instance_id;\r\nvar $is_personalTemp = $hash[2]?true:false;\r\nvar $sameIp = $hashstr.split('=')[1] === \"true\" ? true : false;\r\nangular.module(\"vdi.vnc\", [\r\n    \"app.controllers\",\r\n    \"app.localize\",\r\n    \"ngResource\",\r\n    \"ui.bootstrap\",\r\n    \"vdi\",\r\n    \"vdi.desktop\",\r\n    \"vdi.template\",\r\n    \"vdi.template.teach\",\r\n    \"vdi.template.person\",\r\n    \"vdi.template.hardware\",\r\n    \"vdi.system\",\r\n    \"vdi.user\"\r\n])\r\n.controller(\"isoListController\", [\"$scope\", \"$modalInstance\", \"SystemISO\", \"VNC\", function($scope, $modalInstance, isos, vnc){\r\n    $scope.isos = [];\r\n    isos.get(function(data){\r\n        // console.log(data);\r\n        $scope.isos = data.isos;\r\n        $scope.selectIsos = {\r\n            'package': [],\r\n            'other': [],\r\n            'system': []\r\n        };\r\n        $scope.isos_package = data.isos.filter(function(item){\r\n            return item.type == 'package';\r\n        });\r\n        angular.forEach(data.isos,function(item){\r\n            if(item['type'] == 'package'){\r\n                $scope.selectIsos['package'].push(item);\r\n            }else if(item['type'] == 'other'){\r\n                $scope.selectIsos['other'].push(item);\r\n            }else{\r\n                $scope.selectIsos['system'].push(item);\r\n            }\r\n        });\r\n    });\r\n\r\n    $scope.ok = function(iso){\r\n        /*  thor/image/loadISO post instance_id iso_name */\r\n        console.log($scope, iso);\r\n\r\n        vnc.loadISO({\r\n            instance_id: $instance_id,\r\n            id: iso ? iso.id : \"-1\"\r\n        }, function(){\r\n            $modalInstance.close();\r\n        }, function(err){\r\n            //alert(err);\r\n        });\r\n\r\n    };\r\n    $scope.close = function(){\r\n        $modalInstance.close();\r\n    };\r\n}])\r\n.controller(\"updateTemplateController\", [\"$scope\", \"$modalInstance\",\"SystemISO\", function($scope, $modalInstance, isos){\r\n    $scope.isos = [];\r\n    isos.get(function(data){\r\n        $scope.isos = data.isos;\r\n    })\r\n\r\n    $scope.ok = function(){\r\n        $modalInstance.close();\r\n    };\r\n    $scope.close = function(){\r\n        $modalInstance.close();\r\n    };\r\n}])\r\n\r\n.controller(\"vncController\", [\r\n    \"$scope\", \"VMCommon\", \"VNC\", \"TeachTemplate\", \"PersonTemplate\", \"SystemISO\", \"Admin\", \"PersonDesktop\", \"$modal\", \"$timeout\", \"$$$os_types\", \"$$$I18N\",\r\n    function($scope, vm, vnc, template, personTemplate, iso, admin, desktop, $modal, $timeout, $$$os_types, $$$I18N){\r\n    var rfb;\r\n\r\n    var it = $scope;\r\n    //不同网卡上不能存在相同网段的IP提示框\r\n    function  duplicatedIp(){\r\n        if($sameIp){\r\n            $.bigBox({\r\n                title: $$$I18N.get(\"INFOR_TIP\"),\r\n                content:$$$I18N.get(\"不同网卡上不能存在相同网段的IP\"),\r\n                timeout:6000\r\n            });\r\n        }   \r\n    }\r\n    duplicatedIp();\r\n    function passwordRequired(rfb) {\r\n        var msg;\r\n        msg = '<form onsubmit=\"return setPassword();\"';\r\n        msg += '  style=\"margin-bottom: 0px\">';\r\n        msg += 'Password Required: ';\r\n        msg += '<input type=password size=10 id=\"password_input\" class=\"noVNC_status\">';\r\n        msg += '<\\/form>';\r\n        $D('noVNC_status_bar').setAttribute(\"class\", \"noVNC_status_warn\");\r\n        $D('noVNC_status').innerHTML = msg;\r\n    }\r\n    function setPassword() {\r\n        rfb.sendPassword($D('password_input').value);\r\n        return false;\r\n    }\r\n    function sendCtrlAltDel() {\r\n        rfb.sendCtrlAltDel();\r\n        return false;\r\n    }\r\n    function init_params(password, instance_id, vnc_host, vnc_token){\r\n        var host, port, password, path, token;\r\n        host = WebUtil.getQueryVar('host', vnc_host); // vnc_host\r\n        port = WebUtil.getQueryVar('port', 6080);\r\n        password = WebUtil.getQueryVar('password', password);\r\n        //path = WebUtil.getQueryVar('path', 'websockify?instance_id=' + instance_id);\r\n        token = WebUtil.getQueryVar('token', null);\r\n        if (token) {\r\n           WebUtil.createCookie('token', token, 1)\r\n        }       \r\n        path = WebUtil.getQueryVar('path', 'websockify?token=' + vnc_token);\r\n\r\n        rfb = new RFB({'target':       $D('noVNC_canvas'),\r\n                       'encrypt':      WebUtil.getQueryVar('encrypt',\r\n                                (window.location.protocol === \"https:\")),\r\n                       'repeaterID':   WebUtil.getQueryVar('repeaterID', ''),\r\n                       'true_color':   WebUtil.getQueryVar('true_color', true),\r\n                       'local_cursor': WebUtil.getQueryVar('cursor', true),\r\n                       'shared':       WebUtil.getQueryVar('shared', false),\r\n                       'view_only':    WebUtil.getQueryVar('view_only', false),\r\n                       'onUpdateState':  updateState,\r\n                       // 'onXvpInit':    xvpInit,\r\n                       'onPasswordRequired':  passwordRequired});\r\n\r\n        // rfb = new RFB({'target': $D('noVNC_canvas'),\r\n        //     'encrypt':    WebUtil.getQueryVar('encrypt',\r\n        //             (window.location.protocol === \"https:\")),\r\n        //     'true_color':   WebUtil.getQueryVar('true_color', true),\r\n        //     'local_cursor': WebUtil.getQueryVar('cursor', true),\r\n        //     'shared':      WebUtil.getQueryVar('shared', false),\r\n        //     'view_only':    WebUtil.getQueryVar('view_only', false),\r\n        //     'updateState':  updateState,\r\n        //     'onPasswordRequired':  passwordRequired});\r\n\r\n\r\n        rfb.connect(host, port, password, path);\r\n    }\r\n    function updateState(rfb, state, oldstate, msg) {\r\n        var s, sb, cad, level,save_as_temp,load_iso;\r\n        s = $D('noVNC_status');\r\n        sb = $D('noVNC_status_bar');\r\n        cad = $D('sendCtrlAltDelButton');\r\n        save_as_temp = $D('save_as_template');\r\n        load_iso = $D('load_iso')\r\n        switch (state) {\r\n            case 'failed':     level = \"error\";  break;\r\n            case 'fatal':       level = \"error\";  break;\r\n            case 'normal':     level = \"normal\"; break;\r\n            case 'disconnected': level = \"normal\"; break;\r\n            case 'loaded':     level = \"normal\"; break;\r\n            default:             level = \"warn\";   break;\r\n        }\r\n\r\n        if (typeof(msg) !== 'undefined') {\r\n        //    sb.setAttribute(\"class\", \"noVNC_status_\" + level);\r\n            s.innerHTML = msg;\r\n        }\r\n    }\r\n\r\n    $scope.instance_id = \"\";\r\n    $scope.is_template = false;\r\n    $scope.saveDisabled = false;$scope.undoDisabled = false;\r\n    $scope.is_windows = $is_windows;\r\n    $scope.is_personalTemp = $is_personalTemp;\r\n    $scope.instance_count = 0;\r\n    \r\n    function getStatus(){\r\n        $timeout(function(){\r\n            personTemplate.status({ id: $id }, function(res){\r\n                $scope.saveDisabled = (res.status === \"installed\" || res.status === \"alive\" || res.status === \"update failed\") ? true : false;\r\n                $scope.undoDisabled = (res.status === \"alive\") ? true : false;\r\n                getStatus();\r\n            });\r\n        }, 3000);\r\n    }\r\n\r\n    var flag = false;\r\n    function checkLoad(){\r\n        $timeout(function(){\r\n            if(!flag){\r\n                template.update(\r\n                    { id: $id },\r\n                    function(res){\r\n                        flag = true;\r\n                        $scope.is_template = res.is_template;\r\n                        $scope.instance_id = res.instance_id;\r\n                        $scope.os_type = res.os_type;\r\n                        $instance_id =  res.instance_id;\r\n                        $scope.passwd = res.passwd;\r\n                        $scope.vnc_host = res.vnc_host;\r\n                        $scope.image_name = res.image_name;\r\n                        init_params(res.passwd, res.instance_id, res.vnc_host, res.vnc_token);\r\n                        getStatus();\r\n                    },\r\n                    function(){\r\n                        checkLoad();\r\n                    }\r\n                );\r\n\r\n            }\r\n        }, 3000);\r\n    }\r\n    checkLoad();\r\n\r\n    $scope.status = function(){\r\n        return rfb ? rfb._rfb_state : \"\";\r\n    }\r\n    $scope.start = function(){\r\n        \r\n        if($scope.status() !== \"normal\"){\r\n            vm.start({instance_ids:[$scope.instance_id]},function(){\r\n                function _loop(){\r\n                    template.get_image_vnc_info({instance_id:$instance_id},function(res){\r\n                        init_params($scope.passwd, $scope.instance_id, $scope.vnc_host, res.result.token);\r\n                        setTimeout(function(){\r\n                            console.log($scope.status());\r\n                            if($scope.status() !== \"normal\"){\r\n                                _loop();\r\n                            }\r\n                        }, 1000);\r\n                    },function(){});\r\n                }\r\n                _loop();\r\n            })\r\n        }\r\n        else{\r\n            alert(\"System has been in the boot state\")\r\n        }\r\n    };\r\n    $scope.shutdown = function(){\r\n        var instance_id = $scope.instance_id;\r\n        if($scope.status() === \"normal\"){\r\n            $modal.open({\r\n            template: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机确认'>\"+\r\n                    \"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CLIENTMODIFY_SHUT'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n                controller : function($scope, $modalInstance){\r\n                    $scope.ok = function(){\r\n                        vm.shutdowns(\r\n                            {instance_ids:[instance_id]},\r\n                            function(){\r\n                                $modalInstance.close();\r\n                            },\r\n                            function(){}\r\n                        );\r\n                    },\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    }\r\n                },\r\n                size : \"sm\"\r\n            });\r\n        }\r\n        else{\r\n            alert(\"System has been in the under off state\")\r\n        }\r\n    };\r\n    $scope.CAD = function(){\r\n        rfb.sendCtrlAltDel();\r\n    };\r\n    // $scope.updateTemplate = function(){\r\n        //     if($scope.is_template){\r\n        //         vnc.save({\r\n        //             instance_id: $scope.instance_id,\r\n        //             image_id: $id\r\n        //         }, function(){\r\n        //             $D('noVNC_status').innerHTML = \"Update directive has been sent\";\r\n        //             rfb.disconnect();\r\n        //         });\r\n        //     }\r\n        //     else{\r\n        //         rfb.disconnect();\r\n        //         var p_scope = $scope;\r\n        //         $modal.open({\r\n        //             templateUrl: \"views/vdi/dialog/desktop/personal_save_template.html\",\r\n        //             size: \"md\",\r\n        //             controller: [\"$scope\", \"$modalInstance\", function($scope, $modalInstance){\r\n        //                 $scope.min_namelength=2;$scope.max_namelength=20;\r\n        //                 admin.query(function(res){\r\n        //                     $scope.owners = res.users;\r\n        //                     $scope.owner = $scope.owners[0];\r\n        //                 });\r\n        //                 $scope.classifys = $$$os_types;\r\n        //                 $scope.classify = $scope.classifys[0];\r\n\r\n        //                 $scope.selectTemplate = function(item){\r\n        //                     $scope.template = item;\r\n        //                 };\r\n        //                 $scope.ok = function(){\r\n        //                     // console.log($scope, this);\r\n        //                     if(this.saveTemplate.$valid){\r\n        //                         // return;\r\n        //                         desktop.saveAsTemplate({\r\n        //                             instance_id: p_scope.instance_id,\r\n        //                             os_type: p_scope.os_type,\r\n        //                             name: this.name,\r\n        //                             type_code: this.type,\r\n        //                             owner: $scope.owner.id\r\n        //                         }, function(res){\r\n        //                             //console.log(124124);\r\n        //                             $modalInstance.close();\r\n        //                         });\r\n        //                     }\r\n        //                 };\r\n        //                 $scope.close = function(){\r\n        //                     location.reload();\r\n        //                     $modalInstance.close();\r\n        //                     init_params(it.passwd, it.instance_id);\r\n        //                 };\r\n        //             }]\r\n        //         });\r\n        //     }\r\n    // };\r\n    var p_scope = $scope;\r\n    $scope.save = function(){\r\n            \r\n            $modal.open({\r\n                template: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='保存'>\"+\r\n                        \"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='TEMP_SAVE_TIP'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n                    controller : function($scope, $modalInstance){\r\n                        $scope.ok = function(){\r\n                            console.log(p_scope.is_template)\r\n                            if(p_scope.is_template){\r\n                                template.bt_save_template({\r\n                                    image_id: p_scope.image_id\r\n                                },\r\n                                function(res){\r\n                                    $modalInstance.close();\r\n                                });\r\n                            }\r\n                            else{\r\n                                desktop.saveAsTemplate({\r\n                                    instance_id: p_scope.instance_id,\r\n                                    instance_type : p_scope.instance_type,\r\n                                    os_type: p_scope.os_type,\r\n                                    name: p_scope.image_name,\r\n                                    type_code: p_scope.type_code,\r\n                                    owner: p_scope.owner\r\n                                },\r\n                                function(res){\r\n                                    $modalInstance.close();\r\n                                })                                \r\n                            }\r\n\r\n                        };\r\n                        $scope.close = function(){\r\n                            $modalInstance.close();\r\n                        }\r\n                    },\r\n                    size : \"sm\"\r\n                });\r\n        };\r\n    $scope.undo = function(){\r\n        $modal.open({\r\n            template: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='撤销本次'>\"+\r\n                    \"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='TEMP_UNDO_TIP'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n                controller : function($scope, $modalInstance){\r\n                    $scope.ok = function(){\r\n                        template.bt_prev_save_template({\r\n                            image_id: p_scope.image_id\r\n                        },\r\n                        function(res){\r\n                            $modalInstance.close();\r\n                        });\r\n                    };\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    }\r\n                },\r\n                size : \"sm\"\r\n            });\r\n        };\r\n\r\n    $scope.expand = function(){\r\n        rfb.disconnect();\r\n        $modal.open({\r\n            template: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='扩容模板C盘'>\"+\r\n                    \"</h4></div><div class='modal-body'><form class='form-horizontal' name='expendTemplate' ng-submit='expendTemplate.$valid' novalidate>\"+\r\n                        \"<div >\"+\r\n                            \"<label class='col-xs-4 control-label required' for='expand' data-localize='扩容大小'></label>\"+\r\n                            \"<div class='col-xs-4'>\"+\r\n                                \"<input class='form-control' id='expand' type='text'\"+\r\n                                    \"name='expand'\"+\r\n                                    \"required \"+\r\n                                    \"data-ng-model='expand'\"+\r\n                                    \"placeholder='1-10'\"+\r\n                                    \"data-ng-pattern='/^\\s*([1-9]|10)\\s*$/'\"+\r\n                                    \"data-ng-trim='false'\"+\r\n                                \">\"+\r\n                            \"</div><span class='col-xs-2' style='margin-top: 9px;padding-left: 0;'>GB</span>\"+\r\n                        \"</div><br><footer class='text-right' style='margin-top: 40px;'><button class='btn btn-primary' data-ng-disabled='expendTemplate.$invalid'  data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n                controller : function($scope, $modalInstance){\r\n                    $scope.ok = function(){\r\n                        vm.undo({instance_ids:[$scope.instance_id]},\r\n                        function(res){\r\n                            $modalInstance.close();\r\n                        })\r\n                    };\r\n                    $scope.close = function(){\r\n                        location.reload();\r\n                        $modalInstance.close();\r\n                        init_params(it.passwd, it.instance_id);\r\n                    }\r\n                },\r\n                size : \"sm\"\r\n            });\r\n        };\r\n    \r\n    $scope.loadISO = function(){\r\n        $modal.open({\r\n            templateUrl: \"/select-iso.html\",\r\n            controller: \"isoListController\",\r\n            size: \"md\"\r\n        });\r\n    };\r\n}])\r\n.run([\"$rootScope\", \"settings\", \"localize\", function($rootScope, settings, localize){\r\n    var lang_code = $$$storage.getSessionStorage('lang_code');\r\n    settings.currentLang = settings.languages.filter(function(lang){\r\n        return lang.langCode === lang_code;\r\n    })[0] || settings.languages[0]; // zh_cn\r\n    //console.log(settings.currentLang, settings, localize);\r\n    localize.setLang(settings.currentLang);\r\n}]);\r\n\r\n;\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/modify.bt.page.js","angular.module(\"vdi.template\", [])\r\n\r\n/* 模板 */\r\n.factory(\"registerTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"get\", url: $Domain + \"/thor/image/register\" },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/register\" }\r\n\t});\r\n}])\r\n.factory(\"Network\", [\"$resource\", \"$Domain\", function($resource, $Domain){\r\n\treturn $resource($Domain + \"/thor/networks\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", isArray: false, params: null},\r\n\t\tadd:\r\n\t\t\t{ method: \"POST\", isArray: false},\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/:id\", params: { id: \"@id\" }, isArray: false},\r\n\t\talter:\r\n\t\t\t{ method: \"PUT\", url:$Domain + \"/thor/network/:id\", params: { id: \"@id\" }, isArray: false},\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url:$Domain + \"/thor/network/:id\", params: { id: \"@id\" }, isArray: false},\r\n\r\n\t\tquery_sub:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/:id/subnets\", params: { id: \"@id\" }},\r\n\t\tadd_sub:\r\n\t\t\t{ method: \"POST\", url:$Domain + \"/thor/network/:id/subnets\", params: { id: \"@id\" }},\r\n\r\n\t\tget_sub:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/subnet/:id\", params: { id: \"@id\" }},\r\n\t\talter_sub:\r\n\t\t\t{ method: \"PUT\", url:$Domain + \"/thor/network/subnet/:id\", params: { id: \"@id\" }},\r\n\t\tdelete_sub:\r\n\t\t\t{ method: \"DELETE\", url:$Domain + \"/thor/network/subnet/:id\", params: { id: \"@id\" }},\r\n\t\tports:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/network/subnet/:id/ports\", params: { id: \"@id\" }}\r\n\r\n\t});\r\n}])\r\n\r\n.factory('ResourcePool', [\"$resource\", \"$Domain\", function($resource,$Domain){\r\n\treturn $resource($Domain + \"/thor/resource\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\"}\r\n\t});\r\n}])\r\n/* 模板镜像分发 */\r\n.factory(\"manageTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/manage/:id\", params: { id: \"@id\" } },\r\n\t\thandout:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/manage/:id\", params: { id: \"@id\" } },\r\n\t\tdelete:\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/image/manage/:id\", params: { id: \"@id\" } }\r\n\t});\r\n}])\r\n/* 根据虚拟化类型返回可用主机列表 */\r\n.factory(\"virtualHost\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/hosts_with_virtual_type\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/hosts_with_virtual_type\" }\r\n\t});\r\n}])\r\n/* 根据主机查找可用网络 */\r\n.factory(\"networkWithHost\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/list_network_with_host\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/list_network_with_host\" }\r\n\t});\r\n}])\r\n\r\n.factory(\"checkIP\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/check_ip\", null, {\r\n\t\tcheck:\r\n\t\t\t{ method: \"GET\" }\r\n\t});\r\n}])\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controllers.js","angular.module(\"vdi.template.teach\", [\"vdi.template\"])\r\n.directive(\"downloadUrl\", ['$http', function($http){\r\n\treturn {\r\n\t\trestrict: \"A\",\r\n\t\tlink: function(scope, element, attrs){\r\n\t\t\tvar url_arry = JSON.parse(attrs.urls.split(\",\"));\r\n\t\t\turl_arry.forEach(function(item){\r\n\t\t\t\t$(element).append('<iframe style=\"width: 0; height: 0;\" src=\"\" id=\"'+ item +'\" frameborder=\"0\"></iframe>')\r\n\t\t\t});\r\n\t\t\t$(element).click(function(e){\r\n\t\t\t\turl_arry.forEach(function(item){\r\n\t\t\t\t\t$(element).find('#'+item)[0].contentWindow.location = scope.domain +'/thor/image/download/'+ item;\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n}])\r\n.factory(\"TeachTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/1\", isArray: false },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/modify_template/:id\", params: { id: \"@id\" } },\r\n\t\tlistModes:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" }, isArray: false },\r\n\t\tapplyTemplate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" } },\r\n\t\tstatus:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/status/:id\", params: { id: \"@id\" } },\r\n\t\tcopy:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/clone_template\"},\r\n\t\tmodify:\r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/image/1\", isArray: false },\r\n\t\tinfor:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/info\" },\r\n\t\tspiceConnectInfo:\r\n\t\t\t{ method:\"GET\", url: $Domain + \"/compute/v1/instances/connection\"},\r\n\t\tvirtualStatus:\r\n\t\t\t{method:\"GET\", url: $Domain + \"/compute/v1/instances/:id/status\",params:{id:\"@id\"}},\r\n\t\tdownload:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/download/:id\", params: { id: \"@id\" } },\r\n\t\treset:\r\n\t\t\t{ method: \"post\", url: $Domain + \"/thor/image/reset_template\" },\r\n\t\tget_image_vnc_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_vnc_info\" },\r\n\t\tget_image_rdp_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_rdp_info\" },\r\n\t\tsync:\r\n\t\t\t{ method: \"post\", url: $Domain + \"/thor/image/bt_sync_template\" },\r\n\t\tsync_status:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/bt_sync_status\" },\r\n\t\tbt_before_edit_template:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_before_edit_template\" },\r\n\t\tbt_save_template:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_save_template\" },\r\n\t\tbt_prev_save_template:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_prev_save_template\" },\r\n\t\tbt_sync_retry:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_sync_retry\" },\r\n\t\tbt_sync_repair:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/bt_sync_repair\" },\r\n\t\tupdate_tpl_tip:\r\n\t\t\t{method:\"GET\",url:$Domain + \"/thor/controller/ha_storage_state\"}\r\n\t});\r\n}])\r\n\r\n.controller(\"vdiTemplateTeachDesktopListController\",[\r\n\"$scope\", \"$modal\", \"TeachTemplate\", \"PersonTemplate\", \"$route\", \"Admin\", \"TeachDesktop\", \"$interval\", \"$filter\", \"$$$os_types\", \"$Domain\", \"Network\", \"$http\", \"$$$I18N\", \"ResourcePool\", \"manageTemplate\", \"VMCommon\", \"networkWithHost\", \"virtualHost\",\"UserRole\", \r\nfunction($scope, $modal, template, tmpl, $route,  admin, teachdesktop,$interval, $filter, $$$os_types, $Domain, network,$http, $$$I18N, ResourcePool, manageTemplate, vm, networkWithHost, virtualHost, UserRole){\r\n\t// teachdesktop.query({ id : $route.current.params.id }, function(res){\r\n\t// \tconsole.log(787878,res.result)\r\n\t// });\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.domain = $Domain;\r\n\t$scope.rows = []; $scope.allrows = [];\r\n\t\r\n\t$scope.images = [];\r\n\t$scope.loading = true;\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesizes = [30,20,10];\r\n    $scope.pagesize = $scope.pagesizes[0];\r\n\r\n    $scope.orders = [ {name: $$$I18N.get(\"按创建时间排序\"), val: 'time'}, {name: $$$I18N.get(\"按模板名称排序\"), val: 'name'}];\r\n    $scope.order = $scope.orders[0];\r\n    $scope.sortTem = function(val){\r\n    \tif(val == 'time'){\r\n    \t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n    \t}\r\n    \telse{\r\n    \t\t$scope.rows.sort(function(a,b){ return a.name>b.name? 1:-1 });\r\n    \t}\r\n    }\r\n\r\n\t$interval(function(){\r\n\t\t$scope.rows && $scope.$root && $scope.$root.$broadcast(\"imageIDS\", $scope.rows.map(function(item){ return item.id }));\r\n\t}, 1000);\r\n\t$scope.$on(\"imagesRowsUpdate\", function($event, data){\r\n\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.rows = $scope.rows.filter(function(item){ return item.type_code ===1 });\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tif($scope.sync_mode==='bt'){\r\n\t\t\t\tif(row.sync_status){\r\n\t\t\t\t\tvar syncFaildLen = row.sync_status.filter(function(item){ return item.status === \"sync failed\" || item.status === \"no space left\" || item.sch == 'time out'}).length;\r\n\t\t\t\t\tvar syncDownloading = row.sync_status.filter(function(item){ return item.status === \"downloading\" }).length;\r\n\t\t\t\t\tif(syncFaildLen){\r\n\t\t\t\t\t\trow.sync_status.syncFaild = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(syncDownloading && !syncFaildLen){\r\n\t\t\t\t\t\trow.sync_status.syncing = true;\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tif(row.sync_status){\r\n\t\t\t\t\tvar updateInfor = row.sync_status.filter(function(item){ return item.type === \"image\" });\r\n\t\t\t\t\tif(updateInfor.length!==0)\r\n\t\t\t\t\t\trow.updateSize = (updateInfor[0].size/1024/1024/1024).toFixed(2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\t$scope.$root.$broadcast(\"syncTempl\", $scope.rows);\r\n\t\t// $scope.allrows = $scope.rows;\r\n\r\n\t});\r\n\r\n\ttemplate.query(function(res){\r\n\t\t$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t});\r\n\t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t$scope.sync_mode = res.sync_mode;\r\n\t\t$scope.loading = false;\r\n\t\t$scope.teachNames = $scope.rows.map(function(item){ return item.name });\r\n\t\t$scope.sameName = false;\r\n\r\n\t\t$scope.allrows = $scope.rows;\r\n\t\tif($$$storage.getSessionStorage('virtual_type_T')!=='all')\r\n\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === $$$storage.getSessionStorage('virtual_type_T') });\r\n\t});\r\n\r\n\t$scope.select = $$$storage.getSessionStorage('virtual_type_T') || 'all';\r\n\t$scope.$watch(\"select\",function(newvalue){\r\n\t\tif(newvalue){\r\n\t\t\tif(newvalue!=='all'){\r\n\t\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === newvalue });\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t$scope.rows = $scope.allrows;\r\n\t\t\t}\r\n\t\t\t$$$storage.setSessionStorage('virtual_type_T', newvalue);\r\n\t\t}\r\n\t});\r\n\tvar _controllerScope = $scope;\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除教学模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t$scope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.delete({ id: rows.map(function(item){ return item.id }) },function(res){\r\n\t                \ttemplate.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\ttemplate.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.shutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar rows_active = rows.filter(function(item){ return item.instance_status === 'running' });\r\n\t\tif(!rows_active.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"SHUTOFF_TIP\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='shutdown_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><img data-ng-if='loading' src='./img/building.gif' width='24px'><button class='btn btn-primary' data-ng-if='!loading' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t\t$scope.name = rows_active.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\t\tvm.shutdowns({ instance_ids: rows_active.map(function(item){ return item.instance_id }) },function(res){\r\n\t\t\t\t\t\t\trows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\t\tif(item.id === row.id){\r\n\t\t\t\t\t\t\t\t\t\titem.instance_status = \"shutdown\";\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize: \"sm\"\r\n\t\t\t});\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.syncTem = function(item){\r\n\t\t$scope.loading = false;\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_sync.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\tif(!$scope.sync_status){\r\n\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t}\r\n\t\t\t\t$scope.name = item.name;\r\n\t\t\t\t$scope.$on(\"syncTempl\", function($event, data){\r\n\t\t\t\t\tvar thistmpl = data.filter(function(r){ return r.id === item.id })[0];\r\n\t\t\t\t\t$scope.sync_status = thistmpl.sync_status;\r\n\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t})\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.Retry = function(temp){\r\n\t\t\t\t\tvar data = {image_id: temp.image, server_ip: temp.server_ip, server_id: temp.server_id, version: temp.version}\r\n\t\t\t\t\ttemplate.bt_sync_retry(data, function(res){\r\n\r\n\t\t\t\t\t}, function(){})\r\n\t\t\t\t};\r\n\t\t\t\t$scope.Repair = function(temp){\r\n\t\t\t\t\tvar data = {image_id: temp.image, server_ip: temp.server_ip, server_id: temp.server_id, version: temp.version};\r\n\t\t\t\t\ttemplate.bt_sync_repair(data, function(res){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}, function(){})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"lg\"\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\r\n\t$scope.update = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_mode_list.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.modes = [];\r\n\t\t\t\ttemplate.listModes({ id: item.id }, function(res){\r\n\t\t\t\t\t$scope.modes = res.modes;\r\n\t\t\t\t},function(){ $scope.noScense = true });\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.applyTemplate({ id: item.id }, function(res){\r\n\t\t\t\t\t\t/* doSTH */\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.trigger = function(){\r\n\t\t$scope.rows.some(function(row){\r\n\t\t\trow._selected;\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.copy = function(item){\r\n\t\t $modal.open({\r\n                templateUrl: \"views/vdi/dialog/template/template_copy.html\",\r\n                size: \"md\",\r\n                controller: [\"$scope\", \"$modalInstance\", function($scope, $modalInstance){\r\n                    $scope.min_namelength=2;$scope.max_namelength=20;\r\n                    $scope.is_copy = true;\r\n                    $scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n                    $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n                    $scope.types = $scope.types2;\r\n                    $scope.bind_ip_type = $scope.types2[0];\r\n                    admin.query(function(res){\r\n                        $scope.owners = res.users;\r\n                        angular.forEach($scope.owners, function(item){\r\n                        \tif(item.name == user.name){\r\n                        \t\t$scope.owner = item;\r\n                        \t}\r\n                        });\r\n                        if(!$scope.owner) {\r\n                        \t$scope.owner = $scope.users[0]\r\n                        }\r\n                    });\r\n                    $scope.type = '1';\r\n                    $scope.temCopy = false;\r\n                    \r\n                    $scope.temData = item;\r\n                    $scope.getVirtualHost = function (type,rbd_enabled){\r\n                    \t$scope.host_loading = true;\r\n                    \tvirtualHost.query({\r\n                    \t\tvirtual_type: type,\r\n                    \t\trbd_enabled: rbd_enabled\r\n                    \t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n                    \t},function(res){\r\n                    \t\t$scope.host_loading = false;\r\n                    \t\t$scope.hosts = res.result;\r\n                    \t\t$scope.host = $scope.hosts[0];\r\n                    \t\t$scope.getNetwork($scope.host);\r\n                    \t},function(){\r\n\r\n                    \t});\r\n                    }\r\n                    $scope.getVirtualHost(item.virtual_type,item.rbd_enabled);\r\n\r\n                    // function getIps(subnet_id, _scope){\r\n                    // \tif(subnet_id)\r\n                    // \t\tnetwork.ports({ id: subnet_id },function(res){\r\n                    // \t\t\tif(res.unused_ips.length){\r\n                    // \t\t\t\t_scope.band_ips = res.unused_ips;\r\n                    // \t\t\t}\r\n                    // \t\t\telse{\r\n                    // \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n                    // \t\t\t}\r\n                    // \t\t\t_scope.bind_ip_loading = false;\r\n                    // \t\t})\r\n                    // };\r\n                    $scope.switchIps = function(subnet,_scope){\r\n                    \t// _scope.bind_ip_loading = true;\r\n                    \tif(subnet){\r\n                    \t\t// getIps(subnet.id, _scope);\r\n                    \t\t_scope.types = _scope.types2;\r\n                    \t\t_scope.bind_ip_type = _scope.types2[0];\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.types = _scope.types1;\r\n                    \t\t_scope.band_ips = [];\r\n                    \t\t_scope.bind_ip_type = _scope.types1[0];\r\n                    \t\t// _scope.bind_ip_loading = false;\r\n                    \t}\r\n                    };\r\n                    function getSubnets(Network,_scope){\r\n                    \tif(Network.subnets.length){\r\n                    \t\t$scope.network_loading = true;\r\n                    \t\t// $scope.bind_ip_loading = true;\r\n                    \t\tnetwork.query_sub({id: Network.id }, function(res){\r\n                    \t\t\t_scope.subnets = res.result;\r\n                    \t\t\t_scope.subnet = _scope.subnets[0];\r\n                    \t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t\t\t$scope.network_loading = false;\r\n                    \t\t})\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.subnets = [];\r\n                    \t\t_scope.subnet = null;\r\n                    \t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t}\r\n                    };\r\n                    $scope.getNetwork = function(host){\r\n                    \tif(host){\r\n                    \t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n                    \t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n                    \t\t\t$scope.networks = res.result;\r\n                    \t\t\t$scope.network = $scope.networks[0];\r\n                    \t\t\tgetSubnets($scope.network, $scope);\r\n                    \t\t}, function(){});\r\n                    \t}\r\n                    }\r\n\r\n                    $scope.switchSubnet = function(val, _scope){\r\n                    \tgetSubnets(val,_scope);\r\n                    }\r\n                    $scope.bind_ip = {value: null};\r\n                    $scope.ok = function(){\r\n                    \tvar bindIP = this.bind_ip.value;\r\n                    \t// var unUseIP = this.band_ips.filter(function(item){ return item===bindIP });\r\n                    \t// if(this.bind_ip_type.value === 'static' && bindIP === '无可用IP'){\r\n                    \t// \t$.bigBox({\r\n                    \t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n                    \t// \t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n                    \t// \t\ttimeout\t: 6000\r\n                    \t// \t});\r\n                    \t// }else if(this.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){\r\n                    \t// \t$.bigBox({\r\n                    \t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n                    \t// \t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n                    \t// \t\ttimeout\t: 6000\r\n                    \t// \t});\r\n                    \t// }else{\r\n\t                \t\t$scope.temCopy = true;\r\n\t                \t\tvar _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;\r\n\t                        template.copy({\r\n\t                    \t\tname: this.name,\r\n\t                    \t\tdescription: this.description,\r\n\t                    \t\timage_id : item.id,\r\n\t                    \t    type_code: this.type,\r\n\t                    \t    owner: $scope.owner.id,\r\n\t                    \t    network: this.network.id,\r\n\t                    \t    subnet: this.subnet?this.subnet.id:'',\r\n\t                    \t    band_ip: _ip,\r\n\t                    \t    band_type: this.bind_ip_type.value,\r\n\t                    \t    host_uuid: this.host.host_uuid\r\n\t                    \t    // enable_gpu: item.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n\t                        }, function(res){\r\n\t                        \ttemplate.query(function(res){\r\n\t                        \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n\t        \t\t\t\t\t\t\t\treturn item;\r\n\t        \t\t\t\t\t\t\t}\r\n\t        \t\t\t\t\t\t\telse{\r\n\t        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n\t        \t\t\t\t\t\t\t}\r\n\t        \t\t\t\t\t\t});\r\n\t                        \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t                        \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t                        \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t                        \t});\r\n\t                        \t$modalInstance.close(); \r\n\t                        }, function(){\r\n\t                        \t$scope.temCopy = false;\r\n\t                        });\r\n\t                    \t// }\r\n\t                    }\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    };\r\n                } ]\r\n            });\r\n\t};\r\n\r\n\t$scope.sync = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='SYNC_TEM'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='SYNC_TEM_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.sync({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.undoSync = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='UNDO_SYNC_TEM'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='TEM_UNDOSYNC' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.bt_before_edit_template({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.modify = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_modify.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t\t\t\t$scope.types = $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t\t\t\t$scope.virtual_type = item.virtual_type;\r\n\t\t\t\t$scope.disabled_gpu = item.disabled_gpu;\r\n\t\t\t\t$scope.data = {vcpus: 1, ram: 1.5, system_alloc_disk: 10, bind_ip_type: $scope.types2[1]};\r\n\t\t\t\tvar oldData = {};\r\n\t\t\t\tfunction getSubnets(Network, subnet_id, flag){\r\n\t\t\t\t\tif(Network.subnets.length){\r\n\t\t\t\t\t\t$scope.network_loading = true;\r\n\t\t\t\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t\t\t\t$scope.data.subnets = res.result;\r\n\t\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\t\toldData.subnets = $scope.data.subnets;\r\n\t\t\t\t\t\t\t\toldData.subnet = $scope.data.subnet = $scope.data.subnets.filter(function(data){ return data.id === subnet_id })[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = $scope.data.subnets[0];\r\n\t\t\t\t\t\t\t\tif($scope.data.subnet)\r\n\t\t\t\t\t\t\t\t\tgetIps($scope.data.subnet.id, $scope.cur_imgInfor.nets.ip_address, false);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$scope.network_loading = false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.data.subnets = [];\r\n\t\t\t\t\t\t$scope.data.subnet = null;\r\n\t\t\t\t\t\t$scope.switchIps($scope.data.subnet);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tfunction getIps(subnet_id, curr_ip, flag){\r\n\t\t\t\t\tif(subnet_id){\r\n\t\t\t\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];\r\n\t\t\t\t\t\t\toldData.band_ips = $scope.data.band_ips;\r\n\t\t\t\t\t\t\toldData.band_ip = $scope.data.band_ip = curr_ip;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// network.ports({ id: subnet_id },function(res){\r\n\t\t\t\t\t\t// \tif(res.unused_ips.length){\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ips = res.unused_ips;\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ips = [\"无可用IP\"];\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t// \tif(subnet_id===$scope.cur_imgInfor.nets[0].subnet_id){\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ips.push(curr_ip);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \tif(flag){\r\n\t\t\t\t\t\t// \t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];\r\n\t\t\t\t\t\t// \t\toldData.band_ips = $scope.data.band_ips;\r\n\t\t\t\t\t\t// \t\toldData.band_ip = $scope.data.band_ip = curr_ip;\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t// \t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \t$scope.bind_ip_loading = false;\r\n\t\t\t\t\t\t// });\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.switchSubnet = function(val){\r\n\t\t\t\t\tgetSubnets(val, $scope.cur_imgInfor.nets.network_id, false);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.switchIps = function(subnet){\r\n\t\t\t\t\tif(subnet){\r\n\t\t\t\t\t\tgetIps(subnet.id,$scope.cur_imgInfor.nets.ip_address, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.addbtndisk = function(){\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.minusbtndisk = function(){\r\n\t\t\t\t\tif($scope.old_data_alloc_disk && !$scope.old_data_alloc_disk_2){\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(templateInfor){\r\n\r\n\t\t\t\t\t$scope.cur_imgInfor = templateInfor;\r\n\t\t\t\t\toldData.name = $scope.data.name = templateInfor.name;\r\n\t\t\t\t\toldData.description = $scope.data.description = templateInfor.description;\r\n\t\t\t\t\tgetIps(templateInfor.nets[0].subnet_id, templateInfor.nets[0].ip_address, true);\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t$scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t\t\t$scope.networks = data.networks;\r\n\t\t\t\t\t\toldData.network = $scope.data.network = $scope.networks.filter(function(data){ return data.id===templateInfor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tgetSubnets($scope.data.network,templateInfor.nets[0].subnet_id, true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\toldData.enable_gpu = $scope.data.enable_gpu= templateInfor.enable_gpu;\r\n\t\t\t\t\toldData.vcpus = $scope.data.vcpus= templateInfor.vcpus;\r\n\t\t\t\t\toldData.ram = $scope.data.ram= templateInfor.ram/1024;\r\n\t\t\t\t\toldData.system_alloc_disk = $scope.data.system_alloc_disk= templateInfor.system_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk = $scope.data.data_alloc_disk= templateInfor.data_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk_2 = $scope.data.data_alloc_disk_2= templateInfor.data_alloc_disk_2;\r\n\t\t\t\t\t$scope.old_data_alloc_disk = templateInfor.data_alloc_disk;\r\n\t\t\t\t\t$scope.old_data_alloc_disk_2 = templateInfor.data_alloc_disk_2;\r\n\r\n\t\t\t\t})\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\t$scope.oldData = angular.copy($scope.data);\r\n\t\t\t\t\r\n\t\t\t\t$scope.isUnchanged = function(){\r\n\t\t\t\t\treturn angular.equals(oldData,$scope.data)\r\n\t\t\t\t}\r\n\t\t\t\t$scope.reset = function(){\r\n\t\t\t\t\tif(oldData.bind_ip_type.value!=='none'){\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.data = angular.copy(oldData);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t// if($scope.data.system_alloc_disk < oldData.system_alloc_disk || $scope.data.data_alloc_disk_2 < oldData.data_alloc_disk_2 || $scope.data.data_alloc_disk < oldData.data_alloc_disk){\r\n\t\t\t\t\t// \t$.bigBox({\r\n\t\t\t\t\t// \t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t// \t\t\tcontent : $$$I18N.get(\"modifyTemTip\"),\r\n\t\t\t\t\t// \t\t\ttimeout : 6000\r\n\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t// var bindIP = $scope.data.band_ip;\r\n     //            \tvar unUseIP = $scope.data.band_ips.filter(function(item){ return item===bindIP });\r\n     //            \tif($scope.data.bind_ip_type.value === 'static' && bindIP === '无可用IP'){\r\n     //            \t\t$.bigBox({\r\n     //            \t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n     //            \t\t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n     //            \t\t\ttimeout\t: 6000\r\n     //            \t\t});\r\n     //            \t}else if($scope.data.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){\r\n     //            \t\t$.bigBox({\r\n     //            \t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n     //            \t\t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n     //            \t\t\ttimeout\t: 6000\r\n     //            \t\t});\r\n     //            \t}else{\r\n\t\t\t\t\t\t$scope.submit_loading = true;\r\n\t\t\t\t\t\ttemplate.modify({\r\n\t\t\t\t\t\t\timage_id: item.id,\r\n\t\t\t\t\t\t\tinstance_id: item.instance_id,\r\n\t\t\t\t\t\t\ttemplate_name: $scope.data.name,\r\n\t\t\t\t\t\t\tdescription: $scope.data.description,\r\n\t\t\t\t\t\t\tnetwork: $scope.data.network.id,\r\n\t\t\t\t\t\t\tsubnet: $scope.data.subnet?$scope.data.subnet.id:\"\",\r\n\t\t\t\t\t\t\tband_ip: $scope.data.bind_ip_type.value === 'static' ? $scope.data.band_ip:undefined,\r\n\t\t\t\t\t\t\tband_type: $scope.data.bind_ip_type.value,\r\n\t\t\t\t\t\t\tvcpus: $scope.data.vcpus,\r\n\t\t\t\t\t\t\tram: $scope.data.ram,\r\n\t\t\t\t\t\t\tenable_gpu: item.virtual_type=='hyper-v' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tgpu_auto_assignment: item.virtual_type=='kvm' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tsystem_alloc_disk: $scope.data.system_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk: $scope.data.data_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk_2: $scope.data.data_alloc_disk_2\r\n\t\t\t\t\t\t}, function(res){\r\n\t\t\t\t\t\t\t$scope.submit_loading = false;\r\n\t\t\t\t\t\t\ttemplate.query(function(res){\r\n\t                    \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n        \t\t\t\t\t\t\t\treturn item;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t\telse{\r\n        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t});\r\n\t                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t                    \t});\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t},function(){ $scope.submit_loading = false; });\r\n\t\t\t\t\t// }\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.resetTemp = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重置模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='REST_TEMP_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttemplate.reset({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.imgManage = function(IMG){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_imgManage.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.imgType = IMG.virtual_type;\r\n\t\t\t\tfunction formLocalData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.host_ip]){\r\n\t\t\t\t\t\t\tlet obj = {host_ip: item.host_ip, hostname: item.hostname, resource_pool_uuid: item.resource_pool_uuid, storages: []};\r\n\t\t\t\t\t\t\tarry[item.host_ip] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet hostArry = dataResource.filter(function(data){ return data.host_ip == item.host_ip });\r\n\t\t\t\t\t\thostArry.forEach(function(data){\r\n\t\t\t\t\t\t\tif(!item.storages[data.storage_name]){\r\n\t\t\t\t\t\t\t\tlet obj = {storage_name: data.storage_name, storage_uuid: data.storage_uuid, storage_type: data.storage_type, imgs: []};\r\n\t\t\t\t\t\t\t\titem.storages[data.storage_name] = obj;\r\n\t\t\t\t\t\t\t\titem.storages.push(obj);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\titem.storages.forEach(function(data){\r\n\t\t\t\t\t\t\tlet storageArry = dataResource.filter(function(d){ return item.host_ip == d.host_ip && d.storage_name == data.storage_name });\r\n\t\t\t\t\t\t\tstorageArry.forEach(function(d){\r\n\t\t\t\t\t\t\t\tdata.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\titem.storages.sort(function(a,b){ return a.storage_name>b.storage_name?1:-1 });\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction formRemoteData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.storage_name+\"_remote\"]){\r\n\t\t\t\t\t\t\tlet obj = {storage_name: item.storage_name, storage_uuid: item.storage_uuid, storage_type: item.storage_type, host_ip: item.host_ip, imgs: []};\r\n\t\t\t\t\t\t\tarry[item.storage_name+\"_remote\"] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet imgArry = dataResource.filter(function(d){ return item.storage_name == d.storage_name });\r\n\t\t\t\t\t\timgArry.forEach(function(d){\r\n\t\t\t\t\t\t\titem.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction getLocal(resource_pool_uuid){\r\n\t\t\t\t\t$scope.local_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: resource_pool_uuid},function(res){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t\t$scope.locals = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tfunction getRemote(){\r\n\t\t\t\t\t$scope.remote_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\tconsole.log(res.result);\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t\t$scope.remotes = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tvar new_pool = {};\r\n\t\t\t\tgetRemote();\r\n\t\t\t\tResourcePool.query(function(res){\r\n\t\t\t\t\t$scope.pools = res.result.filter(function(p){ return p.type == IMG.virtual_type });\r\n\t\t\t\t\tnew_pool = $scope.pool = $scope.pools[0];\r\n\t\t\t\t\tgetLocal($scope.pool.uuid);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$scope.getlocalImages = function(pool){\r\n\t\t\t\t\tnew_pool = pool;\r\n\t\t\t\t\tgetLocal(pool.uuid);\r\n\t\t\t\t};\r\n\t\t\t\t$scope.$on(\"syncTempl\", function($event, data){\r\n\t\t\t\t\tvar updateVolume = data.filter(function(item){ return item.id==IMG.id })[0].volume;\r\n\t\t\t\t\tif(updateVolume.length!==0){\r\n\t\t\t\t\t\tupdateVolume.forEach(function(volume){\r\n\t\t\t\t\t\t\tif(volume.storage_type=='local'){\r\n\t\t\t\t\t\t\t\t$scope.locals && $scope.locals.forEach(function(local){\r\n\t\t\t\t\t\t\t\t\tlocal.storages.forEach(function(storage){\r\n\t\t\t\t\t\t\t\t\t\tstorage.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.remotes && $scope.remotes.forEach(function(remote){\r\n\t\t\t\t\t\t\t\t\tremote.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t$scope.sendImg = function(storage_type, resource_pool_uuid, image_type, image_uuid, storage_uuid, img, pool){\r\n\t\t\t\t\timg.volume_status = 'sending';\r\n\t\t\t\t\tmanageTemplate.handout({\r\n\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\tresource_pool_uuid: storage_type=='local'?resource_pool_uuid:undefined,\r\n\t\t\t\t\t\timage_type: image_type,\r\n\t\t\t\t\t\timage_uuid: image_uuid,\r\n\t\t\t\t\t\tstorage_uuid: storage_uuid,\r\n\t\t\t\t\t\tstorage_type: storage_type\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\tif(storage_type=='local'){\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: pool.uuid},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.locals.splice(0, $scope.locals.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.locals,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.remotes.splice(0, $scope.remotes.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.remotes,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t// img.status = 'sended failed';\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\t$scope.deleteImg = function(storage_type, volume_uuid, img, storage_uuid, pool){\r\n\t\t\t\t\tif(!img.has_instance){\r\n\t\t\t\t\t\timg.volume_status = 'deleting';\r\n\t\t\t\t\t\tmanageTemplate.delete({\r\n\t\t\t\t\t\t\tstorage_type: storage_type,\r\n\t\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\t\tvolume_uuid: volume_uuid,\r\n\t\t\t\t\t\t\timage_uuid: img.image_uuid,\r\n\t\t\t\t\t\t\tstorage_uuid: storage_uuid\r\n\t\t\t\t\t\t},function(res){\r\n\r\n\t\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t\timg.volume_status = 'delete failed';\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.detail = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_detail.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(infor){\r\n\t\t\t\t\t$scope.data = infor;\r\n\t\t\t\t\tfunction formData(obj){\r\n\t\t\t\t\t\tobj.imgs = [];\r\n\t\t\t\t\t\tfor(var i in obj){\r\n\t\t\t\t\t\t\tif(i!=='imgs'){\r\n\t\t\t\t\t\t\t\tvar img = {};\r\n\t\t\t\t\t\t\t\timg.location = i;\r\n\t\t\t\t\t\t\t\timg.volumeId = obj[i];\r\n\t\t\t\t\t\t\t\tobj.imgs.push(img);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tfor(var i in $scope.data.inst_volumes){\r\n\t\t\t\t\t\tformData($scope.data.inst_volumes[i]);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t$scope.data.network = data.networks.filter(function(data){ return data.id===infor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tif(infor.nets[0].subnet_id){\r\n\t\t\t\t\t\t\tnetwork.query_sub({id: infor.nets[0].network_id }, function(res){\r\n\t\t\t\t\t\t\t\tvar subnet = res.result.filter(function(data){ return data.id === infor.nets[0].subnet_id })[0];\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = subnet.name +\" (\"+ subnet.start_ip + \"~\" + subnet.end_ip +\")\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}, function(){});\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}])\r\n\r\n.controller(\"addTeachTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"TeachTemplate\", \"HardwareTemplate\", \"SystemISO\", \"Admin\", \"$$$os_types\",\"$$$I18N\", \"UserRole\",\"Network\", \"virtualHost\", \"networkWithHost\", \"$rootScope\",\"checkIP\",\r\nfunction($scope, $modalInstance, teach, hardware, iso, admin, $$$os_types,$$$I18N, UserRole, network, virtualHost, networkWithHost, $root, checkIP){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.auto_isos = [];$scope.all_isos = [];\r\n\t$scope.iso = [];\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name === user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t})\r\n\t\tif(!$scope.owner) $scope.owner = $scope.users[0]\r\n\t});\r\n\thardware.query(function(res){\r\n\t\t$scope.hardware_templates = res.result;\r\n\t\t$scope.template = $scope.hardware_templates[0];\r\n\t});\r\n\tiso.query(function(res){\r\n\t\t$scope.all_isos = res.isos.filter(function(iso){ return iso.type && iso.type!==\"package\" && iso.type!==\"other\"; });\r\n\t\t\r\n\t\t$scope.all_isos.forEach(function(item){\r\n\t\t\titem.os_type = item.os_type.split(\",\");\r\n\t\t});\r\n\t\t$scope.isos = $scope.all_isos;\r\n\t\t$scope.iso = [$scope.isos[0]];\r\n\t\tangular.forEach($scope.isos, function(item){\r\n\t\t\tif(item.support_auto_install == true)\r\n\t\t\t\t$scope.auto_isos.push(item);\r\n\t\t})\r\n\t});\r\n\r\n\t$scope.type = 'kvm';\r\n\t$scope.enable_gpu = false;\r\n\t$scope.gpu_auto_assignment = false;\r\n\t$scope.getVirtualHost = function (type){\r\n\t\tvar _this = this;\r\n\t\t$scope.host_loading = true;\r\n\t\tvar data = {};\r\n\t\tdata.type = type;\r\n\t\tif(type=='hyper-v'){\r\n\t\t\tdata.enable_gpu = _this.enable_gpu;\r\n\t\t\t_this.gpu_auto_assignment = false;\r\n\t\t}else{\r\n\t\t\tdata.enable_gpu = _this.gpu_auto_assignment;\r\n\t\t\t_this.enable_gpu = false;\r\n\t\t}\r\n\t\tvirtualHost.query(data,function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t_this.host = $scope.hosts[0];\r\n\t\t\t_this.host && $scope.getNetwork(_this.host);\r\n\t\t},function(){\r\n\r\n\t\t});\r\n\t}\r\n\t$scope.getVirtualHost($scope.type);\r\n\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\r\n\t\t}\r\n\t}\r\n\t// network.query(function(data){\r\n\t// \t$scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });\r\n\t// \t$scope.network = $scope.networks[0];\r\n\t// \tgetSubnets($scope.network, $scope);\r\n\t// })\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\t$scope.names = $scope.rows.map(function(item){ return item.name });\r\n\t$scope.sameName = false;\r\n\tvar _scope = $scope;\r\n\t$scope.install = \"manualinstall\";\r\n\t$scope.isOther = false;\r\n\t$scope.$on(\"selectStepChange\", function(e, arg){\r\n\t\tif(arg.index==0){\r\n\t\t\targ.stepScope.$$nextSibling.error = false;\r\n\t\t}\r\n\t})\r\n\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\t_scope.type = scope.type;\r\n\t\tscope.error = step.is_dirty;\r\n\t\tvar flag = false;\r\n\t\t_scope.names.forEach(function(item){\r\n\t\t\tif(scope.name == item){ flag = true; }\r\n\t\t})\r\n\t\tif(flag){\r\n\t\t\t_scope.sameName = true;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"WRONG_NAME\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse { _scope.sameName = false; }\r\n\t\tstep.done = !scope.step_pane0.$invalid && !_scope.sameName && !scope.network_loading;\r\n\r\n\t\tif(step.done && scope.$$childTail && scope.$$childTail.bind_ip){\r\n\t\t\tstep.showLoading = true;\r\n\t\t\tstep.done = false;\r\n\t\t\tcheckIP.check({ip: scope.$$childTail.bind_ip, subnet_id: scope.subnet.id},function(res){\r\n\t\t\t\tif(!res.result){\r\n\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n\t\t\t\t\t\ttimeout\t: 6000\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.$broadcast(\"currentStepChange\", 1);\r\n\t\t\t\t}\r\n\t\t\t\tstep.showLoading = false;\r\n\t\t\t},function(error){ step.showLoading = false; });\r\n\t\t}\r\n\t});\r\n\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\tif(scope.template.system_gb == 0)\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"模板系统盘不能为0\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\tstep.done = !(scope.template.system_gb == 0);\r\n\t});\r\n\t$scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n\t\tsetTimeout(function(){\r\n\t\t\t$(\"[rel=popover-hover]\").popover({\r\n\t\t\t\ttrigger : \"hover\"\r\n\t\t\t});\r\n\t\t})\r\n\t\t_scope.install = scope.install;\r\n\t\tif(scope.iso != undefined && scope.iso[0] != undefined){\r\n\t\t\tif(scope.iso[0].os_type[0] == 'other'){\r\n\t\t\t\tscope.$parent.system_versions = $$$os_types;\r\n\t\t\t\tscope.$parent.system_version1 = scope.$parent.system_versions[0];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tvar _types = [];\r\n\t\t\t\tscope.iso[0].os_type.forEach(function(item){\r\n\t\t\t\t\tvar _obj = {};\r\n\t\t\t\t\t_obj.key = item;\r\n\t\t\t\t\t_obj.value = item;\r\n\t\t\t\t\t_types.push(_obj);\r\n\t\t\t\t})\r\n\t\t\t\tscope.$parent.system_versions = _types;\r\n\t\t\t\tscope.$parent.system_version1 = _types[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = (scope.iso != undefined && scope.iso[0] != undefined);\r\n\t});\r\n\tvar newWindow;\r\n\tvar FLAG = false;\r\n\tfunction gotoUrl(val){\r\n\t\tif(val){\r\n\t\t\tnewWindow = window.open('templateModify.html#0');\r\n\t\t\t// newWindow = window.open('js/vdi-spice/spiceModify.html#?id=0');\r\n\t\t}\r\n\t}\r\n\tsetTimeout(function(){\r\n\t\t$(\"#finish\").on('click',function(){\r\n\t\t    gotoUrl(FLAG);\r\n\t\t})\r\n\t})\r\n\t\r\n\t$scope.$on(\"WizardStep_3\", function(e, step, scope){\r\n\t\tif(scope.step_pane3.$invalid){\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\tstep.done = false;\r\n\t\t}\r\n\t\telse if(scope.userPassword && scope.userPasswordConfirm && scope.userPassword !== scope.userPasswordConfirm){\r\n\t\t\tstep.done = false;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"两次输入密码不一致\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tstep.done = true;\r\n\t\tFLAG = step.done;\r\n\t});\r\n\t$scope.$on(\"WizardDone\", function(e, steps, scopes){\r\n\t\tvar auto_install = scopes[2].install === \"autoinstall\" ? true : false;\r\n\t\tvar _ip = scopes[0].bind_ip_type.value === 'static' ? scopes[0].$$childHead.bind_ip : undefined;\r\n\t\tvar testWin10 = /Windows10/;\r\n\t\tvar item = {\r\n\t\t\ttemplate_name: scopes[0].name,\r\n\t\t\tdescription: scopes[0].description,\r\n\t\t\towner: scopes[0].owner.id,\r\n\t\t\ttype_code : 1,\r\n\t\t\tvcpus: scopes[1].template.cpu_num,\r\n\t\t\tsystem_gb: scopes[1].template.system_gb,\r\n\t\t\tlocal_gb: scopes[1].template.local_gb,\r\n\t\t\tmemory_mb: scopes[1].template.memory_mb,\r\n\t\t\tiso_path:scopes[2].iso[0].name,\r\n\t\t\tiso_id:scopes[2].iso[0].id,\r\n\t\t\tos_type: scopes[3].system_version1.key,\r\n\t\t\tinstance_type: scopes[1].template.id,\r\n\t\t\tauto_install: auto_install,\r\n\t\t\tnetwork: scopes[0].network.id,\r\n\t\t\tsubnet: scopes[0].subnet?scopes[0].subnet.id:'',\r\n\t\t\tband_ip: _ip,\r\n\t\t\tband_type: scopes[0].bind_ip_type.value,\r\n\t\t\tkey:scopes[3].key,\r\n\t\t\tusername:scopes[3].userName,\r\n\t\t\tuserPassword:scopes[3].userPassword,\r\n\t\t\tuserPasswordConfirm:scopes[3].userPasswordConfirm,\r\n\t\t\tvirtual_type: scopes[0].type,\r\n\t\t\tenable_gpu: scopes[0].type == 'hyper-v'? scopes[0].enable_gpu:undefined,\r\n\t\t\tgpu_auto_assignment: scopes[0].type == 'kvm'? scopes[0].gpu_auto_assignment:undefined,\r\n\t\t\tfirmware_type: scopes[0].type == 'kvm' && testWin10.test(scopes[3].system_version1.key)?'uefi':undefined,\r\n\t\t\thost_uuid: scopes[0].host.host_uuid\r\n\t\t};\r\n\t\tfunction updateTem(isSuccess){\r\n\t\t\tteach.query(function(res){\r\n\t\t\t\tconsole.log(res, 'teachDesktop', item.virtual_type)\r\n\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\treturn item.virtual_type === scopes[0].type;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\r\n\t\t\t\t// if(!auto_install){\r\n\t\t\t\t\tvar template = $scope.rows.filter(function(temp){ return temp.name ==  item.template_name})[0];\r\n\t\t\t\t\tif(template && isSuccess){\r\n\t\t\t\t\t\tif(scopes[0].type == \"hyper-v\"){\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5 \r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModify_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModifybt_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModify.html#?id=' + template.id + '&os_type' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t\t// newWindow.location.reload();\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\tnewWindow.location.reload();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t\t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t\t\t// newWindow.location.replace('js/vdi-spice/spiceModifybt.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t// }\r\n\t\t\t});\r\n\t\t};\r\n\t\te.targetScope.currentStep.showLoading = true;\r\n\t\t$modalInstance.close();\r\n\t\tteach.save(item, function(res){ updateTem(true); }, function(){ newWindow.close(); updateTem(); }).$promise.finally(function(){\r\n\t\t\te.targetScope.currentStep.showLoading = false;\r\n\t\t});\r\n\t});\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.cpu_num = 1;\r\n}])\r\n\r\n.controller(\"registerTeachTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Admin\", \"registerTemplate\", \"TeachTemplate\", \"$$$os_types\", \"UserRole\",\"Network\", \"virtualHost\",\"networkWithHost\", \"$$$I18N\",\r\nfunction($scope, $modalInstance, admin, registerTemplate, teach, $$$os_types, UserRole, network, virtualHost, networkWithHost, $$$I18N){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;\r\n\t$scope.max_namelength=20;\r\n\t$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.type = '1';\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name === user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t})\r\n\t});\r\n\tregisterTemplate.query(function(res){\r\n\t\t$scope.sys_isos = res.system_image;\r\n\t\t$scope.sys_iso = res.system_image[0];\r\n\t\t$scope.old_data_isos = res.data_image;\r\n\t\tif($scope.sys_iso){\r\n\t\t\t$scope.getDataImgs($scope.sys_iso);\r\n\t\t}\r\n\t})\r\n\t$scope.filterDataISO = function(data_iso, data_iso2){\r\n\t\tif(data_iso){\r\n\t\t\t$scope.data_isos2 = $scope.data_isos.filter(function(item){ return item.name !== data_iso.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos2 = $scope.data_isos;\r\n\t\t}\r\n\t\tif(data_iso2){\r\n\t\t\t$scope.data_isos1 = $scope.data_isos.filter(function(item){ return item.name !== data_iso2.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos1 = $scope.data_isos;\r\n\t\t}\r\n\t};\r\n\t$scope.getDataImgs = function(systemImg, is_init){\r\n\t\tif(systemImg){\r\n\t\t\tthis.data_iso = undefined;\r\n\t\t\tthis.data_iso2 = undefined;\r\n\t\t\t$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function(item){ return item.virtual_type == systemImg.virtual_type });\r\n\t\t\t// $scope.data_iso = $scope.data_isos[0];\r\n\t\t\t// $scope.data_iso2 = $scope.data_isos[0];\r\n\t\t\t$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.getVirtualHost = function (type, rbd_enabled){\r\n\t\t$scope.host_loading = true;\r\n\t\tvirtualHost.query({\r\n\t\t\tvirtual_type: type,\r\n\t\t\trbd_enabled: rbd_enabled\r\n\t\t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n\t\t},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\tif(res.result.length === 0) {\r\n\t\t\t\tvar form = getRegisterTemplateForm();\r\n\t\t\t\tform.host.$setViewValue(\"\");\r\n\t\t\t}\r\n\t\t\t$scope.getNetwork($scope.host);\r\n\t\t},function(){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.os_types = $$$os_types.filter(function(item){ return item.key!==\"package\" });\r\n\t$scope.os_type = $scope.os_types[0];\r\n\t// $scope.enable_gpu = false;\r\n\t$scope.bind_ip = {value: null};\r\n\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t},function(){ $scope.network_loading = false; })\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar bindIP = this.bind_ip.value;\r\n\t\t// var unUseIP = this.band_ips.filter(function(item){ return item===bindIP });\r\n\t\t// if(this.bind_ip_type.value === 'static' && bindIP === '无可用IP'){\r\n\t\t// \t$.bigBox({\r\n\t\t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n\t\t// \t\ttimeout\t: 6000\r\n\t\t// \t});\r\n\t\t// }else if(this.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){\r\n\t\t// \t$.bigBox({\r\n\t\t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n\t\t// \t\ttimeout\t: 6000\r\n\t\t// \t});\r\n\t\t// }else{\r\n\t\t\t$scope.submiting = true ;\r\n\t\t\t$scope.afterSubmiting =false ;\r\n\t\t\tvar _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;\r\n\t\t\tvar postData = {\r\n\t\t\t\tsystem_image_file: this.sys_iso,\r\n\t\t\t\tdata_image_file: this.data_iso?this.data_iso:undefined,\r\n\t\t\t\tdata_image_file_2: this.data_iso2?this.data_iso2:undefined,\r\n\t\t\t\tname: this.name,\r\n\t\t\t\tdescription: this.description,\r\n\t\t\t\ttype_code: this.type,\r\n\t\t\t\tos: this.os_type.key,\r\n\t\t\t\tis_64: this.os_type.value.indexOf(\"64 bit\")>-1?true: false,\r\n\t\t\t\towner: this.owner.id,\r\n\t\t\t\tnetwork: this.network.id,\r\n\t\t\t\tsubnet: this.subnet?this.subnet.id:'',\r\n\t\t\t\tband_ip: _ip,\r\n\t\t\t\tband_type: this.bind_ip_type.value,\r\n\t\t\t\thost_uuid: this.host.host_uuid,\r\n\t\t\t\tusername: this.sys_iso.virtual_type=='hyper-v'?this.username:undefined,\r\n\t\t\t\tuserPassword: this.sys_iso.virtual_type=='hyper-v'?this.userPassword:undefined,\r\n\t\t\t\tuserPasswordConfirm: this.sys_iso.virtual_type=='hyper-v'?this.userPasswordConfirm:undefined\r\n\t\t\t\t// enable_gpu: this.sys_iso.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n\t\t\t};\r\n\t\t\tregisterTemplate.update(postData, function(res){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t\tteach.query(function(res){\r\n\t\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn item.virtual_type === $scope.select;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},function(){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t// }\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\tfunction getRegisterTemplateForm(){\r\n\t\tvar child = $scope.$$childHead;\r\n\t\tvar form = null;\r\n\t\twhile(child && !form) {\r\n\t\t\tform = child.registerTemplate;\r\n\t\t\tchild = child.$$nextSibling;\r\n\t\t}\r\n\t\treturn form;\r\n\t}\r\n}])\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controller.teach.js","angular.module(\"vdi.template.person\", [\"vdi.template\"])\r\n.factory(\"PersonTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/2\", isArray: false },\r\n\t\tupdate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/modify_template/:id\", params: { id: \"@id\" } },\r\n\t\tlistModes:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" }, isArray: false },\r\n\t\tapplyTemplate:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/update_mode_instance/:id\", params: { id: \"@id\" } },\r\n\t\tstatus:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/status/:id\", params: { id: \"@id\" } },\r\n\t\tcopy:\r\n\t\t\t{ method: \"POST\", url: $Domain + \"/thor/image/clone_template\"},\r\n\t\tmodify:\r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/image/2\", isArray: false },\r\n\t\tdownload:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/download/:id\", params: { id: \"@id\" } },\r\n\t\treset:\r\n\t\t\t{ method: \"post\", url: $Domain + \"/thor/image/reset_template\" },\r\n\t\tget_image_vnc_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_vnc_info\" },\r\n\t\tget_image_rdp_info:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/get_image_rdp_info\" },\r\n\t\tupdate_tpl_tip:\r\n\t\t\t{method:\"GET\",url:$Domain + \"/thor/controller/ha_storage_state\"}\r\n\t});\r\n}])\r\n\r\n.controller(\"vdiTemplatePresonalDesktopListController\",[\r\n\"$scope\", \"$modal\", \"TeachTemplate\", \"PersonTemplate\", \"Admin\", \"$interval\", \"$filter\", \"$$$os_types\", \"$Domain\", \"Network\", \"$$$I18N\", \"ResourcePool\", \"manageTemplate\", \"VMCommon\", \"networkWithHost\", \"virtualHost\",\"UserRole\", \r\nfunction($scope, $modal, template, tmpl, admin, $interval, $filter, $$$os_types, $Domain, network, $$$I18N, ResourcePool, manageTemplate, vm, networkWithHost, virtualHost, UserRole){\r\n\t$scope.domain = $Domain;\r\n\t$scope.rows = []; $scope.allrows = [];\r\n\tvar _controllerScope = $scope;\r\n\t$scope.loading = true;\r\n\tlet user = UserRole.currentUser;\r\n    $scope.currentPage = 1;\r\n    $scope.pagesizes = [30,20,10];\r\n    $scope.pagesize = $scope.pagesizes[0];\r\n\r\n    $scope.orders = [ {name: $$$I18N.get(\"按创建时间排序\"), val: 'time'}, {name: $$$I18N.get(\"按模板名称排序\"), val: 'name'}];\r\n    $scope.order = $scope.orders[0];\r\n    $scope.sortTem = function(val){\r\n    \tif(val == 'time'){\r\n    \t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n    \t}\r\n    \telse{\r\n    \t\t$scope.rows.sort(function(a,b){ return a.name>b.name? 1:-1 });\r\n    \t}\r\n    }\r\n\r\n\t$interval(function(){\r\n\t\t$scope.$root && $scope.$root.$broadcast(\"imageIDS\", $scope.rows && $scope.rows.map(function(item){ return item.id }));\r\n\t}, 1000);\r\n\t$scope.$on(\"imagesRowsUpdate\", function($event, data){\r\n\t\tvar _rows = {};\r\n\t\t$scope.rows && $scope.rows.forEach(function(item){\r\n\t\t\t_rows[item.id] = item;\r\n\t\t});\r\n\t\tdata.forEach(function(item){\r\n\t\t\tif(_rows[item.id]){\r\n\t\t\t\tfor(var k in item){\r\n\t\t\t\t\t_rows[item.id][k] = item[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.rows = $scope.rows.filter(function(item){ return item.type_code ===2 });\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tif(row.sync_status){\r\n\t\t\t\tvar updateInfor = row.sync_status.filter(function(item){ return item.type === \"image\" });\r\n\t\t\t\tif(updateInfor.length!==0)\r\n\t\t\t\t\trow.updateSize = (updateInfor[0].size/1024/1024/1024).toFixed(2);\t\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t$scope.$root.$broadcast(\"syncTempl\", $scope.rows);\r\n\t});\r\n\r\n\ttmpl.query(function(res){\r\n\t\t$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t$scope.rows.forEach(function(row){\r\n\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t});\r\n\t\t$scope.rows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t$scope.loading = false;\r\n\t\t$scope.personalNames = $scope.rows.map(function(item){ return item.name });\r\n\t\t$scope.sameName = false;\r\n\r\n\t\t$scope.allrows = $scope.rows;\r\n\t\tif($$$storage.getSessionStorage('virtual_type_P')!=='all')\r\n\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === $$$storage.getSessionStorage('virtual_type_P') });\r\n\t});\r\n\r\n\t$scope.select = $$$storage.getSessionStorage('virtual_type_P') || 'all';\r\n\t$scope.$watch(\"select\",function(newvalue){\r\n\t\tif(newvalue){\r\n\t\t\tif(newvalue!=='all'){\r\n\t\t\t\t$scope.rows = $scope.allrows.filter(function(item){ return item.virtual_type === newvalue });\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t$scope.rows = $scope.allrows;\r\n\t\t\t}\r\n\t\t\t$$$storage.setSessionStorage('virtual_type_P', newvalue);\r\n\t\t}\r\n\t});\r\n\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除个人模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_P' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t$scope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttmpl.delete({ id: rows.map(function(item){ return item.id }) },function(res){\r\n\t                \ttmpl.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\ttmpl.query(function(res){\r\n\t                \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n    \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n    \t\t\t\t\t\t\t\treturn item;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\telse{\r\n    \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n    \t\t\t\t\t\t\t}\r\n    \t\t\t\t\t\t});\r\n                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                    \t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.shutdown = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\tvar rows_active = rows.filter(function(item){ return item.instance_status === 'running' });\r\n\t\tif(!rows_active.length){\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"SHUTOFF_TIP\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$modal.open({\r\n\t\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机'>\"+\r\n\t\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='shutdown_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><img data-ng-if='loading' src='./img/building.gif' width='24px'><button class='btn btn-primary' data-ng-if='!loading' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\t\tcontroller: function($scope, $modalInstance,$q){\r\n\t\t\t\t\t$scope.name = rows_active.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t\t$scope.loading = true;\r\n\t\t\t\t\t\tvm.shutdowns({ instance_ids: rows_active.map(function(item){ return item.instance_id }) },function(res){\r\n\t\t\t\t\t\t\trows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.forEach(function(item){\r\n\t\t\t\t\t\t\t\t\tif(item.id === row.id){\r\n\t\t\t\t\t\t\t\t\t\titem.instance_status = \"shutdown\";\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t},function(error){\r\n\t\t\t\t\t\t\t$scope.loading = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsize: \"sm\"\r\n\t\t\t});\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.copy = function(item){\r\n\t\t $modal.open({\r\n                templateUrl: \"views/vdi/dialog/template/template_copy.html\",\r\n                size: \"md\",\r\n                controller: [\"$scope\", \"$modalInstance\", function($scope, $modalInstance){\r\n                    $scope.min_namelength=2;$scope.max_namelength=20;\r\n                    $scope.is_copy = true;\r\n                    $scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n                    $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n                    $scope.types = $scope.types2;\r\n                    $scope.bind_ip_type = $scope.types2[0];\r\n                    admin.query(function(res){\r\n                        $scope.owners = res.users;\r\n                        angular.forEach($scope.owners, function(item){\r\n                        \tif(item.name == user.name){\r\n                        \t\t$scope.owner = item;\r\n                        \t}\r\n                        });\r\n                        if(!$scope.owner) {\r\n                        \t$scope.owner = $scope.users[0]\r\n                        }\r\n                    });\r\n                    $scope.type = '2';\r\n                    $scope.temCopy = false;\r\n\r\n                    $scope.temData = item;\r\n                    $scope.getVirtualHost = function (type,rbd_enabled){\r\n                    \t$scope.host_loading = true;\r\n                    \tvirtualHost.query({\r\n                    \t\tvirtual_type: type,\r\n                    \t\trbd_enabled: rbd_enabled\r\n                    \t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n                    \t},function(res){\r\n                    \t\t$scope.host_loading = false;\r\n                    \t\t$scope.hosts = res.result;\r\n                    \t\t$scope.host = $scope.hosts[0];\r\n                    \t\t$scope.getNetwork($scope.host);\r\n                    \t},function(){\r\n\r\n                    \t});\r\n                    }\r\n                    $scope.getVirtualHost(item.virtual_type,item.rbd_enabled);\r\n\r\n                    // function getIps(subnet_id, _scope){\r\n                    // \tif(subnet_id)\r\n                    // \t\tnetwork.ports({ id: subnet_id },function(res){\r\n                    // \t\t\t_scope.band_ips = res.unused_ips;\r\n                    // \t\t\t_scope.bind_ip = _scope.band_ips[0];\r\n                    // \t\t\t_scope.bind_ip_loading = false;\r\n                    // \t\t})\r\n                    // };\r\n                    $scope.switchIps = function(subnet,_scope){\r\n                    \t// _scope.bind_ip_loading = true;\r\n                    \tif(subnet){\r\n                    \t\t// getIps(subnet.id, _scope);\r\n                    \t\t_scope.types = _scope.types2;\r\n                    \t\t_scope.bind_ip_type = _scope.types2[0];\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.types = _scope.types1;\r\n                    \t\t_scope.band_ips = [];\r\n                    \t\t_scope.bind_ip_type = _scope.types1[0];\r\n                    \t\t// _scope.bind_ip_loading = false;\r\n                    \t}\r\n                    };\r\n                    function getSubnets(Network,_scope){\r\n                    \tif(Network.subnets.length){\r\n                    \t\t$scope.network_loading = true;\r\n                    \t\t// $scope.bind_ip_loading = true;\r\n                    \t\tnetwork.query_sub({id: Network.id }, function(res){\r\n                    \t\t\t_scope.subnets = res.result;\r\n                    \t\t\t_scope.subnet = _scope.subnets[0];\r\n                    \t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t\t\t$scope.network_loading = false;\r\n                    \t\t})\r\n                    \t}\r\n                    \telse{\r\n                    \t\t_scope.subnets = [];\r\n                    \t\t_scope.subnet = null;\r\n                    \t\t_scope.switchIps(_scope.subnet, _scope);\r\n                    \t}\r\n                    };\r\n                    $scope.getNetwork = function(host){\r\n                    \tif(host){\r\n                    \t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n                    \t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n                    \t\t\t$scope.networks = res.result;\r\n                    \t\t\t$scope.network = $scope.networks[0];\r\n                    \t\t\tgetSubnets($scope.network, $scope);\r\n                    \t\t}, function(){});\r\n                    \t}\r\n                    }\r\n                    $scope.switchSubnet = function(val, _scope){\r\n                    \tgetSubnets(val,_scope);\r\n                    }\r\n                    $scope.ok = function(){\r\n                \t\t$scope.temCopy = true;\r\n                \t\tvar _ip = this.bind_ip_type.value === 'static' ? this.bind_ip.value : undefined;\r\n                        tmpl.copy({\r\n                    \t\tname: this.name,\r\n                    \t\tdescription: this.description,\r\n                    \t\timage_id : item.id,\r\n                    \t    type_code: this.type,\r\n                    \t    owner: $scope.owner.id,\r\n                    \t    network: this.network.id,\r\n                    \t    subnet: this.subnet?this.subnet.id:\"\",\r\n                    \t    band_ip: _ip,\r\n                    \t    band_type: this.bind_ip_type.value,\r\n                    \t    host_uuid: this.host.host_uuid\r\n                    \t    // enable_gpu: item.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n                        }, function(res){\r\n                        \ttmpl.query(function(res){\r\n                        \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n        \t\t\t\t\t\t\t\treturn item;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t\telse{\r\n        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t});\r\n                        \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n                        \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n                        \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n                        \t});\r\n                        \t$modalInstance.close();\r\n                        }, function(){\r\n                        \t$scope.temCopy = false;\r\n                        });\r\n                    \t}\r\n                    $scope.close = function(){\r\n                        $modalInstance.close();\r\n                    };\r\n                } ]\r\n            });\r\n\t};\r\n\t$scope.modify = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_modify.html\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t\t\t\t$scope.types = $scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t\t\t\t$scope.virtual_type = item.virtual_type;\r\n\t\t\t\t$scope.disabled_gpu = item.disabled_gpu;\r\n\t\t\t\t$scope.data = {vcpus: 1, ram: 1.5, system_alloc_disk: 10, bind_ip_type: $scope.types2[1]};\r\n\t\t\t\tvar oldData = {};\r\n\t\t\t\tfunction getSubnets(Network, subnet_id, flag){\r\n\t\t\t\t\tif(Network.subnets.length){\r\n\t\t\t\t\t\t$scope.network_loading = true;\r\n\t\t\t\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t\t\t\t$scope.data.subnets = res.result;\r\n\t\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\t\toldData.subnets = $scope.data.subnets;\r\n\t\t\t\t\t\t\t\toldData.subnet = $scope.data.subnet = $scope.data.subnets.filter(function(data){ return data.id === subnet_id })[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = $scope.data.subnets[0];\r\n\t\t\t\t\t\t\t\tif($scope.data.subnet)\r\n\t\t\t\t\t\t\t\t\tgetIps($scope.data.subnet.id, $scope.cur_imgInfor.nets.ip_address, false);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$scope.network_loading = false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.data.subnets = [];\r\n\t\t\t\t\t\t$scope.data.subnet = null;\r\n\t\t\t\t\t\t$scope.switchIps($scope.data.subnet);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tfunction getIps(subnet_id, curr_ip, flag){\r\n\t\t\t\t\tif(subnet_id){\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t\tif(flag){\r\n\t\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];\r\n\t\t\t\t\t\t\toldData.band_ips = $scope.data.band_ips;\r\n\t\t\t\t\t\t\toldData.band_ip = $scope.data.band_ip = curr_ip;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\toldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.switchSubnet = function(val){\r\n\t\t\t\t\tgetSubnets(val, $scope.cur_imgInfor.nets.network_id, false);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.switchIps = function(subnet){\r\n\t\t\t\t\tif(subnet)\r\n\t\t\t\t\t\tgetIps(subnet.id,$scope.cur_imgInfor.nets.ip_address, false)\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t\t$scope.data.bind_ip_type = $scope.types[0];\r\n\t\t\t\t\t\t$scope.data.band_ips = [];\r\n\t\t\t\t\t\t$scope.data.band_ip = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.addbtndisk = function(){\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!$scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 1;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.minusbtndisk = function(){\r\n\t\t\t\t\tif($scope.old_data_alloc_disk && !$scope.old_data_alloc_disk_2){\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk_2){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk_2 = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif($scope.data.data_alloc_disk){\r\n\t\t\t\t\t\t\t$scope.data.data_alloc_disk = 0;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t};\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(templateInfor){\r\n\t\t\t\t\t$scope.cur_imgInfor = templateInfor;\r\n\t\t\t\t\toldData.name = $scope.data.name = templateInfor.name;\r\n\t\t\t\t\toldData.description = $scope.data.description = templateInfor.description;\r\n\t\t\t\t\tgetIps(templateInfor.nets[0].subnet_id, templateInfor.nets[0].ip_address, true);\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t// $scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t\t\t$scope.networks = data.networks;\r\n\t\t\t\t\t\toldData.network = $scope.data.network = $scope.networks.filter(function(data){ return data.id===templateInfor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tgetSubnets($scope.data.network,templateInfor.nets[0].subnet_id, true);\r\n\t\t\t\t\t})\r\n\t\t\t\t\toldData.enable_gpu = $scope.data.enable_gpu= templateInfor.enable_gpu;\r\n\t\t\t\t\toldData.vcpus = $scope.data.vcpus= templateInfor.vcpus;\r\n\t\t\t\t\toldData.ram = $scope.data.ram= templateInfor.ram/1024;\r\n\t\t\t\t\toldData.system_alloc_disk = $scope.data.system_alloc_disk= templateInfor.system_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk = $scope.data.data_alloc_disk= templateInfor.data_alloc_disk;\r\n\t\t\t\t\toldData.data_alloc_disk_2 = $scope.data.data_alloc_disk_2= templateInfor.data_alloc_disk_2;\r\n\t\t\t\t\t$scope.old_data_alloc_disk = templateInfor.data_alloc_disk;\r\n\t\t\t\t\t$scope.old_data_alloc_disk_2 = templateInfor.data_alloc_disk_2;\r\n\t\t\t\t})\r\n\t\t\t\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t\t\t\t$scope.oldData = angular.copy($scope.data);\r\n\t\t\t\t$scope.isUnchanged = function(){\r\n\t\t\t\t\treturn angular.equals(oldData,$scope.data)\r\n\t\t\t\t}\r\n\t\t\t\t$scope.reset = function(){\r\n\t\t\t\t\tif(oldData.bind_ip_type.value!=='none'){\r\n\t\t\t\t\t\t$scope.types = $scope.types2;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$scope.types = $scope.types1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$scope.data = angular.copy(oldData);\r\n\t\t\t\t}\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\t// if($scope.data.system_alloc_disk < oldData.system_alloc_disk || $scope.data.data_alloc_disk_2 < oldData.data_alloc_disk_2 || $scope.data.data_alloc_disk < oldData.data_alloc_disk){\r\n\t\t\t\t\t// \t$.bigBox({\r\n\t\t\t\t\t// \t\t\ttitle : $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t// \t\t\tcontent : $$$I18N.get(\"modifyTemTip\"),\r\n\t\t\t\t\t// \t\t\ttimeout : 6000\r\n\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t// else{\r\n\t\t\t\t\t\t$scope.submit_loading = true;\r\n\t\t\t\t\t\ttmpl.modify({\r\n\t\t\t\t\t\t\timage_id: item.id,\r\n\t\t\t\t\t\t\tinstance_id: item.instance_id,\r\n\t\t\t\t\t\t\ttemplate_name: $scope.data.name,\r\n\t\t\t\t\t\t\tdescription: $scope.data.description,\r\n\t\t\t\t\t\t\tnetwork: $scope.data.network.id,\r\n\t\t\t\t\t\t\tsubnet: $scope.data.subnet?$scope.data.subnet.id:\"\",\r\n\t\t\t\t\t\t\tband_ip: $scope.data.bind_ip_type.value === 'static' ? $scope.data.band_ip:undefined,\r\n\t\t\t\t\t\t\tband_type: $scope.data.bind_ip_type.value,\r\n\t\t\t\t\t\t\tvcpus: $scope.data.vcpus,\r\n\t\t\t\t\t\t\tram: $scope.data.ram,\r\n\t\t\t\t\t\t\tenable_gpu: item.virtual_type=='hyper-v' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tgpu_auto_assignment: item.virtual_type=='kvm' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,\r\n\t\t\t\t\t\t\tsystem_alloc_disk: $scope.data.system_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk: $scope.data.data_alloc_disk,\r\n\t\t\t\t\t\t\tdata_alloc_disk_2: $scope.data.data_alloc_disk_2\r\n\t\t\t\t\t\t}, function(res){\r\n\t\t\t\t\t\t\t$scope.submit_loading = false;\r\n\t\t\t\t\t\t\ttmpl.query(function(res){\r\n\t                    \t\t_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);\r\n\t\t                \t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n        \t\t\t\t\t\t\tif(_controllerScope.select === 'all'){\r\n        \t\t\t\t\t\t\t\treturn item;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t\telse{\r\n        \t\t\t\t\t\t\t\treturn item.virtual_type === _controllerScope.select;\r\n        \t\t\t\t\t\t\t}\r\n        \t\t\t\t\t\t});\r\n\t                    \t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"_64\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"_64\"));\r\n\t\t\t\t\t\t\t\t\tif(row.os_type.indexOf(\"(64 bit)\")>-1)\r\n\t\t\t\t\t\t\t\t\t\trow.os_type = row.os_type.slice(0,row.os_type.indexOf(\"(64 bit)\"));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t                    \t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t                    \t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t                    \t});\r\n\t\t\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t\t\t},function(){ $scope.submit_loading = false; });\r\n\t\t\t\t\t// }\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.resetTemp = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重置模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='REST_TEMP_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\ttmpl.reset({ image_id: item.id },\r\n\t\t\t\t\tfunction(res){\r\n\t\t\t\t\t},function(error){\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n\t$scope.imgManage = function(IMG){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_imgManage.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.imgType = IMG.virtual_type;\r\n\t\t\t\tfunction formLocalData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.host_ip]){\r\n\t\t\t\t\t\t\tlet obj = {host_ip: item.host_ip, hostname: item.hostname, resource_pool_uuid: item.resource_pool_uuid, storages: []};\r\n\t\t\t\t\t\t\tarry[item.host_ip] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet hostArry = dataResource.filter(function(data){ return data.host_ip == item.host_ip });\r\n\t\t\t\t\t\thostArry.forEach(function(data){\r\n\t\t\t\t\t\t\tif(!item.storages[data.storage_name]){\r\n\t\t\t\t\t\t\t\tlet obj = {storage_name: data.storage_name, storage_uuid: data.storage_uuid, storage_type: data.storage_type, imgs: []};\r\n\t\t\t\t\t\t\t\titem.storages[data.storage_name] = obj;\r\n\t\t\t\t\t\t\t\titem.storages.push(obj);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\titem.storages.forEach(function(data){\r\n\t\t\t\t\t\t\tlet storageArry = dataResource.filter(function(d){ return item.host_ip == d.host_ip && d.storage_name == data.storage_name });\r\n\t\t\t\t\t\t\tstorageArry.forEach(function(d){\r\n\t\t\t\t\t\t\t\tdata.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\titem.storages.sort(function(a,b){ return a.storage_name>b.storage_name?1:-1 });\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction formRemoteData(dataResource){\r\n\t\t\t\t\tlet arry = []; \r\n\t\t\t\t\tdataResource.forEach(function(item){\r\n\t\t\t\t\t\tif(!arry[item.storage_name+\"_remote\"]){\r\n\t\t\t\t\t\t\tlet obj = {storage_name: item.storage_name, storage_uuid: item.storage_uuid, storage_type: item.storage_type, host_ip: item.host_ip, imgs: []};\r\n\t\t\t\t\t\t\tarry[item.storage_name+\"_remote\"] = obj;\r\n\t\t\t\t\t\t\tarry.push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tarry.forEach(function(item){\r\n\t\t\t\t\t\tlet imgArry = dataResource.filter(function(d){ return item.storage_name == d.storage_name });\r\n\t\t\t\t\t\timgArry.forEach(function(d){\r\n\t\t\t\t\t\t\titem.imgs.push({image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn arry;\r\n\t\t\t\t};\r\n\t\t\t\tfunction getLocal(resource_pool_uuid){\r\n\t\t\t\t\t$scope.local_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: resource_pool_uuid},function(res){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t\t$scope.locals = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.local_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tfunction getRemote(){\r\n\t\t\t\t\t$scope.remote_loading = true;\r\n\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\tconsole.log(res.result);\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t\t$scope.remotes = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t},function(err){\r\n\t\t\t\t\t\t$scope.remote_loading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\tvar new_pool = {};\r\n\t\t\t\tgetRemote();\r\n\t\t\t\tResourcePool.query(function(res){\r\n\t\t\t\t\t$scope.pools = res.result.filter(function(p){ return p.type == IMG.virtual_type });\r\n\t\t\t\t\tnew_pool = $scope.pool = $scope.pools[0];\r\n\t\t\t\t\tgetLocal($scope.pool.uuid);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$scope.getlocalImages = function(pool){\r\n\t\t\t\t\tnew_pool = pool;\r\n\t\t\t\t\tgetLocal(pool.uuid);\r\n\t\t\t\t};\r\n\t\t\t\t$scope.$on(\"syncTempl\", function($event, data){\r\n\t\t\t\t\tvar updateVolume = data.filter(function(item){ return item.id==IMG.id })[0].volume;\r\n\t\t\t\t\tif(updateVolume.length!==0){\r\n\t\t\t\t\t\tupdateVolume.forEach(function(volume){\r\n\t\t\t\t\t\t\tif(volume.storage_type=='local'){\r\n\t\t\t\t\t\t\t\t$scope.locals && $scope.locals.forEach(function(local){\r\n\t\t\t\t\t\t\t\t\tlocal.storages.forEach(function(storage){\r\n\t\t\t\t\t\t\t\t\t\tstorage.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t$scope.remotes && $scope.remotes.forEach(function(remote){\r\n\t\t\t\t\t\t\t\t\tremote.imgs.forEach(function(img){\r\n\t\t\t\t\t\t\t\t\t\tif(img.volume_uuid==volume.volume_uuid){\r\n\t\t\t\t\t\t\t\t\t\t\timg.volume_status = volume.volume_status;\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='available'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = true;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif(volume.volume_status=='deleted'){\r\n\t\t\t\t\t\t\t\t\t\t\t\timg.has_image = false;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t$scope.sendImg = function(storage_type, resource_pool_uuid, image_type, image_uuid, storage_uuid, img, pool){\r\n\t\t\t\t\timg.volume_status = 'sending';\r\n\t\t\t\t\tmanageTemplate.handout({\r\n\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\tresource_pool_uuid: storage_type=='local'?resource_pool_uuid:undefined,\r\n\t\t\t\t\t\timage_type: image_type,\r\n\t\t\t\t\t\timage_uuid: image_uuid,\r\n\t\t\t\t\t\tstorage_uuid: storage_uuid,\r\n\t\t\t\t\t\tstorage_type: storage_type\r\n\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\tif(storage_type=='local'){\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'local', resource_pool_uuid: pool.uuid},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formLocalData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.locals.splice(0, $scope.locals.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.locals,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tmanageTemplate.query({id: IMG.id, storage_type: 'remote'},function(res){\r\n\t\t\t\t\t\t\t\tvar newData = formRemoteData(res.result.sort(function(a,b){ return a.image_type>b.image_type?-1:1 }));\r\n\t\t\t\t\t\t\t\t$scope.remotes.splice(0, $scope.remotes.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply($scope.remotes,newData);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t// img.status = 'sended failed';\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t\t$scope.deleteImg = function(storage_type, volume_uuid, img, storage_uuid, pool){\r\n\t\t\t\t\tif(!img.has_instance){\r\n\t\t\t\t\t\timg.volume_status = 'deleting';\r\n\t\t\t\t\t\tmanageTemplate.delete({\r\n\t\t\t\t\t\t\tstorage_type: storage_type,\r\n\t\t\t\t\t\t\tid: IMG.id,\r\n\t\t\t\t\t\t\tvolume_uuid: volume_uuid,\r\n\t\t\t\t\t\t\timage_uuid: img.image_uuid,\r\n\t\t\t\t\t\t\tstorage_uuid: storage_uuid\r\n\t\t\t\t\t\t},function(res){\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t},function(){\r\n\t\t\t\t\t\t\timg.volume_status = 'delete failed';\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t})\r\n\t};\r\n\t$scope.detail = function(item){\r\n\t\t$modal.open({\r\n\t\t\ttemplateUrl: \"views/vdi/dialog/template/template_detail.html\",\r\n\t\t\tsize: \"md\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\ttemplate.infor({ image_id: item.id }, function(infor){\r\n\t\t\t\t\t$scope.data = infor;\r\n\t\t\t\t\tfunction formData(obj){\r\n\t\t\t\t\t\tobj.imgs = [];\r\n\t\t\t\t\t\tfor(var i in obj){\r\n\t\t\t\t\t\t\tif(i!=='imgs'){\r\n\t\t\t\t\t\t\t\tvar img = {};\r\n\t\t\t\t\t\t\t\timg.location = i;\r\n\t\t\t\t\t\t\t\timg.volumeId = obj[i];\r\n\t\t\t\t\t\t\t\tobj.imgs.push(img);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tfor(var i in $scope.data.inst_volumes){\r\n\t\t\t\t\t\tformData($scope.data.inst_volumes[i]);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tnetwork.query(function(data){\r\n\t\t\t\t\t\t$scope.data.network = data.networks.filter(function(data){ return data.id===infor.nets[0].network_id })[0];\r\n\t\t\t\t\t\tif(infor.nets[0].subnet_id){\r\n\t\t\t\t\t\t\tnetwork.query_sub({id: infor.nets[0].network_id }, function(res){\r\n\t\t\t\t\t\t\t\tvar subnet = res.result.filter(function(data){ return data.id === infor.nets[0].subnet_id })[0];\r\n\t\t\t\t\t\t\t\t$scope.data.subnet = subnet.name +\" (\"+ subnet.start_ip + \"~\" + subnet.end_ip +\")\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}, function(){});\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}])\r\n\r\n.controller(\"addPersonalTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"PersonTemplate\", \"HardwareTemplate\", \"SystemISO\", \"Admin\", \"$$$os_types\",\"$$$I18N\", \"UserRole\",\"Network\", \"virtualHost\", \"networkWithHost\", \"checkIP\",\r\nfunction($scope, $modalInstance, personal, hardware, iso, admin, $$$os_types,$$$I18N, UserRole, network, virtualHost, networkWithHost, checkIP){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.auto_isos = [];$scope.all_isos = [];\r\n\t$scope.iso = [];\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name == user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t});\r\n\t\tif(!$scope.owner) $scope.owner = $scope.users[0]\r\n\t});\r\n\thardware.query(function(res){\r\n\t\t$scope.hardware_templates = res.result;\r\n\t\t$scope.template = $scope.hardware_templates[0];\r\n\t});\r\n\tiso.query(function(res){\r\n\t\t$scope.all_isos = res.isos.filter(function(iso){ return iso.type && iso.type!==\"package\" && iso.type!==\"other\"; });\r\n\t\t$scope.all_isos.forEach(function(item){\r\n\t\t\titem.os_type = item.os_type.split(\",\");\r\n\t\t});\r\n\t\t$scope.isos = $scope.all_isos;\r\n\t\t$scope.iso = [$scope.isos[0]];\r\n\t\tangular.forEach($scope.isos, function(item){\r\n\t\t\tif(item.support_auto_install == true)\r\n\t\t\t\t$scope.auto_isos.push(item);\r\n\t\t})\r\n\t});\r\n\r\n\t$scope.type = 'kvm';\r\n\t$scope.enable_gpu = false;\r\n\t$scope.getVirtualHost = function (type){\r\n\t\tvar _this = this;\r\n\t\t$scope.host_loading = true;\r\n\t\tvar data = {};\r\n\t\tdata.type = type;\r\n\t\tif(type=='hyper-v'){\r\n\t\t\tdata.enable_gpu = _this.enable_gpu;\r\n\t\t\t_this.gpu_auto_assignment = false;\r\n\t\t}else{\r\n\t\t\tdata.enable_gpu = _this.gpu_auto_assignment;\r\n\t\t\t_this.enable_gpu = false;\r\n\t\t}\r\n\t\tvirtualHost.query(data,function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t_this.host = $scope.hosts[0];\r\n\t\t\t_this.host && $scope.getNetwork(_this.host);\r\n\t\t},function(){\r\n\r\n\t\t});\r\n\t}\r\n\t$scope.getVirtualHost($scope.type);\r\n\t\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip = _scope.band_ips[0];\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope);\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\r\n\t\t}\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\t$scope.names = $scope.rows.map(function(item){ return item.name });\r\n\t$scope.sameName = false;\r\n\tvar _scope = $scope;\r\n\t$scope.install = \"manualinstall\";\r\n\t$scope.isOther = false;\r\n\t$scope.$on(\"selectStepChange\", function(e, arg){\r\n\t\tif(arg.index==0){\r\n\t\t\targ.stepScope.$$nextSibling.error = false;\r\n\t\t}\r\n\t})\r\n\t$scope.$on(\"WizardStep_0\", function(e, step, scope){\r\n\t\tscope.error = step.is_dirty;\r\n\t\t_scope.type = scope.type;\r\n\t\tvar flag = false;\r\n\t\t_scope.names.forEach(function(item){\r\n\t\t\tif(scope.name == item){ flag = true; }\r\n\t\t})\r\n\t\tif(flag){\r\n\t\t\t_scope.sameName = true;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"WRONG_NAME\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse { _scope.sameName = false; }\r\n\t\tstep.done = !scope.step_pane0.$invalid && !_scope.sameName && !scope.network_loading;\r\n\r\n\t\tif(step.done && scope.$$childTail && scope.$$childTail.bind_ip){\r\n\t\t\tstep.showLoading = true;\r\n\t\t\tstep.done = false;\r\n\t\t\tcheckIP.check({ip: scope.$$childTail.bind_ip, subnet_id: scope.subnet.id},function(res){\r\n\t\t\t\tif(!res.result){\r\n\t\t\t\t\t$.bigBox({\r\n\t\t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\t\tcontent\t: $$$I18N.get(\"USEDIP\"),\r\n\t\t\t\t\t\ttimeout\t: 6000\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$scope.$broadcast(\"currentStepChange\", 1);\r\n\t\t\t\t}\r\n\t\t\t\tstep.showLoading = false;\r\n\t\t\t},function(error){ step.showLoading = false; });\r\n\t\t}\r\n\t});\r\n\t$scope.$on(\"WizardStep_1\", function(e, step, scope){\r\n\t\tif(scope.template.system_gb == 0)\r\n\t\t\t$.bigBox({\r\n\t\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\t\tcontent\t: $$$I18N.get(\"模板系统盘不能为0\"),\r\n\t\t\t\t\tcolor\t: \"#C46A69\",\r\n\t\t\t\t\ticon\t: \"fa fa-warning shake animated\",\r\n\t\t\t\t\ttimeout\t: 6000\r\n\t\t\t\t});\r\n\t\tstep.done = !(scope.template.system_gb == 0);\r\n\t});\r\n\t$scope.$on(\"WizardStep_2\", function(e, step, scope){\r\n\t\tsetTimeout(function(){\r\n\t\t\t$(\"[rel=popover-hover]\").popover({\r\n\t\t\t\ttrigger : \"hover\"\r\n\t\t\t});\r\n\t\t})\r\n\t\t_scope.install = scope.install;\r\n\t\tif(scope.iso != undefined && scope.iso[0] != undefined){\r\n\t\t\tif(scope.iso[0].os_type[0] == 'other'){\r\n\t\t\t\t_scope.isOther = true;\r\n\t\t\t\tscope.$parent.system_versions = $$$os_types;\r\n\t\t\t\tscope.$parent.system_version1 = scope.$parent.system_versions[0];\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tvar _types = [];\r\n\t\t\t\tscope.iso[0].os_type.forEach(function(item){\r\n\t\t\t\t\tvar _obj = {};\r\n\t\t\t\t\t_obj.key = item;\r\n\t\t\t\t\t_obj.value = item;\r\n\t\t\t\t\t_types.push(_obj);\r\n\t\t\t\t})\r\n\t\t\t\tscope.$parent.system_versions = _types;\r\n\t\t\t\tscope.$parent.system_version1 = _types[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tscope.error = step.is_dirty;\r\n\t\tstep.done = (scope.iso != undefined && scope.iso[0] != undefined);\r\n\t\t\r\n\t});\r\n\tvar newWindow;\r\n\tvar FLAG = false;\r\n\tfunction gotoUrl(val){\r\n\t\tif(val){\r\n\t\t\tnewWindow = window.open('templateModify.html#0');\r\n\t\t\t// newWindow = window.open('js/vdi-spice/spiceModify.html#?id=0');\r\n\t\t}\r\n\t}\r\n\tsetTimeout(function(){\r\n\t\t$(\"#finish\").on('click',function(){\r\n\t\t    gotoUrl(FLAG);\r\n\t\t})\r\n\t})\r\n\r\n\t$scope.$on(\"WizardStep_3\", function(e, step, scope){\r\n\t\tif(scope.step_pane3.$invalid){\r\n\t\t\tscope.error = step.is_dirty;\r\n\t\t\tstep.done = false;\r\n\t\t}\r\n\t\telse if(scope.userPassword && scope.userPasswordConfirm && scope.userPassword !== scope.userPasswordConfirm){\r\n\t\t\tstep.done = false;\r\n\t\t\t$.bigBox({\r\n\t\t\t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t\t\tcontent\t: $$$I18N.get(\"两次输入密码不一致\"),\r\n\t\t\t\ttimeout\t: 6000\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tstep.done = true;\r\n\t\tFLAG = step.done;\r\n\t});\r\n\t$scope.$on(\"WizardDone\", function(e, steps, scopes){\r\n\t\tvar auto_install = scopes[2].install === \"autoinstall\" ? true : false;\r\n\t\tvar _ip = scopes[0].bind_ip_type.value === 'static' ? scopes[0].$$childHead.bind_ip : undefined;\r\n\t\tvar testWin10 = /Windows10/;\r\n\t\tvar item = {\r\n\t\t\ttemplate_name: scopes[0].name,\r\n\t\t\tdescription: scopes[0].description,\r\n\t\t\towner: scopes[0].owner.id,\r\n\t\t\ttype_code : 2,\r\n\t\t\tvcpus: scopes[1].template.cpu_num,\r\n\t\t\tsystem_gb: scopes[1].template.system_gb,\r\n\t\t\tlocal_gb: scopes[1].template.local_gb,\r\n\t\t\tmemory_mb: scopes[1].template.memory_mb,\r\n\t\t\tiso_path:scopes[2].iso[0].name,\r\n\t\t\tiso_id:scopes[2].iso[0].id,\r\n\t\t\tos_type: scopes[3].system_version1.key,\r\n\t\t\tinstance_type: scopes[1].template.id,\r\n\t\t\tauto_install: auto_install,\r\n\t\t\tnetwork: scopes[0].network.id,\r\n\t\t\tsubnet: scopes[0].subnet?scopes[0].subnet.id:'',\r\n\t\t\tband_ip: _ip,\r\n\t\t\tband_type: scopes[0].bind_ip_type.value,\r\n\t\t\tkey:scopes[3].key,\r\n\t\t\tusername:scopes[3].userName,\r\n\t\t\tuserPassword:scopes[3].userPassword,\r\n\t\t\tuserPasswordConfirm:scopes[3].userPasswordConfirm,\r\n\t\t\tvirtual_type: scopes[0].type,\r\n\t\t\tenable_gpu: scopes[0].type == 'hyper-v'? scopes[0].enable_gpu:undefined,\r\n\t\t\tgpu_auto_assignment: scopes[0].type == 'kvm'? scopes[0].gpu_auto_assignment:undefined,\r\n\t\t\tfirmware_type: scopes[0].type == 'kvm' && testWin10.test(scopes[3].system_version1.key)?'uefi':undefined,\r\n\r\n\t\t\thost_uuid: scopes[0].host.host_uuid\r\n\t\t};\r\n\t\tfunction updateTem(isSuccess){\r\n\t\t\tpersonal.query(function(res){\r\n\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\treturn item.virtual_type === scopes[0].type;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t});\r\n\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t// if(!auto_install){\r\n\t\t\t\t\tvar template = $scope.rows.filter(function(temp){ return temp.name ==  item.template_name})[0];\r\n\t\t\t\t\tif(template && isSuccess){\r\n\t\t\t\t\t\tif(scopes[0].type == \"hyper-v\"){\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t\tnewWindow.location.reload();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tnewWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// if(scopes[0].type == \"hyper-v\"){\r\n\t\t\t\t\t\t// \tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModify_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModifybt_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t// else{\r\n\t\t\t\t\t\t// \tif(res.sync_mode==='scp'){\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t// newWindow.location.reload();\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModify.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t\tnewWindow.location.reload();\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// \telse{\r\n\t\t\t\t\t\t// \t\t// newWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name);\r\n\t\t\t\t\t\t// \t\t//novnc-->spice-html5\r\n\t\t\t\t\t\t// \t\tnewWindow.location.replace('js/vdi-spice/spiceModifybt.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+\"&instance_id=\"+template.instance_id);\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t}\r\n\t\t\t\t// }\r\n\t\t\t});\r\n\t\t};\r\n\t\te.targetScope.currentStep.showLoading = true;\r\n\t\t$modalInstance.close();\r\n\t\tpersonal.save(item, function(res){ updateTem(true); }, function(){ newWindow.close(); updateTem(); }).$promise.finally(function(){\r\n\t\t\te.targetScope.currentStep.showLoading = false;\r\n\t\t});;\r\n\t});\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\t$scope.cpu_num = 1;\r\n}])\r\n\r\n.controller(\"registerPersonalTemplateDialog\", [\r\n\"$scope\", \"$modalInstance\", \"Admin\", \"registerTemplate\", \"PersonTemplate\", \"$$$os_types\", \"UserRole\", \"Network\", \"virtualHost\",\"networkWithHost\", \"$$$I18N\",\r\nfunction($scope, $modalInstance, admin, registerTemplate, personal, $$$os_types, UserRole, network, virtualHost, networkWithHost, $$$I18N){\r\n\tlet user = UserRole.currentUser;\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;$scope.min_passwordLe=6;$scope.max_passwordLe=20;\r\n\t$scope.type = '2';\r\n\t$scope.types1 = [{name: $$$I18N.get('不分配'), value: 'none'}];\r\n\t$scope.types2 = [{name: $$$I18N.get('系统分配'), value: 'auto'},{name: $$$I18N.get('固定IP'), value: 'static'}];\r\n\t$scope.types = $scope.types2;\r\n\t$scope.bind_ip_type = $scope.types2[0];\r\n\tadmin.query(function(res){\r\n\t\t$scope.users = res.users;\r\n\t\tangular.forEach($scope.users, function(item){\r\n\t\t\tif(item.name === user.name)\r\n\t\t\t\t$scope.owner = item;\r\n\t\t})\r\n\t});\r\n\tregisterTemplate.query(function(res){\r\n\t\t$scope.sys_isos = res.system_image;\r\n\t\t$scope.sys_iso = res.system_image[0];\r\n\t\t$scope.old_data_isos = res.data_image;\r\n\t\tif($scope.sys_iso){\r\n\t\t\t$scope.getDataImgs($scope.sys_iso);\r\n\t\t}\r\n\t})\r\n\t$scope.filterDataISO = function(data_iso, data_iso2){\r\n\t\tif(data_iso){\r\n\t\t\t$scope.data_isos2 = $scope.data_isos.filter(function(item){ return item.name !== data_iso.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos2 = $scope.data_isos;\r\n\t\t}\r\n\t\tif(data_iso2){\r\n\t\t\t$scope.data_isos1 = $scope.data_isos.filter(function(item){ return item.name !== data_iso2.name });\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$scope.data_isos1 = $scope.data_isos;\r\n\t\t}\r\n\t};\r\n\t$scope.getDataImgs = function(systemImg){\r\n\t\tif(systemImg){\r\n\t\t\tthis.data_iso = undefined;\r\n\t\t\tthis.data_iso2 = undefined;\r\n\t\t\t$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function(item){ return item.virtual_type == systemImg.virtual_type });\r\n\t\t\t// $scope.data_iso = $scope.data_isos[0];\r\n\t\t\t// $scope.data_iso2 = $scope.data_isos[0];\r\n\t\t\t$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);\t\t\t\r\n\t\t}\r\n\t};\r\n\t$scope.getVirtualHost = function (type, rbd_enabled){\r\n\t\t$scope.host_loading = true;\r\n\t\tvirtualHost.query({\r\n\t\t\tvirtual_type: type,\r\n\t\t\trbd_enabled: rbd_enabled\r\n\t\t\t// enable_gpu: type == 'hyper-v'?enable_gpu:undefined\r\n\t\t},function(res){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t\t$scope.hosts = res.result;\r\n\t\t\t$scope.host = $scope.hosts[0];\r\n\t\t\t$scope.getNetwork($scope.host);\r\n\t\t},function(){\r\n\t\t\t$scope.host_loading = false;\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.os_types = $$$os_types.filter(function(item){ return item.key!==\"package\" });\r\n\t$scope.os_type = $scope.os_types[0];\r\n\t// $scope.enable_gpu = false;\r\n\t$scope.bind_ip = {value: null};\r\n\r\n\t// function getIps(subnet_id, _scope){\r\n\t// \tif(subnet_id){\r\n\t// \t\tnetwork.ports({ id: subnet_id },function(res){\r\n\t// \t\t\tif(res.unused_ips.length){\r\n\t// \t\t\t\t_scope.band_ips = res.unused_ips;\r\n\t// \t\t\t}\r\n\t// \t\t\telse{\r\n\t// \t\t\t\t_scope.band_ips = [\"无可用IP\"];\r\n\t// \t\t\t}\r\n\t// \t\t\t_scope.bind_ip = _scope.band_ips[0];\r\n\t// \t\t\t_scope.bind_ip_loading = false;\r\n\t// \t\t})\r\n\t// \t}\r\n\t// };\r\n\t$scope.switchIps = function(subnet,_scope){\r\n\t\t// _scope.bind_ip_loading = true;\r\n\t\tif(subnet){\r\n\t\t\t// getIps(subnet.id, _scope)\r\n\t\t\t_scope.types = _scope.types2;\r\n\t\t\t_scope.bind_ip_type = _scope.types2[0];\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.types = _scope.types1;\r\n\t\t\t_scope.band_ips = [];\r\n\t\t\t_scope.bind_ip_type = _scope.types1[0];\r\n\t\t\t// _scope.bind_ip_loading = false;\r\n\t\t}\r\n\t};\r\n\tfunction getSubnets(Network,_scope){\r\n\t\tif(Network.subnets.length){\r\n\t\t\t$scope.network_loading = true;\r\n\t\t\t// $scope.bind_ip_loading = true;\r\n\t\t\tnetwork.query_sub({id: Network.id }, function(res){\r\n\t\t\t\t_scope.subnets = res.result;\r\n\t\t\t\t_scope.subnet = _scope.subnets[0];\r\n\t\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t\t\t$scope.network_loading = false;\r\n\t\t\t}, function(){ $scope.network_loading = false; })\r\n\t\t}\r\n\t\telse{\r\n\t\t\t_scope.subnets = [];\r\n\t\t\t_scope.subnet = null;\r\n\t\t\t_scope.switchIps(_scope.subnet, _scope);\r\n\t\t}\r\n\t};\r\n\t$scope.getNetwork = function(host){\r\n\t\tif(host){\r\n\t\t\tnetworkWithHost.query({host: host.host_uuid}, function(res){\r\n\t\t\t\t// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });\r\n\t\t\t\t$scope.networks = res.result;\r\n\t\t\t\t$scope.network = $scope.networks[0];\r\n\t\t\t\tgetSubnets($scope.network, $scope);\r\n\t\t\t}, function(){});\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\t$scope.switchSubnet = function(val, _scope){\r\n\t\tgetSubnets(val,_scope);\r\n\t}\r\n\r\n\t$scope.ok = function(){\r\n\t\tvar bindIP = this.bind_ip.value;\r\n\t\t// if(this.bind_ip_type.value === 'static' && this.bind_ip === '无可用IP'){\r\n\t\t// \t$.bigBox({\r\n\t\t// \t\ttitle\t: $$$I18N.get(\"INFOR_TIP\"),\r\n\t\t// \t\tcontent\t: $$$I18N.get(\"hasStaticIP_TIP\"),\r\n\t\t// \t\ttimeout\t: 6000\r\n\t\t// \t});\r\n\t\t// }\r\n\t\t// else{\r\n\t\t\t$scope.submiting = true ;\r\n\t\t\t$scope.afterSubmiting =false ;\r\n\t\t\tvar _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;\r\n\t\t\tvar postData = {\r\n\t\t\t\tsystem_image_file: this.sys_iso,\r\n\t\t\t\tdata_image_file: this.data_iso?this.data_iso:undefined,\r\n\t\t\t\tdata_image_file_2: this.data_iso2?this.data_iso2:undefined,\r\n\t\t\t\tname: this.name,\r\n\t\t\t\tdescription: this.description,\r\n\t\t\t\ttype_code: this.type,\r\n\t\t\t\tos: this.os_type.key,\r\n\t\t\t\tis_64: this.os_type.value.indexOf(\"64 bit\")>-1?true: false,\r\n\t\t\t\towner: this.owner.id,\r\n\t\t\t\tnetwork: this.network.id,\r\n\t\t\t\tsubnet: this.subnet?this.subnet.id:'',\r\n\t\t\t\tband_ip: _ip,\r\n\t\t\t\tband_type: this.bind_ip_type.value,\r\n\t\t\t\thost_uuid: this.host.host_uuid,\r\n\t\t\t\tusername: this.sys_iso.virtual_type=='hyper-v'?this.username:undefined,\r\n\t\t\t\tuserPassword: this.sys_iso.virtual_type=='hyper-v'?this.userPassword:undefined,\r\n\t\t\t\tuserPasswordConfirm: this.sys_iso.virtual_type=='hyper-v'?this.userPasswordConfirm:undefined\r\n\t\t\t\t// enable_gpu: this.sys_iso.virtual_type == 'hyper-v'?this.enable_gpu:undefined\r\n\t\t\t};\r\n\t\t\tconsole.log(postData)\r\n\t\t\tregisterTemplate.update(postData, function(res){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = true ;\r\n\t\t\t\tpersonal.query(function(res){\r\n\t\t\t\t\t$scope.allrows.splice(0, $scope.allrows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.allrows,res.win_images.concat(res.linux_images).concat(res.other_images));\r\n\t\t\t\t\tvar newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function(item){\r\n\t\t\t\t\t\tif($scope.select === 'all'){\r\n\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn item.virtual_type === $scope.select;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.forEach(function(row){\r\n\t\t\t\t\t\tvar os = $$$os_types.filter(function(item){ return item.key === row.os_type })[0];\r\n\t\t\t\t\t\tos && os.icon && (row.icon = os.icon);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewRows.sort(function(a,b){ return a.created_at>b.created_at? -1:1 });\r\n\t\t\t\t\t$scope.rows.splice(0, $scope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply($scope.rows,newRows);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},function(){\r\n\t\t\t\t$scope.submiting = false ;\r\n\t\t\t\t$scope.afterSubmiting = false ;\r\n\t\t\t});\r\n\t\t// }\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n}])\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controller.person.js","angular.module(\"vdi.template.hardware\", [\"vdi.template\"])\r\n\r\n.factory(\"HardwareTemplate\", [\"$resource\", \"$Domain\", function(res, $Domain){\r\n\treturn res($Domain + \"/thor/image\", null, {\r\n\t\tquery:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/hardwares\", isArray: false },\r\n\t\t\"delete\":\r\n\t\t\t{ method: \"DELETE\", url: $Domain + \"/thor/image/hardwares\" },\r\n\t\tsave:\r\n\t\t\t{ method: \"POST\",url: $Domain + \"/thor/image/hardwares\" },\r\n\t\tget:\r\n\t\t\t{ method: \"GET\", url: $Domain + \"/thor/image/hardwares/:id\", params: { id: \"@id\"}, isArray: false },\r\n\t\tupdate:\r\n\t\t\t{ method: \"PUT\", url: $Domain + \"/thor/image/hardware/:id\", params: { id: \"@id\"}, isArray: false },\r\n\t\t// 过滤模板\r\n\t\tfilter:\r\n\t\t\t{ method: \"GET\", url:$Domain + \"/thor/image/hardwares\"}\r\n\t});\r\n}])\r\n\r\n.controller(\"vdiTemplateHardwareListController\", [\"$scope\", \"$modal\", \"HardwareTemplate\", function($scope, $modal, hardware){\r\n\t$scope.rows = [];\r\n\t$scope.loading = true;\r\n\tvar _controllerScope = $scope;\r\n\thardware.query(function(res){\r\n\t\t$scope.rows = res.result;\r\n\t\t$scope.loading = false;\r\n\t});\r\n\r\n    $scope.currentPage = 1;\r\n    $scope.pagesizes = [30,20,10];\r\n    $scope.pagesize = $scope.pagesizes[0];\r\n\t\r\n\t$scope.delete = function(item){\r\n\t\tvar rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });\r\n\t\t$modal.open({\r\n\t\t\ttemplate: \"<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除硬件模板'>\"+\r\n\t\t\t\t\t\"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_H' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>\",\r\n\t\t\tcontroller: function($scope, $modalInstance){\r\n\t\t\t\t$scope.name = rows.map(function(row){ return row.name }).join(', ');\r\n\t\t\t\t$scope.ok = function(){\r\n\t\t\t\t\thardware.delete(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"instance_type_id\": rows.map(function(item){ return item.id })\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(){\r\n\t\t\t\t\t\t\thardware.query(function(res){\r\n\t\t\t\t\t\t\t\tvar newRows = res.result;\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfunction(error){\r\n\t\t\t\t\t\t\thardware.query(function(res){\r\n\t\t\t\t\t\t\t\tvar newRows = res.result;\r\n\t\t\t\t\t\t\t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t\t\t\t\t\t\t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t};\r\n\t\t\t\t$scope.close = function(){\r\n\t\t\t\t\t$modalInstance.close();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsize: \"sm\"\r\n\t\t});\r\n\t};\r\n}])\r\n\r\n.controller(\"addHardwareTemplateDialog\", [\"$scope\", \"$modalInstance\",\"HardwareTemplate\",function($scope,$modalInstance,hardware){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\t$scope.data = {\r\n\t\tcpu_num:1,\r\n\t\tmemory_mb:1,\r\n\t\tsystem_gb:10\r\n\t\t// system_disk_type: \"2\",\r\n\t\t// local_disk_type: \"3\"\r\n\t};\r\n\t$scope.btndisks = [];\r\n\t// $scope.data.system_disk_type = \"2\";$scope.data.local_disk_type = \"3\";\r\n\tvar _controllerScope = $scope;\r\n\t$scope.ok = function(){\r\n\t\tvar _this = this;\r\n\t\thardware.save({\r\n\t\t\t\t\"name\" : this.data.name,\r\n\t\t\t\t\"cpu_num\" : this.data.cpu_num,\r\n\t\t\t\t\"memory_mb\": this.data.memory_mb*1024,\r\n\t\t\t\t\"system_gb\" :this.data.system_gb,\r\n\t\t\t\t\"local_gb\" : this.btndisks[0]?this.btndisks[0].local_gb:0,\r\n\t\t\t\t\"local_gb1\" : this.btndisks[1]?this.btndisks[1].local_gb:0\r\n\t\t\t\t// \"system_disk_type\": this.data.system_disk_type,\r\n\t\t\t\t// \"local_disk_type\": this.data.local_disk_type\r\n\t\t\t},\r\n\t\t\tfunction(data){\r\n\t\t\t\t// $scope.rows.unshift({\r\n\t\t\t\t// \tid: data.id,\r\n\t\t\t\t// \tname : _this.data.name,\r\n\t\t\t\t// \tcpu_num : _this.data.cpu_num,\r\n\t\t\t\t// \tmemory_mb: _this.data.memory_mb*1024,\r\n\t\t\t\t// \tsystem_gb : _this.data.system_gb,\r\n\t\t\t\t// \tlocal_gb : _this.data.local_gb,\r\n\t\t\t\t// \t\"system_disk_type\": _this.data.system_disk_type,\r\n\t\t\t\t// \t\"local_disk_type\": _this.data.local_disk_type\r\n\t\t\t\t// });\r\n\t\t\t\thardware.query(function(res){\r\n\t\t\t\t\tvar newRows = res.result;\r\n\t\t\t\t\t_controllerScope.rows.splice(0, _controllerScope.rows.length);\r\n\t\t\t\t\tArray.prototype.push.apply(_controllerScope.rows,newRows);\r\n\t\t\t\t});\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\r\n\t$scope.addbtndisk = function(){\r\n\t\t$scope.btndisks.push({local_gb: 5});\r\n\t};\r\n\t$scope.minusbtndisk = function(){\r\n\t\t// var idx = $scope.btndisks.indexOf(i)\r\n\t\t$scope.btndisks.splice($scope.btndisks.length-1,1);\r\n\t};\r\n\t\r\n}])\r\n\r\n.controller(\"editHardwareTemplateDialog\", [\"$scope\", \"$modalInstance\",\"HardwareTemplate\", function($scope, $modalInstance, hardware){\r\n\t$scope.min_namelength=2;$scope.max_namelength=20;\r\n\tvar item = $scope.item || $scope.currentItem;\r\n\t$scope.data = angular.copy(item);\r\n\t$scope.isUnchanged = function(){\r\n\t\treturn angular.equals($scope.item,$scope.data) || angular.equals($scope.currentItem,$scope.data);\r\n\t}\r\n\t$scope.reset = function() {\r\n\t\t$scope.data = angular.copy($scope.item || $scope.currentItem);\r\n\t};\r\n\t$scope.edit = function(){\r\n\t\thardware.update(\r\n\t\t\t$scope.data,\r\n\t\t\tfunction(res){\r\n\t\t\t\titem.name = res.name;\r\n\t\t\t\titem.cpu_num = res.cpu_num;\r\n\t\t\t\titem.memory_mb = res.memory_mb;\r\n\t\t\t\titem.local_gb = res.local_gb;\r\n\t\t\t\titem.system_gb = res.system_gb;\r\n\t\t\t\t$modalInstance.close();\r\n\t\t\t},\r\n\t\t\tfunction(){\r\n\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\t$scope.close = function(){\r\n\t\t$modalInstance.close();\r\n\t};\r\n\r\n\t$scope.useNum=\"1\"\r\n\t$scope.btndisks = [];\r\n\t$scope.addharddisk = function(){\r\n\t\t$scope.useNum-=1\r\n\t\t$scope.btndisks.push(new String);\r\n\t};\r\n\t$scope.deleteharddisk = function(itemindex){\r\n\t\t$scope.useNum+=1\r\n\t\t$scope.btndisks.splice(itemindex, 1);\r\n\t};\r\n}])\n\n\n// WEBPACK FOOTER //\n// ./js/vdi/template/controller.hardware.js"],"sourceRoot":""}