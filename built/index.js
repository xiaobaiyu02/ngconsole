/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/devbuild/";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 50);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * 这个文件会在每个独立页面用到，如：init, index, templateXXX
 */

// TODO: 移动到基础代码
window.$$$storage = {
	getSessionStorage: function getSessionStorage(key) {
		return sessionStorage.getItem('vdi_' + key);
	},
	setSessionStorage: function setSessionStorage(key, value) {
		sessionStorage.setItem('vdi_' + key, value);
	},
	clearSessionStorage: function clearSessionStorage() {
		sessionStorage.clear();
	}
};

// 提供翻译的闭包变量
var codeData = {};
var i18nData = {};
var imagesData = {};

var firstKey = void 0; // 记录第一个支持的 OEM，没有其它选择的时候使用这个
var ng = angular.module("ng");
var supportedOems = getSupportedOEMs();
var currentOEM = null;

var host = location.hostname;
var hasBootstrap = false;

// 定义后端接口地址
var domain = location.protocol + "//" + host + ":8081"; // 多数用这个
var controllerDomain = location.protocol + "//" + host + ":19891"; // 很少用
var interfaceDomain = location.protocol + "//" + host + ":19893"; // 很少用
if (window.vdiEnvironment === "development") {
	host = $$$storage.getSessionStorage('dev_host');
	// use dev_host
	if (host) {
		domain = "http://" + host + ":8081";
		controllerDomain = "http://" + host + ":19891";
		interfaceDomain = "http://" + host + ":19893";
	} else {
		// use mock server
		domain = controllerDomain = interfaceDomain = location.origin;
	}
}

main();

/* 定义一些 angular 服务 */
ng.constant("$Domain", domain);
ng.constant("$controllerDomain", controllerDomain);
ng.constant("$interfaceDomain", interfaceDomain);
ng.constant("$splitDomain", location.protocol + "//" + ($$$storage.getSessionStorage('splitIP') || domain) + ":8081");
var splitDomain = location.protocol + "//" + ($$$storage.getSessionStorage('splitIP') || domain) + ":8081";
ng.service("$RESOURCE", [function () {
	this.get = function (key) {
		return supportedOems[key];
	};
	this.load = function (langCode, cb) {
		loadOEMResources(langCode, cb);
	};
}]);

ng.factory("settings", [function () {
	return {
		languages: Object.keys(supportedOems).map(function (key) {
			return supportedOems[key];
		}),
		currentLang: supportedOems[currentOEM]
	};
}]);

ng.service("$$$MSG", [function () {
	this.get = function (key) {
		return codeData[key] || "";
	};
}]);

ng.service("$$$I18N", [function () {
	this.get = function (key) {
		return i18nData[key] || "";
	};
}]);
ng.service("$$$IMAGES", [function () {
	this.get = function (key) {
		return imagesData[key] || "";
	};
}]);
ng.constant("$$$os_types", __webpack_require__(1));
ng.config(["$httpProvider", function ($httpProvider) {
	$httpProvider.interceptors.push(["$q", "$rootScope", "$$$MSG", function ($q, $root, $$$MSG) {
		return {
			"request": function request(config) {
				if (/^https?\:\/\//.test(config.url)) {
					config.withCredentials = true;
					return config;
				}
				if (/\.html$/i.test(config.url)) {
					return config;
				}
				if (!/^https?:\/\//.test(config.url)) {
					config.withCredentials = true;
					config.url = domain + config.url;
				}
				return config;
			},
			"requestError": function requestError(reject) {
				console.log("REQ_ERROR");
				return $q.reject({
					info: reject
				});
			},
			"responseError": function responseError(reject) {
				console.log("RES_ERROR", arguments);
				return $q.reject({
					code: 100,
					message: $$$MSG.get("返回信息格式错误"),
					info: reject
				});
			},
			"response": function response(res) {
				if (/^https?\:\/\//.test(res.config.url)) {
					if (/\/thor\/toolkit\//.test(res.config.url) || /\/v1\/(?:node|network)\//.test(res.config.url)) {
						return res;
					} else {
						switch (res.data.code) {
							case 17001:
								$root.$broadcast("NOAUTH");
								break;
							case 11011:
								$$$storage.setSessionStorage('returnUrl', location.href);
								location.replace("init.html");
								break;
							case 0:
								return res;
							default:
								if (/\/thor\/home\/tasklog/.test(res.config.url)) {
									return $q.reject(res);
								}
								if (window.ignoreAnyRequestError) {
									return res;
								}
								$.bigBox && $.bigBox({
									title: $$$MSG.get("PAI_CODE") + res.data.code,
									content: $$$MSG.get(res.data.code) == '' ? res.data.message : $$$MSG.get(res.data.code),
									color: "#C46A69",
									icon: "fa fa-warning shake animated",
									timeout: 6000
								});
								break;
						}
						return $q.reject(res);
					}
				}
				return res;
			}
		};
	}]);
}]);

/**
 * 启动 angular app
 * @param {String} oem oem 名字
 */
function bootstrap(oem) {
	var oemData = supportedOems ? supportedOems[oem] : null;
	if (!oemData) {
		if (window.vdiEnvironment === "development") {
			return alert("加载资源出错！");
		}
	}
	if (oemData.code && oemData.lang && oemData.images) {
		var $body = $(document.body);
		var theme = $$$storage.getSessionStorage('current_theme') || "smart-style-0";
		if (!/personal_login/.test(location.pathname)) {
			$body.addClass(theme);
			$("#vdi_skins_url").attr("href", '/resources/pkg/' + oem + '/skins.css');
			$body.fadeIn(1000);
		}

		// 仅开发模式提示
		if (window.vdiEnvironment === "development" && !window.$$$MAIN_MODULE) {
			return alert("main module is not defined!");
		}
		angular.bootstrap(document, [].concat(window.$$$MAIN_MODULE));
		hasBootstrap = true;
	}
}

/**
 * 加载指定的 OEM 资源
 * @param {String} oem 要加载的 OEM 资源
 * @param {Function} cb 加载成功后的回调
 */
function loadOEMResources(oem, cb) {
	if (!oem) {
		if (window.vdiEnvironment === "development") {
			return alert("获取资源 key 失败！");
		}
	}
	if (!(oem in supportedOems)) {
		console.error("unsupported resource key:", oem);
		oem = Object.keys(supportedOems)[0];
	}
	var oemData = supportedOems[oem];
	// 先检查后加载
	if (oemData.code && oemData.lang && oemData.images) {
		codeData = oemData.code;
		i18nData = oemData.lang;
		imagesData = oemData.images;
		return cb(oemData);
	}
	$.when($.getJSON('/resources/pkg/' + oem + '/code.js'), $.getJSON('/resources/pkg/' + oem + '/lang.js'), $.getJSON('/resources/pkg/' + oem + '/images.js')).done(function (codeResponse, langResponse, imagesResponse) {
		codeData = oemData.code = codeResponse[0];
		i18nData = oemData.lang = langResponse[0];
		imagesData = oemData.images = imagesResponse[0];
		if (!hasBootstrap) {
			registerLazyService();
			bootstrap(oem);
		} else {
			cb && cb(oemData);
		}
	}).fail(function () {
		console.log('load ' + oem + ' resource error:', arguments[2]);
	});
	currentOEM = oem;
}
function main() {
	var statusXhr = $.get(controllerDomain + "/v1/node/status");
	var langXhr = $.get(domain + "/thor/init/lang");
	var status_ha = $.get(domain + "/thor/get_controller_ha_status");
	$.when(statusXhr, langXhr, status_ha).done(function (statusResponse, langResponse, haResponse) {
		if (typeof statusResponse[0] === "string") {
			statusResponse[0] = JSON.parse(statusResponse[0]);
		}
		var oem = langResponse[0].current_lang_type;
		var isSplitBrain = haResponse[0].result.is_split_brain;
		var isInitPage = /init\.html$/.test(location.pathname);
		var isPersonalLoginPage = location.pathname === '/personal_login/';
		var isControlNode = statusResponse[0].is_control_node;
		var isSplitBrainPage = /split\.html$/.test(location.pathname);
		if (isSplitBrainPage) {
			if (!isSplitBrain) {
				location.replace("/");
			} else {
				start();
			}
		} else {
			if (isSplitBrain) {
				// $$$storage.clearSessionStorage();
				$$$storage.setSessionStorage('splitIP', haResponse[0].result.roles[0].ip);
				location.replace("split.html");
			} else {
				if (isControlNode) {
					if (isInitPage || isPersonalLoginPage) {
						start();
					} else {
						start(oem);
						initCurrentUser();
					}
				} else {
					if (isInitPage || isPersonalLoginPage) {
						start();
					} else {
						location.replace("init.html");
					}
				}
			}
		}
	});
}

function start(oem) {
	// 初始化页面默认没有语言
	if (!oem) {
		// NOTE: 版本是和语言相关的
		// 如果支持多个版本，优先使用系统默认语言
		if (Object.keys(supportedOems).length > 1) {
			// 仅仅我们自己的版本支持多语言
			// 参考：https://developer.mozilla.org/en-US/docs/Web/API/NavigatorLanguage/language
			// 调试时，使用这段代码将浏览器设置为其它语言
			//   navigator.__defineGetter__("language", function(){ return "en-us" })
			var lang = navigator.language;
			if (lang) {
				lang = lang.split("-")[0].toLowerCase();
			}
			if (lang === "zh") {
				oem = "e-vdi";
			} else if (lang === "en") {
				oem = "classEn";
			}
			if (!supportedOems[oem]) {
				oem = firstKey;
			}
		} else {
			oem = firstKey; // 否则的话使用仅支持的版本
		}
	}
	loadOEMResources(oem, supportedOems);
}

function getSupportedOEMs() {
	var list = __webpack_require__(2).resources;
	var ret = {};
	list.forEach(function (item) {
		ret[item.key] = item;
		// 不知道旧代码为什么要这么做
		item.langCode = item.key;
		item.flagCode = item.key;
		item.language = item.name;
		item.translation = item.title;
	});
	firstKey = list[0].key;
	return ret;
}

function initCurrentUser() {
	var userId = $$$storage.getSessionStorage('userId');
	if (!userId) {
		return;
	}
	$.ajax({
		method: "POST",
		url: domain + "/thor/user/session",
		data: JSON.stringify({
			user_id: userId
		}),
		dataType: 'json'
	}).done(function (res) {
		if (res.code === 0) {
			// res.user.keys = "Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About";
			var oldInfo = JSON.parse($$$storage.getSessionStorage("loginInfo")) || {};
			Object.keys(res.user).forEach(function (key) {
				oldInfo[key] = res.user[key];
			});
			$$$storage.setSessionStorage('loginInfo', JSON.stringify(oldInfo));
			$$$storage.setSessionStorage('power', res.user.keys);
		}
	});
}

function registerLazyService() {
	ng.constant("$$$version", i18nData["GOD_VERSION"] || "dev");
}

/***/ }),
/* 1 */
/***/ (function(module, exports) {

module.exports = [{"key":"other","icon":"other.png","value":"Other"},{"key":"ArchLinux","icon":"linux.png","value":"Arch Linux"},{"key":"ArchLinux_64","icon":"linux.png","value":"Arch Linux (64 bit)"},{"key":"Debian","icon":"debian.png","value":"Debian"},{"key":"Debian_64","icon":"debian.png","value":"Debian (64 bit)"},{"key":"Fedora","icon":"fedora.png","value":"Fedora"},{"key":"Fedora_64","icon":"fedora.png","value":"Fedora (64 bit)"},{"key":"FreeBSD","icon":"linux.png","value":"FreeBSD"},{"key":"FreeBSD_64","icon":"linux.png","value":"FreeBSD (64 bit)"},{"key":"Gentoo","icon":"linux.png","value":"Gentoo"},{"key":"Gentoo_64","icon":"linux.png","value":"Gentoo (64 bit)"},{"key":"Linux","icon":"linux.png","value":"Other Linux"},{"key":"MacOS","icon":"linux.png","value":"Mac OS X Server"},{"key":"MacOS_64","icon":"linux.png","value":"Mac OS X Server (64 bit)"},{"key":"OpenBSD","icon":"linux.png","value":"OpenBSD"},{"key":"OpenBSD_64","icon":"linux.png","value":"OpenBSD (64 bit)"},{"key":"OpenSUSE","icon":"linux.png","value":"openSUSE"},{"key":"OpenSUSE_64","icon":"linux.png","value":"openSUSE (64 bit)"},{"key":"OpenSolaris","icon":"linux.png","value":"Oracle Solaris 10 10/09 and later"},{"key":"OpenSolaris_64","icon":"linux.png","value":"Oracle Solaris 10 10/09 and later (64 bit)"},{"key":"Oracle","icon":"linux.png","value":"Oracle"},{"key":"Oracle_64","icon":"linux.png","value":"Oracle (64 bit)"},{"key":"Other","icon":"unknown.png","value":"Other/Unknown"},{"key":"RedHat","icon":"redhat.png","value":"Red Hat"},{"key":"RedHat_64","icon":"redhat.png","value":"Red Hat (64 bit)"},{"key":"Solaris","icon":"linux.png","value":"Oracle Solaris 10 5/09 and earlier"},{"key":"Solaris_64","icon":"linux.png","value":"Oracle Solaris 10 5/09 and earlier (64 bit)"},{"key":"Ubuntu","icon":"ubuntu.png","value":"Ubuntu"},{"key":"Ubuntu_64","icon":"ubuntu.png","value":"Ubuntu (64 bit)"},{"key":"Windows2000","icon":"win7.png","value":"Windows 2000"},{"key":"Windows2003","icon":"win2003.png","value":"Windows 2003"},{"key":"Windows2003_64","icon":"win2003.png","value":"Windows 2003 (64 bit)"},{"key":"Windows2008","icon":"win2008.png","value":"Windows 2008"},{"key":"Windows2008_64","icon":"win2008.png","value":"Windows 2008 (64 bit)"},{"key":"Windows7","icon":"win7.png","value":"Windows 7"},{"key":"Windows7_64","icon":"win7.png","value":"Windows 7 (64 bit)"},{"key":"Windows8","icon":"win8.png","value":"Windows 8"},{"key":"Windows8_64","icon":"win8.png","value":"Windows 8 (64 bit)"},{"key":"WindowsNT","icon":"win7.png","value":"Other Windows"},{"key":"WindowsNT4","icon":"win7.png","value":"Windows NT 4"},{"key":"WindowsVista","icon":"win7.png","value":"Windows Vista"},{"key":"WindowsVista_64","icon":"win7.png","value":"Windows Vista (64 bit)"},{"key":"Windowsxp","icon":"winxp.png","value":"Windows XP"},{"key":"Windowsxp_64","icon":"winxp.png","value":"Windows XP (64 bit)"},{"key":"WindowsXP","icon":"winxp.png","value":"Windows XP"},{"key":"WindowsXP_64","icon":"winxp.png","value":"Windows XP (64 bit)"},{"key":"Windows 7","icon":"win7.png","value":"Windows 7 series"},{"key":"Windows10","icon":"win8.png","value":"Windows 10"},{"key":"Windows10_64","icon":"win8.png","value":"Windows 10 (64 bit)"}]

/***/ }),
/* 2 */
/***/ (function(module, exports) {

module.exports = {"resource_template":{"key":"0","title":"dev"},"resources":[{"key":"e-vdi","name":"E-VDI","title":"E-VDI","langType":"cn","langDes":"中文","clientKey":"public","public":true},{"key":"pc","name":"云PC","title":"云PC","langType":"cn","langDes":"中文","clientKey":"public","public":true},{"key":"classCh","name":"云教室","title":"云教室中文","langType":"cn","langDes":"中文","clientKey":"public","public":true},{"key":"classEn","name":"Cloud Class","title":"云教室英文","langType":"en","langDes":"English","clientKey":"public","public":true}]}

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("app.controllers", []).controller("PageViewController", ["$scope", "$route", "$animate", function ($scope, $route, $animate) {
	// controler of the dynamically loaded views, for DEMO purposes only.
	// $scope.$on("$viewContentLoaded", function() {
	// 	console.log("ffffffff")
	// })
}]).controller("LangController", ["$scope", "settings", "localize", function ($scope, settings, localize) {
	$scope.languages = settings.languages;
	$scope.currentLang = settings.currentLang || $scope.languages[0];
	$scope.setLang = function (lang) {
		settings.currentLang = lang;
		$scope.currentLang = lang;
		localize.setLang(lang);
		$$$storage.setSessionStorage('lang_code', lang.langCode);
	};
	// set the default language
	$scope.setLang($scope.currentLang);
}]);

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module('app.main', [])
// initiate body
.directive('body', function () {
	return {
		restrict: 'E',
		link: function link(scope, element, attrs) {
			element.on('click', 'a[href="#"], [data-toggle]', function (e) {
				e.preventDefault();
			});
		}
	};
}).factory('ribbon', ['$rootScope', function ($rootScope) {
	var ribbon = {
		currentBreadcrumb: [],
		updateBreadcrumb: function updateBreadcrumb(crumbs) {
			var breadCrumb = crumbs.reverse();
			ribbon.currentBreadcrumb = breadCrumb;
			$rootScope.$broadcast('navItemSelected', breadCrumb);
		}
	};

	return ribbon;
}]).directive('action', function () {
	return {
		restrict: 'A',
		link: function link(scope, element, attrs) {
			/*
    * SMART ACTIONS
    */
			var smartActions = {

				// LOGOUT MSG 
				userLogout: function userLogout($this) {

					// ask verification
					$.SmartMessageBox({
						title: "<i class='fa fa-sign-out txt-color-orangeDark'></i> Logout <span class='txt-color-orangeDark'><strong>" + $('#show-shortcut').text() + "</strong></span> ?",
						content: $this.data('logout-msg') || "You can improve your security further after logging out by closing this opened browser",
						buttons: '[No][Yes]'

					}, function (ButtonPressed) {
						if (ButtonPressed == "Yes") {
							$.root_.addClass('animated fadeOutUp');
							setTimeout(logout, 1000);
						}
					});
					function logout() {
						window.location = $this.attr('href');
					}
				},

				// RESET WIDGETS
				resetWidgets: function resetWidgets($this) {
					$.widresetMSG = $this.data('reset-msg');

					$.SmartMessageBox({
						title: "<i class='fa fa-refresh' style='color:green'></i> Clear Local Storage",
						content: $.widresetMSG || "Would you like to RESET all your saved widgets and clear LocalStorage?",
						buttons: '[No][Yes]'
					}, function (ButtonPressed) {
						if (ButtonPressed == "Yes" && localStorage) {
							localStorage.clear();
							location.reload();
						}
					});
				},

				// LAUNCH FULLSCREEN 
				launchFullscreen: function launchFullscreen(element) {

					if (!$.root_.hasClass("full-screen")) {

						$.root_.addClass("full-screen");

						if (element.requestFullscreen) {
							element.requestFullscreen();
						} else if (element.mozRequestFullScreen) {
							element.mozRequestFullScreen();
						} else if (element.webkitRequestFullscreen) {
							element.webkitRequestFullscreen();
						} else if (element.msRequestFullscreen) {
							element.msRequestFullscreen();
						}
					} else {

						$.root_.removeClass("full-screen");

						if (document.exitFullscreen) {
							document.exitFullscreen();
						} else if (document.mozCancelFullScreen) {
							document.mozCancelFullScreen();
						} else if (document.webkitExitFullscreen) {
							document.webkitExitFullscreen();
						}
					}
				},

				// MINIFY MENU
				minifyMenu: function minifyMenu($this) {
					if (!$.root_.hasClass("menu-on-top")) {
						$.root_.toggleClass("minified");
						$.root_.removeClass("hidden-menu");
						$('html').removeClass("hidden-menu-mobile-lock");
						$this.effect("highlight", {}, 500);
					}
				},

				// TOGGLE MENU 
				toggleMenu: function toggleMenu() {
					if (!$.root_.hasClass("menu-on-top")) {
						$('html').toggleClass("hidden-menu-mobile-lock");
						$.root_.toggleClass("hidden-menu");
						$.root_.removeClass("minified");
					} else if ($.root_.hasClass("menu-on-top") && $.root_.hasClass("mobile-view-activated")) {
						$('html').toggleClass("hidden-menu-mobile-lock");
						$.root_.toggleClass("hidden-menu");
						$.root_.removeClass("minified");
					}
				},

				// TOGGLE SHORTCUT 
				toggleShortcut: function toggleShortcut() {

					if (shortcut_dropdown.is(":visible")) {
						shortcut_buttons_hide();
					} else {
						shortcut_buttons_show();
					}

					// SHORT CUT (buttons that appear when clicked on user name)
					shortcut_dropdown.find('a').click(function (e) {
						e.preventDefault();
						window.location = $(this).attr('href');
						setTimeout(shortcut_buttons_hide, 300);
					});

					// SHORTCUT buttons goes away if mouse is clicked outside of the area
					$(document).mouseup(function (e) {
						if (!shortcut_dropdown.is(e.target) && shortcut_dropdown.has(e.target).length === 0) {
							shortcut_buttons_hide();
						}
					});

					// SHORTCUT ANIMATE HIDE
					function shortcut_buttons_hide() {
						shortcut_dropdown.animate({
							height: "hide"
						}, 300, "easeOutCirc");
						$.root_.removeClass('shortcut-on');
					}

					// SHORTCUT ANIMATE SHOW
					function shortcut_buttons_show() {
						shortcut_dropdown.animate({
							height: "show"
						}, 200, "easeOutCirc");
						$.root_.addClass('shortcut-on');
					}
				}

			};

			var actionEvents = {
				userLogout: function userLogout(e) {
					smartActions.userLogout(element);
				},
				resetWidgets: function resetWidgets(e) {
					smartActions.resetWidgets(element);
				},
				launchFullscreen: function launchFullscreen(e) {
					smartActions.launchFullscreen(document.documentElement);
				},
				minifyMenu: function minifyMenu(e) {
					smartActions.minifyMenu(element);
				},
				toggleMenu: function toggleMenu(e) {
					smartActions.toggleMenu();
				},
				toggleShortcut: function toggleShortcut(e) {
					smartActions.toggleShortcut();
				}
			};

			if (angular.isDefined(attrs.action) && attrs.action != '') {
				var actionEvent = actionEvents[attrs.action];
				if (typeof actionEvent === 'function') {
					element.on('click', function (e) {
						actionEvent(e);
						e.preventDefault();
					});
				}
			}
		}
	};
}).directive('header', function () {
	return {
		restrict: 'EA',
		link: function link(scope, element, attrs) {
			// SHOW & HIDE MOBILE SEARCH FIELD
			angular.element('#search-mobile').click(function () {
				$.root_.addClass('search-mobile');
			});

			angular.element('#cancel-search-js').click(function () {
				$.root_.removeClass('search-mobile');
			});
		}
	};
}).directive('ribbon', function () {
	return {
		restrict: 'A',
		link: function link(scope, element, attrs) {
			return;
			element.append('<div class="demo"><span id="demo-setting"><i class="fa fa-cog txt-color-blueDark"></i></span> <form><legend class="no-padding margin-bottom-10">Layout Options</legend><section><label><input name="subscription" id="smart-fixed-header" type="checkbox" class="checkbox style-0"><span>Fixed Header</span></label><label><input type="checkbox" name="terms" id="smart-fixed-navigation" class="checkbox style-0"><span>Fixed Navigation</span></label><label><input type="checkbox" name="terms" id="smart-fixed-ribbon" class="checkbox style-0"><span>Fixed Ribbon</span></label><label><input type="checkbox" name="terms" id="smart-fixed-footer" class="checkbox style-0"><span>Fixed Footer</span></label><label><input type="checkbox" name="terms" id="smart-fixed-container" class="checkbox style-0"><span>Inside <b>.container</b> <div class="font-xs text-right">(non-responsive)</div></span></label><label style="display:block;"><input type="checkbox" id="smart-topmenu" class="checkbox style-0"><span>Menu on <b>top</b></span></label> <span id="smart-bgimages"></span></section><section><h6 class="margin-top-10 semi-bold margin-bottom-5">Clear Localstorage</h6><a href="javascript:void(0);" class="btn btn-xs btn-block btn-primary" id="reset-smart-widget"><i class="fa fa-refresh"></i> Factory Reset</a></section> <h6 class="margin-top-10 semi-bold margin-bottom-5">SmartAdmin Skins</h6><section id="smart-styles"><a href="javascript:void(0);" id="smart-style-0" data-skinlogo="img/logo.png" class="btn btn-block btn-xs txt-color-white margin-right-5" style="background-color:#4E463F;"><i class="fa fa-check fa-fw" id="skin-checked"></i>Smart Default</a><a href="javascript:void(0);" id="smart-style-1" data-skinlogo="img/logo-white.png" class="btn btn-block btn-xs txt-color-white" style="background:#3A4558;">Dark Elegance</a><a href="javascript:void(0);" id="smart-style-2" data-skinlogo="img/logo-blue.png" class="btn btn-xs btn-block txt-color-darken margin-top-5" style="background:#fff;">Ultra Light</a><a href="javascript:void(0);" id="smart-style-3" data-skinlogo="img/logo-pale.png" class="btn btn-xs btn-block txt-color-white margin-top-5" style="background:#f78c40">Google Skin</a></section></form> </div>');

			// hide bg options
			var smartbgimage = "<h6 class='margin-top-10 semi-bold'>Background</h6><img src='img/pattern/graphy-xs.png' data-htmlbg-url='img/pattern/graphy.png' width='22' height='22' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/tileable_wood_texture-xs.png' width='22' height='22' data-htmlbg-url='img/pattern/tileable_wood_texture.png' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/sneaker_mesh_fabric-xs.png' width='22' height='22' data-htmlbg-url='img/pattern/sneaker_mesh_fabric.png' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/nistri-xs.png' data-htmlbg-url='img/pattern/nistri.png' width='22' height='22' class='margin-right-5 bordered cursor-pointer'><img src='img/pattern/paper-xs.png' data-htmlbg-url='img/pattern/paper.png' width='22' height='22' class='bordered cursor-pointer'>";
			$("#smart-bgimages").fadeOut();

			$('#demo-setting').click(function () {
				$('#ribbon .demo').toggleClass('activate');
			});
			/*
    * FIXED HEADER
    */
			$('input[type="checkbox"]#smart-fixed-header').click(function () {
				if ($(this).is(':checked')) {
					//checked
					$.root_.addClass("fixed-header");
				} else {
					//unchecked
					$('input[type="checkbox"]#smart-fixed-ribbon').prop('checked', false);
					$('input[type="checkbox"]#smart-fixed-navigation').prop('checked', false);

					$.root_.removeClass("fixed-header");
					$.root_.removeClass("fixed-navigation");
					$.root_.removeClass("fixed-ribbon");
				}
			});

			/*
    * FIXED NAV
    */
			$('input[type="checkbox"]#smart-fixed-navigation').click(function () {
				if ($(this).is(':checked')) {
					//checked
					$('input[type="checkbox"]#smart-fixed-header').prop('checked', true);

					$.root_.addClass("fixed-header");
					$.root_.addClass("fixed-navigation");

					$('input[type="checkbox"]#smart-fixed-container').prop('checked', false);
					$.root_.removeClass("container");
				} else {
					//unchecked
					$('input[type="checkbox"]#smart-fixed-ribbon').prop('checked', false);
					$.root_.removeClass("fixed-navigation");
					$.root_.removeClass("fixed-ribbon");
				}
			});

			/*
    * FIXED RIBBON
    */
			$('input[type="checkbox"]#smart-fixed-ribbon').click(function () {
				if ($(this).is(':checked')) {

					//checked
					$('input[type="checkbox"]#smart-fixed-header').prop('checked', true);
					$('input[type="checkbox"]#smart-fixed-navigation').prop('checked', true);
					$('input[type="checkbox"]#smart-fixed-ribbon').prop('checked', true);

					//apply
					$.root_.addClass("fixed-header");
					$.root_.addClass("fixed-navigation");
					$.root_.addClass("fixed-ribbon");

					$('input[type="checkbox"]#smart-fixed-container').prop('checked', false);
					$.root_.removeClass("container");
				} else {
					//unchecked
					$.root_.removeClass("fixed-ribbon");
				}
			});

			/*
    * RTL SUPPORT
    */
			$('input[type="checkbox"]#smart-fixed-footer').click(function () {
				if ($(this).is(':checked')) {

					//checked
					$.root_.addClass("fixed-page-footer");
				} else {
					//unchecked
					$.root_.removeClass("fixed-page-footer");
				}
			});

			/*
    * RTL SUPPORT
    */
			$('input[type="checkbox"]#smart-rtl').click(function () {
				if ($(this).is(':checked')) {

					//checked
					$.root_.addClass("smart-rtl");
				} else {
					//unchecked
					$.root_.removeClass("smart-rtl");
				}
			});

			/*
    * MENU ON TOP
    */

			$('#smart-topmenu').on('change', function (e) {
				if ($(this).prop('checked')) {
					//window.location.href = '?menu=top';
					localStorage.setItem('sm-setmenu', 'top');
					location.reload();
				} else {
					//window.location.href = '?';
					localStorage.setItem('sm-setmenu', 'left');
					location.reload();
				}
			});

			if (localStorage.getItem('sm-setmenu') == 'top') {
				$('#smart-topmenu').prop('checked', true);
			} else {
				$('#smart-topmenu').prop('checked', false);
			}

			/*
    * INSIDE CONTAINER
    */
			$('input[type="checkbox"]#smart-fixed-container').click(function () {
				if ($(this).is(':checked')) {
					//checked
					$.root_.addClass("container");

					$('input[type="checkbox"]#smart-fixed-ribbon').prop('checked', false);
					$.root_.removeClass("fixed-ribbon");

					$('input[type="checkbox"]#smart-fixed-navigation').prop('checked', false);
					$.root_.removeClass("fixed-navigation");

					if (smartbgimage) {
						$("#smart-bgimages").append(smartbgimage).fadeIn(1000);
						$("#smart-bgimages img").bind("click", function () {
							var $this = $(this);
							var $html = $('html');
							bgurl = $this.data("htmlbg-url");
							$html.css("background-image", "url(" + bgurl + ")");
						});
						smartbgimage = null;
					} else {
						$("#smart-bgimages").fadeIn(1000);
					}
				} else {
					//unchecked
					$.root_.removeClass("container");
					$("#smart-bgimages").fadeOut();
				}
			});

			/*
    * REFRESH WIDGET
    */
			$("#reset-smart-widget").bind("click", function () {
				$('#refresh').click();
				return false;
			});

			/*
    * STYLES
    */
			$("#smart-styles > a").on('click', function () {
				var $this = $(this);
				var $logo = $("#logo img");
				$.root_.removeClassPrefix('smart-style').addClass($this.attr("id"));
				$logo.attr('src', $this.data("skinlogo"));
				$("#smart-styles > a #skin-checked").remove();
				$this.prepend("<i class='fa fa-check fa-fw' id='skin-checked'></i>");
			});
		}
	};
}).controller('breadcrumbController', ['$scope', function ($scope) {
	$scope.breadcrumbs = [];
	$scope.$on('navItemSelected', function (name, crumbs) {
		$scope.setBreadcrumb(crumbs);
	});

	$scope.setBreadcrumb = function (crumbs) {
		$scope.breadcrumbs = crumbs;
	};
}]).directive('breadcrumb', ['ribbon', 'localize', '$compile', function (ribbon, localize, $compile) {
	return {
		restrict: 'AE',
		controller: 'breadcrumbController',
		replace: true,
		link: function link(scope, element, attrs) {
			scope.$watch('breadcrumbs', function (newVal, oldVal) {
				if (newVal !== oldVal || !element.text()) {
					// update DOM
					scope.updateDOM();
				}
			});
			scope.updateDOM = function () {
				element.empty();
				angular.forEach(scope.breadcrumbs, function (crumb) {
					var li = angular.element('<li data-localize="' + crumb + '">' + crumb + '</li>');
					li.text(localize.localizeText(crumb));

					$compile(li)(scope);
					element.append(li);
				});
			};

			// set the current breadcrumb on load
			scope.setBreadcrumb(ribbon.currentBreadcrumb);
			scope.updateDOM();
		},
		template: '<ol class="breadcrumb"></ol>'
	};
}]);

// directives for localization
angular.module('app.localize', []).factory('localize', ['$http', '$rootScope', '$window', "settings", "$RESOURCE", function ($http, $rootScope, $window, settings, $RESOURCE) {
	// shared variables for `translate`
	var encodeHTML = function encodeHTML(txt) {
		return txt.replace(/</g, "&lt;").replace(/>/g, "&gt;");
	};
	var tmplReg = /\{\{([^\}]+)\}\}/g;
	var interestAttrReg = /^param\d+$/;
	// internal flag
	var ready = false;
	// factory
	var localize = {
		currentLocaleData: {},
		currentLang: {},
		setLang: function setLang(lang) {
			if (!lang) {
				lang = settings.languages[0];
			}
			$RESOURCE.load(lang.key, function (data) {
				localize.currentLocaleData = data.lang;
				localize.currentLang = lang;
				ready = true;
				$rootScope.$broadcast('localizeLanguageChanged');
			});
		},
		getLangUrl: function getLangUrl(lang) {
			return "resources/pkg/" + lang.langCode + "/lang.js";
		},

		localizeText: function localizeText(sourceText) {
			return localize.currentLocaleData[sourceText];
		},
		translate: function translate(scope, element, attrs, transkey) {
			var onAttrChange = function onAttrChange(e) {
				if (!ready) {
					return;
				}
				var tmpl = localize.localizeText(attrs[transkey]);
				// 无效的翻译
				if (!tmpl) {
					// debug
					// return console.error("invalid " + transkey + "=\"" + attrs[transkey] + "\"");
					return;
				}
				var myhtml = tmplReg.test(tmpl) ? tmpl.replace(tmplReg, function (match, index) {
					var myattr = "param" + index;
					var value = attrs[myattr];
					return encodeHTML(value);
				}) : tmpl;
				switch (transkey) {
					case "localize":
						if (element.is("input, textarea")) {
							element.attr("placeholder", myhtml);
						} else {
							element.html(myhtml);
						}
						break;
					case "localizeHref":
						element.attr("href", myhtml);break;
					case "localizeTitle":
						element.attr("title", myhtml);break;
					case "localizePlaceholder":
						element.attr("placeholder", myhtml);break;
				}
			};
			angular.forEach(attrs, function (v, k) {
				if (interestAttrReg.test(k)) {
					attrs.$observe(k, onAttrChange);
				}
			});
			if (ready) {
				onAttrChange();
			}
			scope.$on("localizeLanguageChanged", onAttrChange);
		},
		isReady: function isReady() {
			return ready;
		}
	};

	return localize;
}]).directive('localize', ['localize', function (localize) {
	return {
		restrict: "A",
		link: function link(scope, element, attrs) {
			localize.translate(scope, element, attrs, "localize");
		}
	};
}]).directive("localizeTitle", ["localize", function (localize) {
	return {
		restrict: "A",
		link: function link(scope, element, attrs) {
			localize.translate(scope, element, attrs, "localizeTitle");
		}
	};
}]).directive("localizePlaceholder", ["localize", function (localize) {
	return {
		restrict: "A",
		link: function link(scope, element, attrs) {
			localize.translate(scope, element, attrs, "localizePlaceholder");
		}
	};
}]).directive("localizeHref", ["localize", function (localize) {
	return {
		restrict: "A",
		link: function link(scope, element, attrs) {
			localize.translate(scope, element, attrs, "localizeHref");
		}
	};
}]);

// directives for navigation
angular.module('app.navigation', []).directive('navigation', ["$timeout", function ($timeout) {
	return {
		restrict: 'AE',
		controller: ['$scope', function ($scope) {
			//$scope.version = $$$version;
		}],
		transclude: true,
		replace: true,
		link: function link(scope, element, attrs) {
			var timer = null;
			var timer_handle = function timer_handle() {
				if (!topmenu) {
					if (!null) {
						element.first().jarvismenu({
							accordion: true,
							speed: $.menu_speed,
							closedSign: '<em class="fa icon-jj-xiala"></em>',
							openedSign: '<em class="fa icon-jj-sou"></em>'
						});
					} else {
						//alert("Error - menu anchor does not exist");
						$.bigBox({
							title: "Error",
							content: "menu anchor does not exist",
							color: "#C46A69",
							icon: "fa fa-warning shake animated",
							number: "1",
							timeout: 6000
						});
					}
				}

				// SLIMSCROLL FOR NAV
				if ($.fn.slimScroll) {
					element.slimScroll({
						height: '100%'
					});
				}

				scope.getElement = function () {
					return element;
				};
			};
			scope.$on("updateNavData", function (name, navs) {
				scope.navs = navs;
			});
			scope.$on("renderNavItem", function (name) {
				$timeout.cancel(timer);
				timer = $timeout(timer_handle, 100);
			});
		},
		template: "<nav><ul data-ng-transclude></ul></nav>"
	};
}]).controller('NavItemController', ['$rootScope', '$scope', '$location', function ($rootScope, $scope, $location) {
	$scope.isChild = false;
	$scope.active = false;
	$scope.isActive = function (viewLocation) {
		$scope.active = viewLocation === $location.path();
		return $scope.active;
	};
	$scope.hasIcon = angular.isDefined($scope.icon);
	$scope.hasIconCaption = angular.isDefined($scope.iconCaption);

	$scope.getItemUrl = function (view) {
		if (angular.isDefined($scope.href)) return $scope.href;
		if (!angular.isDefined(view)) return '';
		return '#' + view;
	};

	$scope.getItemTarget = function () {
		return angular.isDefined($scope.target) ? $scope.target : '_self';
	};
	$scope.$emit("renderNavItem");
}]).directive('navItem', ['ribbon', "$rootScope", function (ribbon, $root) {
	return {
		require: ['^navigation'],
		restrict: 'AE',
		controller: 'NavItemController',
		scope: {
			title: '@navTitle',
			view: '@',
			icon: '@',
			iconCaption: '@',
			href: '@',
			target: '@'
		},
		link: function link(scope, element, attrs, parentCtrls) {
			var navCtrl = parentCtrls[0],
			    navgroupCtrl = parentCtrls[1];
			if (attrs.view) {
				element.find("ul").remove();
			}
			scope.$watch('active', function (newVal, oldVal) {
				if (newVal) {
					navgroupCtrl && navgroupCtrl.setActive(true);
					$root.$broadcast("updateDocumentTitle", scope.title);
					scope.setBreadcrumb();
				} else {
					navgroupCtrl && navgroupCtrl.setActive(false);
				}
			});

			scope.openParents = scope.isActive(scope.view);
			scope.isChild = angular.isDefined(navgroupCtrl);

			scope.setBreadcrumb = function () {
				var crumbs = [];
				crumbs.push(scope.title);
				// get parent menus
				var test = element.parents('nav li').each(function () {
					var el = angular.element(this);
					var parent = el.find('.menu-item-parent:eq(0)');
					crumbs.push(parent.data('localize').trim());
					if (scope.openParents) {
						// open menu on first load
						parent.trigger('click');
					}
				});
				// this should be only fired upon first load so let's set this to false now
				scope.openParents = false;
				ribbon.updateBreadcrumb(crumbs);
			};

			element.on('click', 'a[href!="#"]', function () {
				if ($.root_.hasClass('mobile-view-activated')) {
					$.root_.removeClass('hidden-menu');
					$('html').removeClass("hidden-menu-mobile-lock");
				}
			});
		},
		transclude: true,
		replace: true,
		template: '\n\t\t\t<li data-ng-class="{active: isActive(view)}">\n\t\t\t\t<a href="{{ getItemUrl(view) }}" target="{{ getItemTarget() }}">\n\t\t\t\t\t<i data-ng-if="hasIcon" class="{{ icon }}"><em data-ng-if="hasIconCaption"> {{ iconCaption }} </em></i>\n\t\t\t\t\t<span ng-class="{\'menu-item-parent\': !isChild}" data-localize="{{ title }}"></span>\n\t\t\t\t</a>\n\t\t\t\t<ul data-ng-transclude=""></ul>\n\t\t\t</li>'
	};
}]);

// directives for activity
angular.module('app.activity', []).controller('ActivityController', ['$scope', '$http', function ($scope, $http) {
	var ctrl = this,
	    items = ctrl.items = $scope.items = [];

	ctrl.loadItem = function (loadedItem, callback) {
		angular.forEach(items, function (item) {
			if (item.active && item !== loadedItem) {
				item.active = false;
				//item.onDeselect();
			}
		});

		loadedItem.active = true;
		if (angular.isDefined(loadedItem.onLoad)) {
			loadedItem.onLoad(loadedItem);
		}

		$http.get(loadedItem.src).then(function (result) {
			var content = result.data;
			if (angular.isDefined(callback)) {
				callback(content);
			}
		});
	};

	ctrl.addItem = function (item) {
		items.push(item);
		if (!angular.isDefined(item.active)) {
			// set the default
			item.active = false;
		} else if (item.active) {
			ctrl.loadItem(item);
		}
	};

	ctrl.refresh = function (e) {
		var btn = angular.element(e.currentTarget);
		btn.button('loading');

		if (angular.isDefined($scope.onRefresh)) {
			$scope.onRefresh($scope, function () {
				btn.button('reset');
			});
		} else {
			btn.button('reset');
		}
	};
}]).directive('activity', function () {
	return {
		restrict: 'AE',
		replace: true,
		transclude: true,
		controller: 'ActivityController',
		scope: {
			onRefresh: '=onrefresh'
		},
		template: '<span data-ng-transclude=""></span>'
	};
}).directive('activityButton', function () {
	return {
		restrict: 'AE',
		require: '^activity',
		replace: true,
		transclude: true,
		controller: function controller($scope) {},
		scope: {
			icon: '@',
			total: '='
		},
		template: '\
				<span id="activity" class="activity-dropdown">\
					<i ng-class="icon"></i>\
					<b class="badge"> {{ total }} </b>\
				</span>',
		link: function link(scope, element, attrs, activityCtrl) {

			attrs.$observe('icon', function (value) {
				if (!angular.isDefined(value)) scope.icon = 'fa fa-user';
			});

			element.on('click', function (e) {
				var $this = $(this);

				if ($this.find('.badge').hasClass('bg-color-red')) {
					$this.find('.badge').removeClassPrefix('bg-color-');
					$this.find('.badge').text("0");
					// console.log("Ajax call for activity")
				}

				if (!$this.next('.ajax-dropdown').is(':visible')) {
					$this.next('.ajax-dropdown').fadeIn(150);
					$this.addClass('active');
				} else {
					$this.next('.ajax-dropdown').fadeOut(150);
					$this.removeClass('active');
				}

				var mytest = $this.next('.ajax-dropdown').find('.btn-group > .active > input').attr('id');

				e.preventDefault();
			});

			if (scope.total > 0) {
				var $badge = element.find('.badge');
				$badge.addClass("bg-color-red bounceIn animated");
			}
		}
	};
}).controller('ActivityContentController', ['$scope', function ($scope) {
	var ctrl = this;
	$scope.currentContent = '';
	ctrl.loadContent = function (content) {
		$scope.currentContent = content;
	};
}]).directive('activityContent', ['$compile', function ($compile) {
	return {
		restrict: 'AE',
		transclude: true,
		require: '^activity',
		replace: true,
		scope: {
			footer: '=?'
		},
		controller: 'ActivityContentController',
		template: '\
			<div class="ajax-dropdown">\
				<div class="btn-group btn-group-justified" data-toggle="buttons" data-ng-transclude=""></div>\
				<div class="ajax-notifications custom-scroll">\
					<div class="alert alert-transparent">\
						<h4>Click a button to show messages here</h4>\
						This blank page message helps protect your privacy, or you can show the first message here automatically.\
					</div>\
					<i class="fa fa-lock fa-4x fa-border"></i>\
				</div>\
				<span> {{ footer }}\
					<button type="button" data-loading-text="Loading..." data-ng-click="refresh($event)" class="btn btn-xs btn-default pull-right" data-activty-refresh-button="">\
					<i class="fa fa-refresh"></i>\
					</button>\
				</span>\
			</div>',
		link: function link(scope, element, attrs, activityCtrl) {
			scope.refresh = function (e) {
				activityCtrl.refresh(e);
			};

			scope.$watch('currentContent', function (newContent, oldContent) {
				if (newContent !== oldContent) {
					var el = element.find('.ajax-notifications').html(newContent);
					$compile(el)(scope);
				}
			});
		}
	};
}]).directive('activityItem', function () {
	return {
		restrict: 'AE',
		require: ['^activity', '^activityContent'],
		scope: {
			src: '=',
			onLoad: '=onload',
			active: '=?'
		},
		controller: function controller() {},
		transclude: true,
		replace: true,
		template: '\
			<label class="btn btn-default" data-ng-click="loadItem()" ng-class="{active: active}">\
				<input type="radio" name="activity">\
				<span data-ng-transclude=""></span>\
			</label>',
		link: function link(scope, element, attrs, parentCtrls) {
			var activityCtrl = parentCtrls[0],
			    contentCtrl = parentCtrls[1];

			scope.$watch('active', function (active) {
				if (active) {
					activityCtrl.loadItem(scope, function (content) {
						contentCtrl.loadContent(content);
					});
				}
			});
			activityCtrl.addItem(scope);

			scope.loadItem = function () {
				scope.active = true;
			};
		}
	};
});

angular.module('app.smartui', []).directive('widgetGrid', function () {
	return {
		restrict: 'AE',
		link: function link(scope, element, attrs) {
			scope.setup_widget_desktop = function () {
				if ($.fn.jarvisWidgets && $.enableJarvisWidgets) {
					element.jarvisWidgets({
						grid: 'article',
						widgets: '.jarviswidget',
						localStorage: true,
						deleteSettingsKey: '#deletesettingskey-options',
						settingsKeyLabel: 'Reset settings?',
						deletePositionKey: '#deletepositionkey-options',
						positionKeyLabel: 'Reset position?',
						sortable: true,
						buttonsHidden: false,
						// toggle button
						toggleButton: true,
						toggleClass: 'fa fa-minus | fa fa-plus',
						toggleSpeed: 200,
						onToggle: function onToggle() {},
						// delete btn
						deleteButton: true,
						deleteClass: 'fa fa-times',
						deleteSpeed: 200,
						onDelete: function onDelete() {},
						// edit btn
						editButton: true,
						editPlaceholder: '.jarviswidget-editbox',
						editClass: 'fa fa-cog | fa fa-save',
						editSpeed: 200,
						onEdit: function onEdit() {},
						// color button
						colorButton: true,
						// full screen
						fullscreenButton: true,
						fullscreenClass: 'fa fa-expand | fa fa-compress',
						fullscreenDiff: 3,
						onFullscreen: function onFullscreen() {},
						// custom btn
						customButton: false,
						customClass: 'folder-10 | next-10',
						customStart: function customStart() {
							alert('Hello you, this is a custom button...');
						},
						customEnd: function customEnd() {
							alert('bye, till next time...');
						},
						// order
						buttonOrder: '%refresh% %custom% %edit% %toggle% %fullscreen% %delete%',
						opacity: 1.0,
						dragHandle: '> header',
						placeholderClass: 'jarviswidget-placeholder',
						indicator: true,
						indicatorTime: 600,
						ajax: true,
						timestampPlaceholder: '.jarviswidget-timestamp',
						timestampFormat: 'Last update: %m%/%d%/%y% %h%:%i%:%s%',
						refreshButton: true,
						refreshButtonClass: 'fa fa-refresh',
						labelError: 'Sorry but there was a error:',
						labelUpdated: 'Last Update:',
						labelRefresh: 'Refresh',
						labelDelete: 'Delete widget:',
						afterLoad: function afterLoad() {},
						rtl: false, // best not to toggle this!
						onChange: function onChange() {},
						onSave: function onSave() {},
						ajaxnav: $.navAsAjax // declears how the localstorage should be saved (HTML or AJAX page)

					});
				}
			};

			scope.setup_widget_mobile = function () {
				if ($.enableMobileWidgets && $.enableJarvisWidgets) {
					scope.setup_widgets_desktop();
				}
			};

			if ($.device === "desktop") {
				scope.setup_widget_desktop();
			} else {
				scope.setup_widget_mobile();
			}
		}
	};
}).directive('widget', function () {
	return {
		restrict: 'AE',
		transclude: true,
		replace: true,
		template: '<div class="jarviswidget" data-ng-transclude=""></div>'
	};
}).directive('widgetHeader', function () {
	return {
		restrict: 'AE',
		transclude: true,
		replace: true,
		scope: {
			title: '@',
			icon: '@'
		},
		template: '\
			<header>\
				<span class="widget-icon"> <i data-ng-class="icon"></i> </span>\
				<h2>{{ title }}</h2>\
				<span data-ng-transclude></span>\
			</header>'
	};
}).directive('widgetToolbar', function () {
	return {
		restrict: 'AE',
		transclude: true,
		replace: true,
		template: '<div class="widget-toolbar" data-ng-transclude=""></div>'
	};
}).directive('widgetEditbox', function () {
	return {
		restrict: 'AE',
		transclude: true,
		replace: true,
		template: '<div class="jarviswidget-editbox" data-ng-transclude=""></div>'
	};
}).directive('widgetBody', function () {
	return {
		restrict: 'AE',
		transclude: true,
		replace: true,
		template: '<div data-ng-transclude=""></div>'
	};
}).directive('widgetBodyToolbar', function () {
	return {
		restrict: 'AE',
		transclude: true,
		replace: true,
		scope: {
			class: '@'
		},
		template: '<div class="widget-body-toolbar" data-ng-transclude=""></div>'
	};
}).directive('widgetContent', function () {
	return {
		restrict: 'AE',
		transclude: true,
		replace: true,
		template: '<div class="widget-body" data-ng-transclude=""></div>'
	};
}).directive("base64", ["$$$IMAGES", function ($$$IMAGES) {
	return {
		restrict: "AE",
		link: function link(scope, element, attrs) {
			element.attr("src", $$$IMAGES.get(attrs.key));
			scope.$on("localizeLanguageChanged", function () {
				element.attr("src", $$$IMAGES.get(attrs.key));
			});
		}
	};
}]).directive('textareaEmail', [function () {
	return {
		require: 'ngModel',
		restrict: 'A',
		link: function link($scope, iElm, iAttrs, controller) {
			var modelCtrl = controller;
			function validate(val) {
				var vals = Array.isArray(val) ? val : [val];
				var reg = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;
				var isvalide = vals.every(function (v) {
					return reg.test(v);
				});
				return isvalide;
			}
			function parser(value) {
				if (value) {
					return value.split('\n').reduce(function (arr, b) {
						if (b.trim().length) {
							arr.push(b);
						}
						return arr;
					}, []);
				} else {
					return [];
				}
			}
			function formatter(value) {
				return validate(value) ? value.join("\n") : undefined;
			}
			function viewChangeListener() {
				modelCtrl.$setValidity('email', validate(modelCtrl.$modelValue));
			}
			modelCtrl.$isEmpty = function (val) {
				if (Array.isArray(val) && val.length === 0) {
					return true;
				}
				if (!val) {
					return true;
				}
			};
			modelCtrl.$parsers.push(parser);
			modelCtrl.$formatters.push(formatter);
			modelCtrl.$viewChangeListeners.push(viewChangeListener);
		}
	};
}]).directive('schedulerInput', ['$rootScope', function ($rootScope) {
	return {
		require: "ngModel",
		link: function link(scope, element, attrs, ngModel) {
			$rootScope.$broadcast('matchInput', true);
			element.bind('keyup', function (value) {
				// var isValid = this.value.match(/^[0-9]{4}-(((0[13578]|(10|12))-(0[1-9]|[1-2][0-9]|3[0-1]))|(02-(0[1-9]|[1-2][0-9]))|((0[469]|11)-(0[1-9]|[1-2][0-9]|30)))$/);
				var isValid = this.value.match(/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/);
				$rootScope.$broadcast('matchInput', isValid);
			});
		}
	};
}]).service("formDate", [function () {
	this.format = function (date, fmt) {
		var o = {
			"M+": date.getMonth() + 1, //月份   
			"d+": date.getDate(), //日   
			"h+": date.getHours(), //小时   
			"m+": date.getMinutes(), //分   
			"s+": date.getSeconds(), //秒   
			"q+": Math.floor((date.getMonth() + 3) / 3), //季度   
			"S": date.getMilliseconds() //毫秒   
		};
		if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
		for (var k in o) {
			if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
		}return fmt;
	};
}]).service("customModal", ["$modal", "$rootScope", function ($modal, $root) {
	this.openModal = function (obj) {
		/**
   * [init 模态框配置]
   */
		var init = {
			title: obj.title, // 标题，必传
			delTips: obj.delTips, // 删除提示，必传
			key: obj.key ? obj.key : '', // 删除标志，一个页面可能有多个删除，可不传
			delete_rows: obj.delete_rows ? obj.delete_rows : [], // 可删除的数据，可不传，如清空操作
			delParm: obj.delParm ? obj.delParm : '', // 删除数据的名字key，可不传
			nodelete_rows: obj.nodelete_rows ? obj.nodelete_rows : [], // 不可删除的数据，可不传
			nodelTips: obj.nodelTips ? obj.nodelTips : "" // 不可删除提示，可不传
		};

		$modal.open({
			template: ["<section id='widget-grid' ><div class='modal-content'>", "<div class='modal-header'><a type='button' class='close' data-ng-click='close()'>", "<span aria-hidden='true'>×</span><span class='sr-only'>", "Close</span></a><h4 class='modal-title' id='mySmallModalLabel' data-localize=" + init.title + "></h4></div><div class='modal-body'>", "<form class='form-horizontal'>", "<p style='margin-bottom:20px;' data-localize='" + init.delTips + "' param1='{{deleteName}}'></p>", "<p style='margin-bottom:20px;' data-ng-if='" + init.nodelete_rows.length + "' data-localize='" + init.nodelTips + "' param1='{{nodeleteName}}'></p>", "<footer class='text-right'><a class='btn btn-primary' data-ng-click='ok()'  data-localize='确定'>确定", "</a><a class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'>取消", "</a></footer></form></div></div></section>"].join(''),
			controller: function controller($scope, $modalInstance) {
				$scope.deleteName = init.delete_rows.map(function (row) {
					return row[init.delParm];
				}).join(', ');
				$scope.nodeleteName = init.nodelete_rows.map(function (row) {
					return row[init.delParm];
				}).join(', ');
				$scope.ok = function () {
					$root.$broadcast("DELETE", init.key === '' ? init.delete_rows : { key: init.key, data: init.delete_rows });
					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).directive("treeSelectNodeParent", ["$compile", function ($compile) {
	return {
		restrict: 'EA',
		replace: true,
		scope: { users: '=', selecteduser: '=' },
		template: '<dd class="group" ng-repeat="item in users">\n\t\t\t\t\t<dl class="group">\n\t\t\t\t\t\t<dt class="group-title">{{item.dept_name}}</dt>\n\t\t\t\t\t\t<tree-select-node ng-repeat="node in item.children" data-selecteduser="selecteduser" data-node="node"></tree-select-node>\n\t\t\t\t\t</dl>\n\t\t\t\t  </dd>',
		controller: function controller($scope) {},
		link: function link(scope, element, attrs) {}
	};
}]).directive("treeSelectNode", ["$compile", function ($compile) {
	return {
		restrict: 'EA',
		replace: true,
		scope: { node: '=', selecteduser: '=' },
		template: '<dd></dd>',
		controller: function controller($scope) {
			$scope.selectUser = function (user) {
				$scope.$emit('selectCommonUser', user);
			};
		},
		link: function link(scope, element, attrs) {
			if (scope.node.children) {
				element.append('<dl class="group">' + '<dt class="group-title">{{node.dept_name}}</dt>' + '<tree-select-node ng-repeat="sub in node.children" data-selecteduser="selecteduser" data-nodes="node.children" data-node="sub"></tree-select-node>' + '</dl>');
			} else {
				element.append('<dd class="group-item" titile="{{selecteduser}}" url="{{ node }}" ng-class="{active:selecteduser.user_id === node.user_id}" ng-click="selectUser(node)">{{node.name}}({{node.real_name}})</dd>');
			}
			$compile(element.contents())(scope);
		}
	};
}]);

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi", []).factory("Task", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/home/tasklog", null, {
        query: { method: "GET", isArray: false },
        post: { method: "POST" },
        put: { method: "PUT" }
    });
}]).factory("VNC", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/instance/vnc/:id", { id: "@id" }, {
        loadISO: { method: "POST", url: $Domain + "/thor/image/loadISO" },
        save: { method: "POST", url: $Domain + "/thor/image/update_template" }
    });
}]).factory("loginResource", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/version", null, {
        query: { method: "GET" }
    });
}]).filter('lun_name', function () {
    return function (lun) {
        if (!angular.isUndefined(lun)) {
            lun.map(function (item) {
                item.value = item.vendor + " lun-" + item.lun + " " + item.size;
            });
        }
        return lun;
    };
}).filter('storage_type', function () {
    var type2str = {
        local: "本地磁盘",
        iscsi: 'iscsi 磁盘',
        netfs: '网络文件系统',
        fc: 'FC 光纤存储'
    };
    return function (type) {
        return type2str[type];
    };
}).filter('storage_status', function () {
    var stauts2str = {
        running: "正常",
        building: "准备中",
        error: '异常'
    };
    return function (stauts) {
        return stauts2str[stauts];
    };
}).filter('unsafe', function ($sce) {
    return function (val) {
        return $sce.trustAsHtml(val + "");
    };
}).filter('join', function () {
    return function (val, slash) {
        return val.filter(function (d) {
            return d;
        }).join(slash);
    };
}).filter('network_type', function () {
    var type2str = {
        nat: 'NAT',
        bridge: '桥接',
        vlan: 'VLAN'
    };
    return function (val) {
        return type2str[val];
    };
}).filter('yesorno', function () {
    return function (val) {
        return val ? '是' : '否';
    };
}).filter('to_mb', function () {
    return function (val) {
        return (val / 1024 / 1024).toFixed(2);
    };
}).filter('reverse', function () {
    return function (input, searchText, searchName) {
        if (input && searchText) {
            var outPut = [];
            outPut = input.filter(function (item) {
                if (item[searchName].indexOf(searchText) > -1) return item;
            });
            return outPut;
        }
        return input;
    };
}).config(["$filterProvider", function ($filterProvider) {
    $filterProvider.register("paging", function () {
        return function (items, index, pageSize) {
            if (!angular.isArray(items)) {
                return items;
            }
            if (pageSize > 0 && index > 0) {
                var total = items.length;
                var totalPage = Math.ceil(total / pageSize);
                index = Math.min(totalPage, Math.max(1, index));
                return items.slice((index - 1) * pageSize, index * pageSize);
            }
            return items;
        };
    });
}]).directive("dialog", ["$modal", "$rootScope", "$$$I18N", function ($modal, $rootScope, $$$I18N) {
    return {
        restrict: "A",
        link: function link($scope, element, attrs) {
            element.click(function () {
                if (attrs.disabled) {
                    $.bigBox({
                        title: $$$I18N.get("INFOR_TIP"),
                        content: attrs.error
                    });
                } else {
                    var dialog = $modal.open({
                        templateUrl: "views/vdi/dialog/" + attrs.dialogUrl,
                        controller: attrs.dialog,
                        scope: $scope,
                        size: attrs.dialogSize
                    });
                    $scope.close = dialog.dismiss.bind(dialog);
                    window.___dialog = dialog;
                }
            });
        }
    };
}]).directive("widgetGrid", ["$filter", "$modal", function ($filter, $modal) {
    function getPosition(e, ele) {
        var st = Math.max(document.documentElement.scrollTop, document.body.scrollTop);
        var sl = Math.max(document.documentElement.scrollLeft, document.body.scrollLeft);
        var cw = document.documentElement.clientWidth;
        var ch = document.documentElement.clientHeight;
        var sw = Math.max(document.documentElement.scrollWidth, document.body.scrollWidth);
        var sh = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);
        var ow = ele.offsetWidth;
        var oh = ele.offsetHeight;
        return {
            x: Math.max(0, e.pageX + ow > sl + cw ? sl + cw - ow : e.pageX),
            y: Math.max(0, e.pageY + oh > st + ch ? st + ch - oh : e.pageY)
        };
    }
    return {
        restrict: "A",
        controller: function controller($scope) {
            this.getCurrentPage = function () {
                return Number($scope.currentPage) > 0 ? $scope.currentPage : 0;
            };
            this.getCurrentRows = function () {
                return $scope.getCurrentRows();
            };
            this.getPageSize = function () {
                return Number($scope.pagesize) > 0 ? Number($scope.pagesize) : 0;
            };
        },
        link: function link($scope, element, attrs) {
            var context_wrapper = element.find(".context_wrapper");
            context_wrapper.on("mousedown", function (e) {
                if (e.target === this) {
                    context_wrapper.hide();
                    element.find(".contextmenu_selected").removeClass("contextmenu_selected");
                }
            }).on("click", function () {
                context_wrapper.hide();
                element.find(".contextmenu_selected").removeClass("contextmenu_selected");
            });
            context_wrapper.hide();

            // $scope.searchText = "";
            //$scope.pagesize = 5;
            $scope.currentPage = 1;

            $scope.getCurrentRows = function () {
                return $filter("paging")($scope.getFilterRows(), $scope.currentPage, $scope.pagesize);
            };
            $scope.getFilterRows = function () {
                return $filter("filter")($scope.rows || [], $scope.searchText);
            };

            $scope.checkAll = function () {
                var rows = $scope.getCurrentRows();
                var _all = rows.length && rows.filter(function (item) {
                    return !item._ignore;
                }).length && rows.filter(function (item) {
                    return !item._ignore;
                }).every(function (row) {
                    return row._selected;
                });
                $scope.checkedAll = _all;
                return _all;
            };
            $scope.selectAllChange = function (checkAll) {
                var rows = $scope.getCurrentRows();
                rows.filter(function (item) {
                    return !item._ignore;
                }).forEach(function (row) {
                    row._selected = checkAll;
                });
                $scope.checkedAll = checkAll;
            };
            $scope.checkOne = function () {
                var rows = $scope.getCurrentRows();
                return rows.filter(function (item) {
                    return !item._ignore;
                }).some(function (row) {
                    return row._selected;
                });
            };
            $scope.sort = function (name, asc) {
                $scope.rows.sort(function (a, b) {
                    return (a[name] > b[name] ? 1 : -1) * (asc ? 1 : -1);
                });
            };
            $scope.pageSizeChange = $scope.pageChange = function () {
                $scope.rows.forEach(function (item, i) {
                    item._selected = false;
                });
            };
            $scope.currentItem = null;
            $scope.$on("contextmenu", function (e, item, de, handler) {
                $scope.currentItem = item;
                handler.addClass("contextmenu_selected");
                $scope.rows.forEach(function (item) {
                    item._selected = false;
                });
                item._selected = true;
                $scope.$apply();
                context_wrapper.fadeIn(200);
                var menu = element.find(".grid_context_menu");
                var offset = context_wrapper.offset();
                var pos = getPosition(de, menu[0]);
                menu.css({
                    top: pos.y - offset.top + "px",
                    left: pos.x - offset.left + "px"
                });
                $scope.rows.forEach(function (item) {
                    item._selected = false;
                });
                item._selected = true;
                $scope.$apply();
                e.stopPropagation();
                de.preventDefault();
            });
        }
    };
}]).directive("gridPagination", [function () {
    return {
        restrict: "A",
        require: ["^widgetGrid"],
        conroller: function conroller($scope) {},
        link: function link($scope, element, attrs, ctrls) {
            var grid = ctrls[0];
            $scope.getStart = function () {
                var current = grid.getCurrentPage();
                var pagesize = grid.getPageSize();
                return pagesize > 0 ? (current - 1) * pagesize + 1 : 0;
            };
            $scope.getEnd = function () {
                var current = $scope.currentPage;
                var pagesize = grid.getPageSize();
                var end = current * pagesize;
                var currentCount = $scope.getFilterRows().length;
                return end < currentCount ? end : currentCount;
            };
            $scope.getCurrentCount = function () {
                return $scope.getCurrentRows().length;
            };
        }
    };
}]).directive("ribbonTips", ["localize", "$route", "$location", "$interval", function (localize, $route, $location, $interval) {
    return {
        restrict: "A",
        link: function link($scope, element, attrs) {
            var timer, dereg;
            var fn_update_help_info = function fn_update_help_info() {
                var path = $location.$$path;
                if (/^\/resource\/network\/\d+\/?$/.test(path)) {
                    path = "/resource/network/:id";
                }
                if (/^\/desktop\/teach\/\d+\/?$/.test(path)) {
                    path = "/desktop/teach/:id";
                }
                var help_text = attrs.myTips ? localize.localizeText(attrs.myTips) : localize.localizeText(path);
                element.attr("data-content", help_text);
                if (help_text) {
                    element.parent().show();
                } else {
                    element.parent().hide();
                }
            };
            $scope.$on("$routeChangeSuccess", function () {
                fn_update_help_info();
            });
            if (localize.isReady()) {
                fn_update_help_info();
            }
            $scope.$on("localizeLanguageChanged", fn_update_help_info);
        }
    };
}]).directive("contextmenu", [function () {
    return {
        restrict: "A",
        link: function link($scope, element, attrs) {
            if (attrs.contextmenuDisabled !== "true") {
                element.bind("contextmenu", function (e) {
                    $scope.$emit(attrs.contextmenuEventName || "contextmenu", $scope.item, e, element);
                });
            }
        }
    };
}]).directive("wizard", [function () {
    return {
        restrict: "A",
        transclude: true,
        scope: {
            lastText: "@",
            btnUnable: "="
        },
        controller: function controller($scope, localize, $$$I18N) {
            var steps = $scope.steps = [];
            $scope.currentStep = null;
            $scope.moveWth = 0;
            var defaults = {
                prevBtnText: "上一步",
                nextBtnText: "下一步",
                doneBtnText: "完成"
            };
            $scope.$on("currentStepChange", function (e, stepIndex) {
                $scope.go(stepIndex);
            });
            $scope.select = function (step) {
                var index;
                steps.forEach(function (s, i) {
                    s.selected = s === step;
                    if (s.selected) {
                        index = i;
                    }
                });
                $scope.currentStep = step;
                ["prev", "next", "done"].forEach(function (s) {
                    var key = s + "BtnText";
                    $scope[key] = $$$I18N.get(step[key] || defaults[key]);
                });
                $scope.$emit("selectStepChange", { index: index, stepScope: step });
            };
            $scope.getCurrentIndex = function () {
                return steps.indexOf($scope.currentStep);
            };

            $scope.prev = function () {
                var index = $scope.getCurrentIndex();
                //var e = $scope.$emit(($scope.stepEventName || "WizardStep"), $scope.currentStep);
                var prev = steps[index - 1];
                prev && $scope.select(prev);
                $scope.moveWth = $scope.getMarginValue();
            };
            $scope.next = function () {
                var index = $scope.getCurrentIndex();
                $scope.currentStep.is_dirty = true;
                var e = $scope.$emit(($scope.stepEventName || "WizardStep") + "_" + index, $scope.currentStep, $scope.currentStep.$$nextSibling);
                if ($scope.currentStep.done !== false) {
                    var next = steps[index + 1];
                    next && $scope.select(next);
                    $scope.moveWth = $scope.getMarginValue();
                };
            };
            $scope.go = function (index) {
                $scope.select(steps[index]);
                $scope.moveWth = $scope.getMarginValue();
            };
            $scope.showPrev = function () {
                return steps.indexOf($scope.currentStep) > 0 && $scope.currentStep.prevBtnText !== "";
            };
            $scope.isLast = function () {
                return steps.indexOf($scope.currentStep) >= steps.length - 1;
            };
            $scope.done = function () {
                var index = $scope.getCurrentIndex();
                $scope.currentStep.is_dirty = true;
                var e = $scope.$emit(($scope.stepEventName || "WizardStep") + "_" + index, $scope.currentStep, $scope.currentStep.$$nextSibling);
                if ($scope.currentStep.done !== false) {
                    var next = steps[index + 1];
                    next && $scope.select(next);
                    $scope.$emit($scope.doneEventName || "WizardDone", steps, steps.map(function (step) {
                        return step.$$nextSibling;
                    }));
                }
            };
            this.addStep = function (step) {
                steps.push(step);
                if (steps.length === 1) {
                    $scope.select(step);
                }
            };
            this.jumpStep = function (index) {};
            this.removeStep = function (index) {};
            this.insertStep = function (step) {};
        },
        link: function link($scope, element, attrs) {
            $scope.getMarginValue = function () {
                var _idx = $scope.getCurrentIndex();
                var wizardWth = element.find('.wizard').outerWidth();
                var _wth = 60;
                for (var i = 0; i <= _idx + 1; i++) {
                    _wth += element.find(".steps>li").eq(i).outerWidth();
                }
                if (wizardWth - _wth < 0) {
                    return wizardWth - _wth;
                } else {
                    return 0;
                }
            };
            // if(attrs.disableNav !== "true") {
            //     element.find(".steps").delegate("li.complete","click",function(e){
            //         var _idx = $(this).index();
            //         $scope.go(_idx);
            //     });
            // }
        },
        template: "<div class=\"wizard\" style=\"margin-bottom:20px;\">\n            <ul class=\"steps\" style=\"margin-left:{{moveWth}}px\">\n                <li data-ng-repeat=\"step in steps\" data-target=\"#step{{ $index }}\" data-ng-class=\"{ active: getCurrentIndex() >= $index ,complete:getCurrentIndex() > $index }\">\n                    <span class=\"badge badge-info\">{{ $index + 1 }}</span><span localize=\"{{step.name}}\"></span><span class=\"chevron\"></span>\n                </li>\n            </ul>\n            <div class=\"actions\">\n                <button ng-show=\"!btnUnable\" type=\"button\" data-ng-if=\"showPrev()\" data-ng-click=\"prev()\" ng-disabled=\"currentStep.showLoading === true\" class=\"btn btn-sm btn-primary btn-prev\">\n                    <i class=\"fa fa-arrow-left\"></i><span ng-bind=\"prevBtnText\"></span>\n                </button>\n                <button ng-show=\"!btnUnable\" type=\"button\" data-ng-if=\"!isLast()\" data-ng-click=\"next()\" ng-disabled=\"currentStep.showLoading === true\" class=\"btn btn-sm btn-success btn-next\">\n                    <span ng-bind=\"nextBtnText\"></span> <i class=\"fa fa-arrow-right\"></i>\n                </button>\n                <button id='finish' ng-show=\"!btnUnable && isLast()\" type=\"button\" data-ng-click=\"done()\" ng-disabled=\"currentStep.showLoading === true\" class=\"btn btn-sm btn-success btn-next\">\n                    <span ng-bind=\"doneBtnText\"></span><i class=\"fa fa-check\" ></i>\n                </button>\n                <img ng-show=\"btnUnable\" src=\"img/loadingtext.gif\" width=\"24px\" height=\"24px\"/>\n                <img ng-show=\"currentStep.showLoading === true\" src=\"img/loadingtext.gif\" width=\"24px\" height=\"24px\"/>\n            </div>\n        </div>\n        <div class=\"step-content\">\n            <form data-ng-transclude class=\"form-horizontal\" id=\"fuelux-wizard\" method=\"post\" novalidate>\n            </form>\n        </div>\n        <div ng-show=\"currentStep.showLoading === true\" style=\"position: absolute;top:0;right:0;bottom:0;left:0;z-index:999;\"></div>"
    };
}]).directive("wizardStep", [function () {
    return {
        restrict: "A",
        require: "^wizard",
        transclude: true,
        replace: true,
        scope: {
            name: "@",
            prevBtnText: "@",
            nextBtnText: "@",
            doneBtnText: "@",
            testValid: "="
        },
        controller: function controller($scope) {},
        link: function link(scope, element, attrs, wizard) {
            wizard.addStep(scope);
        },
        template: "<div class=\"step-pane\" data-ng-class=\"{ active: selected }\" data-ng-show=\"selected\" data-ng-transclude></div>"
    };
}]).directive('areaTraffic', function ($interval, $http) {
    return {
        restrict: 'EA',
        replace: true,
        scope: {
            options: "="
        },
        link: function link(scope, e, attrs) {
            Highcharts.setOptions({ //disable utc time
                global: {
                    useUTC: false
                }
            });
            function init_data() {
                // generate init data
                var data = [],
                    time = new Date().getTime(),
                    i;

                for (i = -40; i <= 0; i += 1) {
                    data.push({
                        x: time + i * scope.$parent.refresh_time,
                        y: 0
                    });
                }
                return data;
            }
            var hc_options = scope.options.options;
            hc_options.chart.renderTo = e[0];
            hc_options.yAxis.min = 0;
            angular.forEach(hc_options.series, function (s) {
                s.data = init_data();
            });

            var highcharts = new Highcharts.Chart(hc_options);

            function drawPoint(data) {
                var datetime = new Date().getTime();
                var hc_series = highcharts.series;

                scope.options.drawpoint(hc_series, data, datetime);
            }

            function reset_highcharts() {
                //reset highcharts
                highcharts.destroy();
                angular.forEach(hc_options.series, function (s) {
                    s.data = init_data();
                });
                highcharts = new Highcharts.Chart(hc_options);
            }

            scope.$watch('$parent.metric_data', function (newvalue) {
                if (newvalue) {
                    drawPoint(newvalue);
                }
            });

            scope.$watch('$parent.refresh_time', function (newvalue) {
                reset_highcharts();
            });

            scope.$watch('$parent.item', function (newvalue) {
                reset_highcharts();
            });
        }
    };
}).directive("monitorTree", [function () {
    return {
        restrict: "A",
        transclude: true,
        template: "<div class=\"portlet-title clearfix padding-5\">\n                <div class=\"pull-left\">\n                    <a href=\"javascript:\" id=\"collape\" class=\"btn btn-default btn-xs\"><i class=\"fa  icon-jj-Shrinkfrom\"></i> </a>\n                    <a href=\"javascript:\" id=\"open\" class=\"btn btn-default  btn-xs\"><i class=\"fa icon-jj-Open\"></i></a>\n                </div>\n                <div class=\"pull-right\"><a href=\"javascript:\"class=\"btn btn-default  btn-xs\" ng-init=\"ishow=false\" ng-click=\"ishow==true?ishow=false:ishow=true;open()\"><i class=\"fa fa-search\"></i></a></div> \n            </div>\n            <div class=\"search\" ng-show=\"ishow\"><input type=\"search\" localize=\"\u684C\u9762\u540D\" ng-model=\"searchText\"></div>\n            <div class=\"portlet-body fuelux monitor-tree\" data-ng-transclude></div>\n        ",
        link: function link(scope, element, attrs) {
            element.delegate('#open', 'click', function (event) {
                element.find(".parent").addClass('in');
            });
            element.delegate('#collape', 'click', function (event) {
                element.find(".parent").removeClass('in');
            });
            element.delegate(".tree-toggle", "click", function (event) {
                var parent = $(this).parent().parent(".parent");
                if (parent.hasClass('in')) {
                    parent.removeClass('in');
                } else {
                    parent.addClass("in");
                }
            });
            element.delegate(".tree-it", "click", function (event) {
                element.find("li").removeClass('active');
                $(this).parent("li").addClass('active');
            });
            scope.open = function () {
                element.find(".parent").addClass('in');
            };
        }
    };
}]).directive('ipPattern', function (ip_pattern) {

    return {
        require: ['ngModel', '?ngRequired'],
        link: function link(scope, elm, attrs, ctrls) {
            var ngmodelctl = ctrls[0];
            var ngrequiredctl = ctrls[1];

            ngmodelctl.$parsers.push(function (viewValue) {

                if (ip_pattern.test(viewValue) || !ngrequiredctl && !viewValue) {

                    ngmodelctl.$setValidity('ipcheck', true);
                    return viewValue;
                } else {

                    ngmodelctl.$setValidity('ipcheck', false);
                    return undefined;
                }
            });
        }
    };
}).directive("preventSpace", [function () {
    return {
        restrict: "A",
        link: function link(scope, element, attrs) {
            element.on("keypress", function (e) {
                if (e.keyCode === 32) {
                    e.preventDefault();
                }
            });
        }
    };
}]).directive("inputNumber", [function () {
    return {
        restrict: "AE",
        link: function link(scope, element, attrs) {
            var numKey = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105];
            var ctrlKey = [8, // backspace
            46, // delete
            37, // left arrow
            39 // right arrow
            ];
            element.on("keydown", function (e) {
                var code = e.which || e.keyCode;
                if (numKey.indexOf(code) > -1) {
                    var num = code < 60 ? code - 48 : code - 96;
                    var nextValue = this.value + num;
                    if (!attrs.max) {
                        return;
                    }
                    var max = attrs.max * 1;
                    if (!isNaN(max) && nextValue <= max) {
                        return;
                    }
                } else if (ctrlKey.indexOf(code) > -1) {
                    return;
                }
                e.preventDefault();
                return false;
            });
        }
    };
}])
// .directive("inputDot", [function(){
//     return {
//         restrict: "AE",
//         link: function(scope, element, attrs){
//             element.on("keydown",function(e){
//                 if(attrs.inputDot == 'true'){
//                    if(e.keyCode === 190 || e.keyCode === 110 || e.keyCode === 69){
//                         e.preventDefault();
//                    }
//                 }
//                 else{
//                     if(e.keyCode === 69){
//                         e.preventDefault();
//                     }
//                 }

//             });
//         }
//     };
// }])
.directive("formatIp", ["$compile", function ($compile) {
    return {
        restrict: "EA",
        require: "ngModel",
        scope: {
            start: "=",
            end: "="
        },
        link: function link(scope, element, attrs, ctrl) {
            var ngModelCtrl = ctrl;
            var required = attrs.ipRequired ? scope.$eval(attrs.ipRequired) : true;

            if (!ngModelCtrl) {
                return;
            };
            var CHECKTOOLS = {};

            CHECKTOOLS.checkIP = function (ip) {
                if (!ip) {
                    return false;
                }
                var parts = ip.split(".");
                //9029bug 0.0.0.0不合法IP
                var numre = /^(0|[1-9][0-9]*)$/;
                var i,
                    valid = true;
                if (parts.length !== 4) {
                    return false;
                }
                for (i = 0; i < 4; i++) {
                    if (numre.test(parts[i]) && parseInt(parts[i]) <= 255) {
                        continue;
                    } else {
                        valid = false;
                    }
                }
                valid = valid && ipformatNum(ip) > ipformatNum('1.0.0.0');
                return valid;
            };

            function ipformatNum(ip) {
                var arr = ip.split('.').map(function (item) {
                    return Number(item);
                });
                return arr[0] * Math.pow(256, 3) + arr[1] * Math.pow(256, 2) + arr[2] * Math.pow(256, 1) + arr[3];
            }

            CHECKTOOLS.ip2long = function (ip) {
                if (CHECKTOOLS.checkIP(ip)) {
                    var arr = ip.split('.').map(function (item) {
                        return Number(item);
                    });
                    return arr[0] * Math.pow(256, 3) + arr[1] * Math.pow(256, 2) + arr[2] * Math.pow(256, 1) + arr[3];
                }
            };
            CHECKTOOLS.checkRange = function (ip, s_ip, e_ip) {
                if (CHECKTOOLS.checkIP(ip), CHECKTOOLS.checkIP(s_ip) && CHECKTOOLS.checkIP(e_ip)) {
                    var s = CHECKTOOLS.ip2long(s_ip);
                    var e = CHECKTOOLS.ip2long(e_ip);
                    var c = CHECKTOOLS.ip2long(ip);
                    return c >= s && c <= e;
                } else {
                    return false;
                }
            };
            var popEl = angular.element("<div format-ip-wrap></div>");
            var $input = $compile(popEl)(scope);
            element.addClass("ng-hide");
            element.after($input);

            // model -- ui

            ngModelCtrl.$render = function () {
                var modelVal = ngModelCtrl.$modelValue;
                var modelValArr;
                try {
                    if (modelVal === null) {
                        modelValArr = [];
                        ngModelCtrl.$setPristine();
                    } else {
                        modelValArr = modelVal.split(".");
                    }
                    [1, 2, 3, 4].forEach(function (i, idx) {
                        scope["seg" + i] = modelValArr[idx] || "";
                    });
                } catch (err) {}
                // setValidate();
            };
            /*
            function setValidate(){
                var isValid;
                if(ngModelCtrl.$modelValue){
                    if(scope.start && scope.end){
                        isValid = CHECKTOOLS.checkRange(ngModelCtrl.$modelValue,scope.start,scope.end)
                    }else{
                        isValid = CHECKTOOLS.checkIP(ngModelCtrl.$modelValue);
                    }
                    ngModelCtrl.$setValidity("ip",isValid);
                }else{
                    ngModelCtrl.$setValidity("ip",true);
                }
            };
              // ui -- model
            $input.on("input",function(e){
                scope.$apply(function(){
                    var val = [1,2,3,4].map(function(i){ return scope["seg" + i] || ""; }).join(".");
                    var isNull = val.split(".").every(function(item){ return item.length===0 });
                    if(isNull){
                        ngModelCtrl.$setViewValue("");
                    }else{
                        ngModelCtrl.$setViewValue(val);
                    }
                    ngModelCtrl.$render();
                })
            });
              */

            scope.$watch("seg1 + '.' + seg2 + '.' + seg3 + '.' + seg4", function (ip) {
                var value = ngModelCtrl.$modelValue;
                if (ip === "...") {
                    if (value) {
                        ngModelCtrl.$setViewValue("");
                    }
                    if (!value || !required) {
                        return ngModelCtrl.$setValidity("ip", true);
                    }
                    ngModelCtrl.$setValidity("ip", false);
                } else {
                    var isValid = false;
                    if (scope.start && scope.end) {
                        isValid = CHECKTOOLS.checkRange(ip, scope.start, scope.end);
                    } else {
                        isValid = CHECKTOOLS.checkIP(ip);
                    }
                    ngModelCtrl.$setValidity("ip", isValid);
                    ngModelCtrl.$setViewValue(ip);
                }
            });
        }
    };
}]).directive("formatIpWrap", function () {
    return {
        restrict: "AE",
        replace: true,
        template: "<span role=\"ipgroup\"><input type=\"text\" ng-model=\"seg1\"><span class=\"dot\">.</span><input type=\"text\" ng-model=\"seg2\"><span class=\"dot\">.</span><input type=\"text\" ng-model=\"seg3\"><span class=\"dot\">.</span><input type=\"text\" ng-model=\"seg4\"></span>",
        link: function link(scope, element, attrs) {
            element.on("keydown", "input", function (event) {
                switch (event.keyCode) {
                    case 110:
                    case 190:
                        var nextEles = $(this).nextAll("input");
                        nextEles.length && nextEles.eq(0).focus();
                        event.preventDefault();
                        break;
                    case 8:
                        if (!$(this).val()) {
                            $(this).prevAll("input").length && $(this).prevAll("input").eq(0).focus();
                        }
                        break;
                    case 37:
                        if (this.selectionStart === 0) {
                            $(this).prevAll("input").length && $(this).prevAll("input").eq(0).focus();
                        };
                        break;
                    case 39:
                        if (this.selectionStart === $(this).val().length) {
                            $(this).nextAll("input").length && $(this).nextAll("input").eq(0).focus();
                        }
                        break;
                    case 32:
                    case 229:
                        event.preventDefault();
                        event.stopPropagation();
                        break;
                }
            });
            element.on("keypress", "input", function (e) {
                if (e.keyCode < 48 || e.keyCode > 57) {
                    e.preventDefault();
                }
                if ($(this).val().length > 2 && this.selectionStart === this.selectionEnd) {
                    e.preventDefault();
                }
            });
            element.on("paste", function (e) {
                e.preventDefault();
            });
            element.on("focus", "input", function (e) {
                element.addClass("focus");
            });
            element.on("blur", "input", function (e) {
                element.removeClass("focus");
            });
        }
    };
}).directive("treeNodeParent", ["$compile", function ($compile) {
    return {
        restrict: 'EA',
        replace: true,
        scope: { users: '=', filtertext: '=' },
        template: '<ul role="tree" class="menu menu-tree" ng-repeat="item in getUsers()">' + '<div class="menu_header">' + '<span class="fa icon-jj"></span>' + '<span class="menu-name">{{item.dept_name}}</span>' + '<span class="pull-right fa icon-jj-add" data-ng-click="add_selected(item);$event.stopPropagation()"></span>' + '</div>' + '<div class="menu_body">' + '<tree-node ng-repeat="node in item.children" data-nodes="item.children" data-node="node"></tree-node>' + '</div>' + '</ul>',
        controller: function controller($scope) {
            var lastFilter;
            var lastFiltedResult;
            $scope.add_selected = function (children) {
                $scope.$emit('add_selected', children);
            };

            $scope.getUsers = function () {
                var text = $scope.filtertext || "";
                var users = $scope.users;
                text = text.trim();
                if (!text) {
                    return users;
                }
                if (text !== lastFilter) {
                    lastFilter = text;
                    lastFiltedResult = filterUser(angular.copy(users), text);
                }
                return lastFiltedResult;
            };

            function filterUser(users, text) {
                return users.filter(function (user) {
                    if (user.children) {
                        user.children = filterUser(user.children, text);
                        return user.children.length > 0;
                    } else {
                        return user.user_name.indexOf(text) > -1 || user.real_name.indexOf(text) > -1;
                    }
                });
            }
        },
        link: function link(scope, element, attrs) {}
    };
}]).directive("treeNode", ["$compile", function ($compile) {
    return {
        restrict: 'EA',
        replace: true,
        scope: { node: '=', nodes: '=' },
        template: '<div></div>',
        controller: function controller($scope) {
            $scope.add_selected = function (children) {
                $scope.$emit('add_selected', children);
            };
            $scope.add_select_rows = function ($event, node, nodes) {
                $scope.$emit('add_select_rows', $event, node, nodes);
            };
        },
        link: function link(scope, element, attrs) {
            if (scope.node.children) {
                element.append('<ul role="group" class="menu menu-tree">' + '<div class="menu_header">' + '<span class="fa icon-jj"></span>' + '<span class="menu-name">{{node.dept_name}}</span>' + '<span class="pull-right fa icon-jj-add" data-ng-click="add_selected(node);$event.stopPropagation()"></span>' + '</div>' + '<div class="menu_body">' + '<tree-node ng-repeat="sub in node.children" data-nodes="node.children" data-node="sub"></tree-node>' + '</div>' + '</ul>');
            } else {
                element.append('<li class="menuitem" ng-click="add_select_rows($event,node,nodes)" ng-dblclick="add_selected(node)">' + '<span class="text-overflow text-overflow-half">{{node.name}}</span>' + '<span class="text-overflow text-overflow-half">{{node.real_name}}</span>' + '</li>');
            }
            $compile(element.contents())(scope);
        }
    };
}]).directive("uiMenuList", ["Admin", "User", "Domain", "$q", "$$$I18N", function (APIadmin, APIuser, APIdomain, $q, $$$I18N) {
    return {
        restrict: "AE",
        scope: {
            selected: "=menuListData"
            // domain:"=menuListDomain"
        },
        templateUrl: "includes/userMenu.html",
        controller: function controller($scope) {
            $scope.expandedNodes = [];
            $scope._users = [];
            $scope.selected = $scope.selected || [];
            $scope.seRows = [];
            $scope.rmRows = [];
            $scope.common_users = [];
            function formatData(d, name) {
                iteration(d, name);
                return d;
            }
            function iteration(data, childName, list) {
                for (var i = 0; i < data.length; i++) {
                    $scope.expandedNodes.push(data[i]);
                    if (data[i][childName] && data[i][childName].length) {
                        var len = iteration(data[i][childName], childName);
                        if (len === 0) {
                            data[i] = undefined;
                        }
                    }
                    if (!data[i]) {
                        continue;
                    }
                    if (data[i].users && data[i].users.length > 0) {
                        data[i].users.map(function (user) {
                            user.name = user.name || user.user_name;
                            user._is_last = true;
                            return user;
                        });
                        data[i][childName] = data[i].users;
                    }
                    if (data[i][childName] && data[i][childName].length === 0) {
                        data[i] = undefined;
                    }
                }
                while (data.length > 0) {
                    // 如果有数组元素为空，每次删除一个
                    var oldlen = data.length;
                    for (var i = 0; i < oldlen; i++) {
                        if (data[i] === undefined) {
                            data.splice(i, 1);
                            break;
                        }
                    }
                    if (oldlen === data.length) {
                        break;
                    }
                }

                return data.length;
            }
            function removeNoChildrenDeparts(data) {
                data = data.filter(noUserFilter);
                data.forEach(walk);
                return data;
                function walk(node) {
                    if (!node.dept_id) {
                        return;
                    }
                    // 用户上级是没有 children 的
                    if (node.children) {
                        node.children = node.children.filter(noUserFilter);
                        node.children.forEach(walk);
                    }
                }
                function noUserFilter(node) {
                    if (node.dept_id && !node.children && node.users.length === 0) {
                        return false;
                    }
                    return true;
                }
            }
            function get_admin() {
                var deferred = $q.defer();
                APIadmin.query(function (res) {
                    deferred.resolve(res);
                });
                return deferred.promise;
            }
            function get_user() {
                var deferred = $q.defer();
                APIuser.query_tree(function (res) {
                    deferred.resolve(res);
                });
                return deferred.promise;
            }
            function get_domain() {
                var deferred = $q.defer();
                APIdomain.list(function (res) {
                    deferred.resolve(res);
                });
                return deferred.promise;
            }
            $q.all([get_admin(), get_user(), get_domain()]).then(function (arr) {
                $scope._users = [{
                    typeName: $$$I18N.get("管理用户"),
                    userData: arr[0].users
                }];
                $scope.domain_users = arr[2].result.map(function (res) {
                    res._name = $$$I18N.get("域") + "(" + res.name + ")";
                    return res;
                });
                $scope.common_users = formatData(removeNoChildrenDeparts(arr[1].result), "children");
                console.log($scope.common_users);
            });
            function getLastLevelNodes(obj_levels, arrays) {
                if (obj_levels.children) {
                    obj_levels.children.forEach(function (item) {
                        getLastLevelNodes(item, arrays);
                    });
                } else {
                    arrays.push(obj_levels);
                }
            }

            $scope.$on('add_selected', function (e, levels) {
                var arrays = [];
                getLastLevelNodes(levels, arrays);
                $scope.add_selected(arrays);
            });
            $scope.$on('add_select_rows', function (e, $event, node, nodes) {
                console.log(555555, $event, node, nodes);
                $scope.add_select_rows($event, node, nodes);
            });
            $scope.add_selected = function (items) {
                var rows = items instanceof Array ? items : [items];
                rows.forEach(function (i) {
                    if ($scope.selected.indexOf(i) === -1) {
                        $scope.selected.push(i);
                    }
                });
            };
            $scope.remove_selected = function (items) {
                var rows = items instanceof Array ? items : [items];
                rows.forEach(function (i) {
                    $scope.selected.splice($scope.selected.indexOf(i), 1);
                });
                $scope.rmRows = [];
            };
            var lastRow2 = null;
            $scope.add_select_rows = function (e, item, items) {
                var idx = $scope.seRows.indexOf(item);
                if (e.ctrlKey) {
                    idx === -1 ? $scope.seRows.push(item) : $scope.seRows.splice(idx, 1);
                    lastRow2 = item;
                } else if (e.shiftKey) {
                    var begin_idx = items.indexOf(lastRow2);
                    var end_idx = items.indexOf(item);
                    if (begin_idx === -1) {
                        lastRow2 = item;
                        $scope.seRows = [item];
                    } else {
                        $scope.seRows = items.slice(Math.min(begin_idx, end_idx), Math.max(begin_idx, end_idx) + 1);
                        console.log(1111111, $scope.seRows);
                    }
                } else {
                    $scope.seRows.splice(0, $scope.seRows.length, item);
                    lastRow2 = item;
                }
            };
            var lastRow = null;
            $scope.add_remove_rows = function (e, item) {
                var idx = $scope.rmRows.indexOf(item);
                if (e.ctrlKey) {
                    idx === -1 ? $scope.rmRows.push(item) : $scope.rmRows.splice(idx, 1);
                    lastRow = item;
                } else if (e.shiftKey) {
                    var begin_idx = $scope.selected.indexOf(lastRow);
                    var end_idx = $scope.selected.indexOf(item);
                    if (begin_idx !== -1 && end_idx !== -1) {
                        $scope.rmRows = $scope.selected.slice(Math.min(begin_idx, end_idx), Math.max(begin_idx, end_idx) + 1);
                    } else {
                        $scope.rmRows = [item];
                        lastRow = item;
                    }
                } else {
                    $scope.rmRows.splice(0, $scope.rmRows.length, item);
                    lastRow = item;
                }
            };
            $scope.ltor = function () {
                $scope.add_selected($scope.seRows);
            };
            $scope.rtol = function () {
                $scope.remove_selected($scope.rmRows);
            };
        },
        link: function link(scope, element, attrs) {
            var last = null;
            element.on("keyup", 'input[ng-model="searchText"]', function (e) {
                $(".menu_header").addClass("open");
            });
            element.on("click", ".menu_header", function (e) {
                $(this).toggleClass("open");
            });
            element.on("click", ".menuitem", function (e) {
                var ele = $(this);
                var menuItems = ele.parent().parent(".menu_body").find(".menuitem");
                var allMenuItems = ele.parents(".menus").find(".menuitem");
                if (e.ctrlKey) {
                    ele.hasClass("itemActive") ? ele.removeClass("itemActive") : ele.addClass("itemActive");
                    last = ele;
                } else if (e.shiftKey) {
                    var begin_idx = [].indexOf.apply(menuItems, last);
                    var end_idx = [].indexOf.apply(menuItems, ele);
                    allMenuItems.removeClass("itemActive");
                    if (begin_idx !== -1 && end_idx !== -1) {
                        for (var i = 0; i < menuItems.length; i++) {
                            if (i > Math.max(begin_idx, end_idx) || i < Math.min(begin_idx, end_idx)) {
                                menuItems.eq(i).removeClass("itemActive");
                            } else {
                                menuItems.eq(i).addClass("itemActive");
                            }
                        }
                    } else {
                        ele.addClass("itemActive");
                        last = ele;
                    }
                } else {
                    allMenuItems.removeClass("itemActive");
                    ele.addClass("itemActive");
                    last = ele;
                }
            });
        }
    };
}]).directive("uiInputNumber", ["$http", "$compile", "$templateCache", function ($http, $compile, $templateCache) {
    return {
        restrict: "AE",
        scope: {
            step: "@",
            max: "@",
            userNumber: "=ngModel",
            min: "@"
        },
        priority: 2,
        require: "ngModel",
        controller: function controller($scope) {},
        link: function link(scope, element, attrs, ctrl) {

            scope.addStep = Number(scope.step) || 1;
            scope.addMax = Number(scope.max) || null;
            scope.addMin = Number(scope.min) || null;

            var is_dot = String(Number(scope.step)).indexOf(".") === -1 ? false : true;

            var modelCtrl = ctrl;
            var temp = $compile($("<div ui-input-number-wrapper></div>")[0])(scope);
            element.hide();
            element.after(temp);

            var numKey = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105];
            var ctrKey = [8, 9, 13, 35, 36, 37, 38, 39, 40, 45, 46, 144, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 110, 190];
            scope.keydown = function (e) {
                var _code = e.keyCode;
                var _valsplit = e.target.value.split(".");

                if (numKey.indexOf(_code) === -1 && ctrKey.indexOf(_code) === -1) {
                    e.preventDefault();
                }
                // 小数点后只能输入一位
                if (numKey.indexOf(_code) > -1 && _valsplit.length > 1 && _valsplit[1].length > 0 && e.target.selectionStart > e.target.value.indexOf(".")) {
                    e.preventDefault();
                }
                // 屏蔽小数点
                if (_code === 110 || _code === 190) {
                    if (!is_dot) {
                        e.preventDefault();
                    } else {
                        if (e.target.value.indexOf(".") !== -1) {
                            e.preventDefault();
                        }
                    }
                }
                // 键盘上键加法
                if (_code === 38) {
                    e.preventDefault();
                    scope.add(scope.addStep);
                    scope.round();
                }
                // 键盘下键减法
                if (_code === 40) {
                    e.preventDefault();
                    scope.add(-scope.addStep);
                    scope.round();
                }
            };
            scope.round = function () {
                scope.userNumber = is_dot ? Math.round(Number(scope.userNumber) * 2) / 2 : Math.round(scope.userNumber);
            };

            modelCtrl.$render = function () {
                scope.setValidation();
            };
            scope.setValidation = function () {
                var newval = modelCtrl.$modelValue;
                var exp = /^-?([1-9]\d*\.?\d*|0\.?\d*[1-9]\d*|0?\.?0+|0)$/;
                if (exp.test(newval)) {
                    if (Math.abs(scope.addMax) >= 0 && newval > scope.addMax || Math.abs(scope.addMin) >= 0 && newval < scope.addMin) {
                        modelCtrl.$setValidity("number", false);
                    } else {
                        modelCtrl.$setValidity("number", true);
                    }
                } else {
                    if (newval) {
                        modelCtrl.$setValidity("number", false);
                    } else {
                        modelCtrl.$setValidity("number", true);
                    }
                }
            };
            scope.add = function (num) {
                scope.userNumber = Number(scope.userNumber) ? Number(scope.userNumber) + Number(num) : Number(num);
                scope.setValidation();
            };
        }
    };
}]).directive("uiInputNumberWrapper", [function () {
    return {
        restrict: "A",
        replace: true,
        templateUrl: "./views/vdi/common/input-number-temp.html",
        link: function link(scope, element) {}
    };
}]).directive("uiInputNumberFormatter", [function () {
    return {
        restrict: "A",
        require: "ngModel",
        link: function link(scope, element, attrs, ctrl) {
            var exp = /^-?([1-9]\d*\.?\d*|0\.?\d*[1-9]\d*|0?\.?0+|0)$/;

            ctrl.$parsers.push(function (value) {
                if (exp.test(value)) {
                    return Number(value);
                }
            });
            ctrl.$formatters.push(function (value) {

                if (exp.test(value)) {
                    return Number(value);
                }
            });
        }
    };
}]).directive("uiWebUpload", ["$http", "$rootScope", "$$$I18N", "$Domain", function ($http, $rootScope, $$$I18N, $Domain) {
    var org = XMLHttpRequest;
    var org_open = org.prototype.open;
    var allowUpload = window.FormData && typeof window.FormData === "function";
    $rootScope.uploadPool = $rootScope.uploadPool || {};
    return {
        restrict: "A",
        templateUrl: function templateUrl(ele, attrs) {
            if (attrs.templateUrl) {
                return attrs.templateUrl;
            }
            return "views/vdi/common/ui-web-upload.html";
        },
        scope: {
            config: "=uiUploadConfig",
            finishHandel: "&"
        },
        controller: ["$scope", function (scope) {
            scope.$on("progress", function (e, size) {
                if (size.id === scope.upload_id) {
                    scope.progressName = size.name;
                    scope.isUploading = true;
                    var percent = size.loaded / size.total * 100;
                    if (isNaN(percent)) {
                        percent = 0;
                    }
                    scope.progressPercent = percent.toFixed(2) + "%";
                    if (scope.progressPercent === "100.00%") {
                        scope.isUploading = false;
                    }
                    // 初始化页面上传不更新问题
                    scope.$apply();
                }
            });
            scope.allowUpload = allowUpload;
            scope.uploadISOSize = null;
        }],
        link: function link(scope, element, attrs) {
            scope.upload_id = attrs.uiWebUpload;
            scope.btnName = $$$I18N.get(attrs.uiUploadBtnName);
            scope.$on("localizeLanguageChanged", function () {
                // 重新apply数据才会更新视图，加定时器，调用apply才不会报错
                setTimeout(function () {
                    scope.btnName = $$$I18N.get(attrs.uiUploadBtnName);
                    scope.$apply();
                });
            });

            // 绑定一个测试提交，如果条件为 true 则按钮可点击，否则不可点击
            // 这种方式需要父 scope 配合
            if (attrs.uiWebUploadTest) {
                var degfn = scope.$parent.$watch(attrs.uiWebUploadTest, function (v) {
                    scope.disableTest = v;
                });
                scope.$on("$destroy", degfn);
                scope.disableTest = false;
            } else {
                scope.disableTest = true;
            }

            var filetype, url;
            var form = element.find("form");
            form.attr("action", url);
            function checkConfig(file, config) {
                var filetype = attrs.uiUploadType;
                var maxSize = attrs.uiUploadLimit;
                var url = attrs.uiUploadUrl;

                if (!url) {
                    throw new Error("no url config");
                    return false;
                }
                var typematch = true;
                if (filetype && file) {
                    typematch = new RegExp("\\.(" + filetype + ")$").test(file.name);
                    if (!typematch) {
                        $.bigBox({
                            title: $$$I18N.get("INFOR_TIP"),
                            content: $$$I18N.get("不是一个可接受的文件类型"),
                            icon: "fa fa-warning shake animated",
                            timeout: 6000
                        });
                        return false;
                    }
                }

                if (maxSize) {
                    maxSize = parseInt(maxSize);
                    if (isNaN(maxSize)) {
                        return console.error("invalid upload limit:", attrs.uiUploadLimit);
                    }
                    if (file.size > maxSize * Math.pow(2, 30)) {
                        $.bigBox({
                            title: $$$I18N.get("INFOR_TIP"),
                            content: $$$I18N.get("超出文件大小限制") + "(" + maxSize + "G)",
                            icon: "fa fa-warning shake animated",
                            timeout: 6000
                        });
                        return false;
                    }
                }
                if (file.size === 0) {
                    $.bigBox({
                        title: $$$I18N.get("INFOR_TIP"),
                        content: $$$I18N.get("文件为空"),
                        icon: "fa fa-warning shake animated",
                        timeout: 6000
                    });
                    return false;
                } else {
                    return true;
                }
            }
            function clearDOM() {
                var input = element.find("input[type=file]");
                input.after(input.clone(true).val(''));
                input.remove();
                scope.isUploading = false;
                scope.progressSize = 0;
            }
            function finish() {
                $rootScope.uploadPool[attrs.uiWebUpload] = undefined;
                delete $rootScope.uploadPool[attrs.uiWebUpload];
            }
            function success(res) {
                if (typeof scope.finishHandel === "function") {
                    scope.finishHandel({ response: res });
                }
            }
            element.find("input[type=file]").on("change", function (e) {
                var file = e.target.files[0];
                if (!file) {
                    return;
                }
                // var conf = scope.config;
                var isValid = checkConfig(file);

                if (isValid) {
                    // $.bigBox({
                    //  title : $$$I18N.get("INFOR_TIP"),
                    //  content : $$$I18N.get("INFOR_UPISO"),
                    //  iconSmall : "fa fa-warning shake animated",
                    //  timeout : 5000
                    // });

                    var data = new FormData();
                    // 允许绑定额外的参数
                    if (attrs.uiWebUploadParams) {
                        $.each(scope.$eval(attrs.uiWebUploadParams), function (k, v) {
                            data.append(k, v);
                        });
                    }
                    data.append(attrs.uiWebUploadName || e.target.name, file);
                    scope.progressName = file.name;
                    scope.progressSize = "(" + (file.size / Math.pow(2, 20)).toFixed(2) + "M)";

                    $http.post($Domain + attrs.uiUploadUrl, data, {
                        transformRequest: function transformRequest(config) {
                            window.XMLHttpRequest = function (a, b, c, e) {
                                window.XMLHttpRequest = org;
                                var xhr = new org(a, b, c, e);
                                $rootScope.uploadPool[attrs.uiWebUpload] = xhr;
                                xhr.open = function (q, w, e, r, t, y) {
                                    xhr.open = undefined;
                                    delete xhr.open;
                                    if (xhr.upload) {
                                        xhr.upload.addEventListener("progress", function (e) {
                                            $rootScope.$broadcast("progress", {
                                                id: attrs.uiWebUpload,
                                                name: file.name,
                                                loaded: e.loaded,
                                                position: e.position,
                                                total: e.total,
                                                totalSize: e.totalSize
                                            });
                                        });
                                        xhr.addEventListener("abort", finish);
                                    }
                                    return org_open.call(xhr, q, w, e, r, t, y);
                                };
                                return xhr;
                            };
                            return config;
                        },
                        headers: { "Content-Type": undefined }
                    }).then(function (res) {
                        clearDOM();
                        finish(res);
                        success(res);
                        $rootScope.$broadcast("finishUpload", true, file.name);
                    }, function () {
                        clearDOM();
                        finish();
                    });
                }
            });

            element.find("button[type='button']").on("click", function (e) {
                $(this).prev("input[type=file]").click();
            });
            if (attrs.btnClass) {
                element.find("button[type='button']").removeClass("btn-primary").addClass(attrs.btnClass);
            }
            if (attrs.iconClass) {
                element.find(".icon").removeClass("icon-jj-Upload").addClass(attrs.iconClass);
            }

            element.find("#abortBtn").on("click", function (e) {
                var xhr = $rootScope.uploadPool[attrs.uiWebUpload];
                xhr && xhr.abort();
                clearDOM();
                scope.$apply();
            });
        }
    };
}]).service("warnBox", [function () {
    this.warn = function (content, id, callback) {
        if (!$("#warnBox").length) {
            $("body").append("<div id='warnBox'></div>");
        } else {
            $("#warnBox").show();
        }
        $("body #warnBox").append("<div class='box warnBox" + id + "'><i class='fa fa-bell'></i><div class='content'><div class='btn-close'><span>×</span></div><p class='detail' title=" + content + ">" + content + "</p></div></div>");
        if ($("body .warnBox" + id + " .detail").height() > 38) {
            $("body .warnBox" + id + " .detail").addClass('highHeight');
        }
        $("#warnBox .warnBox" + id + " .btn-close").click(function (e) {
            callback(id);
        });
        setTimeout(function () {
            if ($("#warnBox .warnBox" + id + "")) {
                callback(id);
            }
        }, 30000);
    }, this.close = function (id) {
        $("body .box.warnBox" + id + "").remove();
        if (!$("#warnBox").children().length) {
            $("#warnBox").hide();
        } else {
            $("#warnBox").show();
        }
    };
}]).controller("TaskListController", ["$scope", "Task", "$location", "$$$I18N", "UserRole", "$rootScope", "warnBox", function ($scope, task, $location, $$$I18N, UserRole, $rootScope, warnBox) {
    $scope.toggleTaskList = function () {
        $("body").toggleClass("show_prog");
    };
    var user = void 0;
    var taskTimer = null;
    $scope.$on("NOAUTH", function () {
        user = null;
        clearTimeout(taskTimer);
    });
    $scope.$on("STOPLOG", function () {
        clearTimeout(taskTimer);
    });
    $scope.$on("AUTHED", function () {
        user = UserRole.currentUser;
        schedule();
    });
    if (UserRole.currentUser) {
        user = UserRole.currentUser;
        schedule();
    }
    $scope.rows = [];
    var data = {};
    $scope.$on("instanceIDS", function ($event, ids) {
        data.instances = ids;
    });
    $scope.$on("imageIDS", function ($event, ids) {
        data.images = ids;
    });
    $scope.$on("clientIDS", function ($event, ids) {
        data.clients = ids;
    });
    $scope.$on('modeIDS', function ($event, ids) {
        data.modes = ids;
    });
    $scope.$on('nodes', function ($event, ids) {
        data.nodes = ids;
    });
    $scope.$on('manageNetworkIDS', function ($event, ids) {
        data.manage_networks = ids;
    });
    $scope.$on('personpools', function ($event, ids) {
        data.personpools = ids;
    });
    var lists = [],
        flag = false;
    function schedule() {
        var postData = data && Object.keys(data).map(function (key) {
            // if(key !== "clients"){
            return {
                key: key,
                ids: data[key]
            };
            // }
            // else{
            //     return {
            //         key: key,
            //         ids: []
            //     };    
            // }
        });
        task.post(postData, function (res) {
            $scope.rows = res.results.tasks.filter(function (item) {
                return user.real_name === item.user;
            });

            Object.keys(res.results).forEach(function (key) {
                if (key !== "tasks") {
                    $scope.$root && $scope.$root.$broadcast(key + "RowsUpdate", res.results[key]);
                }
            });
            for (var i in res.results.notifies) {
                var item = res.results.notifies[i],
                    color = '#004d60',
                    content;
                if (lists[item.id] == undefined) {
                    lists[item.id] = item;
                    if (item.waringtype === 0) {
                        warnBox.warn(item.content, item.id, function (ID) {
                            warnBox.close(ID);
                            task.put({ notify_id: ID }, function (res) {});
                        });
                    } else {
                        if (item.waringtype === 1) {
                            color = "#004d60";
                            content = $$$I18N.get(item.name) + ' (' + item.target + ')';
                        } else {
                            color = "#C46A69";
                            content = $$$I18N.get(item.name) + ' (' + item.target + ')';
                        }
                        $.bigBox({
                            title: $$$I18N.get('waringtype' + item.waringtype),
                            content: content,
                            color: color,
                            timeout: 3000
                        }, function () {
                            task.put({ notify_id: item.id }, function (res) {});
                        });
                    }
                }
            }
            taskTimer = setTimeout(schedule, 3000);
        }, function () {
            taskTimer = setTimeout(schedule, 10000);
        });
        for (var k in data) {
            data[k] = undefined;
            delete data[k];
        }
    }
}]).controller("pageHeaderController", ["$scope", "UserAuth", "Task", "$location", "$$$I18N", "UserRole", "desktopHelpBox", function ($scope, Auth, task, $location, $$$I18N, UserRole, desktopHelpBox) {
    $scope.logout = function () {
        Auth.logout();
        desktopHelpBox.close();
    };
    $scope.$on("NOAUTH", function () {
        desktopHelpBox.close();
    });
    $scope.$on("DMS", function (e, dms) {
        $scope.dmsURL = dms;
        $$$storage.setSessionStorage('DMS', dms);
    });
    $scope.dmsURL = $$$storage.getSessionStorage('DMS') || 'nodms';
}]).controller("LogoController", ["$scope", "settings", "$Domain", "$$$version", function ($scope, settings, $Domain, $$$version) {
    $scope.domain = $Domain;
    $scope.version = $$$version;
    $scope.languages = settings.languages;
    $scope.currentLang = settings.currentLang;
}]).controller("SkinController", ["$scope", function ($scope) {
    $scope.changeSkin = function (theme) {
        $scope.$root.$broadcast("changeSkin", theme);
    };
}]).controller("userLoginInfoController", ["$scope", "UserRole", function ($scope, Role) {
    $scope.loginUser = Role.currentUser;
    $scope.$on("AUTHED", function (name, userInfo) {
        $scope.loginUser = userInfo;
    });
    $scope.$on("NOAUTH", function () {
        $scope.loginUser = null;
    });
}]).controller("AlarmController", ["$scope", "$modal", "SystemAlarm", "AlarmHistory", function ($scope, $modal, alarm, AlarmHistory) {
    $scope.isOpen = false;
    $scope.open = function () {
        $scope.isOpen = true;
    };
    $scope.close = function (e) {
        if (e) e.stopPropagation();
        $scope.isOpen = false;
    };
    // function findDif(oldArray, newArray, difAttr){
    //     if(newArray.length){
    //         var length = oldArray.length>=newArray.length?oldArray.length:newArray.length;
    //         var difs = [];
    //         for(var i=0; i<length; i++){
    //             if(newArray[i]){
    //                 var different = oldArray.filter(function(item){ return item[difAttr] == newArray[i][difAttr] })[0];
    //                 if(!different){ difs.push(newArray[i]) };
    //             }
    //         }
    //         return difs;
    //     }else{ return []; }
    // };

    // var oldAlarms = [];
    $scope.$on("alarmsRowsUpdate", function ($event, data) {
        $scope.alarms = data;
        // if(!$scope.isOpen){
        //     var unreads = [];
        //     data.forEach(function(item){
        //         if(!item.is_read){ unreads.push(item) }
        //     })
        //     if(unreads.length){
        //         $scope.open();
        //         setTimeout(function(){
        //             $scope.close();
        //         }, 30000)
        //     }
        // }

        // var difs = findDif(oldAlarms, data, 'id');
        // if(!$scope.isOpen && difs.length){
        //     oldAlarms = data;
        //     $scope.open();
        //     setTimeout(function(){
        //         $scope.close();
        //     }, 30000)
        // }
    });
    $scope.delete = function () {
        AlarmHistory.setRead({ ids: $scope.alarms.map(function (item) {
                return item.id;
            }) }, function (res) {
            $scope.alarms = [];
            $scope.isOpen = false;
        });
    };
}]).filter("interfaceFilter", [function () {
    return function (data, idx, nets) {
        var invalidArr = [];
        nets.forEach(function (n, i) {
            if (i !== idx && n._data_dev && n._data_dev._dev) {
                invalidArr.push(n._data_dev._dev);
            }
        });
        return data.filter(function (d) {
            if (invalidArr.indexOf(d._dev) === -1) {
                return true;
            }
            return false;
        });
    };
}]);

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.template", [])

/* 模板 */
.factory("registerTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "get", url: $Domain + "/thor/image/register" },
		update: { method: "POST", url: $Domain + "/thor/image/register" }
	});
}]).factory("Network", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/networks", null, {
		query: { method: "GET", isArray: false, params: null },
		add: { method: "POST", isArray: false },
		get: { method: "GET", url: $Domain + "/thor/network/:id", params: { id: "@id" }, isArray: false },
		alter: { method: "PUT", url: $Domain + "/thor/network/:id", params: { id: "@id" }, isArray: false },
		delete: { method: "DELETE", url: $Domain + "/thor/network/:id", params: { id: "@id" }, isArray: false },

		query_sub: { method: "GET", url: $Domain + "/thor/network/:id/subnets", params: { id: "@id" } },
		add_sub: { method: "POST", url: $Domain + "/thor/network/:id/subnets", params: { id: "@id" } },

		get_sub: { method: "GET", url: $Domain + "/thor/network/subnet/:id", params: { id: "@id" } },
		alter_sub: { method: "PUT", url: $Domain + "/thor/network/subnet/:id", params: { id: "@id" } },
		delete_sub: { method: "DELETE", url: $Domain + "/thor/network/subnet/:id", params: { id: "@id" } },
		ports: { method: "GET", url: $Domain + "/thor/network/subnet/:id/ports", params: { id: "@id" } }

	});
}]).factory('ResourcePool', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/resource", null, {
		query: { method: "GET" }
	});
}])
/* 模板镜像分发 */
.factory("manageTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "GET", url: $Domain + "/thor/image/manage/:id", params: { id: "@id" } },
		handout: { method: "POST", url: $Domain + "/thor/image/manage/:id", params: { id: "@id" } },
		delete: { method: "DELETE", url: $Domain + "/thor/image/manage/:id", params: { id: "@id" } }
	});
}])
/* 根据虚拟化类型返回可用主机列表 */
.factory("virtualHost", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/hosts_with_virtual_type", null, {
		query: { method: "GET", url: $Domain + "/thor/hosts_with_virtual_type" }
	});
}])
/* 根据主机查找可用网络 */
.factory("networkWithHost", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/list_network_with_host", null, {
		query: { method: "GET", url: $Domain + "/thor/list_network_with_host" }
	});
}]).factory("checkIP", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/check_ip", null, {
		check: { method: "GET" }
	});
}]);

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.template.teach", ["vdi.template"]).directive("downloadUrl", ['$http', function ($http) {
	return {
		restrict: "A",
		link: function link(scope, element, attrs) {
			var url_arry = JSON.parse(attrs.urls.split(","));
			url_arry.forEach(function (item) {
				$(element).append('<iframe style="width: 0; height: 0;" src="" id="' + item + '" frameborder="0"></iframe>');
			});
			$(element).click(function (e) {
				url_arry.forEach(function (item) {
					$(element).find('#' + item)[0].contentWindow.location = scope.domain + '/thor/image/download/' + item;
				});
			});
		}
	};
}]).factory("TeachTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "GET", url: $Domain + "/thor/image/1", isArray: false },
		update: { method: "POST", url: $Domain + "/thor/image/modify_template/:id", params: { id: "@id" } },
		listModes: { method: "GET", url: $Domain + "/thor/image/update_mode_instance/:id", params: { id: "@id" }, isArray: false },
		applyTemplate: { method: "POST", url: $Domain + "/thor/image/update_mode_instance/:id", params: { id: "@id" } },
		status: { method: "GET", url: $Domain + "/thor/image/status/:id", params: { id: "@id" } },
		copy: { method: "POST", url: $Domain + "/thor/image/clone_template" },
		modify: { method: "PUT", url: $Domain + "/thor/image/1", isArray: false },
		infor: { method: "GET", url: $Domain + "/thor/image/info" },
		spiceConnectInfo: { method: "GET", url: $Domain + "/compute/v1/instances/connection" },
		virtualStatus: { method: "GET", url: $Domain + "/compute/v1/instances/:id/status", params: { id: "@id" } },
		download: { method: "GET", url: $Domain + "/thor/image/download/:id", params: { id: "@id" } },
		reset: { method: "post", url: $Domain + "/thor/image/reset_template" },
		get_image_vnc_info: { method: "GET", url: $Domain + "/thor/image/get_image_vnc_info" },
		get_image_rdp_info: { method: "GET", url: $Domain + "/thor/image/get_image_rdp_info" },
		sync: { method: "post", url: $Domain + "/thor/image/bt_sync_template" },
		sync_status: { method: "GET", url: $Domain + "/thor/image/bt_sync_status" },
		bt_before_edit_template: { method: "POST", url: $Domain + "/thor/image/bt_before_edit_template" },
		bt_save_template: { method: "POST", url: $Domain + "/thor/image/bt_save_template" },
		bt_prev_save_template: { method: "POST", url: $Domain + "/thor/image/bt_prev_save_template" },
		bt_sync_retry: { method: "POST", url: $Domain + "/thor/image/bt_sync_retry" },
		bt_sync_repair: { method: "POST", url: $Domain + "/thor/image/bt_sync_repair" },
		update_tpl_tip: { method: "GET", url: $Domain + "/thor/controller/ha_storage_state" }
	});
}]).controller("vdiTemplateTeachDesktopListController", ["$scope", "$modal", "TeachTemplate", "PersonTemplate", "$route", "Admin", "TeachDesktop", "$interval", "$filter", "$$$os_types", "$Domain", "Network", "$http", "$$$I18N", "ResourcePool", "manageTemplate", "VMCommon", "networkWithHost", "virtualHost", "UserRole", function ($scope, $modal, template, tmpl, $route, admin, teachdesktop, $interval, $filter, $$$os_types, $Domain, network, $http, $$$I18N, ResourcePool, manageTemplate, vm, networkWithHost, virtualHost, UserRole) {
	// teachdesktop.query({ id : $route.current.params.id }, function(res){
	// 	console.log(787878,res.result)
	// });
	var user = UserRole.currentUser;
	$scope.domain = $Domain;
	$scope.rows = [];$scope.allrows = [];

	$scope.images = [];
	$scope.loading = true;

	$scope.currentPage = 1;
	$scope.pagesizes = [30, 20, 10];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.orders = [{ name: $$$I18N.get("按创建时间排序"), val: 'time' }, { name: $$$I18N.get("按模板名称排序"), val: 'name' }];
	$scope.order = $scope.orders[0];
	$scope.sortTem = function (val) {
		if (val == 'time') {
			$scope.rows.sort(function (a, b) {
				return a.created_at > b.created_at ? -1 : 1;
			});
		} else {
			$scope.rows.sort(function (a, b) {
				return a.name > b.name ? 1 : -1;
			});
		}
	};

	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("imageIDS", $scope.rows.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("imagesRowsUpdate", function ($event, data) {

		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
		$scope.rows = $scope.rows.filter(function (item) {
			return item.type_code === 1;
		});
		$scope.rows.forEach(function (row) {
			if ($scope.sync_mode === 'bt') {
				if (row.sync_status) {
					var syncFaildLen = row.sync_status.filter(function (item) {
						return item.status === "sync failed" || item.status === "no space left" || item.sch == 'time out';
					}).length;
					var syncDownloading = row.sync_status.filter(function (item) {
						return item.status === "downloading";
					}).length;
					if (syncFaildLen) {
						row.sync_status.syncFaild = true;
					}
					if (syncDownloading && !syncFaildLen) {
						row.sync_status.syncing = true;
					}
				}
			} else {
				if (row.sync_status) {
					var updateInfor = row.sync_status.filter(function (item) {
						return item.type === "image";
					});
					if (updateInfor.length !== 0) row.updateSize = (updateInfor[0].size / 1024 / 1024 / 1024).toFixed(2);
				}
			}
		});
		$scope.$root.$broadcast("syncTempl", $scope.rows);
		// $scope.allrows = $scope.rows;
	});

	template.query(function (res) {
		$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);

		$scope.rows.forEach(function (row) {
			var os = $$$os_types.filter(function (item) {
				return item.key === row.os_type;
			})[0];
			os && os.icon && (row.icon = os.icon);
			if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
			if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
		});
		$scope.rows.sort(function (a, b) {
			return a.created_at > b.created_at ? -1 : 1;
		});
		$scope.sync_mode = res.sync_mode;
		$scope.loading = false;
		$scope.teachNames = $scope.rows.map(function (item) {
			return item.name;
		});
		$scope.sameName = false;

		$scope.allrows = $scope.rows;
		if ($$$storage.getSessionStorage('virtual_type_T') !== 'all') $scope.rows = $scope.allrows.filter(function (item) {
			return item.virtual_type === $$$storage.getSessionStorage('virtual_type_T');
		});
	});

	$scope.select = $$$storage.getSessionStorage('virtual_type_T') || 'all';
	$scope.$watch("select", function (newvalue) {
		if (newvalue) {
			if (newvalue !== 'all') {
				$scope.rows = $scope.allrows.filter(function (item) {
					return item.virtual_type === newvalue;
				});
			} else {
				$scope.rows = $scope.allrows;
			}
			$$$storage.setSessionStorage('virtual_type_T', newvalue);
		}
	});
	var _controllerScope = $scope;
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除教学模板'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance, $q) {
				$scope.name = rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.ok = function () {
					template.delete({ id: rows.map(function (item) {
							return item.id;
						}) }, function (res) {
						template.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
					}, function (error) {
						template.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
					});
					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.shutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var rows_active = rows.filter(function (item) {
			return item.instance_status === 'running';
		});
		if (!rows_active.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("SHUTOFF_TIP"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='shutdown_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><img data-ng-if='loading' src='./img/building.gif' width='24px'><button class='btn btn-primary' data-ng-if='!loading' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance, $q) {
					$scope.name = rows_active.map(function (row) {
						return row.name;
					}).join(', ');
					$scope.ok = function () {
						$scope.loading = true;
						vm.shutdowns({ instance_ids: rows_active.map(function (item) {
								return item.instance_id;
							}) }, function (res) {
							rows.forEach(function (row) {
								_controllerScope.rows.forEach(function (item) {
									if (item.id === row.id) {
										item.instance_status = "shutdown";
									}
								});
							});
							$scope.loading = false;
						}, function (error) {
							$scope.loading = false;
						});
						$modalInstance.close();
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.syncTem = function (item) {
		$scope.loading = false;
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_sync.html",
			controller: function controller($scope, $modalInstance) {
				if (!$scope.sync_status) {
					$scope.loading = true;
				}
				$scope.name = item.name;
				$scope.$on("syncTempl", function ($event, data) {
					var thistmpl = data.filter(function (r) {
						return r.id === item.id;
					})[0];
					$scope.sync_status = thistmpl.sync_status;
					$scope.loading = false;
				});
				$scope.close = function () {
					$modalInstance.close();
				};
				$scope.Retry = function (temp) {
					var data = { image_id: temp.image, server_ip: temp.server_ip, server_id: temp.server_id, version: temp.version };
					template.bt_sync_retry(data, function (res) {}, function () {});
				};
				$scope.Repair = function (temp) {
					var data = { image_id: temp.image, server_ip: temp.server_ip, server_id: temp.server_id, version: temp.version };
					template.bt_sync_repair(data, function (res) {}, function () {});
				};
			},
			size: "lg"

		});
	};

	$scope.update = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_mode_list.html",
			controller: function controller($scope, $modalInstance) {
				$scope.modes = [];
				template.listModes({ id: item.id }, function (res) {
					$scope.modes = res.modes;
				}, function () {
					$scope.noScense = true;
				});
				$scope.ok = function () {
					template.applyTemplate({ id: item.id }, function (res) {
						/* doSTH */
						$modalInstance.close();
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}

		});
	};
	$scope.trigger = function () {
		$scope.rows.some(function (row) {
			row._selected;
		});
	};

	$scope.copy = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_copy.html",
			size: "md",
			controller: ["$scope", "$modalInstance", function ($scope, $modalInstance) {
				$scope.min_namelength = 2;$scope.max_namelength = 20;
				$scope.is_copy = true;
				$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
				$scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
				$scope.types = $scope.types2;
				$scope.bind_ip_type = $scope.types2[0];
				admin.query(function (res) {
					$scope.owners = res.users;
					angular.forEach($scope.owners, function (item) {
						if (item.name == user.name) {
							$scope.owner = item;
						}
					});
					if (!$scope.owner) {
						$scope.owner = $scope.users[0];
					}
				});
				$scope.type = '1';
				$scope.temCopy = false;

				$scope.temData = item;
				$scope.getVirtualHost = function (type, rbd_enabled) {
					$scope.host_loading = true;
					virtualHost.query({
						virtual_type: type,
						rbd_enabled: rbd_enabled
						// enable_gpu: type == 'hyper-v'?enable_gpu:undefined
					}, function (res) {
						$scope.host_loading = false;
						$scope.hosts = res.result;
						$scope.host = $scope.hosts[0];
						$scope.getNetwork($scope.host);
					}, function () {});
				};
				$scope.getVirtualHost(item.virtual_type, item.rbd_enabled);

				// function getIps(subnet_id, _scope){
				// 	if(subnet_id)
				// 		network.ports({ id: subnet_id },function(res){
				// 			if(res.unused_ips.length){
				// 				_scope.band_ips = res.unused_ips;
				// 			}
				// 			else{
				// 				_scope.band_ips = ["无可用IP"];
				// 			}
				// 			_scope.bind_ip_loading = false;
				// 		})
				// };
				$scope.switchIps = function (subnet, _scope) {
					// _scope.bind_ip_loading = true;
					if (subnet) {
						// getIps(subnet.id, _scope);
						_scope.types = _scope.types2;
						_scope.bind_ip_type = _scope.types2[0];
					} else {
						_scope.types = _scope.types1;
						_scope.band_ips = [];
						_scope.bind_ip_type = _scope.types1[0];
						// _scope.bind_ip_loading = false;
					}
				};
				function getSubnets(Network, _scope) {
					if (Network.subnets.length) {
						$scope.network_loading = true;
						// $scope.bind_ip_loading = true;
						network.query_sub({ id: Network.id }, function (res) {
							_scope.subnets = res.result;
							_scope.subnet = _scope.subnets[0];
							_scope.switchIps(_scope.subnet, _scope);
							$scope.network_loading = false;
						});
					} else {
						_scope.subnets = [];
						_scope.subnet = null;
						_scope.switchIps(_scope.subnet, _scope);
					}
				};
				$scope.getNetwork = function (host) {
					if (host) {
						networkWithHost.query({ host: host.host_uuid }, function (res) {
							// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
							$scope.networks = res.result;
							$scope.network = $scope.networks[0];
							getSubnets($scope.network, $scope);
						}, function () {});
					}
				};

				$scope.switchSubnet = function (val, _scope) {
					getSubnets(val, _scope);
				};
				$scope.bind_ip = { value: null };
				$scope.ok = function () {
					var bindIP = this.bind_ip.value;
					// var unUseIP = this.band_ips.filter(function(item){ return item===bindIP });
					// if(this.bind_ip_type.value === 'static' && bindIP === '无可用IP'){
					// 	$.bigBox({
					// 		title	: $$$I18N.get("INFOR_TIP"),
					// 		content	: $$$I18N.get("hasStaticIP_TIP"),
					// 		timeout	: 6000
					// 	});
					// }else if(this.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){
					// 	$.bigBox({
					// 		title	: $$$I18N.get("INFOR_TIP"),
					// 		content	: $$$I18N.get("USEDIP"),
					// 		timeout	: 6000
					// 	});
					// }else{
					$scope.temCopy = true;
					var _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;
					template.copy({
						name: this.name,
						description: this.description,
						image_id: item.id,
						type_code: this.type,
						owner: $scope.owner.id,
						network: this.network.id,
						subnet: this.subnet ? this.subnet.id : '',
						band_ip: _ip,
						band_type: this.bind_ip_type.value,
						host_uuid: this.host.host_uuid
						// enable_gpu: item.virtual_type == 'hyper-v'?this.enable_gpu:undefined
					}, function (res) {
						template.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
						$modalInstance.close();
					}, function () {
						$scope.temCopy = false;
					});
					// }
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}]
		});
	};

	$scope.sync = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='SYNC_TEM'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='SYNC_TEM_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					template.sync({ image_id: item.id }, function (res) {}, function (error) {});

					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	$scope.undoSync = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='UNDO_SYNC_TEM'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='TEM_UNDOSYNC' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					template.bt_before_edit_template({ image_id: item.id }, function (res) {}, function (error) {});

					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.modify = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_modify.html",
			controller: function controller($scope, $modalInstance) {
				$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
				$scope.types = $scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
				$scope.virtual_type = item.virtual_type;
				$scope.disabled_gpu = item.disabled_gpu;
				$scope.data = { vcpus: 1, ram: 1.5, system_alloc_disk: 10, bind_ip_type: $scope.types2[1] };
				var oldData = {};
				function getSubnets(Network, subnet_id, flag) {
					if (Network.subnets.length) {
						$scope.network_loading = true;
						network.query_sub({ id: Network.id }, function (res) {
							$scope.data.subnets = res.result;
							if (flag) {
								oldData.subnets = $scope.data.subnets;
								oldData.subnet = $scope.data.subnet = $scope.data.subnets.filter(function (data) {
									return data.id === subnet_id;
								})[0];
							} else {
								$scope.data.subnet = $scope.data.subnets[0];
								if ($scope.data.subnet) getIps($scope.data.subnet.id, $scope.cur_imgInfor.nets.ip_address, false);else $scope.data.band_ips = [];
							}
							$scope.network_loading = false;
						});
					} else {
						$scope.data.subnets = [];
						$scope.data.subnet = null;
						$scope.switchIps($scope.data.subnet);
					}
				};
				function getIps(subnet_id, curr_ip, flag) {
					if (subnet_id) {
						// $scope.bind_ip_loading = true;
						$scope.types = $scope.types2;
						if (flag) {
							oldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];
							oldData.band_ips = $scope.data.band_ips;
							oldData.band_ip = $scope.data.band_ip = curr_ip;
						} else {
							$scope.data.bind_ip_type = $scope.types[0];
							$scope.data.band_ip = null;
						}
						// network.ports({ id: subnet_id },function(res){
						// 	if(res.unused_ips.length){
						// 		$scope.data.band_ips = res.unused_ips;
						// 	}
						// 	else{
						// 		$scope.data.band_ips = ["无可用IP"];
						// 	}

						// 	if(subnet_id===$scope.cur_imgInfor.nets[0].subnet_id){
						// 		$scope.data.band_ips.push(curr_ip);
						// 	}
						// 	if(flag){
						// 		oldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];
						// 		oldData.band_ips = $scope.data.band_ips;
						// 		oldData.band_ip = $scope.data.band_ip = curr_ip;
						// 	}
						// 	else{
						// 		$scope.data.bind_ip_type = $scope.types[0];
						// 		$scope.data.band_ip = null;
						// 	}
						// 	$scope.bind_ip_loading = false;
						// });
					} else {
						$scope.types = $scope.types1;
						oldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[0];
					}
				};
				$scope.switchSubnet = function (val) {
					getSubnets(val, $scope.cur_imgInfor.nets.network_id, false);
				};
				$scope.switchIps = function (subnet) {
					if (subnet) {
						getIps(subnet.id, $scope.cur_imgInfor.nets.ip_address, false);
					} else {
						$scope.types = $scope.types1;
						$scope.data.bind_ip_type = $scope.types[0];
						$scope.data.band_ips = [];
						$scope.data.band_ip = null;
					}
				};
				$scope.addbtndisk = function () {
					if (!$scope.data.data_alloc_disk) {
						$scope.data.data_alloc_disk = 1;
						return false;
					}
					if (!$scope.data.data_alloc_disk_2) {
						$scope.data.data_alloc_disk_2 = 1;
						return false;
					}
				};
				$scope.minusbtndisk = function () {
					if ($scope.old_data_alloc_disk && !$scope.old_data_alloc_disk_2) {
						if ($scope.data.data_alloc_disk_2) {
							$scope.data.data_alloc_disk_2 = 0;
							return false;
						}
					} else {
						if ($scope.data.data_alloc_disk_2) {
							$scope.data.data_alloc_disk_2 = 0;
							return false;
						}
						if ($scope.data.data_alloc_disk) {
							$scope.data.data_alloc_disk = 0;
							return false;
						}
					}
				};
				template.infor({ image_id: item.id }, function (templateInfor) {

					$scope.cur_imgInfor = templateInfor;
					oldData.name = $scope.data.name = templateInfor.name;
					oldData.description = $scope.data.description = templateInfor.description;
					getIps(templateInfor.nets[0].subnet_id, templateInfor.nets[0].ip_address, true);
					network.query(function (data) {
						$scope.networks = data.networks.filter(function (item) {
							return item.subnets.length !== 0;
						});
						$scope.networks = data.networks;
						oldData.network = $scope.data.network = $scope.networks.filter(function (data) {
							return data.id === templateInfor.nets[0].network_id;
						})[0];
						getSubnets($scope.data.network, templateInfor.nets[0].subnet_id, true);
					});
					oldData.enable_gpu = $scope.data.enable_gpu = templateInfor.enable_gpu;
					oldData.vcpus = $scope.data.vcpus = templateInfor.vcpus;
					oldData.ram = $scope.data.ram = templateInfor.ram / 1024;
					oldData.system_alloc_disk = $scope.data.system_alloc_disk = templateInfor.system_alloc_disk;
					oldData.data_alloc_disk = $scope.data.data_alloc_disk = templateInfor.data_alloc_disk;
					oldData.data_alloc_disk_2 = $scope.data.data_alloc_disk_2 = templateInfor.data_alloc_disk_2;
					$scope.old_data_alloc_disk = templateInfor.data_alloc_disk;
					$scope.old_data_alloc_disk_2 = templateInfor.data_alloc_disk_2;
				});
				$scope.min_namelength = 2;$scope.max_namelength = 20;
				$scope.oldData = angular.copy($scope.data);

				$scope.isUnchanged = function () {
					return angular.equals(oldData, $scope.data);
				};
				$scope.reset = function () {
					if (oldData.bind_ip_type.value !== 'none') {
						$scope.types = $scope.types2;
					} else {
						$scope.types = $scope.types1;
					}
					$scope.data = angular.copy(oldData);
				};
				$scope.ok = function () {
					// if($scope.data.system_alloc_disk < oldData.system_alloc_disk || $scope.data.data_alloc_disk_2 < oldData.data_alloc_disk_2 || $scope.data.data_alloc_disk < oldData.data_alloc_disk){
					// 	$.bigBox({
					// 			title : $$$I18N.get("INFOR_TIP"),
					// 			content : $$$I18N.get("modifyTemTip"),
					// 			timeout : 6000
					// 		});
					// }
					// var bindIP = $scope.data.band_ip;
					//            	var unUseIP = $scope.data.band_ips.filter(function(item){ return item===bindIP });
					//            	if($scope.data.bind_ip_type.value === 'static' && bindIP === '无可用IP'){
					//            		$.bigBox({
					//            			title	: $$$I18N.get("INFOR_TIP"),
					//            			content	: $$$I18N.get("hasStaticIP_TIP"),
					//            			timeout	: 6000
					//            		});
					//            	}else if($scope.data.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){
					//            		$.bigBox({
					//            			title	: $$$I18N.get("INFOR_TIP"),
					//            			content	: $$$I18N.get("USEDIP"),
					//            			timeout	: 6000
					//            		});
					//            	}else{
					$scope.submit_loading = true;
					template.modify({
						image_id: item.id,
						instance_id: item.instance_id,
						template_name: $scope.data.name,
						description: $scope.data.description,
						network: $scope.data.network.id,
						subnet: $scope.data.subnet ? $scope.data.subnet.id : "",
						band_ip: $scope.data.bind_ip_type.value === 'static' ? $scope.data.band_ip : undefined,
						band_type: $scope.data.bind_ip_type.value,
						vcpus: $scope.data.vcpus,
						ram: $scope.data.ram,
						enable_gpu: item.virtual_type == 'hyper-v' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,
						gpu_auto_assignment: item.virtual_type == 'kvm' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,
						system_alloc_disk: $scope.data.system_alloc_disk,
						data_alloc_disk: $scope.data.data_alloc_disk,
						data_alloc_disk_2: $scope.data.data_alloc_disk_2
					}, function (res) {
						$scope.submit_loading = false;
						template.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
						$modalInstance.close();
					}, function () {
						$scope.submit_loading = false;
					});
					// }
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}

		});
	};
	$scope.resetTemp = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重置模板'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='REST_TEMP_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					template.reset({ image_id: item.id }, function (res) {}, function (error) {});

					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.imgManage = function (IMG) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_imgManage.html",
			size: "md",
			controller: function controller($scope, $modalInstance) {
				$scope.imgType = IMG.virtual_type;
				function formLocalData(dataResource) {
					var arry = [];
					dataResource.forEach(function (item) {
						if (!arry[item.host_ip]) {
							var obj = { host_ip: item.host_ip, hostname: item.hostname, resource_pool_uuid: item.resource_pool_uuid, storages: [] };
							arry[item.host_ip] = obj;
							arry.push(obj);
						}
					});
					arry.forEach(function (item) {
						var hostArry = dataResource.filter(function (data) {
							return data.host_ip == item.host_ip;
						});
						hostArry.forEach(function (data) {
							if (!item.storages[data.storage_name]) {
								var obj = { storage_name: data.storage_name, storage_uuid: data.storage_uuid, storage_type: data.storage_type, imgs: [] };
								item.storages[data.storage_name] = obj;
								item.storages.push(obj);
							}
						});
					});
					arry.forEach(function (item) {
						item.storages.forEach(function (data) {
							var storageArry = dataResource.filter(function (d) {
								return item.host_ip == d.host_ip && d.storage_name == data.storage_name;
							});
							storageArry.forEach(function (d) {
								data.imgs.push({ image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status });
							});
						});
						item.storages.sort(function (a, b) {
							return a.storage_name > b.storage_name ? 1 : -1;
						});
					});
					return arry;
				};
				function formRemoteData(dataResource) {
					var arry = [];
					dataResource.forEach(function (item) {
						if (!arry[item.storage_name + "_remote"]) {
							var obj = { storage_name: item.storage_name, storage_uuid: item.storage_uuid, storage_type: item.storage_type, host_ip: item.host_ip, imgs: [] };
							arry[item.storage_name + "_remote"] = obj;
							arry.push(obj);
						}
					});
					arry.forEach(function (item) {
						var imgArry = dataResource.filter(function (d) {
							return item.storage_name == d.storage_name;
						});
						imgArry.forEach(function (d) {
							item.imgs.push({ image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status });
						});
					});
					return arry;
				};
				function getLocal(resource_pool_uuid) {
					$scope.local_loading = true;
					manageTemplate.query({ id: IMG.id, storage_type: 'local', resource_pool_uuid: resource_pool_uuid }, function (res) {
						$scope.local_loading = false;
						$scope.locals = formLocalData(res.result.sort(function (a, b) {
							return a.image_type > b.image_type ? -1 : 1;
						}));
					}, function (err) {
						$scope.local_loading = false;
					});
				};
				function getRemote() {
					$scope.remote_loading = true;
					manageTemplate.query({ id: IMG.id, storage_type: 'remote' }, function (res) {
						console.log(res.result);
						$scope.remote_loading = false;
						$scope.remotes = formRemoteData(res.result.sort(function (a, b) {
							return a.image_type > b.image_type ? -1 : 1;
						}));
					}, function (err) {
						$scope.remote_loading = false;
					});
				};
				var new_pool = {};
				getRemote();
				ResourcePool.query(function (res) {
					$scope.pools = res.result.filter(function (p) {
						return p.type == IMG.virtual_type;
					});
					new_pool = $scope.pool = $scope.pools[0];
					getLocal($scope.pool.uuid);
				});

				$scope.getlocalImages = function (pool) {
					new_pool = pool;
					getLocal(pool.uuid);
				};
				$scope.$on("syncTempl", function ($event, data) {
					var updateVolume = data.filter(function (item) {
						return item.id == IMG.id;
					})[0].volume;
					if (updateVolume.length !== 0) {
						updateVolume.forEach(function (volume) {
							if (volume.storage_type == 'local') {
								$scope.locals && $scope.locals.forEach(function (local) {
									local.storages.forEach(function (storage) {
										storage.imgs.forEach(function (img) {
											if (img.volume_uuid == volume.volume_uuid) {
												img.volume_status = volume.volume_status;
												if (volume.volume_status == 'available') {
													img.has_image = true;
												}
												if (volume.volume_status == 'deleted') {
													img.has_image = false;
												}
											}
										});
									});
								});
							} else {
								$scope.remotes && $scope.remotes.forEach(function (remote) {
									remote.imgs.forEach(function (img) {
										if (img.volume_uuid == volume.volume_uuid) {
											img.volume_status = volume.volume_status;
											if (volume.volume_status == 'available') {
												img.has_image = true;
											}
											if (volume.volume_status == 'deleted') {
												img.has_image = false;
											}
										}
									});
								});
							}
						});
					}
				});
				$scope.sendImg = function (storage_type, resource_pool_uuid, image_type, image_uuid, storage_uuid, img, pool) {
					img.volume_status = 'sending';
					manageTemplate.handout({
						id: IMG.id,
						resource_pool_uuid: storage_type == 'local' ? resource_pool_uuid : undefined,
						image_type: image_type,
						image_uuid: image_uuid,
						storage_uuid: storage_uuid,
						storage_type: storage_type
					}, function (res) {
						if (storage_type == 'local') {
							manageTemplate.query({ id: IMG.id, storage_type: 'local', resource_pool_uuid: pool.uuid }, function (res) {
								var newData = formLocalData(res.result.sort(function (a, b) {
									return a.image_type > b.image_type ? -1 : 1;
								}));
								$scope.locals.splice(0, $scope.locals.length);
								Array.prototype.push.apply($scope.locals, newData);
							});
						} else {
							manageTemplate.query({ id: IMG.id, storage_type: 'remote' }, function (res) {
								var newData = formRemoteData(res.result.sort(function (a, b) {
									return a.image_type > b.image_type ? -1 : 1;
								}));
								$scope.remotes.splice(0, $scope.remotes.length);
								Array.prototype.push.apply($scope.remotes, newData);
							});
						}
					}, function () {
						// img.status = 'sended failed';
					});
				};
				$scope.deleteImg = function (storage_type, volume_uuid, img, storage_uuid, pool) {
					if (!img.has_instance) {
						img.volume_status = 'deleting';
						manageTemplate.delete({
							storage_type: storage_type,
							id: IMG.id,
							volume_uuid: volume_uuid,
							image_uuid: img.image_uuid,
							storage_uuid: storage_uuid
						}, function (res) {}, function () {
							img.volume_status = 'delete failed';
						});
					}
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}

		});
	};
	$scope.detail = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_detail.html",
			size: "md",
			controller: function controller($scope, $modalInstance) {
				template.infor({ image_id: item.id }, function (infor) {
					$scope.data = infor;
					function formData(obj) {
						obj.imgs = [];
						for (var i in obj) {
							if (i !== 'imgs') {
								var img = {};
								img.location = i;
								img.volumeId = obj[i];
								obj.imgs.push(img);
							}
						}
					};
					for (var i in $scope.data.inst_volumes) {
						formData($scope.data.inst_volumes[i]);
					};
					network.query(function (data) {
						$scope.data.network = data.networks.filter(function (data) {
							return data.id === infor.nets[0].network_id;
						})[0];
						if (infor.nets[0].subnet_id) {
							network.query_sub({ id: infor.nets[0].network_id }, function (res) {
								var subnet = res.result.filter(function (data) {
									return data.id === infor.nets[0].subnet_id;
								})[0];
								$scope.data.subnet = subnet.name + " (" + subnet.start_ip + "~" + subnet.end_ip + ")";
							});
						}
					});
				}, function () {});
				$scope.close = function () {
					$modalInstance.close();
				};
			}
		});
	};
}]).controller("addTeachTemplateDialog", ["$scope", "$modalInstance", "TeachTemplate", "HardwareTemplate", "SystemISO", "Admin", "$$$os_types", "$$$I18N", "UserRole", "Network", "virtualHost", "networkWithHost", "$rootScope", "checkIP", function ($scope, $modalInstance, teach, hardware, iso, admin, $$$os_types, $$$I18N, UserRole, network, virtualHost, networkWithHost, $root, checkIP) {
	var user = UserRole.currentUser;
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	$scope.auto_isos = [];$scope.all_isos = [];
	$scope.iso = [];
	$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
	$scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
	$scope.types = $scope.types2;
	$scope.bind_ip_type = $scope.types2[0];
	admin.query(function (res) {
		$scope.users = res.users;
		angular.forEach($scope.users, function (item) {
			if (item.name === user.name) $scope.owner = item;
		});
		if (!$scope.owner) $scope.owner = $scope.users[0];
	});
	hardware.query(function (res) {
		$scope.hardware_templates = res.result;
		$scope.template = $scope.hardware_templates[0];
	});
	iso.query(function (res) {
		$scope.all_isos = res.isos.filter(function (iso) {
			return iso.type && iso.type !== "package" && iso.type !== "other";
		});

		$scope.all_isos.forEach(function (item) {
			item.os_type = item.os_type.split(",");
		});
		$scope.isos = $scope.all_isos;
		$scope.iso = [$scope.isos[0]];
		angular.forEach($scope.isos, function (item) {
			if (item.support_auto_install == true) $scope.auto_isos.push(item);
		});
	});

	$scope.type = 'kvm';
	$scope.enable_gpu = false;
	$scope.gpu_auto_assignment = false;
	$scope.getVirtualHost = function (type) {
		var _this = this;
		$scope.host_loading = true;
		var data = {};
		data.type = type;
		if (type == 'hyper-v') {
			data.enable_gpu = _this.enable_gpu;
			_this.gpu_auto_assignment = false;
		} else {
			data.enable_gpu = _this.gpu_auto_assignment;
			_this.enable_gpu = false;
		}
		virtualHost.query(data, function (res) {
			$scope.host_loading = false;
			$scope.hosts = res.result;
			_this.host = $scope.hosts[0];
			_this.host && $scope.getNetwork(_this.host);
		}, function () {});
	};
	$scope.getVirtualHost($scope.type);

	// function getIps(subnet_id, _scope){
	// 	if(subnet_id){
	// 		network.ports({ id: subnet_id },function(res){
	// 			if(res.unused_ips.length){
	// 				_scope.band_ips = res.unused_ips;
	// 			}
	// 			else{
	// 				_scope.band_ips = ["无可用IP"];
	// 			}
	// 			_scope.bind_ip_loading = false;
	// 		})
	// 	}
	// };
	$scope.switchIps = function (subnet, _scope) {
		// _scope.bind_ip_loading = true;
		if (subnet) {
			// getIps(subnet.id, _scope);
			_scope.types = _scope.types2;
			_scope.bind_ip_type = _scope.types2[0];
		} else {
			_scope.types = _scope.types1;
			_scope.band_ips = [];
			_scope.bind_ip_type = _scope.types1[0];
			// _scope.bind_ip_loading = false;
		}
	};
	function getSubnets(Network, _scope) {
		if (Network.subnets.length) {
			$scope.network_loading = true;
			// $scope.bind_ip_loading = true;
			network.query_sub({ id: Network.id }, function (res) {
				_scope.subnets = res.result;
				_scope.subnet = _scope.subnets[0];
				_scope.switchIps(_scope.subnet, _scope);
				$scope.network_loading = false;
			});
		} else {
			_scope.subnets = [];
			_scope.subnet = null;
			_scope.switchIps(_scope.subnet, _scope);
		}
	};
	$scope.getNetwork = function (host) {
		if (host) {
			networkWithHost.query({ host: host.host_uuid }, function (res) {
				// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
				$scope.networks = res.result;
				$scope.network = $scope.networks[0];
				getSubnets($scope.network, $scope);
			}, function () {});
		}
	};
	// network.query(function(data){
	// 	$scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });
	// 	$scope.network = $scope.networks[0];
	// 	getSubnets($scope.network, $scope);
	// })
	$scope.switchSubnet = function (val, _scope) {
		getSubnets(val, _scope);
	};
	$scope.names = $scope.rows.map(function (item) {
		return item.name;
	});
	$scope.sameName = false;
	var _scope = $scope;
	$scope.install = "manualinstall";
	$scope.isOther = false;
	$scope.$on("selectStepChange", function (e, arg) {
		if (arg.index == 0) {
			arg.stepScope.$$nextSibling.error = false;
		}
	});
	$scope.$on("WizardStep_0", function (e, step, scope) {
		_scope.type = scope.type;
		scope.error = step.is_dirty;
		var flag = false;
		_scope.names.forEach(function (item) {
			if (scope.name == item) {
				flag = true;
			}
		});
		if (flag) {
			_scope.sameName = true;
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("WRONG_NAME"),
				timeout: 6000
			});
		} else {
			_scope.sameName = false;
		}
		step.done = !scope.step_pane0.$invalid && !_scope.sameName && !scope.network_loading;

		if (step.done && scope.$$childTail && scope.$$childTail.bind_ip) {
			step.showLoading = true;
			step.done = false;
			checkIP.check({ ip: scope.$$childTail.bind_ip, subnet_id: scope.subnet.id }, function (res) {
				if (!res.result) {
					$.bigBox({
						title: $$$I18N.get("INFOR_TIP"),
						content: $$$I18N.get("USEDIP"),
						timeout: 6000
					});
				} else {
					$scope.$broadcast("currentStepChange", 1);
				}
				step.showLoading = false;
			}, function (error) {
				step.showLoading = false;
			});
		}
	});
	$scope.$on("WizardStep_1", function (e, step, scope) {
		scope.error = step.is_dirty;
		if (scope.template.system_gb == 0) $.bigBox({
			title: $$$I18N.get("INFOR_TIP"),
			content: $$$I18N.get("模板系统盘不能为0"),
			timeout: 6000
		});
		step.done = !(scope.template.system_gb == 0);
	});
	$scope.$on("WizardStep_2", function (e, step, scope) {
		setTimeout(function () {
			$("[rel=popover-hover]").popover({
				trigger: "hover"
			});
		});
		_scope.install = scope.install;
		if (scope.iso != undefined && scope.iso[0] != undefined) {
			if (scope.iso[0].os_type[0] == 'other') {
				scope.$parent.system_versions = $$$os_types;
				scope.$parent.system_version1 = scope.$parent.system_versions[0];
			} else {
				var _types = [];
				scope.iso[0].os_type.forEach(function (item) {
					var _obj = {};
					_obj.key = item;
					_obj.value = item;
					_types.push(_obj);
				});
				scope.$parent.system_versions = _types;
				scope.$parent.system_version1 = _types[0];
			}
		}
		scope.error = step.is_dirty;
		step.done = scope.iso != undefined && scope.iso[0] != undefined;
	});
	var newWindow;
	var FLAG = false;
	function gotoUrl(val) {
		if (val) {
			newWindow = window.open('templateModify.html#0');
			// newWindow = window.open('js/vdi-spice/spiceModify.html#?id=0');
		}
	}
	setTimeout(function () {
		$("#finish").on('click', function () {
			gotoUrl(FLAG);
		});
	});

	$scope.$on("WizardStep_3", function (e, step, scope) {
		if (scope.step_pane3.$invalid) {
			scope.error = step.is_dirty;
			step.done = false;
		} else if (scope.userPassword && scope.userPasswordConfirm && scope.userPassword !== scope.userPasswordConfirm) {
			step.done = false;
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("两次输入密码不一致"),
				timeout: 6000
			});
		} else step.done = true;
		FLAG = step.done;
	});
	$scope.$on("WizardDone", function (e, steps, scopes) {
		var auto_install = scopes[2].install === "autoinstall" ? true : false;
		var _ip = scopes[0].bind_ip_type.value === 'static' ? scopes[0].$$childHead.bind_ip : undefined;
		var testWin10 = /Windows10/;
		var item = {
			template_name: scopes[0].name,
			description: scopes[0].description,
			owner: scopes[0].owner.id,
			type_code: 1,
			vcpus: scopes[1].template.cpu_num,
			system_gb: scopes[1].template.system_gb,
			local_gb: scopes[1].template.local_gb,
			memory_mb: scopes[1].template.memory_mb,
			iso_path: scopes[2].iso[0].name,
			iso_id: scopes[2].iso[0].id,
			os_type: scopes[3].system_version1.key,
			instance_type: scopes[1].template.id,
			auto_install: auto_install,
			network: scopes[0].network.id,
			subnet: scopes[0].subnet ? scopes[0].subnet.id : '',
			band_ip: _ip,
			band_type: scopes[0].bind_ip_type.value,
			key: scopes[3].key,
			username: scopes[3].userName,
			userPassword: scopes[3].userPassword,
			userPasswordConfirm: scopes[3].userPasswordConfirm,
			virtual_type: scopes[0].type,
			enable_gpu: scopes[0].type == 'hyper-v' ? scopes[0].enable_gpu : undefined,
			gpu_auto_assignment: scopes[0].type == 'kvm' ? scopes[0].gpu_auto_assignment : undefined,
			firmware_type: scopes[0].type == 'kvm' && testWin10.test(scopes[3].system_version1.key) ? 'uefi' : undefined,
			host_uuid: scopes[0].host.host_uuid
		};
		function updateTem(isSuccess) {
			teach.query(function (res) {
				console.log(res, 'teachDesktop', item.virtual_type);
				$scope.allrows.splice(0, $scope.allrows.length);
				Array.prototype.push.apply($scope.allrows, res.win_images.concat(res.linux_images).concat(res.other_images));
				var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
					if ($scope.select === 'all') {
						return item;
					} else {
						return item.virtual_type === scopes[0].type;
					}
				});
				newRows.forEach(function (row) {
					var os = $$$os_types.filter(function (item) {
						return item.key === row.os_type;
					})[0];
					os && os.icon && (row.icon = os.icon);
				});
				newRows.sort(function (a, b) {
					return a.created_at > b.created_at ? -1 : 1;
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, newRows);

				// if(!auto_install){
				var template = $scope.rows.filter(function (temp) {
					return temp.name == item.template_name;
				})[0];
				if (template && isSuccess) {
					if (scopes[0].type == "hyper-v") {
						if (res.sync_mode === 'scp') {
							newWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);
							//novnc-->spice-html5 
							// newWindow.location.replace('js/vdi-spice/spiceModify_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
						} else {
							newWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);
							//novnc-->spice-html5
							// newWindow.location.replace('js/vdi-spice/spiceModifybt_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
						}
					} else {
						if (res.sync_mode === 'scp') {
							//novnc-->spice-html5
							// newWindow.location.replace('js/vdi-spice/spiceModify.html#?id=' + template.id + '&os_type' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
							// newWindow.location.reload();
							newWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name);
							newWindow.location.reload();
						} else {
							newWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name);
							//novnc-->spice-html5
							// newWindow.location.replace('js/vdi-spice/spiceModifybt.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
						}
					}
				}
				// }
			});
		};
		e.targetScope.currentStep.showLoading = true;
		$modalInstance.close();
		teach.save(item, function (res) {
			updateTem(true);
		}, function () {
			newWindow.close();updateTem();
		}).$promise.finally(function () {
			e.targetScope.currentStep.showLoading = false;
		});
	});

	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.cpu_num = 1;
}]).controller("registerTeachTemplateDialog", ["$scope", "$modalInstance", "Admin", "registerTemplate", "TeachTemplate", "$$$os_types", "UserRole", "Network", "virtualHost", "networkWithHost", "$$$I18N", function ($scope, $modalInstance, admin, registerTemplate, teach, $$$os_types, UserRole, network, virtualHost, networkWithHost, $$$I18N) {
	var user = UserRole.currentUser;
	$scope.min_namelength = 2;
	$scope.max_namelength = 20;
	$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	$scope.type = '1';
	$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
	$scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
	$scope.types = $scope.types2;
	$scope.bind_ip_type = $scope.types2[0];
	admin.query(function (res) {
		$scope.users = res.users;
		angular.forEach($scope.users, function (item) {
			if (item.name === user.name) $scope.owner = item;
		});
	});
	registerTemplate.query(function (res) {
		$scope.sys_isos = res.system_image;
		$scope.sys_iso = res.system_image[0];
		$scope.old_data_isos = res.data_image;
		if ($scope.sys_iso) {
			$scope.getDataImgs($scope.sys_iso);
		}
	});
	$scope.filterDataISO = function (data_iso, data_iso2) {
		if (data_iso) {
			$scope.data_isos2 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso.name;
			});
		} else {
			$scope.data_isos2 = $scope.data_isos;
		}
		if (data_iso2) {
			$scope.data_isos1 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso2.name;
			});
		} else {
			$scope.data_isos1 = $scope.data_isos;
		}
	};
	$scope.getDataImgs = function (systemImg, is_init) {
		if (systemImg) {
			this.data_iso = undefined;
			this.data_iso2 = undefined;
			$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function (item) {
				return item.virtual_type == systemImg.virtual_type;
			});
			// $scope.data_iso = $scope.data_isos[0];
			// $scope.data_iso2 = $scope.data_isos[0];
			$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);
		}
	};
	$scope.getVirtualHost = function (type, rbd_enabled) {
		$scope.host_loading = true;
		virtualHost.query({
			virtual_type: type,
			rbd_enabled: rbd_enabled
			// enable_gpu: type == 'hyper-v'?enable_gpu:undefined
		}, function (res) {
			$scope.host_loading = false;
			$scope.hosts = res.result;
			$scope.host = $scope.hosts[0];
			if (res.result.length === 0) {
				var form = getRegisterTemplateForm();
				form.host.$setViewValue("");
			}
			$scope.getNetwork($scope.host);
		}, function () {
			$scope.host_loading = false;
		});
	};

	$scope.os_types = $$$os_types.filter(function (item) {
		return item.key !== "package";
	});
	$scope.os_type = $scope.os_types[0];
	// $scope.enable_gpu = false;
	$scope.bind_ip = { value: null };

	// function getIps(subnet_id, _scope){
	// 	if(subnet_id){
	// 		network.ports({ id: subnet_id },function(res){
	// 			if(res.unused_ips.length){
	// 				_scope.band_ips = res.unused_ips;
	// 			}
	// 			else{
	// 				_scope.band_ips = ["无可用IP"];
	// 			}
	// 			_scope.bind_ip_loading = false;
	// 		})
	// 	}
	// };
	$scope.switchIps = function (subnet, _scope) {
		// _scope.bind_ip_loading = true;
		if (subnet) {
			// getIps(subnet.id, _scope);
			_scope.types = _scope.types2;
			_scope.bind_ip_type = _scope.types2[0];
		} else {
			_scope.types = _scope.types1;
			_scope.band_ips = [];
			_scope.bind_ip_type = _scope.types1[0];
			// _scope.bind_ip_loading = false;
		}
	};
	function getSubnets(Network, _scope) {
		if (Network.subnets.length) {
			$scope.network_loading = true;
			// $scope.bind_ip_loading = true;
			network.query_sub({ id: Network.id }, function (res) {
				_scope.subnets = res.result;
				_scope.subnet = _scope.subnets[0];
				_scope.switchIps(_scope.subnet, _scope);
				$scope.network_loading = false;
			}, function () {
				$scope.network_loading = false;
			});
		} else {
			_scope.subnets = [];
			_scope.subnet = null;
			_scope.switchIps(_scope.subnet, _scope);
		}
	};
	$scope.getNetwork = function (host) {
		if (host) {
			networkWithHost.query({ host: host.host_uuid }, function (res) {
				// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
				$scope.networks = res.result;
				$scope.network = $scope.networks[0];
				getSubnets($scope.network, $scope);
			}, function () {});
		}
	};
	$scope.switchSubnet = function (val, _scope) {
		getSubnets(val, _scope);
	};

	$scope.ok = function () {
		var bindIP = this.bind_ip.value;
		// var unUseIP = this.band_ips.filter(function(item){ return item===bindIP });
		// if(this.bind_ip_type.value === 'static' && bindIP === '无可用IP'){
		// 	$.bigBox({
		// 		title	: $$$I18N.get("INFOR_TIP"),
		// 		content	: $$$I18N.get("hasStaticIP_TIP"),
		// 		timeout	: 6000
		// 	});
		// }else if(this.bind_ip_type.value === 'static' && bindIP !== '无可用IP' && !unUseIP.length){
		// 	$.bigBox({
		// 		title	: $$$I18N.get("INFOR_TIP"),
		// 		content	: $$$I18N.get("USEDIP"),
		// 		timeout	: 6000
		// 	});
		// }else{
		$scope.submiting = true;
		$scope.afterSubmiting = false;
		var _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;
		var postData = {
			system_image_file: this.sys_iso,
			data_image_file: this.data_iso ? this.data_iso : undefined,
			data_image_file_2: this.data_iso2 ? this.data_iso2 : undefined,
			name: this.name,
			description: this.description,
			type_code: this.type,
			os: this.os_type.key,
			is_64: this.os_type.value.indexOf("64 bit") > -1 ? true : false,
			owner: this.owner.id,
			network: this.network.id,
			subnet: this.subnet ? this.subnet.id : '',
			band_ip: _ip,
			band_type: this.bind_ip_type.value,
			host_uuid: this.host.host_uuid,
			username: this.sys_iso.virtual_type == 'hyper-v' ? this.username : undefined,
			userPassword: this.sys_iso.virtual_type == 'hyper-v' ? this.userPassword : undefined,
			userPasswordConfirm: this.sys_iso.virtual_type == 'hyper-v' ? this.userPasswordConfirm : undefined
			// enable_gpu: this.sys_iso.virtual_type == 'hyper-v'?this.enable_gpu:undefined
		};
		registerTemplate.update(postData, function (res) {
			$scope.submiting = false;
			$scope.afterSubmiting = true;
			teach.query(function (res) {
				$scope.allrows.splice(0, $scope.allrows.length);
				Array.prototype.push.apply($scope.allrows, res.win_images.concat(res.linux_images).concat(res.other_images));
				var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
					if ($scope.select === 'all') {
						return item;
					} else {
						return item.virtual_type === $scope.select;
					}
				});
				newRows.forEach(function (row) {
					var os = $$$os_types.filter(function (item) {
						return item.key === row.os_type;
					})[0];
					os && os.icon && (row.icon = os.icon);
				});
				newRows.sort(function (a, b) {
					return a.created_at > b.created_at ? -1 : 1;
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, newRows);
			});
			$modalInstance.close();
		}, function () {
			$scope.submiting = false;
			$scope.afterSubmiting = false;
		});
		// }
	};
	$scope.close = function () {
		$modalInstance.close();
	};
	function getRegisterTemplateForm() {
		var child = $scope.$$childHead;
		var form = null;
		while (child && !form) {
			form = child.registerTemplate;
			child = child.$$nextSibling;
		}
		return form;
	}
}]);

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.template.person", ["vdi.template"]).factory("PersonTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "GET", url: $Domain + "/thor/image/2", isArray: false },
		update: { method: "POST", url: $Domain + "/thor/image/modify_template/:id", params: { id: "@id" } },
		listModes: { method: "GET", url: $Domain + "/thor/image/update_mode_instance/:id", params: { id: "@id" }, isArray: false },
		applyTemplate: { method: "POST", url: $Domain + "/thor/image/update_mode_instance/:id", params: { id: "@id" } },
		status: { method: "GET", url: $Domain + "/thor/image/status/:id", params: { id: "@id" } },
		copy: { method: "POST", url: $Domain + "/thor/image/clone_template" },
		modify: { method: "PUT", url: $Domain + "/thor/image/2", isArray: false },
		download: { method: "GET", url: $Domain + "/thor/image/download/:id", params: { id: "@id" } },
		reset: { method: "post", url: $Domain + "/thor/image/reset_template" },
		get_image_vnc_info: { method: "GET", url: $Domain + "/thor/image/get_image_vnc_info" },
		get_image_rdp_info: { method: "GET", url: $Domain + "/thor/image/get_image_rdp_info" },
		update_tpl_tip: { method: "GET", url: $Domain + "/thor/controller/ha_storage_state" }
	});
}]).controller("vdiTemplatePresonalDesktopListController", ["$scope", "$modal", "TeachTemplate", "PersonTemplate", "Admin", "$interval", "$filter", "$$$os_types", "$Domain", "Network", "$$$I18N", "ResourcePool", "manageTemplate", "VMCommon", "networkWithHost", "virtualHost", "UserRole", function ($scope, $modal, template, tmpl, admin, $interval, $filter, $$$os_types, $Domain, network, $$$I18N, ResourcePool, manageTemplate, vm, networkWithHost, virtualHost, UserRole) {
	$scope.domain = $Domain;
	$scope.rows = [];$scope.allrows = [];
	var _controllerScope = $scope;
	$scope.loading = true;
	var user = UserRole.currentUser;
	$scope.currentPage = 1;
	$scope.pagesizes = [30, 20, 10];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.orders = [{ name: $$$I18N.get("按创建时间排序"), val: 'time' }, { name: $$$I18N.get("按模板名称排序"), val: 'name' }];
	$scope.order = $scope.orders[0];
	$scope.sortTem = function (val) {
		if (val == 'time') {
			$scope.rows.sort(function (a, b) {
				return a.created_at > b.created_at ? -1 : 1;
			});
		} else {
			$scope.rows.sort(function (a, b) {
				return a.name > b.name ? 1 : -1;
			});
		}
	};

	$interval(function () {
		$scope.$root && $scope.$root.$broadcast("imageIDS", $scope.rows && $scope.rows.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("imagesRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows && $scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
		$scope.rows = $scope.rows.filter(function (item) {
			return item.type_code === 2;
		});
		$scope.rows.forEach(function (row) {
			if (row.sync_status) {
				var updateInfor = row.sync_status.filter(function (item) {
					return item.type === "image";
				});
				if (updateInfor.length !== 0) row.updateSize = (updateInfor[0].size / 1024 / 1024 / 1024).toFixed(2);
			}
		});
		$scope.$root.$broadcast("syncTempl", $scope.rows);
	});

	tmpl.query(function (res) {
		$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);
		$scope.rows.forEach(function (row) {
			var os = $$$os_types.filter(function (item) {
				return item.key === row.os_type;
			})[0];
			os && os.icon && (row.icon = os.icon);
			if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
			if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
		});
		$scope.rows.sort(function (a, b) {
			return a.created_at > b.created_at ? -1 : 1;
		});
		$scope.loading = false;
		$scope.personalNames = $scope.rows.map(function (item) {
			return item.name;
		});
		$scope.sameName = false;

		$scope.allrows = $scope.rows;
		if ($$$storage.getSessionStorage('virtual_type_P') !== 'all') $scope.rows = $scope.allrows.filter(function (item) {
			return item.virtual_type === $$$storage.getSessionStorage('virtual_type_P');
		});
	});

	$scope.select = $$$storage.getSessionStorage('virtual_type_P') || 'all';
	$scope.$watch("select", function (newvalue) {
		if (newvalue) {
			if (newvalue !== 'all') {
				$scope.rows = $scope.allrows.filter(function (item) {
					return item.virtual_type === newvalue;
				});
			} else {
				$scope.rows = $scope.allrows;
			}
			$$$storage.setSessionStorage('virtual_type_P', newvalue);
		}
	});

	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除个人模板'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_P' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance, $q) {
				$scope.name = rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.ok = function () {
					tmpl.delete({ id: rows.map(function (item) {
							return item.id;
						}) }, function (res) {
						tmpl.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
					}, function (error) {
						tmpl.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
					});

					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.shutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var rows_active = rows.filter(function (item) {
			return item.instance_status === 'running';
		});
		if (!rows_active.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("SHUTOFF_TIP"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='shutdown_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><img data-ng-if='loading' src='./img/building.gif' width='24px'><button class='btn btn-primary' data-ng-if='!loading' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance, $q) {
					$scope.name = rows_active.map(function (row) {
						return row.name;
					}).join(', ');
					$scope.ok = function () {
						$scope.loading = true;
						vm.shutdowns({ instance_ids: rows_active.map(function (item) {
								return item.instance_id;
							}) }, function (res) {
							rows.forEach(function (row) {
								_controllerScope.rows.forEach(function (item) {
									if (item.id === row.id) {
										item.instance_status = "shutdown";
									}
								});
							});
							$scope.loading = false;
						}, function (error) {
							$scope.loading = false;
						});
						$modalInstance.close();
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.copy = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_copy.html",
			size: "md",
			controller: ["$scope", "$modalInstance", function ($scope, $modalInstance) {
				$scope.min_namelength = 2;$scope.max_namelength = 20;
				$scope.is_copy = true;
				$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
				$scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
				$scope.types = $scope.types2;
				$scope.bind_ip_type = $scope.types2[0];
				admin.query(function (res) {
					$scope.owners = res.users;
					angular.forEach($scope.owners, function (item) {
						if (item.name == user.name) {
							$scope.owner = item;
						}
					});
					if (!$scope.owner) {
						$scope.owner = $scope.users[0];
					}
				});
				$scope.type = '2';
				$scope.temCopy = false;

				$scope.temData = item;
				$scope.getVirtualHost = function (type, rbd_enabled) {
					$scope.host_loading = true;
					virtualHost.query({
						virtual_type: type,
						rbd_enabled: rbd_enabled
						// enable_gpu: type == 'hyper-v'?enable_gpu:undefined
					}, function (res) {
						$scope.host_loading = false;
						$scope.hosts = res.result;
						$scope.host = $scope.hosts[0];
						$scope.getNetwork($scope.host);
					}, function () {});
				};
				$scope.getVirtualHost(item.virtual_type, item.rbd_enabled);

				// function getIps(subnet_id, _scope){
				// 	if(subnet_id)
				// 		network.ports({ id: subnet_id },function(res){
				// 			_scope.band_ips = res.unused_ips;
				// 			_scope.bind_ip = _scope.band_ips[0];
				// 			_scope.bind_ip_loading = false;
				// 		})
				// };
				$scope.switchIps = function (subnet, _scope) {
					// _scope.bind_ip_loading = true;
					if (subnet) {
						// getIps(subnet.id, _scope);
						_scope.types = _scope.types2;
						_scope.bind_ip_type = _scope.types2[0];
					} else {
						_scope.types = _scope.types1;
						_scope.band_ips = [];
						_scope.bind_ip_type = _scope.types1[0];
						// _scope.bind_ip_loading = false;
					}
				};
				function getSubnets(Network, _scope) {
					if (Network.subnets.length) {
						$scope.network_loading = true;
						// $scope.bind_ip_loading = true;
						network.query_sub({ id: Network.id }, function (res) {
							_scope.subnets = res.result;
							_scope.subnet = _scope.subnets[0];
							_scope.switchIps(_scope.subnet, _scope);
							$scope.network_loading = false;
						});
					} else {
						_scope.subnets = [];
						_scope.subnet = null;
						_scope.switchIps(_scope.subnet, _scope);
					}
				};
				$scope.getNetwork = function (host) {
					if (host) {
						networkWithHost.query({ host: host.host_uuid }, function (res) {
							// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
							$scope.networks = res.result;
							$scope.network = $scope.networks[0];
							getSubnets($scope.network, $scope);
						}, function () {});
					}
				};
				$scope.switchSubnet = function (val, _scope) {
					getSubnets(val, _scope);
				};
				$scope.ok = function () {
					$scope.temCopy = true;
					var _ip = this.bind_ip_type.value === 'static' ? this.bind_ip.value : undefined;
					tmpl.copy({
						name: this.name,
						description: this.description,
						image_id: item.id,
						type_code: this.type,
						owner: $scope.owner.id,
						network: this.network.id,
						subnet: this.subnet ? this.subnet.id : "",
						band_ip: _ip,
						band_type: this.bind_ip_type.value,
						host_uuid: this.host.host_uuid
						// enable_gpu: item.virtual_type == 'hyper-v'?this.enable_gpu:undefined
					}, function (res) {
						tmpl.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
						$modalInstance.close();
					}, function () {
						$scope.temCopy = false;
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}]
		});
	};
	$scope.modify = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_modify.html",
			controller: function controller($scope, $modalInstance) {
				$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
				$scope.types = $scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
				$scope.virtual_type = item.virtual_type;
				$scope.disabled_gpu = item.disabled_gpu;
				$scope.data = { vcpus: 1, ram: 1.5, system_alloc_disk: 10, bind_ip_type: $scope.types2[1] };
				var oldData = {};
				function getSubnets(Network, subnet_id, flag) {
					if (Network.subnets.length) {
						$scope.network_loading = true;
						network.query_sub({ id: Network.id }, function (res) {
							$scope.data.subnets = res.result;
							if (flag) {
								oldData.subnets = $scope.data.subnets;
								oldData.subnet = $scope.data.subnet = $scope.data.subnets.filter(function (data) {
									return data.id === subnet_id;
								})[0];
							} else {
								$scope.data.subnet = $scope.data.subnets[0];
								if ($scope.data.subnet) getIps($scope.data.subnet.id, $scope.cur_imgInfor.nets.ip_address, false);else $scope.data.band_ips = [];
							}
							$scope.network_loading = false;
						});
					} else {
						$scope.data.subnets = [];
						$scope.data.subnet = null;
						$scope.switchIps($scope.data.subnet);
					}
				};
				function getIps(subnet_id, curr_ip, flag) {
					if (subnet_id) {
						$scope.types = $scope.types2;
						if (flag) {
							oldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[1];
							oldData.band_ips = $scope.data.band_ips;
							oldData.band_ip = $scope.data.band_ip = curr_ip;
						} else {
							$scope.data.bind_ip_type = $scope.types[0];
							$scope.data.band_ip = null;
						}
					} else {
						$scope.types = $scope.types1;
						oldData.bind_ip_type = $scope.data.bind_ip_type = $scope.types[0];
					}
				};
				$scope.switchSubnet = function (val) {
					getSubnets(val, $scope.cur_imgInfor.nets.network_id, false);
				};
				$scope.switchIps = function (subnet) {
					if (subnet) getIps(subnet.id, $scope.cur_imgInfor.nets.ip_address, false);else {
						$scope.types = $scope.types1;
						$scope.data.bind_ip_type = $scope.types[0];
						$scope.data.band_ips = [];
						$scope.data.band_ip = null;
					}
				};
				$scope.addbtndisk = function () {
					if (!$scope.data.data_alloc_disk) {
						$scope.data.data_alloc_disk = 1;
						return false;
					}
					if (!$scope.data.data_alloc_disk_2) {
						$scope.data.data_alloc_disk_2 = 1;
						return false;
					}
				};
				$scope.minusbtndisk = function () {
					if ($scope.old_data_alloc_disk && !$scope.old_data_alloc_disk_2) {
						if ($scope.data.data_alloc_disk_2) {
							$scope.data.data_alloc_disk_2 = 0;
							return false;
						}
					} else {
						if ($scope.data.data_alloc_disk_2) {
							$scope.data.data_alloc_disk_2 = 0;
							return false;
						}
						if ($scope.data.data_alloc_disk) {
							$scope.data.data_alloc_disk = 0;
							return false;
						}
					}
				};
				template.infor({ image_id: item.id }, function (templateInfor) {
					$scope.cur_imgInfor = templateInfor;
					oldData.name = $scope.data.name = templateInfor.name;
					oldData.description = $scope.data.description = templateInfor.description;
					getIps(templateInfor.nets[0].subnet_id, templateInfor.nets[0].ip_address, true);
					network.query(function (data) {
						// $scope.networks = data.networks.filter(function(item){ return item.subnets.length!==0 });
						$scope.networks = data.networks;
						oldData.network = $scope.data.network = $scope.networks.filter(function (data) {
							return data.id === templateInfor.nets[0].network_id;
						})[0];
						getSubnets($scope.data.network, templateInfor.nets[0].subnet_id, true);
					});
					oldData.enable_gpu = $scope.data.enable_gpu = templateInfor.enable_gpu;
					oldData.vcpus = $scope.data.vcpus = templateInfor.vcpus;
					oldData.ram = $scope.data.ram = templateInfor.ram / 1024;
					oldData.system_alloc_disk = $scope.data.system_alloc_disk = templateInfor.system_alloc_disk;
					oldData.data_alloc_disk = $scope.data.data_alloc_disk = templateInfor.data_alloc_disk;
					oldData.data_alloc_disk_2 = $scope.data.data_alloc_disk_2 = templateInfor.data_alloc_disk_2;
					$scope.old_data_alloc_disk = templateInfor.data_alloc_disk;
					$scope.old_data_alloc_disk_2 = templateInfor.data_alloc_disk_2;
				});
				$scope.min_namelength = 2;$scope.max_namelength = 20;
				$scope.oldData = angular.copy($scope.data);
				$scope.isUnchanged = function () {
					return angular.equals(oldData, $scope.data);
				};
				$scope.reset = function () {
					if (oldData.bind_ip_type.value !== 'none') {
						$scope.types = $scope.types2;
					} else {
						$scope.types = $scope.types1;
					}
					$scope.data = angular.copy(oldData);
				};
				$scope.ok = function () {
					// if($scope.data.system_alloc_disk < oldData.system_alloc_disk || $scope.data.data_alloc_disk_2 < oldData.data_alloc_disk_2 || $scope.data.data_alloc_disk < oldData.data_alloc_disk){
					// 	$.bigBox({
					// 			title : $$$I18N.get("INFOR_TIP"),
					// 			content : $$$I18N.get("modifyTemTip"),
					// 			timeout : 6000
					// 		});
					// }
					// else{
					$scope.submit_loading = true;
					tmpl.modify({
						image_id: item.id,
						instance_id: item.instance_id,
						template_name: $scope.data.name,
						description: $scope.data.description,
						network: $scope.data.network.id,
						subnet: $scope.data.subnet ? $scope.data.subnet.id : "",
						band_ip: $scope.data.bind_ip_type.value === 'static' ? $scope.data.band_ip : undefined,
						band_type: $scope.data.bind_ip_type.value,
						vcpus: $scope.data.vcpus,
						ram: $scope.data.ram,
						enable_gpu: item.virtual_type == 'hyper-v' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,
						gpu_auto_assignment: item.virtual_type == 'kvm' && !item.disabled_gpu ? $scope.data.enable_gpu : undefined,
						system_alloc_disk: $scope.data.system_alloc_disk,
						data_alloc_disk: $scope.data.data_alloc_disk,
						data_alloc_disk_2: $scope.data.data_alloc_disk_2
					}, function (res) {
						$scope.submit_loading = false;
						tmpl.query(function (res) {
							_controllerScope.allrows = res.win_images.concat(res.linux_images).concat(res.other_images);
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
								if (_controllerScope.select === 'all') {
									return item;
								} else {
									return item.virtual_type === _controllerScope.select;
								}
							});
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
						$modalInstance.close();
					}, function () {
						$scope.submit_loading = false;
					});
					// }
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}

		});
	};
	$scope.resetTemp = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重置模板'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='REST_TEMP_TIP' ></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					tmpl.reset({ image_id: item.id }, function (res) {}, function (error) {});

					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.imgManage = function (IMG) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_imgManage.html",
			size: "md",
			controller: function controller($scope, $modalInstance) {
				$scope.imgType = IMG.virtual_type;
				function formLocalData(dataResource) {
					var arry = [];
					dataResource.forEach(function (item) {
						if (!arry[item.host_ip]) {
							var obj = { host_ip: item.host_ip, hostname: item.hostname, resource_pool_uuid: item.resource_pool_uuid, storages: [] };
							arry[item.host_ip] = obj;
							arry.push(obj);
						}
					});
					arry.forEach(function (item) {
						var hostArry = dataResource.filter(function (data) {
							return data.host_ip == item.host_ip;
						});
						hostArry.forEach(function (data) {
							if (!item.storages[data.storage_name]) {
								var obj = { storage_name: data.storage_name, storage_uuid: data.storage_uuid, storage_type: data.storage_type, imgs: [] };
								item.storages[data.storage_name] = obj;
								item.storages.push(obj);
							}
						});
					});
					arry.forEach(function (item) {
						item.storages.forEach(function (data) {
							var storageArry = dataResource.filter(function (d) {
								return item.host_ip == d.host_ip && d.storage_name == data.storage_name;
							});
							storageArry.forEach(function (d) {
								data.imgs.push({ image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status });
							});
						});
						item.storages.sort(function (a, b) {
							return a.storage_name > b.storage_name ? 1 : -1;
						});
					});
					return arry;
				};
				function formRemoteData(dataResource) {
					var arry = [];
					dataResource.forEach(function (item) {
						if (!arry[item.storage_name + "_remote"]) {
							var obj = { storage_name: item.storage_name, storage_uuid: item.storage_uuid, storage_type: item.storage_type, host_ip: item.host_ip, imgs: [] };
							arry[item.storage_name + "_remote"] = obj;
							arry.push(obj);
						}
					});
					arry.forEach(function (item) {
						var imgArry = dataResource.filter(function (d) {
							return item.storage_name == d.storage_name;
						});
						imgArry.forEach(function (d) {
							item.imgs.push({ image_uuid: d.image_uuid, image_type: d.image_type, image_type_desc: d.image_type_desc, has_image: d.has_image, has_instance: d.has_instance, volume_type: d.volume_type, volume_uuid: d.volume_uuid, volume_status: d.volume_status });
						});
					});
					return arry;
				};
				function getLocal(resource_pool_uuid) {
					$scope.local_loading = true;
					manageTemplate.query({ id: IMG.id, storage_type: 'local', resource_pool_uuid: resource_pool_uuid }, function (res) {
						$scope.local_loading = false;
						$scope.locals = formLocalData(res.result.sort(function (a, b) {
							return a.image_type > b.image_type ? -1 : 1;
						}));
					}, function (err) {
						$scope.local_loading = false;
					});
				};
				function getRemote() {
					$scope.remote_loading = true;
					manageTemplate.query({ id: IMG.id, storage_type: 'remote' }, function (res) {
						console.log(res.result);
						$scope.remote_loading = false;
						$scope.remotes = formRemoteData(res.result.sort(function (a, b) {
							return a.image_type > b.image_type ? -1 : 1;
						}));
					}, function (err) {
						$scope.remote_loading = false;
					});
				};
				var new_pool = {};
				getRemote();
				ResourcePool.query(function (res) {
					$scope.pools = res.result.filter(function (p) {
						return p.type == IMG.virtual_type;
					});
					new_pool = $scope.pool = $scope.pools[0];
					getLocal($scope.pool.uuid);
				});

				$scope.getlocalImages = function (pool) {
					new_pool = pool;
					getLocal(pool.uuid);
				};
				$scope.$on("syncTempl", function ($event, data) {
					var updateVolume = data.filter(function (item) {
						return item.id == IMG.id;
					})[0].volume;
					if (updateVolume.length !== 0) {
						updateVolume.forEach(function (volume) {
							if (volume.storage_type == 'local') {
								$scope.locals && $scope.locals.forEach(function (local) {
									local.storages.forEach(function (storage) {
										storage.imgs.forEach(function (img) {
											if (img.volume_uuid == volume.volume_uuid) {
												img.volume_status = volume.volume_status;
												if (volume.volume_status == 'available') {
													img.has_image = true;
												}
												if (volume.volume_status == 'deleted') {
													img.has_image = false;
												}
											}
										});
									});
								});
							} else {
								$scope.remotes && $scope.remotes.forEach(function (remote) {
									remote.imgs.forEach(function (img) {
										if (img.volume_uuid == volume.volume_uuid) {
											img.volume_status = volume.volume_status;
											if (volume.volume_status == 'available') {
												img.has_image = true;
											}
											if (volume.volume_status == 'deleted') {
												img.has_image = false;
											}
										}
									});
								});
							}
						});
					}
				});
				$scope.sendImg = function (storage_type, resource_pool_uuid, image_type, image_uuid, storage_uuid, img, pool) {
					img.volume_status = 'sending';
					manageTemplate.handout({
						id: IMG.id,
						resource_pool_uuid: storage_type == 'local' ? resource_pool_uuid : undefined,
						image_type: image_type,
						image_uuid: image_uuid,
						storage_uuid: storage_uuid,
						storage_type: storage_type
					}, function (res) {
						if (storage_type == 'local') {
							manageTemplate.query({ id: IMG.id, storage_type: 'local', resource_pool_uuid: pool.uuid }, function (res) {
								var newData = formLocalData(res.result.sort(function (a, b) {
									return a.image_type > b.image_type ? -1 : 1;
								}));
								$scope.locals.splice(0, $scope.locals.length);
								Array.prototype.push.apply($scope.locals, newData);
							});
						} else {
							manageTemplate.query({ id: IMG.id, storage_type: 'remote' }, function (res) {
								var newData = formRemoteData(res.result.sort(function (a, b) {
									return a.image_type > b.image_type ? -1 : 1;
								}));
								$scope.remotes.splice(0, $scope.remotes.length);
								Array.prototype.push.apply($scope.remotes, newData);
							});
						}
					}, function () {
						// img.status = 'sended failed';
					});
				};
				$scope.deleteImg = function (storage_type, volume_uuid, img, storage_uuid, pool) {
					if (!img.has_instance) {
						img.volume_status = 'deleting';
						manageTemplate.delete({
							storage_type: storage_type,
							id: IMG.id,
							volume_uuid: volume_uuid,
							image_uuid: img.image_uuid,
							storage_uuid: storage_uuid
						}, function (res) {}, function () {
							img.volume_status = 'delete failed';
						});
					}
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}

		});
	};
	$scope.detail = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/template/template_detail.html",
			size: "md",
			controller: function controller($scope, $modalInstance) {
				template.infor({ image_id: item.id }, function (infor) {
					$scope.data = infor;
					function formData(obj) {
						obj.imgs = [];
						for (var i in obj) {
							if (i !== 'imgs') {
								var img = {};
								img.location = i;
								img.volumeId = obj[i];
								obj.imgs.push(img);
							}
						}
					};
					for (var i in $scope.data.inst_volumes) {
						formData($scope.data.inst_volumes[i]);
					};
					network.query(function (data) {
						$scope.data.network = data.networks.filter(function (data) {
							return data.id === infor.nets[0].network_id;
						})[0];
						if (infor.nets[0].subnet_id) {
							network.query_sub({ id: infor.nets[0].network_id }, function (res) {
								var subnet = res.result.filter(function (data) {
									return data.id === infor.nets[0].subnet_id;
								})[0];
								$scope.data.subnet = subnet.name + " (" + subnet.start_ip + "~" + subnet.end_ip + ")";
							});
						}
					});
				}, function () {});
				$scope.close = function () {
					$modalInstance.close();
				};
			}
		});
	};
}]).controller("addPersonalTemplateDialog", ["$scope", "$modalInstance", "PersonTemplate", "HardwareTemplate", "SystemISO", "Admin", "$$$os_types", "$$$I18N", "UserRole", "Network", "virtualHost", "networkWithHost", "checkIP", function ($scope, $modalInstance, personal, hardware, iso, admin, $$$os_types, $$$I18N, UserRole, network, virtualHost, networkWithHost, checkIP) {
	var user = UserRole.currentUser;
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	$scope.auto_isos = [];$scope.all_isos = [];
	$scope.iso = [];
	$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
	$scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
	$scope.types = $scope.types2;
	$scope.bind_ip_type = $scope.types[0];
	admin.query(function (res) {
		$scope.users = res.users;
		angular.forEach($scope.users, function (item) {
			if (item.name == user.name) $scope.owner = item;
		});
		if (!$scope.owner) $scope.owner = $scope.users[0];
	});
	hardware.query(function (res) {
		$scope.hardware_templates = res.result;
		$scope.template = $scope.hardware_templates[0];
	});
	iso.query(function (res) {
		$scope.all_isos = res.isos.filter(function (iso) {
			return iso.type && iso.type !== "package" && iso.type !== "other";
		});
		$scope.all_isos.forEach(function (item) {
			item.os_type = item.os_type.split(",");
		});
		$scope.isos = $scope.all_isos;
		$scope.iso = [$scope.isos[0]];
		angular.forEach($scope.isos, function (item) {
			if (item.support_auto_install == true) $scope.auto_isos.push(item);
		});
	});

	$scope.type = 'kvm';
	$scope.enable_gpu = false;
	$scope.getVirtualHost = function (type) {
		var _this = this;
		$scope.host_loading = true;
		var data = {};
		data.type = type;
		if (type == 'hyper-v') {
			data.enable_gpu = _this.enable_gpu;
			_this.gpu_auto_assignment = false;
		} else {
			data.enable_gpu = _this.gpu_auto_assignment;
			_this.enable_gpu = false;
		}
		virtualHost.query(data, function (res) {
			$scope.host_loading = false;
			$scope.hosts = res.result;
			_this.host = $scope.hosts[0];
			_this.host && $scope.getNetwork(_this.host);
		}, function () {});
	};
	$scope.getVirtualHost($scope.type);

	// function getIps(subnet_id, _scope){
	// 	if(subnet_id){
	// 		network.ports({ id: subnet_id },function(res){
	// 			if(res.unused_ips.length){
	// 				_scope.band_ips = res.unused_ips;
	// 			}
	// 			else{
	// 				_scope.band_ips = ["无可用IP"];
	// 			}
	// 			_scope.bind_ip = _scope.band_ips[0];
	// 			_scope.bind_ip_loading = false;
	// 		})
	// 	}
	// };
	$scope.switchIps = function (subnet, _scope) {
		// _scope.bind_ip_loading = true;
		if (subnet) {
			// getIps(subnet.id, _scope);
			_scope.types = _scope.types2;
			_scope.bind_ip_type = _scope.types2[0];
		} else {
			_scope.types = _scope.types1;
			_scope.band_ips = [];
			_scope.bind_ip_type = _scope.types1[0];
			// _scope.bind_ip_loading = false;
		}
	};
	function getSubnets(Network, _scope) {
		if (Network.subnets.length) {
			$scope.network_loading = true;
			// $scope.bind_ip_loading = true;
			network.query_sub({ id: Network.id }, function (res) {
				_scope.subnets = res.result;
				_scope.subnet = _scope.subnets[0];
				_scope.switchIps(_scope.subnet, _scope);
				$scope.network_loading = false;
			});
		} else {
			_scope.subnets = [];
			_scope.subnet = null;
			_scope.switchIps(_scope.subnet, _scope);
		}
	};
	$scope.getNetwork = function (host) {
		if (host) {
			networkWithHost.query({ host: host.host_uuid }, function (res) {
				// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
				$scope.networks = res.result;
				$scope.network = $scope.networks[0];
				getSubnets($scope.network, $scope);
			}, function () {});
		}
	};
	$scope.switchSubnet = function (val, _scope) {
		getSubnets(val, _scope);
	};
	$scope.names = $scope.rows.map(function (item) {
		return item.name;
	});
	$scope.sameName = false;
	var _scope = $scope;
	$scope.install = "manualinstall";
	$scope.isOther = false;
	$scope.$on("selectStepChange", function (e, arg) {
		if (arg.index == 0) {
			arg.stepScope.$$nextSibling.error = false;
		}
	});
	$scope.$on("WizardStep_0", function (e, step, scope) {
		scope.error = step.is_dirty;
		_scope.type = scope.type;
		var flag = false;
		_scope.names.forEach(function (item) {
			if (scope.name == item) {
				flag = true;
			}
		});
		if (flag) {
			_scope.sameName = true;
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("WRONG_NAME"),
				timeout: 6000
			});
		} else {
			_scope.sameName = false;
		}
		step.done = !scope.step_pane0.$invalid && !_scope.sameName && !scope.network_loading;

		if (step.done && scope.$$childTail && scope.$$childTail.bind_ip) {
			step.showLoading = true;
			step.done = false;
			checkIP.check({ ip: scope.$$childTail.bind_ip, subnet_id: scope.subnet.id }, function (res) {
				if (!res.result) {
					$.bigBox({
						title: $$$I18N.get("INFOR_TIP"),
						content: $$$I18N.get("USEDIP"),
						timeout: 6000
					});
				} else {
					$scope.$broadcast("currentStepChange", 1);
				}
				step.showLoading = false;
			}, function (error) {
				step.showLoading = false;
			});
		}
	});
	$scope.$on("WizardStep_1", function (e, step, scope) {
		if (scope.template.system_gb == 0) $.bigBox({
			title: $$$I18N.get("INFOR_TIP"),
			content: $$$I18N.get("模板系统盘不能为0"),
			color: "#C46A69",
			icon: "fa fa-warning shake animated",
			timeout: 6000
		});
		step.done = !(scope.template.system_gb == 0);
	});
	$scope.$on("WizardStep_2", function (e, step, scope) {
		setTimeout(function () {
			$("[rel=popover-hover]").popover({
				trigger: "hover"
			});
		});
		_scope.install = scope.install;
		if (scope.iso != undefined && scope.iso[0] != undefined) {
			if (scope.iso[0].os_type[0] == 'other') {
				_scope.isOther = true;
				scope.$parent.system_versions = $$$os_types;
				scope.$parent.system_version1 = scope.$parent.system_versions[0];
			} else {
				var _types = [];
				scope.iso[0].os_type.forEach(function (item) {
					var _obj = {};
					_obj.key = item;
					_obj.value = item;
					_types.push(_obj);
				});
				scope.$parent.system_versions = _types;
				scope.$parent.system_version1 = _types[0];
			}
		}
		scope.error = step.is_dirty;
		step.done = scope.iso != undefined && scope.iso[0] != undefined;
	});
	var newWindow;
	var FLAG = false;
	function gotoUrl(val) {
		if (val) {
			newWindow = window.open('templateModify.html#0');
			// newWindow = window.open('js/vdi-spice/spiceModify.html#?id=0');
		}
	}
	setTimeout(function () {
		$("#finish").on('click', function () {
			gotoUrl(FLAG);
		});
	});

	$scope.$on("WizardStep_3", function (e, step, scope) {
		if (scope.step_pane3.$invalid) {
			scope.error = step.is_dirty;
			step.done = false;
		} else if (scope.userPassword && scope.userPasswordConfirm && scope.userPassword !== scope.userPasswordConfirm) {
			step.done = false;
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("两次输入密码不一致"),
				timeout: 6000
			});
		} else step.done = true;
		FLAG = step.done;
	});
	$scope.$on("WizardDone", function (e, steps, scopes) {
		var auto_install = scopes[2].install === "autoinstall" ? true : false;
		var _ip = scopes[0].bind_ip_type.value === 'static' ? scopes[0].$$childHead.bind_ip : undefined;
		var testWin10 = /Windows10/;
		var item = {
			template_name: scopes[0].name,
			description: scopes[0].description,
			owner: scopes[0].owner.id,
			type_code: 2,
			vcpus: scopes[1].template.cpu_num,
			system_gb: scopes[1].template.system_gb,
			local_gb: scopes[1].template.local_gb,
			memory_mb: scopes[1].template.memory_mb,
			iso_path: scopes[2].iso[0].name,
			iso_id: scopes[2].iso[0].id,
			os_type: scopes[3].system_version1.key,
			instance_type: scopes[1].template.id,
			auto_install: auto_install,
			network: scopes[0].network.id,
			subnet: scopes[0].subnet ? scopes[0].subnet.id : '',
			band_ip: _ip,
			band_type: scopes[0].bind_ip_type.value,
			key: scopes[3].key,
			username: scopes[3].userName,
			userPassword: scopes[3].userPassword,
			userPasswordConfirm: scopes[3].userPasswordConfirm,
			virtual_type: scopes[0].type,
			enable_gpu: scopes[0].type == 'hyper-v' ? scopes[0].enable_gpu : undefined,
			gpu_auto_assignment: scopes[0].type == 'kvm' ? scopes[0].gpu_auto_assignment : undefined,
			firmware_type: scopes[0].type == 'kvm' && testWin10.test(scopes[3].system_version1.key) ? 'uefi' : undefined,

			host_uuid: scopes[0].host.host_uuid
		};
		function updateTem(isSuccess) {
			personal.query(function (res) {
				$scope.allrows.splice(0, $scope.allrows.length);
				Array.prototype.push.apply($scope.allrows, res.win_images.concat(res.linux_images).concat(res.other_images));
				var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
					if ($scope.select === 'all') {
						return item;
					} else {
						return item.virtual_type === scopes[0].type;
					}
				});
				newRows.forEach(function (row) {
					var os = $$$os_types.filter(function (item) {
						return item.key === row.os_type;
					})[0];
					os && os.icon && (row.icon = os.icon);
				});
				newRows.sort(function (a, b) {
					return a.created_at > b.created_at ? -1 : 1;
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, newRows);
				// if(!auto_install){
				var template = $scope.rows.filter(function (temp) {
					return temp.name == item.template_name;
				})[0];
				if (template && isSuccess) {
					if (scopes[0].type == "hyper-v") {
						if (res.sync_mode === 'scp') {
							newWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');
						} else {
							newWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');
						}
					} else {
						if (res.sync_mode === 'scp') {
							newWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');
							newWindow.location.reload();
						} else {
							newWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name + '&personal');
						}
					}
					// if(scopes[0].type == "hyper-v"){
					// 	if(res.sync_mode==='scp'){
					// 		// newWindow.location.replace('templateModify_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);
					// 		//novnc-->spice-html5
					// 		newWindow.location.replace('js/vdi-spice/spiceModify_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
					// 	}
					// 	else{
					// 		// newWindow.location.replace('templateModifybt_rdp.html#' + template.id + '&' + template.os_type + '&' + template.name);
					// 		//novnc-->spice-html5
					// 		newWindow.location.replace('js/vdi-spice/spiceModifybt_rdp.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
					// 	}
					// }
					// else{
					// 	if(res.sync_mode==='scp'){
					// 		// newWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name);
					// 		// newWindow.location.reload();
					// 		//novnc-->spice-html5
					// 		newWindow.location.replace('js/vdi-spice/spiceModify.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
					// 		newWindow.location.reload();
					// 	}
					// 	else{
					// 		// newWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name);
					// 		//novnc-->spice-html5
					// 		newWindow.location.replace('js/vdi-spice/spiceModifybt.html#?id=' + template.id + '&os_type=' + template.os_type + '&name=' + encodeURIComponent(template.name)+"&instance_id="+template.instance_id);
					// 	}
					// }
				}
				// }
			});
		};
		e.targetScope.currentStep.showLoading = true;
		$modalInstance.close();
		personal.save(item, function (res) {
			updateTem(true);
		}, function () {
			newWindow.close();updateTem();
		}).$promise.finally(function () {
			e.targetScope.currentStep.showLoading = false;
		});;
	});

	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.cpu_num = 1;
}]).controller("registerPersonalTemplateDialog", ["$scope", "$modalInstance", "Admin", "registerTemplate", "PersonTemplate", "$$$os_types", "UserRole", "Network", "virtualHost", "networkWithHost", "$$$I18N", function ($scope, $modalInstance, admin, registerTemplate, personal, $$$os_types, UserRole, network, virtualHost, networkWithHost, $$$I18N) {
	var user = UserRole.currentUser;
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	$scope.type = '2';
	$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
	$scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
	$scope.types = $scope.types2;
	$scope.bind_ip_type = $scope.types2[0];
	admin.query(function (res) {
		$scope.users = res.users;
		angular.forEach($scope.users, function (item) {
			if (item.name === user.name) $scope.owner = item;
		});
	});
	registerTemplate.query(function (res) {
		$scope.sys_isos = res.system_image;
		$scope.sys_iso = res.system_image[0];
		$scope.old_data_isos = res.data_image;
		if ($scope.sys_iso) {
			$scope.getDataImgs($scope.sys_iso);
		}
	});
	$scope.filterDataISO = function (data_iso, data_iso2) {
		if (data_iso) {
			$scope.data_isos2 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso.name;
			});
		} else {
			$scope.data_isos2 = $scope.data_isos;
		}
		if (data_iso2) {
			$scope.data_isos1 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso2.name;
			});
		} else {
			$scope.data_isos1 = $scope.data_isos;
		}
	};
	$scope.getDataImgs = function (systemImg) {
		if (systemImg) {
			this.data_iso = undefined;
			this.data_iso2 = undefined;
			$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function (item) {
				return item.virtual_type == systemImg.virtual_type;
			});
			// $scope.data_iso = $scope.data_isos[0];
			// $scope.data_iso2 = $scope.data_isos[0];
			$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);
		}
	};
	$scope.getVirtualHost = function (type, rbd_enabled) {
		$scope.host_loading = true;
		virtualHost.query({
			virtual_type: type,
			rbd_enabled: rbd_enabled
			// enable_gpu: type == 'hyper-v'?enable_gpu:undefined
		}, function (res) {
			$scope.host_loading = false;
			$scope.hosts = res.result;
			$scope.host = $scope.hosts[0];
			$scope.getNetwork($scope.host);
		}, function () {
			$scope.host_loading = false;
		});
	};

	$scope.os_types = $$$os_types.filter(function (item) {
		return item.key !== "package";
	});
	$scope.os_type = $scope.os_types[0];
	// $scope.enable_gpu = false;
	$scope.bind_ip = { value: null };

	// function getIps(subnet_id, _scope){
	// 	if(subnet_id){
	// 		network.ports({ id: subnet_id },function(res){
	// 			if(res.unused_ips.length){
	// 				_scope.band_ips = res.unused_ips;
	// 			}
	// 			else{
	// 				_scope.band_ips = ["无可用IP"];
	// 			}
	// 			_scope.bind_ip = _scope.band_ips[0];
	// 			_scope.bind_ip_loading = false;
	// 		})
	// 	}
	// };
	$scope.switchIps = function (subnet, _scope) {
		// _scope.bind_ip_loading = true;
		if (subnet) {
			// getIps(subnet.id, _scope)
			_scope.types = _scope.types2;
			_scope.bind_ip_type = _scope.types2[0];
		} else {
			_scope.types = _scope.types1;
			_scope.band_ips = [];
			_scope.bind_ip_type = _scope.types1[0];
			// _scope.bind_ip_loading = false;
		}
	};
	function getSubnets(Network, _scope) {
		if (Network.subnets.length) {
			$scope.network_loading = true;
			// $scope.bind_ip_loading = true;
			network.query_sub({ id: Network.id }, function (res) {
				_scope.subnets = res.result;
				_scope.subnet = _scope.subnets[0];
				_scope.switchIps(_scope.subnet, _scope);
				$scope.network_loading = false;
			}, function () {
				$scope.network_loading = false;
			});
		} else {
			_scope.subnets = [];
			_scope.subnet = null;
			_scope.switchIps(_scope.subnet, _scope);
		}
	};
	$scope.getNetwork = function (host) {
		if (host) {
			networkWithHost.query({ host: host.host_uuid }, function (res) {
				// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
				$scope.networks = res.result;
				$scope.network = $scope.networks[0];
				getSubnets($scope.network, $scope);
			}, function () {});
		}
	};
	$scope.switchSubnet = function (val, _scope) {
		getSubnets(val, _scope);
	};

	$scope.ok = function () {
		var bindIP = this.bind_ip.value;
		// if(this.bind_ip_type.value === 'static' && this.bind_ip === '无可用IP'){
		// 	$.bigBox({
		// 		title	: $$$I18N.get("INFOR_TIP"),
		// 		content	: $$$I18N.get("hasStaticIP_TIP"),
		// 		timeout	: 6000
		// 	});
		// }
		// else{
		$scope.submiting = true;
		$scope.afterSubmiting = false;
		var _ip = this.bind_ip_type.value === 'static' ? bindIP : undefined;
		var postData = {
			system_image_file: this.sys_iso,
			data_image_file: this.data_iso ? this.data_iso : undefined,
			data_image_file_2: this.data_iso2 ? this.data_iso2 : undefined,
			name: this.name,
			description: this.description,
			type_code: this.type,
			os: this.os_type.key,
			is_64: this.os_type.value.indexOf("64 bit") > -1 ? true : false,
			owner: this.owner.id,
			network: this.network.id,
			subnet: this.subnet ? this.subnet.id : '',
			band_ip: _ip,
			band_type: this.bind_ip_type.value,
			host_uuid: this.host.host_uuid,
			username: this.sys_iso.virtual_type == 'hyper-v' ? this.username : undefined,
			userPassword: this.sys_iso.virtual_type == 'hyper-v' ? this.userPassword : undefined,
			userPasswordConfirm: this.sys_iso.virtual_type == 'hyper-v' ? this.userPasswordConfirm : undefined
			// enable_gpu: this.sys_iso.virtual_type == 'hyper-v'?this.enable_gpu:undefined
		};
		console.log(postData);
		registerTemplate.update(postData, function (res) {
			$scope.submiting = false;
			$scope.afterSubmiting = true;
			personal.query(function (res) {
				$scope.allrows.splice(0, $scope.allrows.length);
				Array.prototype.push.apply($scope.allrows, res.win_images.concat(res.linux_images).concat(res.other_images));
				var newRows = res.win_images.concat(res.linux_images).concat(res.other_images).filter(function (item) {
					if ($scope.select === 'all') {
						return item;
					} else {
						return item.virtual_type === $scope.select;
					}
				});
				newRows.forEach(function (row) {
					var os = $$$os_types.filter(function (item) {
						return item.key === row.os_type;
					})[0];
					os && os.icon && (row.icon = os.icon);
				});
				newRows.sort(function (a, b) {
					return a.created_at > b.created_at ? -1 : 1;
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, newRows);
			});
			$modalInstance.close();
		}, function () {
			$scope.submiting = false;
			$scope.afterSubmiting = false;
		});
		// }
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]);

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.template.hardware", ["vdi.template"]).factory("HardwareTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "GET", url: $Domain + "/thor/image/hardwares", isArray: false },
		"delete": { method: "DELETE", url: $Domain + "/thor/image/hardwares" },
		save: { method: "POST", url: $Domain + "/thor/image/hardwares" },
		get: { method: "GET", url: $Domain + "/thor/image/hardwares/:id", params: { id: "@id" }, isArray: false },
		update: { method: "PUT", url: $Domain + "/thor/image/hardware/:id", params: { id: "@id" }, isArray: false },
		// 过滤模板
		filter: { method: "GET", url: $Domain + "/thor/image/hardwares" }
	});
}]).controller("vdiTemplateHardwareListController", ["$scope", "$modal", "HardwareTemplate", function ($scope, $modal, hardware) {
	$scope.rows = [];
	$scope.loading = true;
	var _controllerScope = $scope;
	hardware.query(function (res) {
		$scope.rows = res.result;
		$scope.loading = false;
	});

	$scope.currentPage = 1;
	$scope.pagesizes = [30, 20, 10];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除硬件模板'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_H' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.name = rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.ok = function () {
					hardware.delete({
						"instance_type_id": rows.map(function (item) {
							return item.id;
						})
					}, function () {
						hardware.query(function (res) {
							var newRows = res.result;
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
					}, function (error) {
						hardware.query(function (res) {
							var newRows = res.result;
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
					});
					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("addHardwareTemplateDialog", ["$scope", "$modalInstance", "HardwareTemplate", function ($scope, $modalInstance, hardware) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.data = {
		cpu_num: 1,
		memory_mb: 1,
		system_gb: 10
		// system_disk_type: "2",
		// local_disk_type: "3"
	};
	$scope.btndisks = [];
	// $scope.data.system_disk_type = "2";$scope.data.local_disk_type = "3";
	var _controllerScope = $scope;
	$scope.ok = function () {
		var _this = this;
		hardware.save({
			"name": this.data.name,
			"cpu_num": this.data.cpu_num,
			"memory_mb": this.data.memory_mb * 1024,
			"system_gb": this.data.system_gb,
			"local_gb": this.btndisks[0] ? this.btndisks[0].local_gb : 0,
			"local_gb1": this.btndisks[1] ? this.btndisks[1].local_gb : 0
			// "system_disk_type": this.data.system_disk_type,
			// "local_disk_type": this.data.local_disk_type
		}, function (data) {
			// $scope.rows.unshift({
			// 	id: data.id,
			// 	name : _this.data.name,
			// 	cpu_num : _this.data.cpu_num,
			// 	memory_mb: _this.data.memory_mb*1024,
			// 	system_gb : _this.data.system_gb,
			// 	local_gb : _this.data.local_gb,
			// 	"system_disk_type": _this.data.system_disk_type,
			// 	"local_disk_type": _this.data.local_disk_type
			// });
			hardware.query(function (res) {
				var newRows = res.result;
				_controllerScope.rows.splice(0, _controllerScope.rows.length);
				Array.prototype.push.apply(_controllerScope.rows, newRows);
			});
			$modalInstance.close();
		});
	};

	$scope.close = function () {
		$modalInstance.close();
	};

	$scope.addbtndisk = function () {
		$scope.btndisks.push({ local_gb: 5 });
	};
	$scope.minusbtndisk = function () {
		// var idx = $scope.btndisks.indexOf(i)
		$scope.btndisks.splice($scope.btndisks.length - 1, 1);
	};
}]).controller("editHardwareTemplateDialog", ["$scope", "$modalInstance", "HardwareTemplate", function ($scope, $modalInstance, hardware) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	var item = $scope.item || $scope.currentItem;
	$scope.data = angular.copy(item);
	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.data) || angular.equals($scope.currentItem, $scope.data);
	};
	$scope.reset = function () {
		$scope.data = angular.copy($scope.item || $scope.currentItem);
	};
	$scope.edit = function () {
		hardware.update($scope.data, function (res) {
			item.name = res.name;
			item.cpu_num = res.cpu_num;
			item.memory_mb = res.memory_mb;
			item.local_gb = res.local_gb;
			item.system_gb = res.system_gb;
			$modalInstance.close();
		}, function () {});
	};
	$scope.close = function () {
		$modalInstance.close();
	};

	$scope.useNum = "1";
	$scope.btndisks = [];
	$scope.addharddisk = function () {
		$scope.useNum -= 1;
		$scope.btndisks.push(new String());
	};
	$scope.deleteharddisk = function (itemindex) {
		$scope.useNum += 1;
		$scope.btndisks.splice(itemindex, 1);
	};
}]);

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.user", []).constant('$$$UserRoles', "Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About").factory("UserRole", ["$$$UserRoles", "NavigatorLink", "$rootScope", "$$$UserRoles", "User", function (roles, navigators, $root, $$$UserRoles, User) {
	var lastSessionPromise = void 0;
	var lastRequestTime = 0;
	var role = {
		getNavigator: function getNavigator(roles) {
			if ($$$storage.getSessionStorage("lang_code") == 'pc') navigators = navigators.filter(function (item) {
				return item.key !== 'Timetable';
			});
			return navigators.reduce(function (userNavigators, role) {
				if (roles.indexOf(role.key) > -1) {
					var role_copy = JSON.parse(JSON.stringify(role));
					userNavigators.push(role_copy);
					if (role.sublist && role.sublist.length) {

						role_copy.sublist = role.sublist.filter(function (role) {
							return roles.indexOf(role.key) > -1;
						});
					}
				}
				return userNavigators;
			}, []);
		},

		get currentUser() {
			var hasCache = !!$$$storage.getSessionStorage("loginInfo");
			if (hasCache && Date.now() - lastRequestTime > 1000 * 60 * 5) {
				this.refreshSession();
			}

			if (hasCache) {
				return JSON.parse($$$storage.getSessionStorage("loginInfo"));
			}
			$root.$broadcast("NOAUTH");
			return null;
		},
		get logined() {
			return Boolean($$$storage.getSessionStorage("loginInfo"));
		},
		get currentUserRoles() {
			var user = role.currentUser;
			return user && user.keys ? user.keys.split(",").map(function (r) {
				return r.trim();
			}) : [];
		},
		get isOwner() {
			var user = role.currentUser;
			return user && user.keys && user.keys === $$$UserRoles ? true : false;
		},
		get currentNavigator() {
			return role.getNavigator(role.currentUserRoles);
		},
		get currentSession() {
			return lastSessionPromise;
		},
		isAllowFilter: function (_isAllowFilter) {
			function isAllowFilter(_x) {
				return _isAllowFilter.apply(this, arguments);
			}

			isAllowFilter.toString = function () {
				return _isAllowFilter.toString();
			};

			return isAllowFilter;
		}(function (role) {
			if (role.sublist && role.sublist.length) {
				role.sublist.filter(isAllowFilter, this);
			}
			return this.indexOf(role.key) > -1;
		}),
		refreshSession: function refreshSession() {
			lastSessionPromise = User.session({ user_id: $$$storage.getSessionStorage("userId") }).$promise;
			lastSessionPromise.then(function (res) {
				var oldInfo = JSON.parse($$$storage.getSessionStorage("loginInfo")) || {};
				// test--
				// res.user.keys = "Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About";
				Object.keys(res.user).forEach(function (key) {
					oldInfo[key] = res.user[key];
				});
				$$$storage.setSessionStorage('loginInfo', JSON.stringify(oldInfo));
				$$$storage.setSessionStorage('power', res.user.keys);
			});
			lastRequestTime = Date.now();
			return lastSessionPromise;
		}
	};
	return role;
}])

/* 用户 */
.factory("Roles", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/user/permissions", null, {
		query: { method: "GET", url: $Domain + "/thor/user/permissions", isArray: false },
		update: { method: "PUT", url: $Domain + "/thor/user/permissions" }
	});
}]).factory("Admin", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/user/manager", null, {
		query: { method: "GET", url: $Domain + "/thor/user/manager", isArray: false },
		update: { method: "PUT", url: $Domain + "/thor/user/manager" }
	});
}])
// .factory("User", ["$resource", "$Domain", function(res, $Domain){
// 	return res($Domain + "/thor/user/common", null, {
// 		query:
// 			{ method: "GET", url: $Domain + "/thor/user/common", isArray: false},
// 		update: 
// 			{method: "PUT", url: $Domain + "/thor/user/common" },
// 		session: {method: "POST", url: $Domain + "/thor/user/session"}
// 	});
// }])
.factory("User", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/user/common", null, {
		query: { method: "GET", url: $Domain + "/thor/user/common", isArray: false },
		edit: { method: "PATCH", url: $Domain + "/thor/user/common/:id", params: { "id": "@id" }, isArray: false },
		move: { method: "PATCH", url: $Domain + "/thor/user/common/move" },
		query_tree: { method: "GET", url: $Domain + "/thor/user/common/tree" },
		session: { method: "POST", url: $Domain + "/thor/user/session" }
	});
}])
/**
 * [description 部门]
 */
.factory("Depart", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/user/departments", null, {
		query: { method: "GET", url: $Domain + "/thor/user/departments", isArray: false },
		add: { method: "POST", url: $Domain + "/thor/user/departments" },
		update: { method: "PATCH", url: $Domain + "/thor/user/departments/:id", params: { "id": "@id" }, isArray: false },
		delete: { method: "DELETE", url: $Domain + "/thor/user/departments/:id", params: { "id": "@id" }, isArray: false }
	});
}]).factory("Server", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/user/server", null, {
		// 读取域列表
		query: { method: "GET", url: $Domain + "/thor/user/server" },
		get: { method: "GET", url: $Domain + "/thor/user/info/:id", params: { "id": "@id" }, isArray: false },
		// 修改域基本信息
		update: { method: "PUT", url: $Domain + "/thor/user/server" },
		//新增域
		create: { method: "POST", url: $Domain + "/thor/user/server" },
		"delete": { method: "DELETE", url: $Domain + "/thor/user/server/:id", params: { "id": "@id" }, isArray: false },
		listDomain: { method: "GET", url: $Domain + "/thor/user/server/:id", params: { "id": "@id" } },

		// 指定教学桌面设置域
		"domain_set_scene": { method: "POST", url: $Domain + "/thor/pool/mode/:id/change_domain", params: { "id": "@id" } },
		//个人桌面设置域
		"domain_set_person": { method: "POST", url: $Domain + "/thor/instances/change_domain" }
	});
}]).factory("Domain", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/user/domain/:id", { "id": "@id" }, {
		// 域用户列表
		list: { method: "GET", url: $Domain + "/thor/user/get_users" },
		// 查看特定域的用户信息
		query: { method: "GET", url: $Domain + "/thor/user/domain/:id", params: { "id": "@id" } },
		asycing: { method: "POST", url: $Domain + "/thor/user/domain/:id", params: { "auto": "@auto" }, isArray: false },
		get: { method: "GET", url: $Domain + "/thor/user/domain/:id/ous", params: { "id": "@id" } },
		delete: { method: "DELETE", url: $Domain + "/thor/user/common", isArray: false }
	});
}]).controller("vdiUserAdminManageController", ["$scope", "Admin", "$modal", "UserRole", "$$$I18N", function ($scope, UseradminList, $modal, UserRole, $$$I18N) {
	var user = UserRole.currentUser;
	if (!user) {
		return;
	}
	$scope.rows = [];
	// $scope.allRows = [];
	$scope.loading = true;
	$scope.owner = UserRole.isOwner;
	$scope.loginName = user.name;

	UseradminList.query(function (res) {
		if (!$scope.owner) {
			$scope.rows = res.users.filter(function (item) {
				return item.name == $scope.loginName;
			});
		} else {
			$scope.rows = res.users;
		}
		$scope.loading = false;
		var _ip;
		$scope.rows.forEach(function (row) {
			if (row.last_login !== null) {
				_ip = row.last_login.split(".");
				row._ip = (_ip[0] << 16) + (_ip[1] << 8) + Number(_ip[2]) + _ip[3] / 1000;
			} else {
				_ip = null;
				row._ip = null;
			}
		});
		// angular.copy($scope.rows,$scope.allRows);
	});

	$scope.currentPage = 1;
	$scope.pagesize = Number($$$storage.getSessionStorage('admin_pagesize')) || 30;
	$scope.$watch("pagesize", function (newvalue) {
		$scope.pagesize = newvalue || 0;
		$$$storage.setSessionStorage('admin_pagesize', newvalue ? newvalue : 0);
	});

	// $scope.updateData = function(text){
	// 	$scope.rows = $scope.allRows.filter(function(row){
	// 		row._selected = false;
	// 		if(text){
	// 			return row.name.indexOf(text) !== -1;
	// 		}
	// 		return true;
	// 	});
	// };

	$scope.sortIP = function (order) {
		$scope.rows.sort(function (a, b) {
			return a._ip > b._ip ? 1 : -1;
		});
		if (order) {
			$scope.rows.reverse();
		}
	};

	$scope.delete = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && !row._ignore;
		});
		var nodelete_rows = selected_rows.filter(function (row) {
			return row.instance_num != 0;
		});
		var delete_rows = selected_rows.filter(function (row) {
			return row.instance_num == 0;
		});
		var rows = $scope.rows;
		if (delete_rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ADMIN_TIP"),
				timeout: 6000
			});
		} else $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除用户'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='USER_TIPGROUP2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.nodelete_rows = nodelete_rows;
				$scope.name = delete_rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.nodeleteName = nodelete_rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.ok = function () {
					UseradminList.delete({
						ids: delete_rows.map(function (row) {
							return row.id;
						})
					}, function (res) {
						delete_rows.forEach(function (item) {
							var index = rows.indexOf(item);
							rows.splice(index, 1);
						});
						$modalInstance.close();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("vdiUserCommonManageController", ["$scope", "User", "$modal", "$http", "$$$MSG", "$$$I18N", "$Domain", "$timeout", "customModal", "Depart", "User", "UserRole", "$location", function ($scope, UsercommonList, $modal, $http, $$$MSG, $$$I18N, $Domain, $timeout, customModal, Depart, User, UserRole, $location) {
	var _scope = $scope;
	$scope.rows = [];
	var WIDTH = $$$I18N.get("GOD_VERSION") == "cloudClassEn" || $$$I18N.get("GOD_VERSION") == "korean" ? 66 : 50;
	$scope.currentPage = 1;
	$scope.pagesize = Number($$$storage.getSessionStorage('common_pagesize')) || 30;
	$scope.$watch("pagesize", function (newvalue) {
		$scope.pagesize = newvalue || 0;
		$$$storage.setSessionStorage('common_pagesize', newvalue ? newvalue : 0);
	});
	$scope.domain = $Domain;
	/**
  * [sortIP IP排序]
  */
	$scope.sortIP = function (order) {
		$scope.rows.sort(function (a, b) {
			return a._ip > b._ip ? 1 : -1;
		});
		if (order) {
			$scope.rows.reverse();
		}
	};

	// 组合json数据
	function setData(data, index) {
		data.filter(function (item) {
			return item.full_path_map.length == index;
		}).forEach(function (item) {
			var children = data.filter(function (d) {
				return d.parent == item.id;
			});
			item.children = children;
		});
	}
	function setTreeData(DATA) {
		DATA.forEach(function (item) {
			item.full_path_map = item.full_path.split('/');
		});
		DATA.sort(function (a, b) {
			return a.full_path_map.length > b.full_path_map.length ? -1 : 1;
		});
		for (var i = 1; i < DATA[0].full_path_map.length; i++) {
			setData(DATA, i);
		}
		return [DATA[DATA.length - 1]];
	};
	// 初始化树状图
	function treeOptFun(arg, flag) {
		arg.opts = {};
		arg.treedata = newData;
		arg.expandnodes = DATA;
		arg.selected = arg.treedata[0] ? arg.treedata[0] : null;
		if (arg.selected) {
			arg.selected._selected = true;
		}
		arg.showSelected = function (node, selected) {
			node._selected = selected;
			arg.selected = node;
			if (arg.selected._selected && flag) {
				$scope.queryCommon(arg.selected.id);
			}
		};
	};
	var DATA = [],
	    newData = [];
	treeOptFun($scope, true);

	$scope.islastGroup = function () {
		return $scope.selected && !DATA.filter(function (item) {
			return item.id !== $scope.selected.id;
		}).filter(function (item) {
			return (item.full_path + '/').indexOf($scope.selected.full_path + '/') > -1;
		}).length;
	};
	$scope.queryCommon = function (departId) {
		$scope.user_loading = true;
		$scope.rows = [];
		UsercommonList.query({ department: departId ? departId : undefined }, function (users) {
			$scope.user_loading = false;
			$scope.rows = users.result;
			// $scope.rows.forEach(function(item){ item.department_desc = $scope.selected.full_path });
			var _ip;
			$scope.rows.forEach(function (row) {
				if (row.last_login !== null) {
					_ip = row.last_login.split(".");
					row._ip = (_ip[0] << 16) + (_ip[1] << 8) + Number(_ip[2]) + _ip[3] / 1000;
				} else {
					_ip = null;
					row._ip = null;
				}
			});
			console.log(777, $scope.rows);
		}, function () {
			$scope.user_loading = false;
		});
	};
	$scope.treedata_loading = true;
	$scope.queryDepart = function () {
		Depart.query(function (res) {
			$scope.treedata_loading = false;
			DATA = res.result;
			$scope.treedata = newData = DATA.length ? setTreeData(DATA) : [];
			$scope.treedata[0].children && $scope.treedata[0].children.sort(function (a, b) {
				return a.name > b.name ? -1 : 1;
			});
			$scope.expandnodes = DATA;
			var selected = {};
			if ($scope.selected) {
				var _selected = DATA.filter(function (item) {
					return item.id == $scope.selected.id;
				})[0];
				selected = _selected ? _selected : newData[0];
			} else {
				selected = newData[0];
			}
			$scope.selected = selected;
			if ($scope.selected) {
				$scope.selected._selected = true;
				$scope.queryCommon($scope.selected.id);
			}
		}, function (err) {
			$scope.treedata_loading = false;
		});
	};
	if ($location.$$search.depart) $scope.selected = { id: Number($location.$$search.depart) };
	if ($location.$$search.username) $scope.searchText = decodeURIComponent($location.$$search.username);

	$scope.queryDepart();

	/**
  * [addDepartment 添加部门]
  */
	$scope.addDepartment = function () {
		$modal.open({
			templateUrl: "views/vdi/dialog/user/user_common_department_add.html",
			size: DATA.length ? "md" : 'sm',
			controller: function controller($scope, $modalInstance) {
				$scope.min_namelength = 2;$scope.max_namelength = 20;
				treeOptFun($scope);
				$scope.selected = null;
				$scope.ok = function () {
					Depart.add({
						name: this.name,
						parent: this.selected ? this.selected.id : 1
					}, function (res) {
						$modalInstance.close();
						_scope.queryDepart();
					}, function () {});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			}

		});
	};
	/**
  * [deleteDpartment 删除部门]
  */
	$scope.deleteDpartment = function () {
		var modalOptions = {
			key: "CommonDepartDel",
			title: "删除用户组",
			delTips: "USER_TIPGROUP3",
			delete_rows: [$scope.selected],
			delParm: 'name'
		};
		customModal.openModal(modalOptions);
	};
	/**
  * [delete 列表删除用户]
  */
	$scope.delete = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var nodelete_rows = selected_rows.filter(function (row) {
			return row.instance_num != 0;
		});
		var delete_rows = selected_rows.filter(function (row) {
			return row.instance_num == 0;
		});

		if (delete_rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ADMIN_TIP"),
				timeout: 6000
			});
		} else {
			var modalOptions = {
				key: "CommonUserDel",
				title: "删除用户",
				delTips: "USER_TIPGROUP1",
				delete_rows: delete_rows,
				delParm: 'name',
				nodelete_rows: nodelete_rows,
				nodelTips: "USER_TIPGROUP4"
			};
			customModal.openModal(modalOptions);
		}
	};

	$scope.$on('DELETE', function (e, val) {
		if (val) {
			// 删除部门
			if (val.key == 'CommonDepartDel') {
				Depart.delete({
					id: val.data[0].id
				}, function (res) {
					$scope.queryDepart();
				}, function () {});
			}
			//删除部门用户
			if (val.key == 'CommonUserDel') {
				UsercommonList.delete({
					id: val.data.map(function (row) {
						return row.id;
					})
				}, function (res) {
					$scope.queryDepart();
				});
			}
		}
	});
	/**
  * [modifyInfo 修改部门名称]
  */
	$scope.modifyInfo = function (node) {
		var obj = node ? node : $scope.selected;
		$modal.open({
			templateUrl: "views/vdi/dialog/user/user_common_department_modify.html",
			size: "sm",
			controller: function controller($scope, $modalInstance) {
				$scope.min_namelength = 2;$scope.max_namelength = 20;
				$scope.name = obj.name;
				$scope.ok = function () {
					Depart.update({
						id: obj.id,
						name: this.name
					}, function (res) {
						_scope.queryDepart();
					}, function () {});
					$modalInstance.close();
				};

				$scope.close = function () {
					$modalInstance.close();
				};
			}
		});
	};
	/**
  * [moveTo 用户移动至部门]
  */
	$scope.moveTo = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			templateUrl: "views/vdi/dialog/user/user_common_moveTo.html",
			size: "md",
			draggable: true,
			controller: function controller($scope, $modalInstance) {
				treeOptFun($scope);
				$scope.opts.isSelectable = function (node) {
					return !DATA.filter(function (item) {
						return item.id !== node.id;
					}).filter(function (item) {
						return (item.full_path + '/').indexOf(node.full_path + '/') > -1;
					}).length;
				};
				$scope.selected = null;
				$scope.ok = function () {
					User.move({
						id: selected_rows.map(function (item) {
							return item.id;
						}),
						department: this.selected.id
					}, function (res) {
						_scope.queryDepart();
					});
					$modalInstance.close();
				}, $scope.close = function () {
					$modalInstance.close();
				};
				//勾选的人员姓名
				$scope.selectedPerson = selected_rows.map(function (item, index, arr) {
					return item.name;
				}).join('，');
			}
		});
	};
	/**
  * [description uploadify上传文件]
  */
	var encodeHTML = function encodeHTML(txt, con) {
		con = con || document.createElement("div");
		while (con.firstChild) {
			con.removeChild(con.firstChild);
		}
		return con.appendChild(con.ownerDocument.createTextNode(txt)).parentNode.innerHTML;
	};
	var format = function format(tmpl) {
		var data = Array.prototype.slice.call(arguments, 0);
		return typeof tmpl === "string" ? tmpl.replace(/\{\{([^\}]+)?\}\}/g, function (match, param) {
			if (data[param]) {
				return encodeHTML(data[param]);
			}
			return match;
		}) : "";
	};

	$scope.finishUpload = function (response) {
		$scope.queryDepart();
	};

	$scope.$on("UploadError", function (e, suc, errorData) {
		var errorMsg = errorData.code == 17041 ? $$$MSG.get(errorData.code) + errorData.detail : $$$MSG.get(errorData.code);
		$.bigBox({
			title: $$$MSG.get("PAI_CODE") + errorData.code,
			content: errorMsg,
			color: "#C46A69",
			icon: "fa fa-warning shake animated",
			timeout: 6000
		});
	});
}]).controller("vdiUserDomainController", ["$scope", "$modal", "Server", function ($scope, $modal, Server) {
	$scope.loading = true;
	$scope.rows = [];

	$scope.currentPage = 1;
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.loading = false;

	Server.query(function (response) {
		$scope.rows = response.servers;
	}, function () {
		//console.log(arguments);
	});

	var _scope = $scope;
	$scope.delete = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var rows = $scope.rows;
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除域控制器'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.name = selected_rows.map(function (row) {
					return row.host;
				}).join(', ');
				$scope.ok = function () {
					Server.delete({
						ids: selected_rows.map(function (row) {
							return row.id;
						})
					}, function (res) {
						Server.query(function (response) {
							_scope.rows = response.servers;
						});
						$modalInstance.close();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("vdiUserDomainListController", ["$scope", "$modal", "Domain", "User", "$routeParams", "$$$I18N", function ($scope, $modal, Domain, User, $routeParams, $$$I18N) {
	$scope.loading = true;
	$scope.$root && $scope.$root.$broadcast("navItemSelected", ["用户", "域用户", "域用户列表"]);

	// location.replace("#/user/domain/");
	$scope.domainId = location.hash.match(/\d+$/) ? parseInt(location.hash.match(/\d+$/)[0]) : $routeParams.id;
	$scope.currentPage = 1;
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.loading = false;
	$scope.rows = [];
	$scope.oneKeySycing = function () {
		Domain.asycing({ "auto": 1, "id": $scope.domainId }, function (response) {
			angular.forEach(response.result, function (item, index) {
				var i;
				for (i = 0; i < $scope.rows.length; i++) {
					if (item.id == $scope.rows[i]) {
						$scope.rows[i] = item;
					}
				}
				if (i >= $scope.rows.length) {
					$scope.rows.push(item);
				}
				//$scope.rows.push(item);
			});
		});
	};

	var _scope = $scope;
	$scope.delete = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var nodelete_rows = selected_rows.filter(function (row) {
			return row.instance_num != 0;
		});
		var delete_rows = selected_rows.filter(function (row) {
			return row.instance_num == 0;
		});
		var rows = $scope.rows;

		if (delete_rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ADMIN_TIP"),
				timeout: 6000
			});
		} else $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除用户'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;word-break: break-all;' data-localize='USER_TIPGROUP1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='USER_TIPGROUP2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.nodelete_rows = nodelete_rows;
				$scope.name = delete_rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.nodeleteName = nodelete_rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.ok = function () {
					User.delete({
						ids: delete_rows.map(function (row) {
							return row.id;
						})
					}, function (res) {
						delete_rows.forEach(function (item) {
							var index = rows.indexOf(item);
							rows.splice(index, 1);
						});
						$modalInstance.close();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	Domain.query({ "id": $scope.domainId }, function (response) {
		$scope.rows = response.users;
	}, function () {});
}]).controller("vdiUserRoleManageController", ["$scope", "$modal", "Roles", "$$$UserRoles", "$$$I18N", function ($scope, $modal, roles, $$$UserRoles, $$$I18N) {
	$scope.rows = [];var _controllerScope = $scope;$scope.loading = true;
	// $scope.allRows = [];
	$scope.powers = $$$UserRoles;
	roles.query(function (res) {
		$scope.rows = res.result.sort(function (a, b) {
			if (a.name === 'Administrator') {
				return -1;
			} else if (b.name === 'Administrator') {
				return 1;
			}
			return 0;
		});
		$scope.loading = false;
		// angular.copy($scope.rows,$scope.allRows);
	});

	$scope.currentPage = 1;
	$scope.pagesize = Number($$$storage.getSessionStorage('role_pagesize')) || 30;
	$scope.$watch("pagesize", function (newvalue) {
		$scope.pagesize = newvalue || 0;
		$$$storage.setSessionStorage('role_pagesize', newvalue ? newvalue : 0);
	});

	// $scope.updateData = function(text){
	// 	$scope.rows = $scope.allRows.filter(function(row){
	// 		row._selected = false;
	// 		if(text){
	// 			return row.name.indexOf(text) !== -1;
	// 		}
	// 		return true;
	// 	});
	// };

	$scope.delete = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && !row._ignore;
		});
		var nodelete_rows = selected_rows.filter(function (row) {
			return row.user_num != 0;
		});
		var delete_rows = selected_rows.filter(function (row) {
			return row.user_num == 0;
		});
		var rows = $scope.rows;

		if (delete_rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ROEL_TIP"),
				timeout: 6000
			});
		} else $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除角色'>" + "删除角色</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_ROLES1' param1='{{name}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length' data-localize='DELETE_ROLES2' param1='{{nodeleteName}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.nodelete_rows = nodelete_rows;
				$scope.name = delete_rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.nodeleteName = nodelete_rows.map(function (row) {
					return row.name;
				}).join(', ');

				$scope.ok = function () {
					roles.delete({
						ids: delete_rows.map(function (row) {
							return row.id;
						})
					}, function (res) {
						delete_rows.forEach(function (item) {
							var index = rows.indexOf(item);
							rows.splice(index, 1);
						});
						$modalInstance.close();
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("addUserRoleDialog", ["$scope", "$modalInstance", "Roles", "$$$I18N", "NavigatorLink", function ($scope, $modalInstance, role, $$$I18N, navigators) {
	$scope.checked = true;$scope.roles = [];
	navigators.forEach(function (item) {
		if (item.sublist) {
			$scope.roles.push(item);
			item.sublist.forEach(function (data) {
				if (data.key !== "Role_Manage") $scope.roles.push(data);
			});
		} else $scope.roles.push(item);
	});
	$scope.roles.forEach(function (item) {
		item._selected = $scope.checked;
		item._slide = false;
		item._arrow = "up";
	});
	$scope.selectAll = function () {
		$scope.checked = !$scope.checked;
		if ($scope.checked) {
			$scope.roles.forEach(function (item) {
				if (item.key != "Administrator" && item.key != "User" && item.key != "Summary") item._selected = true;
			});
		} else {
			$scope.roles.forEach(function (item) {
				if (item.key != "Administrator" && item.key != "User" && item.key != "Summary") item._selected = false;
			});
		}
	};
	$scope.slide = function (name, checked) {
		var fatheritem = $scope.roles.filter(function (item) {
			return item.key === name;
		})[0];
		var subitem = $scope.roles.filter(function (item) {
			return item.belong === name;
		});
		if (checked) {
			fatheritem._arrow = "down";
			subitem.forEach(function (item) {
				item._slide = true;
			});
		} else {
			fatheritem._arrow = "up";
			subitem.forEach(function (item) {
				item._slide = false;
			});
		}
	};
	$scope.select = function (name) {
		var checked = $scope.roles.filter(function (item) {
			return item.key === name;
		})[0]._selected;
		var subitem = $scope.roles.filter(function (item) {
			return item.belong === name;
		});
		if (!checked) {
			subitem.forEach(function (item) {
				item._selected = true;
			});
		} else {
			subitem.forEach(function (item) {
				item._selected = false;
			});
		}
		var length = $scope.roles.filter(function (item) {
			return item._selected;
		}).length;
		if (length + 1 == $scope.roles.length) {
			$scope.checked = true;
		} else $scope.checked = false;
	};
	$scope.set = function (name) {
		var allchecked = false;
		$scope.roles.filter(function (item) {
			return item.belong === name;
		}).forEach(function (item) {
			if (item._selected == true) {
				allchecked = true;
			}
		});
		var fatheritem = $scope.roles.filter(function (item) {
			return item.key === name;
		})[0];
		if (fatheritem) {
			if (!allchecked) fatheritem._selected = false;else {
				fatheritem._selected = true;
			}
		}
		var length = $scope.roles.filter(function (item) {
			return item._selected;
		}).length;
		if (length == $scope.roles.length) {
			$scope.checked = true;
		} else $scope.checked = false;
	};

	$scope.min_namelength = 2;$scope.max_namelength = 20;

	$scope.ok = function () {
		var _this = this;
		var roles = this.roles.filter(function (item) {
			return item._selected == true;
		}).map(function (item) {
			return item.key;
		});
		if (roles.length) {
			role.save({
				"name": this.data.name,
				"desc": this.data.desc,
				"keys": roles.toString()
			}, function (data) {
				$scope.rows.push({
					id: data.id,
					name: data.name,
					desc: data.desc,
					user_num: data.user_num,
					redactor: data.redactor,
					updated_time: data.updated_time,
					access_key: data.access_key
				});
				$modalInstance.close();
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("PERMISSION_TIP"),
				timeout: 6000
			});
		}
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("editUserRoleDialog", ["$scope", "$modalInstance", "Roles", "$$$I18N", "UserRole", "NavigatorLink", function ($scope, $modalInstance, role, $$$I18N, UserRole, navigators) {
	var user = UserRole.currentUser;
	if (!user) {
		return;
	}
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.data = {};
	$scope.master = {};

	var item = $scope.item || $scope.currentItem;
	var roles = [];
	navigators.forEach(function (item) {
		if (item.sublist) {
			roles.push(item);
			item.sublist.forEach(function (data) {
				if (data.key !== "Role_Manage") roles.push(data);
			});
		} else roles.push(item);
	});
	item.roles = roles;
	var access_roles = item.access_key.split(",");
	item.roles.forEach(function (item) {
		item._selected = false;
		item._slide = false;
		item._arrow = "up";
	});
	access_roles.forEach(function (role) {
		item.roles.forEach(function (item) {
			if (item.key === role) item._selected = true;
		});
	});
	$scope.data = angular.copy(item);

	if ($scope.data.roles.filter(function (item) {
		return item._selected === true;
	}).length === $scope.data.roles.length) {
		$scope.checked = true;
	} else $scope.checked = false;

	$scope.selectAll = function () {
		$scope.checked = !$scope.checked;
		if ($scope.checked) {
			$scope.data.roles.forEach(function (item) {
				if (item.key != "Administrator" && item.key != "User" && item.key != "Summary") item._selected = true;
			});
		} else {
			$scope.data.roles.forEach(function (item) {
				if (item.key != "Administrator" && item.key != "User" && item.key != "Summary") item._selected = false;
			});
		}
	};
	$scope.slide = function (name, checked) {
		var fatheritem = $scope.data.roles.filter(function (item) {
			return item.key === name;
		})[0];
		var subitem = $scope.data.roles.filter(function (item) {
			return item.belong === name;
		});
		if (checked) {
			fatheritem._arrow = "down";
			subitem.forEach(function (item) {
				item._slide = true;
			});
		} else {
			fatheritem._arrow = "up";
			subitem.forEach(function (item) {
				item._slide = false;
			});
		}
	};
	$scope.select = function (name) {
		var checked = $scope.data.roles.filter(function (item) {
			return item.key === name;
		})[0]._selected;
		var subitem = $scope.data.roles.filter(function (item) {
			return item.belong === name;
		});
		if (!checked) {
			subitem.forEach(function (item) {
				item._selected = true;
			});
		} else {
			subitem.forEach(function (item) {
				item._selected = false;
			});
		}
		var length = $scope.data.roles.filter(function (item) {
			return item._selected;
		}).length;
		if (length + 1 == $scope.data.roles.length) {
			$scope.checked = true;
		} else $scope.checked = false;
	};
	$scope.set = function (name) {
		var allchecked = false;
		$scope.data.roles.filter(function (item) {
			return item.belong === name;
		}).forEach(function (item) {
			if (item._selected == true) {
				allchecked = true;
			}
		});
		var fatheritem = $scope.data.roles.filter(function (item) {
			return item.key === name;
		})[0];
		if (fatheritem) {
			if (!allchecked) fatheritem._selected = false;else {
				fatheritem._selected = true;
			}
		}
		var length = $scope.data.roles.filter(function (item) {
			return item._selected;
		}).length;
		if (length == $scope.data.roles.length) {
			$scope.checked = true;
		} else $scope.checked = false;
	};

	$scope.ok = function () {
		var _this = this;
		var roles = this.data.roles.filter(function (item) {
			return item._selected == true;
		}).map(function (item) {
			return item.key;
		});
		if (roles.length) {
			role.update({
				"id": this.data.id,
				"name": this.data.name,
				"desc": this.data.desc,
				"keys": roles.toString()
			}, function (data) {
				var POWER = item.access_key;
				item.name = data.name;
				item.desc = data.desc;
				item.access_key = data.access_key;
				item.redactor = data.redactor;
				item.updated_time = data.updated_time;
				item.user_num = data.user_num;
				$modalInstance.close();
				if (_this.data.id === user.permission && item.access_key != POWER) {
					$$$storage.setSessionStorage('power', roles.toString());
					location.reload();
				}
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("PERMISSION_TIP"),
				timeout: 6000
			});
		}
	};
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.data) || angular.equals($scope.currentItem, $scope.data);
	};
	$scope.reset = function () {
		$scope.data = angular.copy($scope.item || $scope.currentItem);
		if ($scope.data.roles.filter(function (item) {
			return item._selected === true;
		}).length === $scope.data.roles.length) {
			$scope.checked = true;
		} else $scope.checked = false;
	};
}]).controller("addUserAdminDialog", ["$scope", "$modalInstance", "Admin", "SchoolRoom", "Roles", "$$$I18N", function ($scope, $modalInstance, admin, schoolroom, role, $$$I18N) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	$scope._ischeckAll = true;
	$scope.data = {
		sex: 'true'
	};
	$scope.master = { sex: 'true' };

	$scope.schoolroom_loading = true;
	schoolroom.querywithSimple(function (res) {
		$scope.schoolroom_loading = false;
		$scope.data.schoolrooms = res.pools_;
		$scope.data.schoolrooms.forEach(function (item) {
			item._selected = true;
		});
	});
	role.query(function (res) {
		$scope.roles = res.result;
		// $scope.data.role = res.result.filter(function(item){ return item.name==="Administrator" })[0];
	});
	$scope.DISABLED = false;
	$scope.changeRole = function (role) {
		if ($scope.data.role && $scope.data.role.name == "Administrator") {
			role._ischeckAll = true;
			$scope.data.schoolrooms.map(function (schoolroom) {
				return schoolroom._selected = true;
			});
			$scope.DISABLED = true;
		} else {
			$scope.DISABLED = false;
		}
	};
	$scope.checkAll = function (scope) {
		if (scope._ischeckAll) {
			$scope.data.schoolrooms.map(function (schoolroom) {
				return schoolroom._selected = true;
			});
		} else {
			$scope.data.schoolrooms.map(function (schoolroom) {
				return schoolroom._selected = false;
			});
		}
	};
	$scope.checkOne = function (scope) {
		var schoolrooms = $scope.data.schoolrooms.filter(function (p) {
			return p._selected;
		});
		if (schoolrooms.length === $scope.data.schoolrooms.length) {
			scope._ischeckAll = true;
		} else {
			scope._ischeckAll = false;
		}
	};

	$scope.reset = function () {
		$scope.data = angular.copy($scope.master);
	};
	$scope.isUnchanged = function () {
		return angular.equals($scope.master, $scope.data);
	};
	$scope.ok = function () {
		var pools = $scope.data.schoolrooms.filter(function (item) {
			if (item._selected) return item;
		}).map(function (item) {
			return item.id;
		});
		if (pools.length) admin.save({
			name: $scope.data.name,
			real_name: $scope.data.real_name,
			sex: $scope.data.sex,
			permission: $scope.data.role.id,
			password: $scope.data.password,
			passwordConfirm: $scope.data.passwordConfirm,
			email: $scope.data.email,
			contact: $scope.data.contact,
			pools: pools
		}, function (data) {
			data.result.instance_num = 0;
			$scope.rows.push(data.result);
			$modalInstance.close();
		});else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("POOL_TIP"),
				timeout: 6000
			});
		}
	};

	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("editUserAdminDialog", ["$scope", "$modalInstance", "Admin", "SchoolRoom", "Roles", "$$$UserRoles", "$$$I18N", "UserRole", function ($scope, $modalInstance, admin, schoolroom, role, $$$UserRoles, $$$I18N, UserRole) {
	var user = UserRole.currentUser;
	if (!user) {
		return;
	}
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	$scope.owner = UserRole.isOwner;

	$scope.master = {};
	$scope.data = {};

	var item = $scope.item || $scope.currentItem;
	$scope.schoolroom_loading = true;
	schoolroom.querywithSimple(function (res) {
		$scope.schoolroom_loading = false;
		item.schoolrooms = res.pools_;
		var i = 0;
		item.schoolrooms.forEach(function (sch) {
			item.pool.forEach(function (id) {
				if (sch.id === id) {
					sch._selected = true;
					i++;
				}
			});
		});
		if (i == item.schoolrooms.length) {
			$scope._ischeckAll = true;
		}
		role.query(function (res) {
			item.roles = res.result;
			var myrole = res.result.filter(function (role) {
				return role.name === item.permission;
			})[0];
			// if(myrole)
			item.myrole = res.result.filter(function (role) {
				return role.name === item.permission;
			})[0];
			// else
			// 	item.myrole = res.result[0];
			$scope.data = angular.copy(item);
		});
	});
	if (!$scope.owner) $scope.DISABLED = true;
	$scope.changeRole = function (role) {
		if ($scope.data.myrole && $scope.data.myrole.name == "Administrator") {
			role._ischeckAll = true;
			$scope.data.schoolrooms.map(function (schoolroom) {
				return schoolroom._selected = true;
			});
			$scope.DISABLED = true;
		} else {
			$scope.data.schoolrooms.forEach(function (item) {
				item._selected = false;
			});
			item.pool.forEach(function (schoolroom_id) {
				$scope.data.schoolrooms.forEach(function (item) {
					if (item.id === schoolroom_id) {
						item._selected = true;
					}
				});
			});
			if ($scope.data.schoolrooms.filter(function (item) {
				return item._selected == true;
			}).length == $scope.data.schoolrooms.length) role._ischeckAll = true;else role._ischeckAll = false;

			$scope.DISABLED = false;
		}
	};
	$scope.checkAll = function (scope) {
		if (scope._ischeckAll) {
			$scope.data.schoolrooms.map(function (schoolroom) {
				return schoolroom._selected = true;
			});
		} else {
			$scope.data.schoolrooms.map(function (schoolroom) {
				return schoolroom._selected = false;
			});
		}
	};
	$scope.checkOne = function (scope) {
		var schoolrooms = $scope.data.schoolrooms.filter(function (p) {
			return p._selected;
		});
		if (schoolrooms.length === $scope.data.schoolrooms.length) {
			scope._ischeckAll = true;
		} else {
			scope._ischeckAll = false;
		}
	};

	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.data) || angular.equals($scope.currentItem, $scope.data);
	};
	$scope.reset = function () {
		$scope.data = angular.copy($scope.item || $scope.currentItem);
		if ($scope.data.schoolrooms.filter(function (item) {
			return item._selected === true;
		}).length === $scope.data.schoolrooms.length) {
			$scope.$$childTail._ischeckAll = true;
		} else {
			console.log($scope);$scope.$$childTail._ischeckAll = false;
		}
	};

	$scope.edit = function () {
		var user_id = this.data.id;
		var pools = this.data.schoolrooms.filter(function (item) {
			if (item._selected) return item;
		}).map(function (item) {
			return item.id;
		});
		if (pools.length) admin.update({
			id: this.data.id,
			contact: this.data.contact,
			email: this.data.email,
			name: this.data.name,
			real_name: this.data.real_name,
			sex: this.data.sex,
			password: this.data.password,
			pools: pools,
			permission: this.data.myrole.id

		}, function (res) {
			var PERMISSION = item.permission;
			item.name = res.result.name;
			item.real_name = res.result.real_name;
			item.sex = res.result.sex;
			item.email = res.result.email;
			item.contact = res.result.contact;
			item.pool = res.result.pool;
			item.permission = res.name;
			if (user_id === user.id) {
				$$$storage.setSessionStorage('power', $scope.data.roles.filter(function (item) {
					return item.name === res.name;
				})[0].access_key);
				var logInfor = UserRole.currentUser;
				logInfor.keys = $$$storage.getSessionStorage("power");
				logInfor.pool = res.result.pool;
				$$$storage.setSessionStorage("loginInfo", JSON.stringify(logInfor));
				if (item.permission != PERMISSION) {
					location.reload();
				}
			}
			$modalInstance.close();
		}, function () {});else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("POOL_TIP"),
				timeout: 6000
			});
		}
	};

	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("addUserCommonDialog", ["$scope", "$modalInstance", "User", "UserRole", function ($scope, $modalInstance, user, Role) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	$scope.data = {
		sex: 'true',
		role: '2',
		department: $scope.selected.id,
		redactor: Role.currentUser.name

	};
	$scope.master = { sex: 'true', role_desc: '教师' };

	$scope.reset = function () {
		$scope.data = angular.copy($scope.master);
	};
	$scope.isUnchanged = function () {
		return angular.equals($scope.master, $scope.data);
	};

	$scope.ok = function () {
		console.log(666666666, $scope.data);
		user.save($scope.data, function (data) {
			$scope.queryDepart();
			$modalInstance.close();
		});
	};

	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("editUserCommonDialog", ["$scope", "$modalInstance", "User", function ($scope, $modalInstance, user) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	var item = $scope.item || $scope.currentItem;
	$scope.data = angular.copy(item);

	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.data) || angular.equals($scope.currentItem, $scope.data);
	};
	$scope.reset = function () {
		$scope.data = angular.copy($scope.item || $scope.currentItem);
	};
	$scope.edit = function () {
		user.edit({
			id: this.data.id,
			contact: this.data.contact,
			email: this.data.email,
			name: this.data.name,
			real_name: this.data.real_name,
			sex: this.data.sex,
			password: this.data.password,
			passwordConfirm: this.data.password,
			desc: this.data.desc
		}, function (res) {
			$scope.queryDepart();
			$modalInstance.close();
		}, function () {});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("addUserDomainDialog", ["$scope", "$modalInstance", "Server", function ($scope, $modalInstance, Server) {
	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.data) || angular.equals($scope.currentItem, $scope.data);
	};

	$scope.reset = function () {
		$scope.data = angular.copy($scope.item || $scope.currentItem || {});
	};

	$scope.close = function () {
		$modalInstance.close();
	};

	$scope.ok = function () {
		$scope.submiting = true;
		$scope.afterSubmiting = false;
		Server.create($scope.data, function (response) {
			$scope.submiting = false;
			$scope.afterSubmiting = true;
			$scope.rows.unshift(response.result[0]);
			$modalInstance.close();
		}, function () {
			$scope.submiting = false;
			$scope.afterSubmiting = false;
		});
	};

	$scope.data = { "user": "", "passwd": "" };
}]).controller("editUserDomainDialog", ["$scope", "$modalInstance", "Server", function ($scope, $modalInstance, Server) {
	var item = $scope.item || $scope.currentItem || {};
	$scope.data = angular.copy(item);
	Server.get({ "id": item.id }, function (response) {
		var data = response;
		angular.forEach(data, function (value, key) {
			item[key] = data[key];
		});
	}, function () {});

	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.data) || angular.equals($scope.currentItem, $scope.data);
	};

	$scope.reset = function () {
		$scope.data = angular.copy($scope.item || $scope.currentItem || {});
	};

	$scope.close = function () {
		$modalInstance.close();
	};

	$scope.ok = function () {
		$scope.submiting = true;
		$scope.afterSubmiting = false;
		Server.update($scope.data, function (response) {
			var data = response.result[0];
			angular.forEach(data, function (value, key) {
				item[key] = data[key];
			});
			$modalInstance.close();
		}, function () {
			$scope.submiting = false;
			$scope.afterSubmiting = false;
		});
	};
}]).controller("userDoaminAscingDialog", ["$scope", "$modalInstance", "Domain", function ($scope, $modalInstance, Domain) {
	var domainId = parseInt(location.hash.match(/\d+$/)[0]);
	$scope.selected = [];

	Domain.get({ id: domainId }, function (response) {
		$scope.status = 'completed';
		$scope.ous = response.ous;
	}, function () {
		$scope.status = 'completed';
	});

	$scope.ok = function () {
		Domain.asycing({
			id: domainId,
			auto: 0,
			ous: $scope.selected.map(function (item) {
				return item.base_dn;
			})
		}, function (response) {
			response.result.map(function (item) {
				var len = $scope.rows.length,
				    i;
				for (i = 0; i < len; i++) {
					if (item.id == $scope.rows[i].id) {
						$scope.rows[i] = item;
					}
				}
				if (i >= len) {
					$scope.rows.push(item);
				}
			});
			$modalInstance.close();
		}, function () {});
	};

	$scope.select_row = function (item) {
		item._selected = true;
	};
	$scope.select = function (item) {
		if (item) {
			if ($scope.selected.filter(function (d) {
				return d.fullname == item.fullname;
			}).length == 0) $scope.selected.push(item);
		} else {
			$scope.ous.filter(function (item) {
				return item._selected;
			}).forEach(function (d) {
				if ($scope.selected.filter(function (data) {
					return data.fullname == d.fullname;
				}).length == 0) $scope.selected.push(d);
			});
		}
	};
	$scope.removeSelected = function (_item) {
		var index;
		if (!_item) {
			return false;
		}
		index = $scope.selected.indexOf(_item);
		if (index > -1) {
			$scope.selected.splice(index, 1);
		}
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).constant("NavigatorLink", [{
	"key": "Summary",
	"value": "概要",
	"is_group": true,
	icon: "icon-jj-home",
	"url": "/summary"
}, {
	"key": "Resource",
	"value": "资源",
	icon: "icon-jj-cloud",
	"is_group": true,
	"sublist": [{
		"key": "Console",
		"value": "主控管理",
		"is_group": false,
		"belong": "Resource",
		"url": "/resource/console"
	}, {
		"key": "Pool",
		"value": "资源池管理",
		"is_group": false,
		"belong": "Resource",
		"url": "/resource/pool"
	}, {
		"key": "Storage",
		"value": "存储管理",
		"is_group": false,
		"belong": "Resource",
		"url": "/resource/storage"
	}]
}, {
	"key": "Network",
	"value": "网络",
	"is_group": true,
	icon: "icon-jj-017",
	"sublist": [{
		"key": "ManageNetwork",
		"value": "管理网络",
		"is_group": false,
		"belong": "Network",
		"url": "/network/manageNetwork"
	}, {
		"key": "VirtualSwitch",
		"value": "分布式虚拟交换机",
		"is_group": false,
		"belong": "Network",
		"url": "/network/virtualSwitch"
	}, {
		"key": "DataNetwork",
		"value": "数据网络",
		"is_group": false,
		"belong": "Network",
		"url": "/network/dataNetwork"
	}, {
		"key": "DHCP",
		"value": "DHCP",
		"is_group": false,
		"belong": "Network",
		"url": "/network/dhcp"
	}]
}, {
	"key": "Desktop",
	"value": "桌面",
	"is_group": true,
	icon: "icon-jj-pc",
	"sublist": [{
		"key": "Teaching_desktop",
		"value": "教学桌面",
		"is_group": false,
		"belong": "Desktop",
		"url": "/desktop/scene"
	}, {
		"key": "Personal_desktop",
		"value": "个人桌面",
		"is_group": false,
		"belong": "Desktop",
		"url": "/desktop/personal"
	}, {
		"key": "Personal_desktop_pool",
		"value": "个人桌面池",
		"is_group": false,
		"belong": "Desktop",
		"url": "/desktop/pool"
	}]
}, {
	"key": "Template",
	"value": "模板",
	icon: "icon-jj-Template",
	"is_group": true,
	"sublist": [{
		"key": "Teaching_template",
		"value": "教学模板",
		"is_group": false,
		"belong": "Template",
		"url": "/template/teach"
	}, {
		"key": "Personal_template",
		"value": "个人模板",
		"is_group": false,
		"belong": "Template",
		"url": "/template/personal"
	}, {
		"key": "Hardware_template",
		"value": "硬件模板",
		"is_group": false,
		"belong": "Template",
		"url": "/template/hardware"
	}]
}, {
	"key": "Terminal",
	"value": "终端",
	icon: "icon-jj-Terminal",
	"is_group": true,
	"sublist": [{
		"key": "Classroom",
		"value": "教室管理",
		"is_group": false,
		"belong": "Terminal",
		"url": "/terminal/schoolroom"
	}, {
		"key": "Terminal_Manage",
		"value": "终端管理",
		"is_group": false,
		"belong": "Terminal",
		"url": "/terminal/client"
	}]
}, {
	"key": "User",
	"value": "用户",
	icon: "icon-jj-men",
	"is_group": true,
	"sublist": [{
		"key": "Role_Manage",
		"value": "角色管理",
		"is_group": false,
		"belong": "User",
		"url": "/user/role"
	}, {
		"key": "Administrator",
		"value": "管理用户",
		"is_group": false,
		"belong": "User",
		"url": "/user/admin"
	}, {
		"key": "Common_user",
		"value": "普通用户",
		"is_group": false,
		"belong": "User",
		"url": "/user/common"
	}, {
		"key": "Domain_user",
		"value": "域用户",
		"is_group": false,
		"belong": "User",
		"url": "/user/domain"
	}]
}, {
	"key": "Monitor",
	"value": "监控",
	"is_group": true,
	icon: "icon-jj-Monitor",
	"sublist": [{
		"key": "Host_monitoring",
		"value": "主机监控",
		"is_group": false,
		"belong": "Monitor",
		"url": "/monitor/host"
	}, {
		"key": "Desktop_monitoring",
		"value": "桌面监控",
		"is_group": false,
		"belong": "Monitor",
		"url": "/monitor/desktop"
	}, {
		"key": "Alarm_information",
		"value": "告警信息",
		"is_group": false,
		"belong": "Monitor",
		"url": "/monitor/alarm"
	}, {
		"key": "Alarm_policy",
		"value": "告警策略",
		"is_group": false,
		"belong": "Monitor",
		"url": "/monitor/policy"
	}]
}, {
	"key": "Timetable",
	"value": "排课",
	"is_group": true,
	icon: "icon-jj-paike",
	"sublist": [{
		"key": "Course_list",
		"value": "课程列表",
		"is_group": false,
		"belong": "Timetable",
		"url": "/scheduler/view"
	}]
}, {
	"key": "Plan",
	"value": "计划任务",
	"is_group": true,
	icon: "icon-jj-012",
	"sublist": [{
		"key": "Timer_switch",
		"value": "定时开关机",
		"is_group": false,
		"belong": "Plan",
		"url": "/plan/switch"
	}, {
		"key": "Host_switch",
		"value": "主机定时开关机",
		"is_group": false,
		"belong": "Plan",
		"url": "/plan/hostSwitch"
	}]
}, {
	"key": "HA",
	"value": "高可用性",
	"is_group": true,
	icon: "icon-jj-001",
	"sublist": [{
		"key": "desktop_ha",
		"value": "桌面HA",
		"is_group": false,
		"belong": "HA",
		"url": "/HA/desktop"
	}]
}, {
	"key": "System",
	"value": "系统",
	"is_group": true,
	icon: "icon-jj-Setup",
	"sublist": [{
		"key": "System_deploy",
		"value": "快速部署",
		"is_group": false,
		"belong": "System",
		"url": "/system/deploy"
	}, {
		"key": "System_desktop",
		"value": "系统桌面",
		"is_group": false,
		"belong": "System",
		"url": "/system/desktop"
	}, {
		"key": "System_ISO",
		"value": "系统 ISO",
		"is_group": false,
		"belong": "System",
		"url": "/system/iso"
	}, {
		"key": "USB_redirection",
		"value": "USB 重定向",
		"is_group": false,
		"belong": "System",
		"url": "/system/usb"
	}, {
		"key": "USB_through",
		"value": "USB 透传",
		"is_group": false,
		"belong": "System",
		"url": "/system/through"
	}, {
		"key": "AutoSnapshot",
		"value": "自动快照",
		"is_group": false,
		"belong": "System",
		"url": "/system/snapshot"
	}, {
		"key": "System_set",
		"value": "系统设置",
		"is_group": false,
		"belong": "System",
		"url": "/system/set"
	},
	// {
	// 	"key": "USB_device",
	// 	"value": "主机 USB 设备",
	// 	"is_group": false,
	// 	"belong": "System",
	// 	"url": "/system/device"
	// },
	{
		"key": "System_backup",
		"value": "系统备份",
		"is_group": false,
		"belong": "System",
		"url": "/system/backup"
	}, {
		"key": "System_upgrade",
		"value": "系统升级",
		"is_group": false,
		"belong": "System",
		"url": "/system/upgrade"
	}, {
		"key": "Operation_log",
		"value": "操作日志",
		"is_group": false,
		"belong": "System",
		"url": "/system/logs"
		// {
		// 	"key": "End_log",
		// 	"value": "后台日志",
		// 	"is_group": false,
		// 	"belong": "System",
		// 	"url": "/system/endlogs"
		// }
	}]
}, {
	"key": "About",
	"value": "关于",
	icon: "icon-jj-about-1",
	"is_group": true,
	"url": "/about"
}]);

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.desktop", [])

/* 场景 */
.factory("Scene", ["$resource", function ($resource) {
	return $resource("/thor/pool/modes", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" },
		get: { method: "GET", url: "/thor/pool/mode/:id", params: { id: "@id" } },
		update: { method: "POST", url: "/thor/pool/mode/:id", params: { id: "@id" } },
		active: { method: "PUT", url: "/thor/pool/mode/:id", params: { id: "@id" } },
		powerOn: { method: "POST", url: "/thor/pool/mode/action" },
		powerOff: { method: "POST", url: "/thor/pool/mode/action" },
		forcePowerOff: { method: "POST", url: "/thor/pool/mode/action" },
		haConfig: { method: "GET", url: "/thor/pool/mode/haConfig/:id", params: { id: "@id" } },
		sort: { method: "POST", url: "/thor/pool/modes/order" }

	});
}])
/*教学桌面 */
.factory("TeachDesktop", ["$resource", function ($resource) {
	return $resource("/thor/instance/mode/:id", { id: "@id" }, {
		query: { method: "GET", isArray: false },
		delete: { method: "DELETE", url: "/thor/instances" },
		reset: { method: "POST", url: "/thor/instance/mode/reset" },
		save: { method: "POST" },
		get: { method: "GET", url: "/thor/instance/:id", params: { id: "@id" }, isArray: false },
		start: { method: "POST", url: "/thor/instances/starts" },
		shutdown: { method: "POST", url: "/thor/instances/shutdowns" },
		pause: { method: "POST", url: "/thor/instances/pause" },
		resume: { method: "POST", url: "/thor/instances/unpause" },
		reboots: { method: "POST", url: "/thor/instances/reboots" },
		screenshot: { method: "POST", url: "/thor/instances/screenshot" },
		rename: { method: "POST", url: "/thor/pool/mode/instance/rename" }
	});
}])
/*个人桌面 */
.factory("PersonDesktop", ["$resource", function ($resource) {
	return $resource("/thor/instance/:id", { id: "@id" }, {
		query: { method: "GET", url: "/thor/instances", isArray: false },
		delete: { method: "DELETE", url: "/thor/instances" },
		save: { method: "POST", url: "/thor/instance" },
		get: { method: "GET", isArray: false },
		update: { method: "PUT" },
		start: { method: "POST", url: "/thor/instance/starts" },
		shutdown: { method: "POST", url: "/thor/instance/shutdowns" },
		pause: { method: "POST", url: "/thor/instance/pause" },
		resume: { method: "POST", url: "/thor/instance/unpause" },
		reboot: { method: "POST", url: "/thor/instance/reboots" },
		migrate: { method: "post", url: "/thor/instance/livemigration/:id", params: { "id": "@id" } },
		screenshot: { method: "POST", url: "/thor/instances/screenshot/:id", params: { "id": "@id" } },
		saveAsTemplate: { method: "POST", url: "/thor/instance/saveTemplate" },
		//移动至
		moveHostList: { method: "GET", url: "/thor/ha/instance/move" },
		moveTo: { method: "POST", url: "/thor/ha/instance/move" },
		//获取无源数据盘
		list_passive_disk: { method: "GET", url: "/thor/list_passive_volume" },
		//获取桌面详情信息
		list_detail: { method: "GET", url: "/thor/get_instance_details/:id", params: { "id": "@id" } },
		// 个人模板获取有哪些个人桌面会更新
		update_instance: { method: "GET", url: "/thor/instance/image/:id", params: { "id": "@id" } },
		check_can_migrate_host: { method: "POST", url: "/thor/check_can_migrate_host" },
		share_servers: { method: "GET", url: "/thor/share/servers" }
	});
}])
/*个人桌面池*/
.factory('DeskPool', ['$resource', function ($resource) {
	return $resource("/thor/instances/pool/:id", { id: "@id" }, {
		query: { method: "GET", isArray: false },
		delete: { method: "DELETE", url: "/thor/instances/pool" },
		save: { method: "POST", url: "/thor/instances/pool" },
		get: { method: "GET", isArray: false },
		update: { method: "PUT", url: "/thor/instance/pool/:id", params: { "id": "@id" } },
		start: { method: "POST", url: "/thor/instances/pool/action" },
		shutdown: { method: "POST", url: "/thor/instances/pool/action" },
		pause: { method: "POST", url: "/thor/instances/pool/pause" },
		resume: { method: "POST", url: "/thor/instances/pool/unpause" },
		reboot: { method: "POST", url: "/thor/instances/pool/reboots" },
		migrate: { method: "post", url: "/thor/instances/livemigration/:id", params: { "id": "@id" } },
		screenshot: { method: "POST", url: "/thor/instances/screenshot/:id", params: { "id": "@id" } },
		saveAsTemplate: { method: "POST", url: "/thor/instances/saveTemplate" },
		//移动至
		moveHostList: { method: "GET", url: "/thor/ha/instances/pool/move" },
		moveTo: { method: "POST", url: "/thor/ha/instances/move" },
		//获取无源数据盘
		list_passive_disk: { method: "GET", url: "/thor/list_passive_volume" },
		//获取桌面详情信息
		list_detail: { method: "GET", url: "/thor/get_instance_details/:id", params: { "id": "@id" } },
		// 个人模板获取有哪些个人桌面会更新
		update_instance: { method: "GET", url: "/thor/instances/image/:id", params: { "id": "@id" } }
	});
}])
/*个人桌面池详情*/
.factory("DeskPoolSecond", ["$resource", function ($resource) {
	return $resource("/thor/instances/pool", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" },
		get: { method: "GET", url: "/thor/instance/pool/:id", params: { id: "@id" } },
		update: { method: "POST", url: "/thor/instance/pool/:id", params: { id: "@id" } },
		active: { method: "PUT", url: "/thor/instance/pool/:id", params: { id: "@id" } },
		start: { method: "POST", url: "/thor/instance/starts" },
		shutdown: { method: "POST", url: "/thor/instance/shutdowns" },
		pause: { method: "POST", url: "/thor/instance/pause" },
		resume: { method: "POST", url: "/thor/instance/unpause" },
		reboots: { method: "POST", url: "/thor/instance/reboots" },
		moveHostList: { method: "GET", url: "/thor/ha/instance/move" },
		moveTo: { method: "POST", url: "/thor/ha/instance/move" }
	});
}])
//教学桌面--桌面修改
.factory("SenceAlter", ["$resource", function ($resource) {
	var res = $resource("/thor/pool/mode/new", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" }
	});
	return res;
}])

/* 教学、个人公用 */
.factory("VMCommon", ["$resource", function ($resource) {
	var base_url = "/thor/instance";
	return $resource(base_url, { id: "@id" }, {
		start: { method: "POST", url: base_url + "/starts" },
		shutdowns: { method: "POST", url: base_url + "/shutdowns" },
		pause: { method: "POST", url: base_url + "/pause" },
		resume: { method: "POST", url: base_url + "/unpause" },
		reboots: { method: "POST", url: base_url + "/reboots" },
		screenshot: { method: "POST", url: base_url + "/screenshot" },
		// 列出桌面快照
		list_snapshot: { method: "GET", url: base_url + "/snapshot" },
		// 创建快照
		take_snapshot: { method: "POST", url: base_url + "/snapshot" },
		restore_snapshot: { method: "POST", url: base_url + "/snapshot" },
		delete_snapshot: { method: "DELETE", url: base_url + "/snapshot" },
		// 获取在线迁移主机
		get_live_move_hosts: { method: "GET", url: "/thor/ha/instance/live/move" },
		//在线迁移
		live_move: { method: "POST", url: "/thor/ha/instance/live/move" },
		list_template: { method: "GET", url: "/thor/image/simple/:type", params: { "type": "@type" } }
	});
}])
// 筛选出选中的元素。若field参数存在，算出所有选中元素field字段的累计值
.filter('selectedFilter', function () {
	return function (list, field) {
		if (list) {
			if (field) {
				var _list = list.filter(function (item) {
					return item._selected;
				}).map(function (item) {
					return item[field];
				});
				return _list.length ? _list.reduce(function (a, b) {
					return a + b;
				}) : 0;
			} else {
				return list.filter(function (item) {
					return item._selected;
				});
			}
		}
	};
})
// 个人桌面列表控制器
.controller("vdiDesktopPersonalListController", ["$scope", "$modal", "PersonDesktop", "VMCommon", "$interval", "$filter", "PersonTemplate", "$$$os_types", "$$$I18N", "Server", "UserRole", "$location", "$q", "Admin", "User", "Depart", "TreeInstances", function ($scope, $modal, person_desktop, vm, $interval, $filter, tmpl, $$$os_types, $$$I18N, Server, UserRole, $location, $q, Admin, UsercommonList, Depart, TreeInstances) {
	var hasTerminalpermission = UserRole.currentUserRoles.filter(function (role) {
		return role == 'Terminal';
	}).length;
	var hasTerminalManagepermission = UserRole.currentUserRoles.filter(function (role) {
		return role == 'Terminal_Manage';
	}).length;
	var hasClassroompermission = UserRole.currentUserRoles.filter(function (role) {
		return role == 'Classroom';
	}).length;
	$scope.linkTerminal = hasTerminalpermission && hasTerminalManagepermission && hasClassroompermission ? true : false;
	$scope.inCurrentUserPool = function (pool) {
		if ($$$storage.getSessionStorage("loginInfo")) return JSON.parse($$$storage.getSessionStorage("loginInfo")).pool.indexOf(pool) > -1;
	};

	if ($location.$$search.name) $scope.searchText = decodeURIComponent($location.$$search.name);

	$interval(function () {
		var filterSearch = $filter("filter")($scope.rows || [], $scope.searchText);
		var filterSearchPage = $filter("paging")(filterSearch, $scope.currentPage, $scope.pagesize);
		$scope.rows && $scope.$root && $scope.$root.$broadcast("instanceIDS", filterSearchPage.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("instancesRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (item.task_state) {
				item.other_status = 'other';
			} else {
				item.other_status = 'certain';
			}
			if (item.status == 'updating' || item.status == 'making') {
				item._ignore = true;
			} else {
				item._ignore = false;
			}
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
		// $scope.updateData("", $scope.select, $scope.depart);
	});
	$scope.getObjLength = function (obj) {
		try {
			return Object.keys(obj).length;
		} catch (err) {
			return 0;
		}
	};

	$scope.depart = { name: '全部', id: -1, full_path: 'root' };
	$scope.refresh = function () {
		var _s = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : $scope;

		_s.depart = $$$storage.getSessionStorage('depart') ? JSON.parse($$$storage.getSessionStorage('depart')) : $scope.depart;
		person_desktop.query(function (res) {
			// _s.rows = _s.select==''?res.result:res.result.filter(function(item){ return item.status == _s.select });
			res.result.forEach(function (desk) {
				if (desk.user_group == "") {
					desk.user_group = $$$I18N.get("管理用户");
				}
				if (desk.task_state) {
					desk.other_status = 'other';
				} else {
					desk.other_status = 'certain';
				}
				if (desk.status == 'updating' || desk.status == 'making') {
					desk._ignore = true;
				} else {
					desk._ignore = false;
				}
			});
			_s.allRows = res.result;
			_s.updateData("", _s.select, _s.depart);
			_s.rows.forEach(function (row) {
				var os = $$$os_types.filter(function (item) {
					return item.key === row.os_type;
				})[0];
				os && os.icon && (row.icon = os.icon);
				row.detailData = {};
			});
			_s.loading = false;
		});
	};
	$scope.getDetail = function (it) {
		$scope.loading_detail = true;
		person_desktop.list_detail({ id: it.id }, function (res) {
			it.detailData = res.result;
		}).$promise.finally(function () {
			$scope.loading_detail = false;
		});
	};
	$scope.expand = function (row) {
		$scope.rows.forEach(function (r) {
			if (row.id === r.id) {
				r._expand = !row._expand;
				if (r._expand) {
					$scope.getDetail(row);
				}
			} else {
				r._expand = false;
			}
		});
	};
	$scope.pagesize = Number($$$storage.getSessionStorage('personl_pagesize')) || 30;
	$scope.currentPage = 1;
	$scope.$watch("pagesize", function (newvalue) {
		$$$storage.setSessionStorage('personl_pagesize', newvalue);
	});
	$scope.loading = true;
	$scope.rows = [];
	$scope.refresh();
	$scope.openAddDomainDialog = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.is_domain_user && !row.ad_server_name;
		});
		if (rows.length === 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalDomain_TIP1"),
				timeout: 6000
			});
			return;
		}
		var modal = $modal.open({
			templateUrl: "views/vdi/dialog/desktop/add_server.html",
			controller: "personalAddServerDialog",
			resolve: { param: function param() {
					return angular.copy(rows);
				} }
		});
		modal.result.then(function (res) {
			$scope.refresh();
		});
	};
	$scope.personExitDomain = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.ad_server_name;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalDomain_TIP2"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='退域'>" + "退域</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='DOMAIN_EXIT_TIP'>所选桌面在下一次开机时，将自动执行退域的操作，是否确定？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						Server.domain_set_person({
							instance_ids: rows.map(function (row) {
								return row.id;
							}),
							has_domain: false
						}, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.updateData = function (text, select, depart) {
		$$$storage.setSessionStorage('depart', JSON.stringify(depart));
		$scope.rows = $scope.allRows.filter(function (row) {
			row._selected = false;
			if (select) {
				if (text && text.trim()) {
					return row.status === select || row.other_status === select;
				}
				return row.status === select || row.other_status === select;
			}
			return true;
		});
		var ids = [];
		if (depart.type == 'common') {
			$scope.rows = $scope.rows.filter(function (it) {
				return it.user_group.indexOf(depart.dept_name) > -1;
			});
		} else if (depart.type == 'domain') {
			$scope.rows = $scope.rows.filter(function (it) {
				return it.user_group === depart.domain_name;
			});
		} else if (depart.type == 'admin') {
			$scope.rows = $scope.rows.filter(function (it) {
				return it.user === depart.name;
			});
		} else if (depart.type == 'adminAll') {
			$scope.rows = $scope.rows.filter(function (it) {
				return it.user_group == $$$I18N.get("管理用户");
			});
		}
	};

	var _controllerScope = $scope;
	/**
 * [selectMode 部门域选择]
 */
	$scope.selectMode = function () {
		$modal.open({
			templateUrl: "views/vdi/dialog/desktop/personal_user_group.html",
			size: 'sm-md',
			controller: function controller($scope, $modalInstance) {
				function formatData(d, name) {
					iteration(d, name);
					return d;
				}
				function iteration(data, childName) {
					for (var i = 0; i < data.length; i++) {
						data[i]['type'] = 'common';
						data[i]['name'] = data[i]['dept_name'];
						$scope.expandnodes.push(data[i]);
						if (data[i][childName] && data[i][childName].length) {
							var len = iteration(data[i][childName], childName);
							if (len === 0) {
								data[i] = undefined;
							}
						}
						if (data[i][childName] && data[i][childName].length === 0) {
							data[i] = undefined;
						}
					}
					for (i = 0; i < data.length; i++) {
						if (data[i] === undefined) {
							data.splice(i, 1);
						}
					}
					return data.length;
				}
				function getAdminNum(rows) {
					return rows.reduce(function (count, item) {
						return count + item.desktop_num;
					}, 0);
				}
				$scope.loading = true;
				TreeInstances.query(function (res) {
					$scope.loading = false;
					res.result.forEach(function (item) {
						if (item.dept_name) {
							item.name = item.dept_name;
						} else if (item.domain_name) {
							item.name = item.domain_name;
						} else {}
					});
					$scope.expandnodes = [];
					var adminData = res.result.filter(function (item) {
						return item.type == 'admin';
					});
					var admins = [{ name: $$$I18N.get("管理用户"), type: 'adminAll', children: adminData, desktop_num: getAdminNum(adminData) }];
					var domains = res.result.filter(function (item) {
						return item.type == 'domain';
					});
					var commons = res.result.filter(function (item) {
						return item.type == 'common';
					});
					commons = formatData(commons, "children", $scope.expandnodes);
					var all = [{ id: -1, name: $$$I18N.get("全部"), children: admins.concat(commons).concat(domains) }];
					$scope.treedata = all;
					$scope.expandnodes = $scope.expandnodes.concat(admins).concat(adminData).concat(domains).concat(all);
					$scope.selected = $scope.expandnodes.filter(function (item) {
						return item.name == _controllerScope.depart.name;
					})[0];
					$scope.selected._selected = true;
					$scope.showSelected = function (node, selected) {
						node._selected = selected;
						$scope.selected = node;
					};
				});
				$scope.ok = function () {
					_controllerScope.depart = $scope.selected && $scope.selected._selected ? $scope.selected : { name: $$$I18N.get("全部"), id: -1, full_path: 'root' };
					_controllerScope.updateData(_controllerScope.searchText, _controllerScope.select, _controllerScope.depart);
					$modalInstance.close();
				}, $scope.close = function () {
					$modalInstance.close();
				};
			}
		});
	};
	/**
 * [selectMode 部门域选择]_____end
 */

	$scope.start = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'shutdown' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP1"),
				timeout: 6000
			});
		} else {
			vm.start({ instance_ids: rows.map(function (row) {
					return row.instance_id;
				}) }, function () {
				$scope.refresh();
			});
		}
	};

	$scope.forceShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP2"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>" + "桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						vm.shutdowns({ instance_ids: rows.map(function (row) {
								row._selected = false;
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.natureShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP3"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>" + "桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.shutdowns({ is_soft: 'true', instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.restart = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP4"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>" + "桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.reboots({ is_soft: 'true', instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.pause = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'running' && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP5"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>" + "桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.pause({ instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.resume = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'paused' && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP6"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>" + "桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.resume({ instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.hasPausedStatus = function () {
		var flag = false;
		var _selected = $scope.rows.filter(function (row) {
			return row._selected;
		});
		var _hasPaused = _selected.filter(function (row) {
			return row.status == 'paused';
		});
		if (_hasPaused.length == _selected.length) {
			flag = true;
		}
		return flag;
	};
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status !== 'paused';
		});
		var is_running = rows.some(function (row) {
			return row.status == 'running' && !row.task_state;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面删除'>" + "桌面删除</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-show='!is_run' style='margin-bottom:20px;' localize='桌面删除后无法恢复，确定删除桌面吗'>桌面删除后无法恢复，确定删除桌面吗?</p><p ng-show='is_run' style='margin-bottom:20px;' localize='存在未关机的桌面，仍然删除桌面吗'>存在未关机的桌面，仍然删除桌面吗?</p><div ng-show='has_data_disk' style='margin-bottom:20px;'><label class='checkbox-inline'><input class='checkbox' ng-model='delete_disk' type='checkbox'/><span  localize='删除数据盘'>删除数据盘</span></label></div><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.is_run = is_running;
				$scope.delete_disk = true;
				$scope.has_data_disk = rows.some(function (d) {
					return d.local_gb;
				});
				$scope.ok = function () {
					$modalInstance.close();
					person_desktop.delete({
						instance_ids: rows.map(function (row) {
							return row.instance_id;
						}),
						force_delete_data: this.delete_disk
					}, function (data) {
						_controllerScope.refresh();
					}, function (error) {
						_controllerScope.refresh();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.moveto = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var can_migrate_rows = rows.filter(function (item) {
			return item.virtual_type === 'kvm' && item.status == 'shutdown' && !item.task_state;
		});
		if (!can_migrate_rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("DESKTOP_MOVE_TIP1"),
				timeout: 6000
			});
		} else {
			var can_migrate_host = [];
			$scope.moveto_loading = true;
			person_desktop.check_can_migrate_host({ instance_ids: can_migrate_rows.map(function (item) {
					return item.id;
				}) }, function (res) {
				for (var i in res.result) {
					can_migrate_host.push({ id: i, value: res.result[i] });
				};
				can_migrate_host = can_migrate_host.filter(function (item) {
					return item.value;
				});
				$scope.moveto_loading = false;
				if (!can_migrate_host.length) {
					$.bigBox({
						title: $$$I18N.get("INFOR_TIP"),
						content: $$$I18N.get("DESKTOP_MOVE_TIP1"),
						timeout: 6000
					});
					return;
				}
				$modal.open({
					template: "<section id='widget-grid'>\n\t\t\t\t\t\t\t<div class='modal-content'>\n\t\t\t\t\t\t\t\t<div class='modal-header'>\n\t\t\t\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>\xD7</span><span class='sr-only'>Close</span></button>\n\t\t\t\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='\u684C\u9762\u79FB\u52A8'>\u684C\u9762\u79FB\u52A8</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='modal-body'>\n\t\t\t\t\t\t\t\t\t<form class='form-horizontal' novalidate name='movetoForm'>\n\t\t\t\t\t\t\t\t\t\t<div class='form-group'>\n\t\t\t\t\t\t\t\t\t\t\t<label class='control-label col-xs-4' localize='\u9009\u62E9\u76EE\u6807\u4E3B\u673A'>\u9009\u62E9\u76EE\u6807\u4E3B\u673A</label>\n\t\t\t\t\t\t\t\t\t\t\t<div class='col-xs-4'>\n\t\t\t\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize=\"--\u8BF7\u9009\u62E9--\"> --\u8BF7\u9009\u62E9-- </option>\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\n\t\t\t\t\t\t\t\t\t\t<button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='\u786E\u5B9A' ng-disabled='movetoForm.$invalid'>\u786E\u5B9A</button>\n\t\t\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='\u53D6\u6D88'>\u53D6\u6D88</button></footer>\n\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</section>",
					controller: function controller($scope, $modalInstance) {
						$scope.hosts = [];
						$scope.hosts_loading = true;
						person_desktop.moveHostList({ instance_ids: rows.map(function (item) {
								return item.id;
							}) }, function (res) {
							$scope.hosts = res.result;
							$scope.host = $scope.hosts[0];
							$scope.hosts_loading = false;
						});

						$scope.ok = function () {
							var _this = this;
							$scope.loading = true;
							person_desktop.moveTo({ instance_ids: can_migrate_host.map(function (item) {
									return item.id;
								}), host: _this.host }, function () {
								$modalInstance.close();
								$.bigBox({
									title: $$$I18N.get("INFOR_TIP"),
									content: $$$I18N.get("桌面移动成功"),
									timeout: 6000
								});
							}).$promise.finally(function () {
								$scope.loading = false;
							});
						}, $scope.close = function () {
							$modalInstance.close();
						};
					},
					size: "md"
				});
			});
		}
	};
	$scope.migration = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status === 'running' && !row.task_state;
		});
		if (!rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("DESKTOP_MOVE_TIP2"),
				timeout: 6000
			});
			return;
		}
		$modal.open({
			template: "<section id='widget-grid'>\n\t\t\t\t\t<div class='modal-content'>\n\t\t\t\t\t\t<div class='modal-header'>\n\t\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>\xD7</span><span class='sr-only'>Close</span></button>\n\t\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='\u52A8\u6001\u8FC1\u79FB'></h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='modal-body'>\n\t\t\t\t\t\t\t<form class='form-horizontal' novalidate name='movetoForm'>\n\t\t\t\t\t\t\t\t<div class='form-group'>\n\t\t\t\t\t\t\t\t\t<label class='control-label col-xs-4' localize='\u9009\u62E9\u76EE\u6807\u4E3B\u673A'>\u9009\u62E9\u76EE\u6807\u4E3B\u673A</label>\n\t\t\t\t\t\t\t\t\t\t<div class='col-xs-4'>\n\t\t\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize=\"--\u8BF7\u9009\u62E9--\">\u8BF7\u9009\u62E9</option>\n\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\n\t\t\t\t\t\t\t\t\t\t<a style=\"position: relative;top: 5px;\" ng-if=\"!hosts_loading && !hosts.length\" class=\"mypopover\" htmlpopover='{{migrationTip}}'><i class=\"fa fa-question-circle\"></i></a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<footer class='text-right'>\n\t\t\t\t\t\t\t\t\t\t<img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\n\t\t\t\t\t\t\t\t\t\t<button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='\u786E\u5B9A' ng-disabled='movetoForm.$invalid'>\u786E\u5B9A</button>\n\t\t\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='\u53D6\u6D88'>\u53D6\u6D88</button>\n\t\t\t\t\t\t\t\t\t</footer>\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</section>",
			controller: function controller($scope, $modalInstance) {
				$scope.hosts = [];
				$scope.hosts_loading = true;
				$scope.migrationTip = $$$I18N.get('migrationTip');
				vm.get_live_move_hosts({ instance_ids: rows.map(function (item) {
						return item.id;
					}) }, function (res) {
					$scope.hosts = res.result;
					$scope.host = $scope.hosts[0];
					$scope.hosts_loading = false;
				});
				$scope.ok = function () {
					var _this = this;
					$scope.loading = true;
					vm.live_move({
						instance_ids: rows.map(function (item) {
							return item.id;
						}),
						host: _this.host
					}, function () {
						$modalInstance.close();
						$.bigBox({
							title: $$$I18N.get("INFOR_TIP"),
							content: $$$I18N.get("桌面迁移成功"),
							timeout: 6000
						});
					}).$promise.finally(function () {
						$scope.loading = false;
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "md"
		});
	};
	$scope.view = function (item) {
		window.open("desktopScreenshot.html#" + item.id, "person_desktop_" + item.id);
	};
	$scope.viewStorage = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/desktop/view_storage.html",
			controller: ['$scope', '$modalInstance', function ($scope, $modalInstance) {
				person_desktop.list_detail({ id: item.id }, function (res) {
					$scope.data = res.result;
					$scope.data.hostname = item.hostname;
				});
				$scope.close = function () {
					$modalInstance.close();
				};
			}]
		});
	};
}]).controller("vdiDesktopTeachListController", ["$scope", "$route", "$modal", "$routeParams", "TeachDesktop", "PersonDesktop", "VMCommon", "$interval", "$filter", "$$$I18N", "UserRole", "$location", function ($scope, $route, $modal, $routeParams, teach_desktop, person_desktop, vm, $interval, $filter, $$$I18N, UserRole, $location) {
	if ($location.$$search.name) $scope.searchText = decodeURIComponent($location.$$search.name);

	var user = UserRole.currentUser;
	if (!user) {
		return;
	}
	$scope.rows = [];
	$scope.loading = true;
	$scope.refresh = getList;
	$interval(function () {
		var filterSearch = $filter("filter")($scope.rows || [], $scope.searchText);
		var filterSearchPage = $filter("paging")(filterSearch, $scope.currentPage, $scope.pagesize);
		$scope.$root && $scope.rows && $scope.$root.$broadcast("instanceIDS", filterSearchPage.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("instancesRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (item.task_state) {
				item.other_status = 'other';
			} else {
				item.other_status = 'certain';
			}
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
		// $scope.updateData($scope.searchText, $scope.select);
	});

	var _controllerScope = $scope;
	var _id = $route.current.params.id;
	function getList() {
		teach_desktop.query({ id: _id }, function (res) {
			res.result.forEach(function (desk) {
				if (desk.task_state) {
					desk.other_status = 'other';
				} else {
					desk.other_status = 'certain';
				}
			});
			_controllerScope.rows = res.result.sort(function (a, b) {
				var _numa, _numb;
				var get_num = function get_num(tar) {
					for (var i = tar.length - 1; i--; i >= 0) {
						if (!Number(tar[i])) {
							return Number(tar.substring(i + 1, tar.length));
						}
					}
				};
				_numa = get_num(a.display_name);
				_numb = get_num(b.display_name);
				return (_numa - _numb) * (false ? -1 : 1);
			});
			_controllerScope.allRows = res.result;
			_controllerScope.res = res;
			_controllerScope.loading = false;
			_controllerScope.$root && $scope.$root.$broadcast("navItemSelected", ["桌面", "教学桌面", res.mode_name]);
		}, function (error) {
			location.replace("#desktop/scene/");
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("NOEXSIT_SECNE_TIP"),
				timeout: 6000
			});
		});
	}
	getList();
	$scope.refresh = getList;
	$scope.pagesize = parseInt($$$storage.getSessionStorage('teach_pagesize')) || 30;
	$scope.currentPage = 1;

	$scope.$watch("pagesize", function (newvalue) {
		if (newvalue) {
			$$$storage.setSessionStorage('teach_pagesize', newvalue);
		}
	});
	// $scope.$watch("select",function(newvalue){
	// 	if(newvalue && $scope.allRows){
	// 		$scope.rows = $scope.allRows.filter(function(item){ return item.status == newvalue});
	// 		$$$storage.setSessionStorage('status', newvalue);
	// 	}
	// });	
	$scope.updateData = function (text, select) {
		$scope.rows = $scope.allRows.filter(function (row) {
			row._selected = false;
			if (select) {
				if (text && text.trim()) {
					return row.status === select || row.other_status === select;
				}
				return row.status === select || row.other_status === select;
			}
			return true;
		});
	};
	$scope.sortDesktopName = function (name, bool) {
		$scope.rows.sort(function (a, b) {
			var _numa, _numb;
			var get_num = function get_num(tar) {
				for (var i = tar.length - 1; i--; i >= 0) {
					if (!Number(tar[i])) {
						return Number(tar.substring(i + 1, tar.length));
					}
				}
			};
			_numa = get_num(a[name]);
			_numb = get_num(b[name]);
			return (_numa - _numb) * (bool ? -1 : 1);
		});
	};

	$scope.start = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'shutdown' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopTeachList_TIP1"),
				timeout: 6000
			});
		} else {
			rows.map(function (row) {
				row._selected = false;
			});
			vm.start({ instance_ids: rows.map(function (row) {
					return row.instance_id;
				}) }, function () {
				_controllerScope.refresh();
			});
		}
	};

	$scope.forceShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopTeachList_TIP2"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>" + "桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.shutdowns({ instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.natureShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopTeachList_TIP3"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>" + "桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.shutdowns({ is_soft: 'true', instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.restart = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopTeachList_TIP4"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>" + "桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.reboots({ is_soft: 'true', instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.pause = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'running' && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopTeachList_TIP5"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>" + "桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.pause({ instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.resume = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'paused' && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopTeachList_TIP6"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>" + "桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
						});
						vm.resume({ instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.reset = function (item) {
		var row = item;
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重置'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定重置桌面吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					teach_desktop.reset({ instance_id: row.instance_id }, function (data) {
						$.bigBox({
							title: $$$I18N.get("操作结果"),
							content: $$$I18N.get("重置成功"),
							timeout: 5000
						});
						_controllerScope.refresh();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.alter = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/desktop/teach_alter.html",
			controller: function controller($scope, $modalInstance) {
				$scope.vm_hostname = item.vm_hostname;
				$scope.post = function () {
					var _this = this;
					teach_desktop.rename({
						'instance_ids': [item.id],
						'instance_name': _this.vm_hostname
					}, function () {
						$modalInstance.close();
						_controllerScope.refresh();
					});
				};
				$scope.close = function () {
					$modalInstance.dismiss();
				};
			}
		});
	};
	$scope.rename = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (r) {
			return r._selected && r.status == "shutdown" && !r.task_state;
		});
		if (rows.length) {
			$modal.open({
				templateUrl: "views/vdi/dialog/desktop/teach_rename.html",
				controller: function controller($scope, $modalInstance) {
					$scope.addZero = function (len, str_begin, str_end) {
						if (str_end && str_begin) {
							var end_len = str_end.toString().length;
							if (end_len < len) {
								return str_begin + new Array(len - end_len + 1).join("0") + str_end;
							} else {
								return str_begin + str_end;
							}
						}
					};
					$scope.ok = function () {
						var _this = this;
						teach_desktop.rename({
							'instance_ids': rows.map(function (row) {
								return row.instance_id;
							}),
							'hostname_type': _this.hostNameType,
							'hostname_prefix': _this.hostNamePre,
							'hostname_beginwith': _this.hostNameBegin
						}, function () {
							$modalInstance.close();
							_controllerScope.refresh();
						});
					};
					$scope.close = function () {
						$modalInstance.dismiss();
					};
				}
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopTeachList_TIP7"),
				timeout: 6000
			});
		}
	};
	$scope.view = function (item) {
		window.open("desktopScreenshot.html#" + item.id, "person_desktop_" + item.id);
	};
	$scope.moveto = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var can_migrate_rows = rows.filter(function (item) {
			return item.virtual_type === 'kvm' && item.status == 'shutdown' && !item.task_state;
		});
		if (!can_migrate_rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("DESKTOP_MOVE_TIP1"),
				timeout: 6000
			});
		} else {
			var can_migrate_host = [];
			$scope.moveto_loading = true;
			person_desktop.check_can_migrate_host({ instance_ids: can_migrate_rows.map(function (item) {
					return item.id;
				}) }, function (res) {
				var datas = [];
				for (var i in res.result) {
					can_migrate_host.push({ id: i, value: res.result[i] });
				};
				can_migrate_host = can_migrate_host.filter(function (item) {
					return item.value;
				});
				$scope.moveto_loading = false;
				if (!can_migrate_host.length) {
					$.bigBox({
						title: $$$I18N.get("INFOR_TIP"),
						content: $$$I18N.get("DESKTOP_MOVE_TIP1"),
						timeout: 6000
					});
					return;
				}
				$modal.open({
					template: "<section id='widget-grid'>\n\t\t\t\t\t\t\t<div class='modal-content'>\n\t\t\t\t\t\t\t\t<div class='modal-header'>\n\t\t\t\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>\xD7</span><span class='sr-only'>Close</span></button>\n\t\t\t\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='\u684C\u9762\u79FB\u52A8'>\u684C\u9762\u79FB\u52A8</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='modal-body'>\n\t\t\t\t\t\t\t\t\t<form class='form-horizontal' name='movetoForm' novalidate>\n\t\t\t\t\t\t\t\t\t\t<div class='form-group'>\n\t\t\t\t\t\t\t\t\t\t\t<label class='control-label col-xs-4' localize='\u9009\u62E9\u76EE\u6807\u4E3B\u673A'>\u9009\u62E9\u76EE\u6807\u4E3B\u673A</label>\n\t\t\t\t\t\t\t\t\t\t\t<div class='col-xs-4'>\n\t\t\t\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize='--\u8BF7\u9009\u62E9--'></option>\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<footer class='text-right'>\n\t\t\t\t\t\t\t\t\t\t\t<img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\n\t\t\t\t\t\t\t\t\t\t\t<button class='btn btn-primary' data-ng-click='ok()' ng-if='!loading' localize='\u786E\u5B9A' ng-disabled='movetoForm.$invalid'>\u786E\u5B9A</button>\n\t\t\t\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='\u53D6\u6D88'>\u53D6\u6D88</button>\n\t\t\t\t\t\t\t\t\t\t</footer>\n\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</section>",
					controller: function controller($scope, $modalInstance) {
						$scope.hosts = [];
						$scope.hosts_loading = true;
						person_desktop.moveHostList({ instance_ids: rows.map(function (item) {
								return item.id;
							}) }, function (res) {
							$scope.hosts = res.result;
							$scope.host = $scope.hosts[0];
							$scope.hosts_loading = false;
						});
						$scope.ok = function () {
							var _this = this;
							$scope.loading = true;
							person_desktop.moveTo({ instance_ids: can_migrate_host.map(function (item) {
									return item.id;
								}), host: _this.host }, function () {
								$modalInstance.close();
								$.bigBox({
									title: $$$I18N.get("INFOR_TIP"),
									content: $$$I18N.get("桌面移动成功"),
									timeout: 6000
								});
							}).$promise.finally(function () {
								$scope.loading = false;
							});
						}, $scope.close = function () {
							$modalInstance.close();
						};
					},
					size: "md"
				});
			});
		}
	};
	$scope.migration = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status === 'running' && !row.task_state;
		});
		if (!rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("DESKTOP_MOVE_TIP2"),
				timeout: 6000
			});
			return;
		}
		$modal.open({
			template: "<section id='widget-grid'>\n\t\t\t\t<div class='modal-content'>\n\t\t\t\t\t<div class='modal-header'>\n\t\t\t\t\t\t<button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>\xD7</span><span class='sr-only'>Close</span></button>\n\t\t\t\t\t\t<h4 class='modal-title' id='mySmallModalLabel' localize='\u52A8\u6001\u8FC1\u79FB'></h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='modal-body'>\n\t\t\t\t\t\t<form class='form-horizontal' novalidate name='movetoForm'>\n\t\t\t\t\t\t\t<div class='form-group'><label class='control-label col-xs-4' localize='\u9009\u62E9\u76EE\u6807\u4E3B\u673A'>\u9009\u62E9\u76EE\u6807\u4E3B\u673A</label>\n\t\t\t\t\t\t\t\t<div class='col-xs-4'>\n\t\t\t\t\t\t\t\t\t<select class='form-control' ng-model='host' ng-options='host for host in hosts' required>\n\t\t\t\t\t\t\t\t\t\t<option value=\"\" localize=\"--\u8BF7\u9009\u62E9--\">\u8BF7\u9009\u62E9</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<img style=\"position: relative;top: 3px\" ng-if=\"hosts_loading\" width=\"24\" height=\"24\" src=\"img/HLloading.gif\">\n\t\t\t\t\t\t\t\t<a style=\"position: relative;top: 5px;\" ng-if=\"!hosts_loading && !hosts.length\" class=\"mypopover\" htmlpopover='{{migrationTip}}'><i class=\"fa fa-question-circle\"></i></a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<footer class='text-right'>\n\t\t\t\t\t\t\t\t<img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''>\n\t\t\t\t\t\t\t\t<button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='\u786E\u5B9A' ng-disabled='movetoForm.$invalid'>\u786E\u5B9A</button>\n\t\t\t\t\t\t\t\t<button ng-if='!loading' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='\u53D6\u6D88'>\u53D6\u6D88</button>\n\t\t\t\t\t\t\t</footer>\n\t\t\t\t\t\t</form>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>",
			controller: function controller($scope, $modalInstance) {
				$scope.hosts = [];
				$scope.hosts_loading = true;
				$scope.migrationTip = $$$I18N.get('migrationTip');
				vm.get_live_move_hosts({ instance_ids: rows.map(function (item) {
						return item.id;
					}) }, function (res) {
					$scope.hosts = res.result;
					$scope.host = $scope.hosts[0];
					$scope.hosts_loading = false;
				});
				$scope.ok = function () {
					var _this = this;
					$scope.loading = true;
					vm.live_move({
						instance_ids: rows.map(function (item) {
							return item.id;
						}),
						host: _this.host
					}, function () {
						$modalInstance.close();
						$.bigBox({
							title: $$$I18N.get("INFOR_TIP"),
							content: $$$I18N.get("桌面迁移成功"),
							timeout: 6000
						});
					}).$promise.finally(function () {
						$scope.loading = false;
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "md"
		});
	};
	$scope.viewStorage = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/desktop/view_storage.html",
			controller: ['$scope', '$modalInstance', function ($scope, $modalInstance) {
				$scope.loading = true;
				person_desktop.list_detail({ id: item.id }, function (res) {
					$scope.data = res.result;
					$scope.data.hostname = item.hostname;
				}).$promise.finally(function () {
					$scope.loading = false;
				});
				$scope.close = function () {
					$modalInstance.close();
				};
			}]
		});
	};
}]).controller("vdiDesktopSceneListController", ["$scope", "$modal", "Scene", "$filter", "TeachTemplate", "SchoolRoom", "$$$I18N", "UserRole", "$interval", "$q", "Server", function ($scope, $modal, scene, $filter, template, SchoolRoom, $$$I18N, UserRole, $interval, $q, Server) {
	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("modeIDS", $filter("paging")($scope.rows, $scope.currentPage, $scope.pagesize).map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("modesRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (item.status == 'updating' || item.status == 'making') {
				item._ignore = true;
			} else {
				item._ignore = false;
			}
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
	});
	var user = UserRole.currentUser;
	if (user === null) {
		return;
	}
	$scope.loading = true;
	$scope.searchText = "";
	$scope.selectLoading = true;
	$scope.rows = [];
	$scope.allRows = [];
	$scope.refresh = getList;
	$scope.classrooms = [];

	var _controllerScope = $scope;
	var _loginPool = user.pool;
	var _loginClassroom = $$$storage.getSessionStorage('classroom');

	getList();

	function getList() {
		$q.all([UserRole.refreshSession(), SchoolRoom.query().$promise, scene.query().$promise]).then(function (arr) {
			var userId = user.id;
			var session = arr[0];
			// filter by user
			var schoolrooms = arr[1].pools_.filter(function (item) {
				return item.user_ids.some(function (id) {
					return id === userId;
				});
			});
			var ownedIds = session.user.pool;
			// filter by schoolroom id
			schoolrooms = schoolrooms.filter(function (item) {
				return ownedIds.indexOf(item.id) > -1;
			});
			var cachedPoolId = $$$storage.getSessionStorage('scene_page_classroom') * 1 || null;
			if (cachedPoolId && ownedIds.indexOf(cachedPoolId) > -1 && !_controllerScope.select) {
				_controllerScope.select = cachedPoolId;
			}
			_controllerScope.classrooms = schoolrooms;
			// 处理场景数据
			var sceneData = arr[2];
			// 2017-08-18: 根据时间降序
			sceneData.modes.sort(function (a, b) {
				return a.created_at > b.created_at ? -1 : 1;
			});
			sceneData.modes.forEach(function (item) {
				if (item.status == 'updating' || item.status == 'making') {
					item._ignore = true;
				} else {
					item._ignore = false;
				}
			});
			_controllerScope.allRows = sceneData.modes;
			// 过滤当前教室对应场景
			_controllerScope.updateData("", _controllerScope.select);
		}).finally(function () {
			_controllerScope.selectLoading = false;
			_controllerScope.loading = false;
		});
	}
	$scope.refresh = getList;

	function getRealTimeRows() {
		var filterPages = $filter("paging")($scope.rows, $scope.currentPage, $scope.pagesize);
		var filterPagesAndSeatches = $filter("filter")(filterPages, $scope.searchText);
		return filterPagesAndSeatches;
	}
	$scope.getTotalCount = function (rows) {
		return getRealTimeRows().reduce(function (count, item) {
			return count + item.instances_count;
		}, 0);
	};

	$scope.getRunningCount = function (rows) {
		return getRealTimeRows().reduce(function (count, item) {
			return count + item.running_count;
		}, 0);
	};

	$scope.getShutdownCount = function (rows) {
		return getRealTimeRows().reduce(function (count, item) {
			return count + item.shutdown_count;
		}, 0);
	};
	$scope.getPausedCount = function (rows) {
		return getRealTimeRows().reduce(function (count, item) {
			return count + item.paused_count;
		}, 0);
	};
	$scope.getNostateCount = function (rows) {
		return getRealTimeRows().reduce(function (count, item) {
			return count + item.nostate_count;
		}, 0);
	};
	$scope.getErrorCount = function (rows) {
		return getRealTimeRows().reduce(function (count, item) {
			return count + item.error_count;
		}, 0);
	};
	$scope.getOtherCount = function (rows) {
		return getRealTimeRows().reduce(function (count, item) {
			return count + item.other_count;
		}, 0);
	};

	$scope.cacheValue = function (v) {
		$$$storage.setSessionStorage('scene_page_classroom', v);
	};

	$scope.updateData = function (text, pid) {
		if (pid) {
			$scope.rows = $scope.allRows.filter(function (row) {
				return row.pool === pid;
			});
		} else {
			var _rows = [];
			$scope.allRows.forEach(function (item) {
				var isInClassrooms = _controllerScope.classrooms.filter(function (room) {
					return room.id === item.pool;
				}).length;
				if (isInClassrooms) {
					_rows.push(item);
				}
			});
			$scope.rows = _rows;
		}
	};

	$scope.pagesize = parseInt($$$storage.getSessionStorage('scene_pagesize')) || 30;
	$scope.currentPage = 1;

	$scope.$watch("pagesize", function (newvalue) {
		newvalue && $$$storage.setSessionStorage('scene_pagesize', newvalue);
	});

	$scope.openAddDomainDialog = function (item) {
		var modal = $modal.open({
			templateUrl: "views/vdi/dialog/desktop/add_server.html",
			controller: "sceneAddServerDialog",
			resolve: { param: function param() {
					return angular.copy(item);
				} }
		});
		modal.result.then(function (res) {
			getList();
		});
	};
	$scope.sceneExitServerDialog = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='退域'>" + "退域</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='DOMAIN_EXIT_TIP2'>该场景下的所有桌面在下一次开机时，将自动执行退域的操作，是否确定？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					Server.domain_set_scene({
						id: item.id,
						has_domain: false
					}, function () {
						_controllerScope.refresh();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	$scope.start = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.shutdown_count <= row.instances_count && row.status !== "making" && row.status !== "updating" && row.status !== "setting-recoverable" && row.status !== 'recovering';
		});
		var flag = rows.some(function (it) {
			return it.shutdown_count > 0;
		});
		if (rows.length && !flag) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP1"),
				timeout: 6000
			});
			return;
		}
		scene.powerOn({ ids: rows.map(function (row) {
				return row.id;
			}), action: "power-on" }, function () {
			// rows.forEach(function(row){
			// row.running_count = row.instances_count;
			// row._selected = false;
			// });
		});
	};
	$scope.forceShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.running_count > 0 && row.status !== "updating" && row.status !== "setting-recoverable";
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP2"),
				timeout: 6000
			});
			return;
		}
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>" + "桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定强制关闭场景吗'>确定强制关闭场景吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					scene.forcePowerOff({ ids: rows.map(function (row) {
							return row.id;
						}),
						action: "force-power-off" }, function () {
						rows.forEach(function (row) {
							row.running_count = 0;
							// row._selected = false;
						});
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.natureShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.running_count > 0 && row.status !== "updating" && row.status !== "setting-recoverable";
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP3"),
				timeout: 6000
			});
			return;
		}
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>" + "桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭场景吗'>确定自然关闭场景吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					scene.powerOff({ ids: rows.map(function (row) {
							return row.id;
						}), action: "power-off" }, function () {
						rows.forEach(function (row) {
							row.running_count = 0;
							// row._selected = false;
						});
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.active = function (id, event) {
		var _this = this;

		if (_this.item.active) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='取消场景激活'>" + "取消场景激活</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='SCENE_CANCEL_COMFIRM'>取消激活该场景会同时关闭该场景内的所有桌面，是否确定?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						_this.item.active_loadding = true;
						scene.active({ id: id }, function (res) {
							_this.item.active = _this.item.active ? false : true;
						}).$promise.finally(function () {
							_this.item.active_loadding = false;
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			_this.item.active_loadding = true;
			scene.active({ id: id }, function (res) {
				_this.item.active = _this.item.active ? false : true;
			}).$promise.finally(function () {
				_this.item.active_loadding = false;
			});
		}
	};
	$scope.sortScene = function () {
		var modal = $modal.open({
			templateUrl: "views/vdi/dialog/desktop/scene_sort.html",
			controller: "sortSceneDialog",
			resolve: { param: function param() {
					return { scenes: angular.copy(_controllerScope.rows), schoolroom: angular.copy(_controllerScope.select) };
				} }
		});
		modal.result.then(function (res) {
			getList();
		});
	};
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && !row.active;
		});
		var has_running = rows.some(function (row) {
			return row.running_count;
		});
		var has_active = $scope.rows.some(function (row) {
			return row._selected && row.active;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopSceneList_TIP1"),
				timeout: 6000
			});
		} else {
			if (has_active) {
				$.bigBox({
					title: $$$I18N.get("INFOR_TIP"),
					content: $$$I18N.get("只有未激活状态下的场景才能被删除"),
					timeout: 6000
				});
			}
			$modal.open({
				template: "<section id='widget-grid'>" + " <div class='modal-content'>" + "  <div class='modal-header'>" + "   <button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button>" + "   <h4 class='modal-title' id='mySmallModalLabel' localize='删除场景'></h4>" + "  </div>" + "  <div class='modal-body'>" + "   <form class='form-horizontal'>" + "    <p ng-show='has_run' style='margin-bottom:10px;' localize='存在未关机的桌面,仍然删除场景吗'></p>" + "    <p ng-show='!has_run' style='margin-bottom:10px;' localize='删除场景无法恢复，确定删除场景吗'></p>" + "    <footer class='text-right'>" + "     <button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button>" + "     <button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button>" + "    </footer>" + "   </form>" + "  </div>" + " </div>" + "</section>",

				controller: function controller($scope, $modalInstance) {
					$scope.has_active = has_active;
					$scope.has_run = has_running;
					$scope.ok = function () {
						$modalInstance.close();
						scene.delete({ ids: rows.map(function (row) {
								return row.id;
							}), action: "delete" }, function () {
							getList();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.restartScene = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.running_count > 0 && row.status !== "making" && row.status !== "updating" && row.status !== "setting-recoverable" && row.status !== 'recovering';
		});
		if (!rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP7"),
				timeout: 6000
			});
			return;
		}
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>" + "场景桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启场景下的桌面吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					rows.map(function (row) {
						row._selected = false;
					});
					scene.reboots({ ids: rows.map(function (row) {
							return row.id;
						}) }, function () {
						getList();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("newSceneDialog", ["$scope", "$modalInstance", "Host", "Scene", "SchoolRoom", "Network", "TeachTemplate", "HardwareTemplate", "TeachDesktop", "Server", "$$$I18N", "$$$MSG", "UserRole", "$filter", "ResourcePool", "$modal", "VMCommon", "PersonDesktop", function ($scope, $modalInstance, host, scene, schoolroom, net, teach, hardwares, list, server, $$$I18N, $$$MSG, UserRole, $filter, ResourcePool, $modal, vm, PersonDesktop) {
	var user = UserRole.currentUser;
	if (!user) {
		return;
	}

	$scope.regXP = /WindowsXP|WindowsXP_64/;
	$scope.reg = /windows\s*(7|8|10)/i;
	$scope.regWin = /Windows/;
	// 第一步
	$scope.step1 = {};
	$scope.classrooms = angular.copy($scope.$parent.classrooms);
	$scope.step1.classroom = $scope.classrooms[0];

	server.query(function (data) {
		$scope.domains = data.servers;
	});

	ResourcePool.query(function (res) {
		$scope.resources = res.result.filter(function (item) {
			return item.hosts.length > 0;
		});
		$scope.step1.resource = $scope.resources[0];
		$scope.resource_update();
	});
	$scope.resource_update = function () {
		$scope.get_teach_template();
	};

	$scope.get_teach_template = function () {
		$scope.allImages = [];
		$scope.templateNum = undefined;
		$scope.step1.image = undefined;
		$scope.loading_template = true;
		vm.list_template({ type: 1, virtual_type: $scope.step1.resource.type, rbd_enabled: $scope.step1.resource.rbd_enabled }, function (data) {
			$scope.loading_template = false;
			$scope.winTable = data.win_images.filter(function (item) {
				return item.status == "alive";
			});
			$scope.linTable = data.linux_images.filter(function (item) {
				return item.status == "alive";
			});
			$scope.otherTable = data.other_images.filter(function (item) {
				return item.status == "alive";
			});
			$scope.image = $scope.winTable[0];
			$scope.allImages = $scope.winTable.concat($scope.linTable).concat($scope.otherTable);
			$scope.templateNum = $scope.allImages.length;
			$scope.step1.image = $scope.allImages[0];
		});
	};
	// 第二步
	$scope.step2 = {};
	$scope.step2.loading_server = true;
	PersonDesktop.share_servers(function (res) {
		$scope.step2.loading_server = false;
		var servers = [];
		res.servers.forEach(function (server) {
			server.nets.forEach(function (net) {
				servers.push({ id: server.id, net: { ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id } });
			});
		});
		$scope.share_servers = servers;
		$scope.step2.share_server = $scope.share_servers[0];
	});
	$scope.updateHardware = function () {
		var is_win7UP = $scope.reg.test($scope.step1.image.os_type);
		var is_winXP = $scope.regXP.test($scope.step1.image.os_type);
		var is_win = $scope.regWin.test($scope.step1.image.os_type);
		$scope.step2.usb_version = "2.0";
		if (is_win7UP) {
			$scope.step2.usb_redir = true;
			$scope.step2.usb_version = "3.0";
		} else if (is_winXP) {
			$scope.step2.usb_redir = true;
		} else {
			// $scope.step2.usb_redir = false;
		}
		$scope.step2.usb3_disabled = !is_win7UP ? true : false;
		$scope.step2.isWin = is_win;
	};
	// 第三步
	$scope.step3 = {};
	$scope.step3.desktopNum2 = 0;
	$scope.get_host = function () {
		$scope.hosts = undefined;
		$scope.loading_host = true;
		$scope.step3.is_all = undefined;
		$scope.step3.desktopNum = undefined;
		// $scope.bodyForm3.$setPristine();
		if ($scope.step1.resource.type == 'hyper-v') {
			host.query_gpu_agent({
				id: $scope.step1.resource.id,
				network_id: $scope.step1.classroom.network_id,
				enable_gpu: $scope.step2.has_gpu
			}, function (data) {
				$scope.hosts = data.hosts_list.map(function (item) {
					if (item.disabled_tips !== '') {
						item.disabled_desc = $$$I18N.get(item.disabled_tips);
					}
					return item;
				});
			}).$promise.finally(function () {
				$scope.loading_host = false;
			});
		} else {
			host.query_agent({
				id: $scope.step1.resource.id,
				network_id: $scope.step1.classroom.network_id,
				enable_gpu: $scope.step2.gpu_auto_assignment
			}, function (data) {
				$scope.hosts = data.hosts_list.filter(function (h) {
					return h.status === 'active';
				});
			}).$promise.finally(function () {
				$scope.loading_host = false;
			});
		}
	};
	var host_storages = {};
	$scope.openMoreDialog = function () {
		var _hostids = $scope.hosts.filter(function (h) {
			return h._selected;
		}).map(function (h) {
			return h.storage_uuid;
		});
		var moreDialog = $modal.open({
			templateUrl: "views/vdi/dialog/desktop/host_config.html",
			controller: "hostConfigDialog",
			resolve: { param: function param() {
					return {
						"phostids": angular.copy(_hostids),
						"pstore": host_storages
					};
				} }
		});
	};
	// 第四步
	$scope.step4 = {};
	$scope.selectAllHost = function (bool) {
		var _hosts = $scope.hosts.filter(function (h) {
			if ($scope.step1.resource.type == 'hyper-v') {
				return h.disabled_tips == '';
			} else {
				return true;
			}
		});
		_hosts.map(function (item) {
			item._selected = bool;
			return item;
		});
		var num = $filter("selectedFilter")(_hosts, 'max_instance');
		$scope.step3.desktopNum = $scope.step2.has_gpu == "through" ? num : 0;
	};
	$scope.selectOneHost = function () {
		var _hosts = $scope.hosts.filter(function (h) {
			if ($scope.step1.resource.type == 'hyper-v') {
				return h.disabled_tips == '';
			} else {
				return true;
			}
		});
		$scope.step3.is_all = _hosts.every(function (item) {
			return item._selected === true;
		});
		var num = $filter("selectedFilter")(_hosts, 'max_instance');
		$scope.step3.desktopNum = $scope.step2.has_gpu == "through" ? num : 0;
	};
	$scope.getDesktopNumber2 = function () {
		var _lis = angular.copy($scope.hosts.filter(function (item) {
			return item.instance_num > 0;
		}));
		if (_lis.length > 0) {
			$scope.step3.desktopNum2 = _lis.reduce(function (a, b) {
				a.instance_num += b.instance_num;
				return a;
			}).instance_num;
		} else {
			$scope.step3.desktopNum2 = 0;
		}
	};

	$scope.clearRDP = function (scope) {
		scope.RDP = false;
		$scope.userNameType = 1;
		$scope.userNamePre = "K";
		$scope.userNameBegin = 1;
	};
	$scope.clearDomain = function (scope) {
		if (scope.has_domain) {
			scope.domain = $scope.domains[0];
		} else {
			scope.domain = null;
		}
	};
	$scope.addZero = function (len, str_begin, str_end) {
		if (str_end && str_begin) {
			var end_len = str_end.toString().length;
			if (end_len < len) {
				return str_begin + new Array(len - end_len + 1).join("0") + str_end;
			} else {
				return str_begin + str_end;
			}
		}
	};
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.$on("WizardStep_0", function (e, step, scope) {
		setTimeout(function () {
			$("[rel=popover-hover]").popover({
				trigger: "hover"
			});
		});
		var sameSceneName = $scope.rows.filter(function (item) {
			return item.name == $scope.step1.sceneName;
		}).length;
		scope.error = step.is_dirty;
		step.done = scope.bodyForm1.$valid && !sameSceneName;
		if (sameSceneName) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("SAME_SCENE_NAME"),
				timeout: 6000
			});
		}
		if (step.done && !sameSceneName) {
			hardwares.filter({
				"system_gb": $scope.step1.image.system_alloc_disk,
				"local_gb": $scope.step1.image.data_alloc_disk,
				"local_gb1": $scope.step1.image.data_alloc_disk_2
			}, function (data) {
				$scope.hardwareList = data.result.map(function (data) {
					data.memory_mb = data.memory_mb / 1024;
					return data;
				});
				$scope.step2.hardware = $scope.hardwareList[0];
				$scope.updateHardware();
			});
		}
	});
	$scope.$on("WizardStep_1", function (e, step, scope) {
		$scope.get_host();
		scope.error = step.is_dirty;
		step.done = scope.bodyForm2.$valid;
	});
	$scope.$on("WizardStep_2", function (e, step, scope) {
		if ($scope.step1.resource.type == 'hyper-v') {
			$scope.step4.MORE = true;
			$scope.step4.RDP = true;
		} else {
			$scope.step4.MORE = false;
			$scope.step4.RDP = false;
		}
		scope.error = step.is_dirty;
		if ($scope.step3.hostType == 0) {
			step.done = scope.bodyForm3.$valid && $scope.step3.desktopNum <= $filter("selectedFilter")($scope.hosts, 'max_instance');
		}
		if ($scope.step3.hostType == 1) {
			step.done = scope.bodyForm3.$valid && Boolean($scope.step3.desktopNum2);
		}
	});
	$scope.$on("WizardStep_3", function (e, step, scope) {
		scope.error = step.is_dirty;
		step.done = scope.bodyForm4.$valid;
	});
	$scope.$on("WizardDone", function (e, steps, scopes) {
		var regWin10 = /Windows10/;
		var postData = {};
		postData.name = $scope.step1.sceneName;
		postData.image_id = $scope.step1.image.id;
		postData.pool = $scope.step1.classroom.id;
		postData.resource_pool_uuid = $scope.step1.resource.uuid;
		if ($scope.step1.domain) {
			postData.domain = $scope.step1.domain.id;
		}
		if ($scope.step1.resource.type === "hyper-v") postData.enable_gpu = $scope.step2.has_gpu;
		if ($scope.step1.resource.type === "kvm") {
			postData.gpu_auto_assignment = $scope.step2.gpu_auto_assignment;
			if (regWin10.test($scope.step1.image.os_type)) {
				postData.firmware_type = 'uefi';
			}
		}
		postData.instance_type = $scope.step2.hardware.id;
		postData.usb_redir = $scope.step2.usb_redir;
		postData.usb_version = $scope.step2.usb_redir && $scope.step1.resource.type == 'kvm' ? $scope.step2.usb_version : null;
		postData.rollback = Number($scope.step2.rollback);
		postData.data_rollback = $scope.step2.hardware.local_gb > 1 ? Number($scope.step2.data_rollback) : undefined;
		if (postData.rollback === 2) {
			postData.rollback_weekday = $scope.step2.rollback_weekday;
		}
		if (postData.rollback === 3) {
			postData.rollback_monthday = $scope.step2.rollback_monthday;
		}
		if (postData.data_rollback === 2) {
			postData.data_rollback_weekday = $scope.step2.data_rollback_weekday;
		}
		if (postData.data_rollback === 3) {
			postData.data_rollback_monthday = $scope.step2.data_rollback_monthday;
		}

		if ($scope.step3.hostType == 0) {
			postData.servers = $scope.hosts.filter(function (item) {
				return item._selected;
			}).map(function (item) {
				return { "uuid": item.id };
			});
			postData.instance_max = $scope.step3.desktopNum;
		}
		if ($scope.step3.hostType == 1) {
			postData.servers = $scope.hosts.filter(function (item) {
				return item.instance_num > 0;
			}).map(function (item) {
				return { "uuid": item.id, "vm_count": item.instance_num };
			});
			postData.instance_max = $scope.step3.desktopNum2;
		}
		postData.servers_storage = Object.keys(host_storages).map(function (key) {
			var host = host_storages[key];
			return {
				uuid: host.id,
				image_storage_capacity: host.image_storage_capacity,
				image_storage_performance: host.image_storage_performance,
				storage_capacity: host.storage_capacity,
				storage_performance: host.storage_performance
			};
		});
		postData.hostname_type = Number($scope.step4.hostNameType);
		postData.hostname_prefix = $scope.step4.hostNamePre;
		postData.hostname_beginwith = $scope.step4.hostNameBegin;
		if ($scope.step1.resource.type === "kvm") {
			postData.is_exam = $scope.step4.RDP;
			if ($scope.step4.MORE) {
				postData.username_type = $scope.step4.userNameType;
				postData.username_prefix = $scope.step4.userNamePre;
				postData.username_beginwith = $scope.step4.userNameBegin;
			}
		}
		if ($scope.step1.resource.type === "hyper-v") {
			postData.is_exam = true;
		}
		postData.enable_share = $scope.step2.enable_share;
		if ($scope.step2.enable_share) {
			postData.share_server_ip = $scope.step2.share_server.net.ip_address;
			postData.share_server_id = $scope.step2.share_server.id;
		}
		postData.expand_enabled = $scope.step2.expand_enabled;
		$scope.submitting = true;
		scene.save(postData, function (res) {
			$modalInstance.close();
			$scope.refresh();
		}).$promise.finally(function () {
			$scope.submitting = false;
		});
	});
}]).controller("alterSceneDialog", ["$scope", "$modalInstance", "SchoolRoom", "Scene", "Host", "Server", "PersonDesktop", function ($scope, $modalInstance, schoolroom, scene, host, server, personDesktop) {
	$scope.need_ha = false;
	var selectedServer, raw_need_ha;
	$scope.rollbackChange = function (value) {
		if (value != "1") {
			$scope.need_ha = false;
		} else {
			if (selectedServer && selectedServer.length > 0) {
				$scope.need_ha = angular.copy(raw_need_ha);
				$scope.servers = selectedServer;
			}
		}
	};
	$scope.name = $scope.currentItem.name;
	$scope.desktopNum = $scope.currentItem.instance_max;
	$scope.min_instances = $scope.currentItem.instance_max;
	$scope.rollback = $scope.currentItem.rollback;
	$scope.rollback_monthday = $scope.currentItem.rollback_monthday ? $scope.currentItem.rollback_monthday : "1";
	$scope.rollback_weekday = $scope.currentItem.rollback_weekday ? $scope.currentItem.rollback_weekday : "1";

	$scope.disk_type = $scope.currentItem.disk_type;
	$scope.local_gb = $scope.currentItem.local_gb;
	$scope.data_rollback = $scope.currentItem.data_rollback;
	$scope.data_rollback_monthday = $scope.currentItem.data_rollback_monthday || "1";
	$scope.data_rollback_weekday = $scope.currentItem.data_rollback_weekday || "1";

	$scope.usb_redir = $scope.currentItem.usb_redir;
	$scope.usb3_disabled = !$scope.currentItem.usb3_editable;
	$scope.usb_version = $scope.currentItem.usb_version || "2.0";

	$scope.running_count = $scope.currentItem.running_count;
	$scope.has_domain = $scope.currentItem.has_domain || false;
	$scope.domain = $scope.currentItem.domain;
	$scope.need_ha = false;
	// $scope.enable_gpu = $scope.currentItem.enable_gpu;
	$scope.enable_share = $scope.currentItem.enable_share;
	$scope.share_server_ip = $scope.currentItem.share_server_ip;
	$scope.loading_server = true;
	personDesktop.share_servers(function (res) {
		$scope.loading_server = false;
		var servers = [];
		res.servers.forEach(function (server) {
			server.nets.forEach(function (net) {
				servers.push({ id: server.id, net: { ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id } });
			});
		});
		$scope.share_servers = servers;
		if ($scope.enable_share) {
			$scope.share_server = $scope.share_servers.filter(function (item) {
				return item.net.ip_address == $scope.share_server_ip;
			})[0];
		} else {
			$scope.share_server = $scope.share_servers[0];
		}
	});
	$scope.is_windows = $scope.currentItem.is_windows;
	$scope.expand_enabled = $scope.currentItem.expand_enabled;
	$scope.ok = function () {
		var _rollback = parseInt(this.rollback);
		var _data_rollback = parseInt(this.data_rollback) >= 0 ? Number(this.data_rollback) : undefined;
		var item = {};
		item.id = $scope.currentItem.id;
		item.pool = $scope.currentItem.pool;
		item.name = this.name;
		item.instance_max = $scope.currentItem.instance_max;
		item.rollback = _rollback;
		item.rollback_monthday = _rollback == 3 ? this.rollback_monthday : undefined;
		item.rollback_weekday = _rollback == 2 ? this.rollback_weekday : undefined;
		item.data_rollback = _data_rollback;
		item.data_rollback_monthday = _data_rollback === 3 ? this.data_rollback_monthday : undefined;
		item.data_rollback_weekday = _data_rollback === 2 ? this.data_rollback_weekday : undefined;
		item.usb_redir = this.usb_redir;
		item.usb_version = item.usb_redir && $scope.currentItem.virtual_type == 'kvm' ? this.usb_version : null;
		item.has_domain = this.has_domain;
		// if($scope.currentItem.virtual_type === 'hyper-v')
		// 	item.enable_gpu			   = this.enable_gpu;
		item.domain = this.domain;
		item.need_ha = item.rollback == 1 && this.need_ha;
		item.enable_share = this.enable_share;
		item.share_server_ip = this.enable_share ? this.share_server.net.ip_address : undefined;
		item.share_server_id = this.enable_share ? this.share_server.id : undefined;
		item.expand_enabled = this.expand_enabled;
		if (item.rollback == 1 && item.need_ha) {
			item.server_ids = $scope.servers.filter(function (value) {
				return value._selected;
			}).map(function (value) {
				return value.id;
			});
			if (item.server_ids < 1) {
				return false;
			}
			item.server_ids = item.server_ids.join(',');
		}
		$scope.loading = true;
		scene.update(item, function () {
			$modalInstance.close();
			$scope.refresh();
		}, function () {
			$scope.refresh();
		}).$promise.finally(function (res) {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller('sortSceneDialog', ['$scope', 'param', '$modalInstance', 'Scene', function ($scope, param, $modalInstance, Scene) {

	$scope.schoolroom = param.schoolroom;
	$scope.scenes = param.scenes;
	$scope.auto_scene = $scope.scenes.filter(function (s) {
		return s.is_auto;
	})[0];
	// $scope.is_auto_enter = $scope.auto_scene ? true: false;
	function move(num) {
		var cur = $scope.scenes.filter(function (item) {
			return item._actived;
		})[0];
		var cur_idx = $scope.scenes.indexOf(cur);
		var pre_idx = null;
		if (cur_idx + num < 0) {
			pre_idx = $scope.scenes.length - 1;
		} else if (cur_idx + num > $scope.scenes.length - 1) {
			pre_idx = 0;
		} else {
			pre_idx = cur_idx + num;
		}
		var t = $scope.scenes.splice(cur_idx, 1)[0];
		$scope.scenes.splice(pre_idx, 0, t);
	};
	$scope.up = function () {
		move(-1);
	};
	$scope.down = function () {
		move(1);
	};

	$scope.select = function (item) {
		$scope.scenes.map(function (i) {
			if (i.id === item.id) {
				i._actived = true;
				return i;
			}
			i._actived = false;
			return i;
		});
	};
	$scope.ok = function () {
		var _this = this;
		var postData = $scope.scenes.map(function (s, idx) {
			var _item = {
				order: idx + 1,
				name: s.name,
				id: s.id,
				is_auto: Boolean(_this.auto_scene && _this.auto_scene.id === s.id)
			};
			return _item;
		});
		Scene.sort({ order_data: postData }, function () {
			$modalInstance.close();
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller("newPersonDialog", ["$scope", "$modalInstance", "Host", "Network", "HardwareTemplate", "PersonTemplate", "User", "Admin", "Domain", "PersonDesktop", "Server", "$$$I18N", "$$$MSG", "ResourcePool", "$filter", "$modal", "VMCommon", "checkIP", function ($scope, $modalInstance, host, networks, hardwares, images, user, admin, domain, Person, server, $$$I18N, $$$MSG, ResourcePool, $filter, $modal, vm, checkIP) {
	$scope.desktopNum = 1;
	$scope.max_instance = 0;
	$scope.host_loading = true;
	$scope.regXP = /WindowsXP|WindowsXP_64/;
	$scope.reg = /(windows\s*7|8|10)/i;
	$scope.regWin = /Windows/;
	// 第一步
	$scope.step1 = {};
	$scope.IPmodes1 = [{ name: $$$I18N.get('不分配'), value: 0 }];
	$scope.IPmodes2 = [{ name: $$$I18N.get('系统分配'), value: 1 }, { name: $$$I18N.get('固定IP'), value: 2 }];
	$scope.get_subnet = function (network) {
		if (network.subnets.length) {
			networks.query_sub({
				id: network.id
			}, function (res) {
				$scope.subnetworks = res.result.map(function (n) {
					n._desc = n.start_ip ? n.name + " (" + n.start_ip + " - " + n.end_ip + ") " : n.name;
					return n;
				});
				$scope.step1.subnetwork = $scope.subnetworks[0];
				$scope.clearBindIp();
			});
		} else {
			$scope.subnetworks = [];
			$scope.step1.subnetwork = null;
			$scope.clearBindIp();
		}
	};
	networks.query(function (data) {
		// $scope.networks = data.networks.filter(function(n){ return n.subnets.length > 0});
		$scope.networks = data.networks;
		if ($scope.networks.length) {
			$scope.step1.network = $scope.networks[0];
			$scope.get_subnet($scope.step1.network);
		}
	});
	ResourcePool.query(function (res) {
		$scope.resources = res.result.filter(function (item) {
			return item.hosts.length > 0;
		});
		$scope.step1.resource = $scope.resources[0];
		$scope.resource_update();
	});
	$scope.resource_update = function () {
		$scope.get_personal_template();
	};
	$scope.get_personal_template = function () {
		$scope.templates = [];
		$scope.templateNum = undefined;
		$scope.step1.image = undefined;
		$scope.loading_template = true;
		vm.list_template({ type: 2, virtual_type: $scope.step1.resource.type, rbd_enabled: $scope.step1.resource.rbd_enabled }, function (data) {
			$scope.loading_template = false;
			$scope.winTable = data.win_images.filter(function (item) {
				return item.status === "alive";
			});

			$scope.linTable = data.linux_images.filter(function (item) {
				return item.status === "alive";
			});
			$scope.otherTable = data.other_images.filter(function (item) {
				return item.status === "alive";
			});
			$scope.templates = $scope.winTable.concat($scope.linTable).concat($scope.otherTable);
			$scope.templateNum = $scope.templates.length;
			$scope.step1.image = $scope.templates[0];
		});
	};
	$scope.clearBindIp = function () {
		if ($scope.step1.subnetwork) {
			$scope.IPmodes = $scope.IPmodes2;
		} else {
			$scope.IPmodes = $scope.IPmodes1;
		}
		$scope.step1.IPmode = $scope.IPmodes[0];
		$scope.step1.ip = null;
	};
	// 第二步
	$scope.step2 = {};
	$scope.step2.loading_server = true;
	Person.share_servers(function (res) {
		$scope.step2.loading_server = false;
		var servers = [];
		res.servers.forEach(function (server) {
			server.nets.forEach(function (net) {
				servers.push({ id: server.id, net: { ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id } });
			});
		});
		$scope.share_servers = servers;
		$scope.step2.share_server = $scope.share_servers[0];
	});
	$scope.updateHardware = function () {
		var is_win7UP = $scope.reg.test($scope.step1.image.os_type);
		var is_winXP = $scope.regXP.test($scope.step1.image.os_type);
		var is_win = $scope.regWin.test($scope.step1.image.os_type);
		$scope.step2.usb_version = "2.0";
		if (is_win7UP) {
			$scope.step2.usb_redir = true;
			$scope.step2.usb_version = "3.0";
		} else if (is_winXP) {
			$scope.step2.usb_redir = true;
		} else {
			// $scope.step2.usb_redir = false;
		}
		$scope.step2.usb3_disabled = !is_win7UP ? true : false;
		$scope.step2.isWin = is_win;
	};
	// 第三步
	$scope.step3 = {};
	$scope.step3.desktopNum2 = 0;
	$scope.get_host = function () {
		var uuid = $scope.step1.resource.uuid;
		var netid = $scope.step1.network.id;
		var is_gpu = $scope.step2.has_gpu;
		$scope.host_loadding = true;
		$scope.step3.is_all = undefined;
		$scope.hosts = undefined;
		if ($scope.step1.resource.type == 'hyper-v') {
			host.query_gpu_agent({
				id: uuid,
				network_id: netid,
				enable_gpu: is_gpu
			}, function (data) {
				$scope.host_loadding = false;
				$scope.hosts = data.hosts_list.map(function (item) {
					if (item.disabled_tips !== '') {
						item.disabled_desc = $$$I18N.get(item.disabled_tips);
					}
					return item;
				});
			});
		} else {
			host.query_agent({
				id: uuid,
				network_id: netid,
				enable_gpu: $scope.step2.gpu_auto_assignment
			}, function (res) {
				$scope.host_loadding = false;
				$scope.hosts = res.hosts_list.filter(function (h) {
					return h.status === 'active';
				});
			});
		}
	};

	var host_storages = {};
	$scope.openMoreDialog = function () {
		var _hostids;
		if ($scope.step3.hostType == '0') {
			_hostids = $scope.hosts.filter(function (h) {
				return h._selected;
			}).map(function (h) {
				return h.storage_uuid;
			});
		} else {
			_hostids = $scope.hosts.filter(function (h) {
				return h.instance_num;
			}).map(function (h) {
				return h.storage_uuid;
			});
		}
		var moreDialog = $modal.open({
			templateUrl: "views/vdi/dialog/desktop/host_config.html",
			controller: "hostConfigDialog",
			resolve: { param: function param() {
					return {
						"phostids": angular.copy(_hostids),
						"pstore": host_storages
					};
				} }
		});
		moreDialog.result.then(function () {});
	};

	$scope.selectAllHost = function (bool) {
		var _hosts = $scope.hosts.filter(function (h) {
			if ($scope.step1.resource.type == 'hyper-v') {
				return h.disabled_tips == '';
			} else {
				return true;
			}
		});
		_hosts.map(function (item) {
			item._selected = bool;
			return item;
		});
		var num = $filter("selectedFilter")(_hosts, 'max_instance');
		$scope.step3.desktopNum = $scope.step2.has_gpu == "through" ? num : 0;
	};
	$scope.selectOneHost = function () {
		var _hosts = $scope.hosts.filter(function (h) {
			if ($scope.step1.resource.type == 'hyper-v') {
				return h.disabled_tips == '';
			} else {
				return true;
			}
		});
		$scope.step3.is_all = _hosts.every(function (item) {
			return item._selected === true;
		});
		var num = $filter("selectedFilter")(_hosts, 'max_instance');
		$scope.step3.desktopNum = $scope.step2.has_gpu == "through" ? num : 0;
	};
	$scope.getDesktopNumber2 = function () {
		var _lis = angular.copy($scope.hosts.filter(function (item) {
			return item.instance_num > 0;
		}));
		if (_lis.length > 0) {
			$scope.step3.desktopNum2 = _lis.reduce(function (a, b) {
				a.instance_num += b.instance_num;
				return a;
			}).instance_num;
		} else {
			$scope.step3.desktopNum2 = 0;
		}
	};

	$scope.step4 = {};
	$scope.$on("selectStepChange", function (e, arg) {
		if (arg.index == 0) {
			arg.stepScope.$$nextSibling.error = false;
		}
	});
	$scope.$on("WizardStep_0", function (e, step, scope) {
		setTimeout(function () {
			$("[rel=popover-hover]").popover({
				trigger: "hover"
			});
		});
		scope.error = step.is_dirty;
		function toStrLong(ip) {
			var ips;
			ips = ip.split(".").map(function (item, idx) {
				var _prefix = '';
				for (var i = 0; i < 8 - Number(item).toString(2).length; i++) {
					_prefix += "0";
				}
				return _prefix + Number(item).toString(2);
			});
			return ips.join("");
		}
		function check_net() {
			// 返回值为true时，invalid
			if ($scope.step1.subnetwork && $scope.step1.subnetwork.netmask && $scope.step1.subnetwork.enable_dhcp && $scope.step1.ip) {
				var _startIP = toStrLong($scope.step1.subnetwork.start_ip);
				var _endIP = toStrLong($scope.step1.subnetwork.end_ip);
				var _bindStartIP = toStrLong($scope.step1.ip);
				return _bindStartIP < _startIP || _bindStartIP > _endIP;
			}
			return false;
		}

		if (check_net()) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$MSG.get(12061),
				timeout: 5000
			});
		}
		var sameDesktopName = $scope.rows.filter(function (item) {
			return item.display_name == $scope.step1.desktopName;
		}).length;
		var is_valid = scope.bodyForm1.$valid && !check_net();
		step.done = is_valid && !sameDesktopName;
		if (sameDesktopName) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("SAME_PERSONAL_NAME"),
				timeout: 6000
			});
		}
		if (step.done && !sameDesktopName) {
			hardwares.filter({
				"system_gb": $scope.step1.image.system_alloc_disk,
				"local_gb": $scope.step1.image.data_alloc_disk,
				"local_gb1": $scope.step1.image.data_alloc_disk_2
			}, function (data) {
				$scope.hardwareList = data.result.map(function (data) {
					data.memory_mb = data.memory_mb / 1024;
					return data;
				});
				$scope.step2.hardware = $scope.hardwareList[0];
				$scope.step2.hardware && $scope.updateHardware();
			});
		}
		//个人桌面创建不需要check_ip,后台会检测作出处理
		// if(step.done && scope.step1.ip){
		// 	step.showLoading = true;
		// 	step.done = false;
		// 	console.log('step23')
		// 	checkIP.check({ip: scope.step1.ip, subnet_id: scope.step1.subnetwork.id},function(res){
		// 		if(!res.result){
		// 			$.bigBox({
		// 				title	: $$$I18N.get("INFOR_TIP"),
		// 				content	: $$$I18N.get("USEDIP"),
		// 				timeout	: 6000
		// 			});
		// 		}else{
		// 			$scope.$broadcast("currentStepChange", 1);
		// 		}
		// 		step.showLoading = false;
		// 	},function(error){ step.showLoading = false; });
		// }
	});
	$scope.$on("WizardStep_1", function (e, step, scope) {
		scope.error = step.is_dirty;
		var is_valid = scope.bodyForm2.$valid;
		if (is_valid) {
			$scope.step3.desktopNum = undefined;
			$scope.step3.desktopNum2 = 0;
			$scope.get_host();
		}
		step.done = is_valid;
	});
	$scope.$on("WizardStep_2", function (e, step, scope) {
		scope.error = step.is_dirty;
		// number类型的input ，max属性是变量，不生效，手动判断
		if ($scope.step3.hostType == 0) {
			step.done = scope.bodyForm3.$valid && $scope.step3.desktopNum <= $filter("selectedFilter")($scope.hosts, 'max_instance');
		}
		if ($scope.step3.hostType == 1) {
			step.done = scope.bodyForm3.$valid && Boolean($scope.step3.desktopNum2);
		}
	});
	$scope.$on("WizardStep_3", function (e, step, scope) {
		scope.error = step.is_dirty;
		step.done = $scope.step4.select_users.length ? true : false;
	});
	$scope.$on("WizardDone", function (e, steps, scopes) {
		var postData = {};
		var regWin10 = /Windows10/;
		postData.display_name = $scope.step1.desktopName;
		postData.network_id = $scope.step1.network.id;
		postData.resource_pool = $scope.step1.resource.uuid;

		if ($scope.step1.subnetwork) {
			postData.subnet_id = $scope.step1.subnetwork.id;
		} else {
			postData.subnet_id = '';
		}
		postData.ip_choose = Number($scope.step1.IPmode.value) ? true : false;
		if (postData.ip_choose && Number($scope.step1.IPmode.value) === 2) {
			postData.start_ip = $scope.step1.ip;
		}
		// if($scope.step1.domain){
		// postData.ad_server_id = $scope.step1.domain.id;}
		postData.image_id = $scope.step1.image.id;

		postData.rollback = Number($scope.step2.rollback);
		postData.data_rollback = $scope.step2.hardware.local_gb > 1 ? Number($scope.step2.data_rollback) : undefined;
		if (postData.rollback === 2) {
			postData.rollback_weekday = $scope.step2.rollback_weekday;
		}
		if (postData.rollback === 3) {
			postData.rollback_monthday = $scope.step2.rollback_monthday;
		}
		if (postData.data_rollback === 2) {
			postData.data_rollback_weekday = $scope.step2.data_rollback_weekday;
		}
		if (postData.data_rollback === 3) {
			postData.data_rollback_monthday = $scope.step2.data_rollback_monthday;
		}

		postData.instance_type_id = $scope.step2.hardware.id;
		postData.usb_redir = $scope.step2.usb_redir;
		postData.usb_version = $scope.step2.usb_redir && $scope.step1.resource.type == 'kvm' ? $scope.step2.usb_version : null;
		if ($scope.step1.resource.type === "hyper-v") postData.enable_gpu = $scope.step2.has_gpu;
		if ($scope.step1.resource.type === "kvm") {
			postData.gpu_auto_assignment = $scope.step2.gpu_auto_assignment;
			if (regWin10.test($scope.step1.image.os_type)) {
				postData.firmware_type = 'uefi';
			}
		}

		if ($scope.step3.hostType == 0) {
			postData.servers = $scope.hosts.filter(function (item) {
				return item._selected;
			}).map(function (item) {
				return { "uuid": item.id };
			});
			postData.count = $scope.step3.desktopNum;
		}
		if ($scope.step3.hostType == 1) {
			postData.servers = $scope.hosts.filter(function (item) {
				return item.instance_num > 0;
			}).map(function (item) {
				return { "uuid": item.id, "vm_count": item.instance_num };
			});
			postData.count = $scope.step3.desktopNum2;
		}
		postData.servers_storage = Object.keys(host_storages).map(function (key) {
			var host = host_storages[key];
			return {
				uuid: host.id,
				image_storage_capacity: host.image_storage_capacity,
				image_storage_performance: host.image_storage_performance,
				storage_capacity: host.storage_capacity,
				storage_performance: host.storage_performance
			};
		});
		postData.user_id = $scope.step4.select_users.map(function (item) {
			return item.id ? item.id : item.user_id;
		});
		postData.rule_id = $scope.step4.rule;

		postData.enable_share = $scope.step2.enable_share;
		if ($scope.step2.enable_share) {
			postData.share_server_ip = $scope.step2.share_server.net.ip_address;
			postData.share_server_id = $scope.step2.share_server.id;
		}
		postData.expand_enabled = $scope.step2.expand_enabled;
		$scope.submitting = true;
		Person.save(postData, function (res) {
			$modalInstance.close();
			$scope.refresh();
		}).$promise.finally(function () {
			$scope.submitting = false;
		});
	});
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("alterPersonalDialog", ["$scope", "$modalInstance", "Network", "HardwareTemplate", "User", "Admin", "PersonDesktop", "Domain", "$q", "$$$I18N", function ($scope, $modalInstance, net, hardwrare, user, admin, personDesktop, domain, $q, $$$I18N) {
	$scope.IPs = [];
	$scope.IPmodes1 = [{ name: $$$I18N.get('不分配'), value: 0 }];
	$scope.IPmodes2 = [{ name: $$$I18N.get('系统分配'), value: 1 }, { name: $$$I18N.get('固定IP'), value: 2 }];
	$scope.datas = angular.copy($scope.currentItem);
	if ($scope.datas.ips) {
		$scope.IPmodes = $scope.IPmodes2;
		$scope.datas.IPmode = $scope.IPmodes[1];
	} else {
		$scope.IPmodes = $scope.IPmodes1;
		$scope.datas.IPmode = $scope.IPmodes[0];
	}
	$scope.datas.usb_version = $scope.datas.usb_redir ? $scope.datas.usb_version : '2.0';
	$scope.datas.memory_mb = $scope.datas.memory_mb / 1024;
	$scope.btndisks = [];
	personDesktop.list_detail({ id: $scope.datas.id }, function (res) {
		$scope.detailData = res.result;
		["data_rollback_weekday", "data_rollback_monthday", "rollback_weekday", "rollback_monthday"].forEach(function (key) {
			$scope.detailData[key] = $scope.detailData[key] || 1;
		});
		$scope.get_net(true);
		$scope.loading_server = true;
		personDesktop.share_servers(function (res) {
			$scope.loading_server = false;
			var servers = [];
			res.servers.forEach(function (server) {
				server.nets.forEach(function (net) {
					servers.push({ id: server.id, net: { ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id } });
				});
			});
			$scope.share_servers = servers;
			if ($scope.detailData.share_server_ip) {
				$scope.detailData.share_server = $scope.share_servers.filter(function (item) {
					return item.net.ip_address == $scope.detailData.share_server_ip;
				})[0];
			} else {
				$scope.detailData.share_server = $scope.share_servers[0];
			}
		});
	});

	$scope.get_net = function (flag) {
		$scope.loading = true;
		net.query(function (res) {
			// 过滤无子网网络
			$scope.loading = false;
			// $scope.networks = res.networks.filter(function(net){ return net.subnets.length > 0});
			$scope.networks = res.networks;
			$scope.datas._network = $scope.networks.filter(function (item) {
				return item.id === $scope.detailData.network.id;
			})[0];
			$scope.get_sub_net($scope.datas._network, flag);
		});
	};

	$scope.get_sub_net = function (network, flag) {
		if (network.subnets.length) {
			$scope.loading = true;
			net.query_sub({ id: network.id }, function (res) {
				$scope.loading = false;
				$scope.subnetworks = res.result;
				if (flag) {
					$scope.datas._subnetwork = $scope.subnetworks.filter(function (item) {
						return item.id === $scope.detailData.subnet_id;
					})[0];
				} else {
					$scope.datas._subnetwork = $scope.subnetworks[0];
				}
				$scope.clearBindIp();
			});
		} else {
			$scope.subnetworks = [];
			$scope.datas._subnetwork = null;
			$scope.clearBindIp();
		}
	};
	var first = true;
	$scope.clearBindIp = function () {
		if (first) {
			first = false;
		} else {
			if ($scope.datas._subnetwork) {
				$scope.IPmodes = $scope.IPmodes2;
			} else {
				$scope.IPmodes = $scope.IPmodes1;
			}
			$scope.datas.IPmode = $scope.IPmodes[0];
			$scope.datas.ips = null;
		}
	};
	$scope.get_disks = function () {
		$scope.loading_disk = true;
		personDesktop.list_passive_disk({
			user_id: $scope.datas._user.id,
			instance_id: $scope.datas.instance_id
		}, function (res) {
			$scope.loading_disk = false;
			$scope.disks = res.result;
		});
	};
	$scope.$watch("datas._user", function (newval) {
		if (newval) {
			$scope.get_disks();
		}
	});
	$scope.expandedNodes = [];
	function formatData(d, name) {
		iteration(d, name);
		return d;
	}
	function iteration(data, childName, list) {
		for (var i = 0; i < data.length; i++) {
			$scope.expandedNodes.push(data[i]);
			if (data[i][childName] && data[i][childName].length) {
				var len = iteration(data[i][childName], childName);
				if (len === 0) {
					data[i] = undefined;
				}
			}
			if (!data[i]) {
				continue;
			}
			if (data[i].users && data[i].users.length > 0) {
				data[i].users.map(function (user) {
					user.name = user.name || user.user_name;
					user._is_last = true;
					return user;
				});
				data[i][childName] = data[i].users;
			}
			if (data[i][childName] && data[i][childName].length === 0) {
				data[i] = undefined;
			}
		}
		while (data.length > 0) {
			// 如果有数组元素为空，每次删除一个
			var oldlen = data.length;
			for (i = 0; i < oldlen; i++) {
				if (data[i] === undefined) {
					data.splice(i, 1);
					break;
				}
			}
			if (oldlen === data.length) {
				break;
			}
		}

		return data.length;
	}
	function removeNoChildrenDeparts(data) {
		data = data.filter(noUserFilter);
		data.forEach(walk);
		return data;
		function walk(node) {
			if (!node.dept_id) {
				return;
			}
			// 用户上级是没有 children 的
			if (node.children) {
				node.children = node.children.filter(noUserFilter);
				node.children.forEach(walk);
			}
		}
		function noUserFilter(node) {
			if (node.dept_id && !node.children && node.users.length === 0) {
				return false;
			}
			return true;
		}
	}
	$scope.$on('selectCommonUser', function (e, user) {
		$scope.datas._is_open = false;
		$scope.datas._user = user;
	});
	$q.all([admin.query().$promise, user.query_tree().$promise, domain.list().$promise]).then(function (arr) {
		$scope.admin_users = arr[0].users;
		$scope.common_users = arr[1].result;
		$scope.common_users = formatData(removeNoChildrenDeparts($scope.common_users), "children");
		$scope.domain_users = arr[2].result;
		var commonUser = [];
		$scope.expandedNodes.forEach(function (node) {
			node.children.forEach(function (user) {
				if (user.user_id && !user.dept_id) {
					user.id = user.user_id;
					commonUser.push(user);
				}
			});
		});
		var dus = $scope.domain_users.reduce(function (arr, b) {
			b.groups.forEach(function (g) {
				[].push.apply(arr, g.users);
			});
			return arr;
		}, []);
		var all_users = $scope.admin_users.concat(commonUser).concat(dus);
		$scope.datas._user = all_users.filter(function (user) {
			return user.id == $scope.datas.user_id;
		})[0];
	});
	$scope.name = function (net) {
		var is_dhcp = net.enable_dhcp;
		if (is_dhcp) {
			return net.name + " ( " + net.start_ip + " - " + net.end_ip + " ) ";
		} else {
			return net.name;
		}
	};
	$scope.user_name = function (user) {
		return user.name + " ( " + user.real_name + " ) ";
	};
	$scope.ok = function () {
		$scope.loading = true;
		var volumes = $scope.disks.filter(function (d) {
			return d._selected;
		});
		var _local_gb = $scope.btndisks.length ? $scope.btndisks[0].local_gb : undefined;
		var is_data_disk = Boolean(_local_gb || $scope.datas.local_gb);
		var postData = {
			id: $scope.datas.id,
			display_name: $scope.datas.display_name,
			user_id: $scope.datas._user.id,
			vcpu: $scope.datas.vcpu,
			memory_mb: $scope.datas.memory_mb * 1024,
			network_id: $scope.datas._network.id,
			subnet_id: $scope.datas._subnetwork ? $scope.datas._subnetwork.id : '',
			local_gb: _local_gb,
			ip: $scope.datas.ips ? $scope.datas.ips : undefined,
			gpu_auto_assignment: $scope.datas.enable_gpu,
			vm_hostname: $scope.datas.vm_hostname,
			rollback: $scope.detailData.rollback,
			rollback_weekday: $scope.detailData.rollback == 2 ? $scope.detailData.rollback_weekday : undefined,
			rollback_monthday: $scope.detailData.rollback == 3 ? $scope.detailData.rollback_monthday : undefined,
			attach_volumes: volumes,
			usb_redir: $scope.datas.usb_redir,
			usb_version: $scope.datas.usb_redir && $scope.datas.virtual_type == 'kvm' ? $scope.datas.usb_version : undefined,
			data_rollback: is_data_disk ? $scope.detailData.data_rollback : undefined,
			enable_share: $scope.detailData.enable_share,
			share_server_ip: $scope.detailData.enable_share ? $scope.detailData.share_server.net.ip_address : undefined,
			share_server_id: $scope.detailData.enable_share ? $scope.detailData.share_server.id : undefined,
			expand_enabled: $scope.datas.expand_enabled
		};
		if (postData.data_rollback == 2) {
			postData.data_rollback_weekday = $scope.detailData.data_rollback_weekday;
		}
		if (postData.data_rollback == 3) {
			postData.data_rollback_monthday = $scope.detailData.data_rollback_monthday;
		}
		personDesktop.update(postData, function (res) {
			$modalInstance.close();
			$scope.refresh();
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("snapshotPersonalDialog", ["$scope", "$modalInstance", "PersonDesktop", "VMCommon", "$$$I18N", function ($scope, $modalInstance, personDesktop, vm, $$$I18N) {
	$scope.rows = [];
	function get_list() {
		$scope.loading = true;
		vm.list_snapshot({ instance_id: $scope.currentItem.instance_id }, function (res) {
			$scope.rows = res.snapshots.map(function (item, index) {
				item.snapshot_name = item.name;
				item.display_description = item.desc;
				item.editable = false;
				return item;
			}).sort(function (a, b) {
				return new Date(b.create_at).getTime() - new Date(a.create_at).getTime() > 0 ? 1 : -1;
			});
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	}
	get_list();
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.hasSaveButton = function () {
		return $scope.rows.filter(function (item) {
			return item.editable;
		}).length;
	};
	$scope.hasSubmit = function () {
		return $scope.rows.filter(function (item) {
			return item._submitting;
		}).length;
	};
	$scope.save = function (cur) {
		cur._submitting = true;
		vm.take_snapshot({
			method: "save",
			name: cur.snapshot_name,
			instance_id: $scope.currentItem.instance_id,
			desc: cur.display_description
		}).$promise.then(function () {
			$modalInstance.close();
			get_list();
		}).finally(function () {
			cur._submitting = false;
		});
	};

	$scope.addNew = function () {
		var manuals = $scope.rows.filter(function (item) {
			return item.created_by == 'manual';
		}).length;
		if (manuals == 2) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("只能创建两个手动快照"),
				icon: "fa fa-warning shake animated",
				timeout: 6000
			});
		} else {
			$scope.rows.unshift({ "editable": true });
		}
	};
	$scope.delete = function (cur) {
		cur._submitting = true;
		if (cur.editable) {
			var idx = $scope.rows.indexOf(cur);
			$scope.rows.splice(idx, 1);
		} else {
			vm.delete_snapshot({
				snapshot_name: cur.snapshot_name,
				snapshot_volumes: cur.snapshot_volumes,
				instance_id: $scope.currentItem.instance_id
			}, function (res) {
				var idx = $scope.rows.indexOf(cur);
				$scope.rows.splice(idx, 1);
			}).$promise.finally(function () {
				cur._submitting = false;
			});
		}
	};
	$scope.restore = function (cur) {
		cur._submitting = true;
		vm.restore_snapshot({
			method: "restore",
			snapshot_volumes: cur.snapshot_volumes,
			snapshot_name: cur.snapshot_name,
			instance_id: $scope.currentItem.instance_id
		}, function () {
			$modalInstance.close();
			get_list();
		}).$promise.finally(function () {
			cur._submitting = false;
			get_list();
		});
	};
}]).controller('sceneAddServerDialog', ['$scope', 'Server', '$modalInstance', 'param', function ($scope, Server, $modalInstance, param) {
	Server.query(function (res) {
		$scope.servers = res.servers;
		$scope.server = $scope.servers[0];
	});
	$scope.post = function () {
		var _this = this;
		$scope.submiting = true;
		Server.domain_set_scene({
			id: param.id,
			has_domain: true,
			ad_server_id: _this.server.id,
			recreate_sid: _this.is_sid
		}, function (res) {
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.submiting = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('personalAddServerDialog', ['$scope', 'Server', '$modalInstance', 'param', function ($scope, Server, $modalInstance, param) {
	Server.query(function (res) {
		$scope.servers = res.servers;
		$scope.server = $scope.servers[0];
	});
	$scope.post = function () {
		var _this = this;
		$scope.submiting = true;
		Server.domain_set_person({
			instance_ids: param.map(function (p) {
				return p.id;
			}),
			has_domain: true,
			ad_server_id: _this.server.id,
			recreate_sid: _this.is_sid
		}, function (res) {
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.submiting = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('hostConfigDialog', ['$scope', 'Storage', 'param', '$modalInstance', 'Host', function ($scope, Storage, param, $modalInstance, Host) {
	var host_ids = param.phostids;
	var datas = {};
	$scope.datas = datas = param.pstore;
	Object.keys(datas).forEach(function (key) {
		if (host_ids.indexOf(datas[key].storage_uuid) === -1) {
			datas[key] = undefined;
			delete datas[key];
		}
	});
	$scope.loading = true;
	Storage.get_luns({
		storage_hosts: host_ids
	}, function (res) {
		res.result.forEach(function (host) {
			if (!datas[host.storage_uuid]) {
				host.storages.forEach(function (sto) {
					try {
						sto._total_size = Number(sto.storage_metadata.capabilities.total_capacity_gb).toFixed(0);
						sto._free_size = Number(sto.storage_metadata.capabilities.free_capacity_gb).toFixed(0);
						sto._used_size = Number(sto._total_size - sto._free_size).toFixed(0);
					} catch (err) {}
				});
				datas[host.storage_uuid] = host;
			}
		});
		var firstKey = Object.keys(datas)[0];
		$scope.host = datas[firstKey];
		$scope.change_host($scope);
		$scope.loading = false;
	});
	$scope.sys_luns = [];
	$scope.data_luns = [];
	$scope.filterStorage = function (_s, type, _scope) {
		$scope.loading_lun = true;
		Host.filter_storage({
			storage_id: _s.uuid,
			device_type: _s.device_type,
			node_uuid: _s.node_uuid
		}).$promise.then(function (res) {
			$scope.loading_lun = false;
			res.result.forEach(function (s) {
				try {
					s._total_size = Number(s.storage_metadata.capabilities.total_capacity_gb).toFixed(0);
					s._free_size = Number(s.storage_metadata.capabilities.free_capacity_gb).toFixed(0);
					s._used_size = Number(s._total_size - s._free_size).toFixed(0);
				} catch (err) {}
			});
			switch (type) {
				case 1:
					$scope.sys_luns = res.result;
					break;
				case 2:
					$scope.data_luns = res.result;
					break;
				default:
					break;
			}
			_scope.storage_performance = $scope.sys_luns.filter(function (item) {
				return item.uuid === _scope.host.storage_performance;
			})[0] || $scope.sys_luns[0];
			_scope.storage_capacity = $scope.data_luns.filter(function (item) {
				return item.uuid === _scope.host.storage_capacity;
			})[0] || $scope.data_luns[0];
		});
	};
	$scope.change_host = function (_scope) {
		_scope.image_storage_performance = _scope.host.storages.filter(function (sto) {
			return sto.uuid === _scope.host.image_storage_performance;
		})[0];
		_scope.image_storage_capacity = _scope.host.storages.filter(function (sto) {
			return sto.uuid === _scope.host.image_storage_capacity;
		})[0];
		$scope.filterStorage(_scope.image_storage_performance, 1, _scope);
		$scope.filterStorage(_scope.image_storage_capacity, 2, _scope);
	};
	$scope.ok = function (_scope) {
		var d = _scope.host;
		d._changed = true;
		d.storage_performance = _scope.storage_performance.uuid;
		d.storage_capacity = _scope.storage_capacity.uuid;
		d.image_storage_performance = _scope.image_storage_performance.uuid;
		d.image_storage_capacity = _scope.image_storage_capacity.uuid;
	};
	$scope.okAll = function () {
		$scope.ok(this);
		$scope.close();
	};
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.dismiss = function () {
		$modalInstance.dismiss();
	};
}]).controller("saveTemplatePersonalDialog", ["$scope", "$modalInstance", "Admin", "PersonDesktop", "HardwareTemplate", "$$$os_types", "virtualHost", "networkWithHost", "Network", "$$$I18N", function ($scope, $modalInstance, admin, personDesktop, hardwares, $$$os_types, virtualHost, networkWithHost, network, $$$I18N) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
	var currentItem = $scope.currentItem = angular.copy($scope.currentItem);
	$scope.type = 2;
	$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
	$scope.types2 = [{ name: $$$I18N.get('固定IP'), value: 'static' }, { name: $$$I18N.get('系统分配'), value: 'auto' }];
	$scope.types = $scope.types2;
	$scope.bind_ip_type = $scope.types2[1];
	admin.query(function (res) {
		$scope.owners = res.users;
		$scope.owner = $scope.owners.filter(function (o) {
			return o.id === currentItem.user_id;
		})[0] || $scope.owners[0];
	});
	personDesktop.list_detail({ id: currentItem.instance_id }, function (res) {
		$scope.currentItemDetail = res.result;
	}).$promise.then(function () {
		$scope.getVirtualHost($scope.type, currentItem.rbd_enabled);
	});
	$scope.getVirtualHost = function (type, rbd_enabled) {
		$scope.host_loading = true;
		virtualHost.query({
			virtual_type: currentItem.virtual_type,
			rbd_enabled: rbd_enabled
			// enable_gpu: currentItem.enable_gpu
		}, function (res) {
			$scope.host_loading = false;
			$scope.hosts = res.result;
			$scope.host = $scope.hosts.filter(function (h) {
				return h.host_name === currentItem.hostname;
			})[0] || $scope.hosts[0];
			$scope.host && $scope.getNetwork($scope.host, true);
		});
	};

	// function getIps(subnet_id, _scope){
	// 	if(subnet_id){
	// 		$scope.port_loading = true;
	// 		network.ports({ id: subnet_id },function(res){
	// 			if(res.unused_ips.length){
	// 				$scope.band_ips = res.unused_ips;
	// 			}
	// 			else{
	// 				$scope.band_ips = ["无可用IP"];
	// 			}
	// 			_scope.bind_ip = $scope.band_ips[0];
	// 			_scope.bind_ip_loading = false;
	// 		}).$promise.finally(() =>{
	// 			$scope.port_loading = false;
	// 		})
	// 	}
	// };
	$scope.switchIps = function (subnet, _scope) {
		// _scope.bind_ip_loading = true;
		if (subnet) {
			// getIps(subnet.id, _scope);
			_scope.types = _scope.types2;
			_scope.bind_ip_type = _scope.types2[1];
		} else {
			_scope.types = _scope.types1;
			_scope.band_ips = [];
			_scope.bind_ip_type = _scope.types1[0];
			// _scope.bind_ip_loading = false;
		}
	};
	function getSubnets(Network, _scope, isFirst) {
		if (Network.subnets.length) {
			$scope.network_loading = true;
			// $scope.bind_ip_loading = true;
			network.query_sub({ id: Network.id }, function (res) {
				_scope.subnets = res.result;
				if (isFirst) {
					_scope.subnet = _scope.subnets.filter(function (s) {
						return s.id === $scope.currentItemDetail.subnet_id;
					})[0];
				} else {
					_scope.subnet = _scope.subnets[0];
				}
				_scope.switchIps(_scope.subnet, _scope);
				$scope.network_loading = false;
			});
		} else {
			_scope.subnets = [];
			_scope.subnet = null;
			_scope.switchIps(_scope.subnet, _scope);
		}
	};
	$scope.getNetwork = function (host, isFirst) {
		if (host) {
			$scope.net_loading = true;
			networkWithHost.query({ host: host.host_uuid }, function (res) {
				// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
				$scope.networks = res.result;
				$scope.network = $scope.networks.filter(function (n) {
					return n.id === $scope.currentItemDetail.network.id;
				})[0];
				getSubnets($scope.network, $scope, isFirst);
			}).$promise.finally(function () {
				$scope.net_loading = false;
			});
		}
	};
	$scope.switchSubnet = function (val, _scope) {
		getSubnets(val, _scope);
	};

	$scope.ok = function () {
		$scope.submiting = true;
		$scope.afterSubmiting = false;
		var _this = this;
		if (this.saveTemplate.$valid) {
			var postData = {
				instance_id: currentItem.instance_id,
				owner: _this.owner.id,
				type_code: _this.type,
				name: _this.name,
				description: _this.description,
				network: _this.network.id,
				subnet: _this.subnet ? _this.subnet.id : "",
				band_type: _this.bind_ip_type.value,
				band_ip: _this.bind_ip_type.value === 'static' ? _this.bind_ip.value : undefined,
				host_uuid: _this.host.host_uuid,
				username: currentItem.virtual_type == 'hyper-v' ? _this.username : undefined,
				userPassword: currentItem.virtual_type == 'hyper-v' ? _this.userPassword : undefined,
				userPasswordConfirm: currentItem.virtual_type == 'hyper-v' ? _this.userPasswordConfirm : undefined
				// enable_gpu:currentItem.enable_gpu
			};
			personDesktop.saveAsTemplate(postData, function (res) {
				$scope.submiting = false;
				$scope.afterSubmiting = true;
				$modalInstance.close();
			}, function () {
				$scope.submiting = false;
				$scope.afterSubmiting = false;
			});
		}
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}])
/* 个人桌面池 */
.controller("vdiDesktopPoolController", ["$scope", "DeskPool", "$modal", "$timeout", "$interval", "$filter", "$$$I18N", function ($scope, DeskPool, $modal, $timeout, $interval, $filter, $$$I18N) {
	var _scope = $scope;
	$scope.rows = [], $scope.loading = true;

	//刷新机器执行后的状态
	$interval(function () {
		var filterSearch = $filter("filter")($scope.rows || [], $scope.searchText);
		var filterSearchPage = $filter("paging")(filterSearch, $scope.currentPage, $scope.pagesize);
		$scope.rows && $scope.$root && $scope.$root.$broadcast("personpools", filterSearchPage.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("personpoolsRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (item.status == 'updating') {
				item._ignore = true;
			} else {
				item._ignore = false;
			}
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
	});
	/*获取桌面池列表*/
	$scope.refresh = function () {
		var _s = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : $scope;

		DeskPool.query(function (res) {
			$scope.loading = false;
			$scope.rows = res.result;
		});
	};
	$scope.refresh();
	$scope.pagesize = Number($$$storage.getSessionStorage('pool_pagesize')) || 30;
	$scope.currentPage = 1;
	$scope.$watch("pagesize", function (newvalue) {
		$$$storage.setSessionStorage('pool_pagesize', newvalue);
	});

	//删除个人桌面池
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面删除'>" + "个人桌面池删除</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-show='!is_run' style='margin-bottom:20px;' localize='确定删除此个人桌面池吗？'>确定删除此个人桌面池吗？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					DeskPool.delete({
						ids: rows.map(function (row) {
							return row.id;
						})
					}, function (data) {
						rows.forEach(function (r) {
							_scope.refresh();
						});
					}, function (error) {
						rows.forEach(function (r) {
							_scope.refresh();
						});
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	//获取选中item的id
	function getIds() {
		var params = {};
		var rows = $scope.rows.filter(function (row) {
			return row._selected && row.online_count < row.total_count;
		});
		params = {
			ids: rows.map(function (it) {
				return it.id;
			})
		};
		return params;
	}

	//桌面池开机
	$scope.start = function (item) {
		var params = getIds();
		params.action = 'power-on';
		DeskPool.start(params, function (res) {
			if (res.result) {
				_scope.refresh();
			}
		});
	};

	//桌面池强制关机
	$scope.forceShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.online_count > 0;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP2"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>" + "桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					var params = {
						ids: rows.map(function (it) {
							return it.id;
						}),
						action: "force-power-off"
					};
					$scope.ok = function () {
						$modalInstance.close();
						DeskPool.shutdown(params, function () {
							_scope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};

	//桌面池自然关机
	$scope.natureShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.online_count > 0;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP3"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>" + "桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						var params = {
							ids: rows.map(function (it) {
								return it.id;
							}),
							action: "power-off"
						};
						$modalInstance.close();
						DeskPool.shutdown(params, function () {
							_scope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
}])
/* 个人桌面池二级列表*/
.controller("vdiDesktopPoolListController", ["$scope", "$modal", "$interval", "$filter", "DeskPool", "DeskPoolSecond", "$$$I18N", "UserRole", function ($scope, $modal, $interval, $filter, DeskPool, DeskPoolSecond, $$$I18N, UserRole) {
	var model_name,
	    url,
	    _scope = $scope,
	    cid,
	    carr,
	    searchName,
	    breadPoolName;
	var hasTerminalpermission = UserRole.currentUserRoles.filter(function (role) {
		return role == 'Terminal';
	}).length;
	var hasTerminalManagepermission = UserRole.currentUserRoles.filter(function (role) {
		return role == 'Terminal_Manage';
	}).length;
	var hasClassroompermission = UserRole.currentUserRoles.filter(function (role) {
		return role == 'Classroom';
	}).length;
	$scope.linkTerminal = hasTerminalpermission && hasTerminalManagepermission && hasClassroompermission ? true : false;
	$scope.inCurrentUserPool = function (pool) {
		if ($$$storage.getSessionStorage("loginInfo")) return JSON.parse($$$storage.getSessionStorage("loginInfo")).pool.indexOf(pool) > -1;
	};
	url = decodeURIComponent(location.href);
	if (url.indexOf('client') >= 0) {
		searchName = model_name = url.split('?')[1].split('&')[0];
		// breadPoolName=url.split('=')[1];
		// $scope.$root.$broadcast("navItemSelected", ["桌面", "个人桌面池", breadPoolName]);
	} else {
			// model_name=url.split('?')[1];
			// $scope.$root.$broadcast("navItemSelected", ["桌面", "个人桌面池", model_name]);
		}
	carr = url.split('?')[0].split('/');
	cid = carr[carr.length - 1];
	$scope.rows = [], $scope.loading = true;

	//tasklog刷新机器执行后的状态
	$interval(function () {
		var filterSearch = $filter("filter")($scope.rows || [], $scope.searchText);
		var filterSearchPage = $filter("paging")(filterSearch, $scope.currentPage, $scope.pagesize);
		$scope.rows && $scope.$root && $scope.$root.$broadcast("instanceIDS", filterSearchPage.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("instancesRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (item.status == 'updating') {
				item._ignore = true;
			} else {
				item._ignore = false;
			}
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
	});

	//桌面名排序
	$scope.sortDesktopName = function (name, bool) {
		$scope.rows.sort(function (a, b) {
			var _numa, _numb;
			var get_num = function get_num(tar) {
				for (var i = tar.length - 1; i--; i >= 0) {
					if (!Number(tar[i])) {
						return Number(tar.substring(i + 1, tar.length));
					}
				}
			};
			_numa = get_num(a[name]);
			_numb = get_num(b[name]);
			return (_numa - _numb) * (bool ? -1 : 1);
		});
	};

	$scope.getObjLength = function (obj) {
		try {
			return Object.keys(obj).length;
		} catch (err) {
			return 0;
		}
	};

	//获取桌面列表|更新桌面列表
	_scope.refresh = function () {
		DeskPoolSecond.get({ id: cid }, function (res) {
			_scope.loading = false;
			_scope.rows = res.result;
			$scope.$root.$broadcast("navItemSelected", ["桌面", "个人桌面池", res.person_pool_name]);
			_scope.sortDesktopName('display_name');
			_scope.searchText = searchName;
			_scope.loading = false;
		});
	};

	_scope.refresh();

	$scope.pagesize = Number($$$storage.getSessionStorage('pool_details_pagesize')) || 30;
	$scope.currentPage = 1;
	$scope.$watch("pagesize", function (newvalue) {
		$$$storage.setSessionStorage('pool_details_pagesize', newvalue);
	});
	// $scope.rows=mockData.result;

	//获取桌面池详情信息
	$scope.getDetail = function (it) {
		$scope.loading_detail = true;
		DeskPool.list_detail({ id: it.id }, function (res) {
			it.detailData = res.result;
		}).$promise.finally(function () {
			$scope.loading_detail = false;
		});
	};

	//桌面池详情展开收起
	$scope.expand = function (row) {
		$scope.rows.forEach(function (r) {
			if (row.id === r.id) {
				r._expand = !row._expand;
				if (r._expand) {
					$scope.getDetail(row);
				}
			} else {
				r._expand = false;
			}
		});
	};

	//searchText输入搜索
	$scope.updateData = function (text, select) {
		$scope.rows = $scope.rows.filter(function (row) {
			row._selected = false;
			if (select) {
				if (text && text.trim()) {
					return row.status === select;
				}
				return row.status === select;
			}
			return true;
		});
	};

	//操作--查看桌面
	$scope.view = function (item) {
		window.open("desktopScreenshot.html#" + item.id, "person_desktop_" + item.id);
	};

	//获取选中item的id
	function getIds(item) {
		var params = {};
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		params = {
			ids: rows.map(function (it) {
				return it.id;
			})
		};
		return params;
	}

	//个人桌面池开机
	$scope.start = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'shutdown' || row.status == 'suspended') && !row.task_state;
		});
		var params = {
			instance_ids: rows.map(function (it) {
				it._selected = false;return it.id;
			})
		};
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP1"),
				timeout: 6000
			});
		} else {
			DeskPoolSecond.start(params, function (res) {
				// _scope.refresh();//tasklog刷新，这里不需要再拉取列表
			});
		}
	};

	//桌面池强制关机
	$scope.forceShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP2"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>" + "桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						var params = {
							instance_ids: rows.map(function (it) {
								it._selected = false;return it.id;
							})
						};
						$modalInstance.close();
						DeskPoolSecond.shutdown(params, function () {});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	//桌面池自然关机
	$scope.natureShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP3"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>" + "桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						var params = {
							instance_ids: rows.map(function (it) {
								it._selected = false;return it.id;
							})
						};
						$modalInstance.close();
						DeskPoolSecond.shutdown(params, function () {
							// _scope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	//桌面池重启
	$scope.restart = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended') && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP4"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>" + "桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						var params = {
							instance_ids: rows.map(function (it) {
								it._selected = false;return it.id;
							})
						};
						$modalInstance.close();
						DeskPoolSecond.reboots(params, function () {
							// _scope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	//挂起状态
	$scope.pause = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'running' && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP5"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>" + "桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						var params = {
							instance_ids: rows.map(function (it) {
								it._selected = false;return it.id;
							})
						};
						$modalInstance.close();
						DeskPoolSecond.pause(params, function () {
							// _scope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	//唤醒
	$scope.resume = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'paused' && !row.task_state;
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP6"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>" + "桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						var params = {
							instance_ids: rows.map(function (it) {
								it._selected = false;return it.id;
							})
						};
						DeskPoolSecond.resume(params, function () {
							// _scope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
}])
/*新增个人桌面池dialog控制器*/
.controller("newDeskPoolDialog", ["$scope", "$modalInstance", "$q", "DeskPool", "Host", "Network", "HardwareTemplate", "PersonTemplate", "User", "Admin", "Depart", "PersonDesktop", "Server", "$$$I18N", "$$$MSG", "ResourcePool", "$filter", "$modal", "VMCommon", function ($scope, $modalInstance, $q, DeskPool, host, networks, hardwares, images, user, Admin, Depart, Person, server, $$$I18N, $$$MSG, ResourcePool, $filter, $modal, vm) {
	var _scope = $scope;
	$scope.desktopNum = 1;
	$scope.max_instance = 0;
	$scope.host_loading = true;
	$scope.regXP = /WindowsXP|WindowsXP_64/;
	$scope.reg = /(windows\s*7|8|10)/i;
	$scope.depart = { name: '全部', id: -1, full_path: 'root' };
	/**
 * [selectMode 部门域选择]
 */
	function traverse(ids, obj) {
		if (obj.children && obj.children.length > 0) {
			obj.children.forEach(function (item) {
				ids.push(item.id);
				traverse(ids, item);
			});
		}
	}
	function setData(data, index) {
		data.filter(function (item) {
			return item.full_path_map.length == index;
		}).forEach(function (item) {
			var children = data.filter(function (d) {
				return d.parent == item.id;
			});
			item.children = children;
		});
	}
	function setTreeData(DATA) {
		DATA.forEach(function (item) {
			item.full_path_map = item.full_path.split('/');
		});
		DATA.sort(function (a, b) {
			return a.full_path_map.length > b.full_path_map.length ? -1 : 1;
		});
		for (var i = 1; i < DATA[0].full_path_map.length; i++) {
			setData(DATA, i);
		}
		return [DATA[DATA.length - 1]];
	};

	//初始化树状图
	function treeOptFun(arg, flag) {
		arg.opts = {};
		arg.treedata = newData;
		arg.expandnodes = DATA;
		arg.selected = arg.treedata[0] ? arg.treedata[0] : null;
		if (arg.selected) {
			arg.selected._selected = true;
		}
		arg.showSelected = function (node, selected) {
			node._selected = selected;
			arg.selected = node;
		};
	};
	var DATA = [],
	    newData = [];

	treeOptFun($scope, true);
	$scope.islastGroup = function () {
		return $scope.selected && !DATA.filter(function (item) {
			return item.id !== $scope.selected.id;
		}).filter(function (item) {
			return (item.full_path + '/').indexOf($scope.selected.full_path + '/') > -1;
		}).length;
	};

	$scope.getUserGroup = function () {
		Depart.query(function (res) {
			DATA = res.result;
			$scope.treedata = newData = DATA.length ? setTreeData(DATA) : [];
			$scope.treedata.sort(function (a, b) {
				return a.full_path > b.full_path ? -1 : 1;
			});
			$scope.expandnodes = DATA;
			var selected = {};
			if ($scope.selected) {
				var _selected = DATA.filter(function (item) {
					return item.id == $scope.selected.id;
				})[0];
				selected = _selected ? _selected : newData[0];
			} else {
				selected = DATA.filter(function (item) {
					return item.name == 'default';
				})[0];
			}
			$scope.selected = selected;
			if ($scope.selected) {
				$scope.selected._selected = true;
			}
		}, function (err) {});
	};

	// 第一步
	$scope.step1 = {};
	$scope.IPmodes1 = [{ name: $$$I18N.get('不分配'), value: 0 }];
	$scope.IPmodes2 = [{ name: $$$I18N.get('系统分配'), value: 1 }, { name: $$$I18N.get('固定IP'), value: 2 }];
	$scope.get_subnet = function (network) {
		if (network.subnets.length) {
			networks.query_sub({
				id: network.id
			}, function (res) {
				$scope.subnetworks = res.result.map(function (n) {
					n._desc = n.start_ip ? n.name + " (" + n.start_ip + " - " + n.end_ip + ") " : n.name;
					return n;
				});
				$scope.step1.subnetwork = $scope.subnetworks[0];
				$scope.clearBindIp();
			});
		} else {
			$scope.subnetworks = [];
			$scope.step1.subnetwork = null;
			$scope.clearBindIp();
		}
	};
	networks.query(function (data) {
		// $scope.networks = data.networks.filter(function(n){ return n.subnets.length > 0});
		$scope.networks = data.networks;
		if ($scope.networks.length) {
			$scope.step1.network = $scope.networks[0];
			$scope.get_subnet($scope.step1.network);
		}
	});
	ResourcePool.query(function (res) {
		$scope.resources = res.result.filter(function (item) {
			return item.hosts.length > 0;
		});
		$scope.step1.resource = $scope.resources[0];
		$scope.resource_update();
	});
	$scope.resource_update = function () {
		$scope.get_personal_template();
	};
	$scope.get_personal_template = function () {
		$scope.templates = [];
		$scope.templateNum = undefined;
		$scope.step1.image = undefined;
		$scope.loading_template = true;
		vm.list_template({ type: 2, virtual_type: $scope.step1.resource.type, rbd_enabled: $scope.step1.resource.rbd_enabled }, function (data) {
			$scope.loading_template = false;
			$scope.winTable = data.win_images.filter(function (item) {
				return item.status === "alive";
			});

			$scope.linTable = data.linux_images.filter(function (item) {
				return item.status === "alive";
			});
			$scope.otherTable = data.other_images.filter(function (item) {
				return item.status === "alive";
			});
			$scope.templates = $scope.winTable.concat($scope.linTable).concat($scope.otherTable);
			$scope.templateNum = $scope.templates.length;
			$scope.step1.image = $scope.templates[0];
		});
	};
	$scope.clearBindIp = function () {
		if ($scope.step1.subnetwork) {
			$scope.IPmodes = $scope.IPmodes2;
		} else {
			$scope.IPmodes = $scope.IPmodes1;
		}
		$scope.step1.IPmode = $scope.IPmodes[0];
		$scope.step1.ip = null;
	};
	// 第二步
	$scope.step2 = {};
	$scope.updateHardware = function () {
		var is_win7UP = $scope.reg.test($scope.step1.image.os_type);
		var is_winXP = $scope.regXP.test($scope.step1.image.os_type);
		$scope.step2.usb_version = "2.0";
		if (is_win7UP) {
			$scope.step2.usb_redir = true;
			$scope.step2.usb_version = "3.0";
		} else if (is_winXP) {
			$scope.step2.usb_redir = true;
		} else {
			// $scope.step2.usb_redir = false;
		}
		$scope.step2.usb3_disabled = !is_win7UP ? true : false;
	};
	// 第三步
	$scope.step3 = {};
	$scope.step3.desktopNum2 = 0;
	$scope.get_host = function () {
		$scope.getUserGroup();
		var uuid = $scope.step1.resource.uuid;
		var netid = $scope.step1.network.id;
		var is_gpu = $scope.step2.has_gpu;
		$scope.host_loadding = true;
		$scope.step3.is_all = undefined;
		$scope.hosts = undefined;
		if ($scope.step1.resource.type == 'hyper-v') {
			host.query_gpu_agent({
				id: uuid,
				network_id: netid,
				enable_gpu: is_gpu
			}, function (data) {
				$scope.host_loadding = false;
				$scope.hosts = data.hosts_list.map(function (item) {
					if (item.disabled_tips !== '') {
						item.disabled_desc = $$$I18N.get(item.disabled_tips);
					}
					return item;
				});
			});
		} else {
			host.query_agent({
				id: uuid,
				network_id: netid,
				enable_gpu: false
			}, function (res) {
				$scope.host_loadding = false;
				$scope.hosts = res.hosts_list.filter(function (h) {
					return h.status === 'active';
				});
			});
		}
	};

	var host_storages = {};
	$scope.openMoreDialog = function () {
		var _hostids;
		if ($scope.step3.hostType == '0') {
			_hostids = $scope.hosts.filter(function (h) {
				return h._selected;
			}).map(function (h) {
				return h.storage_uuid;
			});
		} else {
			_hostids = $scope.hosts.filter(function (h) {
				return h.instance_num;
			}).map(function (h) {
				return h.storage_uuid;
			});
		}
		var moreDialog = $modal.open({
			templateUrl: "views/vdi/dialog/desktop/host_config.html",
			controller: "hostConfigDialog",
			resolve: { param: function param() {
					return {
						"phostids": angular.copy(_hostids),
						"pstore": host_storages
					};
				} }
		});
		moreDialog.result.then(function () {});
	};

	$scope.selectAllHost = function (bool) {
		var _hosts = $scope.hosts.filter(function (h) {
			if ($scope.step1.resource.type == 'hyper-v') {
				return h.disabled_tips == '';
			} else {
				return true;
			}
		});
		_hosts.map(function (item) {
			item._selected = bool;
			return item;
		});
		var num = $filter("selectedFilter")(_hosts, 'max_instance');
		$scope.step3.desktopNum = $scope.step2.has_gpu == "through" ? num : 0;
	};
	$scope.selectOneHost = function () {
		var _hosts = $scope.hosts.filter(function (h) {
			if ($scope.step1.resource.type == 'hyper-v') {
				return h.disabled_tips == '';
			} else {
				return true;
			}
		});
		$scope.step3.is_all = _hosts.every(function (item) {
			return item._selected === true;
		});
		var num = $filter("selectedFilter")(_hosts, 'max_instance');
		$scope.step3.desktopNum = $scope.step2.has_gpu == "through" ? num : 0;
	};
	$scope.getDesktopNumber2 = function () {
		var _lis = angular.copy($scope.hosts.filter(function (item) {
			return item.instance_num > 0;
		}));
		if (_lis.length > 0) {
			$scope.step3.desktopNum2 = _lis.reduce(function (a, b) {
				a.instance_num += b.instance_num;
				return a;
			}).instance_num;
		} else {
			$scope.step3.desktopNum2 = 0;
		}
	};

	$scope.step4 = {};
	$scope.$on("selectStepChange", function (e, arg) {
		if (arg.index == 0) {
			arg.stepScope.$$nextSibling.error = false;
		}
	});
	$scope.$on("WizardStep_0", function (e, step, scope) {
		setTimeout(function () {
			$("[rel=popover-hover]").popover({
				trigger: "hover"
			});
		});
		scope.error = step.is_dirty;
		function toStrLong(ip) {
			var ips;
			ips = ip.split(".").map(function (item, idx) {
				var _prefix = '';
				for (var i = 0; i < 8 - Number(item).toString(2).length; i++) {
					_prefix += "0";
				}
				return _prefix + Number(item).toString(2);
			});
			return ips.join("");
		}
		function check_net() {
			// 返回值为true时，invalid
			if ($scope.step1.subnetwork && $scope.step1.subnetwork.netmask && $scope.step1.subnetwork.enable_dhcp && $scope.step1.ip) {
				var _startIP = toStrLong($scope.step1.subnetwork.start_ip);
				var _endIP = toStrLong($scope.step1.subnetwork.end_ip);
				var _bindStartIP = toStrLong($scope.step1.ip);
				return _bindStartIP < _startIP || _bindStartIP > _endIP;
			}
			return false;
		}

		if (check_net()) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$MSG.get(12061),
				timeout: 5000
			});
		}
		var sameDesktopName = $scope.rows.filter(function (item) {
			return item.pool_name == $scope.step1.desktopName;
		}).length;
		var is_valid = scope.bodyForm1.$valid && !check_net();
		step.done = is_valid && !sameDesktopName;
		if (sameDesktopName) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("SAME_POOL_NAME"),
				timeout: 6000
			});
		}
		if (step.done && !sameDesktopName) {
			hardwares.filter({
				"system_gb": $scope.step1.image.system_alloc_disk,
				"local_gb": $scope.step1.image.data_alloc_disk,
				"local_gb1": $scope.step1.image.data_alloc_disk_2
			}, function (data) {
				$scope.hardwareList = data.result.map(function (data) {
					data.memory_mb = data.memory_mb / 1024;
					return data;
				});
				$scope.step2.hardware = $scope.hardwareList[0];
				$scope.step2.hardware && $scope.updateHardware();
			});
		}
	});
	$scope.$on("WizardStep_1", function (e, step, scope) {
		scope.error = step.is_dirty;
		var is_valid = scope.bodyForm2.$valid;
		if (is_valid) {
			$scope.step3.desktopNum = undefined;
			$scope.step3.desktopNum2 = 0;
			$scope.get_host();
		}
		step.done = is_valid;
	});
	$scope.$on("WizardStep_2", function (e, step, scope) {
		scope.error = step.is_dirty;
		// number类型的input ，max属性是变量，不生效，手动判断
		if ($scope.step3.hostType == 0) {
			step.done = scope.bodyForm3.$valid && $scope.step3.desktopNum <= $filter("selectedFilter")($scope.hosts, 'max_instance');
		}
		if ($scope.step3.hostType == 1) {
			step.done = scope.bodyForm3.$valid && Boolean($scope.step3.desktopNum2);
		}
	});
	$scope.$on("WizardStep_3", function (e, step, scope) {
		scope.error = step.is_dirty;
		// step.done = $scope.step4.select_users.length?true:false;
		step.done = $scope.selected ? true : false;
	});
	$scope.$on("WizardDone", function (e, steps, scopes) {
		var postData = {};
		postData.display_name = $scope.step1.desktopName;
		postData.pool_name = $scope.step1.desktopName;
		postData.network_id = $scope.step1.network.id;
		postData.resource_pool = $scope.step1.resource.uuid;

		if ($scope.step1.subnetwork) {
			postData.subnet_id = $scope.step1.subnetwork.id;
		} else {
			postData.subnet_id = '';
		}
		postData.ip_choose = Number($scope.step1.IPmode.value) ? true : false;
		if (postData.ip_choose && Number($scope.step1.IPmode.value) === 2) {
			postData.start_ip = $scope.step1.ip;
		}
		// if($scope.step1.domain){
		// postData.ad_server_id = $scope.step1.domain.id;}
		postData.image_id = $scope.step1.image.id;

		postData.rollback = Number($scope.step2.rollback);
		postData.data_rollback = $scope.step2.hardware.local_gb > 1 ? Number($scope.step2.data_rollback) : undefined;
		if (postData.rollback === 2) {
			postData.rollback_weekday = $scope.step2.rollback_weekday;
		}
		if (postData.rollback === 3) {
			postData.rollback_monthday = $scope.step2.rollback_monthday;
		}
		if (postData.data_rollback === 2) {
			postData.data_rollback_weekday = $scope.step2.data_rollback_weekday;
		}
		if (postData.data_rollback === 3) {
			postData.data_rollback_monthday = $scope.step2.data_rollback_monthday;
		}

		postData.instance_type_id = $scope.step2.hardware.id;
		postData.usb_redir = $scope.step2.usb_redir;
		postData.usb_version = $scope.step2.usb_redir && $scope.step1.resource.type == 'kvm' ? $scope.step2.usb_version : null;
		if ($scope.step1.resource.type === "hyper-v") postData.enable_gpu = $scope.step2.has_gpu;

		if ($scope.step3.hostType == 0) {
			postData.servers = $scope.hosts.filter(function (item) {
				return item._selected;
			}).map(function (item) {
				return { "uuid": item.id };
			});
			postData.count = $scope.step3.desktopNum;
		}
		if ($scope.step3.hostType == 1) {
			postData.servers = $scope.hosts.filter(function (item) {
				return item.instance_num > 0;
			}).map(function (item) {
				return { "uuid": item.id, "vm_count": item.instance_num };
			});
			postData.count = $scope.step3.desktopNum2;
		}
		postData.servers_storage = Object.keys(host_storages).map(function (key) {
			var host = host_storages[key];
			return {
				uuid: host.id,
				image_storage_capacity: host.image_storage_capacity,
				image_storage_performance: host.image_storage_performance,
				storage_capacity: host.storage_capacity,
				storage_performance: host.storage_performance
			};
		});
		// postData.user_id = $scope.step4.select_users.map(function(item){ return item.id?item.id:item.user_id });
		postData.user_group_id = $scope.selected.id;
		//相比个人桌面的新增 多了个人桌面池name，分组id参数
		$scope.submitting = true;
		if (!postData.user_group_id) {
			console.log('用户分组ID"user_group_id"不能为空');
			return;
		}
		DeskPool.save(postData, function (res) {
			$modalInstance.close();
			$scope.refresh();
		}).$promise.finally(function () {
			$scope.submitting = false;
		});
	});
	$scope.close = function () {
		$modalInstance.close();
	};
}])
/*修改桌面池*/
.controller('editPoolDialog', ["$scope", "$modal", "$modalInstance", "DeskPool", function ($scope, $modal, $modalInstance, DeskPool) {
	$scope.need_ha = false;
	var selectedServer, raw_need_ha;
	$scope.rollbackChange = function (value) {
		if (value != "1") {
			$scope.need_ha = false;
		} else {
			if (selectedServer && selectedServer.length > 0) {
				$scope.need_ha = angular.copy(raw_need_ha);
				$scope.servers = selectedServer;
			}
		}
	};
	$scope.name = $scope.currentItem.name;
	$scope.desktopNum = $scope.currentItem.instance_max;
	$scope.min_instances = $scope.currentItem.instance_max;
	$scope.rollback = $scope.currentItem.rollback;
	$scope.rollback_monthday = $scope.currentItem.rollback_monthday ? $scope.currentItem.rollback_monthday : "1";
	$scope.rollback_weekday = $scope.currentItem.rollback_weekday ? $scope.currentItem.rollback_weekday : "1";

	$scope.disk_type = $scope.currentItem.disk_type;
	$scope.local_gb = $scope.currentItem.local_gb;
	$scope.data_rollback = $scope.currentItem.data_rollback;
	$scope.data_rollback_monthday = $scope.currentItem.data_rollback_monthday || "1";
	$scope.data_rollback_weekday = $scope.currentItem.data_rollback_weekday || "1";

	$scope.usb_redir = $scope.currentItem.usb_redir;
	// $scope.usb3_disabled = !$scope.currentItem.usb3_editable;
	$scope.usb_version = $scope.currentItem.usb_version || "2.0";

	$scope.running_count = $scope.currentItem.running_count;
	$scope.has_domain = $scope.currentItem.has_domain || false;
	$scope.domain = $scope.currentItem.domain;
	$scope.need_ha = false;
	// $scope.enable_gpu = $scope.currentItem.enable_gpu;

	$scope.ok = function () {
		var _rollback = parseInt(this.rollback);
		var _data_rollback = parseInt(this.data_rollback) >= 0 ? Number(this.data_rollback) : undefined;
		var item = {};
		item.id = $scope.currentItem.id;
		item.pool = $scope.currentItem.pool;
		item.name = this.name;
		item.instance_max = $scope.currentItem.instance_max;
		item.rollback = _rollback;
		item.rollback_monthday = _rollback == 3 ? this.rollback_monthday : undefined;
		item.rollback_weekday = _rollback == 2 ? this.rollback_weekday : undefined;
		item.data_rollback = _data_rollback;
		item.data_rollback_monthday = _data_rollback === 3 ? this.data_rollback_monthday : undefined;
		item.data_rollback_weekday = _data_rollback === 2 ? this.data_rollback_weekday : undefined;
		item.usb_redir = this.usb_redir;
		item.usb_version = item.usb_redir && $scope.currentItem.virtual_type == 'kvm' ? this.usb_version : null;
		item.has_domain = this.has_domain;
		// if($scope.currentItem.virtual_type === 'hyper-v')
		// 	item.enable_gpu			   = this.enable_gpu;
		item.domain = this.domain;
		item.need_ha = item.rollback == 1 && this.need_ha;
		if (item.rollback == 1 && item.need_ha) {
			item.server_ids = $scope.servers.filter(function (value) {
				return value._selected;
			}).map(function (value) {
				return value.id;
			});
			if (item.server_ids < 1) {
				return false;
			}
			item.server_ids = item.server_ids.join(',');
		}
		$scope.loading = true;
		DeskPool.update(item, function () {
			$modalInstance.close();
			$scope.refresh();
		}, function () {
			$scope.refresh();
		}).$promise.finally(function (res) {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]);

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.system", [])

/* 系统 */
.factory("SystemISO", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/isos", null, {
		query: { method: "GET", isArray: false },
		update: { method: "PUT"
			//        loadISO: {method: "POST", url:  $Domain + "/thor/image/loadISO"}
		} });
}]).factory("FenTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "GET", url: $Domain + "/thor/image?type_code=3&type_code=4&type_code=5", isArray: false }
	});
}]).factory("PuTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "GET", url: $Domain + "/thor/image/4", isArray: false }
	});
}]).factory("addTemplate", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/image", null, {
		query: { method: "get", url: $Domain + "/thor/image/register" },
		update: { method: "POST", url: $Domain + "/thor/image/register" }
	});
}]).factory("SystemDesktop", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/sysInsts", null, {
		get_instances: { method: "GET", url: $Domain + "/thor/sysInsts/:id", params: { id: "@id" } },
		add_instances: { method: "POST", url: $Domain + "/thor/sysInsts/:id", params: { id: "@id" } },
		config_instances: { method: "PUT", url: $Domain + "/thor/sysInst/:id", params: { id: "@id" } },
		config_template: { method: "PUT", url: $Domain + "/thor/create_distribute_template" },
		get_devices: { method: "POST", url: $Domain + "/thor/get_pci_devices" },
		register: { method: "POST", url: $Domain + "/thor/register_system_template" },
		add: { method: "POST", url: $Domain + "/thor/system_template" },
		edit: { method: "PUT", url: $Domain + "/thor/system_template" }
	});
}]).factory("SystemBackup", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/admin/backup", null, {
		query: { method: "GET", isArray: false },
		backup: { method: "POST" },
		restore: { method: "POST" },
		delete: { method: "DELETE" },
		get_config: { method: "GET", url: $Domain + "/thor/admin/backup_config" },
		alter_config: { method: "PUT", url: $Domain + "/thor/admin/backup_config" }
	});
}]).factory("SystemUpgrade", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/admin/upgrade", null, {
		query: { method: "GET", isArray: false },
		upload: { method: "POST" },
		upgrade: { method: "PUT" },
		delete: { method: "DELETE" }

	});
}]).factory("SystemLog", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/log", null, {
		query: { method: "GET", isArray: false },
		delete: { method: "DELETE" }
	});
}]).factory("SystemUSB", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/usb", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" },
		update: { method: "PUT" },
		delete: { method: "DELETE" }
	});
}]).factory("CreateDistribute", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/create_distribute_template", null, {
		post: { method: "POST" }
	});
}]).factory("Outside", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/haproxy", null, {
		query: { method: "GET", url: $Domain + "/thor/haproxy/info", isArray: false },
		start: { method: "POST", url: $Domain + "/thor/haproxy/start" },
		stop: { method: "POST", url: $Domain + "/thor/haproxy/stop" },
		save: { method: "POST", url: $Domain + "/thor/haproxy/save" }
	});
}])
//系统资源回收接口
.factory('RecycleTech', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/recycle/public", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" }
	});
}]).factory('RecyclePer', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/recycle/person", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" }
	});
}])
//系统时间同步接口
.factory('SystemTime', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/system-time", null, {
		getInternetSync: { method: "GET", url: $Domain + "/thor/system-time/internet", isArray: false }, // 获取Internet时间服务器同步
		internetSync: { method: "POST", url: $Domain + "/thor/system-time/internet" }, // 与Internet时间服务器同步
		querySyncServer: { method: "GET", url: $Domain + "/thor/system-time/sync", isArray: false }, // 获取同步服务列表
		updateSyncServer: { method: "POST", url: $Domain + "/thor/system-time/sync" }, // 立即同步
		queryZone: { method: "GET", url: $Domain + "/thor/system-time", isArray: false }, // 系统当前时间，以及时区列表
		updateZone: { method: "POST", url: $Domain + "/thor/system-time" // 更新操作系统时区、日期、时间

		} });
}])
// 快速部署
.factory('SystemDeploy', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/init", null, {
		quickstart: { method: "GET", url: $Domain + "/thor/init/quickstart" },
		query_data_network: { method: "GET", url: $Domain + "/thor/networks" },
		// 导入模板镜像
		scan_iso: { method: "GET", url: $Domain + "/thor/init/prepare_import_img" },
		import_iso: { method: "POST", url: $Domain + "/thor/init/prepare_import_img" },
		complete_import: { method: "POST", url: $Domain + "/thor/init/import_img" },
		import_progress: { method: "POST", url: $Domain + "/thor/init/check_file" },
		// 注册教学模板
		list_system_images: { method: "get", url: $Domain + "/thor/image/register" },
		list_sub_networks: { method: "GET", url: $Domain + "/thor/network/:id/subnets", params: { id: "@id" } },
		list_ports: { method: "GET", url: $Domain + "/thor/network/subnet/:id/ports", params: { id: "@id" } },
		register_template: { method: "POST", url: $Domain + "/thor/init/regit_template" },
		// 创建教学场景
		create_scene: { method: "POST", url: $Domain + "/thor/init/create_mode" },
		first_deploy: { method: "GET", url: $Domain + "/thor/init/first_deploy" },
		//系统模块快速部署的界面展现
		quick_deploy_page: { method: "GET", url: $Domain + "/thor/controller/ha_storage_state" }
	});
}]).factory('AutoSnapshot', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/admin/auto_snapshot", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" },
		update: { method: "PUT", url: $Domain + "/thor/admin/auto_snapshot/detail/:id", params: { id: "@id" } },
		active: { method: "POST", url: $Domain + "/thor/admin/auto_snapshot/detail/:id", params: { id: "@id" } },
		delete: { method: "DELETE" }
	});
}]).factory('USBPassThrough', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/admin/thor/usb_pass_through", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" },
		cancel: { method: "DELETE" }
	});
}]).factory('TreeInstances', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/tree_instances", null, {
		query: { method: "GET", isArray: false }
	});
}]).factory('Spice', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/spice_image_compression", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" }
	});
}]).factory('Share', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/share/settings", null, {
		query: { method: "GET", isArray: false },
		save: { method: "POST" }
	});
}]).controller("vdiSystemDesktopListController", ["$scope", "$modal", "SystemDesktop", "FenTemplate", "PuTemplate", "$$$os_types", "$Domain", "$interval", "$$$I18N", function ($scope, $modal, SystemDesktop, FenTemplate, PuTemplate, $$$os_types, $Domain, $interval, $$$I18N) {
	$scope.domain = $Domain;
	$scope.rows = [];

	$scope.images = [];
	$scope.loading = true;

	$scope.currentPage = 1;
	$scope.pagesizes = [30, 20, 10];
	$scope.pagesize = $scope.pagesizes[0];

	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("imageIDS", $scope.rows.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("imagesRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
		$scope.rows.forEach(function (row) {
			var updateInfor = row.sync_status && row.sync_status.filter(function (item) {
				return item.type === "image";
			});
			if (updateInfor && updateInfor.length !== 0) row.updateSize = (updateInfor[0].size / 1024 / 1024 / 1024).toFixed(2);
		});
	});
	$scope.editSysdesktop = function (item) {
		var ins = $modal.open({
			templateUrl: "views/vdi/dialog/system/template_config.html",
			controller: "systemTemplateConfigDialog",
			size: "lg",
			resolve: { param: function param() {
					return item;
				} }
		});
		ins.result.then(function () {
			// $scope.changeType($scope.select);
		});
	};
	function get_rows() {
		FenTemplate.query(function (res) {
			$scope.rows = res.win_images.concat(res.linux_images).concat(res.other_images);

			$scope.rows.forEach(function (row) {
				var os = $$$os_types.filter(function (item) {
					return item.key === row.os_type;
				})[0];
				os && os.icon && (row.icon = os.icon);
				if (row.os_type && row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
				if (row.os_type && row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
			});
			$scope.rows.sort(function (a, b) {
				return a.created_at > b.created_at ? -1 : 1;
			});
			$scope.running = res.running;
			$scope.shutoff = res.shutoff;
			$scope.sync_mode = res.sync_mode;
			$scope.loading = false;
			$scope.teachNames = $scope.rows.map(function (item) {
				return item.name;
			});
			$scope.sameName = false;
		});
	}
	get_rows();

	var _controllerScope = $scope;
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除系统桌面'>删除系统桌面" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_SYSDESK_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance, $q) {
				$scope.name = rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.ok = function () {
					FenTemplate.delete({ id: rows.map(function (item) {
							return item.id;
						}) }, function (res) {
						rows.forEach(function (row) {
							_controllerScope.rows.splice(_controllerScope.rows.indexOf(row), 1);
						});
					}, function (error) {
						template.query(function (res) {
							var newRows = res.win_images.concat(res.linux_images).concat(res.other_images);
							newRows.forEach(function (row) {
								var os = $$$os_types.filter(function (item) {
									return item.key === row.os_type;
								})[0];
								os && os.icon && (row.icon = os.icon);
								if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
								if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
							});
							newRows.sort(function (a, b) {
								return a.created_at > b.created_at ? -1 : 1;
							});
							_controllerScope.rows.splice(0, _controllerScope.rows.length);
							Array.prototype.push.apply(_controllerScope.rows, newRows);
						});
					});
					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("addTemplateDialog", ["$scope", "$modalInstance", "Admin", "addTemplate", "$$$os_types", "UserRole", "FenTemplate", "PuTemplate", "ResourcePool", "Host", "Network", "SystemISO", "SystemDesktop", "$filter", "CreateDistribute", "virtualHost", "$$$I18N", function ($scope, $modalInstance, admin, addTemplate, $$$os_types, UserRole, FenTemplate, PuTemplate, ResourcePool, host, Network, iso, SystemDesktop, $filter, CreateDistribute, virtualHost, $$$I18N) {
	var user = UserRole.currentUser;
	$scope.nets = [];
	$scope.min_namelength = 2;
	$scope.max_namelength = 20;
	$scope.vcpus = 1;
	$scope.ram = 32;
	$scope.system_gb = 10;
	$scope.local_gb = 5;

	$scope.multifyNetsTips = $$$I18N.get('multifyNetsTips');

	$scope.get_host = function (uuid) {
		host.query_agent({ id: uuid }, function (res) {
			$scope.hosts = res.hosts_list.filter(function (h) {
				return h.status === 'active';
			});
			$scope.node = $scope.hosts[0];
			$scope.get_devices($scope.node.host);
		});
	};
	ResourcePool.query(function (res) {
		$scope.pools = res.result.filter(function (item) {
			return item.hosts.length > 0 && item.type == 'kvm';
		});
		if ($scope.pools.length) {
			$scope.source_pool = $scope.pools[0];
			$scope.get_host($scope.source_pool.uuid);
		} else {
			$scope.hosts = [];
		}
	});

	$scope.IPmodes1 = [{ name: $$$I18N.get('不分配'), value: 0 }];
	$scope.IPmodes2 = [{ name: $$$I18N.get('系统分配'), value: 1 }, { name: $$$I18N.get('固定IP'), value: 2 }];
	function getNetwork(key) {
		$scope.loading = true;
		Network.query(function (data) {
			if (data.networks.length) {
				$scope.nets.push({ key: key, networks: data.networks, network: data.networks[0] });
				$scope.get_subnet(data.networks[0], key);
			}
		});
	}
	getNetwork(new Date());
	$scope.get_subnet = function (network, key) {
		if (network.subnets.length) {
			Network.query_sub({
				id: network.id
			}, function (res) {
				var subnetworks = [];
				subnetworks = res.result.map(function (n) {
					n._desc = n.start_ip ? n.name + " (" + n.start_ip + " - " + n.end_ip + ") " : n.name;
					return n;
				});
				$scope.nets.forEach(function (item) {
					if (item.key === key) {
						item.subnetworks = subnetworks;
						item.subnetwork = subnetworks[0];
						$scope.clearBindIp(key);
					}
				});
				$scope.loading = false;
			});
		} else {
			$scope.loading = false;
			$scope.nets.forEach(function (item) {
				if (item.key === key) {
					item.subnetworks = [];
					item.subnetwork = null;
					$scope.clearBindIp(key);
				}
			});
		}
	};
	$scope.clearBindIp = function (key) {
		$scope.nets.forEach(function (item) {
			if (item.key === key) {
				if (item.subnetwork) {
					item.IPmodes = $scope.IPmodes2;
				} else {
					item.IPmodes = $scope.IPmodes1;
				}
				item.IPmode = item.IPmodes[0];
				item.ip = null;
			}
		});
	};

	$scope.host_loading = true;

	$scope.get_devices = function (hostname) {
		SystemDesktop.get_devices({ host: hostname }, function (res) {
			$scope.host_loading = false;
			$scope.devices = res.result.filter(function (item) {
				return item.status === "available";
			});
		});
	};
	$scope.selectAllHost = function (bool) {
		$scope.devices.map(function (item) {
			item._selected = bool;
			return item;
		});
	};
	$scope.selectOneHost = function () {
		$scope.is_all = $scope.devices.every(function (item) {
			return item._selected === true;
		});
	};

	iso.query(function (res) {
		$scope.isos = res.isos.filter(function (iso) {
			return iso.os_type && iso.type !== "package" && iso.type !== "other";
		});
		$scope.isos.forEach(function (item) {
			item.os_type = item.os_type.split(",");
		});
		$scope.iso = $scope.isos[0];
	});

	$scope.addNet = function () {
		getNetwork(new Date());
	};
	$scope.minusNet = function (i) {
		var idx = $scope.nets.indexOf(i);
		$scope.nets.splice(idx, 1);
	};
	var newWindow;
	setTimeout(function () {
		$("#finish").on('click', function () {
			newWindow = window.open('templateModifybt.html#0');
		});
	});

	// 判断网络数组中两两是否有两个相同的子网id
	function giveTip(array) {
		var flag = false;
		array.forEach(function (item, index) {
			for (var i = index + 1; i < array.length; i++) {
				console.log(array[index], array[i]);
				if (array[index]['subnetwork'] && array[i]['subnetwork'] && array[index]['subnetwork']['id'] == array[i]['subnetwork']['id']) {
					flag = true;
				}
			}
		});
		return flag;
	}
	$scope.ok = function () {
		$scope.devices_selected = $filter("selectedFilter")($scope.devices);
		// if($scope.devices_selected.length!==0){
		var me = this;
		$scope.submiting = true;
		$scope.afterSubmiting = false;
		var postData = {
			display_name: this.display_name,
			type_code: this.type,
			source_pool: this.source_pool.uuid,
			node: this.node.id,
			network: this.nets.map(function (item) {
				if (!item.network.id) return "";else return item.network.id;
			}),
			subnet: this.nets.map(function (item) {
				if (!item.subnetwork) return "";else return item.subnetwork.id;
			}),
			band_ip: this.nets.map(function (item) {
				if (!item.ip) return "";else return item.ip;
			}),
			iso_path: this.iso.name,
			iso_id: this.iso.id,
			vcpus: this.vcpus,
			ram: this.ram * 1024,
			pci_devices_node: $scope.devices_selected.map(function (item) {
				return item.compute_node_id;
			}),
			pci_devices_address: $scope.devices_selected.map(function (item) {
				return item.address;
			}),
			system_gb: this.system_gb,
			local_gb: this.local_gb,
			start_on_host_boot: this.start_on_host_boot,
			virtual_type: this.source_pool.type
		};
		//需求1651,新增和编辑模板都在新打开的vnc页面提示IP重复
		// if(giveTip(this.nets)){
		// 	$.bigBox({
		// 		title: $$$I18N.get("INFOR_TIP"),
		// 		content:$$$I18N.get("不同网卡上不能存在相同网段的IP"),
		// 		timeout:6000
		// 	});
		// }
		SystemDesktop.add(postData, function (res) {
			var alertFlag = giveTip(me.nets);
			$scope.submiting = false;
			$scope.afterSubmiting = true;
			FenTemplate.query(function (res) {
				var newRows = res.win_images.concat(res.linux_images).concat(res.other_images);
				newRows.forEach(function (row) {
					var os = $$$os_types.filter(function (item) {
						return item.key === row.os_type;
					})[0];
					os && os.icon && (row.icon = os.icon);
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, newRows);
				var template = $scope.rows.filter(function (temp) {
					return temp.name == postData.display_name;
				})[0];
				if (res.sync_mode === 'scp') newWindow.location.replace('templateModify.html#' + template.id + '&' + template.os_type + '&' + template.name + '&sytem_desktop' + '&sameIp=' + alertFlag);else newWindow.location.replace('templateModifybt.html#' + template.id + '&' + template.os_type + '&' + template.name + '&sytem_desktop' + '&sameIp=' + alertFlag);
			});
			$modalInstance.close();
		}, function (res) {
			newWindow.close();
			$scope.submiting = false;
			$scope.afterSubmiting = false;
		});
		// }
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("systemTemplateRegisterDialog", ["$scope", "$modalInstance", "Admin", "addTemplate", "$$$os_types", "UserRole", "FenTemplate", "PuTemplate", "ResourcePool", "Host", "Network", "SystemISO", "SystemDesktop", "$filter", "CreateDistribute", "virtualHost", "$$$I18N", "registerTemplate", function ($scope, $modalInstance, admin, addTemplate, $$$os_types, UserRole, FenTemplate, PuTemplate, ResourcePool, host, Network, iso, SystemDesktop, $filter, CreateDistribute, virtualHost, $$$I18N, registerTemplate) {
	var user = UserRole.currentUser;
	$scope.nets = [];
	$scope.min_namelength = 2;
	$scope.max_namelength = 20;
	$scope.vcpus = 1;
	$scope.ram = 32;
	$scope.system_gb = 10;
	$scope.local_gb = 5;

	$scope.multifyNetsTips = $$$I18N.get('multifyNetsTips');

	$scope.get_host = function (uuid) {
		host.query_agent({ id: uuid }, function (res) {
			$scope.hosts = res.hosts_list.filter(function (h) {
				return h.status === 'active';
			});
			$scope.node = $scope.hosts[0];
			$scope.get_devices($scope.node.host);
		});
	};
	ResourcePool.query(function (res) {
		$scope.pools = res.result.filter(function (item) {
			return item.hosts.length > 0 && item.type == 'kvm';
		});
		if ($scope.pools.length) {
			$scope.source_pool = $scope.pools[0];
			$scope.get_host($scope.source_pool.uuid);
		} else {
			$scope.hosts = [];
		}
	});

	registerTemplate.query(function (res) {
		$scope.sys_isos = res.system_image.filter(function (item) {
			return item.virtual_type == 'kvm';
		});
		$scope.sys_iso = res.system_image[0];
		$scope.old_data_isos = res.data_image;
		if ($scope.sys_iso) {
			$scope.getDataImgs($scope.sys_iso);
		}
	});
	$scope.filterDataISO = function (data_iso, data_iso2) {
		if (data_iso) {
			$scope.data_isos2 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso.name;
			});
		} else {
			$scope.data_isos2 = $scope.data_isos;
		}
		if (data_iso2) {
			$scope.data_isos1 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso2.name;
			});
		} else {
			$scope.data_isos1 = $scope.data_isos;
		}
	};
	$scope.getDataImgs = function (systemImg, is_init) {
		if (systemImg) {
			this.data_iso = undefined;
			this.data_iso2 = undefined;
			$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function (item) {
				return item.virtual_type == systemImg.virtual_type;
			});
		}
	};

	$scope.IPmodes1 = [{ name: $$$I18N.get('不分配'), value: 0 }];
	$scope.IPmodes2 = [{ name: $$$I18N.get('系统分配'), value: 1 }, { name: $$$I18N.get('固定IP'), value: 2 }];
	function getNetwork(key) {
		$scope.loading = true;
		Network.query(function (data) {
			if (data.networks.length) {
				$scope.nets.push({ key: key, networks: data.networks, network: data.networks[0] });
				$scope.get_subnet(data.networks[0], key);
			}
		});
	}
	getNetwork(new Date());
	$scope.get_subnet = function (network, key) {
		if (network.subnets.length) {
			Network.query_sub({
				id: network.id
			}, function (res) {
				var subnetworks = [];
				subnetworks = res.result.map(function (n) {
					n._desc = n.start_ip ? n.name + " (" + n.start_ip + " - " + n.end_ip + ") " : n.name;
					return n;
				});
				$scope.nets.forEach(function (item) {
					if (item.key === key) {
						item.subnetworks = subnetworks;
						item.subnetwork = subnetworks[0];
						$scope.clearBindIp(key);
					}
				});
				$scope.loading = false;
			});
		} else {
			$scope.loading = false;
			$scope.nets.forEach(function (item) {
				if (item.key === key) {
					item.subnetworks = [];
					item.subnetwork = null;
					$scope.clearBindIp(key);
				}
			});
		}
	};
	$scope.clearBindIp = function (key) {
		$scope.nets.forEach(function (item) {
			if (item.key === key) {
				if (item.subnetwork) {
					item.IPmodes = $scope.IPmodes2;
				} else {
					item.IPmodes = $scope.IPmodes1;
				}
				item.IPmode = item.IPmodes[0];
				item.ip = null;
			}
		});
	};

	$scope.host_loading = true;

	$scope.get_devices = function (hostname) {
		SystemDesktop.get_devices({ host: hostname }, function (res) {
			$scope.host_loading = false;
			$scope.devices = res.result.filter(function (item) {
				return item.status === "available";
			});
		});
	};
	$scope.selectAllHost = function (bool) {
		$scope.devices.map(function (item) {
			item._selected = bool;
			return item;
		});
	};
	$scope.selectOneHost = function () {
		$scope.is_all = $scope.devices.every(function (item) {
			return item._selected === true;
		});
	};

	iso.query(function (res) {
		$scope.isos = res.isos.filter(function (iso) {
			return iso.os_type && iso.type !== "package" && iso.type !== "other";
		});
		$scope.isos.forEach(function (item) {
			item.os_type = item.os_type.split(",");
		});
		$scope.iso = $scope.isos[0];
	});

	$scope.addNet = function () {
		getNetwork(new Date());
	};
	$scope.minusNet = function (i) {
		var idx = $scope.nets.indexOf(i);
		$scope.nets.splice(idx, 1);
	};

	// 判断网络数组中两两是否有两个相同的子网id
	function giveTip(array) {
		var flag = false;
		array.forEach(function (item, index) {
			for (var i = index + 1; i < array.length; i++) {
				if (array[index]['subnetwork']['id'] == array[i]['subnetwork']['id']) {
					flag = true;
				}
			}
		});
		return flag;
	}

	$scope.ok = function () {
		$scope.devices_selected = $filter("selectedFilter")($scope.devices);
		// if($scope.devices_selected.length!==0){
		var me = this,
		    alertTip;
		alertTip = giveTip(me.nets);
		var postData = {
			display_name: this.display_name,
			type_code: this.type,
			source_pool: this.source_pool.uuid,
			node: this.node.id,
			network: this.nets.map(function (item) {
				if (!item.network.id) return "";else return item.network.id;
			}),
			subnet: this.nets.map(function (item) {
				if (!item.subnetwork) return "";else return item.subnetwork.id;
			}),
			band_ip: this.nets.map(function (item) {
				if (!item.ip) return "";else return item.ip;
			}),
			vcpus: this.vcpus,
			ram: this.ram * 1024,
			system_image_file: this.sys_iso,
			data_image_file: this.data_iso ? this.data_iso : undefined,
			pci_devices_node: $scope.devices_selected.map(function (item) {
				return item.compute_node_id;
			}),
			pci_devices_address: $scope.devices_selected.map(function (item) {
				return item.address;
			}),
			start_on_host_boot: this.start_on_host_boot,
			virtual_type: this.source_pool.type
		};
		if (alertTip) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("不同网卡上不能存在相同网段的IP"),
				timeout: 6000
			});
			return false;
		}
		$scope.afterSubmiting = false;
		$scope.submiting = true;
		SystemDesktop.register(postData, function (res) {
			$scope.submiting = false;
			$scope.afterSubmiting = true;
			FenTemplate.query(function (res) {
				var newRows = res.win_images.concat(res.linux_images).concat(res.other_images);
				newRows.forEach(function (row) {
					var os = $$$os_types.filter(function (item) {
						return item.key === row.os_type;
					})[0];
					os && os.icon && (row.icon = os.icon);
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, newRows);
			});
			$modalInstance.close();
		}, function () {
			$scope.submiting = false;
			$scope.afterSubmiting = false;
		});
		// }
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("vdiSystemBackupListController", ["$scope", "$modal", "SystemBackup", "$Domain", function ($scope, $modal, backup, $Domain) {
	$scope.rows = [];$scope.loading = true;

	$scope.getList = function () {
		backup.query(function (data) {
			$scope.allRows = data.ret;
			$scope.rows = data.ret;
			$scope.loading = false;
		});
	};
	$scope.getList();
	$scope.currentPage = 1;
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];

	var controller_scope = $scope;
	$scope.getURL = function (item) {
		return $Domain + "/thor/admin/download?file_name=" + item.name;
	};
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (item) {
			return item._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='BACKUP_DE'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='BACKUP_DE_CONTENT'=></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					backup.delete({ name: rows.map(function (row) {
							return row.name;
						}) }, function (data) {
						controller_scope.getList();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.backup = function () {
		$scope.submitting = true;
		backup.backup({ method: "backup" }, function (data) {
			controller_scope.getList();
		}).$promise.finally(function () {
			$scope.submitting = false;
		});
	};
	$scope.config = function () {
		$modal.open({
			controller: "systemBackupConfigController",
			templateUrl: "views/vdi/dialog/system/system_backup_config.html",
			size: "md"
		});
	};
}]).controller("vdiSystemISOListController", ["$scope", "SystemISO", "$modal", "$rootScope", "$filter", "$$$os_types", "$Domain", function ($scope, iso, $modal, $rootScope, $filter, $$$os_types, $Domain) {
	$$$os_types = $$$os_types.filter(function (type) {
		return type.key !== 'Windows 7';
	});
	$scope.rows = [];$scope.loading = true;$scope.domain = $Domain;
	var rows = [];
	function loadIso() {
		iso.query(function (res) {
			$scope.rows = res.isos;
			$scope.loading = false;
			var test = /Windows 7/;
			$scope.rows.forEach(function (item) {
				//item.os_type = $$$os_types[Math.random() * $$$os_types.length ^ 0].key;
				item.origin_os_type = item.os_type;
				if (item.os_type) {
					var type = $$$os_types.filter(function (type) {
						return type.key === item.os_type;
					})[0];
					if (type) {
						item.os_type = type;
					} else if (test.test(item.os_type)) {
						item.os_type = { "key": "Windows 7", "value": "Windows 7 series" };
					}
				}
				// item.editable = false;
				item.old_type = item.type;
				item.old_os_type = item.os_type;
				item.type_editable = false;
				item.os_editable = false;
			});
			angular.copy($scope.rows, rows);
			$scope.select = "";
		});
	}
	loadIso();
	var upload_id = 'system_iso_upload';
	var uploadModal;
	$scope.$on("progress", function (e, size) {
		if (size.id === upload_id) {
			if (uploadModal) {
				uploadModal.close();
				uploadModal = undefined;
			}
			$scope.progressName = size.name;
			$scope.isUploading = true;
			$scope.progressPercent = (size.loaded / size.total * 100).toFixed(2) + "%";
			if ($scope.progressPercent === "100.00%") {
				$scope.isUploading = false;
			}
		}
	});
	$scope.$on("finishISOUpload", function () {
		console.log("finished refresh");
		loadIso();
	});
	$scope.upload = function () {
		uploadModal = $modal.open({
			templateUrl: "./views/vdi/dialog/system/upload_iso.html",
			controller: "systemUploadIsoDialog",
			resolve: {
				param: function param() {
					return { "upload_id": upload_id };
				}
			}
		});
	};
	$scope.abortUpload = function () {
		var xhr = $rootScope.uploadPool[upload_id];
		xhr && xhr.abort();
		$scope.isUploading = false;
	};
	$scope.filter_iso = function (item) {
		if (!item) {
			$scope.rows = rows;
			return true;
		}
		$scope.rows = rows.filter(function (row) {
			return row.type == $scope.select;
		});
	};
	$scope.updateData = function (text, select) {
		$scope.rows = rows.filter(function (row) {
			if (select) {
				return row.type === select;
			}
			return true;
		});
	};
	$scope.os_types = $$$os_types;
	$scope.currentPage = 1;
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.change = function (item) {
		var new_item = JSON.parse(JSON.stringify(item));
		if (new_item.os_type) {
			new_item.os_type = item.support_auto_install ? item.origin_os_type : item.os_type.key;
		}
		iso.update(new_item, function (res) {
			rows.map(function (row) {
				if (res.result && row.id == res.result.id) {
					row.os_type = item.os_type;
					row.type = item.type;
					row.old_type = item.type;
					row.old_os_type = item.os_type;
					row.type_editable = false;
					row.os_editable = false;
				}
				return row;
			});
		}).$promise.finally(function () {
			loadIso();
		});
		$scope.filter_iso($scope.select);
	};
	$scope.hideButton = function () {
		$scope.uploadStart = false;
	};
	var _scope = $scope;
	$scope.delete = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='ISO_DELETE'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_ISO_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.name = item.name;
				$scope.ok = function () {
					iso.delete({
						ids: [item.id]
					}, function (res) {
						loadIso();
					});
					$modalInstance.close();
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	$scope.edit = function (item) {
		item.os_editable = !item.support_auto_install;
		item.type_editable = true;
	};
	$scope.cancel = function (item) {
		item.type = item.old_type;
		item.os_type = item.old_os_type;
		if (!item.support_auto_install) item.os_editable = !item.os_editable;
		item.type_editable = !item.type_editable;
	};
}]).controller("vdiSystemLogListController", ["$scope", "SystemLog", "$modal", function ($scope, log, $modal) {
	$scope.rows = [];
	$scope.loading = true;

	$scope.currentPage = 1;
	$scope.pagesize = Number($$$storage.getSessionStorage('log_pagesize')) || 30;
	$scope.$watch("pagesize", function (newvalue) {
		$scope.pagesize = newvalue || 0;
		$$$storage.setSessionStorage('alarm_pagesize', newvalue ? newvalue : 0);
	});

	var last;
	$scope.search = function (e) {
		last = e.timeStamp;
		setTimeout(function () {
			if (last - e.timeStamp == 0) {
				fn_get_logs($scope.searchText);
			}
		}, 500);
	};

	var _start = 0;
	var fn_get_logs = function fn_get_logs(searchText) {
		var size = Number($scope.pagesize) > 0 ? Number($scope.pagesize) : 0;
		log.query({
			displayLength: size,
			displayStart: ($scope.currentPage - 1) * size,
			search: searchText ? searchText : ""
		}, function (data) {
			$scope.rows = data.data.sort(function (a, b) {
				return b.datetime - a.datetime;
			});
			$scope.totalCount = searchText ? data.totalDisplayRecords : data.totalRecords;
			$scope.loading = false;
			_start = data.displayStart;
		});
	};
	fn_get_logs();

	$scope.logPageSizeChange = function () {
		$scope.currentPage = $scope.pagesize ? Math.floor(_start / $scope.pagesize) + 1 : 0;
		fn_get_logs();
	};
	$scope.logPageChange = function () {
		fn_get_logs($scope.searchText);
	};

	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});

		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_LOG'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_LOG_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					log.delete({ ids: rows.map(function (row) {
							return row.id;
						}) }, function (data) {
						fn_get_logs();
					});
					$modalInstance.close();
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.deleteAll = function () {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_RIZHI'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_RIZHI_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					log.delete({ ids: 'all' }, function (data) {
						fn_get_logs();
					});
					$modalInstance.close();
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}])
// .controller("vdiSystemEndlogListController", ["$scope", "$modal", function($scope, $modal){
// 	$scope.rows = [];
// 	$scope.loading = true;

//     $scope.currentPage = 1;
//     $scope.pagesize = Number(localStorage.log_pagesize) || 30;
// 	$scope.$watch("pagesize" , function(newvalue){
// 		$scope.pagesize = newvalue || 0;
// 		localStorage.log_pagesize = newvalue ? newvalue : 0;
// 	});

// 	var _start = 0;
// 	var fn_get_logs = function(){
// 		var size = Number($scope.pagesize) > 0 ? Number($scope.pagesize) : 0;
// 		// log.query({
// 		// 	displayLength: size,
// 		// 	displayStart: ($scope.currentPage - 1) * size,
// 		// 	search: ""
// 		// }, function(data){
// 		// 	$scope.rows = data.data.sort(function(a,b){
// 		// 		return b.datetime - a.datetime;
// 		// 	});
// 		// 	$scope.totalCount = data.totalRecords;
// 		// 	$scope.loading = false;
// 		// 	_start = data.displayStart;
// 		// });
// 	};
// 	fn_get_logs();

// 	$scope.logPageSizeChange = function(){
// 		$scope.currentPage = $scope.pagesize ? Math.floor(_start / $scope.pagesize) + 1 : 0;
// 		fn_get_logs();
// 	};
// 	$scope.logPageChange = function(){
// 		fn_get_logs();
// 	};

// 	$scope.delete = function(item){
// 		var rows = item ? [item] : $scope.rows.filter(function(row){ return row._selected; });

// 		$modal.open({
// 			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_LOG'>"+
// 						"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_LOG_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
// 			controller : function($scope, $modalInstance){
// 				$scope.ok = function(){
// 					// log.delete({ids:rows.map(function(row){ return row.id })},function(data){
// 					// 	fn_get_logs();
// 					// });
// 					$modalInstance.close();
// 				},
// 				$scope.close = function(){
// 					$modalInstance.close();
// 				}
// 			},
// 			size : "sm"
// 		});
// 	};
// 	$scope.deleteAll = function(){
// 		$modal.open({
// 			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_RIZHI'>"+
// 						"</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_RIZHI_CONTENT'></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
// 			controller : function($scope, $modalInstance){
// 				$scope.ok = function(){
// 					// log.delete({ids:'all'}, function(data){
// 					// 	fn_get_logs();
// 					// });
// 					$modalInstance.close();
// 				},
// 				$scope.close = function(){
// 					$modalInstance.close();
// 				}
// 			},
// 			size : "sm"
// 		});

// 	};
// }])
.controller("vdiSystemUpgradeListController", ["$scope", "SystemUpgrade", "$modal", "$$$I18N", "$$$MSG", function ($scope, upgrade, $modal, $$$I18N, $$$MSG) {
	function getList() {
		$scope.loading = true;
		$scope.rows = [];
		upgrade.query(function (data) {
			var _data = data.versions;
			var new_data = {};
			_data.forEach(function (d, idx) {
				d._idx = idx;
				// 上传包类型
				// d.packtype = d.owner === 'win_client' ? 'zip' : 'bin';
				if (d.owner === 'win_client') {
					d.packtype = 'zip';
				} else if (d.owner === 'android_client') {
					d.packtype = 'apk';
				} else if (d.owner.indexOf('guesttool') !== -1) {
					d.packtype = 'iso';
				} else {
					d.packtype = 'bin';
				}
				if (new_data[d.owner]) {
					new_data[d.owner].push(d);
				} else {
					new_data[d.owner] = [d];
				}
			});
			Object.keys(new_data).forEach(function (i) {
				$scope.rows.push(new_data[i]);
			});
			$scope.loading = false;
		});
	}
	getList();
	$scope.viewDetail = function (witch) {
		$modal.open({
			resolve: {
				modal_data: function modal_data() {
					return witch;
				}
			},
			backdrop: 'static',
			controller: "systemUpgradeDetailDialog",
			templateUrl: "views/vdi/dialog/system/system_upgrade_detail.html",
			size: 'lg'
		});
	};

	$scope.currentPage = 1;
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.finish = function () {
		getList();
	};
	$scope.upgrade = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='升级'>" + "升级</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;'>{{ MESS }}</p><footer class='text-right'><button ng-if='!submitting' class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><img src='img/loadingtext.gif' ng-if='submitting' height='24' width='24' alt=''><button  ng-if='!submitting'  class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				switch (item.owner) {
					case 'win_client':
					case 'lin_client':
					case 'arm_client':
					case 'android_client':
						$scope.MESS = $$$I18N.get("2UPGRADEMESS");
						break;
					case 'console':
					case 'agent':
						$scope.MESS = $$$I18N.get("UPGRADEMESS");
						break;
					default:
						$scope.MESS = $$$I18N.get("UPGRADEMESS");
						break;
				}
				$scope.ok = function () {
					$scope.submitting = true;
					item['auto'] = true;
					upgrade.upgrade(item, function () {
						getList();
						$modalInstance.close();
					}).$promise.finally(function () {
						$scope.submitting = false;
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "md"
		});
	};
}]).controller("vdiSystemUSBListController", ["$scope", "$modal", "SystemUSB", "$$$I18N", function ($scope, $modal, systemusb, $$$I18N) {
	$scope.rows = [];
	// var allRows = [];
	$scope.loading = true;
	systemusb.get(function (res) {
		//$scope.rows = [{id: 1, class_id: '0x00', priority: 2, rule_name: "ffff", product_id: "0x1111", vendor_id: "0x1234", allow: true}];
		$scope.rows = res.result;
		$scope.rows.forEach(function (item) {
			item.class_id = { key: item.class_id, value: $$$I18N.get(item.class_id) };
		});
		$scope.loading = false;
		// angular.copy($scope.rows,allRows);
	});

	$scope.sortClass_id = function (order) {
		$scope.rows.sort(function (a, b) {
			return a.class_id.key > b.class_id.key ? 1 : -1;
		});
		if (order) {
			$scope.rows.reverse();
		}
	};

	$scope.currentPage = 1;
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.delete = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var rows = $scope.rows;

		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELE_USB'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELE_USB_TIP'=></p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					systemusb.delete({ ids: selected_rows.map(function (row) {
							return row.id;
						}) }, function (res) {
						selected_rows.forEach(function (item) {
							var index = rows.indexOf(item);
							rows.splice(index, 1);
						});
					});

					$modalInstance.close();
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	// $scope.updateData = function(text){
	// 	$scope.rows = allRows.filter(function(row){
	// 		if(text.trim()){
	// 			return row.rule_name.indexOf(text.trim()) !== -1;
	// 		}
	// 		return true;
	// 	});
	// };
}])
// .controller("vdiSystemDeviceListController", ["$scope", "$modal", "$$$I18N", function($scope, $modal, $$$I18N){
// 	$scope.rows = [];

// 	var get_rows = function(){
// 		$scope.rows = [{name: 'iToken S3000', made: '天地融', PID: '3d45', VID: 'df45', host: "agent1", desktop: "zhujianchen", desc: "是的法规法规"}];
// 	};
// 	get_rows();

// 	$scope.transmission = function(){
// 		var device = this.item;
// 		var dialog = $modal.open({
// 			templateUrl: "views/vdi/dialog/system/transmission.html",
// 			controller: "transmissionDialog",
// 			size: "sm",
// 			resolve:{
// 				params : function(){
// 					return { device: angular.copy(device) };
// 				}
// 			}
// 		});
// 		dialog.result.then(function(data){
// 			if(data){
// 				get_rows();
// 			}
// 		});
// 	}

// 	$scope.currentPage = 1;
// 	$scope.pagesizes = [10,20,30];
// 	$scope.pagesize = $scope.pagesizes[0];
// }])
.controller("transmissionDialog", ["$scope", "$modalInstance", "$$$I18N", "params", function ($scope, $modalInstance, $$$I18N, params) {
	$scope.device = params.device;

	$scope.desktops = [{ id: "df", name: 'zhujianchen' }, { id: "fg", name: 'egg' }];

	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("addSystemUSBDialog", ["$scope", "$modalInstance", "SystemUSB", "$$$I18N", function ($scope, $modalInstance, systemusb, $$$I18N) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.data = { allow: 'true' };
	$scope.types = [];
	var keys = ['0x01', '0x02', '0x03', '0x05', '0x06', '0x07', '0x08', '0x09', '0x0A', '0x0B', '0x0D', '0x0E', '0x0F', '0x10', '0x11', '0xDC', '0xE0', '0xEF', '0xFE', '0xFF', '-1'];
	keys.forEach(function (item) {
		$scope.types.push({ key: item, value: $$$I18N.get(item) });
	});
	$scope.data.class_id = $scope.types[0];
	$scope.master = { allow: true, class_id: $scope.types[0] };
	$scope.reset = function () {
		$scope.data = $scope.master;
	};
	$scope.isUnchanged = function () {
		return angular.equals($scope.master, $scope.data);
	};
	$scope.ok = function () {
		systemusb.save({
			class_id: $scope.data.class_id.key,
			priority: $scope.data.priority,
			rule_name: $scope.data.rule_name,
			product_id: $scope.data.product_id == '-1' ? $scope.data.product_id : "0x" + $scope.data.product_id,
			vendor_id: $scope.data.vendor_id == '-1' ? $scope.data.vendor_id : "0x" + $scope.data.vendor_id,
			allow: $scope.data.allow == "true" ? true : false
		}, function (res) {
			systemusb.get(function (res) {
				res.result.forEach(function (item) {
					item.class_id = { key: item.class_id, value: $$$I18N.get(item.class_id) };
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, res.result);
			});
		});
		$modalInstance.close();
	};

	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("editSystemUSBDialog", ["$scope", "$modalInstance", "SystemUSB", "$$$I18N", function ($scope, $modalInstance, systemusb, $$$I18N) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.types = [];
	var keys = ['0x01', '0x02', '0x03', '0x05', '0x06', '0x07', '0x08', '0x09', '0x0A', '0x0B', '0x0D', '0x0E', '0x0F', '0x10', '0x11', '0xDC', '0xE0', '0xEF', '0xFE', '0xFF', '-1'];
	keys.forEach(function (item) {
		$scope.types.push({ key: item, value: $$$I18N.get(item) });
	});
	var item = $scope.item || $scope.currentItem;
	if (item.product_id.indexOf("0x") > -1) {
		item.product_id = item.product_id == -1 ? "-1" : item.product_id.substring(2);
	}
	if (item.vendor_id.indexOf("0x") > -1) {
		item.vendor_id = item.vendor_id == -1 ? "-1" : item.vendor_id.substring(2);
	}
	$scope.data = angular.copy(item);

	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.data) || angular.equals($scope.currentItem, $scope.data);
	};
	$scope.reset = function () {
		$scope.data = angular.copy($scope.item || $scope.currentItem);
	};

	$scope.ok = function () {
		systemusb.update({
			group_id: $scope.data.id,
			class_id: $scope.data.class_id.key,
			priority: $scope.data.priority,
			rule_name: $scope.data.rule_name,
			product_id: $scope.data.product_id == '-1' ? $scope.data.product_id : "0x" + $scope.data.product_id,
			vendor_id: $scope.data.vendor_id == '-1' ? $scope.data.vendor_id : "0x" + $scope.data.vendor_id,
			allow: $scope.data.allow
		}, function (res) {
			systemusb.get(function (res) {
				res.result.forEach(function (item) {
					item.class_id = { key: item.class_id, value: $$$I18N.get(item.class_id) };
				});
				$scope.rows.splice(0, $scope.rows.length);
				Array.prototype.push.apply($scope.rows, res.result);
			});
			$modalInstance.close();
		}, function () {});
	};

	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("systemUpgradeDetailDialog", ["$scope", "SystemUpgrade", "modal_data", "$modalInstance", function ($scope, SystemUpgrade, modal_data, $modalInstance) {

	SystemUpgrade.query({ owner: modal_data }, function (res) {
		$scope.rows = res.result;
	});
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller('vdiSystemDesktopDetailController', ['$scope', '$modal', 'SystemDesktop', '$routeParams', '$interval', '$filter', '$$$os_types', 'VMCommon', 'PersonDesktop', '$$$I18N', function ($scope, $modal, SystemDesktop, $routeParams, $interval, $filter, $$$os_types, vm, person_desktop, $$$I18N) {
	$scope.$root && $scope.$root.$broadcast("navItemSelected", ["系统", "系统桌面", "桌面详情"]);

	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("instanceIDS", $filter("paging")($scope.rows, $scope.currentPage, $scope.pagesize).map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("instancesRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
	});

	$scope.refresh = function () {
		var _s = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : $scope;

		var _id = $routeParams.id;
		_s.select = '';
		SystemDesktop.get_instances({ id: _id }, function (res) {
			_s.rows = res.result.result;
			_s.allRows = res.result.result;
			_s.rows.forEach(function (row) {
				var os = $$$os_types.filter(function (item) {
					return item.key === row.os_type;
				})[0];
				os && os.icon && (row.icon = os.icon);
			});
			_s.loading = false;
		});
	};

	$scope.pagesize = Number($$$storage.getSessionStorage('personl_pagesize')) || 30;
	$scope.currentPage = 1;

	$scope.$watch("pagesize", function (newvalue) {
		$$$storage.setSessionStorage('personl_pagesize', newvalue);
	});

	$scope.loading = true;
	$scope.rows = [];
	$scope.refresh();

	$scope.changeStatus = function () {
		$scope.rows = $filter("filter")($scope.allRows, $scope.select).map(function (item) {
			item._selected = false;return item;
		});
	};

	var _controllerScope = $scope;
	$scope.start = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'shutdown' || row.status == 'suspended');
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP1"),
				timeout: 6000
			});
		} else {
			vm.start({ instance_ids: rows.map(function (row) {
					row.status = "building";return row.instance_id;
				}) }, function () {
				$scope.refresh();
			});
		}
	};

	$scope.forceShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended');
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP2"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面强制关机'>" + "桌面强制关机</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定强制关闭桌面吗'>确定强制关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						vm.shutdowns({ instance_ids: rows.map(function (row) {
								row._selected = false;
								row.status = "building";
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.natureShutdown = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended');
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP3"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面自然关机'>" + "桌面自然关机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定自然关闭桌面吗'>确定自然关闭桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
							row.status = "building";
						});
						vm.shutdowns({ is_soft: 'true', instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.restart = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && (row.status == 'running' || row.status == 'suspended');
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP4"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面重启'>" + "桌面重启</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启桌面吗'>确定重启桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
							row.status = "building";
						});
						vm.reboots({ is_soft: 'true', instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.pause = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'running';
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP5"),
				timeout: 6000
			});
		} else {

			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面暂停'>" + "桌面暂停</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定暂停桌面吗'>确定暂停桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
							row.status = "building";
						});
						vm.pause({ instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.resume = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status == 'paused';
		});
		if (rows.length == 0) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiDesktopPersonalList_TIP6"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面恢复'>" + "桌面恢复</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定恢复桌面吗'>确定恢复桌面吗?</p><footer   class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						rows.map(function (row) {
							row._selected = false;
							row.status = "building";
						});
						vm.resume({ instance_ids: rows.map(function (row) {
								return row.instance_id;
							}) }, function () {
							_controllerScope.refresh();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		var is_running = rows.some(function (row) {
			return row.status == 'running';
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='桌面删除'>" + "桌面删除</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-show='!is_run' style='margin-bottom:20px;' localize='桌面删除后无法恢复，确定删除桌面吗'>桌面删除后无法恢复，确定删除桌面吗?</p><p ng-show='is_run' style='margin-bottom:20px;' localize='存在未关机的桌面，仍然删除桌面吗'>存在未关机的桌面，仍然删除桌面吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.is_run = is_running;
				$scope.ok = function () {
					$modalInstance.close();
					person_desktop.delete({ instance_ids: rows.map(function (row) {
							return row.instance_id;
						}) }, function (data) {
						rows.forEach(function (r) {
							_controllerScope.refresh();
						});
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	$scope.add = function () {
		var instance = $modal.open({
			templateUrl: "views/vdi/dialog/system/system_desktop_add.html",
			controller: "systemDesktopAddDialog",
			size: "md"
		});
		instance.result.then(function () {
			_controllerScope.refresh();
		});
	};

	$scope.config = function (item) {
		var instance = $modal.open({
			templateUrl: "views/vdi/dialog/system/system_desktop_config.html",
			controller: "systemDesktopConfigDialog",
			size: "md",
			resolve: { param: function param() {
					return item;
				} }
		});
		instance.result.then(function () {
			_controllerScope.refresh();
		});
	};
}]).controller('systemDesktopConfigDialog', ['$scope', 'param', 'SystemDesktop', 'Host', '$filter', '$modalInstance', function ($scope, param, SystemDesktop, Host, $filter, $modalInstance) {
	$scope.data = {
		id: param.id,
		memory_mb: param.memory_mb / 1024,
		cpu_num: param.vcpu,
		hostname: param.hostname
	};
	$scope.host_loading = true;

	$scope.get_devices = function (hostname) {
		SystemDesktop.get_devices({ host: hostname }, function (res) {
			$scope.host_loading = false;
			$scope.devices = res.result.filter(function (item) {
				return item.status === "available";
			});
		});
	};
	$scope.get_devices($scope.data.hostname);
	$scope.selectAllHost = function (bool) {
		$scope.devices.map(function (item) {
			item._selected = bool;
			return item;
		});
	};
	$scope.selectOneHost = function () {
		$scope.data.is_all = $scope.devices.every(function (item) {
			return item._selected === true;
		});
	};
	$scope.ok = function () {
		var devices = $filter("selectedFilter")($scope.devices);
		var node = $scope.data.is_cancel ? -1 : devices.map(function (item) {
			return item.compute_node_id;
		});
		var addr = $scope.data.is_cancel ? -1 : devices.map(function (item) {
			return item.address;
		});
		var postData = {
			id: $scope.data.id,
			is_auto_up: $scope.data.is_on,
			pci_devices_node: node,
			pci_devices_address: addr,
			cpu: $scope.data.cpu_num,
			ram: $scope.data.memory_mb
		};
		$scope.loading = true;
		SystemDesktop.config_instances(postData, function (res) {
			$modalInstance.close();
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('systemDesktopAddDialog', ['$scope', 'Host', '$filter', 'SystemDesktop', '$modalInstance', '$routeParams', function ($scope, Host, $filter, SystemDesktop, $modalInstance, $routeParams) {

	$scope.data = {};
	$scope.host_loading = true;
	Host.query({ type: 'kvm' }, function (res) {
		$scope.hosts = res.hosts_list.filter(function (host) {
			return host.status == 'active';
		});
	}).$promise.finally(function () {
		$scope.host_loading = false;
	});
	$scope.selectAllHost = function (bool) {
		$scope.hosts.map(function (item) {
			item._selected = bool;
			return item;
		});
	};
	$scope.selectOneHost = function () {
		$scope.data.is_all = $scope.hosts.every(function (item) {
			return item._selected === true;
		});
	};
	$scope.ok = function () {
		var _id = $routeParams.id ? $routeParams.id : $scope.creat_item.id;
		var postData = {
			id: _id,
			name: $scope.data.name,
			host_ids: $filter("selectedFilter")($scope.hosts).map(function (item) {
				return item.id;
			}),
			cpu: $scope.data.cpu_num,
			ram: $scope.data.memory_mb
		};
		$scope.loading = true;
		SystemDesktop.add_instances(postData, function (res) {
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('systemTemplateConfigDialog', ['$scope', '$modalInstance', 'param', 'SystemDesktop', '$filter', 'TeachTemplate', "Network", "$$$I18N", function ($scope, $modalInstance, param, SystemDesktop, $filter, TeachTemplate, Network, $$$I18N) {
	var me = this;
	$scope.min_namelength = 2;
	$scope.max_namelength = 20;
	$scope.data = {
		instance_id: param.instance_id,
		id: param.id,
		cpu_num: 1,
		memory_mb: 1
	};
	$scope.host_loading = true;

	$scope.multifyNetsTips = $$$I18N.get('multifyNetsTips');

	TeachTemplate.infor({ image_id: $scope.data.id }, function (res) {
		$scope.data.cpu_num = res.vcpus;
		$scope.data.memory_mb = res.ram / 1024;
		$scope.data.display_name = res.name;
		$scope.data.type = res.type_code;
		$scope.data.host = res.host;
		$scope.data.start_on_host_boot = res.start_on_host_boot;
		$scope.get_devices($scope.data.host);
		res.nets.forEach(function (net) {
			getNetwork(net, new Date());
		});
	});

	$scope.nets = [];
	$scope.IPmodes1 = [{ name: $$$I18N.get('不分配'), value: 0 }];
	$scope.IPmodes2 = [{ name: $$$I18N.get('系统分配'), value: 1 }, { name: $$$I18N.get('固定IP'), value: 2 }];
	function getNetwork(net, key) {
		$scope.network_loading = true;
		Network.query(function (data) {
			if (data.networks.length) {
				var _network = net ? data.networks.filter(function (n) {
					return n.id == net.network_id;
				})[0] : data.networks[0];
				$scope.nets.push({ key: key, networks: data.networks, network: _network });
				$scope.get_subnet(net, _network, key);
			}
		});
	}

	$scope.get_subnet = function (net, network, key) {
		if (network.subnets.length) {
			Network.query_sub({
				id: network.id
			}, function (res) {
				var subnetworks = [];
				subnetworks = res.result.map(function (n) {
					n._desc = n.start_ip ? n.name + " (" + n.start_ip + " - " + n.end_ip + ") " : n.name;
					return n;
				});
				$scope.nets.forEach(function (item) {
					if (item.key === key) {
						item.subnetworks = subnetworks;
						var _subnetwork;
						if (net) {
							_subnetwork = net.subnet_id ? subnetworks.filter(function (n) {
								return n.id == net.subnet_id;
							})[0] : null;
						} else {
							_subnetwork = subnetworks[0];
						};
						item.subnetwork = _subnetwork;
						$scope.clearBindIp(net, key);
					}
				});
				$scope.network_loading = false;
			});
		} else {
			$scope.network_loading = false;
			$scope.nets.forEach(function (item) {
				if (item.key === key) {
					item.subnetworks = [];
					item.subnetwork = null;
					$scope.clearBindIp(net, key);
				}
			});
		}
	};
	$scope.clearBindIp = function (net, key) {
		$scope.nets.forEach(function (item) {
			if (item.key === key) {
				if (item.subnetwork) {
					item.IPmodes = $scope.IPmodes2;
					if (net.ip_address) {
						item.IPmode = item.IPmodes[1];
					} else {
						item.IPmode = item.IPmodes[0];
					}
				} else {
					item.IPmodes = $scope.IPmodes1;
					item.IPmode = item.IPmodes[0];
				}

				item.ip = net.ip_address;
			}
		});
	};

	$scope.addNet = function () {
		getNetwork(false, new Date());
	};
	$scope.minusNet = function (i) {
		var idx = $scope.nets.indexOf(i);
		$scope.nets.splice(idx, 1);
	};
	$scope.get_devices = function (hostname) {
		SystemDesktop.get_devices({ host: hostname }, function (res) {
			$scope.host_loading = false;
			$scope.devices = res.result.filter(function (item) {
				return item.status === "available";
			});
		});
	};
	$scope.selectAllHost = function (bool) {
		$scope.devices.map(function (item) {
			item._selected = bool;
			return item;
		});
	};
	$scope.selectOneHost = function () {
		$scope.data.is_all = $scope.devices.every(function (item) {
			return item._selected === true;
		});
	};

	// 判断网络数组中两两是否有两个相同的子网id
	function giveTip(array) {
		var flag = false;
		array.forEach(function (item, index) {
			for (var i = index + 1; i < array.length; i++) {
				console.log(array[index], array[i]);
				if (array[index]['subnetwork']['id'] == array[i]['subnetwork']['id']) {
					flag = true;
				}
			}
		});
		return flag;
	}

	$scope.ok = function () {
		var me = this,
		    alertTip = giveTip(me.nets);
		var devices = $filter("selectedFilter")($scope.devices);
		var node = $scope.data.is_cancel ? -1 : devices.map(function (item) {
			return item.compute_node_id;
		});
		var addr = $scope.data.is_cancel ? -1 : devices.map(function (item) {
			return item.address;
		});
		var postData = {
			image_id: $scope.data.id,
			instance_id: $scope.data.instance_id,
			display_name: $scope.data.display_name,
			type_code: this.data.type,
			network: this.nets.map(function (item) {
				if (!item.network.id) return "";else return item.network.id;
			}),
			subnet: this.nets.map(function (item) {
				if (!item.subnetwork) return "";else return item.subnetwork.id;
			}),
			band_ip: this.nets.map(function (item) {
				if (!item.ip) return "";else return item.ip;
			}),
			pci_devices_node: node,
			pci_devices_address: addr,
			vcpus: $scope.data.cpu_num,
			ram: $scope.data.memory_mb,
			start_on_host_boot: $scope.data.start_on_host_boot
		};
		if (alertTip) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("不同网卡上不能存在相同网段的IP"),
				timeout: 6000
			});
			return false;
		}
		$scope.loading = true;
		SystemDesktop.edit(postData, function (res) {
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('systemBackupConfigController', ['$scope', '$modalInstance', 'SystemBackup', function ($scope, $modalInstance, SystemBackup) {
	$scope.data = {};
	SystemBackup.get_config(function (res) {
		$scope.data = res.result;
		var initTime = new Date();
		$scope.data.backup_weekday = $scope.data.backup_weekday || "";
		$scope.data.backup_time = $scope.data.backup_time || initTime;
	});
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.ok = function () {
		$scope.submiting = true;
		SystemBackup.alter_config($scope.data, function () {
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.submiting = false;
		});
	};
}]).controller("vdiSystemOutsideController", ["$scope", "$modal", "$$$I18N", "Outside", 'AlarmPlicy', function ($scope, $modal, $$$I18N, Outside, AlarmPlicy) {
	$scope.enable_loading = false;
	$scope.save_loading = false;
	$scope.ips_loading = true;

	Outside.query(function (res) {
		// var res = {
		// 	enable: true,
		// 	proxy_ip: "10.1.41.188",
		// 	computer_ips: ["10.1.41.17"]
		// };
		// var res = {
		// 	enable: false,
		// 	proxy_ip: "",
		// 	computer_ips: []
		// };
		$scope.enable = res.enable;
		$scope.IP = res.proxy_ip;
		$scope.hasIP = res.proxy_ip == '' ? false : true;
		$scope.computer_ips = res.computer_ips;

		AlarmPlicy.get_hosts(function (result) {
			$scope.ips_loading = false;
			// var consoleIP = result.result.filter(function(r){ return r.type=="control"; })[0].hosts[0].ip;
			// result.result.forEach(function(item){
			// 	item.hosts = item.hosts.filter(function(i){ return i.ip!==consoleIP })
			// });
			$scope.pools = result.result.filter(function (r) {
				return r.hosts.length && r.type !== "control";
			});
		});
	});

	$scope.start = function () {
		if (!$scope.enable) {
			$scope.enable_loading = true;
			Outside.stop(function (res) {
				$scope.enable_loading = false;
				$scope.IP = null;
				$scope.computer_ips = [];
			}, function (error) {
				$scope.enable_loading = false;
				$scope.enable = !$scope.enable;
			});
		}
	};
	$scope.save = function () {
		var computer_ips = [];
		if (!$scope.hasIP) {
			$scope.pools.forEach(function (item) {
				item.hosts.forEach(function (host) {
					computer_ips.push(host.ip);
				});
			});
		} else {
			$scope.pools.forEach(function (item) {
				item.hosts.forEach(function (host) {
					var is_selected = $scope.computer_ips.filter(function (i) {
						return i === host.ip;
					}).length;
					if (is_selected) {
						computer_ips.push(host.ip);
					}
				});
			});
		}
		if (computer_ips.length) {
			$scope.save_loading = true;
			Outside.save({
				proxy_ip: $scope.IP,
				computer_ips: computer_ips
			}, function (res) {
				$scope.hasIP = true;
				$scope.save_loading = false;
				$scope.computer_ips = computer_ips;
			}, function (error) {
				$scope.save_loading = false;
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("NO_OUSIDEIP"),
				timeout: 6000
			});
		}
	};
}]).controller('outsideAdvancedDialog', ['$scope', '$modalInstance', 'AlarmPlicy', "Outside", function ($scope, $modalInstance, AlarmPlicy, Outside) {
	$scope.ips_loading = true;
	$scope.isSubmiting = false;
	AlarmPlicy.get_hosts(function (result) {
		$scope.ips_loading = false;

		// var consoleIP = result.result.filter(function(r){ return r.type=="control"; })[0].hosts[0].ip;
		// result.result.forEach(function(item){
		// 	item.hosts = item.hosts.filter(function(i){ return i.ip!==consoleIP })
		// });
		var pools = result.result.filter(function (r) {
			return r.hosts.length && r.type !== "control";
		});
		$scope.pools.splice(0);
		Array.prototype.push.apply($scope.pools, pools);

		if (!$scope.hasIP) {
			$scope.pools.forEach(function (item) {
				item.hosts.forEach(function (host) {
					host._selected = true;
				});
			});
		} else {
			$scope.pools.forEach(function (item) {
				item.hosts.forEach(function (host) {
					var is_selected = $scope.computer_ips.filter(function (i) {
						return i === host.ip;
					}).length;
					if (is_selected) {
						host._selected = true;
					}
				});
			});
		}
		$scope.pools.forEach(function (item) {
			var selected_length = item.hosts.filter(function (host) {
				return host._selected;
			}).length;
			if (selected_length == item.hosts.length) {
				item._selected = true;
			}
		});
	});

	$scope.checkOne = function (pool) {
		pool._selected = pool.hosts.every(function (h) {
			return h._selected;
		});
	};
	$scope.checkAll = function (pool) {
		pool.hosts.forEach(function (h) {
			h._selected = pool._selected;
		});
	};
	$scope.checked = function () {
		var computer_ips = [];
		$scope.pools && $scope.pools.forEach(function (item) {
			item.hosts.forEach(function (host) {
				if (host._selected) {
					computer_ips.push(host.ip);
				}
			});
		});
		return computer_ips.length ? true : false;
	};
	$scope.ok = function () {
		var computer_ips = [];
		$scope.pools.forEach(function (item) {
			item.hosts.forEach(function (host) {
				if (host._selected) {
					computer_ips.push(host.ip);
				}
			});
		});
		$scope.isSubmiting = true;
		Outside.save({
			proxy_ip: $scope.IP,
			computer_ips: computer_ips
		}, function (res) {
			$scope.hasIP = true;
			$scope.computer_ips.splice(0);
			Array.prototype.push.apply($scope.computer_ips, computer_ips);
			$modalInstance.close();
			$scope.isSubmiting = false;
		}, function (error) {});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller("systemUploadIsoDialog", ['$scope', '$modalInstance', 'param', '$rootScope', function ($scope, $modalInstance, param, $rootScope) {
	$scope.id = param.upload_id;
	$scope.finishUpload = function () {
		$rootScope.$broadcast("finishISOUpload");
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}])
/**
 * [description vdiSystemRecycleController 系统资源回收控制器]
 */
.controller('vdiSystemRecycleController', ['$scope', '$modal', '$location', '$route', 'RecycleTech', 'RecyclePer', function ($scope, $modal, $location, $route, RecycleTech, RecyclePer) {
	var RecycleCtrl = this;
	RecycleCtrl.data = {}, RecycleCtrl.submit = {};

	RecycleCtrl.setTechDefault = function (val) {
		RecycleCtrl.tecSave(true);
	};
	RecycleCtrl.getTech = function () {
		RecycleCtrl.techLoading = true;
		RecycleTech.query(function (res) {
			RecycleCtrl.data.tecOpen = res.value.active;
			RecycleCtrl.data.tecDesk = res.value.broken_min;
			RecycleCtrl.data.tecStatus = res.value.run;
			RecycleCtrl.techLoading = false;
		}, function () {
			RecycleCtrl.techLoading = false;
		});
	};
	RecycleCtrl.getTech();
	RecycleCtrl.tecSave = function (onlyEnable) {
		//提交请求
		if (onlyEnable) {
			RecycleCtrl.techenabling = true;
			RecycleTech.save({ value: { active: RecycleCtrl.data.tecOpen } }, function (res) {
				RecycleCtrl.techenabling = false;
				RecycleCtrl.getTech();
				if (!RecycleCtrl.data.tecOpen) {
					RecycleCtrl.techEdit = false;
				}
			}, function () {
				RecycleCtrl.techenabling = false;
			});
		} else {
			RecycleCtrl.data.tecDesk = Number(RecycleCtrl.data.tecDesk);
			var params = {
				active: RecycleCtrl.data.tecOpen,
				broken_min: RecycleCtrl.data.tecDesk,
				run: RecycleCtrl.data.tecStatus
			};
			RecycleCtrl.techSave = true;
			RecycleTech.save({ value: params }, function (res) {
				RecycleCtrl.techSave = false;
				RecycleCtrl.techEdit = false;
			}, function () {
				RecycleCtrl.techSave = false;
			});
		}
	};

	RecycleCtrl.setPerDefault = function (val) {
		RecycleCtrl.perSave(true);
	};
	RecycleCtrl.getPerson = function () {
		RecycleCtrl.personLoading = true;
		RecyclePer.query(function (res) {
			RecycleCtrl.submit.perOpen = res.value.active;
			RecycleCtrl.submit.perDesk = res.value.broken_min / 60;
			RecycleCtrl.submit.perStatus = res.value.run;
			RecycleCtrl.personLoading = false;
		}, function () {
			RecycleCtrl.personLoading = false;
		});
	};
	RecycleCtrl.getPerson();
	RecycleCtrl.perSave = function (onlyEnable) {
		//提交请求
		if (onlyEnable) {
			RecycleCtrl.perenabling = true;
			RecyclePer.save({ value: { active: RecycleCtrl.submit.perOpen } }, function (res) {
				RecycleCtrl.perenabling = false;
				RecycleCtrl.getPerson();
				if (!RecycleCtrl.submit.perOpen) {
					RecycleCtrl.personEdit = false;
				}
			}, function () {
				RecycleCtrl.perenabling = false;
			});
		} else {
			RecycleCtrl.submit.perDesk = Number(RecycleCtrl.submit.perDesk);
			var params = {
				active: RecycleCtrl.submit.perOpen,
				broken_min: RecycleCtrl.submit.perOpen ? RecycleCtrl.submit.perDesk * 60 : undefined,
				run: RecycleCtrl.submit.perOpen ? RecycleCtrl.submit.perStatus : undefined
			};
			RecycleCtrl.personSave = true;
			RecyclePer.save({ value: params }, function (res) {
				RecycleCtrl.personSave = false;
				RecycleCtrl.personEdit = false;
			}, function () {
				RecycleCtrl.personSave = false;
			});
		}
	};
}])

/**
 * [description vdiSystemtimeSyncController 系统时间同步控制器]
 */
.controller('vdiSystemtimeSyncController', ['$scope', '$modal', '$route', 'SystemTime', '$$$I18N', 'formDate', function ($scope, $modal, $route, SystemTime, $$$I18N, formDate) {
	var SyncCtrl = this;
	// var oldSyncServer;
	SystemTime.getInternetSync(function (res) {
		SyncCtrl.internetSync = res.enable;
	}, function () {});

	SyncCtrl.setInternetSync = function (value) {
		SyncCtrl.loading_internet = true;
		SystemTime.internetSync({ enable: value }, function () {
			SyncCtrl.loading_internet = false;
		}, function () {
			SyncCtrl.loading_internet = false;
		});
		if (value) {
			SyncCtrl.updateSyncServer();
		}
	};

	SystemTime.querySyncServer(function (res) {
		SyncCtrl.servers = res.result;
		SyncCtrl.server = res.used !== '' ? res.used : res.result[0];
		// 保持对旧 server 引用
		// oldSyncServer = res.used;
	}, function () {});

	// SyncCtrl.isSyncServerChanged = function(){
	// 	// 不允许选择空值
	// 	if(!this.server) { return false; }
	// 	// 判断变化
	// 	if(oldSyncServer) {
	// 		return oldSyncServer !== this.server;
	// 	}
	// };

	SyncCtrl.updateSyncServer = function () {
		SyncCtrl.loading_updateServer = true;
		SystemTime.updateSyncServer({ time_server: SyncCtrl.server }, function (res) {
			// oldSyncServer = SyncCtrl.server;
			SyncCtrl.loading_updateServer = false;
			SyncCtrl.loadZone();
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("同步时间成功"),
				timeout: 6000
			});
		}, function () {
			SyncCtrl.loading_updateServer = false;
			SyncCtrl.loadZone();
		});
	};

	// 时区
	SyncCtrl.startDateOptions = {
		formatYear: 'yyyy-MM-dd',
		startingDay: 1
	};
	SyncCtrl.openStartDate = function ($event) {
		$event.preventDefault();
		$event.stopPropagation();
		SyncCtrl.startDateOpened = true;
	};
	$scope.$on('matchInput', function (e, v) {
		$scope.matchInput = v;
	});
	var timeID;
	function updateTime(time) {
		var new_time = time;
		var timeArray = formDate.format(new Date(time), "hh:mm:ss").split(':');
		if (SyncCtrl.loopTime) {
			SyncCtrl.hours = timeArray[0];
			SyncCtrl.minutes = timeArray[1];
			SyncCtrl.seconds = timeArray[2];
			new_time = time + 1000;
			timeID = setTimeout(function () {
				updateTime(new_time);
			}, 1000);
		} else {
			clearTimeout(timeID);
		}
	};

	SyncCtrl.loadZone = function () {
		clearTimeout(timeID);
		SyncCtrl.loading_zone = true;
		SystemTime.queryZone(function (res) {
			SyncCtrl.choose_time = res.date;
			SyncCtrl.loopTime = true;
			updateTime(res.timestamp);
			SyncCtrl.zones = res.timezones.map(function (item) {
				item.value = $$$I18N.get(item.zones[0]);
				return item;
			});
			SyncCtrl.zone = SyncCtrl.zones.filter(function (item) {
				return item.offset == res.zone;
			})[0];
			SyncCtrl.loading_zone = false;
		}, function () {
			SyncCtrl.loading_zone = false;
		});
	};
	SyncCtrl.loadZone();
	SyncCtrl.updateZone = function () {
		SyncCtrl.updating_zone = true;
		// 格式化时间，0-9时前面加0
		if (SyncCtrl.hours.length == 1 && Number(SyncCtrl.hours) >= 0 && Number(SyncCtrl.hours) <= 9) {
			SyncCtrl.hours = "0" + SyncCtrl.hours;
		}
		if (SyncCtrl.minutes.length == 1 && Number(SyncCtrl.minutes) >= 0 && Number(SyncCtrl.minutes) <= 9) {
			SyncCtrl.minutes = "0" + SyncCtrl.minutes;
		}
		if (SyncCtrl.seconds.length == 1 && Number(SyncCtrl.seconds) >= 0 && Number(SyncCtrl.seconds) <= 9) {
			SyncCtrl.seconds = "0" + SyncCtrl.seconds;
		}
		var time = formDate.format(new Date(SyncCtrl.choose_time), "yyyy-MM-dd");
		SystemTime.updateZone({
			"date": time,
			"time": SyncCtrl.hours + ':' + SyncCtrl.minutes + ":" + SyncCtrl.seconds,
			"zone": SyncCtrl.zone.offset
		}, function (res) {
			SyncCtrl.updating_zone = false;
			SyncCtrl.modifyTime = false;
			SyncCtrl.loadZone();
		}, function () {
			SyncCtrl.updating_zone = false;SyncCtrl.modifyTime = false;SyncCtrl.loadZone();
		});
	};
}]).controller('vdiSystemSetController', ['$scope', '$modal', function ($scope, $modal) {}])
// 快速部署
.directive('htmlpopover', ['$tooltip', function ($tooltip) {
	return $tooltip('htmlpopover', 'htmlpopover', 'mouseenter');
}]).directive('htmlpopoverPopup', function () {
	return {
		restrict: 'EA',
		replace: true,
		scope: { title: '@', content: '@', placement: '@', animation: '&', isOpen: '&' },
		template: "<div class=\"popover {{placement}}\" ng-class=\"{ in: isOpen(), fade: animation() }\">\n" + "  <div class=\"arrow\"></div>\n" + "\n" + "  <div class=\"popover-inner\">\n" + "      <h3 class=\"popover-title\" ng-bind=\"title\" ng-show=\"title\"></h3>\n" + "      <div class=\"popover-content\" bind-html-unsafe=\"content\"></div>\n" + "  </div>\n" + "</div>"
	};
}).filter("filename", function () {
	return function (text) {
		if (!text) {
			return text;
		}
		var pos = text.lastIndexOf("/");
		if (pos === -1) {
			pos = text.lastIndexOf("\\");
		}
		if (pos > -1) {
			return text.substring(pos + 1);
		} else {
			return text;
		}
	};
}).filter("filesize", function () {
	return function (num) {
		var units = ['B', 'KB', 'MB', 'GB', 'TB'];
		var index = 0;
		num = num || 0;
		while (num > 1024) {
			num = num / 1024;
			index++;
		}
		return num.toFixed(2) + units[index];
	};
}).service('quickMaskModel', ["$$$I18N", "$location", "$compile", "$rootScope", "$controller", function ($$$I18N, $location, $compile, $rootScope, $controller) {
	this.open = function () {
		var $body = $(document.body);
		$body.css('overflow', 'hidden');
		var modalRootElement = angular.element("" + "<div id='quickMaskModel'>" + "  <div class='content'>" + "    <p localize='quickstartTip'></p>" + "    <footer class='text-right'>" + "      <a ng-click='ok()' class='btn btn-md btn-primary deploy'><i class='fa-arrow-right fa'></i> <span localize='快速部署'></span></a>" + "      <a ng-click='close()' class='btn btn-md btn-default nodeploy'><span localize='暂不部署'></span></a>" + "    </footer>" + "  </div>" + "  <span class='jiantou'></span>" + "</div>");
		modalRootElement.appendTo($body);
		var modalScope = $rootScope.$new();
		$compile(modalRootElement)(modalScope);
		$controller("quickstartController", { $scope: modalScope, $element: modalRootElement });
		modalScope.$on("$destroy", function () {
			$body.css('overflow', 'auto');
		});
	};
}]).controller('vdiSystemDeployController', ['$scope', '$interval', '$q', '$location', '$modal', '$$$os_types', '$filter', 'localize', 'TeachTemplate', 'SystemDeploy', 'quickMaskModel', function ($scope, $interval, $q, $location, $modal, $$$os_types, $filter, localize, TeachTemplate, init, quickMaskModel) {
	$scope.currentIndex = 0;
	$scope.unknowStep = true;
	$scope.showMask = false;
	$scope.firstDeployTips = true;
	$scope.hideStep = false;
	//系统模块快速部署的界面展现
	init.quick_deploy_page(function (res) {
		if (res.result.ha_mode === "active_passive" && res.result.storage_type === "local" && res.result.ha_triggered) {
			$scope.showMask = true;
			$scope.firstDeployTips = false;
		}
		$scope.hideStep = true;
	});
	// 设置当前步骤
	init.quickstart(function (res) {
		var step = parseInt(res.step);
		if (step && step > 1) {
			$scope.$broadcast("currentStepChange", step - 1);
			$scope.$broadcast("browser refresh", step - 1, res);
		} else {
			$scope.unknowStep = false;
		}
	});

	$scope.knowStep = function () {
		$scope.unknowStep = false;
	};
	$scope.setStep = function (i) {
		$scope.$broadcast("currentStepChange", i);
	};

	$scope.$on("WizardStep_0", function (e, step, scope) {
		var formScope = scope.$$childHead;
		step.done = formScope.imgForm.$valid && !!formScope.selectedSysImage;
		if (!step.done) {
			return;
		}
		$scope.$broadcast("deploy:set", "system-image", formScope.selectedSysImage.filename);
	});

	$scope.$on("WizardStep_1", function (e, step, scope) {
		var formScope = scope.$$childHead;
		step.done = formScope.registerForm.$valid && !formScope.network_loading;
		if (!step.done) {
			angular.forEach(formScope.registerForm.$error, function (arr) {
				arr && arr.forEach(function (ctrl) {
					ctrl.$setViewValue("");
				});
			});
			return;
		}
		var wizardScope = e.targetScope;
		step.done = false;
		step.showLoading = true;
		formScope.ok(function (res) {
			step.showLoading = false;
			if (res === null) {
				return;
			}
			formScope.showTemplateBlock(res);
		});
	});

	$scope.$on("WizardStep_2", function (e, step, scope) {
		var formScope = scope.$$childHead;
		step.done = formScope.createForm.$valid;
		if (!step.done) {
			angular.forEach(formScope.createForm.$error, function (arr) {
				arr.forEach(function (ctrl) {
					ctrl.$setViewValue("");
				});
			});
			return;
		}
		var data = formScope.getValues();
		init.create_scene(data, function (res) {
			$$$storage.setSessionStorage('scene_page_classroom', '');
			$location.url("/desktop/scene");
		});
	});

	var countArr = [0, 0, 0];
	$scope.$on("selectStepChange", function (e, arg) {
		var index = arg.index;
		$scope.currentIndex = index;
		countArr[index]++;
		if (countArr[index] > 1) {
			$scope.$broadcast("deploy:step" + index + ".refresh");
		}
	});
}])
// 第一步：导入模板镜像
.controller('importImageStepController', ['$scope', '$modal', 'SystemDeploy', '$timeout', function ($scope, $modal, init, $timeout) {
	// = 导入模板镜像 =
	// 扫描后产生的镜像列表
	$scope.imglist = [];
	// 选中的镜像
	var autoSelect = true;
	$scope.selectedSysImage;

	$scope.listSystemImages = function () {
		init.list_system_images(function (res) {
			var imgmap = {};
			angular.forEach($scope.imglist, function (img) {
				imgmap[img.name] = img;
			});
			angular.forEach(res.system_image, function (img) {
				if (img.name in imgmap) {
					angular.extend(imgmap[img.name], img);
				} else {
					img.filename = img.name;
					$scope.imglist.push(img);
				}
			});
			if (autoSelect) {
				$scope.selectedSysImage = $scope.imglist[0];
			}
		}).$promise.finally(function () {
			$scope.loading = false;
		});
		$scope.loading = true;
	};

	$scope.selectSysImage = function (img) {
		$scope.selectedSysImage = img;
		$scope.autoSelect = false;
	};

	$scope.importByServer = function () {
		$modal.open({
			templateUrl: "/views/vdi/dialog/system/system_deploy_import_by_server.html",
			controller: "importByServerController as ctrl"
		}).result.then(function (imgs) {
			imgs.length > 0 && $scope.listSystemImages();
		});
	};

	$scope.listSystemImages();

	$scope.$on("finishUpload", function (e, suc, filename) {
		$scope.listSystemImages();
	});

	$scope.$on("deploy:step0.refresh", function () {
		$scope.listSystemImages();
	});
}])
// 第二步：注册教学模板
.controller('registerTeachTemplateStepController', ['$scope', '$interval', '$modal', 'SystemDeploy', "registerTemplate", "TeachTemplate", "HardwareTemplate", "SystemISO", "Admin", "$$$os_types", "$$$I18N", "UserRole", "Network", "virtualHost", "networkWithHost", "$rootScope", function ($scope, $interval, $modal, init, registerTemplate, TeachTemplate, hardware, iso, admin, $$$os_types, $$$I18N, UserRole, network, virtualHost, networkWithHost, $root) {
	var user = UserRole.currentUser;
	$scope.min_namelength = 2;
	$scope.max_namelength = 20;
	$scope.type = '1';
	$scope.name = "default";
	$scope.types1 = [{ name: $$$I18N.get('不分配'), value: 'none' }];
	$scope.types2 = [{ name: $$$I18N.get('系统分配'), value: 'auto' }, { name: $$$I18N.get('固定IP'), value: 'static' }];
	$scope.types = $scope.types2;
	$scope.bind_ip_type = $scope.types2[0];

	// controller 实例化的时候不应当获取数据，每次 $scope 收到 deploy:set 事件的时候初始化
	function loadData() {
		admin.query(function (res) {
			$scope.users = res.users;
			angular.forEach($scope.users, function (item) {
				if (item.name === user.name) $scope.owner = item;
			});
		});
		registerTemplate.query(function (res) {
			$scope.sys_isos = res.system_image;
			if ($scope.selectIsoName && !selectIsoByName($scope.selectIsoName)) {
				$scope.sys_iso = res.system_image[0];
			}
			$scope.old_data_isos = res.data_image;
			if ($scope.sys_iso) {
				$scope.getDataImgs($scope.sys_iso);
			}
		});
	}

	$scope.filterDataISO = function (data_iso, data_iso2) {
		if (data_iso) {
			$scope.data_isos2 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso.name;
			});
		} else {
			$scope.data_isos2 = $scope.data_isos;
		}
		if (data_iso2) {
			$scope.data_isos1 = $scope.data_isos.filter(function (item) {
				return item.name !== data_iso2.name;
			});
		} else {
			$scope.data_isos1 = $scope.data_isos;
		}
	};
	$scope.getDataImgs = function (systemImg, is_init) {
		if (systemImg) {
			this.data_iso = undefined;
			this.data_iso2 = undefined;
			$scope.data_isos = $scope.data_isos2 = $scope.data_isos1 = $scope.old_data_isos.filter(function (item) {
				return item.virtual_type == systemImg.virtual_type;
			});
			// $scope.data_iso = $scope.data_isos[0];
			// $scope.data_iso2 = $scope.data_isos[0];
			$scope.getVirtualHost(systemImg.virtual_type, systemImg.rbd_enabled);
		}
	};

	var lastType;
	$scope.getVirtualHost = function (type, rbd_enabled) {
		if (type === lastType) {
			return;
		}
		$scope.host_loading = true;
		virtualHost.query({ virtual_type: type, rbd_enabled: rbd_enabled }, function (res) {
			$scope.host_loading = false;
			$scope.hosts = res.result;
			$scope.host = $scope.hosts[0];
			$scope.getNetwork($scope.host);
			lastType = type;
		}, function () {});
	};

	$scope.os_types = $$$os_types.filter(function (item) {
		return item.key !== "package";
	});
	$scope.os_type = $scope.os_types[0];
	// $scope.enable_gpu = false;
	$scope.bind_ip_type = "static";

	$scope.switchIps = function (subnet, _scope) {
		// _scope.bind_ip_loading = true;
		if (subnet) {
			// getIps(subnet.id, _scope);
			_scope.types = _scope.types2;
			_scope.bind_ip_type = _scope.types2[0];
		} else {
			_scope.types = _scope.types1;
			_scope.band_ips = [];
			_scope.bind_ip_type = _scope.types1[0];
			// _scope.bind_ip_loading = false;
		}
	};
	function getSubnets(Network, _scope) {
		if (Network.subnets.length) {
			$scope.network_loading = true;
			$scope.bind_ip_loading = true;
			network.query_sub({ id: Network.id }, function (res) {
				_scope.subnets = res.result;
				_scope.subnet = _scope.subnets[0];
				_scope.switchIps(_scope.subnet, _scope);
				$scope.network_loading = false;
			});
		} else {
			_scope.subnets = [];
			_scope.subnet = null;
			_scope.switchIps(_scope.subnet, _scope);
		}
	};
	$scope.getNetwork = function (host) {
		if (host) {
			networkWithHost.query({ host: host.host_uuid }, function (res) {
				// $scope.networks = res.result.filter(function(item){ return item.subnets.length!==0 });
				$scope.networks = res.result;
				$scope.network = $scope.networks[0];
				getSubnets($scope.network, $scope);
			}, function () {});
		}
	};
	$scope.switchSubnet = function (val, _scope) {
		getSubnets(val, _scope);
	};

	$scope.ok = function (callback) {
		// if(this.bind_ip_type.value === 'static' && this.bind_ip === '无可用IP'){
		// 	$.bigBox({
		// 		title	: $$$I18N.get("INFOR_TIP"),
		// 		content	: $$$I18N.get("hasStaticIP_TIP"),
		// 		timeout	: 6000
		// 	});
		// } else{
		$scope.submiting = true;
		$scope.afterSubmiting = false;
		var _ip = this.bind_ip_type.value === 'static' ? this.bind_ip.value : undefined;
		var host_uuid = this.host.host_uuid;
		var postData = {
			system_image_file: this.sys_iso,
			name: this.name,
			os: this.os_type.key,
			owner: this.owner.id,
			network: this.network.id,
			subnet: this.subnet ? this.subnet.id : "",
			band_ip: _ip,
			band_type: this.bind_ip_type.value,
			host_uuid: host_uuid
		};
		init.register_template(postData, function (res) {
			$scope.submiting = false;
			$scope.afterSubmiting = true;
			callback({
				image_id: res.image_id,
				servers: [{ uuid: host_uuid }]
			});
		}, function () {
			callback(null);
			$scope.submiting = false;
			$scope.afterSubmiting = false;
		});
		// }
	};

	$scope.$on("deploy:set", function (e, name, value) {
		if (name === "system-image") {
			$scope.selectIsoName = value;
			loadData();
			// if(selectIsoByName(value)) {
			// 	$scope.getVirtualHost($scope.sys_iso.virtual_type, $scope.sys_iso.rbd_enabled);
			// }
		}
	});

	function selectIsoByName(name) {
		var iso = $scope.sys_iso;
		var hit = false;
		if (iso && iso.name === name) {
			return true;
		}
		angular.forEach($scope.sys_isos, function (iso) {
			if (iso.name === name) {
				this.sys_iso = iso;
				hit = true;
			}
		}, $scope);
		return hit;
	}

	$scope.showTemplateBlock = function (data, browserRefresh) {
		// 切换视图
		$scope.registerFormLoading = true;
		$scope.loadingTeachTemplates = true;
		TeachTemplate.query({ ids: [data.image_id] }, function (res) {
			var teachTemplates = res.win_images.concat(res.linux_images).concat(res.other_images);

			teachTemplates.forEach(function (row) {
				var os = $$$os_types.filter(function (item) {
					return item.key === row.os_type;
				})[0];
				os && os.icon && (row.icon = os.icon);
				if (row.os_type.indexOf("_64") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("_64"));
				if (row.os_type.indexOf("(64 bit)") > -1) row.os_type = row.os_type.slice(0, row.os_type.indexOf("(64 bit)"));
			});
			teachTemplates.sort(function (a, b) {
				return a.created_at > b.created_at ? -1 : 1;
			});

			$scope.teachTemplates = teachTemplates;
			if (testTempateCreateDone(teachTemplates)) {
				data.xp = isXP(teachTemplates[0]);
				onCreateTemplateDone(data, browserRefresh);
			} else {
				if (browserRefresh) {
					$scope.$eval("knowStep()");
				}
				loopTemplateStatus(data).then(function (v) {
					data.xp = v;
					onCreateTemplateDone(data, browserRefresh);
				}).catch(function (err) {
					$.bigBox({
						title: $$$I18N.get("INFOR_TIP"),
						color: "#C46A69",
						content: err,
						timeout: 6000
					});
				});
			}
		}).$promise.finally(function () {
			$scope.loadingTeachTemplates = false;
		});
	};

	$scope.delete = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除教学模板'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_TEMPLATE_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: ["$scope", "$modalInstance", function (modalScope, $modalInstance) {
				var template = TeachTemplate;
				var rows = [item];
				modalScope.name = rows.map(function (row) {
					return row.name;
				}).join(', ');
				modalScope.ok = function () {
					template.delete({ id: [item.id] }, function (res) {
						$scope.$eval("setStep(0)");
						$scope.registerFormLoading = false;
					});
					$modalInstance.close();
				};
				modalScope.close = function () {
					$modalInstance.close();
				};
			}],
			size: "sm"
		});
	};

	function loopTemplateStatus(res) {
		var timer = $interval(function () {
			var root = $scope.$root;
			// TODO: 某些情况这里还是会报错
			if (root) {
				root.$broadcast("imageIDS", [res.image_id]);
			} else {
				$interval.cancel(timer);
				timer = null;
			}
		}, 1000);
		return new Promise(function (resolve, reject) {
			var dereg = $scope.$on("imagesRowsUpdate", function (e, data) {
				var templates = $scope.teachTemplates;
				var _rows = {};
				templates.forEach(function (item) {
					_rows[item.id] = item;
				});
				data.forEach(function (item) {
					if (_rows[item.id]) {
						for (var k in item) {
							_rows[item.id][k] = item[k];
						}
					}
				});
				templates = templates.filter(function (item) {
					return item.type_code === 1;
				});
				templates.forEach(function (row) {
					if (row.sync_status) {
						var updateInfor = row.sync_status.filter(function (item) {
							return item.type === "image";
						});
						if (updateInfor.length !== 0) row.updateSize = (updateInfor[0].size / 1024 / 1024 / 1024).toFixed(2);
					}
				});
				$scope.teachTemplates = templates;
				if (testTempateCreateDone(templates)) {
					$interval.cancel(timer);
					dereg();
					timer = null;
					resolve(isXP(templates[0]));
				}
				if (templates[0].status === "register failed") {
					$interval.cancel(timer);
					dereg();
					timer = null;
					reject($$$I18N.get("REGISTER_FAILED"));
				}
			});
		});
		$scope.$on("$destroy", function () {
			timer && $interval.cancel(timer);
		});
	};

	function testTempateCreateDone(templates) {
		return templates && templates.length > 0 && templates[0].status === "alive";
	}

	function onCreateTemplateDone(res, browserRefresh) {
		var root = $scope.$root;
		root.$broadcast("currentStepChange", 2);
		root.$broadcast("deploy:set", "image_id", res.image_id);
		root.$broadcast("deploy:set", "servers", res.servers);
		root.$broadcast("deploy:set", "isxp", res.xp);
		if (res.max_instance) {
			root.$broadcast("deploy:set", "max_instance", res.max_instance);
		} else {
			// force trigger request `/thor/init/quickstart`
			root.$broadcast("deploy:set", "max_instance", false);
		}

		$scope.registerFormLoading = false;
		if (browserRefresh === true) {
			$scope.$eval("knowStep()");
		}
	}

	function isXP(template) {
		var ostype = template.os_type || "";
		return (/^Windows\s*XP/.test(ostype)
		);
	}
	// 快速部署过程中浏览器重新刷新，自动进入轮训
	$scope.$on("browser refresh", function (e, step, res) {
		if (step !== 1) {
			return;
		}
		// 显示模板
		$scope.showTemplateBlock(res, true);
	});
}])
// 第三步：创建教学场景
.controller('createTeachSceneController', ['$scope', '$modal', 'SystemDeploy', "TeachTemplate", "SchoolRoom", "HardwareTemplate", "SystemISO", "Admin", "$$$os_types", "$$$I18N", "UserRole", "Network", "virtualHost", "networkWithHost", "$rootScope", "$q", function ($scope, $modal, init, teach, SchoolRoom, hardware, iso, admin, $$$os_types, $$$I18N, UserRole, network, virtualHost, networkWithHost, $root, $q) {
	$scope.min_namelength = 2;
	$scope.max_namelength = 20;

	var data = $scope.data = {
		name: "default",
		cpu_num: 2,
		memory_mb: 2,
		system_gb: 20,
		kwargs: {
			data_rollback: 1,
			hostname_beginwith: 1,
			hostname_prefix: "PC",
			hostname_type: 1,
			is_exam: false,
			rollback: 1,
			usb_redir: true
		}
	};

	$scope.btndisks = [];
	$scope.master = {};

	SchoolRoom.querywithSimple(function (res) {
		$scope.classrooms = res.pools_.concat([{
			id: -1,
			name: $$$I18N.get("新增自定义教室")
		}]);
		$scope.classroom = $scope.classrooms[0];
	});

	hardware.query(function (res) {
		$scope.hardwareList = res.result.concat([{
			id: -1,
			name: $$$I18N.get("新增自定义模板")
		}]);
		$scope.hardware = $scope.hardwareList[0];
	});

	network.query(function (data) {
		$scope.networks = data.networks.filter(function (item) {
			return item.subnets.length !== 0;
		});
		$scope.data.network = $scope.networks[0];
		getSubnets($scope.data.network);
	});

	$scope.addbtndisk = function () {
		$scope.btndisks.push({ local_gb: 5 });
	};
	$scope.minusbtndisk = function () {
		// var idx = $scope.btndisks.indexOf(i)
		$scope.btndisks.splice($scope.btndisks.length - 1, 1);
	};

	$scope.switchSubnet = function (val) {
		getSubnets(val);
	};

	function getSubnets(Network) {
		$scope.network_loading = true;
		network.query_sub({ id: Network.id }, function (res) {
			$scope.subnets = res.result;
			$scope.data.subnet = $scope.subnets[0];
			$scope.network_loading = false;
		});
	}

	$scope.getValues = function () {
		var values = angular.extend({
			name: data.name,
			instance_max: data.instance_max,
			servers: data.servers,
			image_id: data.image_id
		}, data.kwargs);
		if ($scope.classroom.id === -1) {
			angular.extend(values, {
				pool_name: data.classroomName,
				desc: data.desc,
				network_id: data.network.id,
				subnet_id: data.subnet.id
			});
		} else {
			values.pool = $scope.classroom.id;
		}
		if ($scope.hardware.id === -1) {
			angular.extend(values, {
				instance_type_name: data.hardwareName,
				cpu_num: data.cpu_num,
				memory_mb: data.memory_mb * 1024,
				system_gb: data.system_gb
			});
			angular.forEach([0, 1], function (i) {
				var disk = $scope.btndisks[i];
				if (i === 0) {
					values.local_gb = disk ? disk.local_gb : 0;
				} else {
					values['local_gb' + i] = disk ? disk.local_gb : 0;
				}
			});
		} else {
			values.instance_type = $scope.hardware.id;
		}
		return values;
	};

	$scope.showAdvanceSceneOptionDialog = function () {
		var _isxp = data.isxp;
		$modal.open({
			templateUrl: "views/vdi/dialog/system/system_deploy_advance_options.html",
			controller: "teachSceneOptionDialog",
			resolve: {
				isxp: function isxp() {
					return _isxp;
				},
				kwargs: function kwargs() {
					return data.kwargs;
				}
			}
		}).result.then(function (options) {
			data.kwargs = options;
		});
	};

	$scope.getMaxInstance = function () {
		init.quickstart(function (res) {
			data.max_instance = res.max_instance;
		});
	};

	$scope.$on("deploy:set", function (e, name, value) {
		data[name] = value;
		if (value === false && name === "max_instance") {
			$scope.getMaxInstance();
		}
	});
}])
// 高级 dialog
.controller("teachSceneOptionDialog", ["$scope", "$modalInstance", "$rootScope", "localize", "isxp", "kwargs", "PersonDesktop", function (scope, modalInstance, rootScope, localize, isxp, kwargs, PersonDesktop) {
	var defaults = {
		usb_redir: true,
		usb_version: isxp ? '2.0' : '3.0',
		rollback: '1',
		rollback_weekday: '1',
		rollback_monthday: '1',
		data_rollback: '1',
		data_rollback_weekday: '1',
		data_rollback_monthday: '1',
		hostname_type: '1',
		hostname_prefix: 'PC',
		hostname_beginwith: 1,
		username_type: '1',
		username_prefix: 'K',
		username_beginwith: 1,
		isxp: isxp,
		enable_share: false
	};
	var data = scope.data = angular.extend(defaults, kwargs || {});
	scope.loading_server = true;
	PersonDesktop.share_servers(function (res) {
		scope.loading_server = false;
		var servers = [];
		res.servers.forEach(function (server) {
			server.nets.forEach(function (net) {
				servers.push({ id: server.id, net: { ip_address: net.ip_address, network_id: net.network_id, subnet_id: net.subnet_id } });
			});
		});
		scope.share_servers = servers;
		scope.data.share_server = scope.share_servers[0];
	});

	scope.USBRedictTips = localize.localizeText("USBRedictTips");
	scope.auto_mountPersonalTips = localize.localizeText("auto_mountPersonalTips");
	data.RDP = kwargs.is_exam;
	if (kwargs.username_prefix) {
		data.MORE = true;
		angular.forEach(["username_prefix", "username_beginwith", "username_type"], function (s) {
			scope[s] = kwargs[s];
		});
	}
	if (kwargs.hostname_prefix) {
		angular.forEach(["hostname_beginwith", "hostname_prefix", "hostname_type"], function (s) {
			scope[s] = kwargs[s];
		});
	}
	angular.forEach({
		rollback_weekday: "2",
		rollback_monthday: "3"
	}, function (v, k) {
		if (kwargs.hasOwnProperty(k)) {
			scope.rollback = v;
			scope[k] = kwargs[k];
		}
	});
	angular.forEach({
		data_rollback_weekday: "2",
		data_rollback_monthday: "3"
	}, function (v, k) {
		if (kwargs.hasOwnProperty(k)) {
			scope.data_rollback = v;
			scope[k] = kwargs[k];
		}
	});
	scope.addZero = function (len, str_begin, str_end) {
		if (str_end && str_begin) {
			var end_len = str_end.toString().length;
			if (end_len < len) {
				return str_begin + new Array(len - end_len + 1).join("0") + str_end;
			} else {
				return str_begin + str_end;
			}
		}
	};

	scope.ok = function () {
		var postData = {};
		// 这里的 this 引用了真正的 scope
		postData.enable_share = data.enable_share, postData.share_server_ip = data.enable_share ? data.share_server.net.ip_address : undefined;
		postData.share_server_id = data.enable_share ? data.share_server.id : undefined;
		postData.usb_redir = data.usb_redir;
		postData.usb_version = data.usb_redir ? data.usb_version : null;
		postData.rollback = data.rollback;
		postData.data_rollback = data.data_rollback;
		if (postData.rollback === "2") {
			postData.rollback_weekday = data.rollback_weekday;
		}
		if (postData.rollback === "3") {
			postData.rollback_monthday = data.rollback_monthday;
		}
		if (postData.data_rollback === "2") {
			postData.data_rollback_weekday = data.data_rollback_weekday;
		}
		if (postData.data_rollback === "3") {
			postData.data_rollback_monthday = data.data_rollback_monthday;
		}

		angular.forEach(["hostname_beginwith", "hostname_prefix", "hostname_type"], function (s) {
			postData[s] = data[s];
		});
		postData.is_exam = !!data.RDP;
		if (data.MORE) {
			angular.forEach(["username_prefix", "username_beginwith", "username_type"], function (s) {
				postData[s] = data[s];
			});
		}
		rootScope.$broadcast("scene-options", postData);
		modalInstance.close(postData);
	};
	scope.close = function () {
		modalInstance.dismiss();
	};
}]).controller("importByServerController", ["$scope", "$timeout", "$modalInstance", "SystemDeploy", function ($scope, $timeout, $modalInstance, init) {
	var importedImgs = [];
	var self = this;
	self.selected = null;
	self.remote_imgs = [];
	self.loading = false;

	self.refreshImgs = function () {
		init.scan_iso(function (res) {
			var imgs = {};
			angular.forEach(self.remote_imgs, function (img) {
				imgs[img.path] = img;
			});
			angular.forEach(res.result, function (img) {
				if (imgs.hasOwnProperty(img.path)) {
					angular.extend(imgs[img.path], img);
				} else {
					self.remote_imgs.push(img);
				}
			});
		}).$promise.finally(function () {
			self.loading = false;
		});
		self.loading = true;
	};

	self.importSelected = function () {
		var img = self.selected;
		if (!img) {
			return;
		}
		init.import_iso({
			upload_type: 'local',
			src_file: [img.path]
		}, function (res) {
			loopImportProgress(angular.copy(img), function () {
				importedImgs.push(img);
				self.is_importing = false;
				img.imported = true;
				delete self.selected;
				self.close();
			}, function () {
				self.is_importing = false;
			});
		}, function () {
			self.is_importing = false;
		});
		self.is_importing = true;
	};

	self.close = function () {
		$modalInstance.close(importedImgs);
	};

	self.isAjaxOn = function () {
		return self.loading || self.is_importing;
	};

	self.showRemain = function () {
		var yes = self.is_importing;
		yes = yes && self.hasOwnProperty("remain");
		if (yes) {
			yes = self.remain.hasOwnProperty("hour");
		}
		return yes;
	};

	self.refreshImgs();

	function loopImportProgress(img, doneCallback, failCallback) {
		var time = self.remain = {};
		img.total = img.size;
		img.startTime = Date.now();
		var hasFeature = !!console.time;
		var label = "[upload " + img.path + "]";
		hasFeature && console.time(label);
		loop();
		function loop() {
			init.import_progress(function (res) {
				var filemap = {};
				angular.forEach(res.result, function (item) {
					if (item.filename === img.filename) {
						angular.extend(img, item);
					}
				});
				// 还没有开始导入，此时不显示数据
				if (img.size === 0) {
					$timeout(loop, 1000);
					return;
				}
				var remainSize = img.total - img.size;
				var speed = img.size / (Date.now() - img.startTime);
				var remainTime = Math.floor(remainSize / speed / 1000);
				time.hour = Math.floor(remainTime / 3600);
				time.minute = Math.floor(remainTime / 60);
				time.second = Math.floor(remainTime % 60);
				if (img.total === img.size) {
					hasFeature && console.timeEnd(label);
					doneCallback();
				} else {
					$timeout(loop, 1000);
				}
			}, failCallback);
		}
	}
}]).controller("quickstartController", ["$scope", "$element", "$location", function ($scope, $element, $location) {
	var menuWidth = 220;
	// 循环计时器
	var updateTimer;
	// 缓存的样式
	var oldContentStyles = {};
	var oldArrowStyles = {};
	// 是否需要手动点击快速部署父菜单的标记
	var opened = false;
	$scope.ok = function () {
		cleanDOM();
		$location.url("/system/deploy");
	};
	$scope.close = function () {
		cleanDOM();
		$location.url("/summary");
	};
	$scope.$on("NOAUTH", cleanDOM);

	updatePosition();

	function updatePosition() {
		var alignTarget = $("li[nav-title='快速部署']");
		if (alignTarget.length === 0) {
			updateTimer = setTimeout(updatePosition, 100);
			return;
		}
		// 高亮 快速部署 菜单项
		alignTarget.addClass("left-menu-item-on");
		// 如果父菜单没有展开，手动展开
		var pmenu = alignTarget.parents("li");
		if (!pmenu.hasClass("open") && !opened) {
			pmenu.children("a")[0].click();
			opened = true;
			setTimeout(function () {
				if (!pmenu.hasClass("opened")) {
					opened = false;
				}
			}, 300);
		}
		var targetOffset = alignTarget.offset();
		var totalWidth = $(window).width();
		var totalHeight = $(window).height();
		var $content = $("#quickMaskModel .content");
		var $arrow = $("#quickMaskModel .jiantou");
		if (!$content || !$arrow) {
			return;
		}
		// 水平垂直居中
		var contentStyles = {
			'margin-left': $content.outerWidth() / -2,
			'margin-top': $content.outerHeight() / -2
		};
		if (!equalsRoughly(contentStyles, oldContentStyles)) {
			$content.css(contentStyles);
			oldContentStyles = contentStyles;
		}
		$arrow[totalWidth < 979 ? 'hide' : 'show']();
		var btn = $content.find(".btn-primary");
		var btnOffset = btn.offset();
		var contentLeft = $content.offset().left;
		var arrowTop = btnOffset.top + btn.outerHeight() + 5;
		// var arrowRight = (btnOffset.left - contentLeft) / 2 + contentLeft;
		var arrowRight = btnOffset.left + btn.outerWidth() / 2;
		if (totalWidth > 1460) {
			arrowRight = $content.offset().left + parseInt($content.css("padding-left"));
		}
		var arrowWidth = arrowRight - menuWidth;
		var arrowHeight = targetOffset.top + alignTarget.outerHeight() / 2 - arrowTop;
		var arrowStyles = {
			left: menuWidth,
			top: arrowTop + 6,
			width: arrowWidth,
			height: arrowHeight > 0 ? arrowHeight : 0,
			"background-position-x": totalWidth > 1460 ? "right" : "left"
		};
		// 仅在计算的样式与之上一次计算的样式不同时才应用样式
		if (!equalsRoughly(arrowStyles, oldArrowStyles)) {
			$arrow.css(arrowStyles);
			oldArrowStyles = arrowStyles;
		}
		updateTimer = setTimeout(updatePosition, 100);
	}

	function cleanDOM() {
		$element.remove();
		$scope.$destroy();
		$("li[nav-title='快速部署']").removeClass("left-menu-item-on");
		clearTimeout(updateTimer);
	}

	function equalsRoughly(obj1, obj2) {
		var eq = true;
		var keys = Object.keys(obj1);
		angular.forEach(keys, function (key) {
			var v1 = obj1[key] || 0;
			var v2 = obj2[key] || 0;
			if (typeof v1 !== "number" || typeof v2 !== "number") {
				return;
			}
			if (Math.abs(v1 - v2) >= 5) {
				eq = false;
			}
		});
		return eq;
	}
}]).controller("vdiSystemUSBThroughController", ["$scope", "$modal", "USBPassThrough", function ($scope, $modal, USBPassThrough) {

	$scope.rows = [];
	$scope.loading = true;

	var get_rows = function get_rows() {
		USBPassThrough.query(function (res) {
			$scope.rows = res.devices_info.sort(function (a, b) {
				return a.manufacturer > b.manufacturer ? 1 : -1;
			});
			$scope.loading = false;
		});
	};
	get_rows();

	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];
	$scope.currentPage = 1;
	var _SCOPE = $scope;

	$scope.through = function (item) {
		var dialog = $modal.open({
			templateUrl: "views/vdi/dialog/system/through_add.html",
			controller: "USBthroughDialog",
			scope: $scope,
			size: "md",
			resolve: {
				params: function params() {
					return { throughItem: angular.copy(item) };
				}
			}
		});
		dialog.result.then(function (data) {
			if (data) {
				get_rows();
			}
		});
	};
	$scope.editThrough = function (item) {
		item.edit = true;
		var dialog = $modal.open({
			templateUrl: "views/vdi/dialog/system/through_add.html",
			controller: "USBthroughDialog",
			scope: $scope,
			size: "md",
			resolve: {
				params: function params() {
					return { throughItem: angular.copy(item) };
				}
			}
		});
		dialog.result.then(function (data) {
			if (data) {
				get_rows();
			}
		});
	};
	$scope.cancelThrough = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='取消绑定'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='CANCEL_THROUGH'></p><footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''><button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$scope.loading = true;
					var data = {
						compute_node_id: item.compute_node_id,
						identify: item.identify,
						instance_id: item.instance_id
					};
					USBPassThrough.cancel(data, function (res) {
						get_rows();
						$modalInstance && $modalInstance.close();
					}).$promise.finally(function (res) {
						$scope.loading = false;
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller('USBthroughDialog', ['$scope', "$modalInstance", "AutoSnapshot", "ResourcePool", "params", "Scene", "TeachDesktop", "FenTemplate", "$$$I18N", "TreeInstances", "USBPassThrough", function ($scope, $modalInstance, AutoSnapshot, ResourcePool, params, Scene, TeachDesktop, FenTemplate, $$$I18N, TreeInstances, USBPassThrough) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.data = params.throughItem;
	if (!$scope.data.edit) {
		$scope.data.type = null;
		$scope.data.scene_id = null;
	}
	var old_instance_id = $scope.data.instance_id;
	$scope.data.expandedNodes = [];
	$scope.all_users = [];
	$scope.selectedUsers = {};

	$scope.changeType = function (type, flag) {
		if (!flag) {
			$scope.data.scene_id = null;
			$scope.data.instance_id = null;
			$scope.data.selected_desktop = null;
		}
		if (type == '2') {
			getScenesDektop();
		} else if (type == '1') {
			getCommonDektop();
		} else {
			getSystemDektop();
		}
	};
	if ($scope.data.edit) {
		$scope.changeType($scope.data.type, true);
	}
	function getScenesDektop() {
		Scene.query(function (res) {
			$scope.scenes = res.modes.filter(function (item) {
				return item.virtual_type == 'kvm';
			});
			if ($scope.data.scene_id) {
				$scope.data.scene = $scope.scenes.filter(function (item) {
					return item.id == $scope.data.scene_id;
				})[0];
			} else {
				$scope.data.scene = $scope.scenes[0];
			}
			$scope.getTeaches($scope.data.scene);
		}, function () {});
	}
	$scope.getTeaches = function (scene) {
		if (scene) {
			$scope.teachLoading = true;
			TeachDesktop.query({ id: scene.id }, function (res) {
				$scope.teachLoading = false;
				$scope.teaches = res.result;
				if ($scope.data.instance_id) {
					$scope.data.teach = $scope.teaches.filter(function (item) {
						return item.instance_id == $scope.data.instance_id;
					})[0];
				} else {
					$scope.data.teach = $scope.teaches[0];
				}
			}, function () {
				$scope.teachLoading = false;
			});
		}
	};
	function getCommonDektop() {
		$scope.loadDesktops = true;
		TreeInstances.query({ resource_pool: $scope.data.resource_pool_uuid }, function (res) {
			var adminUsers = res.result.filter(function (u) {
				return u.type == 'admin' && u.desktop_num;
			});
			var adminDesktops = [];
			adminUsers.forEach(function (u) {
				u.desktops.forEach(function (desk) {
					adminDesktops.push(desk);
				});
			});
			var datas = [];
			if (getAdminNum(adminUsers)) {
				datas.push({ name: $$$I18N.get('管理用户关联桌面'), desktop_num: getAdminNum(adminUsers), desktops: adminDesktops });
			}
			res.result.forEach(function (item) {
				if (item.type == 'common' && item.desktop_num) {
					datas.push(item);
				} else if (item.type == 'domain' && item.desktop_num) {
					datas.push(item);
				} else {}
			});
			$scope.desktops = formatData(removeNoChildrenDeparts(datas), "children");
			if ($scope.data.instance_id) {
				$scope.data.selected_desktop = $scope.all_users.filter(function (d) {
					return d.desktop_id === $scope.data.instance_id;
				})[0];
			}
			$scope.loadDesktops = false;
		});
	}
	function getSystemDektop() {
		FenTemplate.query(function (res) {
			$scope.sys_desktops = res.win_images.concat(res.linux_images).concat(res.other_images);
			if ($scope.data.instance_id) {
				$scope.data.sys_desktop = $scope.sys_desktops.filter(function (item) {
					return item.id == $scope.data.instance_id;
				})[0];
			} else {
				$scope.data.sys_desktop = $scope.sys_desktops[0];
			}
			$scope.data.sys_desktop = $scope.sys_desktops[0];
		}, function () {});
	}

	/* 个人桌面数据拉取及配置 */
	$scope.desktopsTreeOptions = {
		dirSelectable: false,
		injectClasses: {
			"liSelected": "tree-leaf-active"
		}
	};
	function getAdminNum(rows) {
		return rows.reduce(function (count, item) {
			return count + item.desktop_num;
		}, 0);
	}
	function removeNoChildrenDeparts(data) {
		data = data.filter(noUserFilter);
		data.forEach(walk);
		return data;
		function walk(node) {
			if (!node.dept_id) {
				return;
			}
			if (node.children) {
				node.children = node.children.filter(noUserFilter);
				node.children.forEach(walk);
			}
		}
		function noUserFilter(node) {
			if (node.dept_id && !node.children && node.desktops.length === 0) {
				return false;
			}
			return true;
		}
	}
	function formatData(d, name) {
		iteration(d, name);
		return d;
	}
	function iteration(data, childName, list) {
		for (var i = 0; i < data.length; i++) {
			$scope.data.expandedNodes.push(data[i]);
			if (data[i][childName] && data[i][childName].length) {
				var len = iteration(data[i][childName], childName);
				if (len === 0) {
					data[i] = undefined;
				}
			}
			if (!data[i]) {
				continue;
			}
			if (data[i].desktops && data[i].desktops.length > 0) {
				data[i].desktops.map(function (user) {
					user.name = user.name || user.user_name;
					user.id = user.id || user.desktop_id;
					user._is_last = true;
					$scope.all_users.push(user);
					return user;
				});
				data[i][childName] = data[i].desktops;
			}
			if (data[i][childName] && data[i][childName].length === 0) {
				data[i] = undefined;
			}
		}
		while (data.length > 0) {
			// 如果有数组元素为空，每次删除一个
			var oldlen = data.length;
			for (var i = 0; i < oldlen; i++) {
				if (data[i] === undefined) {
					data.splice(i, 1);
					break;
				}
			}
			if (oldlen === data.length) {
				break;
			}
		}

		return data.length;
	}
	/* 个人桌面数据拉取及配置---------------end */

	$scope.ok = function () {
		$scope.submiting = true;
		var instance_id = "";
		if (this.data.type == '2') {
			instance_id = this.data.teach.instance_id;
		} else if (this.data.type == '1') {
			instance_id = this.data.selected_desktop.desktop_id;
		} else {
			instance_id = this.data.sys_desktop.instance_id;
		}
		var data = {
			compute_node_id: this.data.compute_node_id,
			identify: this.data.identify,
			instance_id: instance_id,
			old_instance_id: this.data.edit ? old_instance_id : undefined
		};
		console.log(11111, data);
		USBPassThrough.save(data, function (res) {
			$scope.submiting = false;
			$modalInstance.close(res);
		}, function () {
			$scope.submiting = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller("vdiSystemAutoSnapshotController", ["$scope", "AutoSnapshot", "$modal", function ($scope, AutoSnapshot, $modal) {
	$scope.rows = [];
	$scope.loading = true;
	var get_rows = function get_rows() {
		AutoSnapshot.query(function (res) {
			$scope.rows = res.result.sort(function (a, b) {
				return a.name > b.name ? 1 : -1;
			});
			$scope.rows.forEach(function (item) {
				if (item.period == 'weekly') {
					item.date = 'weekly' + item.week_date;
				} else if (item.period == 'monthly') {
					item.date = 'monthly' + item.month_date;
				}
			});
			$scope.loading = false;
		});
	};
	get_rows();

	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];
	$scope.currentPage = 1;
	var _SCOPE = $scope;

	$scope.active = function (snapshot) {
		$scope.rows.forEach(function (item) {
			if (item.id == snapshot.id) {
				item.active_loadding = true;
			}
		});
		AutoSnapshot.active({ id: snapshot.id, active: !snapshot.active }, function (res) {
			get_rows();
			$scope.rows.forEach(function (item) {
				if (item.id == snapshot.id) {
					item.active = !snapshot.active;
					item.active_loadding = false;
				}
			});
		}, function (err) {
			get_rows();
			$scope.rows.forEach(function (item) {
				if (item.id == snapshot.id) {
					item.active = snapshot.active;
					item.active_loadding = false;
				}
			});
		});
	};
	$scope.add = function () {
		var dialog = $modal.open({
			templateUrl: "views/vdi/dialog/system/snapshot_add.html",
			controller: "addSnapshotDialog",
			size: "md"
		});
		dialog.result.then(function (res) {
			if (res) {
				get_rows();
			}
		});
	};
	$scope.edit = function (item) {
		item.edit = true;
		var dialog = $modal.open({
			templateUrl: "views/vdi/dialog/system/snapshot_edit.html",
			controller: "editSnapshotDialog",
			scope: $scope,
			size: "md",
			resolve: {
				params: function params() {
					return { snapshotItem: angular.copy(item) };
				}
			}
		});
		dialog.result.then(function (data) {
			if (data) {
				get_rows();
			}
		});
	};
	$scope.view = function (item) {
		item.edit = false;
		var dialog = $modal.open({
			templateUrl: "views/vdi/dialog/system/snapshot_edit.html",
			controller: "editSnapshotDialog",
			scope: $scope,
			size: "md",
			resolve: {
				params: function params() {
					return { snapshotItem: angular.copy(item) };
				}
			}
		});
	};
	$scope.delete = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除自动快照策略'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='DELETE_AUTO_SNAPSHOT'></p><footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''><button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$scope.loading = true;
					AutoSnapshot.delete({ ids: selected_rows.map(function (row) {
							return row.id;
						}) }, function (res) {
						get_rows();
						$modalInstance && $modalInstance.close();
					}).$promise.finally(function (res) {
						$scope.loading = false;
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller('addSnapshotDialog', ['$scope', "$modalInstance", "AutoSnapshot", "ResourcePool", "$$$I18N", "TreeInstances", function ($scope, $modalInstance, AutoSnapshot, ResourcePool, $$$I18N, TreeInstances) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;

	$scope.data = { expandedNodes: [] };

	ResourcePool.query(function (res) {
		// $scope.resources = res.result.filter(function(item){ return item.hosts.length > 0});
		$scope.resources = res.result;
		$scope.data.resource = $scope.resources[0];
		$scope.data.resource && $scope.queryTreeInstances($scope.data.resource);
	});

	/* 个人桌面数据拉取及配置 */
	$scope.selectedUsers = {};
	function getAdminNum(rows) {
		return rows.reduce(function (count, item) {
			return count + item.desktop_num;
		}, 0);
	}

	$scope.queryTreeInstances = function (resource) {
		$scope.loadDesktops = true;
		TreeInstances.query({ resource_pool: resource.id, need_rollback_desktops: 0 }, function (res) {
			var adminUsers = res.result.filter(function (u) {
				return u.type == 'admin' && u.desktop_num;
			});
			var adminDesktops = [];
			adminUsers.forEach(function (u) {
				u.desktops.forEach(function (desk) {
					adminDesktops.push(desk);
				});
			});
			var datas = [];
			if (getAdminNum(adminUsers)) {
				datas.push({ name: $$$I18N.get('管理用户关联桌面'), desktop_num: getAdminNum(adminUsers), desktops: adminDesktops });
			}
			res.result.forEach(function (item) {
				if (item.type == 'common' && item.desktop_num) {
					datas.push(item);
				} else if (item.type == 'domain' && item.desktop_num) {
					datas.push(item);
				} else {}
			});
			$scope.desktops = formatData(removeNoChildrenDeparts(datas), "children");
			$scope.loadDesktops = false;
			console.log(1111111, $scope.data.expandedNodes);
		});
	};

	function removeNoChildrenDeparts(data) {
		data = data.filter(noUserFilter);
		data.forEach(walk);
		return data;
		function walk(node) {
			if (!node.dept_id) {
				return;
			}
			if (node.children) {
				node.children = node.children.filter(noUserFilter);
				node.children.forEach(walk);
			}
		}
		function noUserFilter(node) {
			if (node.dept_id && !node.children && node.desktops.length === 0) {
				return false;
			}
			return true;
		}
	}
	function formatData(d, name) {
		iteration(d, name);
		return d;
	}

	function iteration(data, childName, list) {
		for (var i = 0; i < data.length; i++) {
			$scope.data.expandedNodes.push(data[i]);
			if (data[i][childName] && data[i][childName].length) {
				var len = iteration(data[i][childName], childName);
				if (len === 0) {
					data[i] = undefined;
				}
			}
			if (!data[i]) {
				continue;
			}
			if (data[i].desktops && data[i].desktops.length > 0) {
				data[i].desktops.map(function (user) {
					user.name = user.name || user.user_name;
					user._is_last = true;
					return user;
				});
				data[i][childName] = data[i].desktops;
			}
			if (data[i][childName] && data[i][childName].length === 0) {
				data[i] = undefined;
			}
		}
		while (data.length > 0) {
			// 如果有数组元素为空，每次删除一个
			var oldlen = data.length;
			for (var i = 0; i < oldlen; i++) {
				if (data[i] === undefined) {
					data.splice(i, 1);
					break;
				}
			}
			if (oldlen === data.length) {
				break;
			}
		}

		return data.length;
	}

	function recursionNode(obj, selected, name) {
		if (obj[name]) {
			obj[name].forEach(function (item) {
				item._selected = selected;
				recursionNode(item, selected, name);
			});
		}
	}

	function calculateSelectedLeafs(node, cName, leafs) {
		// 计算每一次点击有多少用户被选中
		var _id = node.id || node.desktop_id;
		if (node[cName] && node[cName].length) {
			node[cName].forEach(function (n) {
				calculateSelectedLeafs(n, cName, leafs);
			});
		} else {
			node._selected ? $scope.selectedUsers[_id] = node : delete $scope.selectedUsers[_id];
		}
	}

	$scope.showManageSelected = function (node, selected, $parentNode, $index, $first, $middle, $last, $odd, $even, $path, nodeChildren) {
		var childName = nodeChildren || "children";
		node._selected = !node._selected;
		recursionNode(node, node._selected, childName);
		calculateSelectedLeafs(node, childName, $scope.selectedUsers);
		$path().forEach(function (item, index) {
			if (index !== 0) {
				var _selectedNum = item[childName].filter(function (item) {
					return item._selected == true;
				}).length;
				var _middSelectedNum = item[childName].filter(function (item) {
					return item._selected == 'middle';
				}).length;
				if (!_selectedNum) {
					item._selected = false;
				}
				if (_selectedNum == item[childName].length) {
					item._selected = true;
				}
				if (_middSelectedNum || _selectedNum && _selectedNum !== item[childName].length) {
					item._selected = 'middle';
				}
			}
		});
	};

	$scope.selectedUsersNums = function () {
		return Object.keys($scope.selectedUsers).length;
	};
	$scope.ok = function () {
		$scope.submiting = true;
		var data = {
			name: this.data.name,
			description: this.data.description,
			resource_pool: this.data.resource.uuid,
			period: this.data.period,
			week_date: this.data.period == 'weekly' ? this.data.week_date : undefined,
			month_date: this.data.period == 'monthly' ? this.data.month_date : undefined,
			instances: Object.keys($scope.selectedUsers)
		};
		AutoSnapshot.save(data, function (res) {
			$scope.submiting = false;
			$modalInstance.close(res);
		}, function () {
			$scope.submiting = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('editSnapshotDialog', ['$scope', "$modalInstance", "AutoSnapshot", "ResourcePool", "$$$I18N", "TreeInstances", "params", function ($scope, $modalInstance, AutoSnapshot, ResourcePool, $$$I18N, TreeInstances, params) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.data = params.snapshotItem;
	$scope.data.expandedNodes = [];
	$scope.all_desktops = [];

	ResourcePool.query(function (res) {
		// $scope.resources = res.result.filter(function(item){ return item.hosts.length > 0});
		$scope.resources = res.result;
		$scope.data.resource = $scope.resources.filter(function (item) {
			return item.uuid == $scope.data.resource_pool;
		})[0];
		$scope.data.resource && $scope.queryTreeInstances($scope.data.resource);
	});
	$scope.initPeriod = function (period) {
		if (period == 'weekly') {
			$scope.data.week_date = '1';
		} else if (period == 'monthly') {
			$scope.data.month_date = '1';
		}
	};
	/* 个人桌面数据拉取及配置 */
	$scope.selectedUsers = {};
	if ($scope.data.edit) {
		$scope.desktopTreeOptions = {
			isSelectable: function isSelectable(node) {
				return true;
			}
		};
	} else {
		$scope.desktopTreeOptions = {
			isSelectable: function isSelectable(node) {
				return false;
			}
		};
	}
	function getAdminNum(rows) {
		return rows.reduce(function (count, item) {
			return count + item.desktop_num;
		}, 0);
	}

	$scope.queryTreeInstances = function (resource) {
		$scope.loadDesktops = true;
		TreeInstances.query({ resource_pool: resource.id, need_rollback_desktops: 0 }, function (res) {
			var adminUsers = res.result.filter(function (u) {
				return u.type == 'admin' && u.desktop_num;
			});
			var adminDesktops = [];
			adminUsers.forEach(function (u) {
				u.desktops.forEach(function (desk) {
					adminDesktops.push(desk);
				});
			});
			var datas = [];
			if (getAdminNum(adminUsers)) {
				datas.push({ name: $$$I18N.get('管理用户关联桌面'), desktop_num: getAdminNum(adminUsers), desktops: adminDesktops });
			}
			res.result.forEach(function (item) {
				if (item.type == 'common' && item.desktop_num) {
					datas.push(item);
				} else if (item.type == 'domain' && item.desktop_num) {
					datas.push(item);
				} else {}
			});
			$scope.desktops = formatData(removeNoChildrenDeparts(datas), "children");
			$scope.all_desktops.forEach(function (item) {
				$scope.data.instances.forEach(function (instance) {
					if (instance.instance_id == item.desktop_id) {
						item._selected = true;
						$scope.selectedUsers[item.desktop_id] = item;
					}
				});
			});
			checkNodeSelected($scope.desktops);
			$scope.loadDesktops = false;
		});
	};

	function removeNoChildrenDeparts(data) {
		data = data.filter(noUserFilter);
		data.forEach(walk);
		return data;
		function walk(node) {
			if (!node.dept_id) {
				return;
			}
			if (node.children) {
				node.children = node.children.filter(noUserFilter);
				node.children.forEach(walk);
			}
		}
		function noUserFilter(node) {
			if (node.dept_id && !node.children && node.desktops.length === 0) {
				return false;
			}
			return true;
		}
	}
	function formatData(d, name) {
		iteration(d, name);
		return d;
	}
	function checkNodeSelected(arr) {
		arr.forEach(function (node) {
			if (node.children) {
				checkNodeSelected(node.children);
				var isAllSelected = true;
				var hasSelected = false;
				var hasMiddle = false;
				node.children.forEach(function (subNode) {
					if (subNode._selected == 'middle') {
						hasMiddle = true;
						isAllSelected = false;
						return;
					}
					if (subNode._selected) {
						hasSelected = true;
					}
					isAllSelected = isAllSelected && subNode._selected;
				});
				if (isAllSelected) {
					node._selected = true;
				} else if (hasMiddle) {
					node._selected = "middle";
				} else if (hasSelected) {
					node._selected = "middle";
				}
			}
		});
		return arr;
	}
	function iteration(data, childName, list) {
		for (var i = 0; i < data.length; i++) {
			$scope.data.expandedNodes.push(data[i]);
			if (data[i][childName] && data[i][childName].length) {
				var len = iteration(data[i][childName], childName);
				if (len === 0) {
					data[i] = undefined;
				}
			}
			if (!data[i]) {
				continue;
			}
			if (data[i].desktops && data[i].desktops.length > 0) {
				data[i].desktops.map(function (user) {
					user.name = user.name || user.user_name;
					user.id = user.id || user.desktop_id;
					user._is_last = true;
					$scope.all_desktops.push(user);
					return user;
				});
				data[i][childName] = data[i].desktops;
			}
			if (data[i][childName] && data[i][childName].length === 0) {
				data[i] = undefined;
			}
		}
		while (data.length > 0) {
			// 如果有数组元素为空，每次删除一个
			var oldlen = data.length;
			for (var i = 0; i < oldlen; i++) {
				if (data[i] === undefined) {
					data.splice(i, 1);
					break;
				}
			}
			if (oldlen === data.length) {
				break;
			}
		}

		return data.length;
	}
	function recursionNode(obj, selected, name) {
		if (obj[name]) {
			obj[name].forEach(function (item) {
				item._selected = selected;
				recursionNode(item, selected, name);
			});
		}
	}
	function calculateSelectedLeafs(node, cName, leafs) {
		// 计算每一次点击有多少用户被选中
		var _id = node.id || node.desktop_id;
		if (node[cName] && node[cName].length) {
			node[cName].forEach(function (n) {
				calculateSelectedLeafs(n, cName, leafs);
			});
		} else {
			node._selected ? $scope.selectedUsers[_id] = node : delete $scope.selectedUsers[_id];
		}
	}
	$scope.showManageSelected = function (node, selected, $parentNode, $index, $first, $middle, $last, $odd, $even, $path, nodeChildren) {
		var childName = nodeChildren || "children";
		node._selected = !node._selected;
		recursionNode(node, node._selected, childName);
		calculateSelectedLeafs(node, childName, $scope.selectedUsers);
		$path().forEach(function (item, index) {
			if (index !== 0) {
				var _selectedNum = item[childName].filter(function (item) {
					return item._selected == true;
				}).length;
				var _middSelectedNum = item[childName].filter(function (item) {
					return item._selected == 'middle';
				}).length;
				if (!_selectedNum) {
					item._selected = false;
				}
				if (_selectedNum == item[childName].length) {
					item._selected = true;
				}
				if (_middSelectedNum || _selectedNum && _selectedNum !== item[childName].length) {
					item._selected = 'middle';
				}
			}
		});
	};

	$scope.selectedUsersNums = function () {
		return Object.keys($scope.selectedUsers).length;
	};
	$scope.ok = function () {
		$scope.submiting = true;
		var data = {
			id: this.data.id,
			name: this.data.name,
			description: this.data.description,
			resource_pool: this.data.resource.uuid,
			period: this.data.period,
			week_date: this.data.period == 'weekly' ? this.data.week_date : undefined,
			month_date: this.data.period == 'monthly' ? this.data.month_date : undefined,
			instances: Object.keys($scope.selectedUsers)
		};
		AutoSnapshot.update(data, function (res) {
			$scope.submiting = false;
			$modalInstance.close(res);
		}, function () {
			$scope.submiting = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller("spiceConnectController", ["$scope", "$modal", "$$$I18N", "Spice", function ($scope, $modal, $$$I18N, Spice) {
	var spiceCtrl = this;
	spiceCtrl.getSpiceConnect = function () {
		spiceCtrl.loading = true;
		Spice.query(function (res) {
			spiceCtrl.mode = res.spice_jpeg_compression;
			spiceCtrl.loading = false;
		}, function (error) {
			spiceCtrl.loading = false;
		});
	};
	spiceCtrl.getSpiceConnect();
	spiceCtrl.saveSpiceConnect = function () {
		spiceCtrl.save = true;
		Spice.save({ spice_jpeg_compression: spiceCtrl.mode }, function (res) {
			spiceCtrl.save = false;
			spiceCtrl.getSpiceConnect();
			spiceCtrl.edit = false;
		}, function (error) {
			spiceCtrl.save = false;
		});
	};
}]).controller("vdiSystemAutoclearController", ["$scope", "$modal", "$$$I18N", "Share", function ($scope, $modal, $$$I18N, Share) {
	var clearCtrl = this;
	clearCtrl.getClearTime = function () {
		clearCtrl.loading = true;
		Share.query(function (res) {
			clearCtrl.day = res.value.day;
			var time = res.value.time.split(":");
			clearCtrl.hours = time[0];
			clearCtrl.minutes = time[1];
			clearCtrl.seconds = time[2];
			clearCtrl.loading = false;
		}, function (error) {
			clearCtrl.loading = false;
		});
	};
	clearCtrl.getClearTime();
	clearCtrl.saveClearTime = function () {
		if (clearCtrl.hours.length == 1 && Number(clearCtrl.hours) >= 0 && Number(clearCtrl.hours) <= 9) {
			clearCtrl.hours = "0" + clearCtrl.hours;
		}
		if (clearCtrl.minutes.length == 1 && Number(clearCtrl.minutes) >= 0 && Number(clearCtrl.minutes) <= 9) {
			clearCtrl.minutes = "0" + clearCtrl.minutes;
		}
		if (clearCtrl.seconds.length == 1 && Number(clearCtrl.seconds) >= 0 && Number(clearCtrl.seconds) <= 9) {
			clearCtrl.seconds = "0" + clearCtrl.seconds;
		}
		var time = clearCtrl.hours + ":" + clearCtrl.minutes + ":" + clearCtrl.seconds;
		clearCtrl.save = true;
		Share.save({ value: { day: clearCtrl.day, time: time } }, function (res) {
			clearCtrl.save = false;
			clearCtrl.getClearTime();
			clearCtrl.edit = false;
		}, function (error) {
			clearCtrl.save = false;
		});
	};
}]);

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var freeGlobal = __webpack_require__(39);

/** Detect free variable `self`. */
var freeSelf = (typeof self === 'undefined' ? 'undefined' : _typeof(self)) == 'object' && self && self.Object === Object && self;

/** Used as a reference to the global object. */
var root = freeGlobal || freeSelf || Function('return this')();

module.exports = root;

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Checks if `value` is classified as an `Array` object.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an array, else `false`.
 * @example
 *
 * _.isArray([1, 2, 3]);
 * // => true
 *
 * _.isArray(document.body.children);
 * // => false
 *
 * _.isArray('abc');
 * // => false
 *
 * _.isArray(_.noop);
 * // => false
 */
var isArray = Array.isArray;

module.exports = isArray;

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Checks if `value` is the
 * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
 * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an object, else `false`.
 * @example
 *
 * _.isObject({});
 * // => true
 *
 * _.isObject([1, 2, 3]);
 * // => true
 *
 * _.isObject(_.noop);
 * // => true
 *
 * _.isObject(null);
 * // => false
 */
function isObject(value) {
  var type = typeof value === 'undefined' ? 'undefined' : _typeof(value);
  return value != null && (type == 'object' || type == 'function');
}

module.exports = isObject;

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseIsNative = __webpack_require__(67),
    getValue = __webpack_require__(73);

/**
 * Gets the native function at `key` of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @param {string} key The key of the method to get.
 * @returns {*} Returns the function if it's native, else `undefined`.
 */
function getNative(object, key) {
  var value = getValue(object, key);
  return baseIsNative(value) ? value : undefined;
}

module.exports = getNative;

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var vdiApp = angular.module("smartApp", ["ngRoute", "ngResource",
// 'ngAnimate', // this is buggy, jarviswidget will not work with ngAnimate :(
"ui.bootstrap", "app.controllers",
//"app.demoControllers",
"app.main", "app.navigation", "app.localize", "app.activity", "app.smartui", "vdi", "vdi.auth", "vdi.summary", "vdi.about", "vdi.desktop", "vdi.resource", "vdi.scheduler", "vdi.system", "vdi.monitor", "vdi.template", "vdi.template.teach", "vdi.template.person", "vdi.template.hardware", "vdi.terminal", "vdi.schoolroom", "vdi.user", "vdi.plan", "vdi.HA", "vdi.network", "treeControl"]).config(["$routeProvider", "$provide", function ($routeProvider, $provide) {

	$routeProvider.when("/", { redirectTo: '/summary' })
	// .when("/login", {
	// 	template: "",
	// 	controller: ["$location", "$rootScope", "UserRole", function($location, $root, Role){
	// 		// if(Role.logined){
	// 		// 	$root.$broadcast("AUTHED", args)
	// 		// }
	// 		console.log("login", arguments, Role.logined);
	// 	}]
	// })
	.when("/summary", { templateUrl: "views/vdi/summary.html", controller: "vdiSummaryController" }).when("/resource/console", { templateUrl: "views/vdi/resource/console/console.html", controller: "vdiResourceConsoleListController" }).when("/resource/pool", { templateUrl: "views/vdi/resource/pool/pool.html", controller: "vdiResourcePoolListController" }).when("/resource/pool/:id/:type", { templateUrl: "views/vdi/resource/pool/host.html", controller: "vdiResourcePoolHostController" }).when("/resource/storage", { templateUrl: "views/vdi/resource/storage/storage.html", controller: "vdiResourceStorageListController" }).when("/network/manageNetwork", { templateUrl: "views/vdi/network/manageNetwork/manageNetwork.html", controller: "vdiManageNetworkListController" }).when("/network/virtualSwitch", { templateUrl: "views/vdi/network/virtualSwitch/virtualSwitch.html", controller: "vdiVirtualSwitchListController" }).when("/network/virtualSwitch/:id", { templateUrl: function templateUrl() {
			return "views/vdi/network/virtualSwitch/virtualSwitchItem.html";
		}, controller: "vdiVirtualSwitchItemController" }).when("/network/dataNetwork", { templateUrl: "views/vdi/network/dataNetwork/dataNetwork.html", controller: "vdiDataNetworkListController" }).when("/network/dataNetwork/:id", { templateUrl: function templateUrl() {
			return "views/vdi/network/dataNetwork/sub_network.html";
		}, controller: "vdiDataNetworkSubNetworkListController" }).when("/network/dataNetwork/:id/subnet/:sub_id", { templateUrl: "views/vdi/network/dataNetwork/IPpool.html", controller: "vdiDataNetworkIPListController" }).when("/network/dhcp", { templateUrl: "views/vdi/network/dhcp/dhcp.html", controller: "vdiDHCPController", controllerAs: "DHCPCtrl" }).when("/desktop/scene", { templateUrl: "views/vdi/desktop/scene.html", controller: "vdiDesktopSceneListController" }).when("/desktop/teach/:id", { templateUrl: function templateUrl() {
			return "views/vdi/desktop/teach.html";
		}, controller: "vdiDesktopTeachListController" }).when("/desktop/personal", { templateUrl: "views/vdi/desktop/personal.html", controller: "vdiDesktopPersonalListController" }).when("/desktop/pool", { templateUrl: "views/vdi/desktop/pool.html", controller: "vdiDesktopPoolController" }).when("/desktop/poolList/:id", { templateUrl: function templateUrl() {
			return "views/vdi/desktop/poolList.html";
		}, controller: "vdiDesktopPoolListController" }).when("/template/teach", { templateUrl: "views/vdi/template/teach.html", controller: "vdiTemplateTeachDesktopListController" }).when("/template/personal", { templateUrl: "views/vdi/template/personal.html", controller: "vdiTemplatePresonalDesktopListController" }).when("/template/hardware", { templateUrl: "views/vdi/template/hardware.html", controller: "vdiTemplateHardwareListController" }).when("/terminal/schoolroom", { templateUrl: "views/vdi/terminal/schoolroom.html", controller: "vdiTerminalSchoolroomManageController" }).when("/terminal/client", { templateUrl: "views/vdi/terminal/client.html", controller: "vdiTerminalClientManageController" }).when("/terminal/session", { templateUrl: "views/vdi/terminal/session.html", controller: "vdiTerminalSessionManageController" }).when("/user/role", { templateUrl: "views/vdi/user/role.html", controller: "vdiUserRoleManageController" }).when("/user/admin", { templateUrl: "views/vdi/user/admin.html", controller: "vdiUserAdminManageController" }).when("/user/common", { templateUrl: "views/vdi/user/common.html", controller: "vdiUserCommonManageController" }).when("/user/domain", { templateUrl: "views/vdi/user/domain.html", controller: "vdiUserDomainController" }).when("/user/domain/:id", { templateUrl: function templateUrl() {
			return "views/vdi/user/domainList.html";
		}, controller: "vdiUserDomainListController" }).when("/monitor/host", { templateUrl: "views/vdi/monitor/host.html", controller: "vdiMonitorController" }).when("/monitor/desktop", { templateUrl: "views/vdi/monitor/desktop.html", controller: "vdiMonitorController" }).when("/monitor/alarm", { templateUrl: "views/vdi/monitor/alarm.html", controller: "vdiMonitorAlarmController" }).when("/monitor/policy", { templateUrl: "views/vdi/monitor/policy.html", controller: "vdiMonitorPolicyController" }).when("/scheduler/view", { templateUrl: "views/vdi/scheduler/view.html", controller: "vdiSchedulerViewController" }).when("/plan/switch", { templateUrl: "views/vdi/plan/switch.html", controller: "vdiPlanSwitchController" }).when("/plan/hostSwitch", { templateUrl: "views/vdi/plan/host_switch.html", controller: "vdiHostPlanSwitchController" }).when("/HA/desktop", { templateUrl: "views/vdi/HA/desktop_ha.html", controller: "vdiDesktopHAViewController" }).when("/system/deploy", { templateUrl: "views/vdi/system/deploy.html", controller: "vdiSystemDeployController" }).when("/system/set", { templateUrl: "views/vdi/system/set.html", controller: "vdiSystemSetController", controllerAs: "SetCtrl" }).when("/system/desktop", { templateUrl: "views/vdi/system/desktop.html", controller: "vdiSystemDesktopListController" }).when("/system/desktop/:id", { templateUrl: "views/vdi/system/desktop_detail.html", controller: "vdiSystemDesktopDetailController" }).when("/system/backup", { templateUrl: "views/vdi/system/backup.html", controller: "vdiSystemBackupListController" }).when("/system/iso", { templateUrl: "views/vdi/system/iso.html", controller: "vdiSystemISOListController" }).when("/system/usb", { templateUrl: "views/vdi/system/usb.html", controller: "vdiSystemUSBListController" }).when("/system/through", { templateUrl: "views/vdi/system/through.html", controller: "vdiSystemUSBThroughController" }).when("/system/snapshot", { templateUrl: "views/vdi/system/snapshot.html", controller: "vdiSystemAutoSnapshotController" })
	// .when("/system/device", { templateUrl: "views/vdi/system/device.html", controller: "vdiSystemDeviceListController"})
	.when("/system/upgrade", { templateUrl: "views/vdi/system/upgrade.html", controller: "vdiSystemUpgradeListController" }).when("/system/logs", { templateUrl: "views/vdi/system/logs.html", controller: "vdiSystemLogListController" })
	// .when("/system/endlogs", { templateUrl: "views/vdi/system/endlogs.html", controller: "vdiSystemEndlogListController"})
	.when("/system/outside", { templateUrl: "views/vdi/system/outside.html", controller: "vdiSystemOutsideController" }).when("/about", { templateUrl: "views/vdi/about.html", controller: "vdiPermissionController" }).otherwise({
		redirectTo: '/summary'
	});
	// with this, you can use $log('Message') same as $log.info('Message');
	$provide.decorator('$log', ['$delegate', function ($delegate) {
		// create a new function to be returned below as the $log service (instead of the $delegate)
		function logger() {
			// if $log fn is called directly, default to "info" message
			logger.info.apply(logger, arguments);
		}

		// add all the $log props into our new logger fn
		angular.extend(logger, $delegate);
		return logger;
	}]);
}]).run(["$rootScope", "settings", "localize", "$route", "UserRole", "$window", "$document", "$$$I18N", "UserAuth", "UserRole", "NavigatorLink", "quickMaskModel", "SystemDeploy", "desktopHelpBox", function ($root, settings, localize, $route, UserRole, $window, $doc, $$$I18N, Auth, userRole, navigators, quickMaskModel, SystemDeploy, desktopHelpBox) {
	//$root.$broadcast(Auth.logined ? "AUTHED" : "NOAUTH");
	if ($$$storage.getSessionStorage("desktopHelpBox") == 'open') {
		desktopHelpBox.close();
		desktopHelpBox.open();
	} else {
		desktopHelpBox.close();
	}

	if ($$$storage.getSessionStorage("loginInfo")) {
		openQuickstart();
	}
	$root.$on("AUTHED", function (name, userInfo) {
		$route.reload();
		$root.$broadcast("updateNavData", UserRole.currentNavigator);
		openQuickstart();
	});
	var preferLang = settings.languages.filter(function (l) {
		return l.langCode === $$$storage.getSessionStorage('lang_code');
	})[0];
	if (preferLang) {
		settings.currentLang = preferLang;
	}
	var ev_dialog_close = function ev_dialog_close() {
		try {
			window.___dialog && window.___dialog.dismiss && window.___dialog.dismiss();
			window.___dialog = null;
		} catch (e) {}
	};
	$root.$on("updateDocumentTitle", function (name, title) {
		$window.document.title = $$$I18N.get(title);
	});
	$root.$on("$viewContentLoaded", ev_dialog_close);
	$root.$on("$$$forceCloseDailog", ev_dialog_close);

	$root.$on("$viewContentLoaded", function () {
		var URL = [],
		    HASH = location.hash.slice(1);
		UserRole.currentNavigator.map(function (item) {
			if (item.sublist) {
				item.sublist.forEach(function (data) {
					URL.push(data.url);
				});
			} else return URL.push(item.url);
		});
		var is_hasid = false;
		if (location.hash.match(/#\/desktop\/teach\/\S+$/) || location.hash.match(/#\/desktop\/pool\/\S+$/) || location.hash.match(/#\/desktop\/personal\S+$/) || location.hash.match(/#\/desktop\/poolList\/\S+$/) || location.hash.match(/#\/network\/dataNetwork\/\S+$/) || location.hash.match(/#\/resource\/pool\/\S+$/) || location.hash.match(/#\/system\/desktop\/\S+$/) || location.hash.match(/#\/user\/domain\/\S+$/) || location.hash.match(/#\/network\/virtualSwitch\/\S+$/) || location.hash.match(/#\/terminal\/client\S+$/) || location.hash.match(/#\/system\/deploy\S+$/)) {
			is_hasid = true;
		}
		if (URL.length !== 0 && URL.filter(function (item) {
			return item === HASH;
		}).length === 0 && !is_hasid) {
			location.replace("#summary.html");
		}
	});
	$root.navs = UserRole.currentNavigator;
	$root.$broadcast("updateNavData", UserRole.currentNavigator);

	var debug = true;
	if (window.console && !debug) {
		window.console = {};
		"memory,debug,error,info,log,warn,dir,dirxml,table,trace,assert,count,markTimeline,profile,profileEnd,time,timeEnd,timeStamp,timeline,timelineEnd,group,groupCollapsed,groupEnd,clear".split(",").forEach(function (n) {
			window.console[n] = Function.prototype;
		});
	}
	var UA = navigator.userAgent;
	$root.is_chrome = /Chrome\//.test(UA) && /AppleWebKit\//.test(UA) && /Safari\//.test(UA);

	function openQuickstart() {
		SystemDeploy.first_deploy(function (res) {
			if (res.result) {
				quickMaskModel.open();
			}
		});
	}
}]);

vdiApp.constant('ip_pattern', /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/g);

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _Symbol = __webpack_require__(22),
    getRawTag = __webpack_require__(69),
    objectToString = __webpack_require__(70);

/** `Object#toString` result references. */
var nullTag = '[object Null]',
    undefinedTag = '[object Undefined]';

/** Built-in value references. */
var symToStringTag = _Symbol ? _Symbol.toStringTag : undefined;

/**
 * The base implementation of `getTag` without fallbacks for buggy environments.
 *
 * @private
 * @param {*} value The value to query.
 * @returns {string} Returns the `toStringTag`.
 */
function baseGetTag(value) {
    if (value == null) {
        return value === undefined ? undefinedTag : nullTag;
    }
    return symToStringTag && symToStringTag in Object(value) ? getRawTag(value) : objectToString(value);
}

module.exports = baseGetTag;

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Checks if `value` is object-like. A value is object-like if it's not `null`
 * and has a `typeof` result of "object".
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
 * @example
 *
 * _.isObjectLike({});
 * // => true
 *
 * _.isObjectLike([1, 2, 3]);
 * // => true
 *
 * _.isObjectLike(_.noop);
 * // => false
 *
 * _.isObjectLike(null);
 * // => false
 */
function isObjectLike(value) {
  return value != null && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) == 'object';
}

module.exports = isObjectLike;

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var listCacheClear = __webpack_require__(57),
    listCacheDelete = __webpack_require__(58),
    listCacheGet = __webpack_require__(59),
    listCacheHas = __webpack_require__(60),
    listCacheSet = __webpack_require__(61);

/**
 * Creates an list cache object.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function ListCache(entries) {
    var index = -1,
        length = entries == null ? 0 : entries.length;

    this.clear();
    while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
    }
}

// Add methods to `ListCache`.
ListCache.prototype.clear = listCacheClear;
ListCache.prototype['delete'] = listCacheDelete;
ListCache.prototype.get = listCacheGet;
ListCache.prototype.has = listCacheHas;
ListCache.prototype.set = listCacheSet;

module.exports = ListCache;

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var eq = __webpack_require__(38);

/**
 * Gets the index at which the `key` is found in `array` of key-value pairs.
 *
 * @private
 * @param {Array} array The array to inspect.
 * @param {*} key The key to search for.
 * @returns {number} Returns the index of the matched value, else `-1`.
 */
function assocIndexOf(array, key) {
  var length = array.length;
  while (length--) {
    if (eq(array[length][0], key)) {
      return length;
    }
  }
  return -1;
}

module.exports = assocIndexOf;

/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var root = __webpack_require__(13);

/** Built-in value references. */
var _Symbol = root.Symbol;

module.exports = _Symbol;

/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getNative = __webpack_require__(16);

/* Built-in method references that are verified to be native. */
var nativeCreate = getNative(Object, 'create');

module.exports = nativeCreate;

/***/ }),
/* 24 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isKeyable = __webpack_require__(82);

/**
 * Gets the data for `map`.
 *
 * @private
 * @param {Object} map The map to query.
 * @param {string} key The reference key.
 * @returns {*} Returns the map data.
 */
function getMapData(map, key) {
  var data = map.__data__;
  return isKeyable(key) ? data[typeof key == 'string' ? 'string' : 'hash'] : data.map;
}

module.exports = getMapData;

/***/ }),
/* 25 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isSymbol = __webpack_require__(35);

/** Used as references for various `Number` constants. */
var INFINITY = 1 / 0;

/**
 * Converts `value` to a string key if it's not a string or symbol.
 *
 * @private
 * @param {*} value The value to inspect.
 * @returns {string|symbol} Returns the key.
 */
function toKey(value) {
  if (typeof value == 'string' || isSymbol(value)) {
    return value;
  }
  var result = value + '';
  return result == '0' && 1 / value == -INFINITY ? '-0' : result;
}

module.exports = toKey;

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseIsEqualDeep = __webpack_require__(56),
    isObjectLike = __webpack_require__(19);

/**
 * The base implementation of `_.isEqual` which supports partial comparisons
 * and tracks traversed objects.
 *
 * @private
 * @param {*} value The value to compare.
 * @param {*} other The other value to compare.
 * @param {boolean} bitmask The bitmask flags.
 *  1 - Unordered comparison
 *  2 - Partial comparison
 * @param {Function} [customizer] The function to customize comparisons.
 * @param {Object} [stack] Tracks traversed `value` and `other` objects.
 * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
 */
function baseIsEqual(value, other, bitmask, customizer, stack) {
  if (value === other) {
    return true;
  }
  if (value == null || other == null || !isObjectLike(value) && !isObjectLike(other)) {
    return value !== value && other !== other;
  }
  return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);
}

module.exports = baseIsEqual;

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getNative = __webpack_require__(16),
    root = __webpack_require__(13);

/* Built-in method references that are verified to be native. */
var Map = getNative(root, 'Map');

module.exports = Map;

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseGetTag = __webpack_require__(18),
    isObject = __webpack_require__(15);

/** `Object#toString` result references. */
var asyncTag = '[object AsyncFunction]',
    funcTag = '[object Function]',
    genTag = '[object GeneratorFunction]',
    proxyTag = '[object Proxy]';

/**
 * Checks if `value` is classified as a `Function` object.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a function, else `false`.
 * @example
 *
 * _.isFunction(_);
 * // => true
 *
 * _.isFunction(/abc/);
 * // => false
 */
function isFunction(value) {
    if (!isObject(value)) {
        return false;
    }
    // The use of `Object#toString` avoids issues with the `typeof` operator
    // in Safari 9 which returns 'object' for typed arrays and other constructors.
    var tag = baseGetTag(value);
    return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;
}

module.exports = isFunction;

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var mapCacheClear = __webpack_require__(74),
    mapCacheDelete = __webpack_require__(81),
    mapCacheGet = __webpack_require__(83),
    mapCacheHas = __webpack_require__(84),
    mapCacheSet = __webpack_require__(85);

/**
 * Creates a map cache object to store key-value pairs.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function MapCache(entries) {
    var index = -1,
        length = entries == null ? 0 : entries.length;

    this.clear();
    while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
    }
}

// Add methods to `MapCache`.
MapCache.prototype.clear = mapCacheClear;
MapCache.prototype['delete'] = mapCacheDelete;
MapCache.prototype.get = mapCacheGet;
MapCache.prototype.has = mapCacheHas;
MapCache.prototype.set = mapCacheSet;

module.exports = MapCache;

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var arrayLikeKeys = __webpack_require__(102),
    baseKeys = __webpack_require__(109),
    isArrayLike = __webpack_require__(112);

/**
 * Creates an array of the own enumerable property names of `object`.
 *
 * **Note:** Non-object values are coerced to objects. See the
 * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
 * for more details.
 *
 * @static
 * @since 0.1.0
 * @memberOf _
 * @category Object
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of property names.
 * @example
 *
 * function Foo() {
 *   this.a = 1;
 *   this.b = 2;
 * }
 *
 * Foo.prototype.c = 3;
 *
 * _.keys(new Foo);
 * // => ['a', 'b'] (iteration order is not guaranteed)
 *
 * _.keys('hi');
 * // => ['0', '1']
 */
function keys(object) {
  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
}

module.exports = keys;

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(module) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var root = __webpack_require__(13),
    stubFalse = __webpack_require__(105);

/** Detect free variable `exports`. */
var freeExports = ( false ? 'undefined' : _typeof(exports)) == 'object' && exports && !exports.nodeType && exports;

/** Detect free variable `module`. */
var freeModule = freeExports && ( false ? 'undefined' : _typeof(module)) == 'object' && module && !module.nodeType && module;

/** Detect the popular CommonJS extension `module.exports`. */
var moduleExports = freeModule && freeModule.exports === freeExports;

/** Built-in value references. */
var Buffer = moduleExports ? root.Buffer : undefined;

/* Built-in method references for those with the same name as other `lodash` methods. */
var nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;

/**
 * Checks if `value` is a buffer.
 *
 * @static
 * @memberOf _
 * @since 4.3.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
 * @example
 *
 * _.isBuffer(new Buffer(2));
 * // => true
 *
 * _.isBuffer(new Uint8Array(2));
 * // => false
 */
var isBuffer = nativeIsBuffer || stubFalse;

module.exports = isBuffer;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(43)(module)))

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseIsTypedArray = __webpack_require__(106),
    baseUnary = __webpack_require__(107),
    nodeUtil = __webpack_require__(108);

/* Node.js helper references. */
var nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;

/**
 * Checks if `value` is classified as a typed array.
 *
 * @static
 * @memberOf _
 * @since 3.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
 * @example
 *
 * _.isTypedArray(new Uint8Array);
 * // => true
 *
 * _.isTypedArray([]);
 * // => false
 */
var isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;

module.exports = isTypedArray;

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/** Used as references for various `Number` constants. */
var MAX_SAFE_INTEGER = 9007199254740991;

/**
 * Checks if `value` is a valid array-like length.
 *
 * **Note:** This method is loosely based on
 * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
 * @example
 *
 * _.isLength(3);
 * // => true
 *
 * _.isLength(Number.MIN_VALUE);
 * // => false
 *
 * _.isLength(Infinity);
 * // => false
 *
 * _.isLength('3');
 * // => false
 */
function isLength(value) {
  return typeof value == 'number' && value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
}

module.exports = isLength;

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var isArray = __webpack_require__(14),
    isSymbol = __webpack_require__(35);

/** Used to match property names within property paths. */
var reIsDeepProp = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,
    reIsPlainProp = /^\w*$/;

/**
 * Checks if `value` is a property name and not a property path.
 *
 * @private
 * @param {*} value The value to check.
 * @param {Object} [object] The object to query keys on.
 * @returns {boolean} Returns `true` if `value` is a property name, else `false`.
 */
function isKey(value, object) {
  if (isArray(value)) {
    return false;
  }
  var type = typeof value === 'undefined' ? 'undefined' : _typeof(value);
  if (type == 'number' || type == 'symbol' || type == 'boolean' || value == null || isSymbol(value)) {
    return true;
  }
  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) || object != null && value in Object(object);
}

module.exports = isKey;

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var baseGetTag = __webpack_require__(18),
    isObjectLike = __webpack_require__(19);

/** `Object#toString` result references. */
var symbolTag = '[object Symbol]';

/**
 * Checks if `value` is classified as a `Symbol` primitive or object.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.
 * @example
 *
 * _.isSymbol(Symbol.iterator);
 * // => true
 *
 * _.isSymbol('abc');
 * // => false
 */
function isSymbol(value) {
    return (typeof value === 'undefined' ? 'undefined' : _typeof(value)) == 'symbol' || isObjectLike(value) && baseGetTag(value) == symbolTag;
}

module.exports = isSymbol;

/***/ }),
/* 36 */,
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var ListCache = __webpack_require__(20),
    stackClear = __webpack_require__(62),
    stackDelete = __webpack_require__(63),
    stackGet = __webpack_require__(64),
    stackHas = __webpack_require__(65),
    stackSet = __webpack_require__(66);

/**
 * Creates a stack cache object to store key-value pairs.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function Stack(entries) {
  var data = this.__data__ = new ListCache(entries);
  this.size = data.size;
}

// Add methods to `Stack`.
Stack.prototype.clear = stackClear;
Stack.prototype['delete'] = stackDelete;
Stack.prototype.get = stackGet;
Stack.prototype.has = stackHas;
Stack.prototype.set = stackSet;

module.exports = Stack;

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Performs a
 * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
 * comparison between two values to determine if they are equivalent.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to compare.
 * @param {*} other The other value to compare.
 * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
 * @example
 *
 * var object = { 'a': 1 };
 * var other = { 'a': 1 };
 *
 * _.eq(object, object);
 * // => true
 *
 * _.eq(object, other);
 * // => false
 *
 * _.eq('a', 'a');
 * // => true
 *
 * _.eq('a', Object('a'));
 * // => false
 *
 * _.eq(NaN, NaN);
 * // => true
 */
function eq(value, other) {
  return value === other || value !== value && other !== other;
}

module.exports = eq;

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(global) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/** Detect free variable `global` from Node.js. */
var freeGlobal = (typeof global === 'undefined' ? 'undefined' : _typeof(global)) == 'object' && global && global.Object === Object && global;

module.exports = freeGlobal;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(68)))

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/** Used for built-in method references. */
var funcProto = Function.prototype;

/** Used to resolve the decompiled source of functions. */
var funcToString = funcProto.toString;

/**
 * Converts `func` to its source code.
 *
 * @private
 * @param {Function} func The function to convert.
 * @returns {string} Returns the source code.
 */
function toSource(func) {
  if (func != null) {
    try {
      return funcToString.call(func);
    } catch (e) {}
    try {
      return func + '';
    } catch (e) {}
  }
  return '';
}

module.exports = toSource;

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var SetCache = __webpack_require__(86),
    arraySome = __webpack_require__(89),
    cacheHas = __webpack_require__(90);

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1,
    COMPARE_UNORDERED_FLAG = 2;

/**
 * A specialized version of `baseIsEqualDeep` for arrays with support for
 * partial deep comparisons.
 *
 * @private
 * @param {Array} array The array to compare.
 * @param {Array} other The other array to compare.
 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
 * @param {Function} customizer The function to customize comparisons.
 * @param {Function} equalFunc The function to determine equivalents of values.
 * @param {Object} stack Tracks traversed `array` and `other` objects.
 * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
 */
function equalArrays(array, other, bitmask, customizer, equalFunc, stack) {
  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,
      arrLength = array.length,
      othLength = other.length;

  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {
    return false;
  }
  // Assume cyclic values are equal.
  var stacked = stack.get(array);
  if (stacked && stack.get(other)) {
    return stacked == other;
  }
  var index = -1,
      result = true,
      seen = bitmask & COMPARE_UNORDERED_FLAG ? new SetCache() : undefined;

  stack.set(array, other);
  stack.set(other, array);

  // Ignore non-index properties.
  while (++index < arrLength) {
    var arrValue = array[index],
        othValue = other[index];

    if (customizer) {
      var compared = isPartial ? customizer(othValue, arrValue, index, other, array, stack) : customizer(arrValue, othValue, index, array, other, stack);
    }
    if (compared !== undefined) {
      if (compared) {
        continue;
      }
      result = false;
      break;
    }
    // Recursively compare arrays (susceptible to call stack limits).
    if (seen) {
      if (!arraySome(other, function (othValue, othIndex) {
        if (!cacheHas(seen, othIndex) && (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {
          return seen.push(othIndex);
        }
      })) {
        result = false;
        break;
      }
    } else if (!(arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {
      result = false;
      break;
    }
  }
  stack['delete'](array);
  stack['delete'](other);
  return result;
}

module.exports = equalArrays;

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseIsArguments = __webpack_require__(104),
    isObjectLike = __webpack_require__(19);

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/** Built-in value references. */
var propertyIsEnumerable = objectProto.propertyIsEnumerable;

/**
 * Checks if `value` is likely an `arguments` object.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an `arguments` object,
 *  else `false`.
 * @example
 *
 * _.isArguments(function() { return arguments; }());
 * // => true
 *
 * _.isArguments([1, 2, 3]);
 * // => false
 */
var isArguments = baseIsArguments(function () {
    return arguments;
}()) ? baseIsArguments : function (value) {
    return isObjectLike(value) && hasOwnProperty.call(value, 'callee') && !propertyIsEnumerable.call(value, 'callee');
};

module.exports = isArguments;

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = function (module) {
	if (!module.webpackPolyfill) {
		module.deprecate = function () {};
		module.paths = [];
		// module.parent = undefined by default
		if (!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function get() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function get() {
				return module.i;
			}
		});
		module.webpackPolyfill = 1;
	}
	return module;
};

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/** Used as references for various `Number` constants. */
var MAX_SAFE_INTEGER = 9007199254740991;

/** Used to detect unsigned integer values. */
var reIsUint = /^(?:0|[1-9]\d*)$/;

/**
 * Checks if `value` is a valid array-like index.
 *
 * @private
 * @param {*} value The value to check.
 * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
 * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
 */
function isIndex(value, length) {
  var type = typeof value === 'undefined' ? 'undefined' : _typeof(value);
  length = length == null ? MAX_SAFE_INTEGER : length;

  return !!length && (type == 'number' || type != 'symbol' && reIsUint.test(value)) && value > -1 && value % 1 == 0 && value < length;
}

module.exports = isIndex;

/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Creates a unary function that invokes `func` with its argument transformed.
 *
 * @private
 * @param {Function} func The function to wrap.
 * @param {Function} transform The argument transform.
 * @returns {Function} Returns the new function.
 */
function overArg(func, transform) {
  return function (arg) {
    return func(transform(arg));
  };
}

module.exports = overArg;

/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isObject = __webpack_require__(15);

/**
 * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` if suitable for strict
 *  equality comparisons, else `false`.
 */
function isStrictComparable(value) {
  return value === value && !isObject(value);
}

module.exports = isStrictComparable;

/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * A specialized version of `matchesProperty` for source values suitable
 * for strict equality comparisons, i.e. `===`.
 *
 * @private
 * @param {string} key The key of the property to get.
 * @param {*} srcValue The value to match.
 * @returns {Function} Returns the new spec function.
 */
function matchesStrictComparable(key, srcValue) {
  return function (object) {
    if (object == null) {
      return false;
    }
    return object[key] === srcValue && (srcValue !== undefined || key in Object(object));
  };
}

module.exports = matchesStrictComparable;

/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var castPath = __webpack_require__(49),
    toKey = __webpack_require__(25);

/**
 * The base implementation of `_.get` without support for default values.
 *
 * @private
 * @param {Object} object The object to query.
 * @param {Array|string} path The path of the property to get.
 * @returns {*} Returns the resolved value.
 */
function baseGet(object, path) {
  path = castPath(path, object);

  var index = 0,
      length = path.length;

  while (object != null && index < length) {
    object = object[toKey(path[index++])];
  }
  return index && index == length ? object : undefined;
}

module.exports = baseGet;

/***/ }),
/* 49 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isArray = __webpack_require__(14),
    isKey = __webpack_require__(34),
    stringToPath = __webpack_require__(130),
    toString = __webpack_require__(133);

/**
 * Casts `value` to a path array if it's not one.
 *
 * @private
 * @param {*} value The value to inspect.
 * @param {Object} [object] The object to query keys on.
 * @returns {Array} Returns the cast property path array.
 */
function castPath(value, object) {
  if (isArray(value)) {
    return value;
  }
  return isKey(value, object) ? [value] : stringToPath(toString(value));
}

module.exports = castPath;

/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(17);
__webpack_require__(0);
__webpack_require__(3);
__webpack_require__(4);
__webpack_require__(5);
__webpack_require__(51);
__webpack_require__(52);
__webpack_require__(11);
__webpack_require__(53);
__webpack_require__(54);
__webpack_require__(6);
__webpack_require__(7);
__webpack_require__(8);
__webpack_require__(9);
__webpack_require__(144);
__webpack_require__(145);
__webpack_require__(146);
__webpack_require__(147);
__webpack_require__(148);
__webpack_require__(149);
__webpack_require__(150);
__webpack_require__(151);
__webpack_require__(152);
__webpack_require__(12);
__webpack_require__(153);
__webpack_require__(154);
__webpack_require__(155);
__webpack_require__(156);
__webpack_require__(10);
__webpack_require__(157);
module.exports = __webpack_require__(158);


/***/ }),
/* 51 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.auth", ["ngResource", "app.localize", "app.controllers", "vdi.user"]).factory("UserAuth", ["$resource", "$rootScope", "$Domain", function ($resource, $root, $Domain) {
    console.log($Domain);
    return $resource($Domain + "/login", null, {
        precheck: { method: "GET", url: $Domain + "/thor/home/system_check" },
        login: { method: "POST", isArray: false },
        logout: {
            method: "GET", isArray: false,
            url: $Domain + "/logout",
            transformRequest: function transformRequest() {
                // TODO: 修改
                // 这里先获取了部分缓存，然后清空缓存，再保存部分缓存
                var theme = $$$storage.getSessionStorage('current_theme') || "smart-style-0";
                var lang_code = $$$storage.getSessionStorage('lang_code') || "e-vdi";
                var dev_host;
                if ($$$storage.getSessionStorage('dev_host')) {
                    dev_host = $$$storage.getSessionStorage('dev_host');
                }
                $$$storage.clearSessionStorage();
                $$$storage.setSessionStorage('current_theme', theme);
                $$$storage.setSessionStorage('lang_code', lang_code);
                if (dev_host) {
                    $$$storage.setSessionStorage('dev_host', dev_host);
                }
                $root.$broadcast("NOAUTH");
            }
        }
    });
}]).factory("init", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/init", null, {
        get_language: { method: "GET", url: $Domain + "/thor/init/record_lang" },
        get_version: { method: "GET", url: $Domain + "/thor/init/lang" }
    });
}]).controller("loginController", ["$scope", "loginResource", "localize", "settings", "$Domain", "$$$version", "$$$I18N", "$$$MSG", "UserAuth", "UserRole", "$rootScope", "init", "$$$UserRoles", function ($scope, loginresource, localize, settings, $Domain, $$$version, $$$I18N, $$$MSG, Auth, Role, $root, init, $$$UserRoles) {
    $scope.$on("changeSkin", function (e, value) {
        $scope.current_theme = value;
    });
    $scope.showLoginScreen = !Role.logined;
    $scope.$on("NOAUTH", function () {
        $scope.showLoginScreen = true;
    });
    $scope.$on("AUTHED", function () {
        $scope.showLoginScreen = false;
    });
    $scope.domain = $Domain;
    $scope.langversion = $$$version;
    //document.title = $$$I18N.get("TITLE_NAME")
    loginresource.query(function (res) {
        $scope.version = res.version;
    });
    $scope.current_theme = $$$storage.getSessionStorage('current_theme') || "smart-style-0";
    $scope.getCurrLang = function () {
        $scope.currentLang = settings.languages.filter(function (l) {
            return l.langCode === $$$storage.getSessionStorage('lang_code');
        })[0];
    };
    init.get_version(function (res) {
        $$$storage.setSessionStorage('lang_code', res.current_lang_type);
        $scope.getCurrLang();
        localize.setLang($scope.currentLang);
    });
    // init.get_language(function(res){
    //        localStorage.lang_code = settings.languages.reduce(function(langCode, l){
    //            if(res.language === l.langCode){
    //                return res.language;
    //            }
    //            return langCode;
    //        }, localStorage.lang_code || settings.languages[0].langCode);
    // 	$scope.getCurrLang();
    // 	localize.setLang($scope.currentLang);
    // });

    // $scope.getCurrLang();
    // localize.setLang($scope.currentLang);

    $scope.login = function () {
        var self = this;
        var data = {
            username: self.username,
            password: self.password
        };
        self.loading = true;
        Auth.precheck().$promise.then(function () {
            return Auth.login(data, function (res) {
                // test--
                // res.user.keys = "Summary,Resource,Console,Pool,Storage,Network,ManageNetwork,VirtualSwitch,DataNetwork,DHCP,Desktop,Teaching_desktop,Personal_desktop,Personal_desktop_pool,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Alarm_policy,Timetable,Course_list,Plan,Timer_switch,Host_switch,HA,desktop_ha,System,System_deploy,System_desktop,System_backup,System_ISO,USB_redirection,USB_through,AutoSnapshot,System_set,System_upgrade,Operation_log,About";
                $$$storage.setSessionStorage('loginInfo', JSON.stringify(res.user));
                $$$storage.setSessionStorage('power', res.user.keys || $$$UserRoles);
                $$$storage.setSessionStorage('userId', res.user.id);
                $root.$broadcast("AUTHED", res.user);
                // 清空输入的用户信息
                self.username = self.password = "";
                var dms = res.source && res.source.dms && res.source.dms !== '' ? 'http://' + res.source.dms : 'nodms';
                $root.$broadcast("DMS", dms);
                $$$storage.setSessionStorage('DMS', dms);
            }).$promise;
        }).finally(function () {
            self.loading = false;
        });
    };

    // $("#login-form").on("submit", function(e){
    // 	e.preventDefault();
    //     console.log(123);
    // 	if(this.username.value && this.password.value){
    // 		$.ajax($Domain + "/login", {
    // 			method: "POST",
    // 			data: JSON.stringify({
    // 				username: this.username.value,
    // 				password: this.password.value
    // 			}),
    // 			xhrFields: {
    // 				withCredentials: true
    // 			},
    // 			crossDomain: true
    // 		}).promise().then(
    // 			function(res){
    // 				if(res.code === 0){
    // 					localStorage.loginInfo = JSON.stringify(res.user);
    // 					var powers = "Summary,Resource,Host,Network,Storage,Desktop,Teaching_desktop,Personal_desktop,Template,Teaching_template,Personal_template,Hardware_template,Terminal,Classroom,Terminal_Manage,User,Role_Manage,Administrator,Common_user,Domain_user,Monitor,Host_monitoring,Desktop_monitoring,Alarm_information,Timetable,Course_list,System,System_backup,System_ISO,USB_redirection,System_upgrade,Operation_log,About";
    // 					localStorage["power"] = res.user.keys || powers;

    // 					//location.replace(localStorage.returnUrl || "index.html");
    // 				}
    // 				else{
    // 					$.bigBox({
    // 						title : $$$MSG.get("PAI_CODE") + res.code,
    // 						content : $$$MSG.get(res.code),
    // 						color : "#C46A69",
    // 						icon : "fa fa-warning shake animated",
    // 						timeout : 6000
    // 					});
    // 				}
    // 			},
    // 			function(err){

    // 			}
    // 		);
    // 	}else if(!this.username.value){
    // 		this.username.focus();
    // 	}else{
    // 		this.password.focus();
    // 	}
    // });
}]).run([function () {
    console.log("running auth module");
}]).config([function () {
    console.log("config auth module");
}]);

/***/ }),
/* 52 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.summary", []).factory("Summary", ["$resource", function ($resource) {
    return $resource("/thor/home", null, {
        query: { method: "GET", isArray: false, url: "/thor/home", params: { uuid: "@uuid" } },
        top_logs: { method: "GET", isArray: false, url: "/thor/home/top_logs" },
        top_instance: { method: "GET", isArray: false, url: "/thor/home/top_instance", params: { uuid: "@uuid" } },
        top_client: { method: "GET", isArray: false, url: "/thor/home/top_client" }
    });
}]).controller("vdiSummaryController", ["$scope", "Summary", "$$$I18N", "ResourcePool", function ($scope, summary, $$$I18N, ResourcePool) {

    ResourcePool.query(function (res) {
        $scope.pools = res.result.sort(function (a, b) {
            return a.name > b.name ? 1 : -1;
        });
        // $scope.pool = $scope.pools.filter(function(p){ return p.name==="default"})[0];
        $scope.pool = {};
        $scope.get_host($scope.pool.uuid);
    });

    summary.top_logs(function (res) {
        $scope.top_logs_list = res.result.sort(function (a, b) {
            return b.datetime - a.datetime;
        });
    });
    $scope.get_host = function (id) {
        $scope.loading = true;
        summary.query({ uuid: id }, function (res) {
            $scope.loading = false;
            $scope.summary = res.info;
            $scope.cpu_rate = $scope.summary.cpu_rate.toFixed(1);
            var mem_data = [{
                'name': $$$I18N.get("已使用"),
                'y': parseInt(($scope.summary.mem_used / $scope.summary.memory_cnt * 100).toFixed(2))
            }, {
                'name': $$$I18N.get("剩余"),
                'y': parseInt(($scope.summary.mem_remain / $scope.summary.memory_cnt * 100).toFixed(2))
            }];
            var disk_data = [{
                'name': $$$I18N.get("已使用"),
                'y': parseInt(($scope.summary.disk_used / $scope.summary.disk_cnt * 100).toFixed(2))
            }, {
                'name': $$$I18N.get("剩余"),
                'y': parseInt(($scope.summary.disk_remain / $scope.summary.disk_cnt * 100).toFixed(2))
            }];
            //饼图开始
            angular.element("#3Dmemory").highcharts({
                chart: {
                    type: 'pie',
                    height: 170,
                    spacing: [0, 0, 0, 0],
                    backgroundColor: '#fafafa',
                    options3d: {
                        enabled: true,
                        alpha: 45,
                        beta: 0
                    }
                },
                title: {
                    text: null
                },
                credits: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        depth: 35,
                        dataLabels: {
                            enabled: false,
                            format: ''
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: $$$I18N.get("内存"),
                    data: mem_data
                }]
            });
            angular.element("#3Ddisk").highcharts({
                chart: {
                    type: 'pie',
                    height: 170,
                    backgroundColor: '#fafafa',
                    spacing: [0, 0, 0, 0],
                    options3d: {
                        enabled: true,
                        alpha: 45,
                        beta: 0
                    }
                },
                title: {
                    text: null
                },
                credits: {
                    enabled: false
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        depth: 35,
                        dataLabels: {
                            enabled: false,
                            format: ''
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: $$$I18N.get("存储"),
                    data: disk_data
                }]
            });
            //饼图结束  
        });

        // 桌面
        summary.top_instance({ uuid: id }, function (res) {

            $scope.instances_summary = res.instances_summary;

            $scope.top_instances_list = res.top_instances_list;
        });
    };

    $scope.view_desktop = function (id) {
        window.open("desktopScreenshot.html#" + id, "person_desktop_" + id);
    };
}]);

/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.schoolroom", []).factory("SchoolRoom", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/pools", null, {
		query: { method: "GET", isArray: false },
		querywithSimple: { method: "GET", url: $Domain + "/thor/pools?simple=true", isArray: false },
		save: { method: "POST", url: $Domain + "/thor/pool" },
		"delete": { method: "DELETE" },
		update: { method: "PUT", url: $Domain + "/thor/pool" },
		sendMessage: { method: "POST", url: $Domain + "/thor/pools/:id/message", params: { "id": "@id" } },
		closeMessage: { method: "DELETE", url: $Domain + "/thor/pools/:id/message", params: { "id": "@id" } }
	});
}]).factory('ResourcePool', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/resource", null, {
		query: { method: "GET" },
		add: { method: "POST" },
		delete: { method: "DELETE", url: $Domain + "/thor/resource", params: null },
		edit: { method: "PUT" }
	});
}]).controller("vdiTerminalSchoolroomManageController", ["$scope", "SchoolRoom", "$modal", "$$$I18N", "UserRole", function ($scope, schoolroom, $modal, $$$I18N, UserRole) {
	var user = UserRole.currentUser;
	if (!user) {
		return;
	}
	$scope.rows = [];
	// $scope.allRows = [];
	var _controllerScope = $scope;$scope.loading = true;
	$scope.owner = UserRole.isOwner;

	function getList() {
		schoolroom.query(function (res) {
			if ($scope.owner) {
				$scope.rows = res.pools_.sort(function (a, b) {
					if (a.name === 'default') {
						return -1;
					} else if (b.name === 'default') {
						return 1;
					};
					return 0;
				});
			} else {
				var schoolrooms = [];
				res.pools_.forEach(function (item) {
					if (item.user_ids.some(function (data) {
						return data === user.id;
					})) {
						schoolrooms.push(item);
					}
				});
				$scope.rows = schoolrooms;
			}
			// angular.copy($scope.rows,$scope.allRows);
			$scope.loading = false;
		});
	}
	getList();

	// $scope.updateData = function(text){
	// 	$scope.rows = $scope.allRows.filter(function(row){
	// 		row._selected = false;
	// 		if(text){
	// 			return row.name.indexOf(text) !== -1;
	// 		}
	// 		return true;
	// 	});
	// };

	$scope.currentPage = 1;
	$scope.pagesize = Number($$$storage.getSessionStorage('schoolroom_pagesize')) || 30;
	$scope.$watch("pagesize", function (newvalue) {
		$scope.pagesize = newvalue || 0;
		$$$storage.setSessionStorage('schoolroom_pagesize', newvalue ? newvalue : 0);
	});

	$scope.delete = function (item) {

		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.id !== 1;
		});
		var nodelete_rows = selected_rows.filter(function (row) {
			if (row.sceneCount != 0 || row.terminalCount != 0) return row;
		});
		var delete_rows = selected_rows.filter(function (row) {
			if (row.sceneCount == 0 && row.terminalCount == 0) return row;
		});

		if (delete_rows.length == 0) $.bigBox({
			title: $$$I18N.get("INFOR_TIP"),
			content: $$$I18N.get("vdiTerminalClientManage_TIP10"),
			timeout: 6000
		});else $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除教室'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:10px;' data-localize='CLASSROOM_TIPGROUP1' param1='{{deleteName}}'></p><p style='margin-bottom:20px;' data-ng-if='nodelete_rows.length!=0' data-localize='CLASSROOM_TIPGROUP2' param1='{{nodeleteName}}'></p><footer class='text-right' style='margin-top:20px;'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.deleteName = delete_rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.nodeleteName = nodelete_rows.map(function (row) {
					return row.name;
				}).join(', ');
				$scope.delete_rows = delete_rows;$scope.nodelete_rows = nodelete_rows;
				$scope.ok = function () {
					schoolroom.delete({
						ids: delete_rows.map(function (row) {
							return row.id;
						})
					}, function () {
						delete_rows.forEach(function (row) {
							_controllerScope.rows.splice(_controllerScope.rows.indexOf(row), 1);
						});
						$modalInstance.close();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	$scope.changeClass = function (item) {
		$$$storage.setSessionStorage('classroom', item.id);
	};

	$scope.onlyOneItem = function () {
		var selectedLength = $scope.rows.filter(function (item) {
			return item._selected;
		}).length;
		return selectedLength == 1;
	};
	$scope.selectNoDefault = function () {
		var _length = $scope.rows.filter(function (item) {
			return item._selected && item.id !== 1;
		}).length;
		return _length;
	};
	$scope.sendMessage = function () {
		var selected_row = $scope.rows.filter(function (row) {
			return row._selected;
		})[0];
		$modal.open({
			templateUrl: "views/vdi/dialog/terminal/sendMessage.html",
			controller: function controller($scope, $modalInstance) {
				$scope.data = {};
				if (selected_row.message != '') {
					$scope.data.message = selected_row.message;
				}
				$scope.isUnchanged = function () {
					return angular.equals($scope.data.message, selected_row.message);
				};
				$scope.ok = function () {
					schoolroom.sendMessage({
						id: selected_row.id,
						message: $scope.data.message
					}, function () {
						$modalInstance.close();
						getList();
					}, function () {});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "md"
		});
	};

	$scope.closeMessage = function () {
		var selected_rows = $scope.rows.filter(function (row) {
			return row._selected;
		});
		var message = selected_rows[0].message;
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关闭消息'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-if='message' data-localize='closeMessage'></p><p ng-if='message' style='margin-bottom:20px;'><span data-localize='消息内容'></span>：{{ message }}</p><p ng-if='!message' data-localize='无消息'></p><footer class='text-right'><button class='btn btn-primary' ng-disabled='!message' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.message = message;
				$scope.ok = function () {
					schoolroom.closeMessage({
						id: selected_rows[0].id
					}, function () {
						$modalInstance.close();
						getList();
					}, function () {});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("editSchoolroomDialog", ["$scope", "$modalInstance", "SchoolRoom", "Network", "Admin", "$$$I18N", "ResourcePool", "UserRole", function ($scope, $modalInstance, sc, network, admin, $$$I18N, ResourcePool, UserRole) {
	var user = UserRole.currentUser;
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	var item = $scope.item || $scope.currentItem;
	$scope.data = angular.copy(item);

	$scope.is_default = item.name === 'default' ? true : false;
	// console.log(333333333,item)
	// ResourcePool.query(function(res){
	// 	$scope.resources = res.result;
	// 	$scope.data.resource = $scope.resources.filter(function(data){ return data.id === $scope.data.resource_pool_id })[0];
	// });
	function getSubnets(Network) {
		if (Network) {
			$scope.network_loading = true;
			network.query_sub({ id: Network.id }, function (res) {
				$scope.subnets = res.result;
				$scope.data.subnet = $scope.subnets.filter(function (data) {
					return data.id === $scope.data.subnet_id;
				})[0];
				$scope.network_loading = false;
			});
		}
	};
	network.query(function (data) {
		$scope.networks = data.networks.filter(function (item) {
			return item.subnets.length !== 0;
		});
		$scope.data.network = $scope.networks.filter(function (data) {
			return data.id === $scope.data.network_id;
		})[0];
		getSubnets($scope.data.network);
	});
	$scope.switchSubnet = function (val) {
		getSubnets(val);
	};
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.isUnchanged = function () {
		if ($scope.data.network && $scope.data.subnet) {
			return $scope.data.name === item.name && $scope.data.desc === item.desc && $scope.data.ip_start === item.ip_start && $scope.data.ip_end === item.ip_end && $scope.data.network.id === item.network_id && $scope.data.subnet.id === item.subnet_id;
			// return $scope.data.name===item.name && $scope.data.desc===item.desc && $scope.data.ip_start===item.ip_start && $scope.data.ip_end===item.ip_end && $scope.data.resource.id===item.resource_pool_id && $scope.data.network.id===item.network_id && $scope.data.subnet.id===item.subnet_id;
		}
	};
	$scope.reset = function () {
		$scope.data = angular.copy(item);
		// $scope.data.resource = $scope.resources.filter(function(data){ return data.id === item.resource_pool_id })[0];
		$scope.data.network = $scope.networks.filter(function (data) {
			return data.id === item.network_id;
		})[0];
		getSubnets($scope.data.network);
	};

	var ids = [];
	admin.query(function (res) {
		ids = res.users.filter(function (item) {
			return item.permission === 'Administrator';
		}).map(function (item) {
			return item.id;
		});
	});
	var _id;
	var _controllerScope = $scope;
	$scope.edit = function () {
		_id = this.data.id;
		sc.update({
			"id": this.data.id,
			"name": this.data.name,
			"desc": this.data.desc,
			// "resource_pool_id": this.data.resource.uuid,
			"network_id": this.data.network.id,
			"subnet_id": this.data.subnet.id,
			"ip_start": this.data.ip_start || '',
			"ip_end": this.data.ip_end || ''
		}, function (res) {
			if (res.id == _id) {
				sc.query(function (res) {
					if ($scope.owner) {
						var newRows = res.pools_.sort(function (a, b) {
							if (a.name === 'default') {
								return -1;
							} else if (b.name === 'default') {
								return 1;
							};
							return 0;
						});
						_controllerScope.rows.splice(0, _controllerScope.rows.length);
						Array.prototype.push.apply(_controllerScope.rows, newRows);
					} else {
						var schoolrooms = [];
						res.pools_.forEach(function (item) {
							if (item.user_ids.some(function (data) {
								return data === user.id;
							})) {
								schoolrooms.push(item);
							}
						});
						var newRows = schoolrooms;
						_controllerScope.rows.splice(0, _controllerScope.rows.length);
						Array.prototype.push.apply(_controllerScope.rows, newRows);
					}
					$scope.loading = false;
				});
				$modalInstance.close();
			} else {
				$.bigBox({
					title: $$$I18N.get("INFOR_TIP"),
					content: $$$I18N.get("教室重复").replace("XXX", res.name),
					color: "#C46A69",
					icon: "fa fa-warning shake animated",
					timeout: 6000
				});
			}
		}, function () {});
	};
}]).controller("addSchoolroomDialog", ["$scope", "$modalInstance", "SchoolRoom", "Network", "Admin", "$$$I18N", "UserRole", "ResourcePool", function ($scope, $modalInstance, schoolroom, network, admin, $$$I18N, UserRole, ResourcePool) {
	var user = UserRole.currentUser;
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.data = {};
	$scope.master = {};

	var ids = [];
	admin.query(function (res) {
		ids = res.users.filter(function (item) {
			return item.permission === 'Administrator';
		}).map(function (item) {
			return item.id;
		});
	});
	// ResourcePool.query(function(res){
	// 	$scope.resources = res.result;
	// 	$scope.data.resource = $scope.resources[0];
	// });
	function getSubnets(Network) {
		$scope.network_loading = true;
		network.query_sub({ id: Network.id }, function (res) {
			$scope.subnets = res.result;
			$scope.data.subnet = $scope.subnets[0];
			$scope.network_loading = false;
		});
	};
	network.query(function (data) {
		$scope.networks = data.networks.filter(function (item) {
			return item.subnets.length !== 0;
		});
		$scope.data.network = $scope.networks[0];
		getSubnets($scope.data.network);
	});
	$scope.switchSubnet = function (val) {
		getSubnets(val);
	};
	var _controllerScope = $scope;
	$scope.ok = function () {
		var _this = this;
		schoolroom.save({
			"name": this.data.name,
			"desc": this.data.desc,
			// "resource_pool_id": this.data.resource.uuid,
			"subnet_id": this.data.subnet.id,
			"network_id": this.data.network.id,
			"user_ids": ids,
			"ip_start": this.data.ip_start || '',
			"ip_end": this.data.ip_end || ''
		}, function (data) {
			if (!data.name || data.name == _this.data.name) {
				schoolroom.query(function (res) {
					if ($scope.owner) {
						var newRows = res.pools_.sort(function (a, b) {
							if (a.name === 'default') {
								return -1;
							} else if (b.name === 'default') {
								return 1;
							};
							return 0;
						});
						_controllerScope.rows.splice(0, _controllerScope.rows.length);
						Array.prototype.push.apply(_controllerScope.rows, newRows);
					} else {
						var schoolrooms = [];
						res.pools_.forEach(function (item) {
							if (item.user_ids.some(function (data) {
								return data === user.id;
							})) {
								schoolrooms.push(item);
							}
						});
						var newRows = schoolrooms;
						_controllerScope.rows.splice(0, _controllerScope.rows.length);
						Array.prototype.push.apply(_controllerScope.rows, newRows);
					}
					$scope.loading = false;
				});
				var logInfor = UserRole.currentUser;
				logInfor.pool = logInfor.pool.concat(data.id);
				$$$storage.setSessionStorage('loginInfo', JSON.stringify(logInfor));
				$modalInstance.close();
			} else {
				$.bigBox({
					title: $$$I18N.get("INFOR_TIP"),
					content: $$$I18N.get("教室重复").replace("XXX", data.name),
					color: "#C46A69",
					icon: "fa fa-warning shake animated",
					timeout: 6000
				});
			}
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.reset = function () {
		$scope.data = angular.copy($scope.master);
	};
	$scope.isUnchanged = function () {
		return angular.equals($scope.master, $scope.data);
	};
}]);

/***/ }),
/* 54 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.terminal", []).factory("Session", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/client/session", null, {
		query: { method: "GET", url: $Domain + "/thor/client/session", isArray: false },

		"delete": { method: "DELETE" }

	});
}]).factory("Client", ["$resource", "$Domain", function ($resource, $Domain) {
	var res = $resource($Domain + "/thor/client", { id: "@id" }, {
		query: { method: "GET", isArray: false, url: $Domain + "/thor/clients" },
		list: { method: "GET", isArray: false, url: $Domain + "/thor/client/pool/:id" },
		"delete": { method: "DELETE", url: $Domain + "/thor/clients" },
		get: { method: "GET", url: $Domain + "/thor/client/:id" },
		getConfig: { method: "GET", url: $Domain + "/thor/client/config/:id", params: { "id": "@id" } },
		alive: { method: "GET", url: $Domain + "/thor/client/alive" },
		assignIps: { method: "POST", url: $Domain + "/thor/clients" },
		modifyConfig: { method: "POST", url: $Domain + "/thor/client/config" },
		changeNames: { method: "POST", url: $Domain + "/thor/client/changeNames" },
		changePools: { method: "POST", url: $Domain + "/thor/client/changePools" },
		shutdowns: { method: "POST", url: $Domain + "/thor/clients" },
		seePwd: { method: "GET", url: $Domain + "/thor/client/seePwd" },
		wakeups: { method: "POST", url: $Domain + "/thor/clients" },
		killSessions: { method: "DELETE", url: $Domain + "/thor/client/session" },
		polling: { method: "GET", url: $Domain + "/thor/client/order" }, //轮询
		sorting: { method: "POST", url: $Domain + "/thor/client/order" }, //开始排序
		setPlaceholder: { method: "PUT", url: $Domain + "/thor/client/order" }, //设置占位
		cancelsort: { method: "DELETE", url: $Domain + "/thor/client/order" }, //取消排序
		dynamicPasswd: { method: "POST", url: $Domain + "/thor/client/get_dynamic_passwd_for_client" }

	});
	return res;
}]).controller("vdiTerminalClientManageController", ["$scope", "$modal", "Client", "SchoolRoom", "$interval", "$filter", "$$$I18N", "UserRole", "$location", function ($scope, $modal, client, schoolroom, $interval, $filter, $$$I18N, UserRole, $location) {
	// let hasDesktop = UserRole.currentUserRoles.filter(function(role){ return role=='Desktop' }).length;
	// let hasDesktopTech = UserRole.currentUserRoles.filter(function(role){ return role=='Teaching_desktop' }).length;
	// let hasDesktopPerson = UserRole.currentUserRoles.filter(function(role){ return role=='Personal_desktop' }).length;
	// $scope.linkTech = hasDesktop && hasDesktopTech ? true:false;
	// $scope.linkPerson = hasDesktop && hasDesktopPerson ? true:false;

	var user = UserRole.currentUser;
	if (!user) {
		return;
	}
	$scope.rows = [];$scope.loading = true;$scope.sorttype = "";var allrows = [];var _allrows = {};var loaded = false;var selectedRows = [];

	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("clientIDS", $filter("paging")($scope.rows, $scope.currentPage, $scope.pagesize).map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("clientsRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (loaded) {
				if (!_allrows[item.id]) {
					var addClient = {};
					for (var i in item) {
						addClient[i] = item[i];
					}
					var _ipClient = addClient.client_ip.split(".");
					addClient._ipClient = (_ipClient[0] << 16) + (_ipClient[1] << 8) + Number(_ipClient[2]) + _ipClient[3] / 1000;
					addClient._ipTarget = null;
					allrows.push(addClient);_allrows[addClient.id] = addClient;
					var storageClassroom = $scope.classrooms.filter(function (cla) {
						return cla.id == $$$storage.getSessionStorage('classroom');
					})[0].name;
					console.log("addClient and storageClassroom", addClient, storageClassroom);
					if (addClient.pool === storageClassroom) {
						$scope.rows.push(addClient);
					}
				}
			}
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
	});
	client.query(function (res) {
		allrows = res.clients;
		// allrows = res.clients.filter(function(item){ return item.order; }).sort(function(a,b){ return a.order>b.order?1:-1; }).concat(res.clients.filter(function(item){ return !item.order; }));
		allrows.forEach(function (item, index) {
			_allrows[item.id] = item;
			if (index === allrows.length - 1) loaded = true;
		});
		schoolroom.querywithSimple(function (res) {

			var schoolrooms = [];
			res.pools_.forEach(function (item) {
				if (item.user_ids.filter(function (data) {
					return data === JSON.parse($$$storage.getSessionStorage('loginInfo')).id;
				}).length !== 0) {
					schoolrooms.push(item);
				}
			});
			$scope.classrooms = schoolrooms;
			var storageClassroom = $scope.classrooms.filter(function (cla) {
				return cla.id == $$$storage.getSessionStorage('classroom');
			})[0];
			var defaultClassroom = $scope.classrooms[0];
			$scope.select = storageClassroom || defaultClassroom;
			if ($location.$$search.client_pool) {
				var selectRoom = $scope.classrooms.filter(function (cla) {
					return cla.id == decodeURIComponent($location.$$search.client_pool);
				})[0];
				$scope.select = selectRoom ? selectRoom : $scope.classrooms[0];
				if ($location.$$search.ip) {
					$scope.searchText = decodeURIComponent($location.$$search.ip);
				}
			}
			$scope.loading = false;
		});
		allrows.forEach(function (row) {
			var _ipClient = row.client_ip.split(".");
			row._ipClient = (_ipClient[0] << 16) + (_ipClient[1] << 8) + Number(_ipClient[2]) + _ipClient[3] / 1000;
			var _ipTarget;
			if (row.target_ip !== null) {
				_ipTarget = row.target_ip.split(".");
				row._ipTarget = (_ipTarget[0] << 16) + (_ipTarget[1] << 8) + Number(_ipTarget[2]) + _ipTarget[3] / 1000;
			} else {
				_ipTarget = null;
				row._ipTarget = null;
			}
		});
		$scope.running = res.running;
		$scope.shutoff = res.shutoff;
	});
	$scope.$watch("select", function (newvalue) {
		if (newvalue) {
			selectedRows = $scope.rows = allrows.filter(function (item) {
				return item.pool == newvalue.name;
			});
			$$$storage.setSessionStorage('classroom', newvalue.id);
		}
	});
	$scope.updateData = function (text, select) {
		$scope.rows = selectedRows.filter(function (row) {
			row._selected = false;
			if (select) {
				if (text) {
					return row.pool === select.name;
				}
				return row.pool === select.name;
			}
			return true;
		});
	};

	$scope.selecteds = [];
	$scope.addselect = function (item) {
		$scope.selecteds.push(item);
	};
	$scope.sortClientIP = function (order) {
		$scope.rows.sort(function (a, b) {
			return a._ipClient > b._ipClient ? 1 : -1;
		});
		if (order) {
			$scope.rows.reverse();
		}
	};
	$scope.sortClientType = function (order) {
		$scope.rows.forEach(function (item) {
			if (item.client_type === 97) {
				item._client_type = 'android';
			} else if (item.client_type === 98) {
				item._client_type = 'arm';
			} else if (item.client_type === 99) {
				item._client_type = 'linux';
			} else if (item.client_type === 1) {
				item._client_type = 'windows';
			} else {}
		});
		$scope.rows.sort(function (a, b) {
			return a._client_type > b._client_type ? 1 : -1;
		});
		if (order) {
			$scope.rows.reverse();
		}
	};
	$scope.instNameSort = function (name, bool) {
		console.log(11111, bool);
		var reg = /\d*$/;
		$scope.rows.sort(function (a, b) {
			var num_a = a.inst_display_name ? Number(a.inst_display_name.match(reg)[0]) : -2;
			var num_b = b.inst_display_name ? Number(b.inst_display_name.match(reg)[0]) : -2;
			return num_a > num_b ? -1 : 1;
		});
		if (bool) {
			$scope.rows.reverse();
		}
	};
	$scope.sortTargetIP = function (order) {
		$scope.rows.sort(function (a, b) {
			if (a._ipTarget === null) return 2;
			if (a._ipTarget != null && b._ipTarget != null && a._ipTarget > b._ipTarget) return 1;
			if (a._ipTarget != null && b._ipTarget != null && a._ipTarget <= b._ipTarget) return -1;
		});
		if (order) {
			$scope.rows.reverse();
		}
	};

	$scope.currentPage = 1;
	$scope.pagesize = Number($$$storage.getSessionStorage('terminal_pagesize')) || 30;
	$scope.$watch("pagesize", function (newvalue) {
		$scope.pagesize = newvalue || 0;
		$$$storage.setSessionStorage('terminal_pagesize', newvalue ? newvalue : 0);
	});

	$scope.selectUp = function () {
		var rows = $scope.rows;
		return rows.some(function (row) {
			return row._selected && row.is_up;
		});
	};

	$scope.clientbind = function (item) {
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
	};

	$scope.clientManualSort = function (item) {
		$scope.sorttype = "manual";
		// $scope.selected_rows = $scope.rows;
		$scope.selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
	};

	$scope.clientAutoSort = function (item) {
		$scope.sorttype = "auto";
		$scope.selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
	};
	$scope.configure = function (item) {
		$scope.isSingle = false;
		var ables = 0;
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (item.is_up == true) ables++;
		});
		if (ables != selected_rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiTerminalconfigure_TIP"),
				timeout: 6000
			});
		}
	};
	$scope.setSingle = function (flag) {
		$scope.isSingle = flag;
	};
	$scope.configurename = function (item) {
		var ables = 0;
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (item.is_up == true) ables++;
		});
		if (ables != selected_rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiTerminalconfigureName_TIP"),
				timeout: 6000
			});
		}
		if (selected_rows.length == 1) {
			$modal.open({
				templateUrl: "views/vdi/dialog/terminal/terminal_changename.html",
				controller: "configureNameDialog",
				scope: $scope,
				size: "sm"
			});
		} else {
			$modal.open({
				templateUrl: "views/vdi/dialog/terminal/terminal_configurename_edit.html",
				controller: "configureNameDialog",
				scope: $scope,
				size: "sm"
			});
		}
	};
	$scope.wakeup = function (item) {
		var ables = 0;
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (item.is_up == true) ables++;
		});
		if (ables == selected_rows.length)
			//alert("终端已经唤醒")
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiTerminalClientManage_TIP6"),
				timeout: 6000
			});
		if (ables != selected_rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='唤醒确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CLIENT_TIPGROUP1' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.name = selected_rows.filter(function (row) {
						if (row.is_up == false) return row;
					}).map(function (row) {
						return row.client_name;
					}).join(', ');
					$scope.ok = function () {
						$modalInstance.close();
						client.wakeups({
							"method": "wakeup",
							macs: selected_rows.filter(function (row) {
								if (row.is_up == false) return row;
							}).map(function (row) {
								return row.client_mac;
							}),
							client_names: selected_rows.filter(function (row) {
								if (row.is_up == false) return row;
							}).map(function (row) {
								return row.client_name;
							}),
							ids: selected_rows.filter(function (row) {
								if (row.is_up == false) {
									return row;
								}
							}).map(function (row) {
								return row.id;
							})
						}, function (res) {});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	var _controllerScope = $scope;
	$scope.cancelBindingIp = function (item) {
		var noIP = 0;
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (!item.target_ip) noIP++;
		});
		if (noIP == selected_rows.length) $.bigBox({
			title: $$$I18N.get("INFOR_TIP"),
			content: $$$I18N.get("CANCELIP_TIP"),
			timeout: 6000
		});
		if (noIP != selected_rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='取消桌面IP'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CANCELIP_TIP1' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.name = selected_rows.filter(function (row) {
						if (row.target_ip) return row;
					}).map(function (row) {
						return row.client_name;
					}).join(', ');
					var ids = selected_rows.filter(function (row) {
						if (row.target_ip) return row;
					}).map(function (row) {
						return row.id;
					});
					$scope.ok = function () {
						client.assignIps({
							method: "clearIP",
							client_ids: ids
						}, function (res) {
							_controllerScope.rows.forEach(function (item) {
								if (ids.indexOf(item.id) > -1) {
									item.target_ip = "";
								}
							});
							$modalInstance.close();
						});
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.closeTerminal = function (item) {
		var ables = 0;
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (item.is_up == false) ables++;
		});
		if (ables == selected_rows.length)
			//alert("终端已经关机")
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiTerminalClientManage_TIP7"),
				timeout: 6000
			});
		if (ables != selected_rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='关机确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CLIENT_TIPGROUP2' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-ng-disabled='loading' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' data-ng-disabled='loading' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.name = selected_rows.filter(function (row) {
						if (row.is_up == true) return row;
					}).map(function (row) {
						return row.client_name;
					}).join(', ');
					$scope.ok = function () {
						$scope.loading = true;
						client.shutdowns({
							"method": "shutdown",
							client_ids: selected_rows.filter(function (row) {
								if (row.is_up == true) return row;
							}).map(function (row) {
								return row.id;
							}),
							client_names: selected_rows.filter(function (row) {
								if (row.is_up == true) return row;
							}).map(function (row) {
								return row.client_name;
							})
						}).$promise.finally(function () {
							$modalInstance.close();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.rebootTerminal = function (item) {
		var ables = 0;
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (item.is_up == false) ables++;
		});
		if (ables == selected_rows.length)
			//alert("终端已经关机")
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiTerminalClientManage_TIP7"),
				timeout: 6000
			});
		if (ables != selected_rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重启确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='确定重启吗' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.name = selected_rows.filter(function (row) {
						if (row.is_up == true) return row;
					}).map(function (row) {
						return row.client_name;
					}).join(', ');
					$scope.ok = function () {
						client.shutdowns({
							"method": "reboot",
							client_ids: selected_rows.filter(function (row) {
								if (row.is_up == true) return row;
							}).map(function (row) {
								return row.id;
							}),
							client_names: selected_rows.filter(function (row) {
								if (row.is_up == true) return row;
							}).map(function (row) {
								return row.client_name;
							})
						}, function (res) {
							$modalInstance.close();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};

	$scope.terminate = function (item) {
		var ables = 0;
		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (item.is_up == false) ables++;
		});
		if (ables == selected_rows.length) $.bigBox({
			title: $$$I18N.get("INFOR_TIP"),
			content: $$$I18N.get("vdiTerminalClientManage_TIP8"),
			timeout: 6000
		});if (ables != selected_rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='中断确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CLIENT_TIPGROUP3' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.name = selected_rows.filter(function (row) {
						if (row.is_up == true) return row;
					}).map(function (row) {
						return row.client_name;
					}).join(', ');
					$scope.ok = function () {
						client.killSessions({
							ids: selected_rows.filter(function (row) {
								if (row.is_up == true) return row;
							}).map(function (row) {
								return row.id;
							})
						}, function (res) {
							$modalInstance.close();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.delete = function () {
		var ables = 0;var rows = $scope.rows;
		var selected_rows = $scope.rows.filter(function (row) {
			return row._selected;
		});
		angular.forEach(selected_rows, function (item) {
			if (item.is_up == true) ables++;
		});
		if (ables == selected_rows.length) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiTerminalClientManage_TIP9"),
				timeout: 6000
			});
		} else $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CLIENT_TIPGROUP4' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.name = selected_rows.filter(function (row) {
					if (row.is_up == false) return row;
				}).map(function (row) {
					return row.client_name;
				}).join(', ');
				$scope.ok = function () {
					client.delete({
						client_ids: selected_rows.filter(function (row) {
							if (row.is_up == false) return row;
						}).map(function (row) {
							return row.id;
						})
					}, function (res) {
						res.ids.forEach(function (item) {
							rows.forEach(function (data) {
								if (data.id == item) {
									rows.splice(rows.indexOf(data), 1);
								}
							});
						});
						res.ids.forEach(function (item) {
							allrows.forEach(function (data) {
								if (data.id == item) {
									allrows.splice(allrows.indexOf(data), 1);
								}
							});
						});
						$modalInstance.close();
					}, function () {});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
	$scope.view = function (item) {
		window.open("desktopScreenshot.html#" + item.inst_id, "person_desktop_" + item.inst_id);
	};
	$scope.editPass = function (item) {
		$modal.open({
			templateUrl: "views/vdi/dialog/terminal/terminal_editPass.html",
			controller: function controller($scope, $modalInstance) {
				var num_day = 3600 * 1000 * 24;
				$scope.startDateOptions = {
					formatYear: 'yy',
					startingDay: 1
				};
				$scope.minEndTime = function () {
					return $scope.time.getTime() + num_day * 60;
				};
				$scope.maxEndTime = function () {
					return $scope.time.getTime() + num_day * 180;
				};
				$scope.openStartDate = function ($event) {
					console.log(1111111, $event);
					$event.preventDefault();
					$event.stopPropagation();
					$scope.startDateOpened = true;
				};
				$scope.startTimeChange = function () {};

				$scope.is_edit = false;
				$scope.min_passwordLe = 6;$scope.max_passwordLe = 20;
				$scope.date = new Date();
				$scope.houer = $scope.date.getHours();
				$scope.minute = $scope.date.getMinutes();
				$scope.calculatePass = function () {};
				$scope.editSuperPass = function () {};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "md"
		});
	};
	$scope.dynamicPass = function () {
		$modal.open({
			templateUrl: "views/vdi/dialog/terminal/terminal_dynamicPass.html",
			controller: function controller($scope, $modalInstance) {
				client.dynamicPasswd(function (res) {
					$scope.password = res.result;
				}, function () {});
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("vdiTerminalSessionManageController", ["$scope", "Session", "$modal", function ($scope, session, $modal) {
	$scope.rows = [];$scope.loading = true;
	session.query(function (res) {
		$scope.rows = res.clients;
		$scope.loading = false;
	});

	$scope.currentPage = 1;
	$scope.pagesizes = [30, 20, 10];
	$scope.pagesize = $scope.pagesizes[0];

	$scope.terminate = function (item) {

		var selected_rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});

		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='中断会话'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='SESSION_TIPGROUP1'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					session.delete({
						ids: selected_rows.map(function (row) {
							return row.id;
						})
					}, function (res) {
						$modalInstance.close();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller("clientSortDialog", ["$scope", "$modalInstance", "$modal", "Client", function ($scope, $modalInstance, $modal, client) {
	var _scope = $scope;var flag = false;
	$scope.computers = $scope.selected_rows;$scope.LENGTH = $scope.computers.length;
	$scope.able_computers = $scope.computers.filter(function (item) {
		return item.is_up;
	});
	$scope.unable_computers = $scope.computers.filter(function (item) {
		return !item.is_up;
	});
	$scope.able_noset_computers = $scope.able_computers.filter(function (item) {
		if (item.order_status != 2) return item;
	});
	$scope.able_noset_FWCompu = $scope.able_noset_computers.filter(function (item) {
		if (!(item.client_os.indexOf('Windows') > -1 || item.client_os.indexOf('windows') > -1)) return item;
	});
	$scope.noset_computers = $scope.computers.filter(function (item) {
		if (item.order_status != 2) return item;
	});
	$scope.set_computers = $scope.computers.filter(function (item) {
		if (item.order_status == 2) return item;
	});

	var ids = $scope.computers.map(function (item) {
		return item.id;
	});
	var able_ids = $scope.able_computers.map(function (item) {
		return item.id;
	});
	var able_noset_ids = $scope.able_noset_computers.map(function (item) {
		return item.id;
	});
	var able_noset_FW_ids = $scope.able_noset_FWCompu.map(function (item) {
		return item.id;
	});
	var noset_ids = $scope.noset_computers.map(function (item) {
		return item.id;
	});
	var set_ids = $scope.set_computers.map(function (item) {
		return item.id;
	});

	var computers = {};
	$scope.able_noset_computers.forEach(function (computer) {
		computers[computer.id] = computer;
	});

	$scope.loop = false;$scope.results = 10;

	//   $scope.set = function(currentItem){
	//   	$modal.open({
	// 	template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel'>"+
	// 			"设置占位号</h4></div><div class='modal-body'><form class='form-horizontal' name='setNumber'><div class='form-group'><label class='col-xs-4 control-label required'>输入号码</label><div class='col-xs-7'><input type='number' required data-ng-model='placeholder' class='form-control'></div></div><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-ng-disabled='setNumber.$invalid'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;'>取消</button></footer></form></div></div></section>",
	// 	controller : function($scope, $modalInstance){
	// 		$scope.ok = function(){
	// 			client.setPlaceholder(
	// 			{ids:[currentItem.id], order:this.placeholder},
	// 			function(res){
	// 				//console.log(res)
	// 				currentItem.order_status = res.result[0].order_status;
	// 				currentItem.order = res.result[0].order;
	// 				_scope.set_computers.length++;
	// 				for(var i=0; i<_scope.able_noset_computers.length; i++){
	// 					if(_scope.able_noset_computers[i].id == res.result[0].id && _scope.able_noset_computers[i].is_up == true){
	// 						_scope.able_noset_computers.splice(i,1);
	// 						able_noset_ids.splice(i,1);
	// 					}
	// 				}
	// 				for(var i=0; i<noset_ids.length; i++){
	// 					if(noset_ids[i] == res.result[0].id){
	// 						_scope.noset_computers.splice(i,1);
	// 						noset_ids.splice(i,1);
	// 					}
	// 				}
	// 				//console.log(111,able_noset_ids);//console.log(222,noset_ids);
	// 			},function(){

	// 			})

	// 			$modalInstance.close();
	// 			//console.log(currentItem)
	// 		},
	// 		$scope.close = function(){

	// 			$modalInstance.close();
	// 		}
	// 	},
	// 	size : "sm"
	// });
	//   }

	//   $scope.cancel = function(currentItem){
	//   	$modal.open({
	// 	template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel'>"+
	// 			"取消占位号</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;'>确定取消占位号么?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;'>取消</button></footer></form></div></div></section>",
	// 	controller : function($scope, $modalInstance){
	// 		$scope.ok = function(){
	// 			client.setPlaceholder(
	// 			{ids:[currentItem.id], order:-1},
	// 			function(res){
	// 				currentItem.order_status = res.result[0].order_status;
	// 				currentItem.order = res.result[0].order;
	// 				_scope.set_computers.length--;
	// 				for(var i=0; i<_scope.computers.length; i++){
	// 					if(_scope.computers[i].id == res.result[0].id && _scope.computers[i].is_up == true){
	// 						_scope.able_noset_computers.push(_scope.computers[i]);
	// 						able_noset_ids.push(res.result[0].id);
	// 					}
	// 				}
	// 				for(var i=0; i<_scope.computers.length; i++){
	// 					if(_scope.computers[i].id == res.result[0].id){
	// 						_scope.noset_computers.push(_scope.computers[i]);
	// 						noset_ids.push(res.result[0].id);
	// 					}
	// 				}

	// 				//console.log(111,able_noset_ids);//console.log(222,noset_ids);
	// 			},function(){

	// 			});

	// 			$modalInstance.close();
	// 		},
	// 		$scope.close = function(){
	// 			$modalInstance.close();
	// 		}
	// 	},
	// 	size : "sm"
	// });
	//   }

	$scope.cancel = function (currentItem) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='取消登录序号'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CANCEL_LOGINNUM'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					client.setPlaceholder({ ids: [currentItem.id], order: -1 }, function (res) {
						currentItem.order_status = res.result[0].order_status;
						currentItem.order = res.result[0].order;
					}, function () {});

					$modalInstance.close();
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	function time_loop() {
		client.polling({ client_ids: able_noset_ids }, function (res) {
			var trueNum = 0;$scope.width = 0;
			res.result.forEach(function (data) {
				var computer = computers[data.id];
				console.log(computer, computer.order);
				if (data.order || !computer.is_up) {
					computer.client_name = data.name;
					computer.client_ip = data.ip;
					computer.order = data.order;
					trueNum++;
					$scope.width = 1 / res.result.length * trueNum * 100 + "%";
				}
			});
			$scope.computers = $scope.able_noset_computers;
			var unableComputers = $scope.computers.filter(function (item) {
				return !item.is_up;
			});
			var ableComputers = $scope.computers.filter(function (item) {
				return item.is_up;
			});
			var nosortComputers = ableComputers.filter(function (item) {
				return !item.order;
			});
			var sortedComputers = ableComputers.filter(function (item) {
				return item.order !== null;
			});
			sortedComputers.sort(function (item1, item2) {
				return item1.order > item2.order ? 1 : -1;
			});
			$scope.computers = [].concat(sortedComputers, nosortComputers, unableComputers);
			console.log(sortedComputers.map(function (item) {
				return item.id;
			}), nosortComputers.map(function (item) {
				return item.id;
			}), unableComputers.map(function (item) {
				return item.id;
			}));
			if (angular.element(".box-all").length) {
				var t = setTimeout(function () {
					time_loop();
				}, 3000);
			}
			if (flag) {
				clearTimeout(t);
			}
		}, function () {
			if (angular.element("").length) {
				setTimeout(function () {
					time_loop();
				}, 6000);
			}
		});
	}

	$scope.startSort = function () {
		if ($scope.sorttype == "manual") {
			$scope.sorting = true;$scope.Manualsorting = true;

			client.setPlaceholder({ ids: able_noset_ids, order: -1 }, function (res) {
				res.result.forEach(function (data) {
					var computer = computers[data.id];
					computer.order = null;
					console.log(computer, computer.order);
				});
				$scope.loop = true;
				time_loop();
			}, function () {});

			client.sorting({ ids: able_noset_ids,
				start_num: this.start_num,
				clientname_prefix: this.clientname_prefix,
				clientname_suffix: null
			}, function (res) {}, function () {});
		}
		if ($scope.sorttype == "auto") {
			var trueNum = 0;$scope.width = 0;
			$scope.computers = $scope.noset_computers;$scope.sorting = true;
			client.setPlaceholder({ ids: noset_ids, order: this.start_num, auto_order: 1 }, function (res) {
				for (var i = 0; i < res.result.length; i++) {
					if (res.result[i].order) {
						$scope.computers[i].order = res.result[i].order;
						trueNum++;
						$scope.width = 1 / res.result.length * trueNum * 100 + "%";
					}
				}
			}, function () {});
		}
	};

	$scope.cancelSort = function () {
		flag = true;
		client.cancelsort({ ids: able_noset_ids }, function (res) {
			$modalInstance.close();
		});
	};

	$scope.ok = function () {};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("clientBindingIpDialog", ["$scope", "$modalInstance", "Client", "SchoolRoom", "Network", function ($scope, $modalInstance, client, schoolroom, network) {

	$scope.terminallists = $scope.rows.filter(function (item) {
		return item._selected;
	});
	var data = $scope.startIP = $scope.terminallists[0].target_ip;
	schoolroom.query(function (res) {
		angular.forEach(res.pools_, function (item) {
			if (item.name == $scope.select.name) {
				$scope.network = item.network_name + "(" + item.dhcp_start + "~" + item.dhcp_end + ")";
				$scope.network_id = item.network_id;
				$scope.subnet_id = item.subnet_id;
				$scope.ip_start = item.dhcp_start;
				$scope.ip_end = item.dhcp_end;
			}
		});
	});
	$scope.isUnchanged = function () {
		return angular.equals(this.startIP, data);
	};
	$scope.ok = function () {
		client.assignIps({
			method: "changeIp",
			start_ip: this.startIP,
			client_ids: $scope.terminallists.map(function (item) {
				return item.id;
			}),
			network_id: this.network_id,
			subnet_id: this.subnet_id }, function (res) {
			var newip = res.result.map(function (item) {
				return item.ip;
			});
			for (var i = 0; i < newip.length; i++) {
				$scope.terminallists[i].target_ip = newip[i];
			}$modalInstance.close();
		});
	};

	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("configureTerminalParameterDialog", ["$scope", "$modalInstance", "Client", "$$$I18N", function ($scope, $modalInstance, client, $$$I18N) {
	$scope.config = {};

	$scope.init_checkMode = function (mode) {
		if (mode == 0 && $scope.config.mode_countdown !== 0) {
			$scope.in_hybird = true;
			$scope.config.mode_countdown = $scope.config.mode_countdown;
			$scope.config.final_mode = $scope.config.final_mode;
		} else {
			$scope.in_hybird = false;
			$scope.config.mode_countdown = "";
			$scope.config.final_mode = "";
		}
	};
	$scope.checkMode = function (mode) {
		$scope.config.enabled_multiple = 0;
		if (mode == 0) {
			$scope.in_hybird = true;
			$scope.config.mode_countdown = 5;
			$scope.config.final_mode = 1;
		} else {
			$scope.in_hybird = false;
			$scope.config.mode_countdown = "";
			$scope.config.final_mode = "";
		}
	};
	$scope.inHybird = function () {
		if ($scope.in_hybird) {
			$scope.in_hybird = false;
			$scope.config.mode_countdown = "";
			$scope.config.final_mode = "";
		} else {
			$scope.in_hybird = true;
			$scope.config.mode_countdown = 5;
			$scope.config.final_mode = 1;
		}
	};
	$scope.fullscreen = function (mode) {
		if (mode === 2) {
			$scope.config.auto_start = '1';
		} else {
			$scope.config.auto_start = '0';
		}
	};
	$scope.setWinWait = function (val) {
		console.log(val);
		if (val) {
			$scope.config.win_wait_time = 2;
		} else {
			$scope.config.win_wait_time = '';
		}
	};
	$scope.setWaitTime = function (val) {
		if (val) {
			$scope.config.wait_time = $scope.config.wait_time ? $scope.config.wait_time : 5;
		} else {
			$scope.config.wait_time = 5;
		}
	};

	$scope.dialogSet = function (key, value) {
		$scope.config[key] = value;
	};

	var selected_rows = $scope.rows.filter(function (row) {
		return row._selected && row.is_up;
	});
	var has_windows_android = selected_rows.filter(function (item) {
		return item.client_type === 1 || item.client_type === 999 || item.client_type === 97;
	}).length === 0 ? false : true;
	$scope.has_windows = selected_rows.filter(function (item) {
		return item.client_type === 1 || item.client_type === 999;
	}).length == 0 && $scope.isSingle ? false : true;
	$scope.has_linux = selected_rows.filter(function (item) {
		return item.client_type === 99;
	}).length == 0 && $scope.isSingle ? false : true;
	$scope.selecLen = selected_rows.length;

	$scope.loading = true;
	client.getConfig({ id: selected_rows[0].id }, function (data) {
		$scope.loading = false;
		$scope.config = new2old(data.config);
		$scope.init_checkMode($scope.config.desktop_mode);
	}, function (error) {
		$scope.loading = false;$scope.getError = true;
	});
	$scope.ok = function () {
		$scope.sending = true;
		var id = selected_rows.filter(function (row) {
			return row.is_up == true;
		}).map(function (row) {
			return row.id;
		});
		// 提交前拉取一次最新的数据，并计算出 diff，仅仅提交不一样的部分
		// client.getConfig({id: selected_rows[0].id}, function(data){
		// var changes = difference(old2new($scope.config), data.config);
		var changes = old2new($scope.config);
		var flatChanges = flatObject(changes);
		// console.log('提交前拉取一次最新的数据', data.result)
		// console.log('修改后的老数据', $scope.config)
		// console.log('修改后的老数据转成新数据', old2new($scope.config))
		// console.log('差异', changes)

		client.modifyConfig({
			id: id,
			server: flatChanges,
			client: changes
		}, function () {
			$modalInstance.close();
		}, function () {
			$scope.sending = false;
			$scope.failTip = true;
		});
		// });
	};
	$scope.close = function () {
		$modalInstance.close();
	};
	/* 旧数据格式 => 新数据格式 */
	function old2new(oldData) {
		var newData = {
			"desktop_mode": {
				"desktop_mode": $scope.config.desktop_mode * 1, // 0 混合模式, 1 教学模式, 2 个人模式
				"mode_countdown": $scope.config.mode_countdown * 1, // 混合模式-倒数多少秒
				"final_mode": $scope.config.final_mode * 1, // 混合模式-倒数多少秒自动进入 1 教学桌面, 2 个人桌面 
				"wait_time": $scope.config.autologin ? $scope.config.wait_time * 1 : 0 // 是否自动进入桌面, 0 不自动进入, 倒计时 3-600 秒自动进入桌面
			},
			"enabled_multiple": $scope.config.enabled_multiple * 1, // 0,1 个人模式-多桌面模式
			"self_service": $scope.config.self_service_teach + "" + $scope.config.self_service_personal + "", // 虚拟机自助 '11'教学桌面启用,个人桌面启用; '10'教学桌面启用,个人桌面不启用; '01'教学桌面不启用,个人桌面启用; '00'教学桌面不启用,个人桌面不启用
			"mode1_shutdown_with_client": $scope.config.mode1_shutdown_with_client * 1, // 0, 1教学桌面关机策略-关闭桌面同时关闭终端
			"mode1_shutdown_with_pc": $scope.config.mode1_shutdown_with_pc * 1, // 0, 1教学桌面关机策略-关闭终端同时关闭桌面
			"mode2_shutdown_with_client": $scope.config.mode2_shutdown_with_client * 1, // 0, 1个人桌面关机策略-关闭桌面同时关闭终端
			"mode2_shutdown_with_pc": $scope.config.mode2_shutdown_with_pc * 1, // 0, 1个人桌面关机策略-关闭终端同时关闭桌面
			"resolution": {
				"current_resolution": $scope.config.current_resolution.key // 个性化-分辨率
			},
			"console": {
				"console_ip": $scope.config.console_ip // 个性化-服务器IP
			},
			"init_pwd": $scope.config.init_pwd, // 个性化-超级密码
			"windows": {
				"shortcutKey": $scope.config.windows_shortcut_key * 1, // 0, 1 快捷键-Windows快捷键
				"fullscreen": $scope.config.fullscreen * 1, // Windows客户端运行模式: 0 窗口模式, 1 全屏可退出, 2 全屏不可退出
				"auto_start": $scope.config.auto_start * 1, // 0, 1开机自启
				"connect_type": $scope.config.connect_type, // Hyper-V桌面连接方式: rdp, vm
				"auto_exit": $scope.config.auto_exit * 1, // 与服务器连接断开后自动退出: 0, 1
				"win_wait_time": $scope.config.win_wait_time * 1, // 等待时间 1-30
				"disk_share_to_desktop": $scope.config.disk_share_to_desktop * 1 // 磁盘共享到桌面: 0, 1
			},
			"linux": {
				"shortcutKey": $scope.config.linux_shortcut_key * 1, // 0, 1 快捷键-Linux快捷键
				"auto_switch": $scope.config.auto_switch * 1, // 0, 1 自动切换
				"auto_switch_seconds": $scope.config.auto_switch_seconds * 1 // 虚系统中断时，倒数 3-600 s自动进入实系统
			}
		};
		return newData;
	};
	/* 新数据格式 => 旧数据格式 */
	function new2old(newData) {
		// 给不完整的新格式数据设置默认值
		var resolutions = [];
		newData.resolution.support_resolution.forEach(function (item) {
			if (item == 'best') {
				resolutions.push({ key: 'best', value: $$$I18N.get("最佳分辨率") });
			} else {
				resolutions.push({ key: item, value: item });
			}
		});
		var hasCurrentResolution = newData.resolution.support_resolution.filter(function (item) {
			return item == newData.resolution.current_resolution;
		}).length;
		if (!hasCurrentResolution) {
			resolutions.push({ key: newData.resolution.current_resolution, value: newData.resolution.current_resolution });
		}
		var oldData = {
			desktop_mode: newData.desktop_mode.desktop_mode + "",
			final_mode: newData.desktop_mode.final_mode + "",
			mode_countdown: newData.desktop_mode.mode_countdown,
			enabled_multiple: newData.enabled_multiple + "",
			wait_time: newData.desktop_mode.wait_time,
			autologin: newData.desktop_mode.wait_time == 0 ? false : true,

			self_service_teach: newData.self_service.slice(0, 1),
			self_service_personal: newData.self_service.slice(1),
			mode1_shutdown_with_client: newData.mode1_shutdown_with_client + "",
			mode1_shutdown_with_pc: newData.mode1_shutdown_with_pc + "",
			mode2_shutdown_with_client: newData.mode2_shutdown_with_client + "",
			mode2_shutdown_with_pc: newData.mode2_shutdown_with_pc + "",

			support_resolution: resolutions,
			current_resolution: resolutions.filter(function (item) {
				return item.key == newData.resolution.current_resolution;
			})[0],
			console_ip: newData.console.console_ip,
			init_pwd: newData.init_pwd
		};
		// 如果是windows端就赋值windows参数，否则就用默认值
		if (newData.windows) {
			oldData.windows_shortcut_key = newData.windows.shortcutKey + "";
			oldData.fullscreen = newData.windows.fullscreen + "";
			oldData.auto_start = newData.windows.auto_start + "";
			oldData.connect_type = newData.windows.connect_type;
			oldData.auto_exit = newData.windows.auto_exit + "";
			oldData.win_wait_time = newData.windows.auto_exit ? newData.windows.win_wait_time : "";
			oldData.disk_share_to_desktop = newData.windows.disk_share_to_desktop + "";
		} else {
			oldData.windows_shortcut_key = "1";
			oldData.fullscreen = "0";
			oldData.auto_start = "0";
			oldData.connect_type = 'rdp';
			oldData.auto_exit = "0";
			oldData.win_wait_time = "";
			oldData.disk_share_to_desktop = "0";
		}
		// 如果是linux端就赋值linux参数，否则就用默认值
		if (newData.linux) {
			oldData.linux_shortcut_key = newData.linux.shortcutKey + "";
			oldData.auto_switch = newData.linux.auto_switch + "";
			oldData.auto_switch_seconds = newData.linux.auto_switch ? newData.linux.auto_switch_seconds : "";
		} else {
			oldData.linux_shortcut_key = "1";
			oldData.auto_switch = "0";
			oldData.auto_switch_seconds = "";
		}
		return oldData;
	}

	var isObject = __webpack_require__(15);
	var isEqual = __webpack_require__(55);
	var transform = __webpack_require__(118);
	// 计算两个 object 的差异
	function difference(object, base) {
		function changes(object, base) {
			return transform(object, function (result, value, key) {
				if (!isEqual(value, base[key])) {
					result[key] = isObject(value) && isObject(base[key]) ? changes(value, base[key]) : value;
				}
			});
		}
		return changes(object, base);
	}
	function flatObject(obj) {
		var ret = {};
		var flatFn = function flatFn(o) {
			Object.keys(o).forEach(function (k) {
				var v = o[k];
				if (typeof v === "number" || typeof v === "string") {
					ret[k] = v;
				} else if (isObject(v)) {
					flatFn(v);
				}
			});
		};
		flatFn(obj);
		return ret;
	}
}]).controller("configureClassroomDialog", ["$scope", "$modalInstance", "Client", function ($scope, $modalInstance, client) {
	$scope.terminallists = $scope.rows.filter(function (item) {
		return item._selected;
	});

	$scope.poollists = $scope.classrooms.filter(function (item) {
		if (item.name !== $scope.select.name) return item;
	});
	$scope.pool = $scope.poollists[0];

	$scope.isUnchanged = function () {
		return angular.equals($scope.item, $scope.rows) || angular.equals($scope.currentItem, $scope.rows);
	};

	$scope.ok = function () {
		client.changePools({
			client_ids: $scope.terminallists.map(function (item) {
				return item.id;
			}),
			pool_id: this.pool.id
		}, function (res) {
			angular.forEach($scope.terminallists, function (item) {
				item.target_ip = null;
				item.order = null;
				$scope.rows.splice($scope.rows.indexOf(item), 1);
			});
			var newPool = res.result.map(function (item) {
				return item.pool_id;
			});
			for (var i = 0; i < newPool.length; i++) {
				$scope.terminallists[i].pool = newPool[i];
			}$modalInstance.close();
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("configureNameDialog", ["$scope", "$modalInstance", "Client", function ($scope, $modalInstance, client) {
	$scope.terminallists = $scope.rows.filter(function (item) {
		return item._selected && item.is_up;
	});
	$scope.terminal = $scope.terminallists[0].client_name;
	$scope.ok = function () {
		client.changeNames({
			client_ids: $scope.terminallists.map(function (item) {
				return item.id;
			}),
			prefix: this.prename
		}, function (res) {
			$modalInstance.close();
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]);

/***/ }),
/* 55 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseIsEqual = __webpack_require__(26);

/**
 * Performs a deep comparison between two values to determine if they are
 * equivalent.
 *
 * **Note:** This method supports comparing arrays, array buffers, booleans,
 * date objects, error objects, maps, numbers, `Object` objects, regexes,
 * sets, strings, symbols, and typed arrays. `Object` objects are compared
 * by their own, not inherited, enumerable properties. Functions and DOM
 * nodes are compared by strict equality, i.e. `===`.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Lang
 * @param {*} value The value to compare.
 * @param {*} other The other value to compare.
 * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
 * @example
 *
 * var object = { 'a': 1 };
 * var other = { 'a': 1 };
 *
 * _.isEqual(object, other);
 * // => true
 *
 * object === other;
 * // => false
 */
function isEqual(value, other) {
  return baseIsEqual(value, other);
}

module.exports = isEqual;

/***/ }),
/* 56 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var Stack = __webpack_require__(37),
    equalArrays = __webpack_require__(41),
    equalByTag = __webpack_require__(91),
    equalObjects = __webpack_require__(95),
    getTag = __webpack_require__(113),
    isArray = __webpack_require__(14),
    isBuffer = __webpack_require__(31),
    isTypedArray = __webpack_require__(32);

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1;

/** `Object#toString` result references. */
var argsTag = '[object Arguments]',
    arrayTag = '[object Array]',
    objectTag = '[object Object]';

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * A specialized version of `baseIsEqual` for arrays and objects which performs
 * deep comparisons and tracks traversed objects enabling objects with circular
 * references to be compared.
 *
 * @private
 * @param {Object} object The object to compare.
 * @param {Object} other The other object to compare.
 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
 * @param {Function} customizer The function to customize comparisons.
 * @param {Function} equalFunc The function to determine equivalents of values.
 * @param {Object} [stack] Tracks traversed `object` and `other` objects.
 * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
 */
function baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {
  var objIsArr = isArray(object),
      othIsArr = isArray(other),
      objTag = objIsArr ? arrayTag : getTag(object),
      othTag = othIsArr ? arrayTag : getTag(other);

  objTag = objTag == argsTag ? objectTag : objTag;
  othTag = othTag == argsTag ? objectTag : othTag;

  var objIsObj = objTag == objectTag,
      othIsObj = othTag == objectTag,
      isSameTag = objTag == othTag;

  if (isSameTag && isBuffer(object)) {
    if (!isBuffer(other)) {
      return false;
    }
    objIsArr = true;
    objIsObj = false;
  }
  if (isSameTag && !objIsObj) {
    stack || (stack = new Stack());
    return objIsArr || isTypedArray(object) ? equalArrays(object, other, bitmask, customizer, equalFunc, stack) : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);
  }
  if (!(bitmask & COMPARE_PARTIAL_FLAG)) {
    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),
        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');

    if (objIsWrapped || othIsWrapped) {
      var objUnwrapped = objIsWrapped ? object.value() : object,
          othUnwrapped = othIsWrapped ? other.value() : other;

      stack || (stack = new Stack());
      return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);
    }
  }
  if (!isSameTag) {
    return false;
  }
  stack || (stack = new Stack());
  return equalObjects(object, other, bitmask, customizer, equalFunc, stack);
}

module.exports = baseIsEqualDeep;

/***/ }),
/* 57 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Removes all key-value entries from the list cache.
 *
 * @private
 * @name clear
 * @memberOf ListCache
 */
function listCacheClear() {
  this.__data__ = [];
  this.size = 0;
}

module.exports = listCacheClear;

/***/ }),
/* 58 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var assocIndexOf = __webpack_require__(21);

/** Used for built-in method references. */
var arrayProto = Array.prototype;

/** Built-in value references. */
var splice = arrayProto.splice;

/**
 * Removes `key` and its value from the list cache.
 *
 * @private
 * @name delete
 * @memberOf ListCache
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function listCacheDelete(key) {
  var data = this.__data__,
      index = assocIndexOf(data, key);

  if (index < 0) {
    return false;
  }
  var lastIndex = data.length - 1;
  if (index == lastIndex) {
    data.pop();
  } else {
    splice.call(data, index, 1);
  }
  --this.size;
  return true;
}

module.exports = listCacheDelete;

/***/ }),
/* 59 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var assocIndexOf = __webpack_require__(21);

/**
 * Gets the list cache value for `key`.
 *
 * @private
 * @name get
 * @memberOf ListCache
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function listCacheGet(key) {
  var data = this.__data__,
      index = assocIndexOf(data, key);

  return index < 0 ? undefined : data[index][1];
}

module.exports = listCacheGet;

/***/ }),
/* 60 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var assocIndexOf = __webpack_require__(21);

/**
 * Checks if a list cache value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf ListCache
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function listCacheHas(key) {
  return assocIndexOf(this.__data__, key) > -1;
}

module.exports = listCacheHas;

/***/ }),
/* 61 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var assocIndexOf = __webpack_require__(21);

/**
 * Sets the list cache `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf ListCache
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the list cache instance.
 */
function listCacheSet(key, value) {
  var data = this.__data__,
      index = assocIndexOf(data, key);

  if (index < 0) {
    ++this.size;
    data.push([key, value]);
  } else {
    data[index][1] = value;
  }
  return this;
}

module.exports = listCacheSet;

/***/ }),
/* 62 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var ListCache = __webpack_require__(20);

/**
 * Removes all key-value entries from the stack.
 *
 * @private
 * @name clear
 * @memberOf Stack
 */
function stackClear() {
  this.__data__ = new ListCache();
  this.size = 0;
}

module.exports = stackClear;

/***/ }),
/* 63 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Removes `key` and its value from the stack.
 *
 * @private
 * @name delete
 * @memberOf Stack
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function stackDelete(key) {
  var data = this.__data__,
      result = data['delete'](key);

  this.size = data.size;
  return result;
}

module.exports = stackDelete;

/***/ }),
/* 64 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Gets the stack value for `key`.
 *
 * @private
 * @name get
 * @memberOf Stack
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function stackGet(key) {
  return this.__data__.get(key);
}

module.exports = stackGet;

/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Checks if a stack value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf Stack
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function stackHas(key) {
  return this.__data__.has(key);
}

module.exports = stackHas;

/***/ }),
/* 66 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var ListCache = __webpack_require__(20),
    Map = __webpack_require__(27),
    MapCache = __webpack_require__(29);

/** Used as the size to enable large array optimizations. */
var LARGE_ARRAY_SIZE = 200;

/**
 * Sets the stack `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf Stack
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the stack cache instance.
 */
function stackSet(key, value) {
  var data = this.__data__;
  if (data instanceof ListCache) {
    var pairs = data.__data__;
    if (!Map || pairs.length < LARGE_ARRAY_SIZE - 1) {
      pairs.push([key, value]);
      this.size = ++data.size;
      return this;
    }
    data = this.__data__ = new MapCache(pairs);
  }
  data.set(key, value);
  this.size = data.size;
  return this;
}

module.exports = stackSet;

/***/ }),
/* 67 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isFunction = __webpack_require__(28),
    isMasked = __webpack_require__(71),
    isObject = __webpack_require__(15),
    toSource = __webpack_require__(40);

/**
 * Used to match `RegExp`
 * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
 */
var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;

/** Used to detect host constructors (Safari). */
var reIsHostCtor = /^\[object .+?Constructor\]$/;

/** Used for built-in method references. */
var funcProto = Function.prototype,
    objectProto = Object.prototype;

/** Used to resolve the decompiled source of functions. */
var funcToString = funcProto.toString;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/** Used to detect if a method is native. */
var reIsNative = RegExp('^' + funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$');

/**
 * The base implementation of `_.isNative` without bad shim checks.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a native function,
 *  else `false`.
 */
function baseIsNative(value) {
  if (!isObject(value) || isMasked(value)) {
    return false;
  }
  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;
  return pattern.test(toSource(value));
}

module.exports = baseIsNative;

/***/ }),
/* 68 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var g;

// This works in non-strict mode
g = function () {
	return this;
}();

try {
	// This works if eval is allowed (see CSP)
	g = g || Function("return this")() || (1, eval)("this");
} catch (e) {
	// This works if the window reference is available
	if ((typeof window === "undefined" ? "undefined" : _typeof(window)) === "object") g = window;
}

// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}

module.exports = g;

/***/ }),
/* 69 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _Symbol = __webpack_require__(22);

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * Used to resolve the
 * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
 * of values.
 */
var nativeObjectToString = objectProto.toString;

/** Built-in value references. */
var symToStringTag = _Symbol ? _Symbol.toStringTag : undefined;

/**
 * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
 *
 * @private
 * @param {*} value The value to query.
 * @returns {string} Returns the raw `toStringTag`.
 */
function getRawTag(value) {
  var isOwn = hasOwnProperty.call(value, symToStringTag),
      tag = value[symToStringTag];

  try {
    value[symToStringTag] = undefined;
    var unmasked = true;
  } catch (e) {}

  var result = nativeObjectToString.call(value);
  if (unmasked) {
    if (isOwn) {
      value[symToStringTag] = tag;
    } else {
      delete value[symToStringTag];
    }
  }
  return result;
}

module.exports = getRawTag;

/***/ }),
/* 70 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/** Used for built-in method references. */
var objectProto = Object.prototype;

/**
 * Used to resolve the
 * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
 * of values.
 */
var nativeObjectToString = objectProto.toString;

/**
 * Converts `value` to a string using `Object.prototype.toString`.
 *
 * @private
 * @param {*} value The value to convert.
 * @returns {string} Returns the converted string.
 */
function objectToString(value) {
  return nativeObjectToString.call(value);
}

module.exports = objectToString;

/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var coreJsData = __webpack_require__(72);

/** Used to detect methods masquerading as native. */
var maskSrcKey = function () {
  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
  return uid ? 'Symbol(src)_1.' + uid : '';
}();

/**
 * Checks if `func` has its source masked.
 *
 * @private
 * @param {Function} func The function to check.
 * @returns {boolean} Returns `true` if `func` is masked, else `false`.
 */
function isMasked(func) {
  return !!maskSrcKey && maskSrcKey in func;
}

module.exports = isMasked;

/***/ }),
/* 72 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var root = __webpack_require__(13);

/** Used to detect overreaching core-js shims. */
var coreJsData = root['__core-js_shared__'];

module.exports = coreJsData;

/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Gets the value at `key` of `object`.
 *
 * @private
 * @param {Object} [object] The object to query.
 * @param {string} key The key of the property to get.
 * @returns {*} Returns the property value.
 */
function getValue(object, key) {
  return object == null ? undefined : object[key];
}

module.exports = getValue;

/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var Hash = __webpack_require__(75),
    ListCache = __webpack_require__(20),
    Map = __webpack_require__(27);

/**
 * Removes all key-value entries from the map.
 *
 * @private
 * @name clear
 * @memberOf MapCache
 */
function mapCacheClear() {
  this.size = 0;
  this.__data__ = {
    'hash': new Hash(),
    'map': new (Map || ListCache)(),
    'string': new Hash()
  };
}

module.exports = mapCacheClear;

/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var hashClear = __webpack_require__(76),
    hashDelete = __webpack_require__(77),
    hashGet = __webpack_require__(78),
    hashHas = __webpack_require__(79),
    hashSet = __webpack_require__(80);

/**
 * Creates a hash object.
 *
 * @private
 * @constructor
 * @param {Array} [entries] The key-value pairs to cache.
 */
function Hash(entries) {
    var index = -1,
        length = entries == null ? 0 : entries.length;

    this.clear();
    while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
    }
}

// Add methods to `Hash`.
Hash.prototype.clear = hashClear;
Hash.prototype['delete'] = hashDelete;
Hash.prototype.get = hashGet;
Hash.prototype.has = hashHas;
Hash.prototype.set = hashSet;

module.exports = Hash;

/***/ }),
/* 76 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var nativeCreate = __webpack_require__(23);

/**
 * Removes all key-value entries from the hash.
 *
 * @private
 * @name clear
 * @memberOf Hash
 */
function hashClear() {
  this.__data__ = nativeCreate ? nativeCreate(null) : {};
  this.size = 0;
}

module.exports = hashClear;

/***/ }),
/* 77 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Removes `key` and its value from the hash.
 *
 * @private
 * @name delete
 * @memberOf Hash
 * @param {Object} hash The hash to modify.
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function hashDelete(key) {
  var result = this.has(key) && delete this.__data__[key];
  this.size -= result ? 1 : 0;
  return result;
}

module.exports = hashDelete;

/***/ }),
/* 78 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var nativeCreate = __webpack_require__(23);

/** Used to stand-in for `undefined` hash values. */
var HASH_UNDEFINED = '__lodash_hash_undefined__';

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * Gets the hash value for `key`.
 *
 * @private
 * @name get
 * @memberOf Hash
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function hashGet(key) {
  var data = this.__data__;
  if (nativeCreate) {
    var result = data[key];
    return result === HASH_UNDEFINED ? undefined : result;
  }
  return hasOwnProperty.call(data, key) ? data[key] : undefined;
}

module.exports = hashGet;

/***/ }),
/* 79 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var nativeCreate = __webpack_require__(23);

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * Checks if a hash value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf Hash
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function hashHas(key) {
  var data = this.__data__;
  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);
}

module.exports = hashHas;

/***/ }),
/* 80 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var nativeCreate = __webpack_require__(23);

/** Used to stand-in for `undefined` hash values. */
var HASH_UNDEFINED = '__lodash_hash_undefined__';

/**
 * Sets the hash `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf Hash
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the hash instance.
 */
function hashSet(key, value) {
  var data = this.__data__;
  this.size += this.has(key) ? 0 : 1;
  data[key] = nativeCreate && value === undefined ? HASH_UNDEFINED : value;
  return this;
}

module.exports = hashSet;

/***/ }),
/* 81 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getMapData = __webpack_require__(24);

/**
 * Removes `key` and its value from the map.
 *
 * @private
 * @name delete
 * @memberOf MapCache
 * @param {string} key The key of the value to remove.
 * @returns {boolean} Returns `true` if the entry was removed, else `false`.
 */
function mapCacheDelete(key) {
  var result = getMapData(this, key)['delete'](key);
  this.size -= result ? 1 : 0;
  return result;
}

module.exports = mapCacheDelete;

/***/ }),
/* 82 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Checks if `value` is suitable for use as unique object key.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
 */
function isKeyable(value) {
  var type = typeof value === 'undefined' ? 'undefined' : _typeof(value);
  return type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean' ? value !== '__proto__' : value === null;
}

module.exports = isKeyable;

/***/ }),
/* 83 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getMapData = __webpack_require__(24);

/**
 * Gets the map value for `key`.
 *
 * @private
 * @name get
 * @memberOf MapCache
 * @param {string} key The key of the value to get.
 * @returns {*} Returns the entry value.
 */
function mapCacheGet(key) {
  return getMapData(this, key).get(key);
}

module.exports = mapCacheGet;

/***/ }),
/* 84 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getMapData = __webpack_require__(24);

/**
 * Checks if a map value for `key` exists.
 *
 * @private
 * @name has
 * @memberOf MapCache
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function mapCacheHas(key) {
  return getMapData(this, key).has(key);
}

module.exports = mapCacheHas;

/***/ }),
/* 85 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getMapData = __webpack_require__(24);

/**
 * Sets the map `key` to `value`.
 *
 * @private
 * @name set
 * @memberOf MapCache
 * @param {string} key The key of the value to set.
 * @param {*} value The value to set.
 * @returns {Object} Returns the map cache instance.
 */
function mapCacheSet(key, value) {
  var data = getMapData(this, key),
      size = data.size;

  data.set(key, value);
  this.size += data.size == size ? 0 : 1;
  return this;
}

module.exports = mapCacheSet;

/***/ }),
/* 86 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var MapCache = __webpack_require__(29),
    setCacheAdd = __webpack_require__(87),
    setCacheHas = __webpack_require__(88);

/**
 *
 * Creates an array cache object to store unique values.
 *
 * @private
 * @constructor
 * @param {Array} [values] The values to cache.
 */
function SetCache(values) {
    var index = -1,
        length = values == null ? 0 : values.length;

    this.__data__ = new MapCache();
    while (++index < length) {
        this.add(values[index]);
    }
}

// Add methods to `SetCache`.
SetCache.prototype.add = SetCache.prototype.push = setCacheAdd;
SetCache.prototype.has = setCacheHas;

module.exports = SetCache;

/***/ }),
/* 87 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/** Used to stand-in for `undefined` hash values. */
var HASH_UNDEFINED = '__lodash_hash_undefined__';

/**
 * Adds `value` to the array cache.
 *
 * @private
 * @name add
 * @memberOf SetCache
 * @alias push
 * @param {*} value The value to cache.
 * @returns {Object} Returns the cache instance.
 */
function setCacheAdd(value) {
  this.__data__.set(value, HASH_UNDEFINED);
  return this;
}

module.exports = setCacheAdd;

/***/ }),
/* 88 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Checks if `value` is in the array cache.
 *
 * @private
 * @name has
 * @memberOf SetCache
 * @param {*} value The value to search for.
 * @returns {number} Returns `true` if `value` is found, else `false`.
 */
function setCacheHas(value) {
  return this.__data__.has(value);
}

module.exports = setCacheHas;

/***/ }),
/* 89 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * A specialized version of `_.some` for arrays without support for iteratee
 * shorthands.
 *
 * @private
 * @param {Array} [array] The array to iterate over.
 * @param {Function} predicate The function invoked per iteration.
 * @returns {boolean} Returns `true` if any element passes the predicate check,
 *  else `false`.
 */
function arraySome(array, predicate) {
  var index = -1,
      length = array == null ? 0 : array.length;

  while (++index < length) {
    if (predicate(array[index], index, array)) {
      return true;
    }
  }
  return false;
}

module.exports = arraySome;

/***/ }),
/* 90 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Checks if a `cache` value for `key` exists.
 *
 * @private
 * @param {Object} cache The cache to query.
 * @param {string} key The key of the entry to check.
 * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
 */
function cacheHas(cache, key) {
  return cache.has(key);
}

module.exports = cacheHas;

/***/ }),
/* 91 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _Symbol = __webpack_require__(22),
    Uint8Array = __webpack_require__(92),
    eq = __webpack_require__(38),
    equalArrays = __webpack_require__(41),
    mapToArray = __webpack_require__(93),
    setToArray = __webpack_require__(94);

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1,
    COMPARE_UNORDERED_FLAG = 2;

/** `Object#toString` result references. */
var boolTag = '[object Boolean]',
    dateTag = '[object Date]',
    errorTag = '[object Error]',
    mapTag = '[object Map]',
    numberTag = '[object Number]',
    regexpTag = '[object RegExp]',
    setTag = '[object Set]',
    stringTag = '[object String]',
    symbolTag = '[object Symbol]';

var arrayBufferTag = '[object ArrayBuffer]',
    dataViewTag = '[object DataView]';

/** Used to convert symbols to primitives and strings. */
var symbolProto = _Symbol ? _Symbol.prototype : undefined,
    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;

/**
 * A specialized version of `baseIsEqualDeep` for comparing objects of
 * the same `toStringTag`.
 *
 * **Note:** This function only supports comparing values with tags of
 * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
 *
 * @private
 * @param {Object} object The object to compare.
 * @param {Object} other The other object to compare.
 * @param {string} tag The `toStringTag` of the objects to compare.
 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
 * @param {Function} customizer The function to customize comparisons.
 * @param {Function} equalFunc The function to determine equivalents of values.
 * @param {Object} stack Tracks traversed `object` and `other` objects.
 * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
 */
function equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {
  switch (tag) {
    case dataViewTag:
      if (object.byteLength != other.byteLength || object.byteOffset != other.byteOffset) {
        return false;
      }
      object = object.buffer;
      other = other.buffer;

    case arrayBufferTag:
      if (object.byteLength != other.byteLength || !equalFunc(new Uint8Array(object), new Uint8Array(other))) {
        return false;
      }
      return true;

    case boolTag:
    case dateTag:
    case numberTag:
      // Coerce booleans to `1` or `0` and dates to milliseconds.
      // Invalid dates are coerced to `NaN`.
      return eq(+object, +other);

    case errorTag:
      return object.name == other.name && object.message == other.message;

    case regexpTag:
    case stringTag:
      // Coerce regexes to strings and treat strings, primitives and objects,
      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring
      // for more details.
      return object == other + '';

    case mapTag:
      var convert = mapToArray;

    case setTag:
      var isPartial = bitmask & COMPARE_PARTIAL_FLAG;
      convert || (convert = setToArray);

      if (object.size != other.size && !isPartial) {
        return false;
      }
      // Assume cyclic values are equal.
      var stacked = stack.get(object);
      if (stacked) {
        return stacked == other;
      }
      bitmask |= COMPARE_UNORDERED_FLAG;

      // Recursively compare objects (susceptible to call stack limits).
      stack.set(object, other);
      var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);
      stack['delete'](object);
      return result;

    case symbolTag:
      if (symbolValueOf) {
        return symbolValueOf.call(object) == symbolValueOf.call(other);
      }
  }
  return false;
}

module.exports = equalByTag;

/***/ }),
/* 92 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var root = __webpack_require__(13);

/** Built-in value references. */
var Uint8Array = root.Uint8Array;

module.exports = Uint8Array;

/***/ }),
/* 93 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Converts `map` to its key-value pairs.
 *
 * @private
 * @param {Object} map The map to convert.
 * @returns {Array} Returns the key-value pairs.
 */
function mapToArray(map) {
  var index = -1,
      result = Array(map.size);

  map.forEach(function (value, key) {
    result[++index] = [key, value];
  });
  return result;
}

module.exports = mapToArray;

/***/ }),
/* 94 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Converts `set` to an array of its values.
 *
 * @private
 * @param {Object} set The set to convert.
 * @returns {Array} Returns the values.
 */
function setToArray(set) {
  var index = -1,
      result = Array(set.size);

  set.forEach(function (value) {
    result[++index] = value;
  });
  return result;
}

module.exports = setToArray;

/***/ }),
/* 95 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getAllKeys = __webpack_require__(96);

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1;

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * A specialized version of `baseIsEqualDeep` for objects with support for
 * partial deep comparisons.
 *
 * @private
 * @param {Object} object The object to compare.
 * @param {Object} other The other object to compare.
 * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
 * @param {Function} customizer The function to customize comparisons.
 * @param {Function} equalFunc The function to determine equivalents of values.
 * @param {Object} stack Tracks traversed `object` and `other` objects.
 * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
 */
function equalObjects(object, other, bitmask, customizer, equalFunc, stack) {
  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,
      objProps = getAllKeys(object),
      objLength = objProps.length,
      othProps = getAllKeys(other),
      othLength = othProps.length;

  if (objLength != othLength && !isPartial) {
    return false;
  }
  var index = objLength;
  while (index--) {
    var key = objProps[index];
    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {
      return false;
    }
  }
  // Assume cyclic values are equal.
  var stacked = stack.get(object);
  if (stacked && stack.get(other)) {
    return stacked == other;
  }
  var result = true;
  stack.set(object, other);
  stack.set(other, object);

  var skipCtor = isPartial;
  while (++index < objLength) {
    key = objProps[index];
    var objValue = object[key],
        othValue = other[key];

    if (customizer) {
      var compared = isPartial ? customizer(othValue, objValue, key, other, object, stack) : customizer(objValue, othValue, key, object, other, stack);
    }
    // Recursively compare objects (susceptible to call stack limits).
    if (!(compared === undefined ? objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack) : compared)) {
      result = false;
      break;
    }
    skipCtor || (skipCtor = key == 'constructor');
  }
  if (result && !skipCtor) {
    var objCtor = object.constructor,
        othCtor = other.constructor;

    // Non `Object` object instances with different constructors are not equal.
    if (objCtor != othCtor && 'constructor' in object && 'constructor' in other && !(typeof objCtor == 'function' && objCtor instanceof objCtor && typeof othCtor == 'function' && othCtor instanceof othCtor)) {
      result = false;
    }
  }
  stack['delete'](object);
  stack['delete'](other);
  return result;
}

module.exports = equalObjects;

/***/ }),
/* 96 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseGetAllKeys = __webpack_require__(97),
    getSymbols = __webpack_require__(99),
    keys = __webpack_require__(30);

/**
 * Creates an array of own enumerable property names and symbols of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of property names and symbols.
 */
function getAllKeys(object) {
  return baseGetAllKeys(object, keys, getSymbols);
}

module.exports = getAllKeys;

/***/ }),
/* 97 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var arrayPush = __webpack_require__(98),
    isArray = __webpack_require__(14);

/**
 * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
 * `keysFunc` and `symbolsFunc` to get the enumerable property names and
 * symbols of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @param {Function} keysFunc The function to get the keys of `object`.
 * @param {Function} symbolsFunc The function to get the symbols of `object`.
 * @returns {Array} Returns the array of property names and symbols.
 */
function baseGetAllKeys(object, keysFunc, symbolsFunc) {
  var result = keysFunc(object);
  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));
}

module.exports = baseGetAllKeys;

/***/ }),
/* 98 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Appends the elements of `values` to `array`.
 *
 * @private
 * @param {Array} array The array to modify.
 * @param {Array} values The values to append.
 * @returns {Array} Returns `array`.
 */
function arrayPush(array, values) {
  var index = -1,
      length = values.length,
      offset = array.length;

  while (++index < length) {
    array[offset + index] = values[index];
  }
  return array;
}

module.exports = arrayPush;

/***/ }),
/* 99 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var arrayFilter = __webpack_require__(100),
    stubArray = __webpack_require__(101);

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Built-in value references. */
var propertyIsEnumerable = objectProto.propertyIsEnumerable;

/* Built-in method references for those with the same name as other `lodash` methods. */
var nativeGetSymbols = Object.getOwnPropertySymbols;

/**
 * Creates an array of the own enumerable symbols of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of symbols.
 */
var getSymbols = !nativeGetSymbols ? stubArray : function (object) {
  if (object == null) {
    return [];
  }
  object = Object(object);
  return arrayFilter(nativeGetSymbols(object), function (symbol) {
    return propertyIsEnumerable.call(object, symbol);
  });
};

module.exports = getSymbols;

/***/ }),
/* 100 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * A specialized version of `_.filter` for arrays without support for
 * iteratee shorthands.
 *
 * @private
 * @param {Array} [array] The array to iterate over.
 * @param {Function} predicate The function invoked per iteration.
 * @returns {Array} Returns the new filtered array.
 */
function arrayFilter(array, predicate) {
  var index = -1,
      length = array == null ? 0 : array.length,
      resIndex = 0,
      result = [];

  while (++index < length) {
    var value = array[index];
    if (predicate(value, index, array)) {
      result[resIndex++] = value;
    }
  }
  return result;
}

module.exports = arrayFilter;

/***/ }),
/* 101 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * This method returns a new empty array.
 *
 * @static
 * @memberOf _
 * @since 4.13.0
 * @category Util
 * @returns {Array} Returns the new empty array.
 * @example
 *
 * var arrays = _.times(2, _.stubArray);
 *
 * console.log(arrays);
 * // => [[], []]
 *
 * console.log(arrays[0] === arrays[1]);
 * // => false
 */
function stubArray() {
  return [];
}

module.exports = stubArray;

/***/ }),
/* 102 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseTimes = __webpack_require__(103),
    isArguments = __webpack_require__(42),
    isArray = __webpack_require__(14),
    isBuffer = __webpack_require__(31),
    isIndex = __webpack_require__(44),
    isTypedArray = __webpack_require__(32);

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * Creates an array of the enumerable property names of the array-like `value`.
 *
 * @private
 * @param {*} value The value to query.
 * @param {boolean} inherited Specify returning inherited property names.
 * @returns {Array} Returns the array of property names.
 */
function arrayLikeKeys(value, inherited) {
  var isArr = isArray(value),
      isArg = !isArr && isArguments(value),
      isBuff = !isArr && !isArg && isBuffer(value),
      isType = !isArr && !isArg && !isBuff && isTypedArray(value),
      skipIndexes = isArr || isArg || isBuff || isType,
      result = skipIndexes ? baseTimes(value.length, String) : [],
      length = result.length;

  for (var key in value) {
    if ((inherited || hasOwnProperty.call(value, key)) && !(skipIndexes && (
    // Safari 9 has enumerable `arguments.length` in strict mode.
    key == 'length' ||
    // Node.js 0.10 has enumerable non-index properties on buffers.
    isBuff && (key == 'offset' || key == 'parent') ||
    // PhantomJS 2 has enumerable non-index properties on typed arrays.
    isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset') ||
    // Skip index properties.
    isIndex(key, length)))) {
      result.push(key);
    }
  }
  return result;
}

module.exports = arrayLikeKeys;

/***/ }),
/* 103 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * The base implementation of `_.times` without support for iteratee shorthands
 * or max array length checks.
 *
 * @private
 * @param {number} n The number of times to invoke `iteratee`.
 * @param {Function} iteratee The function invoked per iteration.
 * @returns {Array} Returns the array of results.
 */
function baseTimes(n, iteratee) {
  var index = -1,
      result = Array(n);

  while (++index < n) {
    result[index] = iteratee(index);
  }
  return result;
}

module.exports = baseTimes;

/***/ }),
/* 104 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseGetTag = __webpack_require__(18),
    isObjectLike = __webpack_require__(19);

/** `Object#toString` result references. */
var argsTag = '[object Arguments]';

/**
 * The base implementation of `_.isArguments`.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is an `arguments` object,
 */
function baseIsArguments(value) {
  return isObjectLike(value) && baseGetTag(value) == argsTag;
}

module.exports = baseIsArguments;

/***/ }),
/* 105 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * This method returns `false`.
 *
 * @static
 * @memberOf _
 * @since 4.13.0
 * @category Util
 * @returns {boolean} Returns `false`.
 * @example
 *
 * _.times(2, _.stubFalse);
 * // => [false, false]
 */
function stubFalse() {
  return false;
}

module.exports = stubFalse;

/***/ }),
/* 106 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseGetTag = __webpack_require__(18),
    isLength = __webpack_require__(33),
    isObjectLike = __webpack_require__(19);

/** `Object#toString` result references. */
var argsTag = '[object Arguments]',
    arrayTag = '[object Array]',
    boolTag = '[object Boolean]',
    dateTag = '[object Date]',
    errorTag = '[object Error]',
    funcTag = '[object Function]',
    mapTag = '[object Map]',
    numberTag = '[object Number]',
    objectTag = '[object Object]',
    regexpTag = '[object RegExp]',
    setTag = '[object Set]',
    stringTag = '[object String]',
    weakMapTag = '[object WeakMap]';

var arrayBufferTag = '[object ArrayBuffer]',
    dataViewTag = '[object DataView]',
    float32Tag = '[object Float32Array]',
    float64Tag = '[object Float64Array]',
    int8Tag = '[object Int8Array]',
    int16Tag = '[object Int16Array]',
    int32Tag = '[object Int32Array]',
    uint8Tag = '[object Uint8Array]',
    uint8ClampedTag = '[object Uint8ClampedArray]',
    uint16Tag = '[object Uint16Array]',
    uint32Tag = '[object Uint32Array]';

/** Used to identify `toStringTag` values of typed arrays. */
var typedArrayTags = {};
typedArrayTags[float32Tag] = typedArrayTags[float64Tag] = typedArrayTags[int8Tag] = typedArrayTags[int16Tag] = typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] = typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] = typedArrayTags[uint32Tag] = true;
typedArrayTags[argsTag] = typedArrayTags[arrayTag] = typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] = typedArrayTags[dataViewTag] = typedArrayTags[dateTag] = typedArrayTags[errorTag] = typedArrayTags[funcTag] = typedArrayTags[mapTag] = typedArrayTags[numberTag] = typedArrayTags[objectTag] = typedArrayTags[regexpTag] = typedArrayTags[setTag] = typedArrayTags[stringTag] = typedArrayTags[weakMapTag] = false;

/**
 * The base implementation of `_.isTypedArray` without Node.js optimizations.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
 */
function baseIsTypedArray(value) {
    return isObjectLike(value) && isLength(value.length) && !!typedArrayTags[baseGetTag(value)];
}

module.exports = baseIsTypedArray;

/***/ }),
/* 107 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * The base implementation of `_.unary` without support for storing metadata.
 *
 * @private
 * @param {Function} func The function to cap arguments for.
 * @returns {Function} Returns the new capped function.
 */
function baseUnary(func) {
  return function (value) {
    return func(value);
  };
}

module.exports = baseUnary;

/***/ }),
/* 108 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(module) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var freeGlobal = __webpack_require__(39);

/** Detect free variable `exports`. */
var freeExports = ( false ? 'undefined' : _typeof(exports)) == 'object' && exports && !exports.nodeType && exports;

/** Detect free variable `module`. */
var freeModule = freeExports && ( false ? 'undefined' : _typeof(module)) == 'object' && module && !module.nodeType && module;

/** Detect the popular CommonJS extension `module.exports`. */
var moduleExports = freeModule && freeModule.exports === freeExports;

/** Detect free variable `process` from Node.js. */
var freeProcess = moduleExports && freeGlobal.process;

/** Used to access faster Node.js helpers. */
var nodeUtil = function () {
  try {
    return freeProcess && freeProcess.binding && freeProcess.binding('util');
  } catch (e) {}
}();

module.exports = nodeUtil;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(43)(module)))

/***/ }),
/* 109 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isPrototype = __webpack_require__(110),
    nativeKeys = __webpack_require__(111);

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
 *
 * @private
 * @param {Object} object The object to query.
 * @returns {Array} Returns the array of property names.
 */
function baseKeys(object) {
  if (!isPrototype(object)) {
    return nativeKeys(object);
  }
  var result = [];
  for (var key in Object(object)) {
    if (hasOwnProperty.call(object, key) && key != 'constructor') {
      result.push(key);
    }
  }
  return result;
}

module.exports = baseKeys;

/***/ }),
/* 110 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/** Used for built-in method references. */
var objectProto = Object.prototype;

/**
 * Checks if `value` is likely a prototype object.
 *
 * @private
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
 */
function isPrototype(value) {
  var Ctor = value && value.constructor,
      proto = typeof Ctor == 'function' && Ctor.prototype || objectProto;

  return value === proto;
}

module.exports = isPrototype;

/***/ }),
/* 111 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var overArg = __webpack_require__(45);

/* Built-in method references for those with the same name as other `lodash` methods. */
var nativeKeys = overArg(Object.keys, Object);

module.exports = nativeKeys;

/***/ }),
/* 112 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isFunction = __webpack_require__(28),
    isLength = __webpack_require__(33);

/**
 * Checks if `value` is array-like. A value is considered array-like if it's
 * not a function and has a `value.length` that's an integer greater than or
 * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
 * @example
 *
 * _.isArrayLike([1, 2, 3]);
 * // => true
 *
 * _.isArrayLike(document.body.children);
 * // => true
 *
 * _.isArrayLike('abc');
 * // => true
 *
 * _.isArrayLike(_.noop);
 * // => false
 */
function isArrayLike(value) {
  return value != null && isLength(value.length) && !isFunction(value);
}

module.exports = isArrayLike;

/***/ }),
/* 113 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var DataView = __webpack_require__(114),
    Map = __webpack_require__(27),
    Promise = __webpack_require__(115),
    Set = __webpack_require__(116),
    WeakMap = __webpack_require__(117),
    baseGetTag = __webpack_require__(18),
    toSource = __webpack_require__(40);

/** `Object#toString` result references. */
var mapTag = '[object Map]',
    objectTag = '[object Object]',
    promiseTag = '[object Promise]',
    setTag = '[object Set]',
    weakMapTag = '[object WeakMap]';

var dataViewTag = '[object DataView]';

/** Used to detect maps, sets, and weakmaps. */
var dataViewCtorString = toSource(DataView),
    mapCtorString = toSource(Map),
    promiseCtorString = toSource(Promise),
    setCtorString = toSource(Set),
    weakMapCtorString = toSource(WeakMap);

/**
 * Gets the `toStringTag` of `value`.
 *
 * @private
 * @param {*} value The value to query.
 * @returns {string} Returns the `toStringTag`.
 */
var getTag = baseGetTag;

// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.
if (DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag || Map && getTag(new Map()) != mapTag || Promise && getTag(Promise.resolve()) != promiseTag || Set && getTag(new Set()) != setTag || WeakMap && getTag(new WeakMap()) != weakMapTag) {
    getTag = function getTag(value) {
        var result = baseGetTag(value),
            Ctor = result == objectTag ? value.constructor : undefined,
            ctorString = Ctor ? toSource(Ctor) : '';

        if (ctorString) {
            switch (ctorString) {
                case dataViewCtorString:
                    return dataViewTag;
                case mapCtorString:
                    return mapTag;
                case promiseCtorString:
                    return promiseTag;
                case setCtorString:
                    return setTag;
                case weakMapCtorString:
                    return weakMapTag;
            }
        }
        return result;
    };
}

module.exports = getTag;

/***/ }),
/* 114 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getNative = __webpack_require__(16),
    root = __webpack_require__(13);

/* Built-in method references that are verified to be native. */
var DataView = getNative(root, 'DataView');

module.exports = DataView;

/***/ }),
/* 115 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getNative = __webpack_require__(16),
    root = __webpack_require__(13);

/* Built-in method references that are verified to be native. */
var Promise = getNative(root, 'Promise');

module.exports = Promise;

/***/ }),
/* 116 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getNative = __webpack_require__(16),
    root = __webpack_require__(13);

/* Built-in method references that are verified to be native. */
var Set = getNative(root, 'Set');

module.exports = Set;

/***/ }),
/* 117 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var getNative = __webpack_require__(16),
    root = __webpack_require__(13);

/* Built-in method references that are verified to be native. */
var WeakMap = getNative(root, 'WeakMap');

module.exports = WeakMap;

/***/ }),
/* 118 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var arrayEach = __webpack_require__(119),
    baseCreate = __webpack_require__(120),
    baseForOwn = __webpack_require__(121),
    baseIteratee = __webpack_require__(124),
    getPrototype = __webpack_require__(143),
    isArray = __webpack_require__(14),
    isBuffer = __webpack_require__(31),
    isFunction = __webpack_require__(28),
    isObject = __webpack_require__(15),
    isTypedArray = __webpack_require__(32);

/**
 * An alternative to `_.reduce`; this method transforms `object` to a new
 * `accumulator` object which is the result of running each of its own
 * enumerable string keyed properties thru `iteratee`, with each invocation
 * potentially mutating the `accumulator` object. If `accumulator` is not
 * provided, a new object with the same `[[Prototype]]` will be used. The
 * iteratee is invoked with four arguments: (accumulator, value, key, object).
 * Iteratee functions may exit iteration early by explicitly returning `false`.
 *
 * @static
 * @memberOf _
 * @since 1.3.0
 * @category Object
 * @param {Object} object The object to iterate over.
 * @param {Function} [iteratee=_.identity] The function invoked per iteration.
 * @param {*} [accumulator] The custom accumulator value.
 * @returns {*} Returns the accumulated value.
 * @example
 *
 * _.transform([2, 3, 4], function(result, n) {
 *   result.push(n *= n);
 *   return n % 2 == 0;
 * }, []);
 * // => [4, 9]
 *
 * _.transform({ 'a': 1, 'b': 2, 'c': 1 }, function(result, value, key) {
 *   (result[value] || (result[value] = [])).push(key);
 * }, {});
 * // => { '1': ['a', 'c'], '2': ['b'] }
 */
function transform(object, iteratee, accumulator) {
  var isArr = isArray(object),
      isArrLike = isArr || isBuffer(object) || isTypedArray(object);

  iteratee = baseIteratee(iteratee, 4);
  if (accumulator == null) {
    var Ctor = object && object.constructor;
    if (isArrLike) {
      accumulator = isArr ? new Ctor() : [];
    } else if (isObject(object)) {
      accumulator = isFunction(Ctor) ? baseCreate(getPrototype(object)) : {};
    } else {
      accumulator = {};
    }
  }
  (isArrLike ? arrayEach : baseForOwn)(object, function (value, index, object) {
    return iteratee(accumulator, value, index, object);
  });
  return accumulator;
}

module.exports = transform;

/***/ }),
/* 119 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * A specialized version of `_.forEach` for arrays without support for
 * iteratee shorthands.
 *
 * @private
 * @param {Array} [array] The array to iterate over.
 * @param {Function} iteratee The function invoked per iteration.
 * @returns {Array} Returns `array`.
 */
function arrayEach(array, iteratee) {
  var index = -1,
      length = array == null ? 0 : array.length;

  while (++index < length) {
    if (iteratee(array[index], index, array) === false) {
      break;
    }
  }
  return array;
}

module.exports = arrayEach;

/***/ }),
/* 120 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isObject = __webpack_require__(15);

/** Built-in value references. */
var objectCreate = Object.create;

/**
 * The base implementation of `_.create` without support for assigning
 * properties to the created object.
 *
 * @private
 * @param {Object} proto The object to inherit from.
 * @returns {Object} Returns the new object.
 */
var baseCreate = function () {
  function object() {}
  return function (proto) {
    if (!isObject(proto)) {
      return {};
    }
    if (objectCreate) {
      return objectCreate(proto);
    }
    object.prototype = proto;
    var result = new object();
    object.prototype = undefined;
    return result;
  };
}();

module.exports = baseCreate;

/***/ }),
/* 121 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseFor = __webpack_require__(122),
    keys = __webpack_require__(30);

/**
 * The base implementation of `_.forOwn` without support for iteratee shorthands.
 *
 * @private
 * @param {Object} object The object to iterate over.
 * @param {Function} iteratee The function invoked per iteration.
 * @returns {Object} Returns `object`.
 */
function baseForOwn(object, iteratee) {
  return object && baseFor(object, iteratee, keys);
}

module.exports = baseForOwn;

/***/ }),
/* 122 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var createBaseFor = __webpack_require__(123);

/**
 * The base implementation of `baseForOwn` which iterates over `object`
 * properties returned by `keysFunc` and invokes `iteratee` for each property.
 * Iteratee functions may exit iteration early by explicitly returning `false`.
 *
 * @private
 * @param {Object} object The object to iterate over.
 * @param {Function} iteratee The function invoked per iteration.
 * @param {Function} keysFunc The function to get the keys of `object`.
 * @returns {Object} Returns `object`.
 */
var baseFor = createBaseFor();

module.exports = baseFor;

/***/ }),
/* 123 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * Creates a base function for methods like `_.forIn` and `_.forOwn`.
 *
 * @private
 * @param {boolean} [fromRight] Specify iterating from right to left.
 * @returns {Function} Returns the new base function.
 */
function createBaseFor(fromRight) {
  return function (object, iteratee, keysFunc) {
    var index = -1,
        iterable = Object(object),
        props = keysFunc(object),
        length = props.length;

    while (length--) {
      var key = props[fromRight ? length : ++index];
      if (iteratee(iterable[key], key, iterable) === false) {
        break;
      }
    }
    return object;
  };
}

module.exports = createBaseFor;

/***/ }),
/* 124 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var baseMatches = __webpack_require__(125),
    baseMatchesProperty = __webpack_require__(128),
    identity = __webpack_require__(139),
    isArray = __webpack_require__(14),
    property = __webpack_require__(140);

/**
 * The base implementation of `_.iteratee`.
 *
 * @private
 * @param {*} [value=_.identity] The value to convert to an iteratee.
 * @returns {Function} Returns the iteratee.
 */
function baseIteratee(value) {
  // Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.
  // See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.
  if (typeof value == 'function') {
    return value;
  }
  if (value == null) {
    return identity;
  }
  if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) == 'object') {
    return isArray(value) ? baseMatchesProperty(value[0], value[1]) : baseMatches(value);
  }
  return property(value);
}

module.exports = baseIteratee;

/***/ }),
/* 125 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseIsMatch = __webpack_require__(126),
    getMatchData = __webpack_require__(127),
    matchesStrictComparable = __webpack_require__(47);

/**
 * The base implementation of `_.matches` which doesn't clone `source`.
 *
 * @private
 * @param {Object} source The object of property values to match.
 * @returns {Function} Returns the new spec function.
 */
function baseMatches(source) {
  var matchData = getMatchData(source);
  if (matchData.length == 1 && matchData[0][2]) {
    return matchesStrictComparable(matchData[0][0], matchData[0][1]);
  }
  return function (object) {
    return object === source || baseIsMatch(object, source, matchData);
  };
}

module.exports = baseMatches;

/***/ }),
/* 126 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var Stack = __webpack_require__(37),
    baseIsEqual = __webpack_require__(26);

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1,
    COMPARE_UNORDERED_FLAG = 2;

/**
 * The base implementation of `_.isMatch` without support for iteratee shorthands.
 *
 * @private
 * @param {Object} object The object to inspect.
 * @param {Object} source The object of property values to match.
 * @param {Array} matchData The property names, values, and compare flags to match.
 * @param {Function} [customizer] The function to customize comparisons.
 * @returns {boolean} Returns `true` if `object` is a match, else `false`.
 */
function baseIsMatch(object, source, matchData, customizer) {
  var index = matchData.length,
      length = index,
      noCustomizer = !customizer;

  if (object == null) {
    return !length;
  }
  object = Object(object);
  while (index--) {
    var data = matchData[index];
    if (noCustomizer && data[2] ? data[1] !== object[data[0]] : !(data[0] in object)) {
      return false;
    }
  }
  while (++index < length) {
    data = matchData[index];
    var key = data[0],
        objValue = object[key],
        srcValue = data[1];

    if (noCustomizer && data[2]) {
      if (objValue === undefined && !(key in object)) {
        return false;
      }
    } else {
      var stack = new Stack();
      if (customizer) {
        var result = customizer(objValue, srcValue, key, object, source, stack);
      }
      if (!(result === undefined ? baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG, customizer, stack) : result)) {
        return false;
      }
    }
  }
  return true;
}

module.exports = baseIsMatch;

/***/ }),
/* 127 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isStrictComparable = __webpack_require__(46),
    keys = __webpack_require__(30);

/**
 * Gets the property names, values, and compare flags of `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @returns {Array} Returns the match data of `object`.
 */
function getMatchData(object) {
    var result = keys(object),
        length = result.length;

    while (length--) {
        var key = result[length],
            value = object[key];

        result[length] = [key, value, isStrictComparable(value)];
    }
    return result;
}

module.exports = getMatchData;

/***/ }),
/* 128 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseIsEqual = __webpack_require__(26),
    get = __webpack_require__(129),
    hasIn = __webpack_require__(136),
    isKey = __webpack_require__(34),
    isStrictComparable = __webpack_require__(46),
    matchesStrictComparable = __webpack_require__(47),
    toKey = __webpack_require__(25);

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1,
    COMPARE_UNORDERED_FLAG = 2;

/**
 * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.
 *
 * @private
 * @param {string} path The path of the property to get.
 * @param {*} srcValue The value to match.
 * @returns {Function} Returns the new spec function.
 */
function baseMatchesProperty(path, srcValue) {
  if (isKey(path) && isStrictComparable(srcValue)) {
    return matchesStrictComparable(toKey(path), srcValue);
  }
  return function (object) {
    var objValue = get(object, path);
    return objValue === undefined && objValue === srcValue ? hasIn(object, path) : baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG);
  };
}

module.exports = baseMatchesProperty;

/***/ }),
/* 129 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseGet = __webpack_require__(48);

/**
 * Gets the value at `path` of `object`. If the resolved value is
 * `undefined`, the `defaultValue` is returned in its place.
 *
 * @static
 * @memberOf _
 * @since 3.7.0
 * @category Object
 * @param {Object} object The object to query.
 * @param {Array|string} path The path of the property to get.
 * @param {*} [defaultValue] The value returned for `undefined` resolved values.
 * @returns {*} Returns the resolved value.
 * @example
 *
 * var object = { 'a': [{ 'b': { 'c': 3 } }] };
 *
 * _.get(object, 'a[0].b.c');
 * // => 3
 *
 * _.get(object, ['a', '0', 'b', 'c']);
 * // => 3
 *
 * _.get(object, 'a.b.c', 'default');
 * // => 'default'
 */
function get(object, path, defaultValue) {
  var result = object == null ? undefined : baseGet(object, path);
  return result === undefined ? defaultValue : result;
}

module.exports = get;

/***/ }),
/* 130 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var memoizeCapped = __webpack_require__(131);

/** Used to match property names within property paths. */
var rePropName = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;

/** Used to match backslashes in property paths. */
var reEscapeChar = /\\(\\)?/g;

/**
 * Converts `string` to a property path array.
 *
 * @private
 * @param {string} string The string to convert.
 * @returns {Array} Returns the property path array.
 */
var stringToPath = memoizeCapped(function (string) {
  var result = [];
  if (string.charCodeAt(0) === 46 /* . */) {
      result.push('');
    }
  string.replace(rePropName, function (match, number, quote, subString) {
    result.push(quote ? subString.replace(reEscapeChar, '$1') : number || match);
  });
  return result;
});

module.exports = stringToPath;

/***/ }),
/* 131 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var memoize = __webpack_require__(132);

/** Used as the maximum memoize cache size. */
var MAX_MEMOIZE_SIZE = 500;

/**
 * A specialized version of `_.memoize` which clears the memoized function's
 * cache when it exceeds `MAX_MEMOIZE_SIZE`.
 *
 * @private
 * @param {Function} func The function to have its output memoized.
 * @returns {Function} Returns the new memoized function.
 */
function memoizeCapped(func) {
  var result = memoize(func, function (key) {
    if (cache.size === MAX_MEMOIZE_SIZE) {
      cache.clear();
    }
    return key;
  });

  var cache = result.cache;
  return result;
}

module.exports = memoizeCapped;

/***/ }),
/* 132 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var MapCache = __webpack_require__(29);

/** Error message constants. */
var FUNC_ERROR_TEXT = 'Expected a function';

/**
 * Creates a function that memoizes the result of `func`. If `resolver` is
 * provided, it determines the cache key for storing the result based on the
 * arguments provided to the memoized function. By default, the first argument
 * provided to the memoized function is used as the map cache key. The `func`
 * is invoked with the `this` binding of the memoized function.
 *
 * **Note:** The cache is exposed as the `cache` property on the memoized
 * function. Its creation may be customized by replacing the `_.memoize.Cache`
 * constructor with one whose instances implement the
 * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)
 * method interface of `clear`, `delete`, `get`, `has`, and `set`.
 *
 * @static
 * @memberOf _
 * @since 0.1.0
 * @category Function
 * @param {Function} func The function to have its output memoized.
 * @param {Function} [resolver] The function to resolve the cache key.
 * @returns {Function} Returns the new memoized function.
 * @example
 *
 * var object = { 'a': 1, 'b': 2 };
 * var other = { 'c': 3, 'd': 4 };
 *
 * var values = _.memoize(_.values);
 * values(object);
 * // => [1, 2]
 *
 * values(other);
 * // => [3, 4]
 *
 * object.a = 2;
 * values(object);
 * // => [1, 2]
 *
 * // Modify the result cache.
 * values.cache.set(object, ['a', 'b']);
 * values(object);
 * // => ['a', 'b']
 *
 * // Replace `_.memoize.Cache`.
 * _.memoize.Cache = WeakMap;
 */
function memoize(func, resolver) {
  if (typeof func != 'function' || resolver != null && typeof resolver != 'function') {
    throw new TypeError(FUNC_ERROR_TEXT);
  }
  var memoized = function memoized() {
    var args = arguments,
        key = resolver ? resolver.apply(this, args) : args[0],
        cache = memoized.cache;

    if (cache.has(key)) {
      return cache.get(key);
    }
    var result = func.apply(this, args);
    memoized.cache = cache.set(key, result) || cache;
    return result;
  };
  memoized.cache = new (memoize.Cache || MapCache)();
  return memoized;
}

// Expose `MapCache`.
memoize.Cache = MapCache;

module.exports = memoize;

/***/ }),
/* 133 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseToString = __webpack_require__(134);

/**
 * Converts `value` to a string. An empty string is returned for `null`
 * and `undefined` values. The sign of `-0` is preserved.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Lang
 * @param {*} value The value to convert.
 * @returns {string} Returns the converted string.
 * @example
 *
 * _.toString(null);
 * // => ''
 *
 * _.toString(-0);
 * // => '-0'
 *
 * _.toString([1, 2, 3]);
 * // => '1,2,3'
 */
function toString(value) {
  return value == null ? '' : baseToString(value);
}

module.exports = toString;

/***/ }),
/* 134 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _Symbol = __webpack_require__(22),
    arrayMap = __webpack_require__(135),
    isArray = __webpack_require__(14),
    isSymbol = __webpack_require__(35);

/** Used as references for various `Number` constants. */
var INFINITY = 1 / 0;

/** Used to convert symbols to primitives and strings. */
var symbolProto = _Symbol ? _Symbol.prototype : undefined,
    symbolToString = symbolProto ? symbolProto.toString : undefined;

/**
 * The base implementation of `_.toString` which doesn't convert nullish
 * values to empty strings.
 *
 * @private
 * @param {*} value The value to process.
 * @returns {string} Returns the string.
 */
function baseToString(value) {
  // Exit early for strings to avoid a performance hit in some environments.
  if (typeof value == 'string') {
    return value;
  }
  if (isArray(value)) {
    // Recursively convert values (susceptible to call stack limits).
    return arrayMap(value, baseToString) + '';
  }
  if (isSymbol(value)) {
    return symbolToString ? symbolToString.call(value) : '';
  }
  var result = value + '';
  return result == '0' && 1 / value == -INFINITY ? '-0' : result;
}

module.exports = baseToString;

/***/ }),
/* 135 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * A specialized version of `_.map` for arrays without support for iteratee
 * shorthands.
 *
 * @private
 * @param {Array} [array] The array to iterate over.
 * @param {Function} iteratee The function invoked per iteration.
 * @returns {Array} Returns the new mapped array.
 */
function arrayMap(array, iteratee) {
  var index = -1,
      length = array == null ? 0 : array.length,
      result = Array(length);

  while (++index < length) {
    result[index] = iteratee(array[index], index, array);
  }
  return result;
}

module.exports = arrayMap;

/***/ }),
/* 136 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseHasIn = __webpack_require__(137),
    hasPath = __webpack_require__(138);

/**
 * Checks if `path` is a direct or inherited property of `object`.
 *
 * @static
 * @memberOf _
 * @since 4.0.0
 * @category Object
 * @param {Object} object The object to query.
 * @param {Array|string} path The path to check.
 * @returns {boolean} Returns `true` if `path` exists, else `false`.
 * @example
 *
 * var object = _.create({ 'a': _.create({ 'b': 2 }) });
 *
 * _.hasIn(object, 'a');
 * // => true
 *
 * _.hasIn(object, 'a.b');
 * // => true
 *
 * _.hasIn(object, ['a', 'b']);
 * // => true
 *
 * _.hasIn(object, 'b');
 * // => false
 */
function hasIn(object, path) {
  return object != null && hasPath(object, path, baseHasIn);
}

module.exports = hasIn;

/***/ }),
/* 137 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * The base implementation of `_.hasIn` without support for deep paths.
 *
 * @private
 * @param {Object} [object] The object to query.
 * @param {Array|string} key The key to check.
 * @returns {boolean} Returns `true` if `key` exists, else `false`.
 */
function baseHasIn(object, key) {
  return object != null && key in Object(object);
}

module.exports = baseHasIn;

/***/ }),
/* 138 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var castPath = __webpack_require__(49),
    isArguments = __webpack_require__(42),
    isArray = __webpack_require__(14),
    isIndex = __webpack_require__(44),
    isLength = __webpack_require__(33),
    toKey = __webpack_require__(25);

/**
 * Checks if `path` exists on `object`.
 *
 * @private
 * @param {Object} object The object to query.
 * @param {Array|string} path The path to check.
 * @param {Function} hasFunc The function to check properties.
 * @returns {boolean} Returns `true` if `path` exists, else `false`.
 */
function hasPath(object, path, hasFunc) {
  path = castPath(path, object);

  var index = -1,
      length = path.length,
      result = false;

  while (++index < length) {
    var key = toKey(path[index]);
    if (!(result = object != null && hasFunc(object, key))) {
      break;
    }
    object = object[key];
  }
  if (result || ++index != length) {
    return result;
  }
  length = object == null ? 0 : object.length;
  return !!length && isLength(length) && isIndex(key, length) && (isArray(object) || isArguments(object));
}

module.exports = hasPath;

/***/ }),
/* 139 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * This method returns the first argument it receives.
 *
 * @static
 * @since 0.1.0
 * @memberOf _
 * @category Util
 * @param {*} value Any value.
 * @returns {*} Returns `value`.
 * @example
 *
 * var object = { 'a': 1 };
 *
 * console.log(_.identity(object) === object);
 * // => true
 */
function identity(value) {
  return value;
}

module.exports = identity;

/***/ }),
/* 140 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseProperty = __webpack_require__(141),
    basePropertyDeep = __webpack_require__(142),
    isKey = __webpack_require__(34),
    toKey = __webpack_require__(25);

/**
 * Creates a function that returns the value at `path` of a given object.
 *
 * @static
 * @memberOf _
 * @since 2.4.0
 * @category Util
 * @param {Array|string} path The path of the property to get.
 * @returns {Function} Returns the new accessor function.
 * @example
 *
 * var objects = [
 *   { 'a': { 'b': 2 } },
 *   { 'a': { 'b': 1 } }
 * ];
 *
 * _.map(objects, _.property('a.b'));
 * // => [2, 1]
 *
 * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');
 * // => [1, 2]
 */
function property(path) {
  return isKey(path) ? baseProperty(toKey(path)) : basePropertyDeep(path);
}

module.exports = property;

/***/ }),
/* 141 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * The base implementation of `_.property` without support for deep paths.
 *
 * @private
 * @param {string} key The key of the property to get.
 * @returns {Function} Returns the new accessor function.
 */
function baseProperty(key) {
  return function (object) {
    return object == null ? undefined : object[key];
  };
}

module.exports = baseProperty;

/***/ }),
/* 142 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var baseGet = __webpack_require__(48);

/**
 * A specialized version of `baseProperty` which supports deep paths.
 *
 * @private
 * @param {Array|string} path The path of the property to get.
 * @returns {Function} Returns the new accessor function.
 */
function basePropertyDeep(path) {
  return function (object) {
    return baseGet(object, path);
  };
}

module.exports = basePropertyDeep;

/***/ }),
/* 143 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var overArg = __webpack_require__(45);

/** Built-in value references. */
var getPrototype = overArg(Object.getPrototypeOf, Object);

module.exports = getPrototype;

/***/ }),
/* 144 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.resource", ["vdi.resource.pool", "vdi.resource.console", "vdi.resource.storage"]);

/***/ }),
/* 145 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
* vdi.resource.storage Module
*
* Description
*/

angular.module('vdi.resource.storage', []).factory('Storage', ['$resource', '$Domain', function ($resource, $Domain) {
	return $resource($Domain + "/thor/storages", null, {
		query: { method: "GET" },
		get_iscsi: { method: "GET", url: $Domain + "/thor/storage/getScsi" },
		// 删除存储
		delete: { method: "DELETE", url: $Domain + "/thor/storage" },
		// 新增存储
		add: { method: "POST", url: $Domain + "/thor/storage" },
		get_lun: { method: "GET", url: $Domain + "/thor/storages/:storage_type", params: { storage_type: "@storage_type" } },
		//获取管理节点
		get_node: { method: "GET", url: $Domain + "/thor/resource/nodes" },
		//配置公共存储
		config_public_storage: { method: "POST", url: $Domain + "/thor/storages" },
		//获取公共存储
		get_public_storage: { method: "GET", url: $Domain + "/thor/storages" },
		//获取主机下的可用存储
		get_luns: { method: "GET", url: $Domain + "/thor/list_storage_with_hosts" }
	});
}]).filter('ObjectFilter', function () {
	return function (data, key) {
		var rtn = {};
		if (key) {
			data[key] && (rtn[key] = data[key]);
		} else {
			rtn = data;
		}
		return rtn;
	};
}).controller('vdiResourceStorageListController', ['$scope', '$http', 'Storage', '$modal', "$filter", function ($scope, $http, Storage, $modal, $filter) {
	// 数据按照 资源池/主机分类
	var process_data = function process_data(storages, _servers, _pools) {
		var pools = angular.copy(_pools);
		var servers = angular.copy(_servers);
		var smap = storages.reduce(function (d, s) {
			if (s.storage_type) {
				d[s.storage_host_uuid] ? d[s.storage_host_uuid].push(s) : d[s.storage_host_uuid] = [s];
			}
			return d;
		}, {});
		var hmap = servers.reduce(function (d, server) {
			if (smap[server.id]) {
				server.storages = smap[server.id].sort(function (a, b) {
					return a.storage_order - b.storage_order;
				});
				d[server.resource_pool_uuid] ? d[server.resource_pool_uuid].push(server) : d[server.resource_pool_uuid] = [server];
			}
			return d;
		}, {});
		var pmap = pools.reduce(function (d, pool) {
			if (hmap[pool.id]) {
				pool.servers = hmap[pool.id];
				d[pool.name] = pool;
			}
			return d;
		}, {});
		return pmap;
	};
	// 数据按照 存储类型/服务器地址 分类
	var process_unsiggndata = function process_unsiggndata(storages) {
		var datas = {};
		storages.forEach(function (o) {
			if (datas[o.device_type]) {
				if (datas[o.device_type][o.ip]) {
					datas[o.device_type][o.ip].push(o);
				} else {
					datas[o.device_type][o.ip] = [o];
				}
			} else {
				datas[o.device_type] = {};
				datas[o.device_type][o.ip] = [o];
			}
		});
		return datas;
	};
	$scope.get_obj_length = function (data) {
		if (data) {
			return Object.keys(data).length;
		}
	};
	$scope.filterLocalStorage = function (name) {
		$scope.datas.local_storages = $filter('ObjectFilter')($scope.datas.bak_local_storages, name);
	};
	$scope.get_list = function () {
		$scope.loading = true;
		Storage.query(function (res) {
			var local = [],
			    remote_assigned = [],
			    remote_unassigned = [];

			$scope.pools = res.pools.sort(function (a, b) {
				return a.name > b.name ? 1 : -1;
			});
			res.storages.forEach(function (item) {
				if (item.device_type === 'local') {
					local.push(item);
				} else {
					if (item.storage_type) {
						remote_assigned.push(item);
					} else {
						remote_unassigned.push(item);
					}
				}
			});
			$scope.datas = {
				storages: res.storages,
				local_storages: process_data(local, res.servers, res.pools),
				bak_local_storages: process_data(local, res.servers, res.pools),
				// local_unassigned_storages: local.filter(function(l){ return !l.storage_type }),
				remote_assigned_storages: process_data(remote_assigned, res.servers, res.pools),
				remote_unassigned_storages: process_unsiggndata(remote_unassigned)
			};
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.get_list();
	var get_list = $scope.get_list;
	$scope.delete = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除存储'>" + "删除存储</h4></div><div class='modal-body'><form class='form-horizontal'><p ng-show='!has_run' style='margin-bottom:10px;' localize='确认删除存储吗'>确认删除存储吗</p><footer class='text-right'><button class='btn btn-primary ' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					Storage.delete({ storage_id: item.uuid }, function () {
						get_list();
					});
					$modalInstance.close();
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller('addStorageDialog', ['$scope', 'Storage', '$modalInstance', 'ResourcePool', function ($scope, Storage, $modalInstance, ResourcePool) {

	$scope.storage = {
		iscsi: {},
		fc: {}
	};
	$scope.loading = true;

	// $scope.datas为父scope中数据
	// $scope.has_remote_storage = Object.keys($scope.datas.remote_assigned_storages).length + Object.keys($scope.datas.remote_unassigned_storages).length > 0 ? true : false;
	$scope.storage.storage_usability = 'instance';

	ResourcePool.query(function (res) {
		$scope.resource_pools = res.result.filter(function (p) {
			return p.type === 'kvm';
		});
		$scope.storage.resource_pool = $scope.resource_pools[0];
		$scope.get_nodes();
	});

	function get_manage_node_id() {
		return $scope.storage.manage_node.map(function (node) {
			return node.node_uuid;
		});
	}

	$scope.get_nodes = function () {
		$scope.loading = true;
		var _resource_uuid = $scope.storage.storage_usability === 'instance' ? $scope.storage.resource_pool.uuid : undefined;
		Storage.get_node({
			storage_usability: $scope.storage.storage_usability,
			resource_pool_uuid: _resource_uuid
		}, function (res) {
			var firstKey = Object.keys(res.result)[0];
			$scope.nodes = res.result;
			$scope.storage.manage_node = $scope.nodes[firstKey];
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.searchISCSI = function (bool) {
		$scope.loading = true;
		$scope.iscsi_luns = [];
		$scope.storage.iscsi.target = null;
		var postData = {};
		postData.storage_usability = $scope.storage.storage_usability;
		postData.host = $scope.storage.iscsi.host;
		postData.node_uuid = get_manage_node_id();
		if (bool) {
			postData.to_redetect = true;
		}
		Storage.get_iscsi(postData, function (res) {
			$scope.iscsi_targets = res.iqn_list || [];
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.formatLun = function (_lun) {
		return _lun.vendor + " lun-" + _lun.lun + " " + (_lun.size / Math.pow(1024, 3)).toFixed(2) + "GB";
	};
	$scope.searchISCSIlun = function () {
		if (!$scope.storage.iscsi.target) {
			$scope.iscsi_luns = [];
			$scope.storage.fc = null;
			return;
		}
		$scope.loading = true;
		var postData = {};
		postData.storage_usability = $scope.storage.storage_usability;
		postData.storage_type = 'iscsi';
		postData.host = $scope.storage.iscsi.host;
		postData.target_iqn = $scope.storage.iscsi.target;
		postData.node_uuid = get_manage_node_id();
		Storage.get_lun(postData, function (res) {
			$scope.iscsi_luns = res.data;
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.searchFClun = function (bool) {
		$scope.loading = true;
		$scope.storage.fc = null;
		var postData = {};
		postData.storage_type = 'fc';
		postData.storage_usability = $scope.storage.storage_usability;
		postData.node_uuid = get_manage_node_id();
		if (bool) {
			postData.to_redetect = true;
		}
		Storage.get_lun(postData, function (res) {
			$scope.fc_luns = res.data;
			$scope.loadlun = false;
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};

	$scope.switchType = function (type) {
		$scope.clear_luns();
		switch (type) {
			//FC
			case 'fc':
				{
					$scope.searchFClun();
					break;
				};
			//iscsi
			case 'iscsi':
				{
					break;
				};
			// 分布式存储
			case '3':
				{
					break;
				};
		}
		setTimeout(function () {
			$("[rel=popover-hover]").popover({ trigger: "hover" });
		});
	};
	$scope.clear_luns = function () {
		$scope.storage.iscsi = null;
		$scope.storage.fc = null;
		$scope.iscsi_targets = null;
		$scope.iscsi_luns = null;
		$scope.fc_luns = null;
	};
	$scope.clear_mess = function () {
		$scope.storage.type = null;
		$scope.clear_luns();
	};
	$scope.ok = function () {
		$scope.loading = true;
		var postData = {
			name: $scope.storage.name,
			storage_type: $scope.storage.type,
			storage_usability: $scope.storage.storage_usability
		};
		// if(postData.storage_usability === 'instance'){
		postData.node_uuid = $scope.storage.manage_node.map(function (node) {
			return [node.node_uuid, node.resource_pool_uuid];
		});
		// }
		if (postData.storage_type === 'fc') {
			postData.device_name = $scope.storage.fc.lun.device_name;
			postData.lun_id = $scope.storage.fc.lun.lun;
			postData.scsi_id = $scope.storage.fc.lun.scsi_id;
			postData.force = $scope.storage.fc.is_format;
			postData.dynamic_lv = $scope.storage.fc.dynamic_lv || false;
		}
		if (postData.storage_type === 'iscsi') {
			postData.device_name = $scope.storage.iscsi.lun.device_name;
			postData.provider = $scope.storage.iscsi.host;
			postData.force = $scope.storage.iscsi.is_format;
			postData.dynamic_lv = $scope.storage.iscsi.dynamic_lv || false;
			postData.target_iqn = $scope.storage.iscsi.target;
			postData.scsi_id = $scope.storage.iscsi.lun.scsi_id;
			postData.lun_id = $scope.storage.iscsi.lun.lun;
		}
		Storage.add({ storage: postData }, function (res) {
			$scope.$parent.get_list();
			$modalInstance.close(res);
		}).$promise.finally(function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller('configPublicStorageDialog', ['$scope', 'Storage', '$modalInstance', function ($scope, Storage, $modalInstance) {
	Storage.get_public_storage({
		storage_usability: "local"
	}, function (res) {
		$scope.luns = res.host_storages;
		$scope.lun_id = res.choosed_storage === 'local' ? '' : res.choosed_storage;
		$scope.lun_type = res.choosed_storage === 'local' ? "local" : "remote";
	});
	$scope.clearlun = function () {
		var _this = this;
		this.lun_id = undefined;
	};
	$scope.ok = function () {
		var _this = this;
		$scope.submitting = true;
		Storage.config_public_storage({
			storage_id: _this.lun_id
		}, function () {
			$scope.$parent.get_list();
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.submitting = false;
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]);

/***/ }),
/* 146 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
*  Module
*
* Description
*/
angular.module('vdi.resource.console', []).factory("Console", ["$resource", "$Domain", "$controllerDomain", function ($resource, $Domain, $controllerDomain) {
	return $resource($Domain + "/thor/hosts", null, {
		query_console: { method: "GET", url: $Domain + "/thor/controllers" },
		save_ip: { method: "POST", url: $Domain + "/thor/host/external_ip" },
		get_sync_network: { method: "POST", url: $Domain + "/thor/get_data_sync_network" },
		get_ha_status: { method: "GET", url: $Domain + "/thor/get_controller_ha_status" },
		switch_controller: { method: "POST", url: $Domain + "/thor/switch_controller" },
		fast_shutdown: { method: "POST", url: $Domain + "/thor/controller/fast_shutdown_host" },
		get_ha_detail: { method: "GET", url: $Domain + "/thor/controller/ha" }
	});
}]).factory('maskModel', ['$rootScope', '$modal', function ($rootScope, $modal) {
	//服务重启的情况下，页面增加遮罩层
	return {
		open: function open(node_ids, page_type) {
			var instance = $modal.open({
				size: "sm",
				controller: ["$modalInstance", "$scope", function ($modalInstance, $scope) {
					// 60秒后开始判断服务是否重启完成
					setTimeout(function () {
						switch (page_type) {
							case "manageNetwork":
								$scope.$on("manage_networksRowsUpdate", function ($event, data) {
									if (data.length && data.every(function (n) {
										return n.state;
									})) {
										location.reload();
										$modalInstance.close();
									}
								});
								break;
							case "enableConsoleHA":
								$scope.$on("nodesRowsUpdate", function ($event, data) {
									var nodes = data.filter(function (item) {
										return node_ids.indexOf(Number(item.tasklog_controller_id)) !== -1;
									});
									if (nodes.every(function (n) {
										return n.enable_ha_service_state;
									})) {
										location.reload();
										$modalInstance.close();
									}
								});
								break;
							case "disableConsoleHA":
								$scope.$on("nodesRowsUpdate", function ($event, data) {
									var nodes = data.filter(function (item) {
										return node_ids.indexOf(Number(item.tasklog_controller_id)) !== -1;
									});
									if (nodes.every(function (n) {
										return n.disable_ha_service_state;
									})) {
										location.reload();
										$modalInstance.close();
									}
								});
								break;
							default:
								$scope.$on("nodesRowsUpdate", function ($event, data) {
									var nodes = data.filter(function (item) {
										return node_ids.indexOf(item.id) !== -1;
									});
									if (nodes.every(function (n) {
										return n.service_state;
									})) {
										location.reload();
										$modalInstance.close();
									}
								});
								break;
						}
					}, 60000);
				}],
				template: "<div class=\"modal-content-blank\">\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<img src=\"img/loadingtext.gif\" alt=\"\" width=\"24\" height=\"24\">\n\t\t\t\t\t\t\t\t<span localize=\"MASKMODEL_WAITING_TIPS\"></span>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>"
			});
			return instance;
		}
	};
}])
// 通用接口：查询是否启用 HA
.factory("isHAEnabled", ["Console", function (Console) {
	return function () {
		return Console.get_ha_status().$promise.then(function (data) {
			return data.result.ha_mode === "active_passive";
		});
	};
}]).controller('vdiResourceConsoleListController', ['$scope', '$modal', '$$$I18N', 'Console', 'Host', '$rootScope', '$interval', function ($scope, $modal, $$$I18N, Console, Host, $rootScope, $interval) {
	$scope.rows = [];
	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("nodes", $scope.rows.map(function (item) {
			return item.tasklog_controller_id;
		}));
	}, 1000);
	$scope.$on("nodesRowsUpdate", function ($event, data) {
		// 列表接口的tasklog_controller_id字段与轮询接口的id字段对应
		$rootScope.activeHostIds = $scope.rows.filter(function (row) {
			return row.status === 'active';
		}).map(function (row) {
			return row.id;
		});
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.tasklog_controller_id] = item;
		});
		data.forEach(function (item) {
			if (_rows[item.tasklog_controller_id]) {
				for (var k in item) {
					_rows[item.tasklog_controller_id][k] = item[k];
				}
			}
		});
	});
	var get_list = function get_list() {
		$scope.loading = true;
		Console.query_console(function (res) {
			$scope.loading = false;
			$scope.rows = res.result.map(function (item, idx, arr) {
				item.memory_mb = (item.memory_mb / 1024).toFixed(1);
				item.memory_mb_used = (item.memory_mb_used / 1024).toFixed(1);
				item._has_ha = arr.length > 1;
				return item;
			});
		});
	};
	get_list();
	getHAStatus();

	$scope.openHostMoreDialog = function (item) {
		var _dialog = $modal.open({
			controller: "consoleMoreDialog",
			templateUrl: "views/vdi/dialog/resource/console/console_more.html",
			size: "lg",
			resolve: {
				param: function param() {
					return item;
				}
			}
		});
	};
	$scope.openHAConfigDialog = function (item) {
		var backup_agent = $scope.rows.filter(function (row) {
			return row.role === 'backup';
		})[0];
		item._btn_status = backup_agent ? backup_agent.status === 'active' : true;
		var _dialog = $modal.open({
			controller: "HAconfigDialog",
			templateUrl: "views/vdi/dialog/resource/console/ha_config.html",
			size: "md",
			resolve: {
				param: function param() {
					return item;
				}
			}
		});
		// _dialog.result.then(function(){
		// 	get_list();
		// });
	};
	$scope.restart = function (item) {
		var rows = (item ? [item] : $scope.rows).filter(function (item) {
			return item.status === 'active';
		});
		if (rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='重启主机'>" + "重启主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启主机吗?'>确定重启主机吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						Host.maintain_host({
							action: "reboot_host",
							host_ips: rows.map(function (row) {
								return row.ip;
							})
						}, function (res) {
							$rootScope.$broadcast('NOAUTH');
							location.reload();
						});
						$modalInstance.close();
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiResourceHostList_TIP1"),
				timeout: 6000
			});
		}
	};

	$scope.poweroff = function (item) {
		var rows = (item ? [item] : $scope.rows).filter(function (item) {
			return item.status === 'active';
		});
		if (rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>\xD7</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='\u5173\u95ED\u4E3B\u673A'>\"+\n\t\t\t\t\t\t\"\u5173\u95ED\u4E3B\u673A</h4></div><div class='modal-body'>\n\t\t\t\t\t\t\t<form class='form-horizontal'>\n\t\t\t\t\t\t\t\t<p style='margin-bottom:20px;' localize='\u786E\u5B9A\u5173\u95ED\u4E3B\u63A7\u8282\u70B9\u5417'></p><footer class='text-right'>\n\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t<label class=\"col-xs-12\" style='text-align: left;'>\n\t\t\t\t\t\t\t\t\t\t<input class=\"checkbox ng-pristine ng-valid\" type=\"checkbox\" data-ng-model=\"all\" data-ng-init='all=true'>\n\t\t\t\t\t\t\t\t\t\t<span localize='\u540C\u65F6\u5173\u95ED\u6240\u6709\u8FD0\u884C\u7684\u684C\u9762\u548C\u8BA1\u7B97\u8282\u70B9'></span>\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<button class='btn btn-primary' data-ng-click='ok()' localize='\u786E\u5B9A'>\u786E\u5B9A</button>\n\t\t\t\t\t\t\t\t<button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='\u53D6\u6D88'>\u53D6\u6D88</button>\n\t\t\t\t\t\t\t</footer>\n\t\t\t\t\t\t</form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						Host.shutdown({
							all: this.all
						}, function (res) {
							$rootScope.$broadcast('NOAUTH');
							location.reload();
						});
						$modalInstance.close();
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiResourceHostList_TIPACTIVE"),
				timeout: 6000
			});
		}
	};
	$scope.poweroffBackup = function (item) {
		var rows = (item ? [item] : $scope.rows).filter(function (item) {
			return item.status === 'active';
		});
		if (rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>\xD7</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='\u5173\u95ED\u4E3B\u673A'>\"+\n\t\t\t\t\t\t\"\u5173\u95ED\u4E3B\u673A</h4></div><div class='modal-body'>\n\t\t\t\t\t\t\t<form class='form-horizontal'>\n\t\t\t\t\t\t\t\t<p style='margin-bottom:20px;' localize='\u786E\u5B9A\u5173\u95ED\u4E3B\u673A\u5417'></p><footer class='text-right'>\n\t\t\t\t\t\t\t\t<button class='btn btn-primary' data-ng-click='ok()' localize='\u786E\u5B9A'>\u786E\u5B9A</button>\n\t\t\t\t\t\t\t\t<button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='\u53D6\u6D88'>\u53D6\u6D88</button>\n\t\t\t\t\t\t\t</footer>\n\t\t\t\t\t\t</form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						Host.maintain_host({
							host_ips: rows.map(function (item) {
								return item.ip;
							}),
							action: "poweroff_host"
						});
						$modalInstance.close();
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiResourceHostList_TIPACTIVE"),
				timeout: 6000
			});
		}
	};
	// $scope.maintain = function(){
	// 	var rows = $scope.rows.filter(function(item) {return item._selected});
	// 	$modal.open({
	// 		template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='维护主机'>"+
	// 				"维护主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定维护主机吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

	// 		controller: function($scope, $modalInstance){
	// 			$scope.ok = function(){
	// 				Host.maintain_host({
	// 					action:"maintenance_host",
	// 					host_ips:rows.map(function(item){ return item.ip })
	// 				},function(res){
	// 					get_list();
	// 				});
	// 				$modalInstance.close();
	// 			},
	// 			$scope.close = function(){
	// 				$modalInstance.close();
	// 			}
	// 		},
	// 		size : "sm"
	// 	});
	// };
	// $scope.recovery = function(){
	// 	var rows = $scope.rows.filter(function(item) {return item._selected});
	// 	$modal.open({
	// 		template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='恢复主机'>"+
	// 				"恢复主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定恢复主机吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

	// 		controller: function($scope, $modalInstance){
	// 			$scope.ok = function(){
	// 				Host.maintain_host({
	// 					action:"recovery_host",
	// 					host_ips:rows.map(function(item){ return item.ip })
	// 				},function(res){
	// 					get_list();
	// 				});
	// 				$modalInstance.close();
	// 			},
	// 			$scope.close = function(){
	// 				$modalInstance.close();
	// 			}
	// 		},
	// 		size : "sm"
	// 	});
	// };
	$scope.current_theme = $$$storage.getSessionStorage('current_theme') || "smart-style-0";
	$scope.$on("changeSkin", function (e, value) {
		$scope.current_theme = value;
	});
	// HA 查看详情
	$scope.viewDetail = function () {
		$modal.open({
			templateUrl: "views/vdi/dialog/resource/console/ha-detail.html",
			controller: "HAViewDetailDialogController",
			windowClass: "ha-detail-modal",
			resolve: {
				data: function data() {
					return $scope.ha;
				}
			}
		});
	};
	// HA 主备控切换
	$scope.switchBrain = function () {
		$modal.open({
			templateUrl: "views/vdi/dialog/resource/console/ha-switch-brain.html",
			controller: "HASwitchBrainDialogController",
			resolve: {
				data: function data() {
					return $scope.ha;
				}
			}
		});
	};
	// HA 一键关机
	$scope.onekeyShutdown = function () {
		$modal.open({
			templateUrl: "views/vdi/dialog/resource/console/ha-shutdown.html",
			controller: "HAShutdownDialogController",
			resolve: {
				data: function data() {
					return $scope.ha;
				}
			}
		});
	};
	// 获取 HA 状态
	function getHAStatus() {
		Console.get_ha_status(function (resp) {
			$scope.ha = resp.result;
			$scope.haEnabled = resp.result.ha_mode === "active_passive";
			var hasActive = false,
			    hasPassive = false;
			$scope.ha.roles.forEach(function (x) {
				if (x.role === "active") {
					hasActive = true;
				} else if (x.role === "passive") {
					hasPassive = true;
				}
			});
			$scope.switchable = hasActive && hasPassive && !$scope.ha.is_split_brain;
		});
	}
}]).filter("haDataStatus", ["$$$I18N", function (i18n) {
	return function (data) {
		var key;
		if (!data || (typeof data === "undefined" ? "undefined" : _typeof(data)) !== "object") {
			return "";
		}
		switch (data.data_sync) {
			case "synced":
				key = "已同步";
				break;
			case "syncing":
				key = "正在同步";
				break;
			case "unsynced":
				key = "未同步";
				break;
		}
		return i18n.get(key);
	};
}]).filter("haRunningStatus", ["$$$I18N", function (i18n) {
	return function (data) {
		if (!data || (typeof data === "undefined" ? "undefined" : _typeof(data)) !== "object") {
			return "";
		}
		var num = data.roles.filter(function (x) {
			return x.role === "passive";
		}).length;
		if (data.is_split_brain) {
			return "异常（有" + num + "个备控，裂脑）";
		} else {
			return "正常";
		}
	};
}]).directive("haDrawwer", ["$q", function ($q) {
	return {
		scope: {
			data: "="
		},
		link: function link(scope, element) {
			var context = element[0].getContext("2d");
			if (!context) {
				return;
			}
			var loaded = false;
			$q.all(["main-ctrl", "sub-ctrl", "arbitration", "error", "warn"].map(function (id) {
				id = "#ha-detail-" + id;
				return new Promise(function (resolve, reject) {
					var el = document.querySelector(id);
					if (el.complete) {
						return resolve();
					}
					el.addEventListener("load", function onImgLoad() {
						el.removeEventListener("load", onImgLoad);
						resolve();
					});
				});
			})).then(function () {
				loaded = true;
				update();
			});
			scope.$on("$destroy", scope.$watch("data", update));
			function update() {
				if (!loaded) {
					return;
				}
				var w = element.width();
				var h = element.height();
				var scale = getCanvasScale(context);
				element.attr("width", w * scale);
				element.attr("height", h * scale);
				context.scale(scale, scale);
				draw(context, w, h, scope.data);
			}
		}
	};
	function draw(context, width, height, data) {
		var dataColor = "#16ee21";
		var networkColor = "#73bfe9";
		// 画出来的图形总宽 60%，总高 60%
		// 外围的三角形, 根据总宽高计算
		var outerPoints = [[width * 0.2, height * 0.25 + 30], [width * 0.8, height * 0.25 + 30], [width * 0.5, height * 0.75 + 15]];
		// 左上角角度
		var topLeftAngle = Math.atan2(outerPoints[2][1] - outerPoints[0][1], outerPoints[2][0] - outerPoints[0][0]);
		var drawTriangle = function drawTriangle(point, i) {
			if (i === 0) {
				context.beginPath();
				context.moveTo(point[0], point[1]);
			} else {
				context.lineTo(point[0], point[1]);
				if (i === 2) {
					context.closePath();
					context.stroke();
				}
			}
		};
		var drawLine = function drawLine(point1, point2, color) {
			context.strokeStyle = color;
			context.beginPath();
			context.moveTo(point1[0], point1[1]);
			context.lineTo(point2[0], point2[1]);
			context.stroke();
		};
		var widthOf = function widthOf(str) {
			return context.measureText(str).width;
		};
		var drawBetween = function drawBetween(p1, p2, type) {
			var x = (p1[0] + p2[0]) / 2;
			var y = (p1[1] + p2[1]) / 2;
			var el = document.querySelector("#ha-detail-" + type);
			// 图标的大小为：25 * 24
			context.drawImage(el, x - 12.5, y - 12);
		};
		context.clearRect(0, 0, width, height);
		// context.lineWidth = 3.0;
		context.strokeStyle = networkColor;
		outerPoints.forEach(drawTriangle);
		drawLine([outerPoints[0][0], outerPoints[0][1] - 40], [outerPoints[1][0], outerPoints[1][1] - 40], dataColor);
		context.drawImage(document.querySelector("#ha-detail-main-ctrl"), outerPoints[0][0] - 34.5, outerPoints[0][1] - 62);
		context.drawImage(document.querySelector("#ha-detail-sub-ctrl"), outerPoints[1][0] - 34.5, outerPoints[1][1] - 62);
		context.drawImage(document.querySelector("#ha-detail-arbitration"), outerPoints[2][0] - 34.5, outerPoints[2][1] - 73);
		context.font = "13px 'Open Sans', Arial, Helvetica, 'Microsoft YaHei', Sans-Serif";
		context.fillStyle = dataColor;
		context.fillText(data.data_sync_ip, outerPoints[0][0] - 40 - widthOf(data.data_sync_ip), outerPoints[0][1] - 35);
		context.fillText(data.peer_data_sync_ip, outerPoints[1][0] + 40, outerPoints[1][1] - 35);
		context.fillStyle = networkColor;
		context.fillText(data.management_ip, outerPoints[0][0] - 40 - widthOf(data.management_ip), outerPoints[0][1] - 10);
		context.fillText(data.peer_management_ip, outerPoints[1][0] + 40, outerPoints[1][1] - 10);
		context.fillText(data.quorum_ip_addresses[0], outerPoints[2][0] - widthOf(data.quorum_ip_addresses[0]) / 2, outerPoints[2][1] + 20);
		if (data.peer_data_to_data === false) {
			drawBetween([outerPoints[0][0], outerPoints[0][1] - 40], [outerPoints[1][0], outerPoints[1][1] - 40], "error");
		}
		if (data.peer_management_to_management === false) {
			drawBetween(outerPoints[0], outerPoints[1], data.is_peer_unknow ? "warn" : "error");
		}
		if (data.quorum_to_management[0] === false) {
			drawBetween(outerPoints[0], outerPoints[2], "error");
		}
		if (data.quorum_to_management[1] === false) {
			drawBetween(outerPoints[1], outerPoints[2], "error");
		}
	}
	function getCanvasScale(context) {
		var devicePixelRatio = window.devicePixelRatio || 1;
		var backingStoreRatio = context.webkitBackingStorePixelRatio || context.mozBackingStorePixelRatio || context.msBackingStorePixelRatio || context.oBackingStorePixelRatio || context.backingStorePixelRatio || 1;
		return devicePixelRatio / backingStoreRatio;
	}
}]).controller("HAViewDetailDialogController", ["$modalInstance", "$q", "$scope", "Console", "data", function ($modalInstance, $q, $scope, Console, data) {
	$scope.firstLoading = true;
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.refresh = load;
	load();
	function load() {
		$q.all([Console.get_ha_status().$promise, Console.get_ha_detail({ detail: 1 }).$promise]).then(function (arr) {
			$scope.ha = arr[0].result;
			$scope.detail = arr[1];
			$scope.detail.is_peer_unknow = $scope.ha.roles.some(function (x) {
				return x.role === "unknow";
			});
		}, function () {}).finally(function () {
			$scope.firstLoading = false;
		});
	}
}]).controller("HASwitchBrainDialogController", ["$modalInstance", "$scope", "Console", "data", function ($modalInstance, $scope, Console, data) {
	var switchToIP;
	data.roles.forEach(function (x) {
		if (x.role === "passive") {
			switchToIP = x.ip;
		}
	});
	console.assert(!!switchToIP, "backend data error: " + switchToIP);
	$scope.loading = false;
	$scope.close = function () {
		$modalInstance.close();
	};
	split();
	function split() {
		var timer;
		// 此接口是阻塞的，所以返回后即可确定是刷新还是报错
		Console.switch_controller({
			active_ip: switchToIP
		}, function (resp) {
			resp && location.reload();
			clearTimeout(timer);
		}, function () {
			location.reload();
			clearTimeout(timer);
		});
		$scope.loading = true;
		timer = setTimeout(function () {
			location.reload();
		}, 30 * 1000);
		$scope.$root.$broadcast("STOPLOG");
	};
}]).controller("HAShutdownDialogController", ["$modalInstance", "$scope", "Console", "data", function ($modalInstance, $scope, Console, data) {
	$scope.loading = false;
	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.shutdown = function () {
		Console.fast_shutdown();
		$scope.loading = true;
	};
}]).controller('consoleRenewDialog', ['$scope', function ($scope) {}]).controller('HAconfigDialog', ['$scope', 'HA', 'param', '$modalInstance', 'Console', 'maskModel', 'Host', '$$$I18N', function ($scope, HA, param, $modalInstance, Console, maskModel, Host, $$$I18N) {
	var isEmptyObject = function isEmptyObject(obj) {
		for (i in obj) {
			return false;
		};
		return true;
	};
	$scope.ha = {};
	$scope.ha.loadding = true;
	$scope.currentItem = param;
	HA.get_console_ha({ controller_ip: param.ip }, function (res) {
		$scope.ha = res;
		// $scope.ha.editable = $scope.ha.management_ip ? false : true;	
		$scope.ha.back_user = "root";
		$scope.ha.ha_mode = $scope.ha.ha_mode == 'off' ? false : true;
		$scope.quorums = $scope.ha.management_ip ? $scope.ha.quorum_ip_addresses.map(function (q) {
			return { ip: q };
		}) : [{ ip: null }];
	}).$promise.finally(function () {
		$scope.ha.loadding = false;
	});
	$scope.close = function () {
		$modalInstance.dismiss();
	};
	$scope.ok = function () {
		var postData = {};
		if ($scope.ha.ha_mode) {
			postData = {
				controller_ip: '',
				ha_mode: 'off',
				floating_ip: $scope.ha.floating_ip,
				quorum_ip_addresses: $scope.ha.quorum_ip_addresses,
				data_sync_ip: $scope.ha.data_sync_ip,
				peer_data_sync_ip: $scope.ha.peer_data_sync_ip,
				data_sync_mask: $scope.ha.data_sync_mask,
				management_ip: $scope.ha.management_ip,
				peer_management_ip: $scope.ha.peer_management_ip,
				sensitivity: $scope.ha.sensitivity
			};
		} else {
			var is_ip_ok = $scope.quorums.some(function (q) {
				return q.status === 'normal';
			});
			if (!is_ip_ok) {
				$.bigBox({
					title: $$$I18N.get("INFOR_TIP"),
					content: $$$I18N.get("configHATestIPConfirm"), //请先点击'测试连接'按钮，确认仲裁IP网络连通
					timeout: 6000
				});
				return;
			}
			postData = {
				controller_ip: param.ip,
				ha_mode: 'active_passive',
				floating_ip: $scope.ha.floating_ip,
				quorum_ip_addresses: $scope.quorums.map(function (q) {
					return q.ip;
				}),
				data_sync_ip: $scope.ha.network_data.data_sync_ip,
				peer_data_sync_ip: $scope.ha.network_data.peer_data_sync_ip,
				data_sync_mask: $scope.ha.network_data.data_sync_mask,
				management_ip: $scope.ha.management_ip,
				peer_management_ip: $scope.ha.peer_management_ip,
				back_user: $scope.ha.back_user,
				back_password: $scope.ha.back_password,
				sensitivity: $scope.ha.sensitivity
			};
		}
		$scope.ha.loadding = true;
		HA.set_console_ha(postData, function (res) {
			$modalInstance.close();
			maskModel.open([-1], $scope.ha.ha_mode ? "disableConsoleHA" : "enableConsoleHA");
		}).$promise.finally(function () {
			$scope.ha.loadding = false;
		});
	};
	$scope.addQuorumIp = function () {
		$scope.quorums.push({ ip: null });
	};
	$scope.minusQuorumIp = function (i) {
		var idx = $scope.quorums.indexOf(i);
		$scope.quorums.splice(idx, 1);
	};
	$scope.test_connect = function (item) {
		item.connecting = true;
		Host.node_ping({
			remote_ip: item.ip,
			node_ip: [$scope.ha.management_ip, $scope.ha.peer_management_ip]
		}, function (res) {
			item.status = res.result ? "normal" : "failed";
		}).$promise.finally(function () {
			item.connecting = false;
		});
	};
	$scope.get_network = function () {
		$scope.loading_net = true;
		Console.get_sync_network({
			master_ip: $scope.ha.management_ip,
			backup_ip: $scope.ha.peer_management_ip
		}, function (res) {
			$scope.networks = res.result;
			if (Object.keys($scope.networks).length) {
				$scope.ha.network_data = $scope.networks[Object.keys($scope.networks)[0]];
			}
		}).$promise.finally(function () {
			$scope.loading_net = false;
		});
	};
}]).controller("consoleMoreDialog", ["$scope", "$modalInstance", "Host", "HostManage", "$$$I18N", "$Domain", "param", "Storage", "Console", "maskModel", "$modal", function ($scope, $modalInstance, Host, HostManage, $$$I18N, $Domain, param, Storage, Console, maskModel, $modal) {
	var param_host = angular.copy(param);
	$scope.is_ha = param_host._has_ha;
	$scope.get_nic = function () {
		$scope.loading_nic = true;
		HostManage.network_info({
			host: param.ip,
			role: param.role,
			id: param.id || ''
		}, function (res) {
			$scope.dev_states = res.dev_states;
			$scope.networks = res.networks.map(function (item) {
				item.ips = item.ips.map(function (sub, idx) {
					return {
						ip: sub,
						netmask: item.netmasks[idx],
						ip_editable: item.ips_editable[idx],
						uneditable: item.ips_editable[idx].is_management || item.ips_editable[idx].is_image
					};
				});
				item._ips = item.ips.map(function (sub) {
					return {
						value: sub,
						model: angular.copy(sub)
					};
				});
				item.readonly = true;
				return item;
			}).sort(function (a, b) {
				return a.name > b.name;
			});
			$scope.data = {
				_dnss: [{}, {}].map(function (d, idx) {
					return {
						model: res.dns[idx],
						value: res.dns[idx]
					};
				}),
				_gateway: {
					model: res.gateway,
					value: res.gateway
				},
				_readonly: true

			};
			$scope.bond_types = res.bond_types;
			$scope.bond_networks = res.bond_networks.map(function (item) {
				item.ips = item.ips.map(function (sub, idx) {
					return {
						ip: sub,
						netmask: item.netmasks[idx],
						ip_editable: item.ips_editable[idx],
						uneditable: item.ips_editable[idx].is_management || item.ips_editable[idx].is_image
					};
				});
				item._ips = item.ips.map(function (sub) {
					return {
						value: sub,
						model: angular.copy(sub)
					};
				});
				item.readonly = true;
				return item;
			});
			$scope.getSuccess = true;
		}, function (error) {
			$scope.getSuccess = false;
		}).$promise.finally(function () {
			$scope.loading_nic = false;
		});
	};
	$scope.get_nic();
	//修改网卡
	$scope.ok = function (item) {
		item.submiting = true;
		var all_cidr = $scope.networks.concat($scope.bond_networks).reduce(function (arr, net) {
			var cidr = net._ips.map(function (ip) {
				return ip.model.ip + "/" + ip.model.netmask;
			});
			arr.push.apply(arr, cidr);
			return arr;
		}, []);
		var before_cidr = $scope.networks.concat($scope.bond_networks).reduce(function (arr, net) {
			var cidr = net.ips.map(function (ip) {
				return ip.ip + "/" + ip.netmask;
			});
			arr.push.apply(arr, cidr);
			return arr;
		}, []);
		var backItem = {
			id: param.id,
			is_console: true,
			iface: item.name,
			ips: item._ips.map(function (i) {
				return i.model.ip;
			}),
			netmasks: item._ips.map(function (i) {
				return i.model.netmask;
			}),
			ips_editable: item._ips.map(function (i) {
				return i.model.ip_editable;
			}),
			before_cidr: before_cidr,
			all_cidr: all_cidr
		};
		var no_alter = item._ips.every(function (it) {
			return it.model.ip === it.value.ip && it.model.netmask === it.value.netmask;
		});
		if (no_alter && item._ips.length === item.ips.length) {
			// 修改后的值和初始值相等时，不提交数据
			item.submiting = false;
			item.readonly = true;
		} else {
			HostManage.network_edit(backItem, function () {
				item._ips.forEach(function (i) {
					i.value = angular.copy(i.model);
				});
				item.submiting = false;
				item.readonly = true;
				location.reload();
			}, function () {
				item.submiting = false;
				item.readonly = false;
			});
		}
	};
	$scope.okDns = function (d) {
		d.submiting = true;
		var postData = {
			id: param.id,
			gateway: d._gateway.model,
			dns: d._dnss.filter(function (i) {
				return Boolean(i.model);
			}).map(function (i) {
				return i.model;
			})
		};
		var no_alter = d._dnss.concat(d._gateway).every(function (it) {
			return it.model === it.value;
		});
		if (no_alter) {
			d.submiting = false;
			d._readonly = true;
		} else {
			HostManage.alter_gatedns(postData, function () {
				d._dnss.forEach(function (dns) {
					dns.value = dns.model;
				});
				d._gateway.value = d._gateway.model;
				d._readonly = true;
				maskModel.open([-1]);
			}).$promise.finally(function () {
				d.submiting = false;
			});
		}
	};
	$scope.cancel = function (item) {
		item.readonly = true;
		item._ips = item.ips.map(function (sub) {
			return {
				value: sub,
				model: angular.copy(sub)
			};
		});
	};
	$scope.cancelDns = function (d) {
		d._readonly = true;
		d._dnss.forEach(function (dns) {
			dns.model = dns.value ? dns.value : null;
		});
		d._gateway.model = d._gateway.value;
	};
	$scope.add_ip = function (item) {
		item._ips.push({
			model: {
				ip_editable: {
					is_management: false,
					is_image: false
				},
				uneditable: false
			},
			value: {
				ip_editable: {
					is_management: false,
					is_image: false
				},
				uneditable: false
			}
		});
	};
	$scope.minus_ip = function (per, all) {
		all.splice(all.indexOf(per), 1);
	};
	$scope.bound_netcard = function () {
		var dialog = $modal.open({
			controller: "boundNetcardDialog",
			templateUrl: "views/vdi/dialog/resource/pool/bound_netcard.html",
			resolve: { param: function param() {
					return {
						p_host: angular.copy(param_host),
						p_networks: angular.copy($scope.networks),
						p_bondtypes: angular.copy($scope.bond_types),
						p_bondnetworks: angular.copy($scope.bond_networks),
						p_dev_states: angular.copy($scope.dev_states)
					};
				} }
		});
		dialog.result.then(function () {
			getNetcardList();
		});
	};
	$scope.edit_bond = function (item) {
		var dialog = $modal.open({
			controller: "editboundNetcardDialog",
			templateUrl: "views/vdi/dialog/resource/pool/bound_netcard.html",
			resolve: { param: function param() {
					return {
						p_host: angular.copy(param_host),
						p_networks: angular.copy($scope.networks),
						p_bondtypes: angular.copy($scope.bond_types),
						p_bondnetworks: angular.copy($scope.bond_networks),
						p_item: angular.copy(item),
						p_dev_states: angular.copy($scope.dev_states)
					};
				} }
		});
		dialog.result.then(function () {
			getNetcardList();
		});
	};
	$scope.unbundle_netcard = function (item) {
		var dialog = $modal.open({
			controller: "unbundleNetcardDialog",
			templateUrl: "views/vdi/dialog/resource/pool/unbundle_netcard.html",
			resolve: { param: function param() {
					return {
						p_host: angular.copy(param_host),
						p_net: angular.copy(item),
						p_dev_states: angular.copy($scope.dev_states)
					};
				} }
		});
		dialog.result.then(function () {
			getNetcardList();
		});
	};
	//硬件信息
	HostManage.hardware_info({
		host: param.ip,
		id: param.id || '',
		role: param.role
	}, function (res) {
		$scope.hardware = res;
	});
	//窗口关闭按钮
	$scope.close = function () {
		$modalInstance.close();
	};

	function getServer() {
		$scope.loading_server = true;
		Host.service_status({ ip: param_host.ip }, function (res) {
			var services = [];
			for (var name in res.result) {
				services.push({ name: name, status: res.result[name] });
			}
			$scope.servers = services;
			$scope.loading_server = false;
		}, function (error) {
			$scope.loading_server = false;
		});
	}
	getServer();
	$scope.recover = function (item) {
		var dialog = $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重启服务'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='确定重启服务吗' param1='" + item.name + "'></p><footer class='text-right'><img data-ng-if='sending' src='./img/HLloading.gif' width='24px'><button data-ng-if='!sending' class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button data-ng-if='!sending' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$scope.sending = true;
					Host.restartService({
						host_ip: param_host.ip,
						service: item.name,
						action: 'restart'
					}, function () {
						$scope.sending = false;
						$modalInstance.close();
					}, function (error) {
						$scope.sending = false;
					});
				};
				$scope.close = function () {
					$modalInstance.dismiss();
				};
			},
			size: "sm"
		});
		dialog.result.then(function () {
			getServer();
		});
	};
	$scope.start = function (item) {
		var dialog = $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='启动服务'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='确定启动服务吗' param1='" + item.name + "'></p><footer class='text-right'><img data-ng-if='sending' src='./img/HLloading.gif' width='24px'><button data-ng-if='!sending' class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button data-ng-if='!sending' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$scope.sending = true;
					Host.restartService({
						host_ip: param_host.ip,
						service: item.name,
						action: 'start'
					}, function () {
						$scope.sending = false;
						$modalInstance.close();
					}, function (error) {
						$scope.sending = false;
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
		dialog.result.then(function () {
			getServer();
		});
	};
}]);

/***/ }),
/* 147 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
*  Module
*
* Description 资源-资源池模块
*/
angular.module('vdi.resource.pool', []).factory("Host", ["$resource", "$Domain", "$location", "$interfaceDomain", "$controllerDomain", function ($resource, $Domain, $location, $interfaceDomain, $controllerDomain) {
	return $resource($Domain + "/thor/hosts", null, {
		query: { method: "GET", url: $Domain + "/thor/hosts", isArray: false },
		query_agent: { method: "GET", url: $Domain + "/thor/hosts/:id", params: { id: "@id" }, isArray: false },
		query_gpu_agent: { method: "GET", url: $Domain + "/thor/hosts/gpu/:id", params: { id: "@id" }, isArray: false },
		// 根据虚拟化类型返回可用主机列表
		query_with_virtual_type: { method: "GET", url: $Domain + "/thor/hosts_with_virtual_type" },
		add_agent: { method: "POST", url: $Domain + "/thor/hosts/:id", params: { id: "@id" }, isArray: false },
		delete_agent: { method: "DELETE", url: $Domain + "/thor/hosts/:id", params: { id: "@id" }, isArray: false },
		// 维护主机（可恢复删除） 
		// action ：reboot_host（重启主机），poweroff_host（关闭主机），maintenance_host（维护主机），recovery_host（恢复主机）
		maintain_host: { method: "POST", url: $Domain + "/thor/host/maintainHost" },
		shutdown: { method: "POST", url: $Domain + "/thor/shutdown" },
		config_storage: { method: "POST", url: $Domain + "/thor/host/config_storage" },
		filter_storage: { method: "GET", url: $Domain + "/thor/filter_available_storages" },
		//获取可用网络信息
		// get_interfaces : 
		// 	{ method:"GET", url: $interfaceDomain + "/v1/network/interface/list"},
		node_ping: { method: "POST", url: $Domain + "/check_ping" },
		// 校验主控节点root账号
		check_root: { method: "POST", url: $Domain + "/check_root" },
		// 获取节点服务
		service_status: { method: "GET", url: $Domain + "/thor/host/get_service_status", isArray: false },
		// 重启或者启动服务
		restartService: { method: "POST", url: $Domain + "/thor/host/restartService" }
	});
}]).factory('HostManage', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/hosts", null, {
		config_desktop: { method: "POST", url: $Domain + "/thor/host/config_desktop" },
		network_info: { method: "GET", url: $Domain + "/thor/host/networkInfo" },
		network_edit: { method: "POST", url: $Domain + "/thor/host/networkInfo" },
		storage_info: { method: "GET", url: $Domain + "/thor/host/local_storage" },
		hardware_info: { method: "GET", url: $Domain + "/thor/host/hardware" },
		//获取物理网络信息 
		physic_netword_info: { method: "GET", url: $Domain + "/thor/host/get_node_physical_network" },
		//获取指定节点支持的网络类型  host_ip:主机ip
		network_types: { method: "GET", url: $Domain + "/thor/host/get_node_available_network_types" },
		//添加网卡绑定
		new_bond: { method: "POST", url: $Domain + "/thor/host/bondnetwork" },
		//修改bond
		alter_bond: { method: "PUT", url: $Domain + "/thor/host/bondnetwork" },
		//解除网卡绑定
		delete_bond: { method: "DELETE", url: $Domain + "/thor/host/bondnetwork" },
		//主机网关及DNS修改
		alter_gatedns: { method: "POST", url: $Domain + "/thor/host/gatedns" }

	});
}]).factory('ResourcePool', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/resource", null, {
		query: { method: "GET" },
		add: { method: "POST" },
		delete: { method: "DELETE", url: $Domain + "/thor/resource", params: null },
		edit: { method: "PUT" }

	});
}]).factory('HostGPU', ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/compute/v1/nodes", null, {
		info: { method: "GET", url: $Domain + "/compute/v1/nodes/:id/gpu/info", params: { id: "@id" }, isArray: false },
		state: { method: "GET", url: $Domain + "/compute/v1/nodes/:id/gpu/state", params: { id: "@id" }, isArray: false },
		config: { method: "GET", url: $Domain + "/compute/v1/nodes/:id/gpu/config", params: { id: "@id" }, isArray: false },
		update: { method: "PUT", url: $Domain + "/compute/v1/nodes/:id/gpu/update", params: { id: "@id" }, isArray: false },
		enable: { method: "PUT", url: $Domain + "/compute/v1/nodes/:id/gpu/enable", params: { id: "@id" }, isArray: false },
		disable: { method: "PUT", url: $Domain + "/compute/v1/nodes/:id/gpu/disable", params: { id: "@id" }, isArray: false }

	});
}]).controller('vdiResourcePoolListController', ['$scope', '$modal', '$$$I18N', 'ResourcePool', function ($scope, $modal, $$$I18N, ResourcePool) {

	$scope.rows = [];
	$scope.loading = true;
	ResourcePool.query({ 'check_host_service': true }, function (res) {
		$scope.rows = res.result;
		$scope.loading = false;
	});
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = 30;

	$scope.edit = function (item) {
		item.is_edit = true;
		$modal.open({
			controller: "alterPoolDialog",
			templateUrl: "views/vdi/dialog/resource/pool/new_pool.html",
			resolve: { param: function param() {
					return item;
				}, rows: function rows() {
					return $scope.rows;
				} }
		});
	};
	var _SCOPE = $scope;
	$scope.delete = function (item) {
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除资源池'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p data-localize='DELETE_POOL_COMFIRM'>确定删除资源池吗？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {

				$scope.ok = function () {
					$modalInstance.close();
					var postData = {
						id: item.uuid
					};
					ResourcePool.delete(postData, function (res) {
						ResourcePool.query(function (res) {
							_SCOPE.rows.splice(0, _SCOPE.rows.length);
							[].push.apply(_SCOPE.rows, res.result);
						});
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller('vdiResourcePoolHostController', ['$scope', '$routeParams', '$modal', '$$$I18N', 'Host', '$interval', '$rootScope', function ($scope, $routeParams, $modal, $$$I18N, Host, $interval, $rootScope) {
	$scope.$root && $scope.$root.$broadcast("navItemSelected", ["资源", "资源池管理", "计算节点"]);

	$scope.rows = [];
	$scope.vtype = $routeParams.type;

	$scope.orders = [{ name: $$$I18N.get("按添加时间排序"), val: 'time' }, { name: $$$I18N.get("按名称排序"), val: 'name' }];
	$scope.order = $scope.orders[0];
	$scope.sortTem = function (val) {
		if (val == 'time') {
			$scope.rows.sort(function (a, b) {
				return a.created_at < b.created_at ? -1 : 1;
			});
		} else {
			$scope.rows.sort(function (a, b) {
				return a.host > b.host ? 1 : -1;
			});
		}
	};

	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("nodes", $scope.rows.map(function (item) {
			return item.id;
		}));
	}, 1000);
	$scope.$on("nodesRowsUpdate", function ($event, data) {
		$rootScope.activeHostIds = $scope.rows.filter(function (row) {
			return row.status === 'active';
		}).map(function (row) {
			return row.id;
		});
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
	});
	$scope.$on("update_host_data", function () {
		$scope.get_list();
	});

	var get_list = function get_list() {
		$scope.loading = true;
		$scope.rows = [];
		Host.query_agent({ id: $routeParams.id }, function (res) {
			$scope.loading = false;
			$scope.rows = res.hosts_list.sort(function (a, b) {
				return a.created_at < b.created_at ? -1 : 1;
			});
			$scope.all_data = res;
		});
	};
	get_list();
	$scope.get_list = get_list;
	$scope.configStorage = function (item) {
		var ins = $modal.open({
			templateUrl: "views/vdi/dialog/resource/pool/config_storage.html",
			controller: "configStorageDialog",
			resolve: { param: function param() {
					return item;
				} }
		});
		ins.result.then(function () {
			get_list();
		});
	};
	// 	  #    active - 活动
	//    #    maintenance - 维护模式
	//    #    offline - 离线
	//    #    building - 正在添加中
	$scope.restart = function () {
		var rows = $scope.rows.filter(function (item) {
			return item._selected && item.status === 'active';
		});
		if (rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='重启主机'>" + "重启主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定重启主机吗?'>确定重启主机吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						Host.maintain_host({
							host_ips: rows.map(function (item) {
								return item.ip;
							}),
							action: "reboot_host"
						}, function (res) {
							if (rows.some(function (item) {
								return item.is_console;
							})) {
								$rootScope.$broadcast('NOAUTH');
								location.reload();
							}
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiResourceHostList_TIP1"),
				timeout: 6000
			});
		}
	};

	$scope.poweroff = function () {
		var rows = $scope.rows.filter(function (item) {
			return item._selected && item.status === 'active';
		});
		if (rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='关闭主机'>" + "关闭主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定关闭主机吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						Host.maintain_host({
							host_ips: rows.map(function (item) {
								return item.ip;
							}),
							action: "poweroff_host"
						});
						$modalInstance.close();
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiResourceHostList_TIPACTIVE"),
				timeout: 6000
			});
		};
	};

	$scope.maintain = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status === "active";
		});
		if (rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='维护主机'>" + "维护主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='MAINTAIN_HOST_COMFIRM'>进入维护模式时，会关闭当前计算节点上的所有桌面，是否确定？</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						var postData = {
							action: "maintenance_host",
							host_ips: rows.map(function (item) {
								return item.ip;
							})
						};
						Host.maintain_host(postData);
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiResourceHostList_TIPACTIVE"),
				timeout: 6000
			});
		};
	};
	$scope.recovery = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected && row.status === 'maintenance';
		});
		if (rows.length) {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='恢复主机'>" + "恢复主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='确定恢复主机吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						var postData = {
							action: "recovery_host",
							host_ips: rows.map(function (item) {
								return item.ip;
							})
						};
						Host.maintain_host(postData);
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiResourceHostList_TIPRECOVER"),
				timeout: 6000
			});
		}
	};
	$scope.delete = function (item) {
		var rows = $scope.rows.filter(function (item) {
			return item._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除主机'>" + "删除主机</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='DELETE_HOST_COMFIRM?'></p><footer class='text-right'> <img ng-show='loadding' src='img/loadingtext.gif' width='24px' height='24px'/><button ng-show='!loadding' class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button ng-show='!loadding' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$scope.loadding = true;
					Host.delete_agent({
						host_ids: rows.map(function (item) {
							return item.id;
						}),
						id: $routeParams.id
					}, function (res) {
						get_list();
					}).$promise.finally(function () {
						$scope.loadding = false;
						$modalInstance.close();
					});
				}, $scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};

	$scope.openHostMoreDialog = function (p) {
		var _dialog = $modal.open({
			controller: "hostMoreDialog",
			templateUrl: "views/vdi/dialog/resource/pool/host_more.html",
			size: "lg",
			resolve: {
				param: function param() {
					return p;
				}
			}
		});
	};
}]).controller('newPoolDialog', ['$scope', '$modalInstance', 'ResourcePool', function ($scope, $modalInstance, ResourcePool) {
	setTimeout(function () {
		$("[rel=popover-hover]").popover({ trigger: "hover" });
	});
	$scope.rbd_enabled = false;
	$scope.template_type = 'add';
	$scope.virtual_type = "kvm";
	$scope.ok = function () {
		var postData = {
			name: this.name,
			virtual_type: this.virtual_type,
			rbd_enabled: this.rbd_enabled,
			description: this.des
		};
		$scope.loadding = true;
		ResourcePool.add(postData, function (res) {
			$modalInstance.close();
			ResourcePool.query(function (res) {
				$scope.rows.splice(0, $scope.rows.length);
				[].push.apply($scope.rows, res.result);
			});
		}).$promise.finally(function () {
			$scope.loadding = false;
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller('alterPoolDialog', ['$scope', '$modalInstance', 'param', 'rows', 'ResourcePool', function ($scope, $modalInstance, param, rows, ResourcePool) {
	setTimeout(function () {
		$("[rel=popover-hover]").popover({ trigger: "hover" });
	});
	$scope.template_type = 'alter';
	$scope.name = param.name;
	$scope.virtual_type = param.type;
	$scope.rbd_enabled = param.rbd_enabled;
	$scope.des = param.description;
	$scope.is_edit = param.is_edit;
	$scope.is_default = param.name === 'default' ? true : false;
	$scope.hostnum = param.hosts.length;
	$scope.ok = function () {
		var postData = {
			id: param.uuid,
			name: this.name,
			rbd_enabled: this.rbd_enabled,
			description: this.des
		};
		$scope.loadding = true;
		ResourcePool.edit(postData, function (res) {
			$modalInstance.close();
			ResourcePool.query(function (res) {
				rows.splice(0, rows.length);
				[].push.apply(rows, res.result);
			});
		}).$promise.finally(function () {
			$scope.loadding = false;
		});
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller("hostMoreDialog", ["$scope", "$modalInstance", "Host", "HostManage", "$$$I18N", "$Domain", "param", "Storage", "Console", "$modal", "maskModel", "$rootScope", "HostGPU", "$q", function ($scope, $modalInstance, Host, HostManage, $$$I18N, $Domain, param, Storage, Console, $modal, maskModel, $rootScope, HostGPU, $q) {
	//查询网卡
	$scope.max_instance = param.max_instance;
	var param_host = angular.copy(param);
	$scope.virtual_type = param_host.virtual_type;
	$scope.rbd_enabled = param_host.rbd_enabled;
	$scope.enable_gpu_module = param_host.enable_gpu_module;

	$scope.get_nic = function () {
		$scope.loading_nic = true;
		HostManage.network_info({
			host: param.ip,
			id: param.id || ''
		}, function (res) {
			$scope.dev_states = res.dev_states;
			$scope.networks = res.networks.map(function (item) {
				item.ips = item.ips.map(function (sub, idx) {
					return {
						ip: sub,
						netmask: item.netmasks[idx],
						ip_editable: item.ips_editable[idx],
						uneditable: item.ips_editable[idx].is_management || item.ips_editable[idx].is_image
					};
				});
				item._ips = item.ips.map(function (sub) {
					return {
						value: sub,
						model: angular.copy(sub)
					};
				});
				item.readonly = true;
				return item;
			}).sort(function (a, b) {
				return a.name > b.name;
			});
			$scope.data = {
				_dnss: [{}, {}].map(function (d, idx) {
					return {
						model: res.dns[idx],
						value: res.dns[idx]
					};
				}),
				_gateway: {
					model: res.gateway,
					value: res.gateway
				},
				_readonly: true

			};
			$scope.bond_types = res.bond_types;
			$scope.bond_networks = res.bond_networks.map(function (item) {
				item.ips = item.ips.map(function (sub, idx) {
					return {
						ip: sub,
						netmask: item.netmasks[idx],
						ip_editable: item.ips_editable[idx],
						uneditable: item.ips_editable[idx].is_management || item.ips_editable[idx].is_image
					};
				});
				item._ips = item.ips.map(function (sub) {
					return {
						value: sub,
						model: angular.copy(sub)
					};
				});
				item.readonly = true;
				return item;
			});
		}).$promise.finally(function () {
			$scope.loading_nic = false;
		});
	};
	$scope.get_nic();
	//修改网卡
	$scope.ok = function (item) {
		item.submiting = true;
		var all_cidr = $scope.networks.concat($scope.bond_networks).reduce(function (arr, net) {
			var cidr = net._ips.map(function (ip) {
				return ip.model.ip + "/" + ip.model.netmask;
			});
			arr.push.apply(arr, cidr);
			return arr;
		}, []);
		var before_cidr = $scope.networks.concat($scope.bond_networks).reduce(function (arr, net) {
			var cidr = net.ips.map(function (ip) {
				return ip.ip + "/" + ip.netmask;
			});
			arr.push.apply(arr, cidr);
			return arr;
		}, []);
		var backItem = {
			id: param.id,
			is_console: param.is_console,
			iface: item.name,
			ips: item._ips.map(function (i) {
				return i.model.ip;
			}),
			netmasks: item._ips.map(function (i) {
				return i.model.netmask;
			}),
			ips_editable: item._ips.map(function (i) {
				return i.model.ip_editable;
			}),
			before_cidr: before_cidr,
			all_cidr: all_cidr
		};
		var is_alter = item._ips.every(function (it) {
			return it.model.ip === it.value.ip && it.model.netmask === it.value.netmask;
		});
		if (is_alter && item._ips.length === item.ips.length) {
			// 修改后的值和初始值相等时，不提交数据
			item.submiting = false;
			item.readonly = true;
		} else {
			HostManage.network_edit(backItem, function () {
				item._ips.forEach(function (i) {
					i.value = angular.copy(i.model);
				});
				item.submiting = false;
				item.readonly = true;
				location.reload();
			}, function () {
				item.submiting = false;
				item.readonly = false;
			});
		}
	};
	$scope.okDns = function (d) {
		d.submiting = true;
		var postData = {
			id: param.id,
			gateway: d._gateway.model,
			dns: d._dnss.filter(function (i) {
				return Boolean(i.model);
			}).map(function (i) {
				return i.model;
			})
		};
		var no_alter = d._dnss.concat(d._gateway).every(function (it) {
			return it.model === it.value;
		});
		if (no_alter) {
			d.submiting = false;
			d._readonly = true;
		} else {
			HostManage.alter_gatedns(postData, function (res) {
				d._dnss.forEach(function (dns) {
					dns.value = dns.model;
				});
				d._gateway.value = d._gateway.model;
				d._readonly = true;
				// FIX #6061
				// maskModel.open(angular.copy($rootScope.activeHostIds));
			}).$promise.finally(function () {
				d.submiting = false;
			});
		}
	};
	$scope.cancel = function (item) {
		item.readonly = true;
		item._ips = item.ips.map(function (sub) {
			return {
				value: sub,
				model: angular.copy(sub)
			};
		});
	};
	$scope.cancelDns = function (d) {
		d._readonly = true;
		d._dnss.forEach(function (dns) {
			dns.model = dns.value ? dns.value : null;
		});
		d._gateway.model = d._gateway.value;
	};
	$scope.add_ip = function (item) {
		item._ips.push({
			model: {
				ip_editable: {
					is_management: false,
					is_image: false
				},
				uneditable: false
			},
			value: {
				ip_editable: {
					is_management: false,
					is_image: false
				},
				uneditable: false
			}
		});
	};
	$scope.minus_ip = function (per, all) {
		all.splice(all.indexOf(per), 1);
	};
	$scope.bound_netcard = function () {
		var dialog = $modal.open({
			controller: "boundNetcardDialog",
			templateUrl: "views/vdi/dialog/resource/pool/bound_netcard.html",
			resolve: { param: function param() {
					return {
						p_host: angular.copy(param_host),
						p_networks: angular.copy($scope.networks),
						p_bondtypes: angular.copy($scope.bond_types),
						p_bondnetworks: angular.copy($scope.bond_networks),
						p_dev_states: angular.copy($scope.dev_states)
					};
				} }
		});
		dialog.result.then(function () {
			getNetcardList();
		});
	};
	$scope.edit_bond = function (item) {
		var dialog = $modal.open({
			controller: "editboundNetcardDialog",
			templateUrl: "views/vdi/dialog/resource/pool/bound_netcard.html",
			resolve: { param: function param() {
					return {
						p_host: angular.copy(param_host),
						p_networks: angular.copy($scope.networks),
						p_bondtypes: angular.copy($scope.bond_types),
						p_bondnetworks: angular.copy($scope.bond_networks),
						p_dev_states: angular.copy($scope.dev_states),
						p_item: angular.copy(item)
					};
				} }
		});
		dialog.result.then(function () {
			getNetcardList();
		});
	};
	$scope.unbundle_netcard = function (item) {
		var dialog = $modal.open({
			controller: "unbundleNetcardDialog",
			templateUrl: "views/vdi/dialog/resource/pool/unbundle_netcard.html",
			resolve: { param: function param() {
					return {
						p_host: angular.copy(param_host),
						p_net: angular.copy(item),
						p_dev_states: angular.copy($scope.dev_states)
					};
				} }
		});
		dialog.result.then(function () {
			getNetcardList();
		});
	};
	// 是否能编辑，同时只能有一行可以编辑
	$scope.netEditable = function (net) {
		var hit = false;
		angular.forEach($scope.networks, function (item) {
			if (item.readonly === false) {
				hit = true;
			}
		});
		return !hit;
	};
	// 本地存储信息
	HostManage.storage_info({
		host: param.ip,
		id: param.id || ''
	}, function (res) {
		$scope.storages = res.result;
	});

	//硬件信息
	HostManage.hardware_info({
		host: param.ip,
		id: param.id || ''
	}, function (res) {
		$scope.hardware = res;
	});

	//窗口关闭按钮
	$scope.close = function () {
		$modalInstance.close();
	};

	//修改最大实例数
	$scope.insBtn_unable = false;
	$scope.saveMaxInstance = function () {
		$scope.insBtn_unable = true;
		var _this = this;
		HostManage.config_desktop({
			"host": param.id,
			"max_instance": _this.max_instance
		}, function (res) {
			$scope.insBtn_unable = false;
			$scope.insForm_suc = true;
			setTimeout(function () {
				$scope.insForm_suc = false;
				// 通知父scope,更新数据
				$scope.$root.$broadcast('update_host_data');
			}, 1000);
			// _this.max_instance = null;
		});
	};
	$scope.save_outer_IP = function () {
		$scope.IP_Btn_unable = true;
		Console.save_ip({ host: param.id, external_ip: this.outerIP }, function () {
			$scope.outerIPForm_suc = true;
			setTimeout(function () {
				$scope.outerIPForm_suc = false;
			}, 1000);
		}).$promise.finally(function () {
			$scope.IP_Btn_unable = false;
		});
	};

	function getServer() {
		$scope.loading_server = true;
		Host.service_status({ ip: param_host.ip }, function (res) {
			var services = [];
			for (var name in res.result) {
				services.push({ name: name, status: res.result[name] });
			}
			$scope.servers = services;
			$scope.loading_server = false;
		}, function (error) {
			$scope.loading_server = false;
		});
	}
	getServer();
	$scope.recover = function (item) {
		var dialog = $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='重启服务'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='确定重启服务吗' param1='" + item.name + "'></p><footer class='text-right'><img data-ng-if='sending' src='./img/HLloading.gif' width='24px'><button data-ng-if='!sending' class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button data-ng-if='!sending' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$scope.sending = true;
					Host.restartService({
						host_ip: param_host.ip,
						service: item.name,
						action: 'restart'
					}, function () {
						$scope.sending = false;
						$modalInstance.close();
					}, function (error) {
						$scope.sending = false;
					});
				};
				$scope.close = function () {
					$modalInstance.dismiss();
				};
			},
			size: "sm"
		});
		dialog.result.then(function () {
			getServer();
		});
	};
	$scope.start = function (item) {
		var dialog = $modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='启动服务'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='确定启动服务吗' param1='" + item.name + "'></p><footer class='text-right'><img data-ng-if='sending' src='./img/HLloading.gif' width='24px'><button data-ng-if='!sending' class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button data-ng-if='!sending' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$scope.sending = true;
					Host.restartService({
						host_ip: param_host.ip,
						service: item.name,
						action: 'start'
					}, function () {
						$scope.sending = false;
						$modalInstance.close();
					}, function (error) {
						$scope.sending = false;
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
		dialog.result.then(function () {
			getServer();
		});
	};
	var _scope = $scope;
	/* GPU显卡Tab页 */
	function getHostGPU() {
		$scope.loading_GPU = true;
		$q.all([HostGPU.state({ id: param.id }).$promise, HostGPU.config({ id: param.id }).$promise, HostGPU.info({ id: param.id }).$promise]).then(function (arr) {
			$scope.GPU_V = arr[0].state.flag == 'defined';
			$scope.GPU_V_num = arr[1].config.vf_num;
			var totalNum = arr[2].info.reduce(function (count, item) {
				return count + item.SRIOVTotalVFS;
			}, 0);
			$scope.GPU_V_max = totalNum;
			$scope.GPU_V_min = arr[2].info.length;
			$scope.loading_GPU = false;
		});
	}
	if ($scope.enable_gpu_module) {
		getHostGPU();
	}
	function queryConfig() {
		HostGPU.config({ id: param.id }, function (r) {
			$scope.GPU_V_num = r.config.vf_num;
		});
	}
	$scope.changeGPU_V = function (val) {
		$scope.GPU_V_loading = true;
		if (val) {
			HostGPU.enable({ id: param.id }, function (res) {}, function (error) {
				_scope.GPU_V = !val;
			}).$promise.finally(function () {
				$scope.GPU_V_loading = false;
			});
		} else {
			HostGPU.disable({ id: param.id }, function (res) {}, function (error) {
				_scope.GPU_V = !val;
			}).$promise.finally(function () {
				$scope.GPU_V_loading = false;
			});
		}
	};
	$scope.saveGPUV = function () {
		$scope.saving = true;
		HostGPU.update({ id: param.id, data: { vf_num: this.GPU_V_num } }, function (res) {
			$scope.sav_suc = true;
		}, function (error) {
			$scope.GPU_V = !$scope.GPU_V;
			$scope.sav_suc = false;
		}).$promise.finally(function () {
			$scope.saving = false;
			queryConfig();
		});
	};
}]).controller('addHostDialog', ['$scope', '$modalInstance', 'Host', '$routeParams', 'Network', 'Manage', 'HA', '$http', "$Domain", "$$$I18N", "HostManage", "$location", function ($scope, $modalInstance, Host, $routeParams, Network, Manage, HA, $http, $Domain, $$$I18N, HostManage, $location) {
	var $s = $scope;
	$s.step = 1;
	$s.host = {};
	$s.quorum = {};
	function getDataNetwork() {
		$s.loading_network = true;
		return Network.query().$promise;
	}
	function formatIP(cidr) {
		var ip = cidr.split("/")[0];
		var masklen = Number(cidr.split("/")[1]);
		var binaryMask = 0xFFFFFFFF << 32 - masklen;
		var arrmask = [];
		for (var i = 32 / 8; i > 0; i--) {
			arrmask.push(binaryMask >>> 8 * (i - 1) & 0xff);
		}
		return {
			cidr: cidr,
			ip: ip,
			netmask: arrmask.join(".")
		};
	}
	function get_interfaces() {
		$s.loading_interface = true;
		$s.interfaces = [];
		return HostManage.network_info({
			host: $s.host.ip,
			id: null
		}, function (res) {
			$s.interfaces = res.networks.concat(res.bond_networks).map(function (dev) {
				dev._cidrs = (dev.ips || dev.ip).map(function (ip, idx) {
					return {
						ip: ip,
						netmask: (dev.netmasks || dev.netmask)[idx]
					};
				});
				dev._dev = dev.name;
				dev._selected = false;
				return dev;
			});
		}).$promise.finally(function () {
			$s.loading_interface = false;
		});
	}
	$s.close = function () {
		$modalInstance.close();
	};
	$s.go_next = function () {
		$s.loading = true;
		Host.check_root({
			username: $s.host.username,
			root_password: $s.host.root_password,
			node_ip: $s.host.ip,
			force: $s.host.force
		}, function (res) {
			$s.agent_detail = res.result;
			$s.enter_step2();
		}).$promise.finally(function (res) {
			$s.loading = false;
		});
	};
	$s.go_pre = function () {
		$s.step = 1;
		$s.dataNets = [];
		$s.interfaces = [];
		$s.agent_detail = {};
	};
	$s.enter_step2 = function () {
		$s.step = 2;
		get_interfaces().then(getDataNetwork).then(function (res) {
			$s.loading_network = false;
			var nets = res.networks.reduce(function (obj, it) {
				if (obj[it.switch_name]) {
					obj[it.switch_name]['name'] += "/" + it.name;
				} else {
					obj[it.switch_name] = it;
				}
				return obj;
			}, {});
			$s.dataNets = Object.keys(nets).map(function (key, idx) {
				nets[key]._data_dev = $s.interfaces[idx];
				return nets[key];
			});
		});
	};
	$s.ok = function (type) {
		var _this = this;
		var h = _this.host;
		this.loadding = true;
		var postData = {
			id: $routeParams.id || $s.item.id,
			ip: h.ip,
			username: h.username,
			root_password: h.root_password,
			virtual_type: type,
			force: $s.host.force,
			management_dev: $s.agent_detail.node_manage_dev,
			management_ip: $s.agent_detail.node_manage_ip,
			management_netmask: $s.agent_detail.node_manage_netmask,
			bond_switch_infos: $s.dataNets.map(function (n) {
				return {
					dev: n._data_dev ? n._data_dev._dev : null,
					switch: n.switch_name
				};
			})
		};
		Host.add_agent(postData, function () {
			$modalInstance.close();
			if ($s.item) {
				$location.url("/resource/pool/" + $s.item.id + "/" + type);
			} else {
				$s.get_list();
			}
		}).$promise.finally(function () {
			_this.loadding = false;
		});
	};
}]).controller('configPubStorageDialog', ['$scope', '$modalInstance', 'Storage', function ($scope, $modalInstance, Storage) {

	$scope.ok = function () {
		$modalInstance.close();
	};
	$scope.close = function () {
		$modalInstance.close();
	};
}]).controller('configStorageDialog', ['$scope', 'param', '$modalInstance', 'Host', 'Storage', function ($scope, param, $modalInstance, Host, Storage) {
	$scope.host = param.host;
	$scope.loading = true;
	$scope.sys_luns = [];
	$scope.data_luns = [];
	Storage.query({ storage_uuid: param.storage_uuid }, function (res) {
		$scope.loading = false;
		// res.host_storages.unshift({name:"本地存储",uuid:undefined});
		$scope.luns = res.storages.map(function (s) {
			try {
				s._total_size = Number(s.storage_metadata.capabilities.total_capacity_gb).toFixed(0);
				s._free_size = Number(s.storage_metadata.capabilities.free_capacity_gb).toFixed(0);
				s._used_size = Number(s._total_size - s._free_size).toFixed(0);
			} catch (err) {}
			return s;
		});
		$scope.hostluns = res.host_storages.map(function (s) {
			try {
				s._total_size = Number(s.storage_metadata.capabilities.total_capacity_gb).toFixed(0);
				s._free_size = Number(s.storage_metadata.capabilities.free_capacity_gb).toFixed(0);
				s._used_size = Number(s._total_size - s._free_size).toFixed(0);
			} catch (err) {}
			return s;
		});
		$scope.imagePropertyLun = $scope.luns.filter(function (item) {
			return item.uuid === param.image_storage_performance;
		})[0];
		$scope.imageCapacityLun = $scope.luns.filter(function (item) {
			return item.uuid === param.image_storage_capacity;
		})[0];
		$scope.hostLun = $scope.hostluns.filter(function (item) {
			return res.choosed_storage === 'local' ? item.uuid == undefined : item.uuid === res.choosed_storage;
		})[0];
		$scope.filterStorage($scope.imagePropertyLun, 1);
		$scope.filterStorage($scope.imageCapacityLun, 2);
	});
	$scope.filterStorage = function (_s, type) {
		$scope.loading_lun = true;
		Host.filter_storage({
			storage_id: _s.uuid,
			device_type: _s.device_type,
			node_uuid: _s.node_uuid
		}).$promise.then(function (res) {
			$scope.loading_lun = false;
			res.result.forEach(function (s) {
				try {
					s._total_size = Number(s.storage_metadata.capabilities.total_capacity_gb).toFixed(0);
					s._free_size = Number(s.storage_metadata.capabilities.free_capacity_gb).toFixed(0);
					s._used_size = Number(s._total_size - s._free_size).toFixed(0);
				} catch (err) {}
			});
			switch (type) {
				case 1:
					{
						$scope.sys_luns = res.result;
						$scope.propertyLun = $scope.sys_luns.filter(function (item) {
							return item.uuid === param.storage_performance;
						})[0] || $scope.sys_luns[0];
						break;
					};
				case 2:
					{
						$scope.data_luns = res.result;
						$scope.capacityLun = $scope.data_luns.filter(function (item) {
							return item.uuid === param.storage_capacity;
						})[0] || $scope.data_luns[0];
						break;
					};
				default:
					{
						break;
					}
			}
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
	$scope.ok = function () {
		var _this = this;
		$scope.loading = true;
		Host.config_storage({
			host: param.id,
			// storage_base:this.baseLun.uuid,
			storage_performance: $scope.propertyLun.uuid,
			storage_capacity: $scope.capacityLun.uuid,
			cache_storage: _this.hostLun.uuid,
			image_storage_performance: $scope.imagePropertyLun.uuid,
			image_storage_capacity: $scope.imageCapacityLun.uuid
		}).$promise.then(function () {
			$modalInstance.close();
		}).finally(function () {
			$scope.loading = false;
		});
	};
	// 过滤远端存储
	function filter_data(rsts) {
		var ip = param.ip;
		var _storages = rsts.filter(function (item) {
			if (item.device_type === 'local' && item.ip !== ip) {
				return false;
			}
			return true;
		});
		return _storages;
	}
}]).controller('boundNetcardDialog', ['$scope', 'param', '$modalInstance', 'HostManage', '$filter', '$$$I18N', 'maskModel', '$rootScope', '$modal', function ($scope, param, $modalInstance, HostManage, $filter, $$$I18N, maskModel, $rootScope, $modal) {
	// 主控和计算节点公用
	var host_mess = param.p_host;
	var net_mess = param.p_networks;
	var dev_status = param.p_dev_states;
	var temp = {
		ip: null,
		netmask: null,
		uneditable: false,
		ip_editable: {
			is_management: false,
			is_image: false
		}
	};
	$scope.type = 'add';
	$scope.bond_types = param.p_bondtypes;
	$scope.netcards = net_mess.filter(function (n) {
		return n.has_bond === false;
	});
	$scope.ips = [angular.copy(temp)];
	$scope.data = {};

	// HostManage.network_info({
	// 	host:host_mess.ip,
	//     id:host_mess.id || ''
	// },function(res){
	// 	$scope.netcards = res.networks.filter(function(net){
	// 		return net.has_bond === false;
	// 	});
	// 	all_nets = res.networks.concat(res.bond_networks);
	// });

	// HostManage.network_types({host_ip:host_mess.ip},function(res){
	// 	$scope.types = res.result;
	// });
	$scope.update_ip = function () {
		// var eth0 = $filter("selectedFilter")($scope.netcards).filter(function(n){ return n.iface === "eth0" })[0];
		var manage_image_ips = $filter("selectedFilter")($scope.netcards).reduce(function (arr, netcard) {
			netcard.ips.forEach(function (ip) {
				if (ip.uneditable) {
					arr.push(ip);
				}
			});
			return arr;
		}, []);
		if (manage_image_ips.length) {
			$scope.ips = angular.copy(manage_image_ips);
		} else {
			$scope.ips = [angular.copy(temp)];
		}
	};
	$scope.selectAllHost = function (bool) {
		$scope.netcards.map(function (item) {
			item._selected = bool;
			return item;
		});
		$scope.update_ip();
	};
	$scope.selectOneHost = function () {
		$scope.data.is_all = $scope.netcards.every(function (item) {
			return item._selected === true;
		});
		$scope.update_ip();
	};
	$scope.add_ip = function () {
		$scope.ips.push(angular.copy(temp));
	};
	$scope.minus_ip = function (idx) {
		$scope.ips.splice(idx, 1);
	};
	$scope.get_select_nets_length = function () {
		return $filter("selectedFilter")($scope.netcards).map(function (n) {
			return n.iface;
		}).length;
	};
	var parentScope = $scope;
	$scope.ok = function () {
		var _this = this;
		var select_nets = $filter("selectedFilter")($scope.netcards).map(function (n) {
			return n.iface;
		});
		if (select_nets.every(function (card) {
			return dev_status[card];
		})) {
			parentScope.okPost(_this);
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='INFOR_TIP'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='DELETE_BOND_IVALID_CONFIRM'></p><footer class='text-right'> <img ng-show='loadding' src='img/loadingtext.gif' width='24px' height='24px'/><button ng-show='!loadding' class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button ng-show='!loadding' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						parentScope.okPost(_this);
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.okPost = function (scope) {
		var _this = scope;
		var select_nets = $filter("selectedFilter")($scope.netcards).map(function (n) {
			return n.iface;
		});
		var postData = {
			id: host_mess.id,
			is_console: host_mess.is_console,
			bond_name: _this.name,
			bond_type: _this.bond_type,
			ifaces: select_nets,
			ips: $scope.ips.map(function (ip) {
				return ip.ip;
			}),
			netmasks: $scope.ips.map(function (ip) {
				return ip.netmask;
			}),
			ips_editable: $scope.ips.map(function (ip) {
				return ip.ip_editable;
			})
		};
		if (postData.ifaces && postData.ifaces.length > 1) {
			$scope.loadding = true;
			HostManage.new_bond(postData, function (res) {
				// maskModel.open(angular.copy($rootScope.activeHostIds));
				location.reload();
			}).$promise.finally(function () {
				$scope.loadding = false;
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiBondNetcard_TIP1"),
				timeout: 6000
			});
		}
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('editboundNetcardDialog', ['$scope', 'param', '$modalInstance', 'HostManage', '$filter', '$$$I18N', 'maskModel', '$rootScope', '$modal', function ($scope, param, $modalInstance, HostManage, $filter, $$$I18N, maskModel, $rootScope, $modal) {
	// 主控和计算节点公用
	var currentItem = param.p_item;
	var host_mess = param.p_host;
	var dev_status = param.p_dev_states;
	var net_mess = param.p_networks.concat(currentItem.member.map(function (it) {
		return {
			iface: it,
			name: it,
			ips: []
		};
	}));

	var temp = {
		ip: "",
		netmask: "",
		uneditable: false,
		ip_editable: {
			is_management: false,
			is_image: false
		}
	};
	$scope.type = 'edit';
	$scope.bond_types = param.p_bondtypes;
	$scope.netcards = net_mess.map(function (n) {
		n._selected = currentItem.member.indexOf(n.iface) > -1;
		return n;
	});

	$scope.data = {};
	$scope.ips = currentItem.ips;

	$scope.name = currentItem.name;
	$scope.bond_type = currentItem.mode;
	$scope.update_ip = function () {
		var manage_image_ips = $filter("selectedFilter")($scope.netcards).reduce(function (arr, netcard) {
			netcard.ips.forEach(function (ip) {
				if (ip.uneditable) {
					arr.push(ip);
				}
			});
			return arr;
		}, []);
		if (manage_image_ips.length) {
			$scope.ips = angular.copy(manage_image_ips).concat(currentItem.ips);
		} else {
			$scope.ips = currentItem.ips;
		}
	};
	$scope.selectAllHost = function (bool) {
		$scope.netcards.map(function (item) {
			item._selected = bool;
			return item;
		});
		$scope.update_ip();
	};
	$scope.selectOneHost = function () {
		$scope.data.is_all = $scope.netcards.every(function (item) {
			return item._selected === true;
		});
		$scope.update_ip();
	};
	$scope.add_ip = function () {
		$scope.ips.push(angular.copy(temp));
	};
	$scope.minus_ip = function (idx) {
		$scope.ips.splice(idx, 1);
	};
	$scope.get_select_nets_length = function () {
		return $filter("selectedFilter")($scope.netcards).map(function (n) {
			return n.iface;
		}).length;
	};
	var parentScope = $scope;
	$scope.ok = function () {
		var _this = this;
		var select_nets = $filter("selectedFilter")($scope.netcards).map(function (n) {
			return n.iface;
		});
		if (select_nets.every(function (card) {
			return dev_status[card];
		})) {
			parentScope.okPost(_this);
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='INFOR_TIP'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='DELETE_BOND_IVALID_CONFIRM'></p><footer class='text-right'> <img ng-show='loadding' src='img/loadingtext.gif' width='24px' height='24px'/><button ng-show='!loadding' class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button ng-show='!loadding' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						parentScope.okPost(_this);
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.okPost = function (scope) {
		var _this = scope;
		var select_nets = $filter("selectedFilter")($scope.netcards).map(function (n) {
			return n.iface;
		});
		var postData = {
			id: host_mess.id,
			is_console: host_mess.is_console,
			bond_name: _this.name,
			bond_type: _this.bond_type,
			ifaces: select_nets,
			ips: $scope.ips.map(function (ip) {
				return ip.ip;
			}),
			netmasks: $scope.ips.map(function (ip) {
				return ip.netmask;
			}),
			ips_editable: $scope.ips.map(function (ip) {
				return ip.ip_editable;
			})
		};
		if (postData.ifaces && postData.ifaces.length > 1) {
			$scope.loadding = true;
			HostManage.alter_bond(postData, function (res) {
				location.reload();
			}).$promise.finally(function () {
				$scope.loadding = false;
			});
		} else {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("vdiBondNetcard_TIP1"),
				timeout: 6000
			});
		}
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('unbundleNetcardDialog', ['$scope', '$modalInstance', 'param', 'HostManage', 'maskModel', '$rootScope', '$modal', function ($scope, $modalInstance, param, HostManage, maskModel, $rootScope, $modal) {
	var host = param.p_host;
	var data = $scope.data = param.p_net;
	var dev_status = param.p_dev_states;
	data.ips.forEach(function (d) {
		if (d.uneditable) {
			data._has_inherit_net = true;
			d._inherit_menber = data.member[0];
		} else {
			d._inherit_menber = "";
		}
	});
	data.is_inherit = data._has_inherit_net;
	$scope.okPost = function () {
		var d = data;
		var _inherit_infos = d.ips.map(function (val) {
			return {
				ip: val.ip,
				netmask: val.netmask,
				dev: val._inherit_menber,
				is_management: val.ip_editable.is_management,
				is_image: val.ip_editable.is_image
			};
		});
		var postData = {
			id: host.id,
			is_console: host.is_console,
			bond_name: d.name,
			is_inherit: d.is_inherit,
			inherit_infos: d.is_inherit ? _inherit_infos : []
		};
		$scope.submiting = true;
		HostManage.delete_bond(postData).$promise.then(function () {
			location.reload();
		}).finally(function () {
			$scope.submiting = false;
		});
	};
	var parentScope = $scope;
	$scope.ok = function () {
		if (check_inherit()) {
			parentScope.okPost();
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='INFOR_TIP'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' localize='DELETE_BOND_IVALID_CONFIRM'></p><footer class='text-right'> <img ng-show='loadding' src='img/loadingtext.gif' width='24px' height='24px'/><button ng-show='!loadding' class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button ng-show='!loadding' class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						parentScope.okPost();
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
	function check_inherit() {
		var ips = data.ips;
		var valid = true;
		ips.forEach(function (ip) {
			if (dev_status[ip._inherit_menber] === false) {
				valid = false;
			}
		});
		return valid;
	}
}]);

/***/ }),
/* 148 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.network", ["vdi.network.manageNetwork", "vdi.network.virtualSwitch", "vdi.network.dataNetwork", "vdi.network.dhcp"]);

/***/ }),
/* 149 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.network.manageNetwork", []).factory("Manage", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/management_networks", null, {
		query: { method: "GET", isArray: false },
		put: { method: "PUT" }
	});
}]).factory("HostNetworkInfo", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/host/networkInfo", null, {
		query: { method: "GET", isArray: false }
	});
}]).controller("vdiManageNetworkListController", ["$scope", '$modal', 'Manage', '$interval', 'Host', function ($scope, $modal, Manage, $interval, Host) {
	$scope.rows = [];$scope.loading = true;
	$interval(function () {
		$scope.rows && $scope.$root && $scope.$root.$broadcast("manageNetworkIDS", $scope.rows.filter(function (item) {
			return item.status === 'active';
		}).map(function (it) {
			return it.id;
		}));
	}, 1000);
	$scope.$on("manage_networksRowsUpdate", function ($event, data) {
		var _rows = {};
		$scope.rows.forEach(function (item) {
			_rows[item.id] = item;
		});
		data.forEach(function (item) {
			if (_rows[item.id]) {
				for (var k in item) {
					_rows[item.id][k] = item[k];
				}
			}
		});
	});
	function test_connect(remote_ip, item) {
		Host.node_ping({ remote_ip: remote_ip, node_ip: item.ip }, function (res) {
			item._connect = res.result;
		});
	}
	var get_rows = function get_rows() {
		Manage.query(function (res) {
			$scope.loading = false;
			$scope.rows = res.result;
			$scope.rows.forEach(function (item) {
				item._connect = true;
			});
			var remote_ip = $scope.rows.filter(function (item) {
				return item.host_type == 'controller';
			})[0].image_ip;
			$scope.rows.forEach(function (item) {
				if (item.host_type == 'compute' && item.status == 'active') {
					test_connect(remote_ip, item);
				}
			});
			if (res.enable_ha) {
				$scope.rows.forEach(function (item) {
					if (item.host_type == 'controller') {
						item.enable_ha = true;
					}
				});
			};
			$scope.source_controller_ip = $scope.rows.filter(function (item) {
				return item.host_type == 'controller';
			})[0].management_ip;
			$scope.img_rows = $scope.rows.filter(function (item) {
				return item.host_type == 'controller';
			});
			$scope.img_rowsHA = $scope.img_rows.filter(function (item) {
				return item.enable_ha;
			});
			$scope.manage_rows = $scope.rows.filter(function (item) {
				return item.status === 'active';
			});
			$scope.manage_rowsHA = $scope.manage_rows.filter(function (item) {
				return item.enable_ha;
			});
		});
	};
	get_rows();
	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];
	$scope.currentPage = 1;

	$scope.modify = function (type) {
		var dialog = $modal.open({
			templateUrl: "views/vdi/dialog/network/manageNetwork/modifyManageImgNetwork.html",
			controller: "modifyManageImgDialog",
			size: "md",
			scope: $scope,
			resolve: {
				params: function params() {
					return { type: type };
				}
			}
		});
		dialog.result.then(function (data) {
			if (data) {
				get_rows();
			}
		});
	};
}]).controller('modifyManageImgDialog', ['$scope', '$modalInstance', 'HostNetworkInfo', "params", "Manage", "maskModel", function ($scope, $modalInstance, HostNetworkInfo, params, Manage, maskModel) {
	$scope.type = params.type;
	$scope.lists = $scope.type == 'image' ? $scope.img_rows : $scope.manage_rows;
	$scope.controller_ip = $scope.source_controller_ip;
	$scope.loading = true;
	$scope.lists.forEach(function (item, i) {
		HostNetworkInfo.query({ id: item.host_id }, function (res) {
			var bondNetworks = res.bond_networks.filter(function (network) {
				return network.ips.length !== 0;
			});
			var networks = res.networks.filter(function (network) {
				return network.ips.length !== 0;
			});
			item.allNetworks = networks.concat(bondNetworks);
			item.allNetworks.forEach(function (data) {
				data.IP = [];
				for (var i = 0; i < data.ips.length; i++) {
					data.IP.push({ ip: data.ips[i], mask: data.netmasks[i], editable: data.ips_editable[i] });
				}
			});
			item._selectNetwork = item.allNetworks.filter(function (n) {
				return n.name == item[$scope.type + '_dev'];
			})[0];
			item._selectIP = item._selectNetwork && item._selectNetwork.IP.filter(function (n) {
				return n.ip == item[$scope.type + '_ip'];
			})[0];

			if (i == $scope.lists.length - 1) {
				$scope.loading = false;
			}
		});
	});
	$scope.changeIP = function (host) {
		$scope.lists.forEach(function (item) {
			if (item.host_name == host.host_name) {
				item._selectIP = item._selectNetwork && item._selectNetwork.IP[0];
			}
		});
	};

	$scope.isUnchanged = function () {
		var flag = true;
		$scope.lists.forEach(function (list) {
			if (list._selectNetwork && list._selectIP) {
				var host = $scope.rows.filter(function (item) {
					return item.host_name == list.host_name;
				})[0];
				if (host._selectNetwork && host._selectIP) {
					if (list._selectNetwork.name !== host[$scope.type + '_dev'] || list._selectIP.ip !== host[$scope.type + '_ip']) {
						flag = false;
					}
				}
			}
		});
		return flag;
	};
	$scope.hasUnselect = function () {
		var flag = false;
		$scope.lists.forEach(function (item) {
			if (!item._selectNetwork || !item._selectIP) {
				flag = true;
			}
		});
		return flag;
	};

	$scope.ok = function () {
		$scope.loading = true;
		var data = { type: $scope.type, infos: {}, source_controller_ip: $scope.controller_ip };
		$scope.lists.forEach(function (item) {
			//只要是主控节点id就传null
			data.infos[item.host_name] = {
				id: item.host_type === 'controller' ? null : item.host_id,
				dev: item._selectNetwork.name,
				ip: item._selectIP.ip,
				netmask: item._selectIP.mask
			};
		});
		Manage.put(data, function (res) {
			$scope.loading = false;
			$modalInstance.close();
			maskModel.open(null, "manageNetwork");
			window.ignoreAnyRequestError = true;
		}, function (error) {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]);

/***/ }),
/* 150 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.network.virtualSwitch", []).factory("Switch", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/switchs", null, {
		query: { method: "GET", isArray: false },
		add: { method: "POST" },
		put: { method: "PUT" },
		delete: { method: "DELETE" }
	});
}]).factory("SwitchItem", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/switch", null, {
		query: { method: "GET", isArray: false },
		put: { method: "PUT" },
		add: { method: "POST" },
		delete: { method: "DELETE" }
	});
}]).factory("Switchdevice", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/list_devices_for_switch", null, {
		query: { method: "GET", isArray: false }
	});
}]).factory("AvailableNodes", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/list_available_nodes_for_switch", null, {
		query: { method: "GET", isArray: false }
	});
}]).controller("vdiVirtualSwitchListController", ["$scope", '$modal', "Switch", "isHAEnabled", "$$$I18N", function ($scope, $modal, Switch, isHAEnabled, $$$I18N) {
	$scope.hasHA_loading = true;
	isHAEnabled().then(function (enabled) {
		$scope.hasHA_loading = false;
		$scope.hasHA = enabled;
	});
	$scope.rows = [];$scope.loading = true;

	var get_rows = function get_rows() {
		Switch.query(function (res) {
			$scope.rows = res.result;
			$scope.rows.map(function (item) {
				item.decodeName = encodeURIComponent(item.name);
			});
			$scope.loading = false;
		});
	};
	get_rows();

	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];
	$scope.currentPage = 1;
	var _SCOPE = $scope;

	$scope.add = function () {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var dialog = $modal.open({
				templateUrl: "views/vdi/dialog/network/virtualSwitch/addVirtualSwitch.html",
				controller: "addVirtualSwitchDialog",
				size: "md"
			});
			dialog.result.then(function (res) {
				if (res) {
					get_rows();
				}
			});
		}
	};

	$scope.edit = function () {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var virtualSwitch = this.item;
			var dialog = $modal.open({
				templateUrl: "views/vdi/dialog/network/virtualSwitch/editVirtualSwitch.html",
				controller: "editVirtualSwitchDialog",
				scope: $scope,
				size: "md",
				resolve: {
					params: function params() {
						return { virtualSwitch: angular.copy(virtualSwitch) };
					}
				}
			});
			dialog.result.then(function (data) {
				if (data) {
					get_rows();
				}
			});
		}
	};
	$scope.delete = function (item) {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除分布式虚拟交换机'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='DELETE_VIRTUALSWITCH'></p><footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''><button class='btn btn-primary' ng-if='!loading' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' ng-if='!loading' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$scope.loading = true;
						Switch.delete({ name: item.name }, function (res) {
							get_rows();
							$modalInstance && $modalInstance.close();
						}).$promise.finally(function (res) {
							$scope.loading = false;
						});
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
}]).controller('editVirtualSwitchDialog', ['$scope', 'params', "$modalInstance", "Switch", "Switchdevice", function ($scope, params, $modalInstance, Switch, Switchdevice) {
	$scope.virtualSwitch = params.virtualSwitch;
	console.log($scope.virtualSwitch);
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.querySwitchdevice = function (type) {
		$scope.loading_hosts = true;
		Switchdevice.query({ type: type }, function (res) {
			$scope.loading_hosts = false;
			$scope.hosts = res.result.filter(function (host) {
				return host.status === 'active';
			});
			$scope.hosts.forEach(function (item) {
				var host = $scope.virtualSwitch.hosts.filter(function (host) {
					return host.host == item.hostname;
				})[0];
				if (host) {
					if (host.dev !== '') {
						item.devs.push(host.dev);
					};
					item._dev = host.dev;
				}
			});
		});
	};
	$scope.querySwitchdevice($scope.virtualSwitch.type);

	$scope.ok = function () {
		$scope.loading = true;
		var hosts = [];
		$scope.hosts.forEach(function (item) {
			hosts.push({ host_id: item.host_id, dev: item._dev ? item._dev : "" });
		});
		Switch.put({
			name: $scope.virtualSwitch.name,
			description: this.virtualSwitch.description,
			type: $scope.virtualSwitch.type,
			hosts: hosts
		}, function (res) {
			$scope.loading = false;
			$modalInstance.close(res);
		}, function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('addVirtualSwitchDialog', ['$scope', "$modalInstance", "Switchdevice", "Switch", function ($scope, $modalInstance, Switchdevice, Switch) {
	$scope.type = 'flat';
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.querySwitchdevice = function (type) {
		$scope.loading_hosts = true;
		Switchdevice.query({ type: type }, function (res) {
			$scope.loading_hosts = false;
			$scope.hosts = res.result.filter(function (host) {
				return host.status === 'active';
			});
			$scope.hosts.forEach(function (item) {
				item._dev = item.devs[0];
			});
		});
	};
	$scope.querySwitchdevice($scope.type);

	$scope.ok = function () {
		$scope.loading = true;
		var hosts = [];
		$scope.hosts.forEach(function (item) {
			hosts.push({ host_id: item.host_id, dev: item._dev ? item._dev : "" });
		});
		Switch.add({
			name: this.name,
			description: this.description,
			type: this.type,
			hosts: hosts
		}, function (res) {
			$scope.loading = false;
			$modalInstance.close(res);
		}, function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller("vdiVirtualSwitchItemController", ["$scope", '$modal', "Switch", "SwitchItem", "isHAEnabled", "$$$I18N", function ($scope, $modal, Switch, SwitchItem, isHAEnabled, $$$I18N) {
	$scope.hasHA_loading = true;
	isHAEnabled().then(function (enabled) {
		$scope.hasHA_loading = false;
		$scope.hasHA = enabled;
	});

	var $hashstr = location.hash.substr(1) || "";
	var $hash = $hashstr.replace(/^\/+/, "").split("&");
	$scope.hostName = decodeURIComponent($hash[0].slice($hash[0].lastIndexOf("#") + 1));
	$scope.type = $hash[1];

	$scope.$root && $scope.$root.$broadcast("navItemSelected", ["网络管理", "分布式虚拟交换机", $scope.hostName]);

	$scope.rows = [];

	var get_rows = function get_rows() {
		$scope.loading = true;
		$scope.rows.splice(0);
		SwitchItem.query({ switch_name: $scope.hostName }, function (res) {
			for (var i in res.result) {
				$scope.rows.push({
					'pool': i,
					'hosts': res.result[i]
				});
			}
			$scope.loading = false;
		});
	};
	get_rows();

	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];
	$scope.currentPage = 1;
	var _SCOPE = $scope;

	$scope.add = function () {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var virtualSwitchItem = this.host;
			var dialog = $modal.open({
				templateUrl: "views/vdi/dialog/network/virtualSwitch/addVirtualSwitchItem.html",
				controller: "addVirtualSwitchItemDialog",
				scope: $scope,
				size: "md"
			});
			dialog.result.then(function (data) {
				if (data) {
					get_rows();
				}
			});
		}
	};
	$scope.edit = function () {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var virtualSwitchItem = this.host;
			var dialog = $modal.open({
				templateUrl: "views/vdi/dialog/network/virtualSwitch/editVirtualSwitchItem.html",
				controller: "editVirtualSwitchItemDialog",
				scope: $scope,
				size: "md",
				resolve: {
					params: function params() {
						return { virtualSwitchItem: angular.copy(virtualSwitchItem) };
					}
				}
			});
			dialog.result.then(function (data) {
				if (data) {
					get_rows();
				}
			});
		}
	};
	$scope.delete = function (item) {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除关联主机'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='DELETE_VIRTUALSWITCHITEM'></p><footer class='text-right'><img src='img/loadingtext.gif' ng-if='loading' height='24' width='24' alt=''><button class='btn btn-primary' data-ng-click='ok()' ng-if='!loading' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' ng-if='!loading'  style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$scope.loading = true;
						SwitchItem.delete({ switch_name: _SCOPE.hostName, host_id: item.host_id }, function (res) {
							get_rows();
							$modalInstance && $modalInstance.close();
						}).$promise.finally(function (res) {
							$scope.loading = false;
						});
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
}]).controller('editVirtualSwitchItemDialog', ['$scope', "$modalInstance", "params", "Switchdevice", "SwitchItem", function ($scope, $modalInstance, params, Switchdevice, SwitchItem) {
	$scope.item = params.virtualSwitchItem;
	$scope.loading_hosts = true;
	$scope.old_dev = params.virtualSwitchItem.dev;
	$scope.querySwitchdevice = function (type, node_id) {
		$scope.loading_hosts = true;
		Switchdevice.query({ type: type, node_id: node_id }, function (res) {
			$scope.loading_hosts = false;
			$scope.item.devs = res.result.filter(function (host) {
				return host.status === 'active' && host.host_id == $scope.item.host_id;
			})[0].devs;
			if ($scope.item.dev !== "") {
				$scope.item.devs.push($scope.item.dev);
			}
		});
	};
	$scope.querySwitchdevice($scope.type);

	$scope.ok = function () {
		$scope.loading = true;
		SwitchItem.put({
			switch_name: $scope.hostName,
			host_id: $scope.item.host_id,
			dev: $scope.item.dev ? $scope.item.dev : ""
		}, function (res) {
			$scope.loading = false;
			$modalInstance.close(res);
		}, function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('addVirtualSwitchItemDialog', ['$scope', "$modalInstance", "SwitchItem", "Switchdevice", "AvailableNodes", function ($scope, $modalInstance, SwitchItem, Switchdevice, AvailableNodes) {
	$scope.item = { pools: [], devs: [] };
	var relateHosts = [];
	$scope.loading_hosts = true;
	Switchdevice.query({ type: $scope.type }, function (res) {
		$scope.loading_hosts = false;
		relateHosts = res.result.filter(function (host) {
			return host.status === 'active';
		});
		$scope.queryPool($scope.hostName);
	});
	$scope.queryPool = function (name) {
		AvailableNodes.query({ switch_name: name }, function (res) {
			for (var i in res.result) {
				var hosts = res.result[i].filter(function (host) {
					return host.status === 'active';
				});
				$scope.item.pools.push({ name: i, hosts: hosts });
			};
			$scope.item.pool = $scope.item.pools[0];
			$scope.changePool();
		});
	};
	$scope.changePool = function () {
		if ($scope.item.pool) {
			$scope.item.host = $scope.item.pool.hosts[0];
			if ($scope.item.host) {
				$scope.changeHost();
			} else {
				$scope.loading_hosts = false;
			}
		} else {
			$scope.loading_hosts = false;
		}
	};
	$scope.changeHost = function () {
		if ($scope.item.host) {
			$scope.item.devs = relateHosts.filter(function (host) {
				return host.host_id == $scope.item.host.host_id;
			})[0].devs;
			$scope.item.dev = $scope.item.devs[0];
		}
	};

	$scope.ok = function () {
		$scope.loading = true;
		SwitchItem.add({
			switch_name: $scope.hostName,
			host_id: $scope.item.host.host_id,
			dev: $scope.item.dev ? $scope.item.dev : ""
		}, function (res) {
			$scope.loading = false;
			$modalInstance.close(res);
		}, function () {
			$scope.loading = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]);

/***/ }),
/* 151 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.network.dataNetwork", []).factory("Network", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/networks", null, {
		query: { method: "GET", isArray: false, params: null },
		add: { method: "POST", isArray: false },

		get: { method: "GET", url: $Domain + "/thor/network/:id", params: { id: "@id" }, isArray: false },
		alter: { method: "PUT", url: $Domain + "/thor/network/:id", params: { id: "@id" }, isArray: false },
		delete: { method: "DELETE", url: $Domain + "/thor/network/:id", params: { id: "@id" }, isArray: false },

		query_sub: { method: "GET", url: $Domain + "/thor/network/:id/subnets", params: { id: "@id" } },
		add_sub: { method: "POST", url: $Domain + "/thor/network/:id/subnets", params: { id: "@id" } },

		get_sub: { method: "GET", url: $Domain + "/thor/network/subnet/:id", params: { id: "@id" } },
		alter_sub: { method: "PUT", url: $Domain + "/thor/network/subnet/:id", params: { id: "@id" } },
		delete_sub: { method: "DELETE", url: $Domain + "/thor/network/subnet/:id", params: { id: "@id" } },

		ports: { method: "GET", url: $Domain + "/thor/network/subnet/:id/ports", params: { id: "@id" } },
		ports_unused_ips: { method: "GET", url: $Domain + "/thor/network/subnet/:id/ports?enable_unused_ips=false", params: { id: "@id" } }

	});
}]).factory("Listswitchs", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/list_switchs_for_network", null, {
		query: { method: "GET", isArray: false }
	});
}]).controller("vdiDataNetworkListController", ["$scope", "Network", '$modal', 'isHAEnabled', '$$$I18N', function ($scope, Network, $modal, isHAEnabled, $$$I18N) {
	$scope.hasHA_loading = true;
	isHAEnabled().then(function (enabled) {
		$scope.hasHA_loading = false;
		$scope.hasHA = enabled;
	});

	$scope.rows = [];$scope.loading = true;

	var get_rows = function get_rows() {
		Network.query(function (res) {
			$scope.rows = res.networks.sort(function (a, b) {
				return a.name > b.name;
			});
			$scope.loading = false;
		});
	};
	get_rows();

	$scope.pagesizes = [10, 20, 30];
	$scope.pagesize = $scope.pagesizes[0];
	$scope.currentPage = 1;

	var _SCOPE = $scope;
	$scope.add = function () {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			$modal.open({
				templateUrl: "views/vdi/dialog/network/dataNetwork/new_network.html",
				controller: "newNetworkDialog",
				size: "dm"
			});
		}
	};
	$scope.alter = function () {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var network = this.item;
			var dialog = $modal.open({
				templateUrl: "views/vdi/dialog/network/dataNetwork/alter_network.html",
				controller: "alterNetworkDialog",
				size: "dm",
				resolve: {
					params: function params() {
						return { network: angular.copy(network) };
					}
				}
			});
			dialog.result.then(function (data) {
				if (data) {
					get_rows();
				}
			});
		}
	};
	$scope.delete = function (item) {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除网络'>" + "删除网络</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='DELETE_NETWORK_COMFIRM'>删除网络将删除该网络下的所有子网，桌面将无法使用该网络，确认删除吗</p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						Network.delete({ id: item.id }, function (res) {
							Network.query(function (res) {
								_SCOPE.rows = res.networks.sort(function (a, b) {
									return a.name > b.name;
								});
							});
						});
					};
					$scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.new_sub_network = function (id) {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var modal = $modal.open({
				controller: "newSubNetworkDialog",
				templateUrl: "views/vdi/dialog/network/dataNetwork/new_sub_network.html",
				resolve: { params: function params() {
						return angular.copy(id);
					} }
			});
			modal.result.then(function (res) {
				if (res) {
					get_rows();
				}
			});
		}
	};
}]).controller('vdiDataNetworkSubNetworkListController', ['$scope', "$modal", "$routeParams", "Network", "isHAEnabled", "$$$I18N", function ($scope, $modal, $routeParams, Network, isHAEnabled, $$$I18N) {
	$scope.hasHA_loading = true;
	isHAEnabled().then(function (enabled) {
		$scope.hasHA_loading = false;
		$scope.hasHA = enabled;
	});

	var get_rows = function get_rows() {
		Network.query_sub({ id: $routeParams.id }, function (res) {
			$scope.rows = res.result.sort(function (a, b) {
				return a.name > b.name;
			});
		});
	};
	get_rows();

	$scope.$root && $scope.$root.$broadcast("navItemSelected", ["网络", "数据网络", "子网"]);
	$scope.cur_network_id = $routeParams.id;
	$scope.delete = function (item) {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			$modal.open({
				template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除网络'>" + "删除子网</h4></div><div class='modal-body'><form class='form-horizontal'><p localize='DELETE_SUB_NETWORK_COMFIRM'>删除子网后，桌面将无法使用该子网，确认删除吗</p><footer  class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",
				controller: function controller($scope, $modalInstance) {
					$scope.ok = function () {
						$modalInstance.close();
						Network.delete_sub({ id: item.id }, function (res) {
							get_rows();
						});
					}, $scope.close = function () {
						$modalInstance.close();
					};
				},
				size: "sm"
			});
		}
	};
	$scope.alter_sub_network = function (item) {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var dialog = $modal.open({
				templateUrl: "views/vdi/dialog/network/dataNetwork/new_sub_network.html",
				controller: "alterSubNetworkDialog",
				size: "dm",
				resolve: {
					params: function params() {
						return { network: angular.copy(item) };
					}
				}
			});
			dialog.result.then(function (res) {
				if (res) {
					get_rows();
				}
			});
		}
	};
	$scope.new_sub_network = function () {
		if ($scope.hasHA) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("ENABLEHA_TIP"),
				timeout: 6000
			});
		} else {
			var dialog = $modal.open({
				controller: "newSubNetworkDialog",
				templateUrl: "views/vdi/dialog/network/dataNetwork/new_sub_network.html",
				resolve: { params: function params() {
						return angular.copy($scope.cur_network_id);
					} }
			});
			dialog.result.then(function (res) {
				if (res) {
					get_rows();
				}
			});
		}
	};
	$scope.enableDHCP = function (data) {
		var postData = {
			id: data.id,
			name: data.name,
			start_ip: data.start_ip,
			end_ip: data.end_ip,
			netmask: data.netmask,
			gateway_ip: data.gateway_ip,
			dns1: data.dns1,
			dns2: data.dns2
		};
		Network.alter_sub(postData, function (res) {
			get_rows();
		}, function () {});
	};
}]).controller("vdiDataNetworkIPListController", ["$scope", "$routeParams", "$modal", "Network", "$$$I18N", function ($scope, $routeParams, $modal, Network, $$$I18N) {
	$scope.rows = [];$scope.loading = true;
	$scope.$root && $scope.$root.$broadcast("navItemSelected", ["资源", "网络", "子网", "IP池"]);
	$scope.cur_network_id = $routeParams.id;
	$scope.cur_subnet_id = $routeParams.sub_id;

	var get_rows = function get_rows() {
		Network.ports_unused_ips({ id: $scope.cur_subnet_id }, function (res) {
			$scope.rows = res.result;
			$scope.loading = false;
		});
	};
	get_rows();

	// var fn_address_callback = function(res){
	// 	$scope.rows = res.data.map(function(item){
	// 		item.able = !item.disable;
	// 		return item;
	// 	});
	// 	$scope.loading = false;
	// 	$scope.rows.forEach(function(row){
	// 		var _ip = row.address.split(".");
	// 		row._ip = (_ip[0] << 16) + (_ip[1] << 8) + Number(_ip[2]) + (_ip[3] / 1000);
	// 	});
	// 	$scope.netmess = res.network;
	// };

	// $scope.pagesize = parseInt(localStorage.netIP_pagesize) || 30;
	// $scope.currentPage = 1;

	// $scope.$watch("pagesize" , function(newvalue){
	// 	newvalue && ( localStorage.netIP_pagesize = newvalue)
	// })
	// network.get({
	// 	id : $routeParams.id
	// }, fn_address_callback, function(err){ 
	// 	location.replace("#resource/network/");
	// 	$.bigBox({
	// 				title : $$$I18N.get("INFOR_TIP"),
	// 				content : "您所访问的网络IP池不存在",//$$$I18N.get("NOEXSIT_NETWORKIP_TIP")
	// 				timeout : 6000
	// 			});
	// });
	// $scope.parent_id = $routeParams.id;

	// $scope.switchable = function(ascope){
	// 	var item = ascope.item;
	// 	network.delete({ids:item.id} ,function(res){
	// 		network.get({
	// 			id : $routeParams.id
	// 		}, fn_address_callback);
	// 	} , function(){
	// 		network.get({
	// 			id : $routeParams.id
	// 		}, fn_address_callback);
	// 	})
	// };

	// $scope.sortUsed = function(order){
	// 	$scope.rows.sort(function(a, b){
	// 		return (a._ip > b._ip) ? 1 : -1;
	// 	});
	// 	var a = $scope.rows.filter(function(row){
	// 		return row.has_used;
	// 	});
	// 	a.forEach(function(row){
	// 		$scope.rows.splice($scope.rows.indexOf(row), 1);
	// 	});
	// 	$scope.rows.unshift.apply($scope.rows, a);
	// 	if(order){
	// 		$scope.rows.reverse();
	// 	}
	// };
	// $scope.sortUser = function(order){
	// 	$scope.rows.sort(function(a, b){
	// 		return (a.assignOwner > b.assignOwner) ? 1 : -1;
	// 	});
	// 	//assignOwner
	// };
	// $scope.sortAllocated = function(order){
	// 	$scope.rows.sort(function(a, b){
	// 		return (a._ip > b._ip) ? 1 : -1;
	// 	});
	// 	var a = $scope.rows.filter(function(row){
	// 		return row.allocated;
	// 	});
	// 	a.forEach(function(row){
	// 		$scope.rows.splice($scope.rows.indexOf(row), 1);
	// 	});
	// 	$scope.rows.unshift.apply($scope.rows, a);
	// 	if(order){
	// 		$scope.rows.reverse();
	// 	}
	// };
	// $scope.sortIP = function(order){
	// 	$scope.rows.sort(function(a, b){
	// 		return (a._ip > b._ip) ? 1 : -1;
	// 	});
	// 	if(order){
	// 		$scope.rows.reverse();
	// 	}
	// };
}])

//dialog controller
.controller("newNetworkDialog", ["$scope", "$modalInstance", "Network", "$$$I18N", "HostManage", "Listswitchs", function ($scope, $modalInstance, Network, $$$I18N, HostManage, Listswitchs) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.network = {};
	$scope.loadding = false;

	$scope.close = function () {
		$modalInstance.close();
	};

	// HostManage.physic_netword_info(function(res){
	// 	$scope.physic_nets = res.result;
	// 	$scope.network.physic_net = $scope.physic_nets[0];
	// });
	var switches = [];
	Listswitchs.query(function (res) {
		switches = res.result;
		$scope.getSwitch($scope.network.type);
	});
	$scope.getSwitch = function (type) {
		$scope.network.switches = switches.filter(function (item) {
			return item.type == type;
		});
		$scope.network.switch = $scope.network.switches[0];
	};

	$scope.ok = function () {
		var postData = {};
		$scope.loadding = true;
		var _netData = $scope.network;

		postData.name = _netData.name;
		postData.type = _netData.type;
		postData.create_subnet = _netData.has_sub;
		postData.switch_name = _netData.switch.name;
		postData.switch_type = _netData.switch.type;
		postData.switch_uuid = _netData.switch.uuid;
		if (postData.type === 'vlan') {
			postData.vlan_id = _netData.vlanid;
			postData.physical_network = "public";
		}
		if (postData.type === 'flat') {
			postData.physical_network = _netData.physic_net;
		}
		if (postData.create_subnet) {
			postData.subnet_name = _netData.sub_name;
			postData.start_ip = _netData.dhcp_start;
			postData.end_ip = _netData.dhcp_end;
			postData.netmask = _netData.netmask;
			postData.gateway = _netData.gateway;
			postData.dns1 = _netData.dns1;
			postData.dns2 = _netData.dns2;
		}
		Network.add(postData, function (res) {
			$modalInstance.close();
			Network.query(function (res) {
				$scope.rows.splice(0, $scope.rows.length);
				[].push.apply($scope.rows, res.networks.sort(function (a, b) {
					return a.name > b.name;
				}));
			});
		}).$promise.finally(function () {
			$scope.loadding = false;
		});
	};
}]).controller('newSubNetworkDialog', ['$scope', 'Network', 'params', '$modalInstance', function ($scope, Network, params, $modalInstance) {
	//新增子网
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.network = {};
	$scope.loadding = false;
	$scope.ok = function () {
		$scope.loadding = true;
		var _netData = $scope.network;
		var postData = {
			id: params,
			name: _netData.name,
			start_ip: _netData.dhcp_start,
			end_ip: _netData.dhcp_end,
			netmask: _netData.netmask,
			gateway_ip: _netData.gateway,
			dns1: _netData.dns1,
			dns2: _netData.dns2
		};
		Network.add_sub(postData, function (res) {
			$modalInstance.close(res);
		}).$promise.finally(function () {
			$scope.loadding = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('alterNetworkDialog', ['$scope', 'params', "$modalInstance", "Network", function ($scope, params, $modalInstance, Network) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	var oldName = params.network.name;
	$scope.network = params.network;
	$scope.loadding = false;
	$scope.isUnchanged = function () {
		return angular.equals($scope.network.name, oldName);
	};
	$scope.ok = function () {
		$scope.loadding = true;
		Network.alter({ name: $scope.network.name, id: $scope.network.id }, function (res) {
			$modalInstance.close(res);
		}).$promise.finally(function () {
			$scope.loadding = false;
		});
	};
	$scope.close = function () {
		$modalInstance.dismiss();
	};
}]).controller('alterSubNetworkDialog', ['$scope', 'params', "$modalInstance", "Network", function ($scope, params, $modalInstance, Network) {
	// 修改子网
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	var _net = params.network;console.log(555555555, _net);
	$scope.network = {
		id: _net.id,
		name: _net.name,
		dhcp_start: _net.start_ip,
		dhcp_end: _net.end_ip,
		netmask: _net.netmask,
		gateway: _net.gateway_ip,
		dns1: _net.dns_nameservers[0],
		dns2: _net.dns_nameservers[1]
	};
	$scope.title_type = 'update';
	$scope.close = function () {
		$modalInstance.dismiss();
	};
	$scope.ok = function () {
		$scope.loadding = true;
		var _netData = $scope.network;
		var postData = {
			id: _netData.id,
			name: _netData.name,
			start_ip: _netData.dhcp_start,
			end_ip: _netData.dhcp_end,
			netmask: _netData.netmask,
			gateway_ip: _netData.gateway,
			dns1: _netData.dns1,
			dns2: _netData.dns2
		};
		Network.alter_sub(postData, function (res) {
			$modalInstance.close(res);
		}).$promise.finally(function () {
			$scope.loadding = false;
		});
	};
}]);

/***/ }),
/* 152 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.network.dhcp", []).factory("DHCP", ["$resource", "$Domain", function (res, $Domain) {
	return res($Domain + "/thor/dhcp", null, {
		query: { method: "GET", isArray: false },
		update: { method: "POST" }
	});
}]).controller("vdiDHCPController", ["$scope", '$modal', 'DHCP', function ($scope, $modal, DHCP) {
	var DHCPCtrl = this;
	DHCPCtrl.data = {};
	var initData = {
		start: '192.168.68.50',
		end: '192.168.68.254',
		netmask: '255.255.255.0',
		gateway: '192.168.68.1',
		dns: ['114.114.114.114']
	};

	DHCPCtrl.changeModify = function (val) {
		DHCPCtrl.updateDHCP(true);
	};
	DHCPCtrl.loadDHCP = function () {
		DHCP.query(function (res) {
			DHCPCtrl.data.enable_dhcp = res.enable_dhcp;
			// 第一次没有值传默认值
			// if(!res.enable_dhcp && res.start==''){
			// 	for(var i in initData){
			// 		if(i=='dns'){
			// 			DHCPCtrl['data'][i] = initData[i][0];
			// 		}else{
			// 			DHCPCtrl['data'][i] = initData[i]
			// 		}
			// 	}
			// }else{
			for (var i in res) {
				if (i !== 'code') {
					if (i == 'dns') {
						DHCPCtrl['data'][i] = res[i][0];
					} else {
						DHCPCtrl['data'][i] = res[i];
					}
				}
			}
			// }
		}, function () {});
	};
	DHCPCtrl.loadDHCP();
	DHCPCtrl.updateDHCP = function (onlyEnable) {
		var postData = { enable_dhcp: DHCPCtrl.data.enable_dhcp };
		if (DHCPCtrl.data.enable_dhcp) {
			//第一次没有值传默认值
			if (DHCPCtrl.data.start == '') {
				for (var i in initData) {
					if (i == 'dns') {
						DHCPCtrl['data'][i] = initData[i][0];
					} else {
						DHCPCtrl['data'][i] = initData[i];
					}
				}
			} else {
				for (var i in initData) {
					postData[i] = DHCPCtrl['data'][i];
				}
			}
		};
		if (onlyEnable) {
			DHCPCtrl.enabling = true;
			DHCP.update(postData, function (res) {
				DHCPCtrl.enabling = false;
				DHCPCtrl.loadDHCP();
				if (!DHCPCtrl.data.enable_dhcp) {
					DHCPCtrl.modify = false;
				}
			}, function () {
				DHCPCtrl.enabling = false;
			});
		} else {
			DHCPCtrl.updating = true;
			DHCP.update(postData, function (res) {
				DHCPCtrl.modify = false;
				DHCPCtrl.updating = false;
			}, function () {
				DHCPCtrl.updating = false;
			});
		}
	};
}]);

/***/ }),
/* 153 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/*
*  Module
*
* Description
*/
angular.module('vdi.monitor', []).factory("SystemAlarm", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/alarmLog", null, {
        query: { method: "GET", isArray: false },
        query_log: { method: "GET", url: $Domain + "/thor/alarm_history/list" },
        delete: { method: "DELETE" },
        // setRead: { method: "PUT" },
        delete_alarm: { method: "DELETE", url: $Domain + "/thor/alarm_history" }
    });
}]).factory("AlarmHistory", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/alarm_history", null, {
        setRead: { method: "POST" }
    });
}]).factory('AlarmPlicy', ['$resource', '$Domain', function ($resource, $Domain) {
    return $resource($Domain + "/thor/alarm/strategy", null, {
        add: { method: "POST", url: $Domain + "/thor/alarm/strategy" },
        alter: { method: "PUT", url: $Domain + "/thor/alarm/strategy/:id", params: { id: "@strategy_id" } },
        query: { method: "GET", url: $Domain + "/thor/alarm/strategy/all" },
        get: { method: "GET", url: $Domain + "/thor/alarm/strategy/:id", params: { id: "@strategy_id" } },
        get_hosts: { method: "GET", url: $Domain + "/thor/alarm/hostInfo" },
        //删除策略
        delete: { method: "DELETE", url: $Domain + "/thor/alarm/strategy" },
        // 设置全局报警项配置
        global_config: { method: "POST", url: $Domain + "/thor/alarm/sys" },
        // 获取全局报警项配置
        get_global_config: { method: "GET", url: $Domain + "/thor/alarm/sys" },
        //读取邮件投递配置
        get_email_config: { method: "GET", url: $Domain + "/thor/settings" },
        // 更新邮件投递配置
        update_email_config: { method: "POST", url: $Domain + "/thor/settings/email" },
        //用邮件配置发送测试邮件
        test_email: { method: "POST", url: $Domain + "/thor/sendmail" }

    });
}]).controller("vdiMonitorAlarmController", ["$scope", "SystemAlarm", "$modal", function ($scope, alarm, $modal) {
    $scope.rows = [];
    var _scope = $scope;
    // alarm.query(function(data){
    //        $scope.allRows = data.result;
    // 	$scope.rows = data.result;
    //        $scope.loading = false;
    //        // angular.copy($scope.rows,$scope.allRows);
    // });

    $scope.getList = function () {
        $scope.loading = true;
        alarm.query_log(function (res) {
            $scope.allRows = res.data.sort(function (a, b) {
                return a.created_at > b.created_at ? -1 : 1;
            });
            $scope.rows = res.data.sort(function (a, b) {
                return a.created_at > b.created_at ? -1 : 1;
            });
            $scope.loading = false;
        });
    };
    $scope.getList();

    $scope.currentPage = 1;
    $scope.pagesize = Number($$$storage.getSessionStorage('alarm_pagesize')) || 30;

    $scope.$watch("pagesize", function (newvalue) {
        if (newvalue) {
            $$$storage.setSessionStorage('alarm_pagesize', newvalue);
        }
    });

    $scope.updateData = function (text) {
        $scope.rows = $scope.allRows.filter(function (row) {
            row._selected = false;
            // if(text){
            // 	return row.log.content.indexOf(text) !== -1;
            // }
            return true;
        });
    };
    $scope.delete = function (item) {
        var rows = item ? [item] : $scope.rows.filter(function (row) {
            return row._selected;
        });
        $modal.open({
            template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='DELETE_ALARM'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='ALARM_DELETE'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
            controller: function controller($scope, $modalInstance) {
                $scope.name = rows.map(function (row) {
                    return row.id;
                }).join(', ');
                $scope.ok = function () {
                    alarm.delete_alarm({ ids: rows.map(function (row) {
                            return row.id;
                        }) }, function (data) {
                        rows.forEach(function (row) {
                            _scope.getList();
                        });
                    });
                    $modalInstance.close();
                }, $scope.close = function () {
                    $modalInstance.close();
                };
            },
            size: "sm"
        });
    };
    $scope.deleteAll = function () {
        $modal.open({
            template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='清空确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='CLEAR_TIP'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
            controller: function controller($scope, $modalInstance) {
                $scope.ok = function () {
                    alarm.delete_alarm({ ids: 'all' }, function (data) {
                        _scope.rows.forEach(function (row) {
                            _scope.getList();
                        });
                    });
                    $modalInstance.close();
                }, $scope.close = function () {
                    $modalInstance.close();
                };
            },
            size: "sm"
        });
    };
}]).controller("vdiMonitorController", ["$scope", "$interval", "$http", "$location", "Host", "PersonDesktop", "$$$I18N", "$Domain", function ($scope, $interval, $http, $location, Host, instance, $$$I18N, $Domain) {
    $scope.net_categories = [];
    $scope.disk_categories = [];
    $scope.$on("setDisk", function (e, value) {
        $scope.disk_category = value;
    });
    $scope.$on("setNet", function (e, value) {
        $scope.net_category = value;
    });
    $scope.refresh_time = 5000;

    $scope.cpu_options = {
        options: {
            chart: {
                type: 'area',
                height: 250,
                animation: Highcharts.svg, // don't animate in old IE
                margin: [30, 0, 65, 68]
            },

            title: {
                text: null
            },
            xAxis: {
                type: 'datetime'
            },
            yAxis: {
                lineWidth: 1,
                tickWidth: 1,
                title: {
                    text: '%',
                    align: 'high',
                    ffset: 0,
                    rotation: 0,
                    y: -20,
                    x: 26

                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                pointFormat: '<span">{series.name}</span>: <b>{point.y:.1f}%</b><br/>',
                //pointFormat: '<span">{series.name}</span>: <b>{point.y:.1f} GB</b><br/>',
                crosshairs: true,
                shared: true,
                xDateFormat: '%Y-%m-%d %H:%M:%S'
            },
            // plotOptions: {
            //     area: {
            //         stacking: 'percent',
            //         // lineColor: '#ffffff',
            //         lineWidth: 1,
            //         marker: {   
            //             lineWidth: 1,
            //             lineColor: '#ffffff'
            //         }
            //     }

            // },
            legend: {
                align: 'right',
                verticalAlign: 'top',
                y: -15
            },

            series: [
            // {
            //     name: '空闲', color: "transparent",
            //     marker: {
            //         enabled: false
            //     }
            // },
            // {name: '正在使用', marker: {
            //     enabled: false
            // }},
            // {name: '系统', color: '#f86161', marker: {
            //     enabled: false
            // }},
            // {name: '等待使用', color: '#88de67', marker: {
            //     enabled: false
            // }}

            { name: $$$I18N.get("占用率"), marker: {
                    enabled: false
                } }]

        },
        drawpoint: function drawpoint(series, data, now) {
            var y0;
            // var y1 = data.cpu.user;
            // var y2 = data.cpu.system;
            // var y3 = data.cpu.iowait;
            // var y0 = 100 - y1 - y2 - y3;

            // series[0].addPoint([now, y0 / 100], true, true);//idel空闲
            // series[1].addPoint([now, y1 / 100], true, true);//user
            // series[2].addPoint([now, y2 / 100], true, true);//system
            // series[3].addPoint([now, y3 / 100], true, true);//iowait
            if (data.cpu.iowait) {
                y0 = data.cpu.system + data.cpu.user + data.cpu.iowait;
            } else y0 = data.cpu.system + data.cpu.user;

            series[0].addPoint([now, y0], true, true);
        }
    };

    $scope.mem_options = {
        options: {
            chart: {
                type: 'area',
                height: 250,
                animation: Highcharts.svg, // don't animate in old IE
                margin: [30, 0, 65, 38]
            },
            title: {
                text: null
            },
            xAxis: {
                type: 'datetime'
            },
            yAxis: {
                lineWidth: 1,
                tickWidth: 1,
                title: {
                    text: 'GB',
                    align: 'high',
                    ffset: 0,
                    rotation: 0,
                    y: -20,
                    x: 26

                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                pointFormat: '<span">{series.name}</span>: <b>{point.y:.1f} GB</b><br/>',
                crosshairs: true,
                shared: true,
                xDateFormat: '%Y-%m-%d %H:%M:%S'
            },
            legend: {
                align: 'right',
                verticalAlign: 'top',
                y: -15
            },

            series: [{
                name: $$$I18N.get("己用内存"),
                color: '#88de67',
                marker: {
                    enabled: false
                }
            }]

        },
        drawpoint: function drawpoint(series, data, now) {
            var y0 = (data.mem.total - data.mem.free) / 1024 / 1024 / 1024;

            series[0].addPoint([now, y0], true, true);
        }
    };

    $scope.net_options = {
        options: {
            chart: {
                type: 'spline',
                height: 250,
                animation: Highcharts.svg, // don't animate in old IE
                margin: [30, 0, 65, 68]
            },

            title: {
                text: null
            },
            xAxis: {
                type: 'datetime'
            },
            yAxis: {
                lineWidth: 1,
                tickWidth: 1,
                labels: {
                    format: "{value}"
                },
                title: {
                    text: 'KB/s',
                    align: 'high',
                    offset: 0,
                    rotation: 0,
                    y: -20,
                    x: 40

                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                pointFormat: '<span">{series.name}</span>: <b>{point.y:.1f}KB/s</b><br/>',
                crosshairs: true,
                shared: true,
                xDateFormat: '%Y-%m-%d %H:%M:%S'
            },

            legend: {
                align: 'right',
                verticalAlign: 'top',
                y: -15
            },
            series: [{
                name: $$$I18N.get("上行"),
                marker: {
                    enabled: false
                }
            }, {
                name: $$$I18N.get("下行"),
                color: '#88de67',
                marker: {
                    enabled: false
                }
            }]

        },
        drawpoint: function drawpoint(series, data, now) {
            var y0 = 0;
            var y1 = 0;
            if ($scope.subpath === 'monitor_hostinfo') {
                if ($scope.net_category) {
                    y0 = data.net[$scope.net_category].sent_rate / 1024;
                    y1 = data.net[$scope.net_category].recv_rate / 1024;
                    series[0].addPoint([now, y0], true, true);
                    series[1].addPoint([now, y1], true, true);
                }
            } else {
                y0 = data.net.read_speed / 1024;
                y1 = data.net.write_speed / 1024;
                series[0].addPoint([now, y0], true, true);
                series[1].addPoint([now, y1], true, true);
            }
        }
    };

    $scope.disk_options = {
        options: {
            chart: {
                type: 'spline',
                height: 250,
                animation: Highcharts.svg, // don't animate in old IE
                margin: [30, 0, 65, 68]
            },

            title: {
                text: null
            },
            xAxis: {
                type: 'datetime'
            },
            yAxis: {
                lineWidth: 1,
                tickWidth: 1,
                labels: {
                    format: "{value}"
                },
                title: {
                    text: 'KB/s',
                    align: 'high',
                    offset: 0,
                    rotation: 0,
                    y: -20,
                    x: 40

                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                pointFormat: '<span">{series.name}</span>: <b>{point.y:.1f}KB/s</b><br/>',
                crosshairs: true,
                shared: true,
                xDateFormat: '%Y-%m-%d %H:%M:%S'
            },

            legend: {
                align: 'right',
                verticalAlign: 'top',
                y: -15
            },
            series: [{
                name: $$$I18N.get("读取"),
                marker: {
                    enabled: false
                }
            }, {
                name: $$$I18N.get("写入"),
                color: '#88de67',
                marker: {
                    enabled: false
                }
            }]

        },
        drawpoint: function drawpoint(series, data, now) {
            var y0 = 0;
            var y1 = 0;
            if ($scope.subpath === 'monitor_hostinfo') {
                if ($scope.disk_category) {
                    y0 = data.disk[$scope.disk_category].read_rate / 1024;
                    y1 = data.disk[$scope.disk_category].write_rate / 1024;
                    series[0].addPoint([now, y1], true, true);
                    series[1].addPoint([now, y0], true, true);
                }
            } else {
                y0 = data.disk.read_speed / 1024;
                y1 = data.disk.write_speed / 1024;
                series[0].addPoint([now, y1], true, true);
                series[1].addPoint([now, y0], true, true);
            }
        }
    };

    $scope.change_server = function (item) {
        $scope.net_categories = [];
        $scope.disk_categories = [];
        $scope.item = item;
        $scope.subpath = item.type == 'vm' ? "monitor_vminfo" : "monitor_hostinfo";
        if (item.type != "vm") {
            return;
        }
        $scope.cur_instance = item;
    };

    function metric_start() {
        return $interval(function () {
            if ($scope.item) {
                $scope.loading = true;
                $http.get($Domain + "/thor/" + $scope.subpath + "/" + $scope.item.id).success(function (data) {
                    $scope.loading = false;
                    //4个图表directive会监听metric_data,4个图表的数据是一次请求拿下来的
                    if (data.data.msg) {
                        //console.log(data.data.msg);
                    } else {
                        if ($scope.subpath === 'monitor_hostinfo') {
                            if ($scope.item.id == data.hostid) {
                                $scope.metric_data = data.data;
                                for (var i in data.data.disk) {
                                    if ($scope.disk_categories.indexOf(i) === -1) {
                                        $scope.disk_categories.push(i);
                                        $scope.$root.$broadcast("setDisk", $scope.disk_categories[0]);
                                    }
                                };
                                for (i in data.data.net) {
                                    if ($scope.net_categories.indexOf(i) === -1) {
                                        $scope.net_categories.push(i);
                                        $scope.$root.$broadcast("setNet", $scope.net_categories[0]);
                                    }
                                };
                            }
                        } else {
                            $scope.metric_data = data.data.result;
                        }
                    }
                });
            }
        }, $scope.refresh_time);
    }

    var load_metric_data = metric_start();

    $scope.$watch('refresh_time', function (newvalue) {
        $interval.cancel(load_metric_data);
        load_metric_data = metric_start();
    });

    $scope.$on('$destroy', function () {
        // Make sure that the interval is destroyed
        $interval.cancel(load_metric_data);
    });

    var path = $location.path();

    if (path == '/monitor/desktop') {
        $http.get($Domain + "/thor/monitor_tree").success(function (data) {
            var trees = [];
            data.data.forEach(function (item) {
                item.insts = item.insts.filter(function (ins) {
                    return ins.status === "running";
                });
                trees.push(item);
            });
            $scope.items = trees.map(function (item) {
                item.opened = false;
                return item;
            });
        });
    } else {
        Host.query_agent(function (data) {
            $scope.items = data.hosts_list.filter(function (item) {
                return item.status === "active";
            });
            if (data.hosts_list.length > 0) $scope.change_server(data.hosts_list[0]);
        });
    }

    //console.log($scope);
    $scope.collapAll = function () {

        $scope.items.map(function (item, index) {
            item.opened = false;
            return item;
        });
    };
    $scope.openAll = function () {
        $scope.items.map(function (item, index) {
            item.opened = true;
            return item;
        });
    };
}]).controller('vdiMonitorPolicyController', ['$scope', '$modal', 'AlarmPlicy', function ($scope, $modal, AlarmPlicy) {
    $scope.rows = [];
    $scope.pagesize = 30;
    $scope.currentPage = 1;
    $scope.pagesizes = [10, 20, 30];
    var monitorScope = $scope;
    function getList() {
        AlarmPlicy.query(function (res) {
            $scope.rows = res.strategys;
        });
    }
    getList();
    $scope.add = function () {
        var addDialog = $modal.open({
            templateUrl: "views/vdi/dialog/monitor/add.html",
            controller: "addDialogController",
            size: "md",
            resolve: {
                param: function param() {
                    return monitorScope.rows;
                }
            }
        });
        addDialog.result.then(function () {
            getList();
        });
    };
    $scope.alter = function (item) {
        var addDialog = $modal.open({
            templateUrl: "views/vdi/dialog/monitor/add.html",
            controller: "alterDialogController",
            size: "md",
            resolve: { param: function param() {
                    return {
                        getPolicyList: monitorScope.rows,
                        item: item
                    };
                } }
        });
        addDialog.result.then(function () {
            getList();
        });
    };
    $scope.view = function (item) {
        $modal.open({
            templateUrl: "views/vdi/dialog/monitor/view.html",
            controller: "viewDialogController",
            size: "md",
            resolve: { param: function param() {
                    return item;
                } }
        });
    };
    $scope.delete = function (item) {
        var rows = item ? [item] : $scope.rows.filter(function (row) {
            return row._selected;
        });
        $modal.open({
            template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除'>" + "删除</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确认删除吗'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'></button></footer></form></div></div></section>",

            controller: function controller($scope, $modalInstance) {
                $scope.ok = function () {
                    $modalInstance.close();
                    AlarmPlicy.delete({ ids: rows.map(function (r) {
                            return r.strategy_id;
                        }) }, function () {
                        getList();
                    });
                }, $scope.close = function () {
                    $modalInstance.close();
                };
            },
            size: "sm"
        });
    };
    $scope.config = function () {
        $modal.open({
            templateUrl: "views/vdi/dialog/monitor/config.html",
            controller: "configDialogController",
            size: "md"
        });
    };
    $scope.notice = function () {
        $modal.open({
            templateUrl: "views/vdi/dialog/monitor/notice.html",
            controller: "noticeDialogController",
            size: "md"
        });
    };
    $scope.active = function (item) {
        var postData = item;
        item.active_loadding = true;
        postData.strategy_enabled = !item.strategy_enabled;
        AlarmPlicy.alter(postData, function () {
            item.active_loadding = false;
        });
    };
}]).controller('addDialogController', ['$scope', '$modalInstance', 'AlarmPlicy', '$$$I18N', 'param', function ($scope, $modalInstance, AlarmPlicy, $$$I18N, param) {
    var AlarmPlicyList = param;
    $scope.pageType = 'add';
    $scope.loading = true;
    $scope.alarm_settings = {
        'node.cpu_util_rate': {
            "cond_duration": 10,
            "cond_value": 80,
            "enabled": false
        },
        'node.mem_util_rate': {
            "cond_duration": 10,
            "cond_value": 80,
            "enabled": false
        },
        'node.network_util_rate': {
            "cond_duration": 10,
            "cond_value": 80,
            "enabled": false
        },
        'node.mount_point_util_rate': {
            "cond_value": 90,
            "enabled": false
        },
        'node.disk_io': {
            "cond_duration": 10,
            "cond_value": 80,
            "enabled": false
        }
    };
    $scope.pools = [];
    $scope.data = {};
    $scope.data.host_ids = [];
    AlarmPlicy.get_hosts(function (res) {
        $scope.loading = false;
        $scope.pools = res.result.filter(function (r) {
            return r.hosts.length;
        });
    });
    $scope.check_alarm_null = function () {
        return Object.keys($scope.alarm_settings).every(function (key) {
            return $scope.alarm_settings[key].enabled === false;
        });
    };
    $scope.checkOne = function (pool) {
        pool._selected = pool.hosts.every(function (h) {
            return h._selected;
        });
        $scope.data.host_ids = $scope.pools.reduce(function (host_ids, pool) {
            pool.hosts.forEach(function (host) {
                if (host._selected) {
                    host_ids.push(host.host_uuid);
                }
            });
            return host_ids;
        }, []);
    };
    $scope.checkAll = function (pool) {
        pool.hosts.forEach(function (h) {
            h._selected = pool._selected;
        });
        $scope.data.host_ids = $scope.pools.reduce(function (host_ids, pool) {
            pool.hosts.forEach(function (host) {
                if (host._selected) {
                    host_ids.push(host.host_uuid);
                }
            });
            return host_ids;
        }, []);
    };

    $scope.ok = function () {
        var d = $scope.data;
        var s = $scope.alarm_settings;
        var flag = false;
        var postData = {
            "name": d.name,
            "desc": d.desc,
            "alarm_settings": s,
            "hosts": d.host_ids,
            "email_enabled": d.email_enabled,
            "email_address": d.email_enabled ? d.email_address : undefined,
            "strategy_enabled": true
        };
        AlarmPlicyList.map(function (it) {
            if (it.name === postData.name) {
                flag = true;
            }
        });
        if (flag) {
            $.bigBox({
                title: $$$I18N.get("INFOR_TIP"),
                content: $$$I18N.get("VDI_AlarmPlicy_TIPS"),
                timeout: 6000
            });
            return;
        }
        $scope.submiting = true;
        AlarmPlicy.add(postData).$promise.then(function () {
            $modalInstance.close();
        }).finally(function () {
            $scope.submiting = false;
        });
    };
    $scope.close = function () {
        $modalInstance.dismiss();
    };
}]).controller('alterDialogController', ['$scope', '$modalInstance', 'param', 'AlarmPlicy', '$$$I18N', function ($scope, $modalInstance, param, AlarmPlicy, $$$I18N) {
    $scope.pageType = 'alter';
    $scope.data = param.item;
    var filterAlterPolicy = param.getPolicyList.filter(function (it) {
        return it.name != param.item.name;
    });
    $scope.alarm_settings = {
        'node.cpu_util_rate': {},
        'node.mem_util_rate': {},
        'node.network_util_rate': {},
        'node.mount_point_util_rate': {},
        'node.disk_io': {}
    };
    Object.keys(param.item.alarm_settings).forEach(function (key) {
        $scope.alarm_settings[key] = param.item.alarm_settings[key];
    });
    $scope.loading = true;

    AlarmPlicy.get_hosts(function (res) {
        $scope.loading = false;
        $scope.pools = res.result.map(function (p) {
            p.hosts.forEach(function (h) {
                if (param.item.hosts.indexOf(h.host_uuid) > -1) {
                    h._selected = true;
                }
            });
            p._selected = p.hosts.length ? p.hosts.every(function (h) {
                return param.item.hosts.indexOf(h.host_uuid) > -1;
            }) : false;
            return p;
        }).filter(function (p) {
            return p.hosts.length;
        });
        get_host_ids();
    });

    function get_host_ids() {
        $scope.data.host_ids = $scope.pools.reduce(function (host_ids, pool) {
            pool.hosts.forEach(function (host) {
                if (host._selected) {
                    host_ids.push(host.host_uuid);
                }
            });
            return host_ids;
        }, []);
    }
    $scope.check_alarm_null = function () {
        return Object.keys($scope.alarm_settings).every(function (key) {
            return $scope.alarm_settings[key].enabled === false;
        });
    };
    $scope.checkOne = function (pool) {
        pool._selected = pool.hosts.every(function (h) {
            return h._selected;
        });
        get_host_ids();
    };
    $scope.checkAll = function (pool) {
        pool.hosts.forEach(function (h) {
            h._selected = pool._selected;
        });
        get_host_ids();
    };

    $scope.ok = function () {
        var d = $scope.data;
        var s = $scope.alarm_settings;
        var flag = false;
        var postData = {
            "name": d.name,
            "desc": d.desc,
            "alarm_settings": s,
            "hosts": d.host_ids,
            "email_enabled": d.email_enabled,
            "email_address": d.email_enabled ? d.email_address : undefined,
            "strategy_enabled": d.strategy_enabled,
            "strategy_id": d.strategy_id
        };
        filterAlterPolicy.map(function (it) {
            if (it.name === postData.name) {
                flag = true;
            }
        });
        if (flag) {
            $.bigBox({
                title: $$$I18N.get("INFOR_TIP"),
                content: $$$I18N.get("VDI_AlarmPlicy_TIPS"),
                timeout: 6000
            });
            return;
        }
        $scope.submiting = true;
        AlarmPlicy.alter(postData).$promise.then(function () {
            $modalInstance.close();
        }).finally(function () {
            $scope.submiting = false;
        });
    };
    $scope.close = function () {
        $modalInstance.dismiss();
    };
}]).controller('viewDialogController', ['$scope', '$modalInstance', 'param', 'AlarmPlicy', function ($scope, $modalInstance, param, AlarmPlicy) {
    $scope.data = param;
    $scope.loading = true;
    AlarmPlicy.get_hosts(function (res) {
        $scope.loading = false;
        $scope.pools = res.result.reduce(function (p_arr, p) {
            var p_hosts = p.hosts.reduce(function (h_arr, h) {
                if (param.hosts.indexOf(h.host_uuid) > -1) {
                    h_arr.push(h);
                }
                return h_arr;
            }, []);
            if (p_hosts.length) {
                p.hosts = p_hosts;
                p_arr.push(p);
            }
            return p_arr;
        }, []);
    });
    $scope.close = function () {
        $modalInstance.close();
    };
}]).controller('configDialogController', ['$scope', '$modalInstance', 'AlarmPlicy', function ($scope, $modalInstance, AlarmPlicy) {
    $scope.data = {
        'node.service_exception': {},
        'node.disconn': {},
        'sys.ha': {},
        'inst.ha': {},
        'inst.teach_desktop_using_time': {},
        'inst.personal_desktop_using_time': {},
        'sys.authorization': {}
    };
    $scope.submiting = true;
    AlarmPlicy.get_global_config(function (res) {
        var resdata = res.alarm_settings;
        Object.keys(resdata).forEach(function (key) {
            $scope.data[key] = resdata[key];
        });
        $scope.config = res;
    }).$promise.finally(function () {
        $scope.submiting = false;
    });
    $scope.ok = function () {
        var d = $scope.data;
        var postData = {
            'alarm_settings': d,
            'email_enabled': $scope.config.email_enabled,
            'email_address': $scope.config.email_enabled ? $scope.config.email_address : undefined
        };
        $scope.submiting = true;
        AlarmPlicy.global_config(postData).$promise.then(function () {
            $modalInstance.close();
        }).finally(function () {
            $scope.submiting = false;
        });
    };
    $scope.close = function () {
        $modalInstance.close();
    };
}]).controller('noticeDialogController', ['$scope', '$modalInstance', 'AlarmPlicy', function ($scope, $modalInstance, AlarmPlicy) {
    $scope.data = {};
    $scope.submiting = true;
    AlarmPlicy.get_email_config({ name: 'email' }, function (res) {
        $scope.data = res.value;
    }).$promise.finally(function () {
        $scope.submiting = false;
    });
    $scope.ok = function () {
        $scope.submiting = true;
        AlarmPlicy.update_email_config({
            "name": "email",
            "value": $scope.data
        }).$promise.then(function () {
            $modalInstance.close();
        }).finally(function () {
            $scope.submiting = false;
        });
    };
    $scope.close = function () {
        $modalInstance.close();
    };
    $scope.test_mail = function () {
        $scope.submiting = true;
        AlarmPlicy.test_email({
            "name": "email",
            "value": $scope.data
        }).$promise.then(function () {}).finally(function () {
            $scope.submiting = false;
        });
    };
}]);

/***/ }),
/* 154 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.scheduler", []).factory("Scheduler", ["$resource", "$Domain", function ($resource, $Domain) {
	return $resource($Domain + "/thor/classScheduler", { pool_id: "@pool_id" }, {
		get: { method: "GET" },
		save: { method: "POST" },
		getConfig: { method: "GET", url: $Domain + "/thor/classSchedulerConfig" },
		updateConfig: { method: "PUT", url: $Domain + "/thor/classSchedulerConfig" }
	});
}]).config(["$filterProvider", function ($filterProvider) {
	var num_day = 3600 * 1000 * 24;
	$filterProvider.register("weekChecked", function () {
		return function (items, checked) {
			if (!items instanceof Array) return items;
			checked = Boolean(checked);
			return items.filter(function (item) {
				return item.checked === checked;
			});
		};
	});
	$filterProvider.register("getWeeks", function () {
		return function (items, start, end) {
			if (!items instanceof Array) return items;
			var start_time_week_start_time = start - num_day * start.getDay();
			var start_time_week_end_time = start_time_week_start_time + num_day * 7;
			var end_time_week_start_time = end - num_day * end.getDay();
			var end_time_week_end_time = end_time_week_start_time + num_day * 7;
			var weeks = [];
			var span = end_time_week_end_time - start_time_week_start_time;
			while (span > 0) {
				weeks.push({
					name: "第" + (weeks.length + 1) + "周",
					start: start_time_week_start_time + weeks.length * num_day * 7,
					end: start_time_week_end_time + weeks.length * num_day * 7,
					checked: false,
					disabled: false
				});
				span -= num_day * 7;
			}
			return weeks;
		};
	});
}]).directive("schedulerweek", function () {
	return {
		restrict: "E",
		//require: "^vdiSchedulerViewController",
		template: '<div class="btn btn-md vdi_scheduler_week_button" ng-class="{disabled: week.disabled,\'btn-primary\': week.selected, \'btn-default\': !week.selected}" \
			ng-click="week.checked = !week.checked;">\
			<label class="checkbox"><input ng-model="week.checked" type="checkbox"><i></i></label>\
			<span >{{ week.name }}</span></div>',
		scope: {
			week: "="
		},
		controller: function controller($scope) {
			//console.log($scope);
		},
		replace: true,
		link: function link($scope, ele, attrs) {}
	};
}).directive("schedulersceneitem", function () {
	return {
		restrict: "E",
		replace: true,
		require: ["^schedulerday", "^schedulerCanvas"],
		template: '<div class="scene_in_day_item" ng-class="{modifiable:modifiable}">\
			<div class="item_body">\
				<div class="item_dnd_body"><b>{{ scene.name }}</b></div>\
				<div class="item_dnd_header"></div>\
				<div class="item_dnd_footer"></div>\
				<a class="item_remove" ng-click="remove()"><i class="fa fa-times"></i></a>\
			</div></div>',
		scope: {
			scene: "=",
			modifiable: "="
		},
		controller: function controller($scope) {
			var scene = $scope.scene;
			this.value = $scope.value = function () {
				return Math.pow(2, scene.end - scene.start + 1) - 1 << 12 - scene.end;
			};
		},
		link: function link(scope, ele, attr, ctrls) {
			var ox = 0;
			var oy = 0;
			var enable = false;
			var day = ctrls[0];
			var canvas = ctrls[1];
			scope.remove = function () {
				scope.modifiable && day.removeChild(scope.scene);
			};
			ele.find(".item_dnd_body").mousedown(function (e) {
				scope.modifiable && canvas.startSceneDND(scope.scene, e, ele);
			});
			ele.find(".item_dnd_header").mousedown(function (e) {
				scope.modifiable && canvas.startSceneStartModify(scope.scene, e, ele, day.mask());
			});
			ele.find(".item_dnd_footer").mousedown(function (e) {
				scope.modifiable && canvas.startSceneEndModify(scope.scene, e, ele, day.mask());
			});
			var scene = scope.scene;
			ele.css({
				top: Math.max(0, Math.min(13, scene.start - 1)) * 48 + "px",
				height: Math.max(1, Math.min(13, scene.end - scene.start + 1)) * 48 - 8 + "px"
			});
		}
	};
}).directive("schedulerday", function () {
	return {
		restrict: "E",
		//require: "^vdiSchedulerViewController",
		template: '<div class="class_day">\
				<ol class="class_hour_list no_index"><li class="class_hour_cell" data-ng-repeat="classHour in classHours"></li></ol>\
				<div class="scene_in_day"><schedulerSceneItem data-modifiable="modifiable" data-scene="scene" data-ng-repeat="scene in scenes"></schedulerSceneItem></div>\
			</div>',
		replace: true,
		controller: function controller($scope) {
			var it = this;
			this.scope = $scope;
			this.mask = $scope.mask = function () {
				return 4095 ^ $scope.scenes.reduce(function (m, scene) {
					return m | Math.pow(2, scene.end - scene.start + 1) - 1 << 12 - scene.end;
				}, 0);
			};
			this.removeChild = function (child) {
				var index = $scope.scenes.indexOf(child);
				if (index > -1) {
					$scope.scenes.splice(index, 1);
				}
			};
		},
		scope: {
			classHours: "=hours",
			scenes: "=scenes",
			modifiable: "="
		},
		link: function link(scope, ele, attrs) {}
	};
}).directive("scheduleritems", function () {

	return {
		restrict: "E",
		//require: ["schedulerCanvas"],
		template: '<div class="jarviswidget jarviswidget-sortable">\
			<header role="heading"><h2 data-localize="添加场景排程"></h2></header>\
			<div role="content"><div style="color:#333;margin-bottom:10px;" data-localize="SCHEDULES"></div>\
				<div class="widget-body" data-ng-transclude>\
				</div>\
			</div>\
		</div>',
		controller: function controller($scope) {},
		replace: true,
		transclude: true,
		link: function link(scope, ele, attrs) {}
	};
}).directive("scheduleritem", function () {
	return {
		restrict: "E",
		template: '<div class="scene_item">{{ scene.name }}</div>',
		controller: function controller($scope) {},
		require: ["^scheduleritems", "^schedulerCanvas"],
		replace: true,
		transluce: true,
		scope: {
			scene: "=",
			modifiable: "="
		},
		link: function link(scope, ele, attrs, ctrls) {
			var canvas = ctrls[1];
			ele.mousedown(function (e) {
				scope.modifiable && canvas.startDND(scope.scene, e, ele);
			});
		}
	};
}).directive("schedulerCanvas", ["Scene", function () {
	return {
		restrict: "A",
		controller: function controller($scope) {
			var fn_pos_info = function fn_pos_info(e, target) {
				var cells = $scope._element.find(".class_hour_cell");
				$scope._cell_offset = cells.offset();
				$scope._cell_offset.width = cells.width();
				$scope._cell_offset.height = cells.height();
				var _t = $(target[0].cloneNode(1));
				var target_offset = target.offset();
				$scope._handler._px = e.pageX;
				$scope._handler._py = e.pageY;
				$scope._handler._fx = e.pageX - target_offset.left;
				$scope._handler._fy = e.pageY - target_offset.top;
				$scope._handler._ow = target.width();
				$scope._handler._oh = target.height();
				$scope._handler._tx = e.clientX - $scope._handler._fx;
				$scope._handler._ty = e.clientY - $scope._handler._fy;
				_t.css({
					position: "absolute",
					width: $scope._handler._ow + "px",
					height: $scope._handler._oh + "px",
					left: $scope._handler._tx + "px",
					top: $scope._handler._ty + "px"
				});
				$scope._handler._t = _t;
				$scope._handler.html("");
				$scope._handler.append(_t);
				document.body.appendChild($scope._canvas);
				//$("html body").css("overflow", "hidden");
			};
			this.startSceneDND = function (scene, domEvent, target) {
				fn_pos_info(domEvent, target);
				$scope._source_scene = scene;
				$scope._event_type = "moveScene";
				$scope.$emit("moveSceneStart", scene);
				//target.remove();
			};
			this.startSceneStartModify = function (scene, domEvent, target) {
				fn_pos_info(domEvent, target);
				$scope._source_scene = scene;
				$scope._event_type = "modifySceneStart";
				$scope.$emit("moveSceneStart", scene);
				//target.remove();
			};
			this.startSceneEndModify = function (scene, domEvent, target) {
				fn_pos_info(domEvent, target);
				$scope._source_scene = scene;
				$scope._event_type = "modifySceneEnd";
				$scope.$emit("moveSceneStart", scene);
				//target.remove();
			};
			this.startDND = function (scene, domEvent, target) {
				fn_pos_info(domEvent, target);
				$scope._source_scene = scene;
				$scope._event_type = "addNewScene";
			};
		},
		link: function link(scope, ele, attrs) {
			scope._element = ele;
			var fn_restore_canvas_state = function fn_restore_canvas_state() {
				fn_move_handler_to(0, 0);
			};
			var fn_move_handler_to = function fn_move_handler_to(x, y) {
				handler.css("transform", "translate(" + x + "px, " + y + "px)");
			};
			var canvas = scope._canvas = $('<div class="scheduler_dnd_canvas"><div class="dnd_handler"></div><div class="dnd_masker"></div></div>')[0];
			var masker = $(".dnd_masker", canvas).scroll(function (e) {
				e.preventDefault();
			}).on("mousewheel", function (e) {
				e.preventDefault();
			}).mousemove(function (e) {
				var height;
				if (scope._event_type.indexOf("modifyScene") === 0) {
					switch (scope._event_type) {
						case "modifySceneStart":
							var top = Math.min(handler._ty + handler._oh - 40, Math.max(handler._ty - (scope._source_scene.start - 1) * 48, handler._ty - (handler._py - e.pageY)));
							height = Math.min(scope._source_scene.end * 48 - 8, Math.max(40, handler._oh + handler._py - e.pageY));
							handler._t.css({
								top: top + "px",
								height: height + "px"
							});
							handler._ns = top;
							handler._nh = height;
							break;
						case "modifySceneEnd":
							height = Math.min((13 - scope._source_scene.start) * 48 - 8, Math.max(40, handler._oh + (e.pageY - handler._py)));
							handler._t.css({
								height: height + "px"
							});
							handler._ns = handler._ty;
							handler._nh = height;
							break;
					}
				} else {
					fn_move_handler_to(e.pageX - handler._px, e.pageY - handler._py);
				}
				document.selection && document.selection.empty();
				document.getSelection && document.getSelection().removeAllRanges();
			}).mouseup(function (e) {
				var day = (e.pageX - scope._cell_offset.left) / (scope._cell_offset.width + 1) | 0;
				var start = ((e.pageY - scope._cell_offset.top) / scope._cell_offset.height | 0) + 1;
				var end;
				switch (scope._event_type) {
					case "addNewScene":
						end = start;
						scope.$emit("addNewScene", day, {
							start: start,
							end: end,
							pool: scope._source_scene.pool,
							mode: scope._source_scene.id
						});
						break;
					case "moveScene":
						start -= handler._fy / scope._cell_offset.height | 0;
						scope.$emit("moveScene", day, scope._source_scene, {
							start: start,
							end: start + (scope._source_scene.end - scope._source_scene.start)
						});
						break;
					case "modifySceneStart":
					case "modifySceneEnd":
						handler._ns = handler._ns || handler._ty;
						handler._nh = handler._nh || handler._oh;
						handler._nh += 8;
						start = Math.max(1, Math.min(12, scope._source_scene.start + Math.round((handler._ns - handler._ty) / 48)));
						end = Math.max(start, Math.min(12, start + Math.round(handler._nh / 48) - 1));
						console.log(scope._source_scene.start, scope._source_scene.end, handler._oh);
						console.log(start, end, handler._nh, handler._nh / 48);
						scope.$emit("modifyScene", scope._source_scene, {
							start: start,
							end: end
						});
						handler._ns = handler._nh = NaN;
						break;
				}
				fn_restore_canvas_state();
				canvas.parentNode && canvas.parentNode.removeChild(canvas);
				scope._source_scene = null;
				//$("html body").css("overflow", "auto");
				scope.$emit("endModifyScene");
			}).mouseout(function () {
				canvas.parentNode && canvas.parentNode.removeChild(canvas);
				//$("html body").css("overflow", "auto");
				scope.$emit("endModifyScene");
			})[0];
			var handler = scope._handler = $(".dnd_handler", canvas);
			scope.$on("newScheduler", function ($event, scene, offset) {});
		}
	};
}]).controller("vdiSchedulerViewController", ["$scope", "Scheduler", "Scene", "SchoolRoom", "$modal", "UserRole", function ($scope, scheduler, Scene, schoolroom, $modal, UserRole) {
	var user = UserRole.currentUser;
	if (user === null) {
		return;
	}
	$scope.editMode = false;
	$scope.classes = [];
	$scope.class = null;
	//$scope.start_time = new Date();
	//$scope.end_time = new Date();
	$scope.time_span = 0;
	var num_day = 3600 * 1000 * 24;

	$scope.scenes = [];
	$scope.dates = [];
	var _scenes = {};
	$scope.editWeek = null;
	schoolroom.querywithSimple(function (res) {
		var schoolrooms = [];
		res.pools_.forEach(function (item) {
			if (item.user_ids.some(function (data) {
				return data === user.id;
			})) {
				schoolrooms.push(item);
			}
		});
		$scope.classes = schoolrooms;
		$scope.class = $scope.classes[0] || null;
		Scene.query(function (res) {
			$scope.scenes = res.modes;
			$scope.scenes.forEach(function (mode) {
				_scenes[mode.id] = mode;
			});
			$scope.class && fn_get_scheduler($scope.class);
		});
	});
	// Scene.query(function(res){
	// 	console.log(this, arguments, $scope.class);
	// 	$scope.scenes = res.modes;
	// 	$scope.scenes.forEach(function(mode){
	// 		_scenes[mode.id] = mode;
	// 	});
	// 	schoolroom.query(function(res){
	// 		var schoolrooms = [];
	// 		res.pools_.forEach(function(item){
	// 			if(item.user_ids.some(data => data === user.id )){
	// 				schoolrooms.push(item);
	// 			}
	// 		})
	// 		$scope.classes = schoolrooms;
	// 		$scope.class = $scope.classes[0] || null;
	// 		$scope.class && fn_get_scheduler($scope.class);
	// 	});
	// });
	window.sss = $scope;

	var fn_update_config = function fn_update_config(config) {
		var now = new Date(config.now);
		$scope.time_span = now.getTime() - Date.now();
		$scope.start_time = new Date(config.semester_start - config.semester_start % num_day);
		$scope.end_time = new Date(config.semester_end - config.semester_end % num_day);

		var week_start_day = -1;

		$scope.start_time_week_start_time = $scope.start_time - num_day * ($scope.start_time.getDay() + week_start_day);
		$scope.start_time_week_end_time = $scope.start_time_week_start_time + num_day * 7;
		$scope.end_time_week_start_time = $scope.end_time - num_day * ($scope.end_time.getDay() + week_start_day);
		$scope.end_time_week_end_time = $scope.end_time_week_start_time + num_day * 7;

		//var ymd = [now.getFullYear(), now.getMonth() + 1, now.getDate()].join("-");
		var y = now.getFullYear(),
		    m = now.getMonth(),
		    d = now.getDate();
		$scope.classHours = config.period.map(function (classHour, i) {
			var start = classHour[0].split(":");
			var end = classHour[1].split(":");
			return {
				index: i + 1,
				start: new Date(y, m, d, start[0], start[1]),
				end: new Date(y, m, d, end[0], end[1])
			};
		});

		var start_time = $scope.start_time.getTime();
		var end_time = $scope.end_time.getTime();
		$scope.dates.splice(0, $scope.dates.length);
		var date_start = 0;
		do {
			var date_start_time = date_start * num_day + $scope.start_time_week_start_time;
			var start_date = new Date(date_start_time);
			$scope.dates.push({
				start: date_start_time,
				start_date: start_date,
				name: "周" + "日一二三四五六"[start_date.getDay()],
				scenes: date_start_time >= start_time && date_start_time <= end_time ? [] : null
			});
			date_start++;
		} while (date_start_time < end_time || $scope.dates.length % 7);

		var week_start = 0;
		$scope.weeks.splice(0);

		while (week_start * 7 < $scope.dates.length) {
			var _start = $scope.start_time_week_start_time + num_day * 7 * week_start;
			$scope.weeks.push({
				index: week_start,
				name: "第" + (week_start + 1) + "周",
				selected: false,
				start: _start,
				end: _start + num_day * 7,
				checked: false,
				disabled: _start - now < -num_day * 7,
				days: $scope.dates.slice(week_start * 7, ++week_start * 7)
			});
		}
		var now_week = null;
		var now_day = null;
		var now_ts = Date.now() + $scope.time_span;

		now_week = $scope.weeks.filter(function (week) {
			return now_ts >= week.start && now_ts < week.start + num_day * 7;
		})[0];
		now_day = now_week ? now_week.days.filter(function (day) {
			return now_ts >= day.start && now_ts < day.start + num_day;
		})[0] : null;
		now_week && (now_week.current = true);
		now_day && (now_day.current = true);

		if ($scope.currentWeek) {
			var WEEk = $scope.weeks.filter(function (item) {
				return item.index == $scope.currentWeek.index;
			})[0];
			if (WEEk) {
				$scope.currentWeek = WEEk;
			} else {
				$scope.currentWeek = now_week;
			}
		} else {
			$scope.currentWeek = now_week;
		}
		$scope.class && fn_get_scheduler($scope.class);

		// $scope.currentWeek = $scope.currentWeek? $scope.currentWeek : now_week;
		//now_week && (now_week.checked = true);
	};

	scheduler.getConfig(function (res) {
		fn_update_config(res.result);
	});

	$scope.classChange = function () {
		$scope.class && fn_get_scheduler($scope.class);
	};
	var _currentWeek = null;
	$scope.enableEditMode = function () {
		_currentWeek = $scope.currentWeek;
		$scope.currentWeek = angular.copy(_currentWeek);
		$scope.currentWeek.days.forEach(function (day) {
			day.scenes = day.scenes || [];
		});
	};
	$scope.disableEditMode = function () {
		$scope.currentWeek = _currentWeek;
		$scope.editMode = false;
		$scope.weeks.forEach(function (week) {
			week.checked = false;
		});
	};

	$scope.siblingWeek = function (seed) {
		if ($scope.currentWeek) {
			$scope.currentWeek = $scope.weeks[Math.min($scope.weeks.length - 1, Math.max(0, $scope.currentWeek.index + seed))];
		}
	};
	$scope.siblingWeekState = function (seed) {
		return $scope.currentWeek && $scope.weeks[$scope.currentWeek.index + seed] ? true : false;
	};

	var fn_get_scheduler = function fn_get_scheduler(_class) {
		scheduler.get({ pool_id: _class.id }, function (res) {
			_class.data = res.result.data;

			$scope.dates.forEach(function (day) {
				day.scenes && day.scenes.splice(0, day.scenes.length);
			});

			Object.keys(_class.data).forEach(function (date) {
				$scope.dates.forEach(function (day) {
					if (date >= day.start && date - day.start < num_day) {
						// console.log(day.start - date, day.start, date);
						day.scenes && _class.data[date].forEach(function (scene) {
							_scenes[scene.mode_id] && day.scenes.push({
								time: day.start,
								start: scene.start_at + 1,
								end: scene.end_at + 1,
								mode: scene.mode_id,
								name: _scenes[scene.mode_id].name,
								pool: scene.pool_id
							});
						});
					}
				});
			});
		});
	};

	$scope.weeks = [];
	$scope.weekCheckAll = false;
	$scope.weekCheckOdd = false;
	$scope.weekCheckEven = false;
	$scope.weekCheckSome = false;
	$scope.currentEditWeek = null;
	$scope.checkSomeWeeks = function (val) {
		return $scope.weeks.some(function (week) {
			return week.checked === val;
		});
	};
	$scope.checkAllWeeks = function (val) {
		if (val !== undefined) {
			$scope.weeks.forEach(function (week) {
				week.checked = !val;
			});
		} else {
			if ($scope.weeks.length) {
				var res = $scope.weeks.every(function (week) {
					return week.checked;
				});
				if (res) {
					$scope.weekCheckAll = $scope.weekCheckOdd = $scope.weekCheckEven;
				} else {}
				return res;
			}
			return false;
		}
	};
	$scope.checkAllOddWeeks = function (val) {
		if (val !== undefined) {
			$scope.weeks.forEach(function (week, index) {
				!Boolean(index % 2) && (week.checked = !val);
			});
		} else {
			if ($scope.weeks.length) {
				var res = $scope.weeks.every(function (week, index) {
					return Boolean(index % 2) || week.checked;
				});
				$scope.weekCheckOdd = res;
				$scope.weekCheckAll = $scope.weekCheckOdd && $scope.weekCheckEven;
				return res;
			}
			return false;
		}
	};
	$scope.checkAllEvenWeeks = function (val) {
		if (val !== undefined) {
			$scope.weeks.forEach(function (week, index) {
				Boolean(index % 2) && (week.checked = !val);
			});
		} else {
			if ($scope.weeks.length) {
				var res = $scope.weeks.every(function (week, index) {
					return !Boolean(index % 2) || week.checked;
				});
				$scope.weekCheckEven = res;
				$scope.weekCheckAll = $scope.weekCheckOdd && $scope.weekCheckEven;
				return res;
			}
			return false;
		}
	};

	$scope.$on("moveSceneStart", function (de, scene) {
		$scope.currentWeek.days.forEach(function (day) {
			var index = day.scenes ? day.scenes.indexOf(scene) : -1;
			if (index > -1) {
				day.moving_scene = day.scenes.splice(index, 1);
			}
		});
		$scope.$apply();
	});
	$scope.$on("moveScene", function (de, day, scene, newScene) {
		var _day = $scope.currentWeek.days[day];
		if (_day && _day.scenes) {
			var m = 4095 ^ _day.scenes.reduce(function (m, scene) {
				return m | Math.pow(2, scene.end - scene.start + 1) - 1 << 12 - scene.end;
			}, 0);
			var data = Math.pow(2, newScene.end - newScene.start + 1) - 1 << 12 - newScene.end;
			if ((m & data) === data) {
				scene.start = newScene.start;
				scene.end = newScene.end;
				_day.scenes.push(scene);
				$scope.currentWeek.days.forEach(function (day) {
					day.moving_scene = undefined;
					delete day.moving_scene;
				});
			}
		}
	});

	$scope.$on("modifyScene", function (de, scene, newScene) {
		var _day = $scope.currentWeek.days.filter(function (day) {
			return day.moving_scene;
		})[0];
		if (_day && _day.scenes) {
			var m = 4095 ^ _day.scenes.reduce(function (m, scene) {
				return m | Math.pow(2, scene.end - scene.start + 1) - 1 << 12 - scene.end;
			}, 0);
			var data = Math.pow(2, newScene.end - newScene.start + 1) - 1 << 12 - newScene.end;
			if ((m & data) === data) {
				scene.start = newScene.start;
				scene.end = newScene.end;
				//_day.scenes.push(scene);
			}
		}
	});

	$scope.$on("endModifyScene", function () {
		$scope.currentWeek.days.forEach(function (day) {
			if (day.moving_scene) {
				day.scenes.push.apply(day.scenes, day.moving_scene);
				day.moving_scene = undefined;
				delete day.moving_scene;
			}
		});
		$scope.$apply();
	});

	$scope.$on("addNewScene", function (de, day, scene) {
		var _day = $scope.currentWeek.days[day];
		if (_day && _day.scenes) {
			var m = 4095 ^ _day.scenes.reduce(function (m, scene) {
				return m | Math.pow(2, scene.end - scene.start + 1) - 1 << 12 - scene.end;
			}, 0);
			var data = Math.pow(2, scene.end - scene.start + 1) - 1 << 12 - scene.end;
			if ((m & data) === data) {
				scene.time = _day.start;
				scene.name = _scenes[scene.mode].name;
				_day.scenes.push(scene);
				$scope.$apply();
			}
		}
	});
	$scope.currentWeek = null;

	$scope.selectWeek = function (week) {
		$scope.currentWeek = week;
	};
	$scope.clearData = function () {
		scheduler.save({
			timezone_offset: new Date().getTimezoneOffset(),
			pool_id: $scope.class.id,
			data: []
		}, function (res) {
			$scope.disableEditMode();
		});
	};
	$scope.save = function () {
		//console.log($scope.dates);
		var data = [];
		$scope.weeks.forEach(function (week) {
			week.days.forEach(function (day, i) {
				var scenes = (week.checked ? $scope.currentWeek.days[i] : day).scenes;
				scenes && scenes.forEach(function (scene) {
					data.push({
						teaching_time: day.start,
						pool_id: $scope.class.id,
						mode_id: scene.mode,
						start_at: scene.start - 1,
						end_at: scene.end - 1
					});
				});
			});
		});
		scheduler.save({
			timezone_offset: new Date().getTimezoneOffset(),
			pool_id: $scope.class.id,
			data: data
		}, function (res) {
			fn_get_scheduler(_scope.class);
			$scope.disableEditMode();
		});
	};
	var _scope = $scope;
	$scope.clearAll = function () {
		var dialog = $modal.open({
			template: '<div class="padding-10">\
				<div class="modal-header">\
					<button type="button" class="close" data-ng-click="close()"><span aria-hidden="true">×</span></button>\
					<h4 class="modal-title" data-localize="清除课程表"></h4>\
				</div>\
				<form name="schedulerForm">\
					<div class="padding-10" data-localize="DELETE_SCHEDULE"></div>\
					<div style="text-align:right">\
						<button class="btn btn-primary" ng-click="ok()" data-localize="确定"></button>\
						<button class="btn btn-default" ng-click="close()" data-localize="取消"></button>\
					</div>\
				</form>\
			</div>',
			size: "sm",
			background: "static",
			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					scheduler.save({
						pool_id: _scope.class.id,
						data: []
					}, function (res) {
						$modalInstance.close();
						fn_get_scheduler(_scope.class);
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}
		});
	};

	$scope.setting = function () {
		var dialog = $modal.open({
			templateUrl: "views/vdi/dialog/scheduler/config.html",
			size: "md",
			backdrop: "static",
			controller: function controller($scope, $modalInstance) {
				console.log($scope, this);
				$scope.start_time = _scope.start_time || new Date();
				$scope.end_time = _scope.end_time || new Date();
				$scope.classHours = angular.copy(_scope.classHours);

				$scope.startDateOptions = {
					formatYear: 'yy',
					startingDay: 1
				};
				$scope.endDateOptions = {
					formatYear: 'yy',
					startingDay: 1
				};
				//$scope.startDateOpened = true;

				$scope.minEndTime = function () {
					if ($scope.start_time) {
						return $scope.start_time.getTime() + num_day * 60;
					}
				};

				$scope.maxEndTime = function () {
					if ($scope.start_time) return $scope.start_time.getTime() + num_day * 180;
				};

				$scope.openStartDate = function ($event) {
					$event.preventDefault();
					$event.stopPropagation();
					$scope.endDateOpened = false;
					$scope.startDateOpened = true;
					//this.$$childTail.$$prevSibling.isOpen = true;
				};
				$scope.openEndDate = function ($event) {
					$event.preventDefault();
					$event.stopPropagation();
					$scope.startDateOpened = false;
					$scope.endDateOpened = true;
					//this.$$childTail.isOpen = true;
				};
				$scope.startTimeChange = function () {
					if ($scope.start_time > $scope.end_time) {
						$scope.end_time = $scope.start_time;
					}
				};
				// $scope.changeStartHours = function(hour){
				// 	if(hour.start >= hour.end){
				// 		hour.start = new Date(hour.end.getTime());
				// 	}
				// };
				// $scope.changeEndHours = function(hour){
				// 	if(hour.end <= hour.start){
				// 		hour.end = new Date(hour.start.getTime());
				// 	}
				// };

				$scope.formValid = function () {
					var time_wrong = false;
					$scope.classHours.map(function (hour) {
						if (hour.start >= hour.end || hour.end <= hour.start) {
							time_wrong = true;
						}
					});
					return $scope.$$childTail.schedulerForm.$valid && !time_wrong;
				};
				$scope.$on('matchInput', function (e, v) {
					$scope.matchInput = v;
				});
				$scope.ok = function () {
					var data = {
						semester_start: $scope.start_time.getTime(),
						semester_end: $scope.end_time.getTime(),
						period: $scope.classHours.map(function (hour) {
							return hour.start.getHours() + ":" + hour.start.getMinutes() + "-" + hour.end.getHours() + ":" + hour.end.getMinutes();
						}).join(",")
					};
					scheduler.updateConfig(data, function (res) {
						fn_update_config(res.result);
						$modalInstance.close();
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			}
		});
	};
}]);

/***/ }),
/* 155 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.plan", [])

/* 计划任务 */
.factory("Plan", ["$resource", "$Domain", function (res, $Domain) {
    return res($Domain + "/thor/tasks", null, {
        query: { method: "GET", isArray: false, params: null },
        add: { method: "POST", isArray: false },
        update: { method: "PUT", url: $Domain + "/thor/tasks/:id", params: { id: "@id" } },
        delete: { method: "DELETE", url: $Domain + "/thor/tasks", isArray: false }

    });
}]).factory("HostPlan", ["$resource", "$Domain", function (res, $Domain) {
    return res($Domain + "/compute/v1/tasks/node", null, {
        query: { method: "GET", isArray: false, params: null },
        add: { method: "POST", url: $Domain + "/compute/v1/tasks", isArray: false },
        update: { method: "PUT", url: $Domain + "/compute/v1/tasks/:id", params: { id: "@id" } },
        active: { method: "PUT", url: $Domain + "/compute/v1/tasks/:id", params: { id: "@id" } },
        delete: { method: "DELETE", url: $Domain + "/compute/v1/tasks" },
        hostList: { method: "GET", url: $Domain + "/compute/v1/nodes" }

    });
}]).factory("weekdays", ["$$$I18N", function ($$$I18N) {
    return function () {
        return "周一 周二 周三 周四 周五 周六 周日".split(" ").map(function (s, i) {
            return { id: i + 1, name: $$$I18N.get(s) };
        });
    };
}]).directive('iptNumber', ['$rootScope', '$timeout', function ($rootScope, $timeout) {
    // Runs during compile
    return {
        require: 'ngModel', // Array = multiple requires, ? = optional, ^ = check parent elements
        restrict: 'AE', // E = Element, A = Attribute, C = Class, M = Comment
        link: function link(scope, $element, $attrs) {
            var minLen = Number($attrs.min);
            var maxLen = Number($attrs.max);
            $element.click(function (e) {
                var preVal = Number(e.target.value);
                if (this.value === '') {
                    this.value = '';
                } else {
                    if (preVal >= maxLen) {
                        this.value = minLen;
                    }
                    if (preVal <= minLen) {
                        this.value = maxLen;
                    }
                }
            });
        }
    };
}]).factory("initPlanScope", ["Plan", "$$$I18N", "weekdays", function (Plan, $$$I18N, weekdays) {
    return function (scope, $modalInstance, Scene, TeachDesktop, Plan) {
        // scope 变量
        scope.min_namelength = 2;
        scope.max_namelength = 20;
        scope.data = { open: false, off: false };
        scope.modes = [];
        scope.modes_loading = true;
        scope.weeks = weekdays();

        Plan.query(function (res) {
            scope.getPlanList = res.tasks;
        });
        // scope 方法
        scope.loadList = function (mode) {
            scope.modes.forEach(function (item) {
                if (item.id == mode.id) {
                    item.is_open = !item.is_open;
                    if (!item.desktops) {
                        item.desktop_loading = true;
                        TeachDesktop.query({ id: mode.id }, function (res) {
                            item.desktop_loading = false;
                            item.desktops = res.result;
                            // item._selected = item.desktops.filter(function(d){ return d.in_task }).length == item.desktops.length ? true:false;
                            // item.desktops.forEach(function(d){
                            // if(d.in_task){
                            // d._selected = true;
                            // item.has_inTask = true;
                            // }
                            // });
                        });
                    }
                }
            });
        };
        scope.checksublist = function (item) {
            if (!item._selected) {
                item.desktops.forEach(function (data) {
                    data._selected = true;
                });
            } else {
                item.desktops.forEach(function (data) {
                    data._selected = false;
                });
            }
        };
        scope.setparent = function (item) {
            var select_len = item.desktops.filter(function (data) {
                return data._selected == true;
            }).length;
            if (select_len == item.desktops.length) {
                item._selected = true;
            } else item._selected = false;
        };
        scope.$watch('data.open', function (newData, oldData, scope) {
            if (!newData) {
                scope.data.openHouer = undefined;
                scope.data.openMinute = undefined;
            }
        });
        scope.$watch('data.off', function (newData, oldData, scope) {
            if (!newData) {
                scope.data.offHouer = undefined;
                scope.data.offMinute = undefined;
            }
        });
        scope.check = function () {
            // let select_len = scope.modes.filter(function(item){ return item.desktops && item.desktops.filter(function(desktop){ return !desktop.in_task && desktop._selected }).length }).length;
            var select_len = scope.modes.filter(function (item) {
                return item.desktops && item.desktops.filter(function (desktop) {
                    return desktop._selected;
                }).length;
            }).length;
            if (scope.data.open && scope.data.off) return select_len && scope.data.openHouer != undefined && scope.data.openMinute != undefined && scope.data.offHouer != undefined && scope.data.offMinute != undefined;else return select_len && (scope.data.open && scope.data.openHouer != undefined && scope.data.openMinute != undefined || scope.data.off && scope.data.offHouer != undefined && scope.data.offMinute != undefined);
        };
        scope.checkWeek = function () {
            return scope.weeks.filter(function (item) {
                return item._selected;
            }).length;
        };
        scope.selectAllWeek = function (selectAll) {
            scope.weeks.forEach(function (item) {
                item._selected = selectAll;
            });
        };
        scope.selectOne = function () {
            var selectNum = scope.weeks.filter(function (item) {
                return item._selected;
            }).length;
            if (selectNum === scope.weeks.length) {
                scope.selectAll = true;
            } else {
                scope.selectAll = false;
            }
        };
        scope.ok = function () {
            var data = scope.getValues();
            var flag = false;
            if (data.task_type === 'bootup,shutdown' && scope.data.openHouer == scope.data.offHouer && scope.data.openMinute == scope.data.offMinute) {
                $.bigBox({
                    title: $$$I18N.get("INFOR_TIP"),
                    content: $$$I18N.get("SCHEDUL_TIP"),
                    timeout: 6000
                });
            } else {
                scope.getPlanList.map(function (it) {
                    if (it.name === data.name) {
                        flag = true;
                    }
                });
                if (flag) {
                    $.bigBox({
                        title: $$$I18N.get("INFOR_TIP"),
                        content: $$$I18N.get("SCHEDUL_SAME_NAME_TIPS"),
                        timeout: 6000
                    });
                    return false;
                }
                Plan.add({ 'task': data }, function (res) {
                    Plan.query(function (res) {
                        scope.rows.splice(0, scope.rows.length);
                        Array.prototype.push.apply(scope.rows, res.tasks);
                    });
                    $modalInstance.close();
                });
            }
        };
        scope.close = function () {
            $modalInstance.close();
        };
        // 对于增改来说，获取、设置当前 scope 值是必须的，这样保证提交数据的接口代码足够简单
        scope.getValues = function () {
            // 这个值是要返回的，放在函数的第一行，更醒目
            var data = {
                'name': scope.data.name,
                'desc': scope.data.desc,
                'is_active': true,
                'trigger_type': "cron",
                'task_type': '',
                'trigger_kwargs': {},
                'instance': []
            };
            // 这个值很常用，建议封装为独立的方法
            var week_days = scope.weeks.filter(function (item) {
                return item._selected;
            }).map(function (item) {
                return item.id;
            });
            if (scope.data.off && scope.data.open) {
                data.task_type = 'bootup,shutdown';
                data.trigger_kwargs.bootup = {
                    "week_days": week_days,
                    "hour": scope.data.openHouer,
                    "minute": scope.data.openMinute,
                    "second": 0
                };
                data.trigger_kwargs.shutdown = {
                    "week_days": week_days,
                    "hour": scope.data.offHouer,
                    "minute": scope.data.offMinute,
                    "second": 0
                };
            } else if (!scope.data.off && scope.data.open) {
                data.task_type = 'bootup';
                data.trigger_kwargs.bootup = {
                    "week_days": week_days,
                    "hour": scope.data.openHouer,
                    "minute": scope.data.openMinute,
                    "second": 0
                };
            } else {
                data.task_type = 'shutdown';
                data.trigger_kwargs.shutdown = {
                    "week_days": week_days,
                    "hour": scope.data.offHouer,
                    "minute": scope.data.offMinute,
                    "second": 0
                };
            }
            scope.modes.forEach(function (mode) {
                mode.desktops && mode.desktops.forEach(function (desktop) {
                    if (desktop._selected) {
                        data.instance.push(desktop.instance_extra_id);
                    }
                });
            });
            return data;
        };
        scope.setValues = function (planItem) {
            scope.data.name = planItem.name;
            scope.data.desc = planItem.desc;
            var bootupArgs = planItem.trigger_kwargs.bootup;
            var shutdownArgs = planItem.trigger_kwargs.shutdown;
            if (bootupArgs) {
                scope.data.open = true;
                scope.data.openHouer = bootupArgs.hour;
                scope.data.openMinute = bootupArgs.minute;
                scope.weeks.forEach(function (item) {
                    item._selected = bootupArgs.week_days.indexOf(item.id) > -1;
                });
            }
            if (shutdownArgs) {
                scope.data.off = true;
                scope.data.offHouer = shutdownArgs.hour;
                scope.data.offMinute = shutdownArgs.minute;
                scope.weeks.forEach(function (item) {
                    item._selected = shutdownArgs.week_days.indexOf(item.id) > -1;
                });
            }
        };
        // scope 状态初始化，如加载数据
    };
}]).controller("vdiPlanSwitchController", ["$scope", "$modal", "Plan", "$$$I18N", function ($scope, $modal, Plan, $$$I18N) {
    $scope.currentPage = 1;
    $scope.pagesize = Number($$$storage.getSessionStorage('plan_pagesize')) || 30;
    $scope.$watch("pagesize", function (newvalue) {
        $scope.pagesize = newvalue || 0;
        $$$storage.setSessionStorage('plan_pagesize', newvalue ? newvalue : 0);
    });
    $scope.loading = true;

    Plan.query(function (res) {
        $scope.loading = false;
        $scope.rows = res.tasks;
    }, function (err) {
        $scope.loading = false;
    });

    $scope.active = function (plan) {
        $scope.rows.forEach(function (item) {
            if (item.id == plan.id) {
                item.active_loadding = true;
            }
        });
        Plan.update({ id: plan.id, is_active: !plan.is_active }, function (res) {
            $scope.rows.forEach(function (item) {
                if (item.id == plan.id) {
                    item.active_loadding = false;
                    item.is_active = !plan.is_active;
                }
            });
        }, function (err) {
            $scope.rows.forEach(function (item) {
                if (item.id == plan.id) {
                    item.active_loadding = false;
                }
            });
        });
    };
    var _controllerScope = $scope;
    $scope.delete = function (item) {
        var rows = item ? [item] : $scope.rows.filter(function (row) {
            return row._selected;
        });
        var onrows = rows.filter(function (row) {
            return row.is_active;
        });
        var offrows = rows.filter(function (row) {
            return !row.is_active;
        });
        if (rows.length == onrows.length) {
            $.bigBox({
                title: $$$I18N.get("INFOR_TIP"),
                content: $$$I18N.get("DELE_PLAN_TIP"),
                timeout: 6000
            });
        } else {
            $modal.open({
                template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_PLAN_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
                controller: function controller($scope, $modalInstance, $q) {
                    $scope.name = offrows.map(function (row) {
                        return row.name;
                    }).join(', ');
                    $scope.ok = function () {
                        Plan.delete({ id: offrows.map(function (item) {
                                return item.id;
                            }) }, function (res) {
                            Plan.query(function (res) {
                                _controllerScope.rows.splice(0, _controllerScope.rows.length);
                                Array.prototype.push.apply(_controllerScope.rows, res.tasks);
                            });
                        }, function (error) {});
                        $modalInstance.close();
                    };
                    $scope.close = function () {
                        $modalInstance.close();
                    };
                },
                size: "sm"
            });
        }
    };
}]).controller("addSwitchDialog", ["$scope", "$modalInstance", "Scene", "TeachDesktop", "Plan", "initPlanScope", function ($scope, $modalInstance, Scene, TeachDesktop, Plan, initPlanScope) {
    initPlanScope($scope, $modalInstance, Scene, TeachDesktop, Plan);

    Scene.query(function (res) {
        $scope.modes = res.modes;
        $scope.modes.forEach(function (item) {
            item.is_open = false;
        });
        $scope.modes_loading = false;
    }, function (err) {
        $scope.modes_loading = false;
    });
}]).controller("editSwitchDialog", ["$scope", "$modalInstance", "Scene", "TeachDesktop", "Plan", "initPlanScope", "$$$I18N", function ($scope, $modalInstance, Scene, TeachDesktop, Plan, initPlanScope, $$$I18N) {
    var planItem = $scope.item || $scope.currentItem;
    initPlanScope($scope, $modalInstance, Scene, TeachDesktop, Plan);
    var filterPlanList = $scope.rows.filter(function (it) {
        return it.name != planItem.name;
    });
    $scope.setValues(planItem);
    // 重写 $scope.ok
    $scope.ok = function () {
        var data = $scope.getValues();
        var flag = false;
        data.id = planItem.id;
        data.is_active = planItem.is_active;
        if (data.task_type === 'bootup,shutdown' && $scope.data.openHouer == $scope.data.offHouer && $scope.data.openMinute == $scope.data.offMinute) {
            $.bigBox({
                title: $$$I18N.get("INFOR_TIP"),
                content: $$$I18N.get("SCHEDUL_TIP"),
                timeout: 6000
            });
        } else {
            filterPlanList.map(function (it) {
                if (it.name === data.name) {
                    flag = true;
                }
            });
            if (flag) {
                $.bigBox({
                    title: $$$I18N.get("INFOR_TIP"),
                    content: $$$I18N.get("SCHEDUL_SAME_NAME_TIPS"),
                    timeout: 6000
                });
                return false;
            }
            Plan.update(data, function (res) {
                Plan.query(function (res) {
                    $scope.rows.splice(0, $scope.rows.length);
                    Array.prototype.push.apply($scope.rows, res.tasks);
                });
                $modalInstance.close();
            });
        }
    };
    $scope.selectOne();

    Scene.query(function (res) {
        $scope.modes = res.modes;
        $scope.modes.forEach(function (item) {
            item.is_open = false;
            planItem.instance.forEach(function (ins) {
                if (item.id == ins.mode_id) {
                    item.is_open = true;
                    item.desktop_loading = true;
                    TeachDesktop.query({ id: ins.mode_id }, function (res) {
                        item.desktop_loading = false;
                        item.desktops = res.result;
                        item.desktops.forEach(function (d) {
                            var has_selected = ins.desktop.filter(function (instance) {
                                return instance == d.instance_extra_id;
                            }).length;
                            if (has_selected) {
                                d._selected = true;
                                // d._own = true;
                                // item.has_inTask = true;
                                // item._own = true;
                            } else {}
                        });
                        item._selected = item.desktops.filter(function (d) {
                            return d._selected;
                        }).length == item.desktops.length;
                    });
                }
            });
        });
        $scope.modes_loading = false;
    }, function (err) {
        $scope.modes_loading = false;
    });
}]).controller("vdiHostPlanSwitchController", ["$scope", "$modal", "HostPlan", "$$$I18N", function ($scope, $modal, HostPlan, $$$I18N) {
    $scope.pagesizes = [10, 20, 30];
    $scope.pagesize = $scope.pagesizes[0];
    $scope.currentPage = 1;

    $scope.rows = [];
    $scope.loading = true;

    function getList() {
        HostPlan.query(function (res) {
            $scope.loading = false;
            $scope.rows = res.tasks;
        }, function (err) {
            $scope.loading = false;
        });
    }
    getList();

    $scope.add = function () {
        var dialog = $modal.open({
            templateUrl: "views/vdi/dialog/plan/host_switch.html",
            controller: "addEditHostSwitchDialog",
            size: "md",
            resolve: {
                params: function params() {
                    return {};
                }
            }
        });
        dialog.result.then(function (res) {
            if (res) {
                getList();
            }
        });
    };

    $scope.edit = function () {
        var hostPlan = this.item || this.currentItem;
        var dialog = $modal.open({
            templateUrl: "views/vdi/dialog/plan/host_switch.html",
            controller: "addEditHostSwitchDialog",
            scope: $scope,
            size: "md",
            resolve: {
                params: function params() {
                    return { hostPlan: angular.copy(hostPlan) };
                }
            }
        });
        dialog.result.then(function (data) {
            if (data) {
                getList();
            }
        });
    };

    $scope.active = function (plan) {
        $scope.rows.forEach(function (item) {
            if (item.id == plan.id) {
                item.active_loadding = true;
            }
        });
        HostPlan.active({ id: plan.id, action: !plan.enable ? 'enable' : 'disable' }, function (res) {
            $scope.rows.forEach(function (item) {
                if (item.id == plan.id) {
                    item.active_loadding = false;
                    item.enable = !plan.enable;
                }
            });
        }, function (err) {
            $scope.rows.forEach(function (item) {
                if (item.id == plan.id) {
                    item.active_loadding = false;
                }
            });
        });
    };

    $scope.delete = function (item) {
        var rows = item ? [item] : $scope.rows.filter(function (row) {
            return row._selected;
        });
        var onrows = rows.filter(function (row) {
            return row.enable;
        });
        var offrows = rows.filter(function (row) {
            return !row.enable;
        });
        if (rows.length == onrows.length) {
            $.bigBox({
                title: $$$I18N.get("INFOR_TIP"),
                content: $$$I18N.get("DELE_PLAN_TIP"),
                timeout: 6000
            });
        } else {
            $modal.open({
                template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' data-localize='删除确认'>" + "</h4></div><div class='modal-body'><form class='form-horizontal'><p style='margin-bottom:20px;' data-localize='DELETE_PLAN_T' param1='{{name}}'></p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' data-localize='确定'></button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' data-localize='取消'></button></footer></form></div></div></section>",
                controller: function controller($scope, $modalInstance, $q) {
                    $scope.name = offrows.map(function (row) {
                        return row.name;
                    }).join(', ');
                    $scope.ok = function () {
                        HostPlan.delete({ id: offrows.map(function (item) {
                                return item.id;
                            }) }, function (res) {
                            getList();
                        }, function (error) {});
                        $modalInstance.close();
                    };
                    $scope.close = function () {
                        $modalInstance.close();
                    };
                },
                size: "sm"
            });
        }
    };
}]).controller("addEditHostSwitchDialog", ["$scope", "$modalInstance", "Plan", "weekdays", "AlarmPlicy", "HostPlan", "$$$I18N", "params", function ($scope, $modalInstance, Plan, weekdays, AlarmPlicy, HostPlan, $$$I18N, params) {
    $scope.min_namelength = 2;
    $scope.max_namelength = 20;
    $scope.weeks = weekdays();
    $scope.data = {};
    $scope.pools = [];
    $scope.loading = true;
    $scope.isEdit = params.hostPlan ? true : false;

    if (params.hostPlan) {
        setValues(params.hostPlan);
        var hostID = params.hostPlan.targets.map(function (item) {
            return item.id;
        });
        AlarmPlicy.get_hosts(function (res) {
            $scope.loading = false;
            $scope.pools = res.result.map(function (p) {
                p.hosts.forEach(function (h) {
                    if (hostID.indexOf(h.host_uuid) > -1) {
                        h._selected = true;
                    }
                    if (h.host_uuid == '-1' && params.hostPlan.trigger_kwargs.with_controller) {
                        h._selected = true;
                    }
                });
                p._selected = p.hosts.length ? p.hosts.every(function (h) {
                    return hostID.indexOf(h.host_uuid) > -1 || h.host_uuid == '-1' && params.hostPlan.trigger_kwargs.with_controller;
                }) : false;
                return p;
            }).filter(function (p) {
                return p.hosts.length;
            });
            get_host_ids();
        });
    } else {
        $scope.data = { open: false, off: false };
        AlarmPlicy.get_hosts(function (res) {
            $scope.loading = false;
            $scope.pools = res.result.filter(function (r) {
                return r.hosts.length;
            });
        });
    }

    function setValues(planItem) {
        $scope.data.name = planItem.name;
        $scope.data.description = planItem.description;
        var bootupArgs = planItem.trigger_kwargs.bootup;
        var shutdownArgs = planItem.trigger_kwargs.shutdown;
        if (bootupArgs) {
            $scope.data.open = true;
            $scope.data.openHouer = bootupArgs.hour;
            $scope.data.openMinute = bootupArgs.minute;
            $scope.weeks.forEach(function (item) {
                item._selected = bootupArgs.week_days.indexOf(item.id) > -1;
            });
        }
        if (shutdownArgs) {
            $scope.data.off = true;
            $scope.data.offHouer = shutdownArgs.hour;
            $scope.data.offMinute = shutdownArgs.minute;
            $scope.weeks.forEach(function (item) {
                item._selected = shutdownArgs.week_days.indexOf(item.id) > -1;
            });
        }
    };
    function get_host_ids() {
        $scope.data.host_ids = $scope.pools.reduce(function (host_ids, pool) {
            pool.hosts.forEach(function (host) {
                if (host._selected) {
                    host_ids.push(host.host_uuid);
                }
            });
            return host_ids;
        }, []);
    }
    $scope.checkOne = function (pool) {
        pool._selected = pool.hosts.every(function (h) {
            return h._selected;
        });
        get_host_ids();
    };
    $scope.checkAll = function (pool) {
        pool.hosts.forEach(function (h) {
            h._selected = pool._selected;
        });
        get_host_ids();
    };
    $scope.selectAllWeek = function (selectAll) {
        $scope.weeks.forEach(function (item) {
            item._selected = selectAll;
        });
    };
    $scope.selectOneWeek = function () {
        var selectNum = $scope.weeks.filter(function (item) {
            return item._selected;
        }).length;
        if (selectNum === $scope.weeks.length) {
            $scope.selectAll = true;
        } else {
            $scope.selectAll = false;
        }
    };
    $scope.checkWeek = function () {
        return $scope.weeks.filter(function (item) {
            return item._selected;
        }).length;
    };
    $scope.$watch('data.open', function (newData, oldData, scope) {
        if (!newData) {
            scope.data.openHouer = undefined;
            scope.data.openMinute = undefined;
        }
    });
    $scope.$watch('data.off', function (newData, oldData, scope) {
        if (!newData) {
            scope.data.offHouer = undefined;
            scope.data.offMinute = undefined;
        }
    });
    function getValues() {
        // 这个值是要返回的，放在函数的第一行，更醒目
        var data = {
            'name': $scope.data.name,
            'description': $scope.data.description,
            'enable': true,
            'trigger_type': "cron",
            'action': '',
            'type': 'node',
            'trigger_kwargs': {},
            'targets': $scope.data.host_ids
        };
        var hasConsole = $scope.data.host_ids.filter(function (item) {
            return item == '-1';
        }).length;
        if (hasConsole) {
            data.trigger_kwargs.with_controller = true;
        } else {
            data.trigger_kwargs.with_controller = false;
        }
        // 这个值很常用，建议封装为独立的方法
        var week_days = $scope.weeks.filter(function (item) {
            return item._selected;
        }).map(function (item) {
            return item.id;
        });
        if ($scope.data.off && $scope.data.open) {
            data.action = 'bootup,shutdown';
            data.trigger_kwargs.bootup = {
                "week_days": week_days,
                "hour": $scope.data.openHouer,
                "minute": $scope.data.openMinute,
                "second": 0
            };
            data.trigger_kwargs.shutdown = {
                "week_days": week_days,
                "hour": $scope.data.offHouer,
                "minute": $scope.data.offMinute,
                "second": 0
            };
        } else if (!$scope.data.off && $scope.data.open) {
            data.action = 'bootup';
            data.trigger_kwargs.bootup = {
                "week_days": week_days,
                "hour": $scope.data.openHouer,
                "minute": $scope.data.openMinute,
                "second": 0
            };
        } else {
            data.action = 'shutdown';
            data.trigger_kwargs.shutdown = {
                "week_days": week_days,
                "hour": $scope.data.offHouer,
                "minute": $scope.data.offMinute,
                "second": 0
            };
        }
        return data;
    };
    $scope.ok = function () {
        var data = getValues();
        var flag = false;
        if (data.action === 'bootup,shutdown' && $scope.data.openHouer == $scope.data.offHouer && $scope.data.openMinute == $scope.data.offMinute) {
            $.bigBox({
                title: $$$I18N.get("INFOR_TIP"),
                content: $$$I18N.get("SCHEDUL_TIP"),
                timeout: 6000
            });
        } else {
            // $scope.getPlanList.map(function(it){
            //     if(it.name===data.name){
            //         flag = true;
            //     }
            // })
            if (flag) {
                $.bigBox({
                    title: $$$I18N.get("INFOR_TIP"),
                    content: $$$I18N.get("SCHEDUL_SAME_NAME_TIPS"),
                    timeout: 6000
                });
                return false;
            }
            if (!params.hostPlan) {
                HostPlan.add({ 'data': data }, function (res) {
                    $modalInstance.close(res);
                });
            } else {
                HostPlan.update({ 'id': params.hostPlan.id, 'data': data }, function (res) {
                    $modalInstance.close(res);
                });
            }
        }
    };
    $scope.close = function () {
        $modalInstance.close();
    };
}]);

/***/ }),
/* 156 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
*  Module
*
* Description
*/
angular.module('vdi.HA', []).factory('HA', ['$resource', '$Domain', function ($resource, $Domain) {
	return $resource($Domain + "/thor/controller/ha", null, {
		get_console_ha: { method: "GET", url: $Domain + "/thor/controller/ha" },
		set_console_ha: { method: "PUT", url: $Domain + "/thor/controller/ha" },
		query: { method: "GET", url: $Domain + "/thor/ha/instances" },
		delete: { method: "DELETE", url: $Domain + "/thor/ha/instances", params: { id: "@id" } },
		add: { method: "POST", url: $Domain + "/thor/ha/instances" },
		get: { method: "GET", url: $Domain + "/thor/ha/instance/:id", params: { id: "@id" } },
		edit: { method: "PUT", url: $Domain + "/thor/ha/instance/:id", params: { id: "@id" } },
		console_ha_ping: { method: "GET", url: $Domain + "/ping" },
		get_hosts: { method: "GET", url: $Domain + "/thor/ha/instance/get_vm_hosts" }
	});
}]).filter('filterChecked', function () {
	return function (rows) {
		return rows.filter(function (item) {
			return item._checked;
		});
	};
}).controller('vdiDesktopHAViewController', ['$scope', '$modal', 'HA', function ($scope, $modal, HA) {
	var haScope = $scope;
	$scope.currentPage = 1;
	$scope.pagesize = 30;

	$scope.get_list = function () {
		HA.query(function (res) {
			$scope.rows = res.result;
		});
	};
	$scope.get_list();
	$scope.add = function () {
		var dialog = $modal.open({
			templateUrl: 'views/vdi/dialog/HA/new_ha.html',
			controller: 'newDesktopHADialog',
			resolve: {
				param: function param() {
					return haScope.rows;
				}
			}
		});
		dialog.result.then(function () {
			HA.query(function (res) {
				$scope.rows = res.result;
			});
		});
	};
	$scope.edit = function (item) {
		var modal = $modal.open({
			templateUrl: 'views/vdi/dialog/HA/new_ha.html',
			controller: 'editDesktopHADialog',
			resolve: { param: function param() {
					return { item: item, HaList: haScope.rows };
				} }
		});
		modal.result.then(function (res) {
			if (res) {
				HA.query(function (res) {
					$scope.rows = res.result;
				});
			}
		});
	};
	$scope.view = function (item) {
		$modal.open({
			templateUrl: 'views/vdi/dialog/HA/view_ha.html',
			controller: "viewDesktopHADialog",
			resolve: {
				param: function param() {
					return item;
				}
			}
		});
	};
	$scope.active = function (item) {
		item.active_loadding = true;
		HA.edit({
			"id": item.id,
			"enable_ha": !item.enable_ha,
			"action": "simple_update"
		}, function (res) {
			item.enable_ha = !item.enable_ha;
		}).$promise.finally(function () {
			item.active_loadding = false;
		});
	};
	var parentScope = $scope;
	$scope.delete = function (item) {
		var rows = item ? [item] : $scope.rows.filter(function (row) {
			return row._selected;
		});
		$modal.open({
			template: "<section id='widget-grid'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-ng-click='close()'><span aria-hidden='true'>×</span><span class='sr-only'>Close</span></button><h4 class='modal-title' id='mySmallModalLabel' localize='删除HA策略'>" + "删除HA策略</h4></div><div class='modal-body'><form class='form-horizontal'><p  style='margin-bottom:20px;' localize='确定删除HA策略吗'>确定删除HA策略吗?</p><footer class='text-right'><button class='btn btn-primary' data-ng-click='ok()' localize='确定'>确定</button><button class='btn btn-default' data-ng-click='close()' style='margin-left:5px;' localize='取消'>取消</button></footer></form></div></div></section>",

			controller: function controller($scope, $modalInstance) {
				$scope.ok = function () {
					$modalInstance.close();
					HA.delete({
						ids: rows.map(function (item) {
							return item.id;
						})
					}, function (res) {
						parentScope.get_list();
					});
				};
				$scope.close = function () {
					$modalInstance.close();
				};
			},
			size: "sm"
		});
	};
}]).controller('newDesktopHADialog', ['$scope', '$modalInstance', 'HA', 'ResourcePool', 'UserRole', 'Scene', 'PersonDesktop', "param", "$$$I18N", function ($scope, $modalInstance, HA, ResourcePool, UserRole, Scene, PersonDesktop, param, $$$I18N) {
	$scope.min_namelength = 2;
	$scope.max_namelength = 20;
	var HaList = param;
	$scope.data = {
		type_code: 1,
		priority: 2,
		ha_response_time: 60
	};
	var _scope = $scope;
	var allScenes = [];
	var allInstances = [];
	ResourcePool.query(function (res) {
		$scope.resources = res.result.filter(function (r) {
			return r.type === 'kvm';
		});
		$scope.data.resource_pool_id = $scope.resources[0] ? $scope.resources[0].id : undefined;
		HA.get({ id: -1 }, function (res) {
			$scope.ready = true;
			allScenes = res.unused_modes;
			allInstances = res.unused_vms;
			$scope.scenes = allScenes.filter(function (mode) {
				return mode.mode_resource_pool_id === $scope.data.resource_pool_id;
			});
			$scope.instances = allInstances.filter(function (ins) {
				return ins.vm_resource_pool_id === $scope.data.resource_pool_id;
			});
			$scope.data.scene = $scope.scenes[0];
		});
	});

	$scope.updateHaList = function () {
		$scope.scenes = allScenes.filter(function (mode) {
			return mode.mode_resource_pool_id === $scope.data.resource_pool_id;
		});
		$scope.instances = allInstances.filter(function (ins) {
			return ins.vm_resource_pool_id === $scope.data.resource_pool_id;
		});
		$scope.data.scene = $scope.scenes[0];
	};

	var get_ins_ids = function get_ins_ids() {
		return $scope.instances.filter(function (ins) {
			return ins._used;
		}).map(function (ins) {
			return ins.vm_id;
		});
	};
	// var get_mode_ids = function(){
	// 	return $scope.scenes.filter(function(scene){ return scene._used }).map(function(scene){ return scene.mode_id});
	// };
	var get_host_names = function get_host_names() {
		return $scope.ha_hosts.filter(function (host) {
			return host._used;
		}).map(function (host) {
			return host.name;
		});
	};

	$scope.checked = function (key, alls) {
		$scope.data[key] = alls.every(function (ins) {
			return Boolean(ins._used);
		});
	};
	$scope.checkedAll = function (key, alls) {
		if (alls) {
			alls.forEach(function (item) {
				item._used = Boolean($scope.data[key]);
			});
		}
	};
	$scope.next = function () {
		//新增时点击下一步再返回上一步，重置上次的操作
		$scope.data.selectAllHost = false;
		var flag = false;
		HaList.forEach(function (it) {
			if (it.name === _scope.data.name) {
				flag = true;
				return;
			}
		});
		if (flag) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("HA_SAME_NAME_TIP"),
				timeout: 6000
			});
			return;
		}
		$scope.data.step = 2;
		var d = $scope.data;
		var postData = {
			resource_pool_id: d.resource_pool_id,
			type_code: d.type_code,
			instance_ids: d.type_code == 2 ? get_ins_ids() : undefined,
			mode_ids: d.type_code == 1 ? [d.scene.mode_id] : undefined
		};
		$scope.host_ready = false;
		$scope.hosts = [];
		$scope.ha_hosts = [];
		HA.get_hosts(postData, function (res) {
			$scope.host_ready = true;
			$scope.hosts = res.use_host_result;
			$scope.ha_hosts = Object.keys(res.host_result).map(function (key) {
				return {
					name: key,
					num: res.host_result[key]
				};
			});
		});
	};

	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.ok = function () {
		var _this = this;
		var _ins_ids = get_ins_ids();
		// var _mode_ids = get_mode_ids();
		var _host_names = get_host_names();

		var d = $scope.data;
		var postData = {
			name: d.name,
			desc: d.desc,
			resource_pool_id: d.resource_pool_id,
			type_code: d.type_code,
			instance_ids: d.type_code == 2 ? _ins_ids : undefined,
			mode_ids: d.type_code == 1 ? [d.scene.mode_id] : undefined,
			priority: d.priority,
			ha_response_time: Number(d.ha_response_time),
			host_scope: _host_names,
			enable_ha: true
		};
		$scope.submiting = true;
		HA.add(postData, function (res) {
			$modalInstance.close(res);
		}, function () {
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.submiting = false;
			$scope.get_list();
		});
	};
}]).controller('editDesktopHADialog', ['$scope', 'HA', '$modalInstance', 'param', 'ResourcePool', '$$$I18N', function ($scope, HA, $modalInstance, param, ResourcePool, $$$I18N) {
	$scope.min_namelength = 2;$scope.max_namelength = 20;
	$scope.data = angular.copy(param.item);
	var _scope = $scope;
	var filterHaList = param.HaList.filter(function (it) {
		return it.name != param.item.name;
	});
	var get_ins_ids = function get_ins_ids() {
		return $scope.instances.filter(function (ins) {
			return ins._used;
		}).map(function (ins) {
			return ins.vm_id;
		});
	};
	// var get_mode_ids = function(){
	// 	return $scope.scenes.filter(function(scene){ return scene._used }).map(function(scene){ return scene.mode_id});
	// };
	var get_host_names = function get_host_names() {
		return $scope.ha_hosts.filter(function (host) {
			return host._used;
		}).map(function (host) {
			return host.name;
		});
	};
	var allScenes = [];
	var allInstances = [];
	ResourcePool.query(function (res) {
		$scope.resources = res.result.filter(function (r) {
			return r.type === 'kvm';
		});
		HA.get({ id: param.item.id }, function (res) {
			$scope.ready = true;
			allScenes = res.used_modes.map(function (item) {
				item._used = true;return item;
			}).concat(res.unused_modes);
			allInstances = res.used_vms.map(function (item) {
				item._used = true;return item;
			}).concat(res.unused_vms);
			$scope.scenes = allScenes.filter(function (mode) {
				return mode.mode_resource_pool_id === $scope.data.resource_pool_id;
			});
			$scope.instances = allInstances.filter(function (ins) {
				return ins.vm_resource_pool_id === $scope.data.resource_pool_id;
			});
			$scope.data.scene = $scope.scenes[0];
		});
	});
	$scope.updateHaList = function () {
		$scope.scenes = allScenes.filter(function (mode) {
			return mode.mode_resource_pool_id === $scope.data.resource_pool_id;
		});
		$scope.instances = allInstances.filter(function (ins) {
			return ins.vm_resource_pool_id === $scope.data.resource_pool_id;
		});
		$scope.data.scene = $scope.scenes[0];
	};

	$scope.checked = function (key, alls) {
		$scope.data[key] = alls.every(function (ins) {
			return Boolean(ins._used);
		});
	};
	$scope.checkedAll = function (key, alls) {
		if (alls) {
			alls.forEach(function (item) {
				item._used = Boolean($scope.data[key]);
			});
		}
	};

	//编辑的时候是否为全选
	$scope.isSelectedAll = function (hosts) {
		var isAllchecked = false;
		isAllchecked = hosts.every(function (it) {
			return it._used;
		});
		return isAllchecked;
	};

	$scope.next = function () {
		var flag = false,
		    isAllchecked = false;
		filterHaList.forEach(function (it) {
			if (it.name === _scope.data.name) {
				flag = true;
				return;
			}
		});
		if (flag) {
			$.bigBox({
				title: $$$I18N.get("INFOR_TIP"),
				content: $$$I18N.get("HA_SAME_NAME_TIP"),
				timeout: 6000
			});
			return;
		}
		$scope.data.step = 2;
		var d = $scope.data;
		var postData = {
			resource_pool_id: d.resource_pool_id,
			type_code: d.type_code,
			instance_ids: d.type_code == 2 ? get_ins_ids() : undefined,
			mode_ids: d.type_code == 1 ? [d.scene.mode_id] : undefined
		};
		$scope.host_ready = false;
		$scope.hosts = [];
		$scope.ha_hosts = [];
		HA.get_hosts(postData, function (res) {
			$scope.host_ready = true;
			$scope.hosts = res.use_host_result;
			$scope.ha_hosts = Object.keys(res.host_result).map(function (key) {
				return {
					name: key,
					num: res.host_result[key],
					_used: d.load_host_scope[key] ? true : false
				};
			});
			isAllchecked = $scope.isSelectedAll($scope.ha_hosts);
			$scope.data.selectAllHost = isAllchecked;
		});
	};

	$scope.close = function () {
		$modalInstance.close();
	};
	$scope.ok = function () {
		var _this = this;
		var _ins_ids = get_ins_ids();
		// var _mode_ids = get_mode_ids();
		var _host_names = get_host_names();

		var d = $scope.data;
		var postData = {
			id: d.id,
			name: d.name,
			desc: d.desc,
			resource_pool_id: d.resource_pool_id,
			type_code: d.type_code,
			instance_ids: d.type_code == 2 ? _ins_ids : undefined,
			mode_ids: d.type_code == 1 ? [d.scene.mode_id] : undefined,
			priority: d.priority,
			ha_response_time: Number(d.ha_response_time),
			host_scope: _host_names,
			action: "update",
			enable_ha: d.enable_ha
		};
		$scope.submiting = true;
		HA.edit(postData, function (res) {
			$modalInstance.close(res);
		}, function () {
			$modalInstance.close();
		}).$promise.finally(function () {
			$scope.submiting = false;
			$scope.get_list();
		});
	};
}]).controller('viewDesktopHADialog', ['$scope', 'HA', '$modalInstance', 'param', function ($scope, HA, $modalInstance, param) {
	HA.get({ id: param.id }, function (res) {
		$scope.ready = true;
		$scope.data = res;
	});
	$scope.close = function () {
		$modalInstance.close();
	};
}]);

/***/ }),
/* 157 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


angular.module("vdi.about", []).factory("permissionList", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/permission", null, {
        query: { method: "GET", isArray: false }
    });
}]).factory("pushlicenseFile", ["$resource", "$Domain", function ($resource, $Domain) {
    return $resource($Domain + "/thor/license/show", null, {
        update: { method: "GET", isArray: false }
    });
}]).service("desktopHelpBox", ["$$$I18N", function ($$$I18N) {
    var _this = this;
    this.open = function (content, id, callback) {
        if (!$("#desktopHelpBox").length) {
            $("body").append("<div id='desktopHelpBox'></div>");
            $("body #desktopHelpBox").append('<div class="modal-header">' + '<button type="button" class="close"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>' + '<h4 class="modal-title">' + $$$I18N.get("桌面部署帮助") + '</h4>' + '</div>' + '<div class="modal-body">' + '<form class="form-horizontal" novalidate>' + '<div class="form-group">' + '<div class="col-xs-4">' + '<select class="form-control type">' + '<option value="1">' + $$$I18N.get("教学桌面部署流程") + '</option>' + '<option value="2">' + $$$I18N.get("个人桌面部署流程") + '</option>' + '</select>' + '</div>' + '</div>' + '<div class="form-group teach">' + '<div class="col-xs-12">' + '<div class="map">' + '<div>' + '<div class="first">' + '<div style="margin-bottom: 40px;">' + '<div class="icon"><i class="fa-fw fa icon-028"></i><br/><span title="' + $$$I18N.get("新增资源池") + '">' + $$$I18N.get("新增资源池") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-029"></i><br/><span title="' + $$$I18N.get("添加计算节点") + '">' + $$$I18N.get("添加计算节点") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-030"></i><br/><span title="' + $$$I18N.get("新增分布式虚拟交换机") + '">' + $$$I18N.get("新增分布式虚拟交换机") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-jj-017"></i><br/><span title="' + $$$I18N.get("新增网络") + '">' + $$$I18N.get("新增网络") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-jj-classroom"></i><br/><span title="' + $$$I18N.get("新增教室") + '">' + $$$I18N.get("新增教室") + '</span></div>' + '</div>' + '<div>' + '<div class="icon"><i class="fa-fw fa icon-jj-Upload"></i><br/><span title="' + $$$I18N.get("上传安装包") + '">' + $$$I18N.get("上传安装包") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-032"></i><br/><span title="' + $$$I18N.get("新增硬件模板") + '">' + $$$I18N.get("新增硬件模板") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-jj-Template"></i><br/><span title="' + $$$I18N.get("新增模板") + '">' + $$$I18N.get("新增模板") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-034"></i><br/><span title="' + $$$I18N.get("加载gesttools") + '">' + $$$I18N.get("加载gesttools") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-035"></i><br/><span title="' + $$$I18N.get("保存模板") + '">' + $$$I18N.get("保存模板") + '</span></div>' + '</div>' + '</div>' + '<div class="help_arrow_big"><div class="help_arrow nomargin"><span class="tou"></span></div></div>' + '<div class="last">' + '<div class="icon"><i class="fa-fw fa icon-036"></i><br/><span title="' + $$$I18N.get("新增教学场景") + '">' + $$$I18N.get("新增教学场景") + '</span></div>' + '<div class="help_arrow down"><span class="tou"></span></div>' + '</div>' + '</div>' + '<div class="second">' + '<div class="last">' + '<div class="icon"><i class="fa-fw fa icon-037"></i><br/><span title="' + $$$I18N.get("激活场景") + '">' + $$$I18N.get("激活场景") + '</span></div>' + '<div class="help_arrow down"><span class="tou"></span></div>' + '</div>' + '</div>' + '<div class="third">' + '<div class="icon green"><i class="fa-fw fa icon-jj-008"></i><br/><span title="' + $$$I18N.get("安装客户端") + '">' + $$$I18N.get("安装客户端") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-031"></i><br/><span title="' + $$$I18N.get("为终端分配教室") + '">' + $$$I18N.get("为终端分配教室") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-033"></i><br/><span title="' + $$$I18N.get("终端排序") + '">' + $$$I18N.get("终端排序") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-jj-IP"></i><br/><span title="' + $$$I18N.get("分配IP") + '">' + $$$I18N.get("分配IP") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon green"><i class="fa-fw fa icon-038"></i><br/><span title="' + $$$I18N.get("终端访问桌面") + '">' + $$$I18N.get("终端访问桌面") + '</span></div>' + '</div>' + '</div>' + '</div>' + '</div>' + '<div class="form-group personal">' + '<div class="col-xs-12">' + '<div class="map">' + '<div>' + '<div class="first">' + '<div style="margin-bottom: 40px;">' + '<div class="icon"><i class="fa-fw fa icon-028"></i><br/><span title="' + $$$I18N.get("新增资源池") + '">' + $$$I18N.get("新增资源池") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-029"></i><br/><span title="' + $$$I18N.get("添加计算节点") + '">' + $$$I18N.get("添加计算节点") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-030"></i><br/><span title="' + $$$I18N.get("新增分布式虚拟交换机") + '">' + $$$I18N.get("新增分布式虚拟交换机") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-jj-017"></i><br/><span title="' + $$$I18N.get("新增网络") + '">' + $$$I18N.get("新增网络") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-jj-people"></i><br/><span title="' + $$$I18N.get("新增用户") + '">' + $$$I18N.get("新增用户") + '</span></div>' + '</div>' + '<div>' + '<div class="icon"><i class="fa-fw fa icon-jj-Upload"></i><br/><span title="' + $$$I18N.get("上传安装包") + '">' + $$$I18N.get("上传安装包") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-032"></i><br/><span title="' + $$$I18N.get("新增硬件模板") + '">' + $$$I18N.get("新增硬件模板") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-jj-Template"></i><br/><span title="' + $$$I18N.get("新增模板") + '">' + $$$I18N.get("新增模板") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-034"></i><br/><span title="' + $$$I18N.get("加载gesttools") + '">' + $$$I18N.get("加载gesttools") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon"><i class="fa-fw fa icon-035"></i><br/><span title="' + $$$I18N.get("保存模板") + '">' + $$$I18N.get("保存模板") + '</span></div>' + '</div>' + '</div>' + '<div class="help_arrow_big"><div class="help_arrow nomargin"><span class="tou"></span></div></div>' + '<div class="last">' + '<div class="icon"><i class="fa-fw fa icon-036"></i><br/><span title="' + $$$I18N.get("新增个人桌面") + '">' + $$$I18N.get("新增个人桌面") + '</span></div>' + '<div class="help_arrow down"><span class="tou"></span></div>' + '</div>' + '</div>' + '<div class="third">' + '<div class="icon green"><i class="fa-fw fa icon-jj-008"></i><br/><span title="' + $$$I18N.get("安装客户端") + '">' + $$$I18N.get("安装客户端") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon green"><i class="fa-fw fa icon-039"></i><br/><span title="' + $$$I18N.get("输入用户名密码") + '">' + $$$I18N.get("输入用户名密码") + '</span></div>' + '<div class="help_arrow"><span class="tou"></span></div>' + '<div class="icon green"><i class="fa-fw fa icon-038"></i><br/><span title="' + $$$I18N.get("终端访问桌面") + '">' + $$$I18N.get("终端访问桌面") + '</span></div>' + '</div>' + '</div>' + '</div>' + '</div>' + '</form>' + '</div>');
            if ($$$I18N.get("GOD_VERSION") == 'cloudClassEn') {
                $('#desktopHelpBox').addClass('en');
            }
            $('#desktopHelpBox .personal').hide();
            $('#desktopHelpBox .teach').show();
            $$$storage.setSessionStorage("desktopHelpBox", 'open');
            var obj = document.getElementById('desktopHelpBox');
            obj.style.left = (document.documentElement.clientWidth - obj.offsetWidth) / 2 + 'px';
            obj.style.top = (document.documentElement.clientHeight - obj.offsetHeight) / 2 + 'px';
            $('#desktopHelpBox select.type').change(function (e) {
                var value = e.target.value;
                if (value == '1') {
                    $('#desktopHelpBox .personal').hide();
                    $('#desktopHelpBox .teach').show();
                } else {
                    $('#desktopHelpBox .personal').show();
                    $('#desktopHelpBox .teach').hide();
                }
            });
        }
        function drag(obj) {
            var d = document,
                x,
                y,
                maxLeft,
                maxTop;
            var dragging = false;
            if (typeof obj == "string") {
                obj = document.getElementById(obj);
                obj.orig_index = obj.style.zIndex;
                maxLeft = document.documentElement.clientWidth - obj.offsetWidth;
                maxTop = document.documentElement.clientHeight - obj.offsetHeight;
                //设置当前对象永远显示在最上层
            }
            obj.onmousedown = function (a) {
                //鼠标按下
                this.style.cursor = "move";
                //设置鼠标样式
                if (!a) a = window.event;
                //按下时创建一个事件
                x = a.clientX - document.body.scrollLeft - obj.offsetLeft;
                //x=鼠标相对于网页的x坐标-网页被卷去的宽-待移动对象的左外边距
                y = a.clientY - document.body.scrollTop - obj.offsetTop;
                //y=鼠标相对于网页的y左边-网页被卷去的高-待移动对象的左上边距
                dragging = true;
            };
            obj.addEventListener("mousemove", function (a) {
                //鼠标移动
                if (!a) a = window.event; //移动时创建一个事件
                if (!dragging) {
                    return;
                }
                var left = a.clientX + document.body.scrollLeft - x;
                var top = a.clientY + document.body.scrollTop - y;
                if (left < 0) left = 0;
                if (top < 0) top = 0;
                obj.style.left = left > maxLeft ? maxLeft : left + 'px';
                obj.style.top = top > maxTop ? maxTop : top + 'px';
            });
            d.addEventListener("mouseup", function () {
                //鼠标放开
                obj.style.cursor = "normal"; //设置放开的样式
                obj.style.zIndex = obj.orig_index;
                dragging = false;
            });
        }
        drag('desktopHelpBox');
        $("#desktopHelpBox .close").click(function (e) {
            $$$storage.setSessionStorage("desktopHelpBox", 'unopen');
            _this.close();
        });
    };
    this.close = function () {
        $("body #desktopHelpBox") && $("body #desktopHelpBox").remove();
    };
}]).controller("vdiAboutController", ["$scope", "$Domain", function ($scope, $Domain) {}]).controller("vdiPermissionController", ["$scope", "$modal", "permissionList", "desktopHelpBox", "$Domain", function ($scope, $modal, permission_list, desktopHelpBox, $Domain) {
    $scope.domain = $Domain;
    $scope.service_qq = ["9714711", "330740825"];
    permission_list.query(function (res) {
        $scope.pmis = {
            "version": res.version,
            "build": res.build,
            "instance_num_quota": res.instance_num_quota,
            "license_time": res.license_time,
            "remain_days": res.remain_days
        };
    });
    $scope.$on('test', function (event, data) {
        $scope.pmis = {
            "instance_num_quota": data.instnum,
            "build": data.build_version,
            "version": data.version,
            "license_time": data.time,
            "remain_days": data.remain_days
        };
    });

    /**
     * [shutdown 一键关机]
     */
    $scope.shutdown = function () {
        $modal.open({
            size: "sm",
            templateUrl: "views/vdi/dialog/license/shutdown.html",
            backdrop: "static",
            controller: function controller($scope, $modalInstance) {
                $scope.ok = function () {
                    // About.query(function(){

                    // });
                    $modalInstance.close();
                };
                $scope.close = function () {
                    $modalInstance.close();
                };
            }
        });
    };
    $scope.help = function () {
        desktopHelpBox.open();
    };
}]).controller("UpdateLicenseDialog", ["$scope", "$modalInstance", "$$$version", "$$$I18N", "$Domain", function ($scope, $modalInstance, $$$version, $$$I18N, $Domain) {
    $scope.ex = {
        url: $Domain + '/thor/license/export'
    };
    $scope.version = $$$version;
    $scope.close = function () {
        $modalInstance.close();
    };
    var encodeHTML = function encodeHTML(txt, con) {
        con = con || document.createElement("div");
        while (con.firstChild) {
            con.removeChild(con.firstChild);
        }
        return con.appendChild(con.ownerDocument.createTextNode(txt)).parentNode.innerHTML;
    };
    var format = function format(tmpl) {
        var data = Array.prototype.slice.call(arguments, 0);
        return typeof tmpl === "string" ? tmpl.replace(/\{\{([^\}]+)?\}\}/g, function (match, param) {
            if (data[param]) {
                return encodeHTML(data[param]);
            }
            return match;
        }) : "";
    };

    $scope.finishUpload = function (response) {
        var data = response.data;
        switch (data.code) {
            case 0:
                $modalInstance.close();
                $.bigBox({
                    title: $$$I18N.get("授权更新成功"),
                    // 新的授权内容已生效，请关闭本窗口后刷新页面查看。
                    content: $$$I18N.get("LICENSE_MESS_1"),
                    color: "#8ac38b",
                    icon: "fa fa-ok shake animated",
                    timeout: 6000
                });
                $scope.$emit('test', data);
                break;
            case -1:
                $.bigBox({
                    title: $$$I18N.get("授权更新失败"),
                    // "授权文件与服务器硬件ID不匹配，请确认后重新上传。"
                    content: $$$I18N.get("LICENSE_MESS_2"),
                    color: "#C46A69",
                    icon: "fa fa-warning shake animated",
                    timeout: 6000
                });
                break;
            default:
                $.bigBox({
                    title: $$$I18N.get("授权更新失败"),
                    // "不是合法的授权文件格式或内容，请检查确认后重新上传。"
                    content: $$$I18N.get("LICENSE_MESS_3"),
                    color: "#C46A69",
                    icon: "fa fa-warning shake animated",
                    timeout: 6000
                });
        }
    };
}]);

/***/ }),
/* 158 */
/***/ (function(module, exports) {

var views = {"includes/header.html":"\r\n<div id=\"logo-group\"  data-ng-controller=\"LogoController\">\r\n\r\n\t<!-- PLACE YOUR LOGO HERE -->\r\n\t<span id=\"logo\" ng-class=\"{cloudPC: version == 'cloudPC',cloudClassEn: version == 'cloudClassEn',cloudClassCh: version == 'cloudClassCh',korean: version == 'korean'}\">\r\n\t\t<img key=\"header\" base64 alt=\"OS-EASY VDI\">\r\n\t</span>\r\n\t<!-- END LOGO PLACEHOLDER -->\r\n\t<!--span data-ng-controller=\"ActivityDemoCtrl\">\r\n\t\t<activity data-onrefresh=\"refreshCallback\">\r\n\t\t\t<activity:button data-icon=\"fa fa-user\" data-total=\"total\" />\r\n\t\t\t<activity:content data-footer=\"footerContent\">\r\n\t\t\t\t<activity:item data-src=\"item.src\" data-onload=\"item.onload\" data-active=\"item.active\" data-ng-repeat=\"item in items\">\r\n\t\t\t\t\t<span data-localize=\"{{ item.title }}\">{{ item.title }}</span> ({{ item.count }})\r\n\t\t\t\t</activity:item>\r\n\t\t\t</activity:content>\r\n\t\t</activity>\r\n\t</span-->\r\n</div>\r\n\r\n<!-- projects dropdown -->\r\n<!--div class=\"project-context hidden-xs\">\r\n\t<span class=\"label\"><span data-localize=\"Projects\">Projects</span>:</span>\r\n\t<span class=\"project-selector\" class=\"popover-trigger-element dropdown-toggle\" data-toggle=\"dropdown\"><span data-localize=\"Recent projects\">Recent projects </span> <i class=\"fa fa-angle-down\"></i></span>\r\n\r\n\t<ul class=\"dropdown-menu\">\r\n\t\t<li>\r\n\t\t\t<a href=\"javascript:void(0);\">Online e-merchant management system - attaching integration with the iOS</a>\r\n\t\t</li>\r\n\t\t<li>\r\n\t\t\t<a href=\"javascript:void(0);\">Notes on pipeline upgradee</a>\r\n\t\t</li>\r\n\t\t<li>\r\n\t\t\t<a href=\"javascript:void(0);\">Assesment Report for merchant account</a>\r\n\t\t</li>\r\n\t\t<li class=\"divider\"></li>\r\n\t\t<li>\r\n\t\t\t<a href=\"javascript:void(0);\"><i class=\"fa fa-power-off\"></i> Clear</a>\r\n\t\t</li>\r\n\t</ul>\r\n</div-->\r\n<!-- end projects dropdown -->\r\n\r\n<!-- pulled right: nav area -->\r\n<div class=\"pull-right\">\r\n\t\r\n\t<!-- collapse menu button -->\r\n\t<!--div id=\"hide-menu\" class=\"btn-header pull-right\">\r\n\t\t<span> <a href=\"javascript:void(0);\" data-action=\"toggleMenu\" title=\"Collapse Menu\"><i class=\"fa fa-reorder\"></i></a> </span>\r\n\t</div-->\r\n\t<!-- end collapse menu -->\r\n\r\n\t<!-- Skin Change -->\r\n\t<div class=\"btn-header transparent pull-right\" data-ng-controller=\"SkinController\">\r\n\t\t<form class=\"skin_change\" id='skinHolder' action=\"javascript:\">\r\n\t\t\t<label data-localize-title='皮肤一' id='skin0' data-ng-click=\"changeSkin('smart-style-0')\"></label>\r\n\t\t\t<label data-localize-title='皮肤二' id='skin1' data-ng-click=\"changeSkin('smart-style-1')\"></label>\r\n\t\t</form>\r\n\t</div>\r\n\t<!-- Top menu profile link : this shows only when top menu is active -->\r\n\t<!--ul id=\"mobile-profile-img\" class=\"header-dropdown-list hidden-xs padding-5\">\r\n\t\t<li class=\"\">\r\n\t\t\t<a href=\"#\" class=\"dropdown-toggle no-margin userdropdown\" data-toggle=\"dropdown\"> \r\n\t\t\t\t<img src=\"img/avatars/sunny.png\" alt=\"John Doe\" class=\"online\" />  \r\n\t\t\t</a>\r\n\t\t\t<ul class=\"dropdown-menu pull-right\">\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a href=\"javascript:void(0);\" class=\"padding-10 padding-top-0 padding-bottom-0\"><i class=\"fa fa-cog\"></i> Setting</a>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a href=\"#/misc/other/profile\" class=\"padding-10 padding-top-0 padding-bottom-0\"> <i class=\"fa fa-user\"></i> <u>P</u>rofile</a>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a href=\"javascript:void(0);\" class=\"padding-10 padding-top-0 padding-bottom-0\" data-action=\"toggleShortcut\"><i class=\"fa fa-arrow-down\"></i> <u>S</u>hortcut</a>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a href=\"javascript:void(0);\" class=\"padding-10 padding-top-0 padding-bottom-0\" data-action=\"launchFullscreen\"><i class=\"fa fa-arrows-alt\"></i> Full <u>S</u>creen</a>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a href=\"login.html\" class=\"padding-10 padding-top-5 padding-bottom-5\" data-action=\"userLogout\"><i class=\"fa fa-sign-out fa-lg\"></i> <strong><u>L</u>ogout</strong></a>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</li>\r\n\t</ul-->\r\n\r\n\r\n\t<!-- logout button -->\r\n\t<div id=\"logout\" class=\"btn-header transparent pull-right\" data-ng-controller=\"pageHeaderController\">\r\n\t\t<a class=\"btn btn-primary logout\" ng-if=\"dmsURL!=='nodms'\" ng-href=\"{{ dmsURL }}\" target=\"_blank\" data-localize=\"切换到DMS\"></a>\r\n        <button class=\"btn btn-primary logout\" data-ng-click=\"logout()\" data-localize='退出系统'></button>\r\n\t</div>\r\n\t<!-- end logout button -->\r\n\r\n    <!-- User info -->\r\n    <div class=\"login-info-2 transparent pull-right\" data-ng-controller=\"userLoginInfoController\">\r\n        <span>Hi, {{ loginUser.name }}</span>\r\n    </div>\r\n\r\n\t<div class=\"alarm pull-right\" data-ng-controller=\"AlarmController\" data-ng-click=\"open()\">\r\n\t\t<i class=\"fa icon-jj-011\"></i><span data-localize=\"消息\">消息</span><span class=\"number\">(<strong>{{ alarms.length }}</strong>)</span>\r\n\t\t<div class=\"modal-content\" data-ng-show=\"alarms.length!==0 && isOpen\">\r\n\t\t\t<div class=\"arraw\"></div>\r\n\t\t\t<div class=\"modal-header\">\r\n\t\t\t\t<button type=\"button\" class=\"close\" data-ng-click=\"close($event)\"><span aria-hidden=\"true\">×</span><span class=\"sr-only\">Close</span></button>\r\n\t\t\t\t<h4 class=\"modal-title\" style=\"color: #000;\" data-localize=\"消息\">消息</h4>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"modal-body\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<table\r\n\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t<thead class=\"vdi_grid_header\">\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"序号\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"对象\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"内容\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"时间\"></th>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t<tbody class=\"vdi_grid_body\">\r\n\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in alarms\" class=\"alarms\">\r\n\t\t\t\t\t\t\t\t<td>{{ $index+1 }}</td>\r\n\t\t\t\t\t\t\t\t<td>{{ item.object }}</td>\r\n\t\t\t\t\t\t\t\t<td class=\"content\" title=\"{{ item.content }}\">{{ item.content }}</td>\r\n\t\t\t\t\t\t\t\t<td>{{ item.created_at | date: 'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t\t<footer class=\"text-right\">\r\n\t\t\t\t\t<a href=\"javascript:\" class=\"btn btn-xs btn-danger isBatch\" data-ng-click=\"delete()\">清除消息</a>\r\n\t\t\t\t</footer>\t\t\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<!-- search mobile button (this is hidden till mobile view port) -->\r\n\t<!--div id=\"search-mobile\" class=\"btn-header transparent pull-right\">\r\n\t\t<span> <a href=\"javascript:void(0)\" title=\"Search\"><i class=\"fa fa-search\"></i></a> </span>\r\n\t</div-->\r\n\t<!-- end search mobile button -->\r\n\r\n\t<!-- input: search field -->\r\n\t<!--form action=\"#/misc/search\" class=\"header-search pull-right\">\r\n\t\t<input id=\"search-fld\"  type=\"text\" name=\"param\" data-localize=\"Find reports and more\" placeholder=\"Find reports and more\" data-autocomplete='[\r\n\t\t\"ActionScript\",\r\n\t\t\"AppleScript\",\r\n\t\t\"Asp\",\r\n\t\t\"BASIC\",\r\n\t\t\"C\",\r\n\t\t\"C++\",\r\n\t\t\"Clojure\",\r\n\t\t\"COBOL\",\r\n\t\t\"ColdFusion\",\r\n\t\t\"Erlang\",\r\n\t\t\"Fortran\",\r\n\t\t\"Groovy\",\r\n\t\t\"Haskell\",\r\n\t\t\"Java\",\r\n\t\t\"JavaScript\",\r\n\t\t\"Lisp\",\r\n\t\t\"Perl\",\r\n\t\t\"PHP\",\r\n\t\t\"Python\",\r\n\t\t\"Ruby\",\r\n\t\t\"Scala\",\r\n\t\t\"Scheme\"]'>\r\n\t\t<button type=\"submit\">\r\n\t\t\t<i class=\"fa fa-search\"></i>\r\n\t\t</button>\r\n\t\t<a href=\"javascript:void(0);\" id=\"cancel-search-js\" title=\"Cancel Search\"><i class=\"fa fa-times\"></i></a>\r\n\t</form-->\r\n\t<!-- end input: search field -->\r\n\r\n\t<!-- fullscreen button -->\r\n\t<!--div id=\"fullscreen\" class=\"btn-header transparent pull-right\">\r\n\t\t<span> <a href=\"javascript:void(0);\" data-action=\"launchFullscreen\" title=\"Full Screen\"><i class=\"fa fa-arrows-alt\"></i></a> </span>\r\n\t</div-->\r\n\t<!-- end fullscreen button -->\r\n\r\n\t<!-- #Voice Command: Start Speech -->\r\n\t<!--div id=\"speech-btn\" class=\"btn-header transparent pull-right hidden-sm hidden-xs\">\r\n\t\t<div> \r\n\t\t\t<a href=\"javascript:void(0)\" title=\"Voice Command\" data-action=\"voiceCommand\"><i class=\"fa fa-microphone\"></i></a> \r\n\t\t\t<div class=\"popover bottom\"><div class=\"arrow\"></div>\r\n\t\t\t\t<div class=\"popover-content\">\r\n\t\t\t\t\t<h4 class=\"vc-title\">Voice command activated <br><small>Please speak clearly into the mic</small></h4>\r\n\t\t\t\t\t<h4 class=\"vc-title-error text-center\">\r\n\t\t\t\t\t\t<i class=\"fa fa-microphone-slash\"></i> Voice command failed\r\n\t\t\t\t\t\t<br><small class=\"txt-color-red\">Must <strong>\"Allow\"</strong> Microphone</small>\r\n\t\t\t\t\t\t<br><small class=\"txt-color-red\">Must have <strong>Internet Connection</strong></small>\r\n\t\t\t\t\t</h4>\r\n\t\t\t\t\t<a href=\"javascript:void(0);\" class=\"btn btn-success\" onclick=\"commands.help()\">See Commands</a> \r\n\t\t\t\t\t<a href=\"javascript:void(0);\" class=\"btn bg-color-purple txt-color-white\" onclick=\"$('#speech-btn .popover').fadeOut(50);\">Close Popup</a> \r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div-->\r\n\t<!-- end voice command -->\r\n\r\n\t<!-- multiple lang dropdown : find all flags in the image folder -->\r\n<!-- \t<ul data-lang-menu=\"\" class=\"header-dropdown-list hidden-xs\" data-ng-controller=\"LangController\">\r\n\t\t<li>\r\n\t\t\t<a href=\"\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n\t\t\t\t<img alt=\"\" class=\"flag flag-{{ currentLang.flagCode }}\" src=\"img/blank.gif\"> <span> {{ currentLang.translation }} </span> <i class=\"fa fa-angle-down\"></i> \r\n\t\t\t</a>\r\n\t\t\t<ul class=\"dropdown-menu pull-right\">\r\n\t\t\t\t<li data-ng-class=\"{active: lang == currentLang}\" data-ng-repeat=\"lang in languages\">\r\n\t\t\t\t\t<a href=\"\" data-ng-click=\"setLang(lang)\" ><img class=\"flag flag-{{ lang.flagCode }}\" src=\"img/blank.gif\" /> {{ lang.language }} ({{ lang.translation }}) </a>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</li>\r\n\t</ul> -->\r\n\t<!-- end multiple lang -->\r\n\r\n</div>\r\n<!-- end pulled right: nav area -->\r\n<script type=\"text/javascript\">\r\n\tvar skinHolder = document.querySelector(\"#skinHolder\");\r\n\tvar skin0 = document.querySelector(\"#skin0\");\r\n\tvar skin1 = document.querySelector(\"#skin1\");\r\n\r\n\tskinHolder.addEventListener(\"click\",function(e){\r\n\t\tfor(var i=0; i<skinHolder.children.length; i++){\r\n\t\t\tif(e.target == skin0 || e.target == skin1){\r\n\t\t\t\t$(document.body).removeClass('smart-style-' + i);\r\n\t\t\t\tif(i == skinHolder.children.length-1 && e.target == skin0){\r\n\t\t\t\t\t$(document.body).addClass('smart-style-0');\r\n\t\t\t\t\t$$$storage.setSessionStorage('current_theme', 'smart-style-0');\r\n\t\t\t\t}\r\n\t\t\t\tif(i == skinHolder.children.length-1 && e.target == skin1){\r\n\t\t\t\t\t$(document.body).addClass('smart-style-1');\r\n\t\t\t\t\t$$$storage.setSessionStorage('current_theme', 'smart-style-1');\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\t\r\n\t\t}\r\n\r\n\t})\r\n</script>","includes/left-panel.html":"\r\n<!-- end user info -->\r\n\r\n<!-- NAVIGATION : This navigation is also responsive\r\n\r\nTo make this navigation dynamic please make sure to link the node\r\n(the reference to the nav > ul) after page load. Or the navigation\r\nwill not initialize.\r\n-->\r\n\r\n<navigation>\r\n\t<!--nav:item ng-repeat=\"nav in navs\" data-sublist=\"{{ nav.sublist }}\" data-view=\"{{nav.url}}\" data-icon=\"fa fa-lg fa-fw {{ nav.icon }}\" nav-title=\"{{ nav.value }}\" /-->\r\n\t<nav:item ng-repeat=\"nav in navs\" data-view=\"{{nav.url}}\" data-icon=\"fa fa-lg fa-fw {{ nav.icon }}\" nav-title=\"{{ nav.value }}\">\r\n\t\t<nav:item data-ng-repeat=\"subnav in nav.sublist\" data-view=\"{{subnav.url}}\" nav-title=\"{{ subnav.value }}\" />\r\n\t</nav:item>\r\n</navigation>\r\n<span class=\"minifyme\" data-action=\"minifyMenu\"> <i class=\"fa fa-arrow-circle-left hit\"></i> </span>\r\n","includes/login.html":"<div class=\"login_wrapper\">\r\n\t<p class=\"login_logo \" data-ng-if=\"current_theme =='smart-style-0'\"><img key=\"login_style0\" base64/></p>\r\n\t<p class=\"login_logo \" data-ng-if=\"current_theme =='smart-style-1'\"><img key=\"login_style1\" base64/></p>\r\n\r\n\t<form id=\"login-form\" class=\"smart-form\" novalidate>\r\n\t\t<table class=\"layout\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<label class=\"input\"> <i class=\"icon-append fa fa-user\"></i>\r\n\t\t\t\t\t\t<input type=\"text\" name=\"username\" maxlength=\"20\" data-ng-model=\"username\" required>\r\n\t\t\t\t\t\t<b class=\"tooltip tooltip-top-right\"><i class=\"fa fa-user txt-color-teal\"></i> <span localize=\"用户名\">用户名</span></b></label>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<label class=\"input\"> <i class=\"icon-append fa fa-lock\"></i>\r\n\t\t\t\t\t\t<input type=\"password\" maxlength=\"20\" name=\"password\" data-ng-model=\"password\" required>\r\n\t\t\t\t\t\t<b class=\"tooltip tooltip-top-right\"><i class=\"fa fa-lock txt-color-teal\"></i> <span localize=\"密码\">密码</span></b> </label>\r\n\t\t\t<!--div class=\"note\"><a href=\"forgotpassword.html\">Forgot password?</a></div-->\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<button type=\"submit\" class=\"btn btn-primary\" localize=\"登录\" ng-disabled=\"loading\" data-ng-click=\"login()\"></button>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</form>\r\n    <!--<div class=\"version\">Version 4.0</div>-->\r\n\t<div class=\"copyright\">\r\n\t\t<!--<p>版权所有：武汉噢易云计算有限公司</p>-->\r\n\r\n        <p localize=\"噢易云计算\"></p>\r\n        <p><a data-localize-href=\"WEBSITE_login_a\" target=\"_blank\" data-localize=\"WEBSITE_init\"></a></p>\r\n\t</div>\r\n</div>\r\n\r\n<div class=\"right_bottom\">Ver {{version}}</div><div id=\"hint_bar\" class=\"alert alert-warning fade in ng-hide\" ng-show=\"!$root.is_chrome\">\r\n\t<button class=\"close\" data-dismiss=\"alert\">\r\n\t×\r\n\t</button>\r\n\t<i class=\"fa-fw fa fa-warning\"></i>\r\n\t<span localize='chromeTips'></span>\r\n</div>","includes/monitor_panel.html":"<div class=\"portlet box grey\" >\r\n\t<div class=\"portlet-title clearfix padding-5\" >\r\n\t\t<div class=\"pull-left\">\r\n\t\t\t<a href=\"javascript:\" class=\"btn btn-default btn-xs\" ng-click=\"collapAll()\"><i class=\"fa  icon-jj-Shrinkfrom\"></i> </a>\r\n\t\t\t<a href=\"javascript:\"class=\"btn btn-default  btn-xs\"  ng-click=\"openAll()\"><i class=\"fa icon-jj-Open\"></i></a>\r\n\t\t</div>\r\n\t\t<div class=\"pull-right\" ng-init=\"showSearch=false\" ng-click=\"showSearch?showSearch=false:showSearch=true\"><a href=\"javascript:\"class=\"btn btn-default  btn-xs\"><i class=\"fa fa-search\"></i></a></div>\r\n\t</div>\r\n\t<div class=\"search\" ng-show=\"showSearch\"><input type=\"search\" maxlength=\"20\" localize=\"请输入搜索内容\" ng-model=\"searchText\"></div>\r\n\t<div class=\"portlet-body fuelux\">\r\n\t\t<ul>\r\n\t\t\t<li ng-repeat='item in rows' class='parent'>\r\n\t\t\t\t<a href='#' class='tree-toggle' ng-click=\"item.opened?item.opened=false:item.opened=true\"><em class='fa' ng-class=\"{'icon-jj-xiala':!item.opened,'icon-jj-sou':item.opened}\"></em>&nbsp;{{item.ip}}</a>\r\n\t\t\t\t<ul class='branch' ng-class=\"{in:item.opened}\">\r\n\t\t\t\t\t<li ng-repeat='subitem in item.names |filter:searchText'> <a href='#' class='tree-toggle' > {{subitem}} </a> </li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\t</div>\r\n</div>","includes/pagination.html":"<div data-grid-pagination data-ng-show=\"($parent.totalCount || $parent.rows.length) > 0\" class=\"dt-toolbar-footer row\">\r\n\t<div class=\"col-sm-6 col-xs-12 hidden-xs\">\r\n\t\t<div class=\"dataTables_info\" role=\"status\" data-localize=\"PAGE\" param1=\"{{ getStart() }}\" param2=\"{{ getEnd() }}\" param3=\"{{ $parent.totalCount || $parent.getFilterRows().length }}\"></div>\r\n\t</div>\r\n\t<div class=\"col-md-6\">\r\n\t\t<div class=\"dataTables_paginate paging_simple_numbers\">\r\n\t\t\t<pagination\r\n\t\t\t\tboundary-links=\"true\"\r\n\t\t\t\ttotal-items=\"totalCount || getFilterRows().length\"\r\n\t\t\t\titems-per-page=\"pagesize\"\r\n\t\t\t\tdata-ng-model=\"$parent.currentPage\"\r\n\t\t\t\tdata-ng-change=\"pageChange()\"\r\n\t\t\t\trotate=\"true\"\r\n\t\t\t\tmax-size=\"10\"\r\n\t\t\t\tclass=\"pagination-sm\"\r\n\t\t\t\tprevious-text=\"&lsaquo;\"\r\n\t\t\t\tnext-text=\"&rsaquo;\"\r\n\t\t\t\tfirst-text=\"&laquo;\"\r\n\t\t\t\tlast-text=\"&raquo;\"\r\n\t\t\t></pagination>\r\n\t\t</div>\r\n\t</div>\r\n</div>","includes/ribbon.html":"<!--span class=\"ribbon-button-alignment\">\r\n\t<span\r\n\t\tid=\"refresh\"\r\n\t\tclass=\"btn btn-ribbon\"\r\n\t\tdata-action=\"resetWidgets\"\r\n\t\tdata-title=\"refresh\"\r\n\t\trel=\"tooltip\"\r\n\t\tdata-placement=\"bottom\"\r\n\t\tdata-original-title=\"<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings.\" data-html=\"true\" data-reset-msg=\"Would you like to RESET all your saved widgets and clear LocalStorage?\"><i class=\"fa fa-refresh\"></i></span>\r\n</span-->\r\n\r\n<!-- breadcrumb -->\r\n<breadcrumb>\r\n\t<!-- This is auto generated -->\r\n</breadcrumb>\r\n<span class=\"ribbon-button-alignment pull-right\"><span data-localize=\"HELP\">Help</span>\r\n\t<a href=\"javascript:void(0);\" rel=\"popover\" data-ribbon-tips data-placement=\"bottom\" data-html=\"true\" data-content=\"<ul>\r\n\t\t<li>注意文件名重复时将覆盖掉原先的备份。</li>\r\n\t\t<li>本功能只备份系统数据库。</li>\r\n\t\t</ul>\" data-original-title=\"\" title=\"\"><i class=\"fa fa-question-circle\"></i></a>\r\n</span>\r\n<!-- end breadcrumb -->\r\n\r\n<!-- You can also add more buttons to the\r\nribbon for further usability\r\n\r\nExample below:\r\n\r\n<span class=\"ribbon-button-alignment pull-right\">\r\n<span id=\"search\" class=\"btn btn-ribbon hidden-xs\" data-title=\"search\"><i class=\"fa-grid\"></i> Change Grid</span>\r\n<span id=\"add\" class=\"btn btn-ribbon hidden-xs\" data-title=\"add\"><i class=\"fa-plus\"></i> Add</span>\r\n<span id=\"search\" class=\"btn btn-ribbon\" data-title=\"search\"><i class=\"fa-search\"></i> <span class=\"hidden-mobile\">Search</span></span>\r\n</span> -->","includes/shortcut.html":"<ul>\r\n\t<!--li><a href=\"#/vdi/\" class=\"jarvismetro-tile big-cubes bg-color-blue\"><span class=\"iconbox\">\r\n\t\t<i class=\"fa fa-envelope fa-4x\"></i>\r\n\t\t<span data-localize=\"\">制作模版</span>\r\n\t</span></a></li-->\r\n\t<li><a href=\"#/desktop/personal\" class=\"jarvismetro-tile big-cubes bg-color-purple\"><span class=\"iconbox\">\r\n\t\t<i class=\"fa fa-envelope fa-4x\"></i>\r\n\t\t<span data-localize=\"\">查看个人桌面</span>\r\n\t</span></a></li>\r\n\t<!--li><a href=\"#/vdi/\" class=\"jarvismetro-tile big-cubes bg-color-blue\"><span class=\"iconbox\">\r\n\t\t<i class=\"fa fa-envelope fa-4x\"></i>\r\n\t\t<span data-localize=\"\">新增用户</span>\r\n\t</span></a></li-->\r\n\t<li><a href=\"#/user/common\" class=\"jarvismetro-tile big-cubes bg-color-orangeDark\"><span class=\"iconbox\">\r\n\t\t<i class=\"fa fa-envelope fa-4x\"></i>\r\n\t\t<span data-localize=\"\">查看所有用户</span>\r\n\t</span></a></li>\r\n\t<!--li><a href=\"javascript:\" data-ng-click=\"\" class=\"jarvismetro-tile big-cubes bg-color-purple\"><span class=\"iconbox\">\r\n\t\t<i class=\"fa fa-envelope fa-4x\"></i>\r\n\t\t<span data-localize=\"\">关闭所有终端</span>\r\n\t</span></a></li-->\r\n\t<li><a href=\"#/terminal/client\" class=\"jarvismetro-tile big-cubes bg-color-greenLight\"><span class=\"iconbox\">\r\n\t\t<i class=\"fa fa-envelope fa-4x\"></i>\r\n\t\t<span data-localize=\"\">查看所有终端</span>\r\n\t</span></a></li>\r\n</ul>","includes/tasklist.html":"<div id=\"PageBottomBar\" data-ng-controller=\"TaskListController\" style=\"display: none\">\r\n\t<div class=\"progress_wrapper\">\r\n\t\t<div class=\"progress_resize_handler\" data-ng-click=\"toggleTaskList()\">\r\n\t\t\t<i class=\"fa fa-reorder up_arrow\"></i>\r\n\t\t\t<i class=\"fa fa-reorder down_arrow\"></i>\r\n\t\t</div>\r\n\t\t<div class=\"progress_body row no-margin no-padding\">\r\n\t\t\t<div class=\"progress_content\">\r\n\t\t\t\t<div class=\"progress_list_wrapper\">\r\n\t\t\t\t\t<table\r\n\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover has-tickbox\"\r\n\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"序号\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"操作类型\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"对象名称\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"开始时间\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"结束时间\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"操作人员\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"状态\"></th>\r\n\t\t\t\t\t\t\t\t<th data-localize=\"详细\"></th>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows\">\r\n\t\t\t\t\t\t\t\t<td>{{ item.id }}</td>\r\n\t\t\t\t\t\t\t\t<td><span data-localize=\"{{ item.task_type }}\"></span></td>\r\n\t\t\t\t\t\t\t\t<td class=\"nowrap\">{{ item.task_target }}</td>\r\n\t\t\t\t\t\t\t\t<td class=\"nowrap\">{{ item.created_at | date:'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t\t<td class=\"nowrap\">{{ item.task_time | date:'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t\t<td>{{ item.user }}</td>\r\n\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa  icon-jj-right txt-color-greenjj\" data-ng-if=\"item.status==1\"></i>\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa icon-jj-wrong .txt-color-redjj\" data-ng-if=\"item.status==2\"></i>\r\n\t\t\t\t\t\t\t\t\t<img data-ng-src=\"img/building.gif\" data-ng-if=\"item.status==0\" width=\"13\" height=\"13\">\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t<td>{{ item.task_exception }}</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n","includes/userMenu.html":"<section class=\"dir-user-menu\">\r\n<!-- {{$scope.type}}\r\n<div>\r\n\t<div class=\"col-xs-5 control-label text-center\">\r\n\t\t<label class=\"text-center\" localize=\"从下表选择一个或多个用户\">从下表选择一个或多个用户</label>\r\n\t\t{{$scope.type}}\r\n\t</div>\r\n\t<div class=\"col-xs-2\">&nbsp;</div>\r\n\t<div class=\"col-xs-5 control-label text-center\">\r\n\t\t<label class=\"text-center\" localize=\"已选择用户\">已选择用户</label>\r\n\t</div>\r\n</div> -->\r\n\r\n<div class=\"user-menus\">\r\n\t<div>\r\n\t\t<label class=\"text-center\" localize=\"从下表选择一个或多个用户\">从下表选择一个或多个用户</label>\r\n\t\t<div class=\"dataTables_filter search\" style=\"float: right;\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t</div>\t\r\n\t<div class=\"menus\" style=\"width: 100%\">\r\n\t\t<ul class=\"menu menu-tree\" data-ng-repeat=\"item in _users track by $index\">\r\n\t\t\t<div class=\"menu_header\">\r\n\t\t\t\t<span class=\"fa icon-jj\"></span>\r\n\t\t\t\t<span>{{item.typeName}}</span>\r\n\t\t\t\t<span class=\"pull-right  fa icon-jj-add\" data-ng-click=\"add_selected(item.userData);$event.stopPropagation()\"></span>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"menu_body\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<li class=\"menuitem\" data-ng-repeat=\"_user in (item.userData) | filter:searchText\" ng-click=\"add_select_rows($event,_user,item.userData)\" ng-dblclick=\"add_selected(_user)\">\r\n\t\t\t\t\t\t<span class=\"text-overflow text-overflow-half\">{{_user.name}}</span><span class=\"text-overflow text-overflow-half\">{{_user.real_name}}</span>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</ul>\r\n\t\t<ul class=\"menu menu-tree\" data-ng-repeat=\"item in domain_users track by $index\">\r\n\t\t\t<div class=\"menu_header\">\r\n\t\t\t\t<span class=\"fa icon-jj\"></span>\r\n\t\t\t\t<span>{{item._name}}</span>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"menu_body\">\r\n\t\t\t\t<ul class=\"menu menu-tree\" data-ng-repeat=\"group in item.groups track by $index\">\r\n\t\t\t\t\t<div class=\"menu_header\">\r\n\t\t\t\t\t\t<span class=\"fa icon-jj\"></span>\r\n\t\t\t\t\t\t<span class=\"menu-name\">{{group.name}}</span>\r\n\t\t\t\t\t\t<span class=\"pull-right  fa icon-jj-add\" data-ng-click=\"add_selected(group.users,$event)\"></span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"menu_body\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<li class=\"menuitem\" data-ng-repeat=\"user in group.users | filter:searchText\" ng-click=\"add_select_rows($event,user,group.users)\" ng-dblclick=\"add_selected(user)\">\r\n\t\t\t\t\t\t\t\t<span class=\"text-overflow text-overflow-half\" title=\"{{user.name}}\">{{user.name}}</span><span class=\"text-overflow text-overflow-half\">{{user.real_name}}</span>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</ul>\r\n\t\t<ul class=\"menu menu-tree\">\r\n\t\t\t<div class=\"menu_header\">\r\n\t\t\t\t<span class=\"fa icon-jj\"></span>\r\n\t\t\t\t<span localize='普通用户'></span>\r\n\t\t\t\t<!-- <span class=\"pull-right  fa icon-jj-add\" data-ng-click=\"add_selected(item.userData);$event.stopPropagation()\"></span> -->\r\n\t\t\t</div>\r\n\t\t\t<div class=\"menu_body\">\r\n\t\t\t\t<tree-node-parent data-users='common_users' data-filtertext='searchText'></tree-node-parent>\r\n\t\t\t</div>\r\n\t\t</ul>\r\n\t</div>\r\n\t<div class=\"text-center operators\">\r\n\t\t<button  ng-disabled=\"seRows.length===0\" ng-click=\"ltor()\" type=\"button\" class=\"btn btn-default btn-xs\"><i class=\"fa icon-jj-003\"></i></button>\r\n\t\t<button  ng-disabled=\"rmRows.length===0\" ng-click=\"rtol()\" type=\"button\" class=\"btn btn-default btn-xs\"><i class=\"fa icon-jj-002\"></i></button>\r\n\t</div>\r\n\t<!-- <label class=\"text-center\" localize=\"已选择用户\">已选择用户</label> -->\r\n\t<div class=\"menus\" ng-class=\"{'menus-error': !selected.length}\">\r\n\t\t<ul class=\"menu menu-selected\">\r\n\t\t\t<div class=\"menu_body\">\r\n\t\t\t\t<li class=\"menuitem\" data-ng-repeat=\"sitem in selected\" ng-click=\"add_remove_rows($event,sitem)\" ng-dblclick=\"remove_selected(sitem)\">\r\n\t\t\t\t\t<span class=\"text-overflow text-overflow-half\">{{sitem.name}}</span><span class=\"text-overflow text-overflow-half\">{{sitem.real_name}}</span>\r\n\t\t\t\t</li>\r\n\t\t\t</div>\r\n\t\t</ul>\r\n\t</div>\r\n</div>\r\n</section>","views/vdi/about.html":"<section>\r\n\t<div class=\"row\">\t\t\r\n\t\t<div class=\"col-xs-4 col-sm-4 col-md-4 col-lg-4\" style=\"padding:0px 0px 0px 40px\">\r\n\t\t\t<header><h2><strong data-localize=\"ABOUT_NAME\"></strong> <br><small>{{pmis.build}}</small></h2></header>\r\n\t\t\t<p data-localize='许可内容'></p>\r\n\t\t\t<ul class=\"has-style\">\r\n\t\t\t\t<li data-localize='MAX_CONTECT' param1='{{pmis.instance_num_quota || 0}}'></li>\r\n\t\t\t</ul>\r\n\t\t\t<p ng-show=\"pmis.remain_days && pmis.remain_days<=10000\" class=\"font-sm license-alert license-alert-danger\" data-localize='PERIOD_TIME' param1='{{pmis.license_time}}' param2='{{pmis.remain_days}}'></p>        \t\r\n\t\t\t<p ng-show=\"pmis.remain_days && pmis.remain_days>10000\" class=\"font-sm license-alert license-alert-danger\" localize=\"无限期\"></p>\r\n\t\t\t<a class=\"btn btn-sm btn-primary\" href=\"javascript:\" data-dialog=\"UpdateLicenseDialog\" data-dialog-url=\"license/addlicense.html\" data-dialog-size=\"md\" data-localize='更新授权'></a>\r\n\t\t\t<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"grid\" style=\"margin: 40px 0 40px 0;\" class=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\">\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th localize=\"组件名称\"></th>\r\n\t\t\t\t\t\t<th localize=\"备注\"></th>\r\n\t\t\t\t\t\t<th localize=\"操作\"></th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</thead>\t\r\n\t\t\t\t<tbody>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td localize='Windows客户端1'></td>\r\n\t\t\t\t\t\t<td localize='安装在windows系统下的客户端'></td>\r\n\t\t\t\t\t\t<td><a class=\"btn btn-xs btn-default\" href=\"{{ domain }}/thor/download_win_client\" localize-title=\"下载\"><i class=\"fa icon-jj-Download\"></i></a></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\r\n\t\t\t<button class=\"btn btn-default btn-sm\" ng-click=\"help()\" localize=\"桌面部署帮助\"></button>\r\n\t\t\t<!--div class=\"col-md-12 col-sm-12 row\" style=\"padding-top: 10px;\">\r\n\t\t\t\t<h4><strong data-localize=\"售后服务\">售后服务</strong></h4>\r\n\t\t\t\t<h6><strong data-localize=\"在线客服\">在线客服</strong></h6>\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<a target=\"_blank\" ng-href=\"http://wpa.qq.com/msgrd?v=3&uin=188368715&site=qq&menu=yes\"><img border=\"0\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE0AAAAWCAYAAACFQBGEAAAPUElEQVRYR52ZCXQVVbaGv1N1k0AGISJTmAkxggKKgIDSCAZEBFRQFGyUodUOyCiN2LQElcHxiQyNAoIggowRlMkwCGgAlXnRIqMDJpIACWTOvVWn1z51bxJofG/1q7VYufdW1Tl7//vf/9l7o7Sr9bTDebiuSxg+NA6u4v+43GvuW+a7Dv567euh30MvXW/5is8oQut76/63l1LealrL3/9+DUu7OCocy/WjfLbBRisXC5sJLWNQUw9e0W1rWVSvFEWJ2UujdLlbZt8KV4VbZb+KcZo/RtoznrJghL57CwQBr/i6G3T6OmtWtEfWuTrA3iLB1/8D66verbDf1faAK/sqF7TYpsGBiHBFZl4hGVcCqCn7c3WPxlW4VCL3HBxlYV2DjHMtchVBLLtXHlG3jHPlD169RvmzIYNlSx3cV6LqGRxiiwd46H5FNNwKtpU7X46Icx1b3Gv8M0GvAKJyFAHLxVYK7SqUUiZ89SNhT8YV1Cv7L+vuDW4gJ+CgtI1blhrysACpObZ7Jwd3bOS7zWlot5iwqMo0a92OewcMocltbXCVW+aQI5u5IYcdUD5cJUx00K6NpQUA5QXS56Idy9tHy7O2IGOMFEckyzynLUMf1xbTvb1sNK6soSxjs1LeM46lsRwLsUP2QlLN8iEpr7HQjqQZhhw+s75L0NzyVBCDgsEIJZrYU6cyHPi9sBy0S37XpKUO6oF8di3FhjkzObh9O3mXcygovIQO+HF0ANtS1E5oxn2PDaJt74e8nLAUKmDhqoBxxtMWi4ArUdO4IWewzXe/aAZh5j1xxstWZcAQJCUYSowPsk7WEuMdBQKDACqyIO8Kno5xNoCrwkyQlGuhlcJytWGOAGipMFx500iKrBKgOL+ASpE3GN3yBMoyIMt+FZksoO3PLEBN/j43yDRPy0JMk1ge/z6dJZNfoWrVWF59+TnuubczthWB45Swe/c2nh6YTJM77uTx8a9Qo0FjxJWyjSWfQkYIgxxhgzjqGEAl38oEW5jq+rC1JqAcY6zcM5qlbeOIOCefhVGu8nvBcAzG5tkdWzaxM20Lk956zzsADHN9HlO1xYmjBzl7+gRdH+7HiaP7ual6HarXiGP3js2krfmUlNmL0Jbi67SN3J30gLFdaQ80cUVYK6B9l5mPSvn2su7eOIac0gpMkzRVLkun/oNDW7+i+k0x7Px6Cz5bMSxlJh+kjKVE+4lvmEC47aNtz348NmGScSSkXZYrrA1GzrXRPlBOgPWrV7Ej7UuyM88h2NVtfDNdunfn3qRexlAx0lKKFYvnsSV1rdES4estLe+kz8CBNIhvwoXzl/jhwF7whZmTTZzT2iF1+ULuf2gAlWOicd2ACSK2n46de3DxQjYzU16kfbeexETG8OX6ZSRPmsaB9HSO7Unn6bEvsvz9WURGR/L0mIkeaCICFUCrLUzLKERN2perH4i/4SrQDN+0xch2zU3kb064hVcmjaZ9x874bJuA4/DN7jSeHJhMeKVK1G6UwN8WrMSR9PaJlxbKkWMbfEIqSUvlZ+XHS/h87RoG/HkQ3R951NxcsWghm1NXMHzcS7TocA/h+Jg8biRFebk8mTySpne0MZ9nvzWFc2dPM/HNufxy8kfWLFtAQIcRFjq8JJ0EPPwo7fOYahC3mPDGe4RHR5Nx5jTL5s5g3Buz2b5uFXGNGrH981Rcx0+7+3vw28lT9Bw42JOD6xxGAtp3mYWoifty9YONY8gVxpt6RFLBJeDXvNmpKZkqkn3PniT2gVioVA9VnAcXM7mQVUT1My7NFzQg8qbqvLx2jwHYVHraO3ECRqwlLW1yzmcw+tkhDHl+BB279kRpj4XK1Sz6YBbHDh/irfcXsH3TFj6aN5N35n5EbM04o1x+fPhch5eGD6ZpizsY8NxIr7RwXS5mZ/Fl6gr6/9X7LTvrPJ8tXUCvAUOoWbMmwreLv1/ixA/70AGLVu3vMQCKxH2zdRMbly+kRdtOnDh2mKRe/WjdrRu2FpGqqKWe3NaubPFtRj7q73tzdE/DNNG0UHRsdO5FIoa0w388m+wozYAxfuw2lVDZeXDBpjRXs2xOBHZxZWrUrUrRF//yDgMVBnIQmLU8LXOVxca1K1i55COWfPY5cn4JWOYZS3Hs8AHeSZnEy2/PYtO6VRTmXWFkynSRfSzl4HdtbA2b161g02epvLNoObZyyTp/nvdenUj7+3rQvU8/k6IKzZpPFnNozy4GPDeChNtakXnmJLvSthiQUmZ/yA9HDpC+bTOXsjLpMeAZoqMqGwn4YumH1GuSyFOjxpexNFTeiK1xkTb7fsvzQLuWaZLNx1cspu28l+n0Sy5HE+NYVT2COr9cRPlKQIdT1dbUzrdoUeqytFYtTj7xPJ0fH0QgWBjawlcXbBFj12V96qfs3LqFN+csNKLqWMEaTPvIys5g4l8HMzplKptTV1KtRhxPJ48wp5zoioCuXIedaWl8/MEM5q3ZxNlTJ5k3YzqNG8ZTv2ECSY/0xbUsLp4/z5xXJ1CvcTN+OPI9Q8dNILFZS85nZTB15LNMfO9Djh89SObZ09zbqy+njx5my+ep/GPGHIqKSjicvov2ST08PdY+E4jQJUwzoP0t/bJ+JD6KHL8kk9RpcGTHVj6dmsJTla4wKDOD8FiIaFiHiNiqqLw8KLqM43fIDfjIOA+PllTmhtrV6D0ihWb3dg4y1gY3YFgl18bU5az+eCkfrvkiWId5p6gUmj+dPc30cSOZMmchaz9ZQGFeIaMmvWbSWpLTtcII92s2rF/Nrm1bmDJrHq+PH02rDh3pkNSVySOSGTp6LIkt7mT5vFn8fOY046bN4PixQ2ScOUXX3n3J+j2bKaOG8NKs+RxNTyc763f6PZfMtnUr2Zu2g5dmzuXc6ROsXjCfMdPeMWWHZIzRSdFq7VAnymLPuULUuG9ydZ8m0Vwq9XsPolj++mvsWb+WJo3imPvU41x+fQyVo6OoVb8uETVrUpLYGn/deJzGTbDjm9GmRWtuvKka8Xd0oP/k6diuVzwqSxvQhNpyWo4fNozBycO4u2s3UwC7tkiCxUdzZ3Ls6H7e+OdCdm/eyqL5M3lz9nxurF4DbMvwTfrAvz+fTNOWLXnimeH4pOQQNiuHr9au4qsd2+na80E2LFvJsJcnUbdRAgFEY71S/0J2Fq8Nf4ZJs96nSs043p4wiq4PP8qhvemcOnKIgaNfYvXCWXTq+TDtuzxggll+gnqg1Y22Sf+1CPXC1zn6kYRocks9VIVpYzq1QbsWfbvfxrTJb5PVqx1unUbELtuC7Qvgs8KwbR/Ffk1+YREjerXm67MB6sTfzIuLV3kMMQWqJ/Yhtq1espgdWzfx4MN9uf+Rx0CVsmbJJ2xZt4Znx46nVfuO5vlpL441fx/685Pcelsr8gvzmP8/b3Hu9GnGT3uHG2vVMmz1K024I0dFgFnTJnPyyGG69O5D7/5Pe92ELSWDOOznYlYm00cl0+OJgcai+o0TTQey5N2p1I5PJDIykia3tqJd0n3mXVNIh05QUwhDXKRiz7li1NjdubrPzVHkFHu5KxX02HvupMuTT3F3xE6eeOFTwvq05lKlWKqt31M2ypBl8guKjA6smjGcwjbJrJ/zLqPnLTMi6tXTUniKtkmrEoblOGxYt5INqakUFhajdCn14ptyX5ckOnTrbsoEKWBlyrD4g9l8s21bsG1yaNX+bu7v1Zf6TZoYBvtdi4KCAg6n7+Tgt3v59dQZElrexo9HDnFHu47cnfQgdRs28GpHZZH7ewavjhxKbO06DJvwClnZmayZP9cwst9fnmPmxBdo2Lw5PfsPIioyhoCrsW2F42gsy8uWuCiL3b8UosbsytF9E6MNaN6JpyguLDR1VuTGHjTq8xn1asbii/BR2eczPZnf1RSWlJKVc5ko4NynPfn5oa1YvjCUtDDKJaADWMH2R8qLAFLNi86VGkbnF+Xz7pQU8i5fYVDySOKb346p38UG+Wdb4Be9O8mHM98gKrIKQ8aMp0qNGgaA5Qvm8cuZk0RFxdAh6T5atfsTVW+szqUL2Wz9fCX79+wjJroSt7f9Ew/0H8SvP/1oQOrRfxAbl3/EuTNnaNu1C48NHkWAALlZF5g/fRIFRfn0Hvo8rdu0N22AnAOmD1YqCFoxavTOXN03MZLcEmmERYM8dkQfXUTVM3OoUq0+l5rPol7dmlSpHGGEubAEE+XffvqBWkfGklcc4MxDe8r6wjDRNMur1P0awqTSl4rLtEHKMCmgvX50w7pUPlu6DJSfu7p2Y/DQUZTK7MrxDJWrsOgKn8z7Jwf2fGMU6vFnh1OQl0/DRvEkNL/d1FTS6siJLekorVpRfj7fb0vDFx3NXV2SvK5B0s212fHFKuo1TiD+1hbewRgcFhQW5LF3+5fc1bkrUdFVTY8tMzTziNbUilKk/1qKGvVVjn70FklPAU2KWzHLof4HbWg59GZUzj6OpyWSVbMtBTU6U61GLfyZR2nkrCM6ah9VmrTh2MfHKA1U4tRQSV/pIV38FkgrJWeyUUrRS+W1O5K8Uh6E+k8pOrUUYqZ+82TCVbZ3CpvpiDITDgFSShVL2jLDSllHYZueWSYlEhzL7CfOiuaJs6bscRx8yjIFuO36vB7XjFeCumv6S4HfZ2pDb6bmSYsgIgGsFWWz++diDzSPabKB164bIdw4DevX3cRaJQQCUBJek4Laifg7jca3eRqxGd9RCDSo5icvUI1ArQZkdZ1poi7v+5XCp6VkKK9zvIh5DbnXjLpl0QxV4NoKmI5CajlhjeiJpHpoChuEy9NKYY+Meizpeb3G3fhg2OzpkJBAADa1oelUpKzybDLjItMjy7MycYnAVSXYpvcur9GkFxbw4mLC2PVTEWr4jmz9VNMqZBU7OKJBWuqnsnouaOw138tGNaHh4NXj3auGkEHjK05Yyya5ZQPC8oGjrBTa3hvLlN8rX6N8fheyzHvWm8Nde1074RWgrr0q2izPC1NFQqTkkSSQ7qRBjM2XZ0tRyTsu6W71KxN3A5QGPHoGR2rB07R8ehra6HqGeSdvqMqvOC6/vhNeCv7nBLeiM2UT1QpBCu0ttdsfXeLr9cbyZQAHB61/5IckpEnroA7K5CbSF87ZHD/Hc0tFNrQevu0iliV0DOD4FLZ0uRWuaw0ICfQfGv2/jMev+04FUEzamJHr1ewO1Xryq1dN/v8vGTFeNzgVfpSDwxL5cJVhWcDW5r8B5nS+kX8Dt0IIGWxS/nQAAAAASUVORK5CYII=\"/></a>\r\n\t\t\t\t</p>\r\n\t\t\t\t<h6><strong data-localize=\"售后电话\">售后电话</strong></h6>\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<span>4001-027-580</span>\r\n\t\t\t\t</p>\r\n\t\t\t</div-->\r\n\t\t</div>\r\n\t\t<div class=\"col-xs-8 col-sm-8 col-md-8 col-lg-8\">\t\r\n\t\t\t<header><h2 class=\"text-center\"><strong data-localize='许可协议'></strong></h2></header>\r\n\t\t\t<div class=\"xukexieyi\">\r\n\t\t\t\t<p style='text-indent:2em;' data-localize='ABOUT'></p>\r\n\t\t\t\t<ol>\r\n\t\t\t\t\t<li data-localize='ABOUT1'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT2'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT3'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT4'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT5'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT6'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT7'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT8'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT9'></li>\r\n\t\t\t\t\t<li data-localize='ABOUT10'></li>\r\n\t\t\t\t </ol>\r\n\t\t\t<div>\r\n\t\t</div>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n<style>\r\n\t.xukexieyi p,ol>li{\r\n\t\tline-height:25px;\r\n\t}\r\n</style>","views/vdi/common/input-number-temp.html":"<div class =\"input-number-field-container\" >\r\n\t<input ng-model=\"userNumber\" class=\"input-number-field-input\" ng-keydown=\"keydown($event)\" ng-blur=\"round()\" ng-change=\"setValidation()\" ui-input-number-formatter>\r\n\t<span class=\"input-number-field-arrow\">\r\n\t\t<i class=\"input-number-add input-number-arrow\" ng-mousedown=\"add(this.addStep)\"></i>\r\n\t\t<i class=\"input-number-sub input-number-arrow\" ng-mousedown=\"add(-this.addStep)\"></i>\r\n\t</span>\r\n<style type=\"text/css\">\r\n\t.input-number-wraper-sm{\r\n\t\tdisplay: inline-block;\r\n\t\twidth: 60px;\r\n\t}\r\n\t.input-number-field-container{\r\n    \tborder-color: #ccc;\r\n\t\tmin-width: 40px;\r\n\t\tbackground-color: #fff;\r\n\t\twidth:100%;\r\n\t\tposition: relative;\r\n\t\tdisplay: -webkit-flex;\r\n\t\tborder-style: solid;\r\n\t\tborder-width: 1px;\r\n\t}\r\n\t.input-number-wraper-sm .input-number-field-container{\r\n\t\tpadding: 6px;\r\n\t\t-webkit-transition: all .2s linear;\r\n\t}\r\n\t.input-number-field-container:hover .input-number-field-arrow{\r\n\t\topacity: 1;\r\n\t}\r\n\t.input-number-field-container .input-number-field-input{\r\n\t\tborder: none;\r\n\t\tbackground-color: transparent;\r\n\t\tborder-radius: none;\r\n\t\tline-height: 18px;\r\n\t\theight: 18px;\r\n\t\tdisplay: inline-block;\r\n\t\t-webkit-flex:1;\r\n\t\tflex:1;\r\n\t\twidth: 100%;\r\n\t\tmargin-right: 2px;\r\n\t}\r\n\tinput[ui-input-number].ng-invalid+.input-number-field-container\r\n\t{\r\n\t\tbackground: #fff0f0;\r\n    \tborder-color: #A90329;\r\n\t}\r\n\t.input-number-field-container .input-number-field-input:focus~.input-number-field-arrow{\r\n\t\topacity: 1;\r\n\t}\r\n\t.input-number-field-container .input-number-field-arrow {\r\n\t\twidth: 15px;\r\n\t\theight: 18px;\r\n\t\tbackground-color: #F1F1F1;\r\n\t\tposition: relative;\r\n\t\t-webkit-user-select: none;\r\n\t\topacity: 0;\r\n\t}\r\n\t.input-number-field-arrow .input-number-arrow{\r\n\t\tposition: absolute;\r\n\t\theight: 9px;\r\n\r\n\t}\r\n\t.input-number-field-arrow .input-number-arrow:active:hover{\r\n\t\tbackground-color: #D2D2D2;\r\n\t}\r\n\t.input-number-field-arrow .input-number-arrow:hover{\r\n\t\tbackground-color: #ccc;\r\n\t}\r\n\t.input-number-field-arrow .input-number-arrow.input-number-add{\r\n\r\n\t\ttop: 0px;\r\n\t\tright: 0px;\r\n\t\twidth: 100%;\r\n\t\ttext-align: center;\r\n\t\tdisplay: inline-block;\r\n\t\tline-height: 9px;\r\n\t\theight: 9px;\r\n\t\t\r\n\t}\r\n\t.input-number-field-arrow .input-number-arrow.input-number-sub{\r\n\t\tbottom: 0px;\r\n\t\tright: 0px;\r\n\t\twidth: 100%;\r\n\t\ttext-align: center;\r\n\t\tdisplay: inline-block;\r\n\t\tline-height: 9px;\r\n\t\theight: 9px;\r\n\t}\r\n\t.input-number-field-arrow .input-number-arrow.input-number-add:before{\r\n\t\tcontent: \"\";\r\n\t    display: inline-block;\r\n\t    border-bottom: 4px solid #505050;\r\n\t    width: 8px;\r\n\t    height: 8px;\r\n\t    border-top: 4px solid transparent;\r\n\t    border-left: 4px solid transparent;\r\n\t    border-right: 4px solid transparent;\r\n\t    margin: 0px 0px 3px 0px;\r\n\t}\r\n\t.input-number-field-arrow .input-number-arrow.input-number-sub:before{\r\n\t\tcontent: \"\";\r\n\t    display: inline-block;\r\n\t    border-top: 4px solid #505050;\r\n\t    width: 8px;\r\n\t    height: 8px;\r\n\t    border-bottom: 4px solid transparent;\r\n\t    border-left: 4px solid transparent;\r\n\t    border-right: 4px solid transparent;\r\n\t    margin: 3px 0px 0px 0px;\r\n\t}\r\n\t\r\n</style>\r\n</div>\r\n\r\n","views/vdi/common/ui-web-upload.html":"<form action=\"javascript:\" enctype=\"multipart/form-data\" method=\"POST\">\r\n\t<input name=\"iso\" type=\"file\" style=\"display:none\">\r\n\t<button type=\"button\" ng-disabled=\"!disableTest || isUploading\" class=\"btn btn-primary\"><i class=\"icon icon-jj-Upload\"></i> {{btnName}}</button>\r\n</form>\r\n<div class=\"upload-progress\" ng-show=\"isUploading\">\r\n\t<!-- 百分比 -->\r\n\t<span class=\"progress-percent\">{{progressPercent}}</span>\r\n\t<!-- 进度条 -->\r\n\t<div class=\"progress progress-xs\">\r\n\t\t<div class=\"progress-bar bg-color-blue\" role=\"progressbar\" ng-style=\"{'width':progressPercent}\"></div>\r\n\t</div>\r\n\t<div class=\"upload-mess\">\r\n\t\t<div class=\"progress-word\">{{progressName}}{{progressSize}}</div>\r\n\t</div>\r\n\t<!-- 关闭按钮 -->\r\n\t<span class=\"upload-cancel-icon icon  icon-jj-close-2\" id=\"abortBtn\"></span>\r\n</div>","views/vdi/common/ui-web-upload2.html":"<form action=\"javascript:\" enctype=\"multipart/form-data\" method=\"POST\" class=\"left\">\r\n\t<input name=\"iso\" type=\"file\" style=\"display:none\">\r\n\t<button type=\"button\" ng-disabled=\"isUploading\" class=\"btn btn-xs btn-default\" title=\"{{btnName}}\"><i class=\"icon icon-jj-Upload\"></i></button>\r\n</form>\r\n<div class=\"upload-progress left\" ng-show=\"isUploading\">\r\n\t<span class=\"upload-cancel-icon icon  icon-jj-close-2\" id=\"abortBtn\"></span>\r\n\t<div class=\"upload-mess\"><span class=\"progress-word\">{{progressName}}{{progressSize}}</span><span class=\"progress-percent\">{{progressPercent}}</span></div>\r\n\t<div class=\"progress progress-xs\"><div class=\"progress-bar bg-color-blue\" role=\"progressbar\" ng-style=\"{'width':progressPercent}\"></div></div>\r\n</div>","views/vdi/desktop/personal.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-sm-12\">\r\n\t\t\t\t\t\t<span data-localize=\"选择用户\"></span>：&nbsp;&nbsp;\r\n                        <span class=\"myselectDepart\" data-ng-click='selectMode()' title=\"{{ depart.name }}\">{{ depart.name }}</span>&nbsp;&nbsp;&nbsp;&nbsp;\r\n\r\n\t\t\t\t\t\t<span localize=\"运行状态\">运行状态</span>：<select class=\"selectclassroomName filter\" ng-disabled='loading' ng-change=\"updateData(searchText,select,depart)\" ng-model=\"select\" >\r\n\t\t\t\t\t\t\t<option value=\"\" localize=\"全部状态\">全部</option>\r\n\t\t\t\t\t\t\t<option value=\"running\" localize=\"开机状态\">开机</option>\r\n\t\t\t\t\t\t\t<option value=\"shutdown\" localize=\"关机状态\">关机</option>\r\n\t\t\t\t\t\t\t<option value=\"paused\" localize=\"挂起状态\">挂起</option>\r\n\t\t\t\t\t\t\t<option value=\"nostate\" localize=\"未知\">未知</option>\r\n\t\t\t\t\t\t\t<option value=\"error\" localize=\"错误状态\">错误</option>\r\n\t\t\t\t\t\t\t<option value=\"other\" localize=\"其他\">其他</option>\r\n\t\t\t\t\t\t</select>&nbsp;&nbsp;&nbsp;&nbsp;\r\n<!-- \t\t\t\t\t\t<span class=\"totalmess ng-binding\" localize=\"DESKTOP_TOTAL_MESS\"\r\n\t\t\t\t\t\t param1=\"{{(rows | filter:searchText | filter:{status:select}).length + (rows | filter:searchText | filter:{other_status:'other'}).length}}\"\r\n\t\t\t\t\t\t param2=\"{{(rows | filter:searchText | filter:{status:select} | filter:{status:'running'}).length }}\"\r\n\t\t\t\t\t\t param3=\"{{(rows | filter:searchText | filter:{status:select} | filter:{status:'shutdown'}).length }}\"\r\n\t\t\t\t\t\t param4=\"{{(rows | filter:searchText | filter:{status:select} | filter:{status:'paused'}).length }}\"\r\n\t\t\t\t\t\t param5=\"{{(rows | filter:searchText | filter:{status:select} | filter:{status:'nostate'}).length }}\"\r\n\t\t\t\t\t\t param6=\"{{(rows | filter:searchText | filter:{status:select} | filter:{status:'error'}).length }}\"\r\n\t\t\t\t\t\t param7=\"{{(rows | filter:searchText | filter:{other_status:'other'}).length }}\"></span> -->\r\n\t\t\t\t\t\t<span ng-if=\"select\" class=\"ng-binding\" localize=\"DESKTOP_TOTAL_MESS\"\r\n\t\t\t\t\t\t\tparam1=\"{{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{other_status:'certain'}).length + (rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length}}\"></span>\r\n\t\t\t\t\t\t<span ng-if=\"!select\" class=\"ng-binding\" localize=\"DESKTOP_TOTAL_MESS\"\r\n\t\t\t\t\t\t\tparam1=\"{{ (rows  | paging:currentPage:pagesize | filter:searchText | filter:{status:select}).length }}\"></span>\r\n\t\t\t\t\t\t <span class='desktopStatistic' ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{other_status:'certain'}).length + (rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length\">\r\n\t\t\t\t\t\t \t<span localize='桌面统计的其中'></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'running'} | filter:{other_status:'certain'}).length\"><span class=\"status16 running\" localize-title=\"开机状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'running'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'shutdown'} | filter:{other_status:'certain'}).length\"><span class=\"status16 shutdown\" localize-title=\"关机状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'shutdown'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'error'} | filter:{other_status:'certain'}).length\"><span class=\"status16 error\" localize-title=\"错误状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'error'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'paused'} | filter:{other_status:'certain'}).length\"><span class=\"status16 paused\" localize-title=\"挂起状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'paused'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'nostate'} | filter:{other_status:'certain'}).length\"><span class=\"status16 nostate\" localize-title=\"未知\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'nostate'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length\"><span class=\"status16 other\" localize-title=\"其他\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t </span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-8 col-sm-8\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" href=\"javascript:\" data-dialog=\"newPersonDialog\" data-dialog-url=\"desktop/personal_new.html\" data-dialog-size=\"md\"><i class=\"fa  icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"start()\" href=\"javascript:\"><i class=\"fa icon-jj-boot\"></i>&nbsp;<span localize=\"开机\">开机</span></a>\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-primary dropdown-toggle isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-shutdown\"></i>&nbsp;<span localize=\"关机\">关机</span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"forceShutdown()\" href=\"javascript:\" ><span localize=\"强制关机\">强制关机</span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"natureShutdown()\" href=\"javascript:\"><span localize=\"自然关机\">自然关机</span></a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restart()\" href=\"javascript:\"><i class=\"fa  icon-jj-Restart\"></i>&nbsp;<span localize=\"重启\">重启</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"pause()\" href=\"javascript:\"><i class=\"fa icon-jj-pause\"></i>&nbsp;<span localize=\"挂起状态\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"resume()\" href=\"javascript:\"><i class=\"fa  icon-jj-Recovery\"></i>&nbsp;<span localize=\"唤醒\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne() || moveto_loading}\" data-ng-click=\"moveto()\" href=\"javascript:\"><i class=\"fa icon-jj-move-1\"></i>&nbsp;<span localize=\"移动至\">移动至</span>&nbsp;<img ng-if=\"moveto_loading\" style=\"position: relative;bottom: 2px\" width=\"14px\" height=\"14px\" ng-src=\"img/HLloading.gif\"></a>\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-primary dropdown-toggle isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-people\"></i>&nbsp;<span localize=\"域\">域</span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"openAddDomainDialog()\" href=\"javascript:\" ><span localize=\"加域\">加域</span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"personExitDomain()\" href=\"javascript:\"><span localize=\"退域\">退域</span></a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne() || hasPausedStatus()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-4 col-sm-4\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" max=\"100\" placeholder=\"1-100\" type=\"number\" class=\"mysmallinput\" data-ng-model=\"pagesize\" ng-change=\"pageSizeChange()\" input-number><span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\"  class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select,depart)\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table\r\n\t\t\t\t\t\t\t\tclass=\"table table-vertical-center table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"desktopSort\" ng-click=\"desktopSort = !desktopSort;sort('display_name', desktopSort)\" localize=\"桌面名\">桌面</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"runStatus\" ng-click=\"runStatus = !runStatus;sort('status', runStatus)\"  localize=\"运行状态\">运行状态</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><span localize=\"桌面\"></span>IP/MAC</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"user\" ng-click=\"user = !user;sort('user', user)\" localize=\"用户组/用户/姓名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"OS/模板\">OS/模板</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"CPU/内存/数据盘\">CPU/内存/数据盘</th>\r\n\r\n                                            <th><span localize=\"资源池\"></span>/<span localize=\"宿主机\"></span></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"登录终端名/IP\">登录终端名/IP</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr ng-class=\"{'disabled':item.status === 'updating'}\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-ng-repeat-start=\"item in rows | filter:searchText | paging:currentPage:pagesize track by item.id\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-contextmenu\r\n\t\t\t\t\t\t\t\t\t\t\tdata-id=\"{{ item.id }}\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" type=\"checkbox\" ng-click=\"select_network(item,$index);\" name=\"checkbox-inline\"><i></i></label></td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{item.instance_id}}\">{{ item.display_name }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.usb_redir || item.usb3_redir\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"fa icon-jj-usb flag-icon\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.mark_ha\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"fa icon-jj-HA flag-icon\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.gpu_type == 'share'\" data-localize-title=\"显卡共享\"><span class=\"fa icon-jj-025 flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.gpu_type == 'through'\" data-localize-title=\"显卡直通\"><span class=\"fa icon-jj-026 flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.status === 'updating'\" data-localize=\"正在更新\"></p>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<td><span ng-if=\"item.status=='running' && !item.task_state\" localize-title=\"开机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='shutdown' && !item.task_state\" localize-title=\"关机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='paused' && !item.task_state\" localize-title=\"挂起状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='nostate' && !item.task_state\" localize-title=\"未知状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"(item.status=='error' && !item.task_state) || (item.status=='crashed' && !item.task_state)\" localize-title=\"错误状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.task_state\" title=\"{{ item.tips }}\" class=\"status32 building\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.running_time }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><p>{{ item.ips }}</p><p>{{ item.mac }}</p></td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p style=\"max-width: 200px;margin: auto;\" class='text-overflow' title=\"{{ item.user_group }}\">{{ item.user_group }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p style=\"max-width: 200px;margin: auto;\" class='text-overflow' title=\"{{ item.user }}\">{{ item.user }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p style=\"max-width: 200px;margin: auto;\" class='text-overflow' title=\"{{ item.real_name }}\">{{ item.real_name }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><p><span class=\"status32\"><img ng-src=\"img/{{ item.icon || 'win7.png' }}\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.system }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.image_name }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.vcpu }} <span localize='核'></span> / {{item.memory_mb/1024 }}GB / {{ item.local_gb }}GB</td>\r\n\r\n                                            <td>\r\n                                            \t<p>{{item.resource_pool_name}}</p>\r\n                                            \t<p>{{item.hostname}}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td data-ng-if=\"linkTerminal && inCurrentUserPool(item.client_pool)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#/terminal/client?client_pool={{ item.client_pool }}&ip={{item.client_ip}}\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.client_name }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.client_ip }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</a></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td data-ng-if=\"!linkTerminal || !inCurrentUserPool(item.client_pool)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.client_name }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.client_ip }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\"  data-ng-click=\"view(item)\" localize-title=\"查看桌面\" ng-disabled=\"item.status!=='running'\"><i class=\"fa icon-jj-look\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"loading_detail\" class=\"btn btn-xs btn-default\" ng-show=\"!item._expand\"  data-ng-click=\"expand(item)\" localize-title=\"更多详情\"><i class=\"fa icon-jj-014\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"loading_detail\" class=\"btn btn-xs btn-default\" ng-show=\"item._expand\" data-ng-click=\"expand(item)\" ><i class=\"fa icon-jj-015\"></i></button></td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr ng-show=\"item._expand\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"11\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<table class=\"vtop-table\" ng-show=\"!loading_detail\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"vdi_expend-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label localize=\"网络\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group clearfix\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-3 text-right\"  localize=\"网络\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-9 margin-b-5\">{{item.detailData.network.name}}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-3 text-right\"  localize=\"子网\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-9\" ng-show=\"item.detailData.subnet_name\"><p class=\"margin-b-5\" >{{item.detailData.subnet_name}}({{item.detailData.allocation_pools[0].start}} ~ {{item.detailData.allocation_pools[0].end}})</p></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-9\" ng-show=\"!item.detailData.subnet_name\"><p  class=\"margin-b-5\" localize=\"不分配\"></p></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td style=\"width:30%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"vdi_expend-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label localize=\"还原设置\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group clearfix\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-3 text-right\"  localize=\"系统盘\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-9 margin-b-5\">{{item.detailData.rollback_desc}}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label ng-show=\"item.detailData.data_rollback!==null\" class=\"col-sm-3 text-right\"  localize=\"数据盘\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div ng-show=\"item.detailData.data_rollback!==null\" class=\"col-sm-9\"><p  class=\"margin-b-5\">{{item.detailData.data_rollback_desc}}</p></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td style=\"width:22%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"vdi_expend-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label style=\"width: 41%;\" localize=\"域\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group clearfix\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-5 text-right\"  localize=\"拟加入域\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-5 margin-b-5\" ng-show=\"item.detailData.ad_server_name\">{{item.detailData.ad_server_name}}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-5 margin-b-5\" ng-show=\"!item.detailData.ad_server_name\" localize=\"无\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"vdi_expend-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label data-localize=\"系统盘镜像\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group clearfix\" ng-repeat=\"(key,ids) in item.detailData.inst_volumes.system_image_base track by key\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-3 text-right\"  localize=\"位置\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-9 margin-b-5\">{{key}}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div ng-show=\"getObjLength(item.detailData.inst_volumes.system_image_base)==0\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-3 text-right\"  localize=\"无\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"vdi_expend-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label data-localize=\"系统盘\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group clearfix\" ng-repeat=\"(key,ids) in item.detailData.inst_volumes.system_image track by key\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-3 text-right\"  localize=\"位置\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-9 margin-b-5\">{{key}}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div ng-show=\"getObjLength(item.detailData.inst_volumes.system_image)==0\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-3 text-right\"  localize=\"无\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"vdi_expend-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label style=\"width: 41%;\" data-localize=\"数据盘\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group clearfix\" ng-repeat=\"(key,ids) in item.detailData.inst_volumes.data_image track by key\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-5 text-right\"  localize=\"位置\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-sm-5 margin-b-5\">{{key}}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div ng-show=\"getObjLength(item.detailData.inst_volumes.data_image)==0\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-5 text-right\"  localize=\"无\"></label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div ng-if=\"loading_detail\" style=\"min-height: 200px\"><img ng-src=\"img/HLloading.gif\"  height=\"32\" width=\"32\" alt=\"\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat-end></tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"(currentItem.status!=='shutdown' && currentItem.status!=='suspended') || currentItem.task_state\"  data-ng-click=\"start(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"开机\">开机</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.status!=='running' && currentItem.status!=='suspended'\"><a class=\"menu_label\" href=\"javascript:\" ><span localize=\"关机\">关机</span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"forceShutdown(currentItem)\" ng-disabled=\"(currentItem.status!=='running' && currentItem.status!=='suspended') || currentItem.task_state\" ><a class=\"menu_label\" href=\"javascript:\" localize=\"强制关机\">强制关机</a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"natureShutdown(currentItem)\" ng-disabled=\"(currentItem.status!=='running' && currentItem.status!=='suspended') || currentItem.task_state\" ><a class=\"menu_label\" href=\"javascript:\" localize=\"自然关机\">自然关机</a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"restart(currentItem)\"  ng-disabled=\"(currentItem.status!=='running' && currentItem.status!=='suspended') || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\" localize=\"重启\">重启</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"pause(currentItem)\" ng-disabled=\"currentItem.status!=='running' || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"挂起状态\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"resume(currentItem)\" ng-disabled=\"currentItem.status!=='paused' || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"唤醒\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"delete(currentItem)\" ng-disabled=\"currentItem.status=='paused'\"><a class=\"menu_label\" href=\"javascript:\" localize=\"删除\">删除</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-model=\"currentItem\" data-dialog=\"alterPersonalDialog\" data-dialog-size=\"md\" data-dialog-url=\"desktop/personal_alter.html\" data-error=\"关机状态才可进行桌面修改！\"  ng-disabled=\"currentItem.status!=='shutdown' || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"桌面修改\">桌面修改</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-model=\"currentItem\"  data-dialog=\"saveTemplatePersonalDialog\" data-dialog-size=\"md\" data-dialog-url=\"desktop/personal_save_template.html\" ng-disabled=\"currentItem.status!=='shutdown' || currentItem.task_state\" data-error=\"关机状态才可执行存为模板操作！\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"COPY_TEM\">另存为模板</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-show=\"currentItem.virtual_type === 'kvm'\" ng-disabled=\"currentItem.status!=='running' || currentItem.task_state || currentItem.enable_gpu\" data-ng-click=\"migration(currentItem)\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"动态迁移\">动态迁移</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-show=\"currentItem.virtual_type === 'kvm'\" ng-disabled=\"currentItem.status!=='shutdown' || currentItem.task_state\" data-ng-click=\"moveto(currentItem)\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"移动至\">移动至</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.status!=='shutdown' || currentItem.task_state\" data-ng-model=\"currentItem\" data-dialog=\"snapshotPersonalDialog\" data-dialog-size=\"md\" data-dialog-url=\"desktop/personal_snapshot.html\"><a class=\"menu_label\" href=\"javascript:\" localize=\"快照管理\">快照管理</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"!currentItem.is_domain_user || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\"><span localize=\"域\">域</span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.ad_server_name || !currentItem.is_domain_user || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\" ng-click=\"openAddDomainDialog(currentItem)\" localize=\"加域\" >加域</a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"!currentItem.ad_server_name || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\" ng-click=\"personExitDomain(currentItem)\" localize=\"退域\">退域</a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n","views/vdi/desktop/pool.html":"<section>\r\n    <div class=\"row\">\r\n        <article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n            <div class=\"jarviswidget\" data-widget-grid>\r\n                <div class=\"noborder\">\r\n                    <div class=\"jarviswidget-editbox\"></div>\r\n                    <div class=\"widget-body no-padding\">\r\n                        <div class=\"dt-toolbar\">\r\n                            <div class=\"left_side left-btn-group col-xs-6 col-sm-6\">\r\n                                <a class=\"btn btn-xs btn-primary\" href=\"javascript:\"  data-dialog=\"newDeskPoolDialog\" data-dialog-url=\"desktop/newDeskPool.html\" data-dialog-size=\"md\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></a>\r\n                                <a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"start()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa icon-jj-boot\"></i>&nbsp;<span localize=\"桌面池开机\"></span></a>\r\n                                <div class=\"btn-group\">\r\n                                    <button class=\"btn btn-xs btn-primary dropdown-toggle isBatch\" data-toggle=\"dropdown\" data-ng-class=\"{disabled:!checkOne()}\"> <i class=\"fa icon-jj-shutdown\"></i>&nbsp;<span localize=\"桌面池关机\"></span> <span class=\"caret\"></span></button>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <li><a class=\"isBatch\" data-ng-click=\"forceShutdown()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa\"></i><span localize=\"强制关机\">强制关机</span></a></li>\r\n                                        <li class=\"divider\"></li>\r\n                                        <li><a class=\"isBatch\" data-ng-click=\"natureShutdown()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa\"></i><span localize=\"自然关机\">自然关机</span></a></li>\r\n                                    </ul>\r\n                                </div>\r\n                                <a class=\"btn btn-xs btn-danger isBatch\" data-ng-click=\"delete()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa  icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n                            </div>\r\n                            <div class=\"right_side col-xs-6 col-sm-6\">\r\n                                <div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"30\" class=\"mysmallinput\" type=\"number\" ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\" data-ng-options=\"pagesize for pagesize in pagesizes\" input-number><span localize=\"项结果\"></span> </div>\r\n                                <div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"table-responsive\">\r\n                            <table data-vdi-grid\r\n                                class=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n                                width=\"100%\">\r\n                                <thead class=\"vdi_header\">\r\n                                    <tr>\r\n                                        <th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\r\n                                        <th ng-model=\"poolNameSort\" ng-click=\"poolNameSort = !poolNameSort;sort('pool_name', poolNameSort)\" localize=\"名称\"></th>\r\n                                        <th localize=\"所属用户组\" ng-model=\"groupNameSort\" ng-click=\"groupNameSort = !groupNameSort;sort('user_group_name',groupNameSort) \"></th>\r\n                                        <th ng-model=\"resourcePoolNameSort\" ng-click=\"resourcePoolNameSort = !resourcePoolNameSort;sort('resource_pool_name', resourcePoolNameSort)\" localize=\"资源池\"></th>\r\n                                        <th localize=\"在线/桌面数\"></th>\r\n                                        <th localize=\"桌面模板\"></th>\r\n                                        <th localize=\"硬件模板\"></th>\r\n                                        <th localize=\"还原属性\"></th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody class=\"vdi_body\">\r\n                                    <tr ng-class=\"{'disabled':item.status === 'making' || item.status === 'updating' || item.status === 'setting-recoverable'}\" data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize track by $index\"\r\n                                        data-contextmenu\r\n                                        data-id=\"{{ item.id }}\">\r\n                                        <td class=\"selectable\">\r\n                                            <label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label> </td>\r\n                                        <td>\r\n                                            <a href=\"#/desktop/poolList/{{item.id}}\">{{ item.pool_name }}</a>\r\n                                            <p ng-if=\"item.status === 'setting-recoverable'\" data-localize=\"正在设置还原\"></p>\r\n                                        </td>\r\n                                        <td>{{ item.user_group_name }}</td>\r\n                                        <td>{{ item.resource_pool_name }}</td>\r\n                                        <td>{{ item.online_count }} / {{ item.total_count }} </td>\r\n                                        <td>{{ item.image_name }}</td>\r\n                                        <td>{{ item.instance_type_name }}</td>\r\n                                        <td>\r\n                                            <p><span localize=\"系统盘\" class=\"text-right td-inside-laout\"></span><span class=\"text-left td-inside-laout\">{{item.rollback_desc}}</span></p>\r\n                                            <p ng-show=\"item.data_rollback!==null\"><span localize=\"数据盘\" class=\"text-right td-inside-laout\"></span><span class=\"text-left td-inside-laout\">{{item.data_rollback_desc}}</span></p>\r\n                                        </td>\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                        <div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n                        <div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n                        <div data-ng-include=\"'includes/pagination.html'\"></div>\r\n                    </div>\r\n                </div>\r\n                <section class=\"context_wrapper\">\r\n                    <div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n                        <ul class=\"menu_item_list\">\r\n                            <li class=\"menu_item\" ng-disabled=\"currentItem.online_count > 0\" data-dialog=\"editPoolDialog\" data-dialog-url=\"desktop/pool_alter.html\" data-dialog-size=\"md\"><a class=\"menu_label\" href=\"javascript:\" localize=\"修改桌面池\"></a></li>\r\n                        </ul>\r\n                    </div>\r\n                </section>\r\n            </div>\r\n        </article>\r\n    </div>\r\n</section>\r\n","views/vdi/desktop/poolList.html":"<section id=\"widget-grid\">\r\n    <div class=\"row\">\r\n        <article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n            <div data-widget-grid class=\"jarviswidget\">\r\n                <div class=\"noborder\">\r\n                    <div class=\"widget-body no-padding\">\r\n                        <section class=\"dt-toolbar\">\r\n                            <div class=\"left_side left-btn-group col-xs-6 col-sm-6\">\r\n                                <a class=\"btn btn-xs btn-primary\"  href=\"#/desktop/pool\"><i class=\" icon-jj-recovery fa\"></i>  &nbsp;<span  localize=\"返回\"></span></a>\r\n                                <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"start()\" href=\"javascript:\"><i class=\"fa icon-jj-boot\"></i>&nbsp;<span localize=\"开机\"></span></a>\r\n                                <div class=\"btn-group\">\r\n                                    <button class=\"btn btn-xs btn-primary dropdown-toggle isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-shutdown\"></i>&nbsp;<span localize=\"关机\"></span> <span class=\"caret\"></span></button>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <li><a class=\"isBatch\" data-ng-click=\"forceShutdown()\" href=\"javascript:\" ><span localize=\"强制关机\"></span></a></li>\r\n                                        <li class=\"divider\"></li>\r\n                                        <li><a class=\"isBatch\" data-ng-click=\"natureShutdown()\" href=\"javascript:\"><span localize=\"自然关机\"></span></a></li>\r\n                                    </ul>\r\n                                </div>\r\n                                <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restart()\" href=\"javascript:\"><i class=\"fa  icon-jj-Restart\"></i>&nbsp;<span localize=\"重启\"></span></a>\r\n                                <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"pause()\" href=\"javascript:\"><i class=\"fa icon-jj-pause\"></i>&nbsp;<span localize=\"挂起状态\"></span></a>\r\n                                <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"resume()\" href=\"javascript:\"><i class=\"fa  icon-jj-Recovery\"></i>&nbsp;<span localize=\"唤醒\"></span></a>\r\n                            </div>\r\n                            <div class=\"right_side col-xs-6 col-sm-6\">\r\n                                <div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" data-ng-model=\"pagesize\" ng-change=\"pageSizeChange()\" input-number><span localize=\"项结果\"></span> </div>\r\n                                <div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\"  class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n                            </div>\r\n                        </section>\r\n                        <div class=\"table-responsive\">\r\n                            <table\r\n                                class=\"table table-vertical-center table-striped table-condensed table-hover smart-form has-tickbox\"\r\n                                width=\"100%\">\r\n                                    <thead class=\"vdi_header\">\r\n                                        <tr>\r\n                                            <th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n                                            <th ng-model=\"desktopSort\" ng-click=\"desktopSort = !desktopSort;sortDesktopName('display_name', desktopSort)\" localize=\"桌面名\"></th>\r\n                                            <th ng-model=\"runStatus\" ng-click=\"runStatus = !runStatus;sort('status', runStatus)\"  localize=\"运行状态\"></th>\r\n                                            <th localize=\"桌面IP/MAC\"></th>\r\n                                            <th><span localize=\"资源池\"></span>/<span localize=\"宿主机\"></span></th>\r\n                                            <th localize=\"登录终端名/IP\"></th>\r\n                                            <th localize=\"操作\"></th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody class=\"vdi_body\">\r\n                                        <tr ng-class=\"{'disabled':item.status === 'updating'}\"\r\n                                            data-ng-repeat-start=\"item in rows | filter:searchText | paging:currentPage:pagesize track by item.id\"\r\n                                            data-id=\"{{ item.id }}\">\r\n                                            <td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" type=\"checkbox\" ng-click=\"select_network(item,$index);\" name=\"checkbox-inline\"><i></i></label></td>\r\n                                            <td>    \r\n                                                <p title=\"{{item.instance_id}}\">{{ item.display_name }}</p>\r\n                                                <p ng-if=\"item.usb_redir || item.usb3_redir\">\r\n                                                    <span class=\"fa icon-jj-usb flag-icon\"></span>\r\n                                                </p>\r\n                                                <p ng-if=\"item.mark_ha\">\r\n                                                    <span class=\"fa icon-jj-HA flag-icon\"></span>\r\n                                                </p>\r\n                                                <p ng-if=\"item.gpu_type == 'share'\" data-localize-title=\"显卡共享\"><span class=\"fa icon-jj-025 flag-icon\"></span></p>\r\n                                                <p ng-if=\"item.gpu_type == 'through'\" data-localize-title=\"显卡直通\"><span class=\"fa icon-jj-026 flag-icon\"></span></p>\r\n                                                <p ng-if=\"item.status === 'updating'\" data-localize=\"正在更新\"></p>\r\n                                            </td>\r\n                                            <td><span ng-if=\"item.status=='running' && !item.task_state\" localize-title=\"开机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='shutdown' && !item.task_state\" localize-title=\"关机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='paused' && !item.task_state\" localize-title=\"挂起状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='nostate' && !item.task_state\" localize-title=\"未知状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"(item.status=='error' && !item.task_state) || (item.status=='crashed' && !item.task_state)\" localize-title=\"错误状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.task_state\" title=\"{{ item.tips }}\" class=\"status32 building\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.running_time }}</p></td>\r\n                                            <td><p>{{ item.ips }}</p><p>{{ item.mac }}</p></td>\r\n                                            <td>\r\n                                                <p>{{item.resource_pool_name}}</p>\r\n                                                <p>{{item.hostname}}</p>\r\n                                            </td>\r\n                                            <td data-ng-if=\"linkTerminal && inCurrentUserPool(item.client_pool)\">\r\n                                                <a href=\"#/terminal/client?client_pool={{ item.client_pool }}&ip={{item.client_ip}}\">\r\n                                                    <p>{{ item.client_name }}</p>\r\n                                                    <p>{{ item.client_ip }}</p>\r\n                                                </a></td>\r\n                                            <td data-ng-if=\"!linkTerminal || !inCurrentUserPool(item.client_pool)\">\r\n                                                <p>{{ item.client_name }}</p>\r\n                                                <p>{{ item.client_ip }}</p></td>\r\n                                            <td>\r\n                                                <button class=\"btn btn-xs btn-default\"  data-ng-click=\"view(item)\" localize-title=\"查看桌面\" ng-disabled=\"item.status!=='running'\"><i class=\"fa icon-jj-look\"></i></button>\r\n                                                <button ng-disabled=\"loading_detail\" class=\"btn btn-xs btn-default\" ng-show=\"!item._expand\"  data-ng-click=\"expand(item)\" localize-title=\"更多详情\"><i class=\"fa icon-jj-014\"></i></button>\r\n                                                <button ng-disabled=\"loading_detail\" class=\"btn btn-xs btn-default\" ng-show=\"item._expand\" data-ng-click=\"expand(item)\" ><i class=\"fa icon-jj-015\"></i></button>\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr ng-show=\"item._expand\">\r\n                                            <td colspan=\"11\">\r\n                                                <table class=\"vtop-table\" ng-show=\"!loading_detail\">\r\n                                                    <tbody>\r\n                                                        <tr>\r\n                                                            <td>\r\n                                                                <div class=\"vdi_expend-wrap\">\r\n                                                                    <label localize=\"网络\"></label>\r\n                                                                    <div class=\"form-group clearfix\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"网络\"></label>\r\n                                                                        <div class=\"col-sm-9 margin-b-5\">{{item.detailData.network.name}}</div>\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"子网\"></label>\r\n                                                                        <div class=\"col-sm-9\" ng-show=\"item.detailData.subnet_name\"><p class=\"margin-b-5\" >{{item.detailData.subnet_name}}({{item.detailData.allocation_pools[0].start}} ~ {{item.detailData.allocation_pools[0].end}})</p></div>\r\n                                                                        <div class=\"col-sm-9\" ng-show=\"!item.detailData.subnet_name\"><p  class=\"margin-b-5\" localize=\"不分配\"></p></div>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                            <td style=\"width:28%\">\r\n                                                                <div class=\"vdi_expend-wrap\">\r\n                                                                    <label localize=\"还原设置\"></label>\r\n                                                                    <div class=\"form-group clearfix\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"系统盘\"></label>\r\n                                                                        <div class=\"col-sm-9 margin-b-5\">{{item.detailData.rollback_desc}}</div>\r\n                                                                        <label ng-show=\"item.detailData.data_rollback!==null\" class=\"col-sm-3 text-right\"  localize=\"数据盘\"></label>\r\n                                                                        <div ng-show=\"item.detailData.data_rollback!==null\" class=\"col-sm-9\"><p  class=\"margin-b-5\">{{item.detailData.data_rollback_desc}}</p></div>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                        <tr>\r\n                                                            <td>\r\n                                                                <div class=\"vdi_expend-wrap\">\r\n                                                                    <label data-localize=\"系统盘镜像\"></label>\r\n                                                                    <div class=\"form-group clearfix\" ng-repeat=\"(key,ids) in item.detailData.inst_volumes.system_image_base track by key\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"位置\"></label>\r\n                                                                        <div class=\"col-sm-9 margin-b-5\">{{key}}</div>\r\n                                                                    </div>\r\n                                                                    <div ng-show=\"getObjLength(item.detailData.inst_volumes.system_image_base)==0\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"无\"></label>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                            <td>\r\n                                                                <div class=\"vdi_expend-wrap\">\r\n                                                                    <label data-localize=\"系统盘\"></label>\r\n                                                                    <div class=\"form-group clearfix\" ng-repeat=\"(key,ids) in item.detailData.inst_volumes.system_image track by key\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"位置\"></label>\r\n                                                                        <div class=\"col-sm-9 margin-b-5\">{{key}}</div>\r\n                                                                    </div>\r\n                                                                    <div ng-show=\"getObjLength(item.detailData.inst_volumes.system_image)==0\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"无\"></label>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                            <td style=\"width: 20%;\">\r\n                                                                <div class=\"vdi_expend-wrap\">\r\n                                                                    <label data-localize=\"数据盘\"></label>\r\n                                                                    <div class=\"form-group clearfix\" ng-repeat=\"(key,ids) in item.detailData.inst_volumes.data_image track by key\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"位置\"></label>\r\n                                                                        <div class=\"col-sm-9 margin-b-5\">{{key}}</div>\r\n                                                                    </div>\r\n                                                                    <div ng-show=\"getObjLength(item.detailData.inst_volumes.data_image)==0\">\r\n                                                                        <label class=\"col-sm-3 text-right\"  localize=\"无\"></label>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </tbody>\r\n                                                </table>\r\n                                                <div ng-if=\"loading_detail\" style=\"min-height: 200px\"><img ng-src=\"img/HLloading.gif\"  height=\"32\" width=\"32\" alt=\"\"></div>\r\n                                            </td>\r\n                                        </tr>\r\n                                        <tr data-ng-repeat-end></tr>\r\n                                    </tbody>\r\n                            </table>\r\n                        </div>\r\n                        <div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n                        <div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n                        <div data-ng-include=\"'includes/pagination.html'\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </article>\r\n    </div>\r\n</section>\r\n\r\n","views/vdi/desktop/scene.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div class=\"jarviswidget\" data-widget-grid>\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-xs-12\" style=\"padding-left: 8px;\">\r\n\t\t\t\t\t\t<span data-localize=\"选择教室\"></span>&nbsp;&nbsp;\r\n\t\t\t\t\t\t<select class=\"selectclassroomName filter\" ng-model=\"select\" ng-change=\"updateData(searchText,select);cacheValue(select)\" ng-disabled=\"selectLoading\" data-ng-options=\"item.id as item.name for item in classrooms\">\r\n\t\t\t\t\t\t\t<option localize=\"所有教室\" value=''>所有教室</option>\r\n\t\t\t\t\t\t</select>&nbsp;&nbsp;<img ng-src=\"img/loadingtext.gif\" ng-if=\"selectLoading\" height=\"12\" width=\"12\" alt=\"\" style=\"position: relative;bottom:4px\">&nbsp;&nbsp;&nbsp;&nbsp;\r\n\t\t\t\t\t\t<span class=\"ng-binding\" localize=\"DESKTOP_TOTAL_MESS\"\r\n\t\t\t\t\t\t\tparam1=\"{{ getTotalCount() }}\"></span>\r\n\t\t\t\t\t\t<span class='desktopStatistic' ng-if=\"getTotalCount()\">\r\n\t\t\t\t\t\t\t<span localize='桌面统计的其中'></span>\r\n\t\t\t\t\t\t\t<img ng-if=\"!getRunningCount() && !getShutdownCount() && !getErrorCount() && !getPausedCount() && !getNostateCount() && !getOtherCount()\" ng-src=\"img/HLloading.gif\" width=\"10\" height=\"10\">\r\n\t\t\t\t\t\t\t<span ng-if=\"getRunningCount()\"><span class=\"status16 running\" localize-title=\"开机状态\"></span> {{ getRunningCount() }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"getShutdownCount()\"><span class=\"status16 shutdown\" localize-title=\"关机状态\"></span> {{ getShutdownCount() }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"getErrorCount()\"><span class=\"status16 error\" localize-title=\"错误状态\"></span> {{ getErrorCount() }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"getPausedCount()\"><span class=\"status16 paused\" localize-title=\"挂起状态\"></span> {{ getPausedCount() }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"getNostateCount()\"><span class=\"status16 nostate\" localize-title=\"未知\"></span> {{ getNostateCount() }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"getOtherCount()\"><span class=\"status16 other\" localize-title=\"其他\"></span> {{ getOtherCount() }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\t\t\r\n\t\t\t\t</header>\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" href=\"javascript:\" ng-disabled=\"!classrooms.length\"  data-dialog=\"newSceneDialog\" data-dialog-url=\"desktop/scene_new.html\" data-dialog-size=\"md\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"start()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa icon-jj-boot\"></i>&nbsp;<span localize=\"场景桌面开机\">场景桌面开机</span></a>\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-primary dropdown-toggle isBatch\" data-toggle=\"dropdown\" data-ng-class=\"{disabled:!checkOne()}\"> <i class=\"fa icon-jj-shutdown\"></i>&nbsp;<span localize=\"场景桌面关机\">场景桌面关机</span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"forceShutdown()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa\"></i><span localize=\"强制关机\">强制关机</span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"natureShutdown()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa\"></i><span localize=\"自然关机\">自然关机</span></a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"sortScene()\" href=\"javascript:\" data-ng-class=\"{disabled:!select||!rows.length}\"><i class=\"fa icon-jj-all\"></i>&nbsp;<span localize=\"场景排序\">场景排序</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"restartScene()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa icon-jj-Restart\"></i>&nbsp;<span localize=\"场景桌面重启\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-click=\"delete()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa  icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" class=\"mysmallinput\" type=\"number\" ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\" data-ng-options=\"pagesize for pagesize in pagesizes\" input-number><span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"sceneNameSort\" ng-click=\"sceneNameSort = !sceneNameSort;sort('name', sceneNameSort)\" localize=\"场景名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"资源池\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"schoolroomSort\" ng-click=\"schoolroomSort = !schoolroomSort;sort('schoolroom', schoolroomSort)\" localize=\"所属教室\">所属教室</th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"schoolroomSort\" ng-click=\"schoolroomSort = !schoolroomSort;sort('active', schoolroomSort)\" localize=\"激活\">激活</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"在线/桌面数\">在线/桌面数</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"桌面模板\">桌面模板</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"硬件模板\">硬件模板</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"还原设置\">还原设置</th>\r\n\t\t\t\t\t\t\t\t\t\t<th >RDP</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"虚拟化类型\">虚拟化类型</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr style=\"height:100px;\" ng-class=\"{'disabled':item.status === 'making' || item.status === 'updating' || item.status === 'setting-recoverable'}\" data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize track by $index\"\r\n\t\t\t\t\t\t\t\t\t\tdata-contextmenu\r\n\t\t\t\t\t\t\t\t\t\tdata-id=\"{{ item.id }}\">\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox\"><input data-ng-model=\"item._selected\" ng-disabled=\"item.status=='making'\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label> </td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<div ng-if=\"item.status === 'making'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/HLloading.gif\" height=\"24\" width=\"24\" alt=\"\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p localize=\"场景创建中\">场景创建中</p>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div ng-if=\"item.status === 'updating'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/HLloading.gif\" height=\"24\" width=\"24\" alt=\"\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p localize=\"正在更新\"></p>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div ng-if=\"item.status === 'setting-recoverable'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/HLloading.gif\" height=\"24\" width=\"24\" alt=\"\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p localize=\"正在设置还原\"></p>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.status !== 'making' && item.status !== 'updating'  && item.status !== 'setting-recoverable'\"><a href=\"#/desktop/teach/{{item.id}}\" >{{ item.name }}</a></p>\r\n\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.usb_redir || item.usb3_redir\"><span class=\"fa  icon-jj-usb flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.mark_ha\"><span class=\"fa  icon-jj-HA flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.gpu_type == 'share'\" data-localize-title=\"显卡共享\"><span class=\"fa icon-jj-025 flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.gpu_type == 'through'\" data-localize-title=\"显卡直通\"><span class=\"fa icon-jj-026 flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.resource_pool_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.schoolroom }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"switch\" ng-show=\"!item.active_loadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"start_interval\" class=\"switch-checkbox\" id=\"start_interval{{$index}}\" ng-model=\"item.active\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"switch-label\" data-swchon-text=\"ON\" data-swchoff-text=\"OFF\" ng-click=\"active(item.id,$event)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/HLloading.gif\" ng-if=\"item.active_loadding\" height=\"24\" width=\"24\" alt=\"\">\r\n\t\t\t\t\t\t\t\t\t\t\t</div></td>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.running_count }} / {{ item.instances_count }} </td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.image_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.instance_type }}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<p><span localize=\"系统盘\" class=\"text-right td-inside-laout\">系统盘</span><span class=\"text-left td-inside-laout\">{{item.rollback_desc}}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t<p ng-show=\"item.data_rollback!==null\"><span localize=\"数据盘\" class=\"text-right td-inside-laout\">数据盘</span><span class=\"text-left td-inside-laout\">{{item.data_rollback_desc}}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.is_exam\" localize=\"是\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"!item.is_exam\" localize=\"否\"></span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{item.virtual_type}}</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-class=\"{disabled:currentItem.running_count==currentItem.instances_count}\" data-ng-click=\"start(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"场景桌面开机\">场景桌面开机</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-class=\"{disabled:currentItem.running_count==0}\"><a class=\"menu_label\"  href=\"javascript:\" ><span localize=\"场景桌面关机\">场景桌面关机</span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"forceShutdown(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"强制关机\">强制关机</a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"natureShutdown(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" onclick=\"return false;\" localize=\"自然关机\">自然关机</a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-class=\"{disabled:currentItem.running_count==0}\" data-ng-click=\"restartScene(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"场景桌面重启\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.active\"  data-ng-click=\"delete(currentItem)\"  ><a class=\"menu_label\" href=\"javascript:\" localize=\"删除\">删除</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.running_count > 0\" data-dialog=\"alterSceneDialog\" data-dialog-url=\"desktop/sence_alter.html\" data-dialog-size=\"md\"><a class=\"menu_label\" href=\"javascript:\" localize=\"修改场景\">修改场景</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\"><span localize=\"域\">域</span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.ad_server\"><a class=\"menu_label\" href=\"javascript:\" ng-click=\"openAddDomainDialog(currentItem)\" localize=\"加域\" >加域</a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"!currentItem.ad_server\"><a class=\"menu_label\" href=\"javascript:\" ng-click=\"sceneExitServerDialog(currentItem)\" localize=\"退域\">退域</a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n","views/vdi/desktop/teach.html":"<section>\r\n\t<!-- row -->\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<!-- Widget ID (each widget will need unique ID)-->\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-sm-9\">\r\n\t\t\t\t\t\t<span localize=\"运行状态\">运行状态</span>：<select class=\"selectclassroomName filter\" ng-disabled='loading' ng-change=\"updateData(searchText,select)\" ng-model=\"select\" >\r\n\t\t\t\t\t\t\t<option value=\"\" localize=\"全部状态\">全部</option>\r\n\t\t\t\t\t\t\t<option value=\"running\" localize=\"开机状态\">开机</option>\r\n\t\t\t\t\t\t\t<option value=\"shutdown\" localize=\"关机状态\">关机</option>\r\n\t\t\t\t\t\t\t<option value=\"paused\" localize=\"挂起状态\">挂起</option>\r\n\t\t\t\t\t\t\t<option value=\"nostate\" localize=\"未知\">未知</option>\r\n\t\t\t\t\t\t\t<option value=\"error\" localize=\"错误状态\">错误</option>\r\n\t\t\t\t\t\t\t<option value=\"other\" localize=\"其他\">其他</option>\r\n\t\t\t\t\t\t</select>&nbsp;&nbsp;&nbsp;&nbsp;\r\n\t\t\t\t\t\t<span ng-if=\"select\" class=\"ng-binding\" localize=\"DESKTOP_TOTAL_MESS\"\r\n\t\t\t\t\t\t\tparam1=\"{{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{other_status:'certain'}).length + (rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length}}\"></span>\r\n\t\t\t\t\t\t<span ng-if=\"!select\" class=\"ng-binding\" localize=\"DESKTOP_TOTAL_MESS\"\r\n\t\t\t\t\t\t\tparam1=\"{{ (rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select}).length }}\"></span>\r\n\t\t\t\t\t\t <span class='desktopStatistic' ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{other_status:'certain'}).length + (rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length\">\r\n\t\t\t\t\t\t \t<span localize='桌面统计的其中'></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'running'} | filter:{other_status:'certain'}).length\"><span class=\"status16 running\" localize-title=\"开机状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'running'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'shutdown'} | filter:{other_status:'certain'}).length\"><span class=\"status16 shutdown\" localize-title=\"关机状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'shutdown'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'error'} | filter:{other_status:'certain'}).length\"><span class=\"status16 error\" localize-title=\"错误状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'error'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'paused'} | filter:{other_status:'certain'}).length\"><span class=\"status16 paused\" localize-title=\"挂起状态\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'paused'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'nostate'} | filter:{other_status:'certain'}).length\"><span class=\"status16 nostate\" localize-title=\"未知\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{status:select} | filter:{status:'nostate'} | filter:{other_status:'certain'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t\t<span ng-if=\"(rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length\"><span class=\"status16 other\" localize-title=\"其他\"></span> {{(rows | paging:currentPage:pagesize | filter:searchText | filter:{other_status:'other'}).length }} <span localize=\"个\"></span><span class=\"dohao\">, </span></span>\r\n\t\t\t\t\t\t </span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-sm-3\">\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"dataTables_wrapper form-inline no-footer\">\r\n\t\t\t\t\t\t\t<!-- toolbar -->\r\n\t\t\t\t\t\t\t<div class=\"comment_mess\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"clearfix comment_mess_ul\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"pull-left comment_mess_i\"><label class=\"lable_name\"><span localize=\"场景名\">场景</span> :</label> {{res.mode_name}}</li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"pull-left comment_mess_i\"><label class=\"lable_name\"><span localize=\"操作系统\">操作系统</span> :</label> {{rows[0].system}}</li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"pull-left comment_mess_i\"><label class=\"lable_name\"><span localize=\"模板名\">模板</span> :</label> {{rows[0].image_name}}</li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"pull-left comment_mess_i\"><label class=\"lable_name\"><span localize=\"CPU/内存/数据盘\">CPU/内存/数据盘</span> :</label> \r\n\t\t\t\t\t\t\t\t\t\t\t{{rows[0] && rows[0].vcpu}}<span localize='核'>核</span>/ {{rows[0] && rows[0].memory_mb/1024}}GB / {{rows[0] && rows[0].local_gb}}GB</li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"pull-left comment_mess_i\"><label class=\"lable_name\"><span localize=\"网络\">网络</span> :</label>{{rows[0].network.name}} <span ng-if=\"rows[0].network.cidr\">( {{rows[0].network.dhcp_start}}-{{rows[0].network.dhcp_end}} ) </span></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"pull-left comment_mess_i\"><label class=\"lable_name\"><span localize=\"拟加入域\">拟加入域</span> :</label>{{res.ad_server_name}}</li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left-btn-group col-xs-8 col-sm-8\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\"  href=\"#/desktop/scene\"><i class=\" icon-jj-recovery fa\"></i>  &nbsp;<span  localize=\"返回\">返回</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"start()\" href=\"javascript:\"><i class=\"fa  icon-jj-boot\"></i>&nbsp;<span localize=\"开机\">开机</span></a>\r\n\t\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-primary dropdown-toggle isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-shutdown\"></i> &nbsp;<span localize=\"关机\">关机</span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"forceShutdown()\" href=\"javascript:\" localize=\"强制关机\">强制关机</a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"natureShutdown()\" href=\"javascript:\" localize=\"自然关机\">自然关机</a></li>\r\n\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restart()\" href=\"javascript:\"><i class=\"fa  icon-jj-Restart\"></i>&nbsp;<span localize=\"重启\">重启</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"pause()\" href=\"javascript:\"><i class=\"fa icon-jj-pause\"></i>&nbsp;<span localize=\"挂起状态\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"resume()\" href=\"javascript:\"><i class=\"fa icon-jj-Recovery\"></i>&nbsp;<span localize=\"唤醒\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"rename()\" href=\"javascript:\"><i class=\"fa icon-jj-edit\"></i>&nbsp;<span localize=\"修改桌面计算机名\">修改桌面计算机名</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne() || moveto_loading}\" data-ng-click=\"moveto()\" href=\"javascript:\"><i class=\"fa icon-jj-move-1\"></i>&nbsp;<span localize=\"移动至\">移动至</span>&nbsp;<img ng-if=\"moveto_loading\" style=\"position: relative;bottom: 2px\" width=\"14px\" height=\"14px\" ng-src=\"img/HLloading.gif\"></a>\r\n\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"moveto()\" href=\"javascript:\"><i class=\"fa\"></i>&nbsp;<span localize=\"移动至\">移动至</span></a> -->\r\n\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"fa  icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a> -->\r\n\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-4 col-sm-4\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\" input-number> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\"  class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<!-- toolbar end -->\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"desktopSort\" ng-click=\"desktopSort = !desktopSort;sortDesktopName('display_name', desktopSort)\"  localize=\"桌面名\">桌面</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"runStatus\" ng-click=\"runStatus = !runStatus;sort('status', runStatus)\" localize=\"运行状态\">运行状态</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>IP/MAC</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"userName\" localize=\"桌面计算机名/用户名\">桌面计算机名/用户名</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"宿主机\">宿主机</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <th localize=\"当前域\">当前域</th> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-contextmenu\r\n\t\t\t\t\t\t\t\t\t\t\tdata-id=\"{{ item.id }}\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.instance_id }}\">{{ item.display_name }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p><span ng-if=\"item.usb_redir \" class=\"fa icon-jj-usb flag-icon\"></span><span class=\"icon-jj-HA flag-icon\" ng-if=\"item.needha\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.mark_ha\"><span class=\"fa  icon-jj-HA flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.gpu_type == 'share'\" data-localize-title=\"显卡共享\"><span class=\"fa icon-jj-025 flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p ng-if=\"item.gpu_type == 'through'\" data-localize-title=\"显卡直通\"><span class=\"fa icon-jj-026 flag-icon\"></span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><span ng-if=\"item.status=='running' && !item.task_state\" localize-title=\"开机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='shutdown' && !item.task_state\" localize-title=\"关机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='paused' && !item.task_state\" localize-title=\"挂起状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='nostate' && !item.task_state\" localize-title=\"未知状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"(item.status=='error' && !item.task_state) || (item.status=='crashed' && !item.task_state)\" localize-title=\"错误状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.task_state\" title=\"{{ item.tips }}\" class=\"status32 building\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.running_time }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{item.ips}}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.mac }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <td>{{ item.mode_name }}</td> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{{ item.vm_hostname }} <span ng-show=\"item.vm_hostname && item.vm_username\">/</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{{ item.vm_username }}\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.hostname }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <td>{{ item.ad_domain_name }}</td> -->\r\n\r\n<!-- \t\t\t\t\t\t\t\t\t\t\t<td class=\"view_personal_desktop\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\"  data-ng-click=\"view(item)\" localize-title=\"查看桌面\" ng-disabled=\"item.status!=='running'\"><i class=\"fa icon-jj-look\"></i></button></td>\r\n -->\t\t\t\t\t\t\t\t\t\t<td class=\"view_personal_desktop\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"more_list_container more_list_container-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:\" class=\"icon more_icon\" data-localize-title=\"MORE\"><i class=\"fa icon-jj-more\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"menu_wrapper my_menu_wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"arraw\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"item.status!=='running'\"><a class=\"menu_label\" data-ng-click=\"view(item)\" href=\"javascript:void(0)\"><span data-localize=\"查看桌面\"></span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-click=\"viewStorage(item)\" href=\"javascript:void(0)\"><span data-localize=\"存储详情\"></span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"(currentItem.status!=='shutdown' && currentItem.status!=='suspended') || currentItem.task_state\"  data-ng-click=\"start(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"开机\">开机</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"(currentItem.status!=='running' && currentItem.status!=='suspended') || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\" ><span localize=\"关机\">关机</span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"forceShutdown(currentItem)\" ng-disabled=\"(currentItem.status!=='running' && currentItem.status!=='suspended') || currentItem.task_state\" ><a class=\"menu_label\" href=\"javascript:\" localize=\"强制关机\">强制关机</a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"natureShutdown(currentItem)\" ng-disabled=\"(currentItem.status!=='running' && currentItem.status!=='suspended') || currentItem.task_state\" ><a class=\"menu_label\" href=\"javascript:\" localize=\"自然关机\">自然关机</a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"restart(currentItem)\"  ng-disabled=\"(currentItem.status!=='running' && currentItem.status!=='suspended') || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\" localize=\"重启\">重启</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"pause(currentItem)\" ng-disabled=\"currentItem.status!=='running' || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"挂起状态\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"resume(currentItem)\" ng-disabled=\"currentItem.status!=='paused' || currentItem.task_state\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"唤醒\"></a></li>\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-click=\"delete(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"删除\">删除</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li> -->\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.status=='paused' || currentItem.status=='running' || currentItem.task_state\" data-ng-click=\"reset(currentItem)\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"重置\">重置</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.status=='paused' || currentItem.status=='running' || currentItem.task_state\" data-ng-click=\"alter(currentItem)\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"修改桌面计算机名\">修改桌面计算机名</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-show=\"currentItem.virtual_type === 'kvm'\" ng-disabled=\"currentItem.status!=='running' || currentItem.task_state || currentItem.enable_gpu\" data-ng-click=\"migration(currentItem)\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"动态迁移\">动态迁移</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-show=\"currentItem.virtual_type === 'kvm'\" ng-disabled=\"currentItem.status!=='shutdown' || currentItem.task_state\" data-ng-click=\"moveto(currentItem)\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"移动至\">移动至</a></li>\r\n\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-click=\"view(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"查看桌面\">查看桌面</a></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-class=\"{disabled:currentItem.status}\" data-ng-click=\"start(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" ng-disabled=\"currentItem.status!=='shutdown'\" localize=\"开机\">开机</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label btn\" href=\"javascript:\" ng-disabled=\"currentItem.status!=='running'\"><span localize=\"关机\">关机</span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label btn\"  ng-disabled=\"currentItem.status!=='running'\"  href=\"javascript:\" localize=\"强制关机\">强制关机</a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label btn\"  ng-disabled=\"currentItem.status!=='running'\"  href=\"javascript:\" localize=\"自然关机\">自然关机</a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"restart(currentItem)\"><a class=\"menu_label btn\" href=\"javascript:\" ng-disabled=\"currentItem.status!=='running'\" localize=\"重启\">重启</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"pause(currentItem)\"><a class=\"menu_label btn\" href=\"javascript:\" ng-disabled=\"currentItem.status!=='running'\" localize=\"暂停\">暂停</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"resume(currentItem)\"><a class=\"menu_label btn\" href=\"javascript:\" ng-disabled=\"currentItem.status!=='paused'\" localize=\"恢复\">恢复</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"delete(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"删除\">删除</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"view(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"查看桌面\">查看桌面</a></li> -->\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n","views/vdi/HA/desktop_ha.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-xs-6 col-sm-6\">\r\n                                    <button class=\"btn btn-primary btn-xs\" ng-click=\"add()\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></button>\r\n                                    <button class=\"btn btn-danger btn-xs\" ng-click=\"delete()\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></button>\r\n                                    <!-- <button class=\"btn btn-danger btn-xs\" data-ng-class=\"{disabled:!checkOne()}\" ng-click=\"delete()\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></button> -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<!-- <div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\"data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div> -->\r\n\t\t\t\t\t\t\t\t</div> \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\r\n                                        <th localize=\"策略名称\">策略名称</th>\r\n                                        <th localize=\"描述\">描述</th>\r\n\r\n                                        <th localize=\"优先级\">优先级</th>\r\n                                        <th localize=\"响应时间\">响应时间</th>\r\n\r\n                                        <th localize=\"启用状态\">启用状态</th>\r\n\t\t\t\t\t\t\t\t\r\n                                        <th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows\">\r\n\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\r\n                                        <td>{{item.name}}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{item.desc}}</td>\r\n\r\n                                        <td>\r\n                                        \t<span localize=\"低\" ng-if=\"item.priority == 1\"></span>\r\n                                        \t<span localize=\"中\" ng-if=\"item.priority == 2\"></span>\r\n                                        \t<span localize=\"高\" ng-if=\"item.priority == 3\"></span></td>\r\n                                        <td>{{item.ha_response_time}}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <span ng-if=\"item.enable_ha\" localize=\"启用\"></span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <span ng-if=\"!item.enable_ha\" localize=\"未启用\"></span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"switch\" ng-if=\"!item.active_loadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"start_interval\" class=\"switch-checkbox\" id=\"start_interval{{$index}}\" ng-model=\"item.enable_ha\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"switch-label\" data-swchon-text=\"ON\" data-swchoff-text=\"OFF\" ng-click=\"active(item)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/loadingtext.gif\" ng-if=\"item.active_loadding\" height=\"24\" width=\"24\">\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n                                        <td class=\"nowrap\"> \r\n                                        \t<div>\r\n                                        \t\t<button localize-title='查看详情' class=\"btn btn-xs btn-default\" ng-click=\"view(item)\"><i class=\"fa icon-jj-look\"></i></button>\r\n                                        \t\t<button localize-title='编辑' class=\"btn btn-xs btn-default\" ng-click=\"edit(item)\"><i class=\"fa icon-jj-Write\"></i></button>\r\n                                        \t\t<button localize-title='删除' class=\"btn btn-xs btn-default\" ng-click=\"delete(item)\"><i class=\"fa icon-jj-delete\"></i></button>\r\n                                        \t</div>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/monitor/alarm.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-6\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\"  href=\"javascript:\"><i class=\"fa  icon-jj-delete\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-disabled=\"rows.length == 0\" data-ng-click=\"deleteAll()\" href=\"javascript:\"><i class=\"fa  icon-jj-Empty\"></i> <span data-localize=\"清空\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\">\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"显示\"></span>\r\n\t\t\t\t\t\t\t\t\t<input type=\"number\" min=\"1\" max=\"500\" placeholder=\"1-500\" class=\"mysmallinput\" input-number\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageSizeChange()\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"项结果\"></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,null)\" ></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"序号\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"objectSort\" ng-click=\"objectSort = !objectSort;sort('object', objectSort)\" data-localize=\"对象\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"内容\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"created_atSort\" ng-click=\"created_atSort = !created_atSort;sort('created_at', created_atSort)\" data-localize=\"时间\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ $index+1 }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.object }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.content }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.created_at | date:'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/monitor/desktop.html":"<section class=\"col-xs-2 col-sm-2 col-md-3 col-lg-2\">\r\n    <div class=\"portlet box grey\"  data-monitor-tree> \r\n        <!-- 左侧栏列表 -->\r\n        <ul>\r\n            <li ng-repeat='item in items' class=\"parent\">\r\n                <div class=\"tree-host\">\r\n                    <a href='#' class='tree-toggle fa icon-jj-xiala' >\r\n                        <em class='fa'></em>\r\n                    </a>\r\n                    <a class=\"tree-it\">\r\n                        <em class=\"fa icon-jj-host\"></em>{{item.ip}}\r\n                    </a>\r\n                </div>\r\n                <ul class='tree-branch'>\r\n                    <li title=\"{{ subitem.name }}\" class=\"text-overflow\" ng-repeat='subitem in item.insts | reverse:searchText:\"name\"'> \r\n                        <a href='#' ng-click=\"change_server(subitem)\" class=\"tree-it\">\r\n                            <em ng-class=\"{running:true,shutoff:false}\"></em>{{subitem.name}} \r\n                        </a> \r\n                    </li>\r\n                </ul>\r\n            </li>\r\n        </ul>\r\n         <!-- 左侧栏列表结束 -->\r\n    </div>\r\n</section>\r\n\r\n<section class=\" col-xs-10 col-sm-10 col-md-9 col-lg-10\">\r\n    <div class=\"row\">\r\n        <div class=\"col col-xs-12 col-sm-12 col-md-12\">\r\n            <ul class=\"monitor-mess  clearfix\">\r\n                <li><label data-localize=\"桌面名\"></label>： {{cur_instance.name}}</li>\r\n                <li><label data-localize=\"桌面编号\"></label>： {{cur_instance.id}}</li>\r\n                <li><label data-localize=\"桌面类型\"></label>：\r\n                     <span ng-if=\"cur_instance.vm_type===1\" localize=\"教学桌面\"></span>\r\n                     <span ng-if=\"cur_instance.vm_type===2\" localize=\"个人桌面\"></span>\r\n                </li>\r\n                <li><label data-localize=\"状态\"></label>：\r\n                    <span ng-show=\"cur_instance.status=='running'\" localize=\"开机状态\"></span>\r\n                    <span ng-show=\"cur_instance.status=='shutdown'\" localize=\"关机状态\"></span>\r\n                    <span ng-show=\"cur_instance.status=='paused'\" localize=\"挂起状态\"></span>\r\n                    <span ng-show=\"cur_instance.status=='migrating'\" localize=\"迁移状态\"></span>\r\n                    <span ng-show=\"cur_instance.status=='building'\" localize=\"创建中状态\"></span>\r\n                    <span ng-show=\"cur_instance.status=='error'\" localize=\"错误状态\"></span>\r\n                    <span ng-show=\"cur_instance.status=='crashed'\" localize=\"异常状态\"></span>\r\n                    <span ng-show=\"cur_instance.status=='nostate'\" localize=\"未知异常状态\"></span>\r\n                </li>\r\n            </ul>        \r\n        </div>\r\n    </div>\r\n    <div class=\"row\">\r\n        <div class=\"col col-xs-12 col-sm-12 col-md-12 col-lg-6\">\r\n            <div class=\"jarviswidget jarviswidget-sortable\">\r\n                <header role=\"heading\">\r\n                    <h2><span data-localize=\"CPU占用率\"></span> ({{item.name}})</h2>\r\n                    <!-- <div class=\"pull-right\" style=\"line-height:32px;margin-right: 10px;\">\r\n                        <img src=\"../../../img/loading.gif\" width=\"16px\" height=\"16px\" ng-show=\"loading\"/> 刷新频率：\r\n                        <select data-ng-model=\"refresh_time\">\r\n                            <option value=\"3000\" selected>3秒</option>\r\n                            <option value=\"5000\">5秒</option>\r\n                            <option value=\"10000\">10秒</option>\r\n                        </select>\r\n                    </div> 刷新频率暂时不做-->\r\n                </header>\r\n                <div role=\"content\">\r\n                    <div area-traffic options=\"cpu_options\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col col-xs-12 col-sm-12 col-md-12 col-lg-6\">\r\n            <div class=\"jarviswidget jarviswidget-sortable\">\r\n                <header role=\"heading\">\r\n                    <h2><span data-localize=\"内存\"></span> ({{item.name}})</h2>\r\n                </header>\r\n                <div role=\"content\">\r\n                    <div area-traffic options=\"mem_options\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"row\">\r\n        <div class=\"col col-xs-12 col-sm-12 col-md-12 col-lg-6\">\r\n            <div class=\"jarviswidget jarviswidget-sortable\">\r\n                <header role=\"heading\">\r\n                    <h2><span data-localize=\"网络上下行流量\"></span> ({{item.name}})</h2>\r\n                </header>\r\n                <div role=\"content\">\r\n                    <div area-traffic options=\"net_options\"></div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"jarviswidget jarviswidget-sortable\">\r\n                <header role=\"heading\">\r\n                    <h2><span data-localize=\"磁盘读写速度\"></span> ({{item.name}})</h2>\r\n                </header>\r\n                <div role=\"content\">\r\n                    <div area-traffic options=\"disk_options\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col col-xs-12 col-sm-12 col-md-12 col-lg-6\">\r\n            <div class=\"jarviswidget jarviswidget-sortable\">\r\n                <header role=\"heading\">\r\n                    <h2><span data-localize=\"进程\"></span> ({{item.name}})</h2>\r\n                </header>\r\n                <div role=\"content\">\r\n                    <div class=\"table-responsive jincheng\">\r\n                        <table data-vdi-grid class=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n                    width=\"100%\">\r\n                            <thead class=\"vdi_header\">\r\n                                <tr>\r\n                                    <th ng-model=\"pidSort\" ng-click=\"pidSort = !pidSort;sort('pid', pidSort)\">PID</th>\r\n                                    <th ng-model=\"userSort\" ng-click=\"userSort = !userSort;sort('user', userSort)\">USER</th>\r\n                                    <!--<th>PR</th>-->\r\n                                    <!--<th>NI</th>-->\r\n                                    <!--<th>VIRT</th>-->\r\n                                    <!--<th>RES</th>-->\r\n                                    <!--<th>SHR</th>-->\r\n                                    <!--<th>S</th>-->\r\n                                    <th ng-model=\"cpuSort\" ng-click=\"cpuSort = !cpuSort;sort('cpu', cpuSort)\">CPU</th>\r\n                                    <th ng-model=\"memSort\" ng-click=\"memSort = !memSort;sort('mem', memSort)\">MEM</th>\r\n                                    <th ng-model=\"timeSort\" ng-click=\"timeSort = !timeSort;sort('time', timeSort)\">TIME+</th>\r\n                                    <th>COMMAND</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody class=\"vdi_body\">\r\n                                <tr data-ng-repeat=\"item in metric_data.process_list\">\r\n                                    <td>{{ item.pid }}</td>\r\n                                    <td>{{ item.user }}</td>\r\n                                    <!--<td>{{item.pr }}</td>-->\r\n                                    <!--<td>{{ item.ni }}</td>-->\r\n                                    <!--<td>{{ item.virt }}</td>-->\r\n                                    <!--<td>{{ item.res }}</td>-->\r\n                                    <!--<td>{{ item.shr }}</td>-->\r\n                                    <!--<td>{{ item.s}}</td>-->\r\n                                    <td>{{ item.cpu }}%</td>\r\n                                    <td>{{ item.mem | to_mb}}MB</td>\r\n                                    <td>{{ item.time}}</td>\r\n                                    <td>{{ item.command}}</td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</section>\r\n\r\n<script type=\"text/javascript\">\r\n    $(\".jincheng\").on(\"scroll\", function(e){\r\n    var toolbar = $(\".vdi_header\");\r\n    var table = $(\".vdi_body\");\r\n    var topHei = (toolbar.length && table.length) ? table.offset().top - toolbar.innerHeight() : 0;\r\n    if(topHei){\r\n        toolbar.css({\r\n            \"transform\":\"translateY(\"+($(\".jincheng\").scrollTop())+\"px)\"\r\n        })\r\n    }\r\n});\r\n</script>\r\n","views/vdi/monitor/host.html":"<div class=\"margin-bottom-10\">\r\n\t<span>\r\n\t\t<span data-localize=\"主机：\"></span>\r\n\t\t<select data-ng-model=\"item\" data-ng-change=\"change_server(item)\" data-ng-options=\"item.ip for item in items\"></select>\r\n\t</span>\r\n\t<span>\r\n\t\t&nbsp;&nbsp;&nbsp;&nbsp;<span data-localize=\"刷新频率\"></span>\r\n\t\t<select ng-model=\"refresh_time\">\r\n    \t\t<option value=\"3000\" selected>3s</option>\r\n    \t\t<option value=\"5000\">5s</option>\r\n    \t\t<option value=\"10000\">10s</option>\r\n    \t</select>\r\n\t</span>\r\n</div>\r\n\r\n\r\n<section>\r\n\t<div class=\"row\">\r\n\t\t<div class=\"col col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t\t\t<div class=\"jarviswidget jarviswidget-sortable\">\r\n\t\t\t\t<header role=\"heading\">\r\n\t\t\t\t\t<h2 data-localize=\"CPU占用率\"></h2>\r\n\t\t\t\t</header>\r\n\t\t\t\t<div role=\"content\">\r\n\t\t\t\t\t<div options=\"cpu_options\" area-traffic></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"col col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t\t\t<div class=\"jarviswidget jarviswidget-sortable\">\r\n\t\t\t\t<header role=\"heading\">\r\n\t\t\t\t\t<h2 data-localize=\"内存\"></h2>\r\n\t\t\t\t</header>\r\n\t\t\t\t<div role=\"content\">\r\n\t\t\t\t\t<div area-traffic options=\"mem_options\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"row\">\r\n\t\t<div class=\"col col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t\t\t<div class=\"jarviswidget jarviswidget-sortable\">\r\n\t\t\t\t<header role=\"heading\">\r\n\t\t\t\t\t<h2 data-localize=\"网络上下行流量\"></h2>\r\n                    <select ng-model=\"net_category\" class=\"select_Monitor\" data-ng-options=\"net for net in net_categories\">\r\n                    </select>\r\n\t\t\t\t</header>\r\n\t\t\t\t<div role=\"content\">\r\n\t\t\t\t\t<div area-traffic options=\"net_options\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"jarviswidget jarviswidget-sortable\">\r\n\t\t\t\t<header role=\"heading\">\r\n\t\t\t\t\t<h2 data-localize=\"磁盘读写速度\"></h2>\r\n                    <select ng-model=\"disk_category\" class=\"select_Monitor\" data-ng-options=\"disk for disk in disk_categories\">\r\n                    </select>\r\n\t\t\t\t</header>\r\n\t\t\t\t<div role=\"content\">\r\n\t\t\t\t\t<div area-traffic options=\"disk_options\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n        <div class=\"col col-xs-12 col-sm-12 col-md-12 col-lg-6\">\r\n            <div class=\"jarviswidget jarviswidget-sortable\">\r\n                <header role=\"heading\">\r\n                    <h2 data-localize=\"进程\"></h2>\r\n                </header>\r\n                <div role=\"content\">\r\n                    <div class=\"table-responsive jincheng\">\r\n                        <table data-vdi-grid class=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n                               width=\"100%\">\r\n                            <thead class=\"vdi_header\">\r\n                            <tr>\r\n                                <th ng-model=\"pidSort\" ng-click=\"pidSort = !pidSort;sort('pid', pidSort)\">PID</th>\r\n                                <th ng-model=\"userSort\" ng-click=\"userSort = !userSort;sort('user', userSort)\">USER</th>\r\n                                <!--<th>PR</th>-->\r\n                                <!--<th>NI</th>-->\r\n                                <!--<th>VIRT</th>-->\r\n                                <!--<th>RES</th>-->\r\n                                <!--<th>SHR</th>-->\r\n                                <!--<th>S</th>-->\r\n                                <th ng-model=\"cpuSort\" ng-click=\"cpuSort = !cpuSort;sort('cpu', cpuSort)\">CPU</th>\r\n                                <th ng-model=\"memSort\" ng-click=\"memSort = !memSort;sort('mem', memSort)\">MEM</th>\r\n                                <th ng-model=\"timeSort\" ng-click=\"timeSort = !timeSort;sort('time', timeSort)\">TIME+</th>\r\n                                <th>COMMAND</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody class=\"vdi_body\">\r\n                            <tr data-ng-repeat=\"item in metric_data.processs_list\">\r\n                                <td>{{ item.pid }}</td>\r\n                                <td>{{ item.username }}</td>\r\n                                <!--<td>{{item.pr }}</td>-->\r\n                                <!--<td>{{ item.ni }}</td>-->\r\n                                <!--<td>{{ item.virt }}</td>-->\r\n                                <!--<td>{{ item.res }}</td>-->\r\n                                <!--<td>{{ item.shr }}</td>-->\r\n                                <!--<td>{{ item.s}}</td>-->\r\n                                <td>{{ item.cpu_percent}}%</td>\r\n                                <td>{{ (item.memory_percent).toFixed(2) }}%</td>\r\n                                <td>{{ item.create_time*1000 | date:\"yyyy-MM-dd HH:mm:ss\" }}</td>\r\n                                <td>{{ item.name}}</td>\r\n                            </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</section>\r\n<script type=\"text/javascript\">\r\n    $(\".jincheng\").on(\"scroll\", function(e){\r\n    var toolbar = $(\".vdi_header\");\r\n    var table = $(\".vdi_body\");\r\n    var topHei = (toolbar.length && table.length) ? table.offset().top - toolbar.innerHeight() : 0;\r\n    if(topHei){\r\n        toolbar.css({\r\n            \"transform\":\"translateY(\"+($(\".jincheng\").scrollTop())+\"px)\"\r\n        })\r\n    }\r\n});\r\n</script>\r\n","views/vdi/monitor/policy.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-6\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"add()\"  href=\"javascript:\"><i class=\"fa  icon-jj-addddd\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"config()\" href=\"javascript:\"><i class=\"fa  icon-jj-Setup\"></i> <span localize=\"配置全局告警\">配置全局告警</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"notice()\" href=\"javascript:\"><i class=\"fa  icon-jj-Setup\"></i> <span localize=\"配置告警邮件\">配置告警邮件</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"fa  icon-jj-delete\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select data-ng-model=\"pagesize\" data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"名称\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"描述\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"状态\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<!--<th>告警</th>-->\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{item.name}}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{item.desc}}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"switch\" ng-show=\"!item.active_loadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"start_interval\" class=\"switch-checkbox\" id=\"start_interval{{$index}}\" ng-model=\"item.strategy_enabled\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"switch-label\" data-swchon-text=\"ON\" data-swchoff-text=\"OFF\" ng-click=\"active(item)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/loadingtext.gif\" ng-if=\"item.active_loadding\" height=\"24\" width=\"24\" alt=\"\">\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"btn btn-default btn-xs\" ng-click=\"view(item)\" ><i class=\"icon icon-jj-look\" localize-title=\"查看详情\"></i></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"btn btn-default btn-xs\" ng-click=\"alter(item)\"><i class=\"icon icon-jj-edit\" localize-title=\"编辑\"></i></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"btn btn-default btn-xs\" ng-click=\"delete(item)\"><i class=\"icon icon-jj-delete\" localize-title=\"删除\"></i></span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>","views/vdi/network/dataNetwork/dataNetwork.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-xs-6 col-sm-6\">\r\n                                    <button class=\"btn btn-primary btn-xs\" ng-disabled=\"hasHA_loading\" ng-click=\"add()\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></button>\r\n                                    <!-- <button class=\"btn btn-danger btn-xs\" data-ng-class=\"{disabled:!checkOne()}\" ng-click=\"delete()\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></button> -->\r\n                                    <!-- <ul class=\"dropdown-menu\">\r\n                                        <li><a class=\"isBatch text-center\" href=\"javascript:\" ng-click=\"open_storage_dialog('logic')\" localize=\"普通网络\"></a></li>\r\n                                        <li><a class=\"isBatch text-center\" href=\"javascript:\" ng-click=\"open_storage_dialog('vlan')\">VLAN</a></li>\r\n                                    </ul> -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\" data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t</div> \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n                                        <th localize=\"名称\">名称</th>\r\n                                        <th localize=\"关联分布式虚拟交换机\">关联分布式虚拟交换机</th>\r\n                                        <th localize=\"类型\">类型</th>\r\n\r\n                                        <th localize=\"子网数量\">子网数量</th>\r\n                                        <th>VLAN ID</th>\r\n\t\t\t\t\t\t\t\t\r\n                                        <th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | paging:currentPage:pagesize:rows\">\r\n                                        <td width=\"20%\"><a href=\"#/network/dataNetwork/{{item.id}}\">{{item.name}}</a></td>\r\n                                        <td>{{ item.switch_name }}</td>\r\n                                        <td>\r\n\t                                        <span>{{item.switch_type}}</span>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.subnet_count }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.vlan_id }}</td>\r\n\r\n                                        <td class=\"nowrap\"> \r\n                                        \t<div ng-show=\"item.type!=='bridge'\">\r\n                                        \t\t<button localize-title='新增子网' class=\"btn btn-xs btn-default\" ng-disabled=\"hasHA_loading\" ng-click=\"new_sub_network(item.id)\"><i class=\"fa icon-jj-add-1\"></i></button>\r\n                                        \t\t<abbr class=\"abbr-title\" localize-title='不可编辑'><button class=\"btn btn-xs btn-default\" ng-disabled=\"item.un_edit\" ng-show=\"item.un_edit\"><i class=\"fa icon-jj-Write\"></i></button></abbr>\r\n                                        \t\t<button localize-title='编辑' class=\"btn btn-xs btn-default\" ng-disabled=\"item.un_edit || hasHA_loading\" ng-show=\"!item.un_edit\" ng-click=\"alter(item)\"><i class=\"fa icon-jj-Write\"></i></button>\r\n                                        \t\t<button localize-title='删除' class=\"btn btn-xs btn-default\" ng-disabled=\"hasHA_loading\" ng-click=\"delete(item)\"><i class=\"fa icon-jj-delete\"></i></button>\r\n                                        \t</div>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/network/dataNetwork/IPpool.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\"  href=\"#/network/dataNetwork/{{cur_network_id}}\"><i class=\"fa  icon-jj-recovery\"></i>&nbsp;<span localize=\"返回\">返回</span></a>\r\n<!-- \t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\"  href=\"javascript:\" data-dialog=\"newNetworkIPDialog\" data-dialog-url=\"resource/IP_new.html\" data-dialog-size=\"md\"><i class=\"fa  icon-jj-addddd\"></i>&nbsp;<span localize=\"调整范围\">调整范围</span></a> -->\r\n\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-danger isBatch\" data-ng-click=\"delete()\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a> -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" input-number class=\"mysmallinput\"  ng-change=\"pageSizeChange()\" ng-init=\"pagesize=10;pagesizes=[10,20,30]\" data-ng-model=\"pagesize\"></input> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th> -->\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th localize=\"禁用启用\">启用/禁用</th> -->\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"width:200px;cursor:pointer;\"  ng-model=\"IPSort\" ng-click=\"IPSort = !IPSort;sortIP(IPSort)\">IP</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"分配类型\">分配类型</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"名称\">名称</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"终端名\">终端名</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"所有人\">所有人</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"教室\">教室</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize:rows\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td> -->\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.ip }} </td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- 0:非桌面，1：教学桌面，2：个人桌面 -->\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show=\"item.is_mode==1\" localize=\"教学桌面\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show=\"item.is_mode==2\" localize=\"个人桌面\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show=\"item.is_mode==3\" localize=\"教学模板\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show=\"item.is_mode==4\" localize=\"个人模板\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show=\"item.is_mode==5\" localize=\"系统桌面\"></span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.instance_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.client_name }}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.user_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.pool_name }}</td>\t\t\t\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>\r\n<script>pageSetUp();</script>\r\n","views/vdi/network/dataNetwork/sub_network.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-xs-6 col-sm-6\">\r\n                                    <a class=\"btn btn-xs btn-primary\"  href=\"#/network/dataNetwork\"><i class=\"fa  icon-jj-recovery\"></i>&nbsp;<span localize=\"返回\">返回</span></a>\r\n                                    <button ng-disabled=\"hasHA_loading\" class=\"btn btn-primary btn-xs\" ng-click=\"new_sub_network()\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></button>\r\n                                    <!-- <button class=\"btn btn-danger btn-xs\" data-ng-class=\"{disabled:!checkOne()}\" ng-click=\"delete()\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></button> -->\r\n                                    <!-- <ul class=\"dropdown-menu\">\r\n                                        <li><a class=\"isBatch text-center\" href=\"javascript:\" ng-click=\"open_storage_dialog('logic')\" localize=\"普通网络\"></a></li>\r\n                                        <li><a class=\"isBatch text-center\" href=\"javascript:\" ng-click=\"open_storage_dialog('vlan')\">VLAN</a></li>\r\n                                    </ul> -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"><span localize=\"显示\"></span> <select ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\" ng-init=\"pagesize=10;pagesizes=[10,20,30]\" data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t</div> \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th> -->\r\n\t\t\t\t\t\t\t\t\t\t\r\n                                        <th localize=\"子网名称\">子网名称</th>\r\n                                        <th localize=\"IP范围\">IP范围</th>\r\n\r\n                                        <!-- <th localize=\"已分配IP数\">已分配IP数</th> -->\r\n                                        <th localize=\"子网掩码\">子网掩码</th>\r\n\r\n                                        <th localize=\"网关\">网关</th>\r\n                                        <th>DNS</th>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th localize=\"状态\">状态</th> -->\r\n                                        <th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | paging:currentPage:pagesize:rows\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td> -->\r\n\r\n                                        <td><a href=\"#/network/dataNetwork/{{cur_network_id}}/subnet/{{item.id}}\">{{item.name}}</a></td>\r\n                                        <td><span ng-show=\"item.start_ip\">{{item.start_ip + \"--\" +item.end_ip}}</span></td>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td></td> -->\r\n\t\t\t\t\t\t\t\t\t\t<td>{{item.netmask}}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<td>{{item.gateway_ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<p>{{item.dns_nameservers[0]}}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t<p>{{item.dns_nameservers[1]}}</p>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td>\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"switch\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"start_interval\" class=\"switch-checkbox\" id=\"start_interval{{$index}}\" ng-model=\"item.enable_dhcp\" ng-change=\"enableDHCP(item)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"start_interval{{$index}}\" class=\"switch-label\" data-swchon-text=\"ON\" data-swchoff-text=\"OFF\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</td> -->\r\n                                        <td class=\"nowrap\"> \r\n                                        \t<div ng-show=\"item.type!=='bridge'\">\r\n                                        \t\t<!-- <button localize-title='新增子网' class=\"btn btn-xs btn-default\" data-dialog=\"newSubNetworkDialog\" data-dialog-url=\"resource/network/new_sub_network.html\"><i class=\"fa  icon-jj-addddd\"></i></button> -->\r\n                                        \t\t<abbr class=\"abbr-title\" localize-title='不可编辑'><button class=\"btn btn-xs btn-default\" ng-disabled=\"item.un_edit\" ng-show=\"item.un_edit\"><i class=\"fa icon-jj-Write\"></i></button></abbr>\r\n                                        \t\t<button ng-disabled=\"hasHA_loading\" localize-title='编辑' class=\"btn btn-xs btn-default\" ng-disabled=\"item.un_edit\" ng-show=\"!item.un_edit\" ng-click=\"alter_sub_network(item)\"><i class=\"fa icon-jj-Write\"></i></button>\r\n                                        \t\t<button ng-disabled=\"hasHA_loading\" localize-title='删除' class=\"btn btn-xs btn-default\" ng-click=\"delete(item)\"><i class=\"fa icon-jj-delete\"></i></button>\r\n                                        \t</div>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/network/dhcp/dhcp.html":"<section class='dhcp' style=\"padding: 20px 0 0 0;\">\r\n    <form class=\"form-horizontal col-xs-5\" name=\"dhcpFrom\" novalidate>\r\n        <div class=\"form-group\">\r\n            <div class=\"col-xs-4 text-right\">\r\n                <label>\r\n                    <input type=\"checkbox\" class=\"checkbox style-0\" ng-model=\"DHCPCtrl.data.enable_dhcp\" ng-change='DHCPCtrl.changeModify(DHCPCtrl.data.enable_dhcp)'>\r\n                    <span localize='启用'></span>\r\n                </label>\r\n                <label>\r\n                    <a href=\"javascript:void(0);\" rel=\"popover-hover\" data-ribbon-tips data-my-tips='DHCPTips' data-placement=\"right\" data-html=\"true\"><i class=\"fa fa-question-circle\"></i></a>\r\n                </label>\r\n            </div>\r\n            <div class=\"col-xs-7\">\r\n                <img src=\"img/loadingtext.gif\" data-ng-if=\"DHCPCtrl.enabling\" height=\"24\" width=\"24\" alt=\"\">\r\n            </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n            <label class=\"col-xs-4 control-label required\" localize=\"开始IP\"></label>\r\n            <div class=\"col-xs-7\" >\r\n                <input type=\"text\" format-ip ng-model=\"DHCPCtrl.data.start\" ng-class='{disableDHCP: !DHCPCtrl.data.enable_dhcp}' ng-disabled=\"!DHCPCtrl.data.enable_dhcp || !DHCPCtrl.modify\">\r\n            </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n            <label class=\"col-xs-4 control-label required\" localize=\"结束IP\"></label>\r\n            <div class=\"col-xs-7\">\r\n                <input type=\"text\" format-ip ng-model=\"DHCPCtrl.data.end\" ng-class='{disableDHCP: !DHCPCtrl.data.enable_dhcp}' ng-disabled=\"!DHCPCtrl.data.enable_dhcp || !DHCPCtrl.modify\">\r\n            </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n            <label class=\"col-xs-4 control-label required\" localize=\"子网掩码\"></label>\r\n            <div class=\"col-xs-7\">\r\n                <input type=\"text\" format-ip data-ng-model=\"DHCPCtrl.data.netmask\" ng-class='{disableDHCP: !DHCPCtrl.data.enable_dhcp}' ng-disabled=\"!DHCPCtrl.data.enable_dhcp || !DHCPCtrl.modify\">\r\n            </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n            <label class=\"col-xs-4 control-label required\" localize=\"网关\"></label>\r\n            <div class=\"col-xs-7\">\r\n                <input type=\"text\" format-ip data-ng-model=\"DHCPCtrl.data.gateway\" ng-class='{disableDHCP: !DHCPCtrl.data.enable_dhcp}' ng-disabled=\"!DHCPCtrl.data.enable_dhcp || !DHCPCtrl.modify\">\r\n            </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n            <label class=\"col-xs-4 control-label required\">DNS</label>\r\n            <div class=\"col-xs-7\">\r\n                <input type=\"text\" format-ip data-ng-model=\"DHCPCtrl.data.dns\" ng-class='{disableDHCP: !DHCPCtrl.data.enable_dhcp}' ng-disabled=\"!DHCPCtrl.data.enable_dhcp || !DHCPCtrl.modify\">\r\n            </div>\r\n        </div>\r\n        <div class=\"form-group text-right\">\r\n            <label class=\"col-xs-4 control-label\"></label>\r\n            <div class=\"col-xs-7\">\r\n                <img src=\"img/loadingtext.gif\" data-ng-if=\"DHCPCtrl.updating\" height=\"24\" width=\"24\" alt=\"\">\r\n                <button class=\"btn btn-primary\" ng-if=\"!DHCPCtrl.modify\" data-ng-disabled='!DHCPCtrl.data.enable_dhcp' ng-click=\"DHCPCtrl.modify = true\" localize=\"更改\"></button>\r\n                <button class=\"btn btn-primary\" ng-if=\"DHCPCtrl.modify && !DHCPCtrl.updating\" data-ng-disabled='dhcpFrom.$invalid' ng-click=\"DHCPCtrl.updateDHCP()\" localize=\"保存\"></button>\r\n                <button class=\"btn btn-primary\" ng-if=\"DHCPCtrl.modify && !DHCPCtrl.updating\" ng-click=\"DHCPCtrl.modify = false;DHCPCtrl.loadDHCP()\" localize=\"取消\" style=\"margin-left: 10px;\"></button>                \r\n            </div>\r\n        </div>\r\n    </form>\r\n        \r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/network/manageNetwork/manageNetwork.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\">\r\n\t\t\t\t\t\t<!-- This area used as dropdown edit box -->\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget edit box -->\r\n\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-primary btn-xs dropdown-toggle isBatch\" data-toggle=\"dropdown\" data-ng-class=\"{disabled:loading || rows.length == 0}\"><i class=\"fa icon-jj-all\"></i> <span data-localize=\"修改\"></span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t<li style=\"cursor:pointer; position:relative;\"><a class=\"btn isBatch\" data-localize=\"修改管理网络\" data-ng-click=\"modify('management')\" data-ng-class=\"{disabled:manage_rowsHA.length==rows.length}\"></a><span class=\"parameterdisabled\" data-ng-if=\"manage_rowsHA.length==rows.length\"></span></li>\r\n                                        <li class=\"divider\"></li>\r\n                                        <li style=\"cursor:pointer; position:relative;\"><a class=\"btn isBatch\" data-localize=\"修改镜像网络\" data-ng-click=\"modify('image')\" data-ng-class=\"{disabled:img_rowsHA.length==img_rows.length}\"></a><span class=\"parameterdisabled\" data-ng-if=\"img_rowsHA.length==img_rows.length\"></span></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\"data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t</div> \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n                                        <th localize=\"主机名\"></th>\r\n                                        <th localize=\"类型\"></th>\r\n                                        <th localize=\"管理网络\"></th>\r\n                                        <th localize=\"镜像网络\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | paging:currentPage:pagesize:rows\">\r\n                                        <td width=\"15%\">{{ item.host_name }}</td>\r\n                                        <td data-ng-if=\"!item.controller_and_compute && item.host_type=='controller'\" data-localize=\"主控节点\"></td>\r\n                                        <td data-ng-if=\"!item.controller_and_compute && item.host_type=='compute'\" data-localize=\"计算节点\"></td>\r\n                                        <td data-ng-if=\"item.controller_and_compute\" data-localize=\"主控节点/计算节点\"></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.management_dev }}/{{ item.management_ip }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td data-ng-if=\"item.host_type=='controller'\">{{ item.image_dev }}/{{ item.image_ip }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td data-ng-if=\"(item.host_type=='compute' && item.status=='active' && item.image_ip && item._connect) || (item.host_type=='compute' && item.status!=='active')\">{{ item.image_dev }}/{{ item.image_ip }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td data-ng-if=\"item.host_type=='compute' && item.status=='active' && (!item._connect || !item.image_ip)\"><i class=\"icon icon-jj-Warning txt-color-redjj\" data-localize-title=\"镜像网络无法连通\"></i></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n<!-- \t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\"><span data-localize=\"修改\"></span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-localize=\"修改管理网络\" data-ng-click=\"modify('management')\"></a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-localize=\"修改镜像网络\" data-ng-click=\"modify('image')\"></a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section> -->\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/network/virtualSwitch/virtualSwitch.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\">\r\n\t\t\t\t\t\t<!-- This area used as dropdown edit box -->\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget edit box -->\r\n\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-primary btn-xs isBatch\" ng-disabled=\"hasHA_loading\" data-ng-click=\"add()\"><i class=\"fa icon-jj-addddd\"></i> <span data-localize=\"新增\"></span></button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\"data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t</div> \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive switch-tabel\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center switch-tabel-first\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th> -->\r\n                                        <th localize=\"名称\"></th>\r\n                                        <th localize=\"描述\"></th>\r\n                                        <th localize=\"网络类型\"></th>\r\n                                        <th localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | paging:currentPage:pagesize:rows\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td> -->\r\n\t\t\t\t\t\t\t\t\t\t<td width=\"20%\"><a href=\"#/network/virtualSwitch/{{item.uuid}}#{{ item.decodeName }}&{{ item.type }}\">{{ item.name }}</a></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.description }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.type }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"hasHA_loading\" localize-title='编辑' class=\"btn btn-xs btn-default\" ng-click=\"edit(item)\"><i class=\"fa icon-jj-Write\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"hasHA_loading\" localize-title='删除' class=\"btn btn-xs btn-default\" ng-click=\"delete(item)\"><i class=\"fa icon-jj-delete\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/network/virtualSwitch/virtualSwitchItem.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-xs-12\" style=\"padding-left: 8px;\">\r\n\t\t\t\t\t\t<span localize='名称'></span>：{{ hostName }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span localize='网络类型'></span>：{{ type }}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\">\r\n\t\t\t\t\t\t<!-- This area used as dropdown edit box -->\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget edit box -->\r\n\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\"  href=\"#/network/virtualSwitch\"><i class=\"fa  icon-jj-recovery\"></i>&nbsp;<span localize=\"返回\">返回</span></a>\r\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-primary btn-xs isBatch\" ng-disabled=\"hasHA_loading\" data-ng-click=\"add()\"><i class=\"fa icon-jj-addddd\"></i> <span data-localize=\"新增\"></span></button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\"data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t</div> \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive switch-tabel\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center switch-tabel-first\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th> -->\r\n                                        <th localize=\"资源池\"></th>\r\n                                        <th localize=\"关联主机\"></th>\r\n                                        <th localize=\"映射网络适配器\"></th>\r\n                                        <th localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | paging:currentPage:pagesize:rows\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td> -->\r\n\t\t\t\t\t\t\t\t\t\t<td width=\"20%\">{{ item.pool }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td colspan=\"3\" width=\"80%\" class=\"nopadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" class=\"switch-tabel-second\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"host in item.hosts\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"31.5%\">{{ host.hostname }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"48%\" data-ng-if=\"host.dev!==''\">{{ host.dev }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"48%\" data-ng-if=\"host.dev==''\" data-localize=\"无\"></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"hasHA_loading\" localize-title='编辑' class=\"btn btn-xs btn-default\" ng-disabled=\"host.status!=='active'\" ng-click=\"edit(host)\"><i class=\"fa icon-jj-Write\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"hasHA_loading\" localize-title='删除' class=\"btn btn-xs btn-default\" ng-disabled=\"host.status!=='active'\" ng-click=\"delete(host)\"><i class=\"fa icon-jj-delete\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/plan/host_switch.html":"<section data-widget-grid=\"\" id=\"teach-page\">\r\n\t<!-- row -->\r\n\t<div class=\"row\">\r\n\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div  class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\">\r\n\t\t\t\t\t\t<!-- This area used as dropdown edit box -->\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget edit box -->\r\n\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-6 uploadFile \">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-ng-click=\"add()\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" input-number data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll()\" name=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i></i>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\" data-localize=\"任务名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"描述\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"状态\" ng-model=\"enableSort\" ng-click=\"enableSort = !enableSort;sort('enable', enableSort)\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.description }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"switch\" ng-if=\"!item.active_loadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"start_interval\" class=\"switch-checkbox\" id=\"start_interval{{$index}}\" ng-model=\"item.enable\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"switch-label\" data-swchon-text=\"ON\" data-swchoff-text=\"OFF\" ng-click=\"active(item)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/loadingtext.gif\" ng-if=\"item.active_loadding\" height=\"24\" width=\"24\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-default\" data-dialog=\"viewSwitchDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"plan/switch_view.html\" data-localize-title=\"查看详情\"><i class=\"fa icon-jj-look\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" data-ng-click='edit(item)' data-localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-default\" data-ng-if=\"!item.enable\" data-ng-click='delete(item)' data-localize-title=\"删除\"><i class=\"fa icon-jj-delete\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" ><a data-dialog=\"viewSwitchDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"plan/switch_view.html\" data-localize=\"查看详情\"></a></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_split\"></li> -->\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a ng-click=\"edit(currentItem)\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-ng-class=\"{graydisabled:currentItem.active}\" data-localize=\"删除\"></a><span class=\"parameterdisabled\" data-ng-if=\"currentItem.active\"></span></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/plan/switch.html":"<section data-widget-grid=\"\" id=\"teach-page\">\r\n\t<!-- row -->\r\n\t<div class=\"row\">\r\n\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div  class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\">\r\n\t\t\t\t\t\t<!-- This area used as dropdown edit box -->\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget edit box -->\r\n\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-6 uploadFile \">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-dialog=\"addSwitchDialog\" data-dialog-size=\"md\" data-dialog-url=\"plan/switch_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" input-number data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll()\" name=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i></i>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\" data-localize=\"任务名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"描述\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"状态\" ng-model=\"is_activeSort\" ng-click=\"is_activeSort = !is_activeSort;sort('is_active', is_activeSort)\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.desc }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"switch\" ng-if=\"!item.active_loadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"start_interval\" class=\"switch-checkbox\" id=\"start_interval{{$index}}\" ng-model=\"item.is_active\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"switch-label\" data-swchon-text=\"ON\" data-swchoff-text=\"OFF\" ng-click=\"active(item)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/loadingtext.gif\" ng-if=\"item.active_loadding\" height=\"24\" width=\"24\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-default\" data-dialog=\"viewSwitchDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"plan/switch_view.html\" data-localize-title=\"查看详情\"><i class=\"fa icon-jj-look\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" data-dialog=\"editSwitchDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"plan/switch_edit.html\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-default\" data-ng-if=\"!item.is_active\" data-ng-click='delete(item)' data-localize-title=\"删除\"><i class=\"fa icon-jj-delete\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" ><a data-dialog=\"viewSwitchDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"plan/switch_view.html\" data-localize=\"查看详情\"></a></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_split\"></li> -->\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a data-dialog=\"editSwitchDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"plan/switch_edit.html\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-ng-class=\"{graydisabled:currentItem.active}\" data-localize=\"删除\"></a><span class=\"parameterdisabled\" data-ng-if=\"currentItem.active\"></span></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/resource/console/console.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"jarviswidget\"\r\n\t\t\t\tdata-widget-grid\r\n\t\t\t\tdata-widget-editbutton=\"true\"\r\n\t\t\t\tdata-widget-colorbutton=\"true\"\r\n\t\t\t\tdata-widget-togglebutton=\"true\"\r\n\t\t\t\tdata-widget-deletebutton=\"false\"\r\n\t\t\t\tdata-widget-fullscreenbutton=\"true\"\r\n\t\t\t\tdata-widget-custombutton=\"true\"\r\n\t\t\t\tdata-widget-collapsed=\"false\"\r\n\t\t\t\tdata-widget-sortable=\"true\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<!-- <div class=\"form-inline no-footer clearfix\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left_side col-xs-12 col-sm-12\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restart()\"><i class=\"fa icon-jj-Restart\"></i>&nbsp;<span localize=\"重启\">重启</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"poweroff()\"><i class=\"fa icon-jj-shutdown\"></i>&nbsp;<span localize=\"关机\">关机</span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side hidden-xs\">\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div> -->\r\n                        <div class=\"row ha-header\" ng-if=\"haEnabled\">\r\n                            <div class=\"col-xs-6 ha-header-block\">\r\n                                <img ng-src=\"{{'/img/ha/ha-' + (ha.is_split_brain ? 'blue' : 'green') + '.png'}}\" class=\"ha-header-block-icon\"/>\r\n                                <div class=\"ha-header-block-info\">\r\n                                    <p><span localize=\"HA启用状态\"></span><span localize=\"已启用\"></span></p>\r\n                                    <p><span localize=\"数据同步状态\"></span><span ng-style=\"{color: ha.data_sync == 'unsynced' ? 'red' : ''}\">{{ ha | haDataStatus }}</span></p>\r\n                                    <p><span localize=\"HA运行状态\"></span><span ng-style=\"{color: ha.is_split_brain ? 'red' : ''}\">{{ ha | haRunningStatus }}</span></p>\r\n                                    <p><span localize=\"浮动IP地址\"></span>{{ ha.floating_ip }}</p>\r\n                                </div>\r\n                                <div class=\"ha-header-block-tools\">\r\n                                    <button class=\"btn btn-block btn-sm btn-primary\" ng-click=\"viewDetail()\" localize=\"查看详情\"></button>\r\n                                    <button class=\"btn btn-block btn-sm btn-primary\" ng-disabled=\"!switchable\" ng-click=\"switchBrain()\" localize=\"主备控切换\"></button>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"col-xs-6 ha-header-block\">\r\n                                <img src=\"/img/ha/info.png\" class=\"ha-header-block-icon\"/>\r\n                                <div class=\"ha-header-block-info\" localize=\"ha.boottips\"></div>\r\n                                <div class=\"ha-header-block-tools\">\r\n                                    <button class=\"btn btn-block btn-sm btn-primary\" ng-click=\"onekeyShutdown()\" localize=\"一键关机\"></button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\t\t\t\t\t\t<div class=\"padding-20\">\r\n\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t        <div class=\"col-xs-12 col-sm-6 col-md-4 col-lg-3\"\r\n\t\t\t\t\t\t        \tdata-ng-repeat=\"item in rows track by $index\">\r\n\r\n\t\t\t\t\t\t            <div class=\"panel pricing-big\" ng-class=\"{'panel-primary':item.status=='active','panel-darken':item.status!='active'} \">\r\n\t\t\t\t\t\t            \t<div class=\"ribbon\" ng-if=\"item.role ==='controller'\">\r\n\t\t\t\t\t\t\t            \t<img data-ng-if=\"current_theme =='smart-style-0'\" key=\"host_style0\" base64>\r\n\t\t\t\t\t\t\t            \t<img data-ng-if=\"current_theme =='smart-style-1'\" key=\"host_style1\" base64>\r\n\t\t\t\t\t\t            \t</div>\r\n\t\t\t\t\t\t            \t<div class=\"ribbon\" ng-if=\"item.role ==='backup'\">\r\n\t\t\t\t\t\t\t            \t<img data-ng-if=\"current_theme =='smart-style-0'\" key=\"backuphost_style0\" base64>\r\n\t\t\t\t\t\t\t            \t<img data-ng-if=\"current_theme =='smart-style-1'\" key=\"backuphost_style1\" base64>\r\n\t\t\t\t\t\t            \t</div>\r\n \t\t\t\t\t\t\t\t\t\t<div class=\"panel-heading smart-form mypanelhead\">\r\n\t\t\t\t\t\t                \t<div class=\"padding-left-15\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <label class=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"checkbox style-0\" data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" data-ng-value=\"item.id\" ><span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label> -->\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t                    <div class=\"panel-cont\">\r\n\t\t\t\t\t\t\t                    <ul>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item panel-title\">\r\n\t\t\t\t\t\t\t                    \t\t<label><img  ng-show=\"item.status==='building'\" ng-src=\"img/ajax-loader.gif\" style=\"width:48px;height:48px;\"></label>\r\n\t\t\t\t\t\t\t                    \t\t<h2 class=\"item-flex\">\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"host_title\" title=\"{{item.hostname}}\">{{item.hostname}}</div>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\">{{item.ip}}</span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small red\" ng-show=\"item.status==='inactive'\" localize=\"服务状态异常\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\" ng-show=\"item.status==='maintenance'\" localize=\"维护中...\">维护中...</span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\" ng-show=\"item.status==='building'\" localize=\"创建中...\">创建中...</span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\" ng-show=\"item.status==='active'||item.status==='offline'\">&nbsp;</span>\r\n\t\t\t\t\t\t\t                    \t\t</h2>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label>CPU</label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">\r\n                                                            <div>{{item.cpu_idle?(100 - item.cpu_idle).toFixed(1):0.0}}% &nbsp;<span class=\"pull-right\">100%</span></div>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"progress progress-micro\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"progress-bar  progress-bar-primary\" role=\"progressbar\" ng-class=\"{'bg-color-greenLight':item.cpu_idle&&item.cpu_idle>=60,'bg-color-yellowLight':item.cpu_idle&&item.cpu_idle>20&&item.cpu_idle<60,'bg-color-redLight':item.cpu_idle&&item.cpu_idle<20}\" ng-style=\"{width:(item.cpu_idle?(100 - item.cpu_idle):0.0)+'%'}\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label localize=\"内存\">内存</label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">\r\n\t\t\t\t\t\t\t                    \t\t\t<div><span class=\"pull-left\">{{item.memory_mb_used}}</span>&nbsp;<span class=\"pull-right\">{{item.memory_mb}} GB</span> </div>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"progress progress-micro\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"progress-bar  progress-bar-primary\" role=\"progressbar\" ng-class=\"{'bg-color-greenLight':item.memory_mb_used/item.memory_mb*100<=60,'bg-color-redLight':item.memory_mb_used/item.memory_mb*100>=80,'bg-color-yellowLight':item.memory_mb_used/item.memory_mb*100>60&&item.memory_mb_used/item.memory_mb*100<80}\" ng-style=\"{width:(item.memory_mb_used/item.memory_mb*100)+'%'}\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label localize=\"存储\"></label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">\r\n\t\t\t\t\t\t\t                    \t\t\t<div><span class=\"pull-left\">{{item.disk_gb_used}}</span>&nbsp;<span class=\"pull-right\">{{item.disk_gb}} GB</span> </div>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"progress progress-micro\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"progress-bar  progress-bar-primary\" role=\"progressbar\" ng-class=\"{'bg-color-greenLight':item.disk_gb_used/item.disk_gb*100<=60,'bg-color-redLight':item.disk_gb_used/item.disk_gb*100>=80,'bg-color-yellowLight':item.disk_gb_used/item.disk_gb*100>60&&item.disk_gb_used/item.disk_gb*100<80}\" ng-style=\"{width:(item.disk_gb_used/item.disk_gb*100)+'%'}\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                  \t</ul>\r\n\t\t\t\t\t\t                  \t</div>\r\n\t\t\t\t\t\t                  \t<div class=\"panel-footbar\" data-ng-class=\"{'darken':item.status!='active','primary':item.status=='active'}\">\r\n\t\t\t\t\t\t                  \t\t<a class=\"icon\" href=\"javascript:\" data-ng-click=\"restart(item)\" data-localize-title=\"重启\"><i class=\"fa icon-jj-Restart\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"icon\" ng-if=\"item.role ==='controller'\" href=\"javascript:\" data-ng-click=\"poweroff(item)\" data-localize-title=\"关机\"><i class=\"fa icon-jj-shutdown\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"icon\" ng-if=\"item.role ==='backup'\" href=\"javascript:\" data-ng-click=\"poweroffBackup(item)\" data-localize-title=\"关机\"><i class=\"fa icon-jj-shutdown\"></i></a>\r\n\r\n\t\t\t\t\t\t                \t\t<a href=\"javascript:void(0)\" data-ng-if=\"(item.status=='active' || item.status=='inactive') && item.role ==='controller'\" class=\"icon\" data-localize-title=\"HA配置\" ng-click=\"openHAConfigDialog(item)\"><i class=\"fa icon-jj-001\"></i></a>\r\n\t\t\t\t\t\t                \t\t<a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"高级\" ng-click=\"openHostMoreDialog(item)\"><i class=\"fa icon-jj-010\"></i></a>\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t        </div>\r\n\t\t\t\t    \t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>\r\n","views/vdi/resource/pool/host.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"jarviswidget\"\r\n\t\t\t\tdata-widget-grid\r\n\t\t\t\tdata-widget-editbutton=\"true\"\r\n\t\t\t\tdata-widget-colorbutton=\"true\"\r\n\t\t\t\tdata-widget-togglebutton=\"true\"\r\n\t\t\t\tdata-widget-deletebutton=\"false\"\r\n\t\t\t\tdata-widget-fullscreenbutton=\"true\"\r\n\t\t\t\tdata-widget-custombutton=\"true\"\r\n\t\t\t\tdata-widget-collapsed=\"false\"\r\n\t\t\t\tdata-widget-sortable=\"true\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer clearfix\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left_side col-xs-10 col-sm-10\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" href=\"#/resource/pool\"><i class=\"fa  icon-jj-recovery\"></i>&nbsp;<span localize=\"返回\">返回</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" ng-show=\"vtype=='kvm'\" href=\"javascript:\" data-dialog=\"addHostDialog\" data-dialog-url=\"resource/pool/new_host.html\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"添加计算节点\">添加计算节点</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" ng-show=\"vtype=='hyper-v'\"  href=\"javascript:\" data-dialog=\"addHostDialog\" data-dialog-url=\"resource/pool/new_host_hyperv.html\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"添加计算节点\">添加计算节点</span></a>\r\n\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"configStorage()\"><i class=\"fa icon-jj-Restart\"></i>&nbsp;<span localize=\"配置存储\">配置存储</span></a> -->\r\n\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-dialog=\"configPubStorageDialog\" data-dialog-url=\"resource/pool/config_pub_storage.html\"><i class=\"fa icon-jj-Restart\"></i>&nbsp;<span localize=\"配置公共存储\">配置公共存储</span></a> -->\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restart()\"><i class=\"fa icon-jj-Restart\"></i>&nbsp;<span localize=\"重启\">重启</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"poweroff()\"><i class=\"fa icon-jj-shutdown\"></i>&nbsp;<span localize=\"关机\">关机</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"recovery()\"><i class=\"fa icon-jj-Recovery\"></i>&nbsp;<span localize=\"恢复\">恢复</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" href=\"javascript:\" data-ng-click=\"maintain()\"><i class=\"fa icon-jj-007\"></i>&nbsp;<span localize=\"维护\">维护</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" href=\"javascript:\" data-ng-click=\"delete()\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-2 col-sm-2\">\r\n\t\t\t\t\t\t\t\t\t<select class=\"selectclassroomName filter\" ng-model=\"order\" data-ng-options=\"order.name for order in orders\" data-ng-change=\"sortTem(order.val)\"></select>\r\n\t\t\t\t\t\t\t\t\t<!--<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restarVirtical\">重启虚拟化服务</a>-->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"padding-20\">\r\n\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t        <div class=\"col-xs-12 col-sm-6 col-md-4 col-lg-3\"\r\n\t\t\t\t\t\t        \tdata-ng-repeat=\"item in rows track by $index\">\r\n\r\n\t\t\t\t\t\t            <div class=\"panel pricing-big\" ng-class=\"{'panel-primary':item.status=='active','panel-darken':item.status!='active'} \">\r\n \t\t\t\t\t\t\t\t\t\t<div class=\"panel-heading smart-form mypanelhead\">\r\n\t\t\t\t\t\t                \t<div class=\"padding-left-15\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"checkbox style-0\" data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" data-ng-value=\"item.id\" ><span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t                    <div class=\"panel-cont\">\r\n\t\t\t\t\t\t\t                    <ul class=\"panel-mess\">\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item panel-title \">\r\n\t\t\t\t\t\t\t                    \t\t<label><img  ng-show=\"item.status==='building'\" ng-src=\"img/ajax-loader.gif\" style=\"width:48px;height:48px;\"></label>\r\n\t\t\t\t\t\t\t                    \t\t<h2 class=\"item-flex\">\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"host_title\" title=\"{{item.host}}\">{{item.host}}</div>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\">{{item.ip}}</span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small red\" ng-show=\"item.status==='inactive'\" localize=\"服务状态异常\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\" ng-show=\"item.status==='maintenance'\" localize=\"维护中...\">维护中...</span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\" ng-show=\"item.status==='building'\" localize=\"创建中...\">创建中...</span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span class=\"small\" ng-show=\"item.status==='active'||item.status==='offline'\">&nbsp;</span>\r\n\t\t\t\t\t\t\t                    \t\t</h2>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label localize-title=\"DESKTOP\" localize=\"DESKTOP\">桌面</label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">\r\n                                                            <div>{{item.inst_run}}  &nbsp;&nbsp;<span class=\"pull-right\">{{item.inst_total}} <em class=\"font-w\" localize=\"个\"></em></span></div>\r\n                                                            <div class=\"progress progress-micro\">\r\n                                                                <div class=\"progress-bar  progress-bar-primary\" role=\"progressbar\" ng-class=\"{'bg-color-greenLight':item.inst_run/item.inst_total*100<=50,'bg-color-redLight':item.inst_run/item.inst_total*100>=80,'bg-color-yellowLight':item.inst_run/item.inst_total*100>50&&item.inst_run/item.inst_total*100<80}\" ng-style=\"{width:(item.inst_run/item.inst_total*100)+'%'}\"></div>\r\n                                                            </div>\r\n                                                            <!--<div class=\"pull-right\">个</div>-->\r\n                                                        </div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label title=\"CPU\">CPU</label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">\r\n                                                            <div>{{item.cpu_used}} &nbsp;<span class=\"pull-right\">{{item.h_cpu}} <em class=\"font-w\" localize=\"核\">核</em></span></div>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"progress progress-micro\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"progress-bar  progress-bar-primary\" role=\"progressbar\" ng-class=\"{'bg-color-greenLight':item.cpu_used/item.h_cpu<=1,'bg-color-yellowLight':item.cpu_used/item.h_cpu>1&&item.cpu_used/item.h_cpu<2,'bg-color-redLight':item.cpu_used/item.h_cpu>2}\" ng-style=\"{width:(item.cpu_used/item.h_cpu*100)+'%'}\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n                                                            <!--<div class=\"pull-right\">核</div>-->\r\n                                                            <!--<div class=\"pull-right\"> V:{{item.v_cpu}}</div>-->\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label localize-title=\"内存\" localize=\"内存\">内存</label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">\r\n\t\t\t\t\t\t\t                    \t\t\t<div><span class=\"pull-left\">{{item.mem_used}}</span>&nbsp;<span class=\"pull-right\">{{item.h_mem}} GB</span> </div>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"progress progress-micro\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"progress-bar  progress-bar-primary\" role=\"progressbar\" ng-class=\"{'bg-color-greenLight':item.mem_used/item.h_mem*100<=60,'bg-color-redLight':item.mem_used/item.h_mem*100>=80,'bg-color-yellowLight':item.mem_used/item.h_mem*100>60&&item.mem_used/item.h_mem*100<80}\" ng-style=\"{width:(item.mem_used/item.h_mem*100)+'%'}\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n                                                            <!--<div class=\"pull-right\">GB</div>-->\r\n                                                            <!--<div class=\"pull-right\"> V:{{item.v_mem}}GB</div>-->\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label localize-title=\"镜像存储\" localize=\"镜像存储\"></label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">\r\n\t\t\t\t\t\t\t                    \t\t\t<div><span class=\"pull-left\">{{(item.disk_used).toFixed(0)}}</span>&nbsp;<span class=\"pull-right\">{{(item.h_disk).toFixed(0)}} GB</span> </div>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"progress progress-micro\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"progress-bar  progress-bar-primary\" role=\"progressbar\" ng-class=\"{'bg-color-greenLight':item.disk_used/item.h_disk*100<=60,'bg-color-redLight':item.disk_used/item.h_disk*100>=80,'bg-color-yellowLight':item.disk_used/item.h_disk*100>60&&item.disk_used/item.h_disk*100<80}\" ng-style=\"{width:(item.disk_used/item.h_disk*100)+'%'}\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n                                                            <!--<div class=\"pull-right\">GB</div>-->\r\n                                                            <!--<div class=\"pull-right\"> V:{{item.v_mem}}GB</div>-->\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                  \t</ul>\r\n\t\t\t\t\t\t                  \t</div>\r\n\t\t\t\t\t\t                  \t<div class=\"panel-footbar\" data-ng-class=\"{'darken':item.status!='active','primary':item.status=='active'}\">\r\n\t\t\t\t\t\t                \t\t<a href=\"javascript:void(0)\" data-ng-if=\"(item.status=='active' || item.status=='inactive') && !item.rbd_enabled\" class=\"icon\" data-localize-title=\"配置存储\" ng-click=\"configStorage(item)\"><i class=\"fa icon-jj-009\"></i></a>\r\n\t\t\t\t\t\t                \t\t<a href=\"javascript:void(0)\" data-ng-if=\"item.status=='active' || item.status=='inactive'\" class=\"icon\" data-localize-title=\"高级\" ng-click=\"openHostMoreDialog(item)\"><i class=\"fa icon-jj-010\"></i></a>\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t        </div>\r\n\t\t\t\t    \t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>","views/vdi/resource/pool/pool.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-xs-6 col-sm-6\">\r\n                                    <button class=\"btn btn-primary btn-xs\" data-dialog=\"newPoolDialog\" data-dialog-url=\"resource/pool/new_pool.html\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"新增资源池\">新增资源池</span></button>\r\n                                    <!-- <button class=\"btn btn-danger btn-xs\" data-ng-class=\"{disabled:!checkOne()}\" ng-click=\"delete()\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></button> -->\r\n                                    <!-- <ul class=\"dropdown-menu\">\r\n                                        <li><a class=\"isBatch text-center\" href=\"javascript:\" ng-click=\"open_storage_dialog('logic')\" localize=\"普通网络\"></a></li>\r\n                                        <li><a class=\"isBatch text-center\" href=\"javascript:\" ng-click=\"open_storage_dialog('vlan')\">VLAN</a></li>\r\n                                    </ul> -->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\" data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t</div> \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-bordered table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll()\" name=\"checkbox-inline\"><i></i></label></th> -->\r\n\t\t\t\t\t\t\t\t\t\t\r\n                                        <th localize=\"资源池名称\">资源池名称</th>\r\n                                        <th localize=\"类型\">类型</th>\r\n                                        <th localize=\"主机数量\">主机数量</th>\r\n\r\n                                        <th localize=\"状态\">状态</th>\r\n                                        <th localize=\"描述\">描述</th>\r\n\t\t\t\t\t\t\t\t\r\n                                        <th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | paging:currentPage:pagesize:rows\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td> -->\r\n\r\n                                        <td><a href=\"#/resource/pool/{{item.uuid}}/{{item.type}}\">{{item.name}}</a></td>\r\n                                        <td>{{item.type}}</td>\r\n                                        <td>{{item.hosts.length}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"icon icon-jj-yes txt-color-greenjj\" ng-show=\"item.status=='normal'\" localize-title=\"正常\"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"icon icon-jj-Warning txt-color-redjj\" ng-show=\"item.status!='normal'\" localize-title=\"异常\"></i>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td style=\"width:50%;word-break: break-all\">{{item.description}}</td>\r\n\r\n                                        <td class=\"nowrap\"> \r\n                                        \t<div>\r\n                                        \t\t<button localize-title='添加计算节点' ng-show=\"item.type=='kvm'\" class=\"btn btn-xs btn-default\" data-dialog=\"addHostDialog\" data-dialog-url=\"resource/pool/new_host.html\"><i class=\"fa icon-jj-add-1\"></i></button>\r\n                                        \t\t<button localize-title='添加计算节点' ng-show=\"item.type=='hyper-v'\" class=\"btn btn-xs btn-default\" data-dialog=\"addHostDialog\" data-dialog-url=\"resource/pool/new_host_hyperv.html\"><i class=\"fa icon-jj-add-1\"></i></button>\r\n                                        \t\t<!-- <abbr class=\"abbr-title\" localize-title='不可编辑'><button class=\"btn btn-xs btn-default\" ng-disabled=\"item.un_edit\" ng-show=\"item.un_edit\"><i class=\"fa icon-jj-Write\"></i></button></abbr> -->\r\n                                        \t\t<button localize-title='编辑' class=\"btn btn-xs btn-default\" ng-click=\"edit(item)\"><i class=\"fa icon-jj-Write\"></i></button>\r\n                                        \t\t<!-- <abbr ng-show=\"item.hosts.length>0&&item.name!=='default'\" class=\"abbr-title\" localize-title='不可删除'><button class=\"btn btn-xs btn-default\" disabled><i class=\"fa icon-jj-delete\"></i></button></abbr> -->\r\n                                        \t\t<button localize-title='删除' class=\"btn btn-xs btn-default\" ng-show=\"item.hosts.length==0&&item.name!=='default'\" ng-click=\"delete(item)\"><i class=\"fa icon-jj-delete\"></i></button>\r\n                                        \t</div>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>","views/vdi/resource/storage/storage.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t<a class=\"btn btn-xs btn-primary\" href=\"javascript:\" data-dialog=\"configPublicStorageDialog\" data-dialog-url=\"resource/storage/config_pub_storage.html\" data-dialog-size=\"md\"><i class=\"fa icon-jj-009\"></i>&nbsp;<span localize=\"配置公共存储\">配置公共存储</span></a>\r\n\t\t\t\t<header class=\"storage_header\" localize=\"本地存储\">\r\n\t\t\t\t</header>\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t\t<div class=\"storage-dt-toolbar\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"left-btn-group left_side col-xs-12 col-sm-4 col-md-4\">\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"right_side col-sm-8 col-xs-10 hidden-xs col-md-8\"> \t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<span data-localize=\"资源池\">资源池</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<select class=\"selectServer\" ng-model=\"select_pool_local\" ng-change=\"filterLocalStorage(select_pool_local.name)\"  ng-options=\"pool.name for pool in pools track by pool.id\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" data-localize=\"所有\">所有</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive storage-tabel\">\r\n\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" \r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form storage-tabel-first\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"资源池\" width=\"10%\">资源池</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"主机\" width=\"11%\">主机</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"分配类型\" width=\"11%\">分配类型</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"存储服务器\" width=\"11%\">存储服务器</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"存储类型\" width=\"11%\">存储类型</th>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"存储名\" width=\"11%\">存储名</th>\r\n\t\t\t\t\t\t\t\t\t\t<th width=\"10%\"><span localize=\"总容量\"></span>(GB)</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th width=\"5%\"><span localize=\"可用空间\"></span>(GB)</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body rowspan3\">\r\n\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"(key,pool) in datas.local_storages\">\r\n\t\t\t\t\t\t\t\t\t\t<td>{{key}}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td colspan=\"9\" class=\"nopadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" class=\"storage-tabel-second\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"server in pool.servers track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{server.ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"8\" class=\"nopadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" class=\"storage-tabel-third\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"storage in server.storages track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- <span ng-if=\"storage.storage_type==1\" localize=\"基础镜像存储设备\">基础镜像存储设备</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"storage.storage_type==2\" localize=\"性能型存储设备\">性能型存储设备</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"storage.storage_type==3\" localize=\"容量型存储设备\">容量型存储设备</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"storage.storage_type=='cache'\" localize=\"主机缓存设备\">主机缓存设备</span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{{storage.storage_type}}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- <span ng-if=\"storage.storage_type==4\" localize=\"公共型存储\">公共型存储</span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.device_type}}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.name}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><span ng-show=\"storage.total_size\">{{storage.total_size}}</span><span ng-show=\"!storage.total_size\">--</span></td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><span ng-show=\"storage.free_size\">{{storage.free_size}}</span><span ng-show=\"!storage.free_size\">--</span></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-show=\"!loading && get_obj_length(datas.local_storages) == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div data-grid-pagination data-ng-show=\"(totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length) > 0\" class=\"dt-toolbar-footer row\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-xs-12 hidden-xs\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"dataTables_info\" role=\"status\"\r\n\t\t\t\t\t\t\t\t\t\tdata-localize=\"PAGE\"\r\n\t\t\t\t\t\t\t\t\t\tparam1=\"{{ (currentPage - 1) * pagesize + 1 }}\" \r\n\t\t\t\t\t\t\t\t\t\tparam2=\"{{ currentPage * pagesize < (totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length) ? currentPage * pagesize : (totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length) }}\"\r\n\t\t\t\t\t\t\t\t\t\tparam3=\"{{ totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length }}\"\r\n\t\t\t\t\t\t\t\t\t></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"dataTables_paginate paging_simple_numbers\">\r\n\t\t\t\t\t\t\t\t\t\t<pagination\r\n\t\t\t\t\t\t\t\t\t\t\tboundary-links=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\ttotal-items=\"totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length\"\r\n\t\t\t\t\t\t\t\t\t\t\titems-per-page=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"$parent.currentPage\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageChange()\"\r\n\t\t\t\t\t\t\t\t\t\t\trotate=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\tmax-size=\"10\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"pagination-sm\"\r\n\t\t\t\t\t\t\t\t\t\t\tprevious-text=\"&lsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\tnext-text=\"&rsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\tfirst-text=\"&laquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\tlast-text=\"&raquo;\"\r\n\t\t\t\t\t\t\t\t\t\t></pagination>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t\t<header class=\"storage_header\" localize=\"远端存储\"></header>\r\n\t\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t\t<div class=\"storage-dt-toolbar\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"left-btn-group left_side col-xs-12 col-sm-4 col-md-4\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" href=\"javascript:\" data-dialog=\"addStorageDialog\" data-dialog-url=\"resource/storage/new_storage.html\" data-dialog-size=\"md\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"添加存储\">添加存储</span></a>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"right_side col-sm-8 col-xs-10 hidden-xs col-md-8\"> \t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <span data-localize=\"资源池\">资源池</span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <select class=\"selectServer\" ng-model=\"select_pool_remote\" ng-options=\"pool.name for pool in datas.remote_assigned_storages\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\" data-localize=\"所有\">所有</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <div class=\"pull-right filter\"> <span localize=\"显示\">显示</span> <select data-ng-model=\"pagesize\"  ng-change=\"pageSizeChange()\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"10\" >10</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"20\" >20</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"30\" >30</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select> <span localize=\"项结果\"></span> </div> -->\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<tabset>\r\n\t\t\t\t\t\t\t\t<tab heading=\"已分配存储\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"table-responsive storage-tabel\">\r\n\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" \r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form storage-tabel-first\">\r\n\t\t\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\" localize=\"资源池\">资源池</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"11%\" localize=\"主机\">主机</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"12%\" localize=\"分配类型\">分配类型</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"11%\" localize=\"存储服务器\">存储服务器</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\" localize=\"存储类型\">存储类型</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\" localize=\"存储名\">存储名</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"11%\" localize=\"精简配置\">精简配置</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\" localize=\"存储控制节点\">存储控制节点</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"9%\"><span localize=\"总容量\"></span>(GB)</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th><span localize=\"可用空间\"></span>(GB)</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body rowspan3\">\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"(key,pool) in datas.remote_assigned_storages track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{pool.name}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"9\" class=\"nopadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" class=\"storage-tabel-second\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"server in pool.servers track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td style=\"width:12.3%\">{{server.ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"8\" class=\"nopadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" class=\"storage-tabel-third\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"storage in server.storages track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- <span ng-if=\"storage.storage_type==1\" localize=\"基础镜像存储设备\">基础镜像存储设备</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"storage.storage_type==2\" localize=\"性能型存储设备\">性能型存储设备</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"storage.storage_type==3\" localize=\"容量型存储设备\">容量型存储设备</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"storage.storage_type=='cache'\" localize=\"主机缓存设备\">主机缓存设备</span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- <span ng-if=\"storage.storage_type==4\" localize=\"公共型存储\">公共型存储</span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{{storage.storage_type}}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.device_type}}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.name}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span localize=\"启用\" ng-if=\"storage.dynamic_lv\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span localize=\"未启用\" ng-if=\"!storage.dynamic_lv\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.storage_control_ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><span ng-show=\"storage.total_size\">{{storage.total_size}}</span><span ng-show=\"!storage.total_size\">--</span></td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td style=\"width:7%\"><span ng-show=\"storage.free_size\">{{storage.free_size}}</span><span ng-show=\"!storage.free_size\">--</span></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && get_obj_length(datas.remote_assigned_storages)===0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t\t\t</tab>\r\n\t\t\t\t\t\t\t\t<tab heading=\"未分配存储\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"table-responsive storage-tabel storage-tabel-unsigned\">\r\n\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" \r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form storage-tabel-first\">\r\n\t\t\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th localize=\"存储类型\" width=\"12%\">存储类型</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th localize=\"存储服务器\" width=\"13%\">存储服务器</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th localize=\"存储名\" width=\"11%\">存储名</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th localize=\"精简配置\" width=\"11%\">精简配置</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th localize=\"存储用途\" width=\"11%\">存储用途</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th localize=\"存储控制节点\" width=\"11%\">存储控制节点</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"11%\"><span localize=\"总容量\"></span>(GB)</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\"><span localize=\"可用空间\"></span>(GB)</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<th localize=\"操作\" width=\"7%\">操作</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body rowspan3\">\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"(storage_type,type_val) in datas.remote_unassigned_storages track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage_type}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"8\" class=\"nopadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" class=\"storage-tabel-second\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"(storage_ip,ip_val) in type_val track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage_ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"6\" class=\"nopadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" class=\"storage-tabel-third\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"storage in ip_val track by $index\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.name}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span localize=\"启用\" ng-if=\"storage.dynamic_lv\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span localize=\"未启用\" ng-if=\"!storage.dynamic_lv\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p ng-show=\"storage.storage_usability=='instance'\" localize=\"桌面磁盘镜像存储\"></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p ng-show=\"storage.storage_usability=='local'\" localize=\"本地文件共享存储\"></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{storage.storage_control_ip}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><span ng-show=\"storage.total_size\">{{storage.total_size}}</span><span ng-show=\"!storage.total_size\">--</span></td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><span ng-show=\"storage.free_size\">{{storage.free_size}}</span><span ng-show=\"!storage.free_size\">--</span></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><button localize-title=\"删除\" class=\"btn btn-xs btn-default\" ng-hide=\"storage.device_type=='local'\" ng-click=\"delete(storage)\" title=\"删除\"><i class=\"fa icon-jj-delete\"></i></button></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && get_obj_length(datas.remote_unassigned_storages)===0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t\t\t</tab>\r\n\t\t\t\t\t\t\t</tabset>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<div data-grid-pagination data-ng-show=\"(totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length) > 0\" class=\"dt-toolbar-footer row\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-xs-12 hidden-xs\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"dataTables_info\" role=\"status\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-localize=\"PAGE\"\r\n\t\t\t\t\t\t\t\t\t\t\tparam1=\"{{ (currentPage - 1) * pagesize + 1 }}\" \r\n\t\t\t\t\t\t\t\t\t\t\tparam2=\"{{ currentPage * pagesize < (totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length) ? currentPage * pagesize : (totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length) }}\"\r\n\t\t\t\t\t\t\t\t\t\t\tparam3=\"{{ totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length }}\"\r\n\t\t\t\t\t\t\t\t\t\t></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"dataTables_paginate paging_simple_numbers\">\r\n\t\t\t\t\t\t\t\t\t\t\t<pagination\r\n\t\t\t\t\t\t\t\t\t\t\t\tboundary-links=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttotal-items=\"totalCount || (rows | filter:select | paging:currentPage:pagesize:rows).length\"\r\n\t\t\t\t\t\t\t\t\t\t\t\titems-per-page=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"$parent.currentPage\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageChange()\"\r\n\t\t\t\t\t\t\t\t\t\t\t\trotate=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tmax-size=\"10\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"pagination-sm\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tprevious-text=\"&lsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tnext-text=\"&rsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tfirst-text=\"&laquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tlast-text=\"&raquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\t></pagination>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>","views/vdi/scheduler/view.html":"<style>\r\n.vdi_scheduler_week_button{\r\n\tposition:relative;\r\n\tpadding:20px 0;\r\n\tmargin:4px 4px 0 0;\r\n\ttext-align:center;\r\n\twidth:85px;\r\n}\r\n.vdi_scheduler_week_button.selected{\r\n\tbackground:#456b7b;\r\n}\r\n.vdi_scheduler_week_button label.checkbox{\r\n\tposition:absolute;\r\n\ttop:0;\r\n\tleft:3px;\r\n}\r\n.vdi_scheduler_week_button label.checkbox i{\r\n\twidth:13px;\r\n\theight:13px;\r\n\tdisplay:none;\r\n}\r\n.vdi_scheduler_week_button:hover label.checkbox i,\r\n.vdi_scheduler_week_button label.checkbox input[type=\"checkbox\"]:checked+i{\r\n\tdisplay:block;\r\n}\r\n.vdi_scheduler_week_button label.checkbox i::after{\r\n\tfont-size:12px;\r\n\ttop:-2px;\r\n\tleft:-1px;\r\n}\r\n.scheduler_label{\r\n\tmargin: 0 30px 4px 0;\r\n}\r\ntable.scheduler{\r\n\tbackground:#999;\r\n}\r\ntable.scheduler caption{\r\n\tdisplay:none;\r\n}\r\ntable.scheduler td, table.scheduler th{\r\n\tbackground:#fff;\r\n\tfont-size:12px/18px;\r\n}\r\ntable.scheduler th{\r\n\ttext-align:center;\r\n\tpadding:4px 8px;\r\n}\r\n.class_hour_list{\r\n\tmargin:0;\r\n\tpadding:0;\r\n\tlist-style-position:inside;\r\n\tlist-style-type:none;/*decimal-leading-zero;*/\r\n\ttext-align:center;\r\n}\r\n.class_hour_list.no_index{\r\n\tlist-style-type:none;\r\n}\r\n.class_hour_list li{\r\n\tborder-top:1px solid #999;\r\n\theight:48px;\r\n\tline-height:48px;\r\n}\r\n.class_hour_list li:first-child{\r\n\tborder-top:0 none;\r\n}\r\n.class_hour_cell.active{\r\n\tbackground:red;\r\n}\r\n.class_day{\r\n\tposition:relative;\r\n}\r\n.class_day .scene_in_day{\r\n\tposition:absolute;\r\n\ttop:0;left:0;\r\n\tbottom:0;right:0;\r\n\ttransform:translate(0,0);\r\n\t-moz-transform:translate(0,0);\r\n\t-ms-transform:translate(0,0);\r\n\t-webkit-transform:translate(0,0);\r\n}\r\n.scene_in_day .scene_in_day_item{\r\n\tposition:absolute;\r\n\twidth:100%;\r\n}\r\n.scene_in_day_item>.item_body{\r\n\tmargin:4px;\r\n\tbackground:transparent;\r\n\theight:100%;\r\n\tborder-radius:4px;\r\n\tposition:relative;\r\n}\r\n.scene_in_day_item>.item_body .item_dnd_body{\r\n\theight:100%;\r\n\ttext-align:center;\r\n\tpadding:10px;\r\n\tcolor:#fff;\r\n\toverflow:hidden;\r\n\tline-height:24px;\r\n\tword-wrap:break-word;\r\n\tword-break:break-word;\r\n}\r\n.scene_in_day_item.modifiable>.item_body .item_dnd_body{\r\n\tcursor:move;\r\n}\r\n.scene_in_day_item>.item_body .item_dnd_header,\r\n.scene_in_day_item>.item_body .item_dnd_footer{\r\n\tcursor:n-resize;\r\n\theight:8px;\r\n\tposition:absolute;\r\n\twidth:100%;\r\n\tbackground:rgba(255,255,255,.6);\r\n\tdisplay:none;\r\n}\r\n.scene_in_day_item.modifiable>.item_body .item_dnd_header,\r\n.scene_in_day_item.modifiable>.item_body .item_dnd_footer{\r\n\tdisplay:block;\r\n}\r\n.scene_in_day_item>.item_body .item_dnd_header:hover,\r\n.scene_in_day_item>.item_body .item_dnd_footer:hover{\r\n\tbackground:rgba(255,255,255,.9);\r\n}\r\n.scene_in_day_item>.item_body .item_dnd_header{\r\n\ttop:0;\r\n}\r\n.scene_in_day_item>.item_body .item_dnd_footer{\r\n\tbottom:0;\r\n}\r\n.scene_in_day_item>.item_body .item_remove{\r\n\tposition:absolute;\r\n\ttop:-2px;\r\n\tright:-2px;\r\n\tfont-size:14px;\r\n\twidth:18px;\r\n\ttext-align:center;\r\n\theight:18px;\r\n\tbackground:#c00;\r\n\tcolor:#fff;\r\n\tline-height:18px;\r\n\tborder-radius:50%;\r\n\tbox-shadow:0 0 1px #000;\r\n\tcursor:pointer;\r\n\tdisplay:none;\r\n}\r\n.scene_in_day_item.modifiable:hover>.item_body .item_remove{\r\n\tdisplay:block;\r\n}\r\n.scene_item{\r\n/*\tborder:1px solid #666;\r\n\tborder-radius:4px;\r\n*/\tmargin:0 8px 8px 0;\r\n\tcursor:move;\r\n\twidth:100%;\r\n\theight:36px;\r\n\ttext-align:center;\r\n\tline-height:36px;\r\n\t-user-select:none;\r\n\tcolor:#fff;\r\n\toverflow:hidden;\r\n\tword-wrap:break-word;\r\n\tword-break:break-word;\r\n}\r\n.disabled .scene_item{\r\n\tcursor:default;\r\n}\r\n.scheduler_canvas{\r\n\r\n}\r\n.scheduler_dnd_canvas{\r\n\tposition:fixed;\r\n\ttop:0;\r\n\tleft:0;\r\n\tbottom:0;\r\n\tright:0;\r\n\tbackground:transparent;\r\n\tz-index:99999;\r\n}\r\n.scheduler_dnd_canvas .dnd_handler{\r\n\tposition:absolute;\r\n\topacity:.9;\r\n}\r\n.scheduler_dnd_canvas .dnd_masker{\r\n\twidth:100%;\r\n\theight:100%;\r\n\tposition:relative;\r\n\tbackground:transparent;\r\n\tcursor:move;\r\n}\r\n.btn.disabled{\r\n\topacity:.8!important;\r\n}\r\n</style>\r\n<div ng-show=\"weeks.length\">\r\n\t<div class=\"toolbar\">\r\n\t\t<div class=\"col-xs-8 col-md-8 col-lg-8 col-sm-8\">\r\n\t\t\t<div class=\"inline-goup\">\r\n\t\t\t\t<label data-localize='教室'></label>\r\n\t\t\t\t<label>\r\n\t\t\t\t\t<select class=\"input-sm\" ng-disabled=\"editMode\" ng-model=\"class\" ng-change=\"classChange()\" ng-options=\"class.name for class in classes track by class.id\"></select>\r\n\t\t\t\t</label>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"col-xs-4 col-md-4 col-lg-4 col-sm-4 text-right\">\r\n\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t<button class=\"btn btn-default\" ng-class=\"{disabled: editMode}\" ng-click=\"setting()\" data-localize=\"课时设置\"></button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<!--  -->\r\n\t<div data-scheduler-canvas>\r\n\t\t<div class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<form class=\"smart-form col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div class=\"btn btn-default vdi_scheduler_week_button\"\r\n\t\t\t\t\t\tng-model=\"$parent.currentWeek\"\r\n\t\t\t\t\t\tbtn-radio=\"week\"\r\n\t\t\t\t\t\tng-repeat=\"week in weeks track by $index\"\r\n\t\t\t\t\t\tng-class=\"{disabled: editMode}\"\r\n\t\t\t\t\t\tstyle=\"background:{{ week.current ? '#cde0c4' : '' }}\"\r\n\t\t\t\t\t><label class=\"checkbox\" onclick=\"arguments && arguments[0] && arguments[0].stopPropagation()\"><input ng-model=\"week.checked\" ng-checked=\"week.checked\" type=\"checkbox\"><i></i></label>\r\n\t\t\t\t\t\t<div data-localize='{{ week.name }}'></div>\r\n\t\t\t\t\t\t<small>{{ week.start | date:\"MM/dd\" }} - {{ week.end - 864e5 | date:\"MM/dd\" }}</small>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div class=\"col-xs-5 col-sm-5 col-md-5 col-lg-5\" style='margin-top:6px;'>\r\n\t\t\t\t\t\t<div class=\"inline-group\">\r\n\t\t\t\t\t\t\t<label class=\"scheduler_label\"><i></i><input class=\"checkbox\" ng-disabled=\"editMode\" ng-model=\"weekCheckAll\" ng-checked=\"checkAllWeeks()\" ng-click=\"checkAllWeeks(weekCheckAll)\" type=\"checkbox\"><span data-localize='全选'></span></label>\r\n\t\t\t\t\t\t\t<label class=\"scheduler_label\"><i></i><input class=\"checkbox\" ng-disabled=\"editMode\" ng-model=\"weekCheckOdd\" ng-checked=\"checkAllOddWeeks()\" ng-click=\"checkAllOddWeeks(weekCheckOdd)\" type=\"checkbox\"><span data-localize='单周'></span></label>\r\n\t\t\t\t\t\t\t<label class=\"scheduler_label\"><i></i><input class=\"checkbox\" ng-disabled=\"editMode\" ng-model=\"weekCheckEven\" ng-checked=\"checkAllEvenWeeks()\" ng-click=\"checkAllEvenWeeks(weekCheckEven)\" type=\"checkbox\"><span data-localize='双周'></span></label>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</form>\r\n\t\t\t<div class=\"col-xs-10 col-sm-10 col-md-10 col-lg-10 row\" style=\"padding:8px 0;\">\r\n\t\t\t\t<div class=\"col-sm-5 col-xs-5 col-md-5 col-lg-5\">\r\n\t\t\t\t\t<button ng-disabled=\"editMode\" class=\"btn btn-danger\" ng-click=\"clearAll()\" data-localize='清除全部课表'></button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-xs-7 col-sm-7 col-md-7 col-lg-7 text-right\">\r\n\t\t\t\t\t<button ng-show=\"editMode\" class=\"btn btn-success\" data-ng-click=\"save()\" data-localize='保存修改'></button>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclass=\"btn btn-default\"\r\n\t\t\t\t\t\tng-model=\"editMode\"\r\n\t\t\t\t\t\tbtn-checkbox=\"editMode\"\r\n\t\t\t\t\t\tng-class=\"{disabled: !checkSomeWeeks(true)}\"\r\n\t\t\t\t\t\tng-hide=\"editMode\"\r\n\t\t\t\t\t\tng-click=\"enableEditMode()\" data-localize='编辑勾选的周次'\r\n\t\t\t\t\t></button>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclass=\"btn btn-default\"\r\n\t\t\t\t\t\tng-show=\"editMode\"\r\n\t\t\t\t\t\tng-click=\"disableEditMode()\" data-localize='取消编辑'\r\n\t\t\t\t\t></button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"col-xs-10 col-sm-10 col-md-10 col-lg-10 row\">\r\n\t\t\t\t<table ng-show=\"currentWeek\" class=\"scheduler\" width=\"100%\" cellpadding=\"1\" cellspacing=\"1\" border=\"1\">\r\n\t\t\t\t\t<caption data-localize='编辑模式'></caption>\r\n\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<th width=\"120\"></th>\r\n\t\t\t\t\t\t\t<th width=\"128\" class=\"day\" style=\"background:{{ day.current ? '#cde0c4' : '' }}\" data-ng-repeat=\"day in currentWeek.days\"><span data-localie=\"{{ day.key }}\" data-localize=\"{{ day.name }}\"></span></th>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</thead>\r\n\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t<ol class=\"class_hour_list\">\r\n\t\t\t\t\t\t\t\t\t<li data-ng-repeat=\"classHour in classHours\">\r\n\t\t\t\t\t\t\t\t\t\t<div style=\"line-height:24px\">\r\n\t\t\t\t\t\t\t\t\t\t\t<b data-localize='CLASS' param1=\"{{classHour.index}}\"></b><br>\r\n\t\t\t\t\t\t\t\t\t\t\t<small>{{ classHour.start | date:\"HH:mm\" }} - {{ classHour.end | date:\"HH:mm\" }}</small>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t</ol>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td data-ng-repeat=\"day in currentWeek.days\">\r\n\t\t\t\t\t\t\t\t<schedulerday data-day=\"day.key\" data-modifiable=\"editMode\" data-hours=\"classHours\" data-scenes=\"day.scenes\"></schedulerday>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</tbody>\r\n\t\t\t\t</table>\r\n\t\t\t\t<div ng-hide=\"currentWeek\" class=\"well text-center\" data-localize=\"OUTOFFSCHULE\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"col-xs-2 col-sm-2 col-md-2 col-lg-2\" ng-class=\"{disabled: !editMode}\">\r\n\t\t\t\t<scheduleritems>\r\n\t\t\t\t\t<scheduleritem data-scene=\"scene\" data-modifiable=\"editMode\" data-ng-repeat=\"scene in $parent.scenes | filter:{ pool: $parent.class.id }:true \"></scheduleritem>\r\n\t\t\t\t</scheduleritems>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n<div ng-hide=\"weeks.length || true\">\r\n\t<p data-localize=\"NOWEEK\" class=\"text-center\"></p>\r\n\t<div class=\"text-center\"><button class=\"btn btn-lg btn-default\" ng-class=\"{disabled: editMode}\" ng-click=\"setting()\" data-localize=\"课时设置\"></button></div>\r\n</div>\r\n<div class=\"col-xs-12\" style=\"height:45px;\"></div>\r\n<!--p style=\"height:800px;\">{{ start_time }},<div ng-repeat=\"date in dates\">{{ date.start | date:\"yyyy-MM-dd HH:mm\" }}, {{ date.scenes.length }}</div>{{ end_time }}</p-->\r\n<script>pageSetUp()</script>","views/vdi/summary.html":"<section id=\"widget-grid\" class=\"ng-scope\">\r\n<!--{{summary}}-->\r\n\t<div class=\"well\">\r\n        <div class=\"row\">\r\n        \t<div class=\"col-xs-6\">\r\n        \t\t<form class=\"form-horizontal\">\r\n\t        \t\t<div class=\"form-group\">\r\n\t        \t\t\t<label class=\"control-label col-xs-2\" localize=\"资源池\"></label>\r\n\t        \t\t\t<div class=\"col-xs-4\">\r\n\t\t        \t\t\t<select ng-disabled=\"loading\" class=\"form-control\" ng-change=\"get_host(pool.uuid)\" ng-model=\"pool\" ng-options=\"pool.name for pool in pools\">\r\n\t\t        \t\t\t\t<option value=\"\" localize=\"所有\"></option>\r\n\t\t        \t\t\t</select>\r\n\t\t        \t\t</div>\r\n\t        \t\t\t<img  ng-src=\"img/loadingtext.gif\" ng-if=\"loading\" height=\"32\" width=\"32\">\r\n\t        \t\t</div>\r\n        \t\t</form>\r\n        \t</div>\r\n            <div class=\"col-xs-6 col-sm-6\">\r\n                <ul id=\"sparks\" class=\"\">\r\n                    <li class=\"sparks-info\">\r\n\t\t\t\t\t\t<div class=\"sparkline txt-color-bluejj hidden-mobile hidden-md hidden-sm\"><i class=\"fa-fw fa icon-jj-host\"></i></div>\r\n\t\t\t\t\t\t<h5 data-localize=\"SUMMARY_TITLE_NODE\"\r\n\t\t\t\t\t\t\tparam2=\"{{summary.host_total - summary.host_master|| 0}}\"></h5>\r\n                    </li>\r\n                    <li class=\"sparks-info\">\r\n\t\t\t\t\t\t<div class=\"sparkline txt-color-bluejj hidden-mobile hidden-md hidden-sm\"><i class=\"fa icon-jj-pc fa-fw \"></i></div>\r\n\t\t\t\t\t\t<h5 data-localize=\"SUMMARY_TITLE_DESKTOP\"\r\n\t\t\t\t\t\t\tparam1=\"{{summary.mode_instance_cnt || 0}}\"\r\n\t\t\t\t\t\t\tparam2=\"{{summary.person_instance_cnt || 0}}\"> </h5>\r\n                    </li>\r\n                    <!-- <li class=\"sparks-info\">\r\n\t\t\t\t\t\t<div class=\"sparkline txt-color-bluejj hidden-mobile hidden-md hidden-sm\"><i class=\"fa-fw fa icon-jj-Terminal\"></i></div>\r\n\t\t\t\t\t\t<h5 data-localize=\"SUMMARY_TITLE_CLIENT\"\r\n\t\t\t\t\t\t\tparam1=\"{{summary.schoolroom_cnt || 0}}\"\r\n\t\t\t\t\t\t\tparam2=\"{{summary.client_cnt || 0}}\"> </h5>\r\n                    </li> -->\r\n                </ul>\r\n            </div>\r\n        </div>\r\n        <!-- row -->\r\n        <div class=\"row\">\r\n            <article class=\"col-sm-12\">\r\n                <!-- new widget -->\r\n                <div class=\"jarviswidget\" id=\"wid-id-0\" data-widget-togglebutton=\"false\" data-widget-editbutton=\"false\" data-widget-fullscreenbutton=\"false\" data-widget-colorbutton=\"false\" data-widget-deletebutton=\"false\">\r\n                    <header>\r\n                        <h2 data-localize=\"HOST\">主机</h2>\r\n                        <h2\r\n                        \tdata-localize=\"SUMMARY_HOST_DESC\"\r\n                        \tparam1=\"{{summary.host_total || 0}}\"\r\n                        \tparam2=\"{{summary.host_running || 0}}\"\r\n                        \tparam3=\"{{summary.host_shutdown || 0}}\"\r\n                        ></h2>\r\n                        <ul class=\"nav nav-tabs pull-right in\" id=\"myTab\">\r\n                        </ul>\r\n\r\n                    </header>\r\n\r\n                    <!-- widget div-->\r\n                    <div class=\"no-padding\">\r\n                        <div class=\"widget-body\">\r\n                            <!-- content -->\r\n                            <div id=\"myTabContent\" class=\"tab-content\">\r\n                                <div class=\"tab-pane fade in padding-10 no-padding-bottom active\" id=\"s0\">\r\n                                \t<div class=\"row index all text-center\">\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-4 col-lg-4\">\r\n                                            <h3 class=\"title\">CPU</h3>\r\n                                            <div class=\"item\">\r\n                                                <p localize=\"SUMMARY_ALL_CORE\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tparam1=\"{{summary.cpu_cnt || 0}}\"></p>\r\n                                                <p localize=\"SUMMARY_VCPU_CORE\"\r\n                                               \t\tparam1=\"{{summary.cpu_v_running || 0}}\"></p>\r\n                                                <!--<div class=\"progress\">-->\r\n                                                    <!--<div class=\"progress-bar bg-color-teal\" aria-valuetransitiongoal=\"25\" aria-valuenow=\"25\" style=\"width: 25%;\">25%</div>-->\r\n                                                <!--</div>-->\r\n                                                <div class=\"svgpic\" ng-show=\"cpu_rate\"><strong>{{ summary.cpu_cnt==0?0:1 }} : {{cpu_rate}}</strong></div>\r\n                                            </div>\r\n                                            <div class=\"foootbar\" \r\n                                            \tlocalize=\"SUMMARY_VCPU_TOTAL\"\r\n                                            \tparam1=\"{{summary.cpu_v_total || 0}} \"></div>\r\n\t                  \t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-4 col-lg-4\">\r\n                                            <h3 class=\"title\" localize=\"内存\">内存</h3>\r\n                                            <div class=\"item\">\r\n                                                <p data-localize=\"SUMMARY_SIZE_USED\" param1=\"{{summary.mem_used || 0}}\"></p>\r\n                                                <p data-localize=\"SUMMARY_SIZE_FREE\" param1=\"{{summary.mem_remain || 0}}\"></p>\r\n                                                <div id=\"3Dmemory\" style=\"position:relative;top:-10px;\">\r\n                                                    <!-- 这里是svg图                    -->\r\n                                                </div>\r\n                                            </div>\r\n                                            <div class=\"foootbar\" \r\n                                            \tlocalize=\"SUMMARY_SIZE_TOTAL\"\r\n                                            \tparam1=\"{{summary.memory_cnt || 0}} \"></div>\r\n\t                  \t\t\t\t\t\t\r\n\t                  \t\t\t\t\t</div>\r\n                                        <div class=\"col-xs-12 col-sm-12 col-md-4 col-lg-4\">\r\n                                            <h3 class=\"title\" localize=\"存储\">存储</h3>\r\n                                            <div class=\"item\">\r\n                                            \t<p data-localize=\"SUMMARY_SIZE_USED\" param1=\"{{summary.disk_used || 0}}\"></p>\r\n                                                <p data-localize=\"SUMMARY_SIZE_FREE\" param1=\"{{summary.disk_remain || 0}}\"></p>\r\n                                                <div id=\"3Ddisk\"  style=\"position:relative;top:-10px;\">\r\n                                                    <!-- 这里是svg图                    -->\r\n                                                </div>\r\n                                            </div>\r\n                                            <div class=\"foootbar\" \r\n                                            \tlocalize=\"SUMMARY_SIZE_TOTAL\"\r\n                                            \tparam1=\"{{summary.disk_cnt || 0}} \"></div>\r\n                                        </div>\r\n                                        <!--<div class=\"col-xs-12 col-sm-12 col-md-3 col-lg-3\">-->\r\n                                            <!--<h3 class=\"title\">网络</h3>-->\r\n                                            <!--<div class=\"item\">-->\r\n                                                <!--<p>总共:3个Vlan75个IP</p>-->\r\n                                                <!--<p>已分配使用18个</p>-->\r\n                                            <!--</div>-->\r\n                                            <!--<div class=\"foootbar\">总共使用率<span>25</span>%</div>-->\r\n                                        <!--</div>-->\r\n                  \t\t\t\t\t</div>\r\n                                </div>\r\n                                <!-- end s0 tab pane -->\r\n                                <div class=\"tab-pane fade  in padding-10 no-padding-bottom\" id=\"s1\">\r\n                                \t<div class=\"row\">\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t                  \t\t\t\t\t\t<div id=\"updating-chart-CPU\" class=\"chart\">\r\n\t                  \t\t\t\t\t\t\t<!-- 这里是svg图 -->\r\n\t                  \t\t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t                  \t\t\t\t\t\t<div class=\"height210\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<table class=\"table table-bordered\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>TOP</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>主机</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>状态</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in hostrows\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{item.CPU.TOP}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{item.CPU.host}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><i class=\"fa {{item.CPU.state}}\"></i></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t</div>\r\n                  \t\t\t\t\t</div>\r\n\r\n                                </div>\r\n                                <!-- end s1 tab pane -->\r\n\r\n                                <div class=\"tab-pane fade  in padding-10 no-padding-bottom\" id=\"s2\">\r\n                                \t<div class=\"row\">\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t                  \t\t\t\t\t\t<div id=\"updating-chart-memory\" class=\"chart\">\r\n\t                  \t\t\t\t\t\t\t<!-- 这里是svg图 -->\r\n\t                  \t\t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t                  \t\t\t\t\t\t<div class=\"height210\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<table class=\"table table-bordered\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>TOP</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>主机</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>状态</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in hostrows\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{item.memory.TOP}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{item.memory.host}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><i class=\"fa {{item.memory.state}}\"></i></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t</div>\r\n                  \t\t\t\t\t</div>\r\n                                </div>\r\n                                <!-- end s2 tab pane -->\r\n\r\n                                <div class=\"tab-pane fade  in padding-10 no-padding-bottom\" id=\"s3\">\r\n                                \t<div class=\"row\">\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t                  \t\t\t\t\t\t<div id=\"updating-chart-save\" class=\"chart\">\r\n\t                  \t\t\t\t\t\t\t<!-- 这里是svg图 -->\r\n\t                  \t\t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t                  \t\t\t\t\t\t<div class=\"height210\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<table class=\"table table-bordered\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>TOP</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>主机</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>状态</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in hostrows\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{item.save.TOP}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{item.save.host}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><i class=\"fa {{item.save.state}}\"></i></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t                  \t\t\t\t\t</div>\r\n                  \t\t\t\t\t</div>\r\n                                </div>\r\n                                <!-- end s3 tab pane -->\r\n                            </div>\r\n                            <!-- end content -->\r\n                        </div>\r\n\r\n                    </div>\r\n                    <!-- end widget div -->\r\n                </div>\r\n                <!-- end widget -->\r\n            </article>\r\n        </div>\r\n        <!-- end row -->\r\n        <!-- row -->\r\n        <div class=\"row\">\r\n\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t\t\t\t<div class=\"jarviswidget jarviswidget-sortable\">\r\n\t\t\t\t\t<header role=\"heading\" class=\"home-header\">\r\n\t\t\t\t\t\t<h2 data-localize=\"桌面\">桌面</h2>\r\n\t\t\t\t\t\t<h2\r\n\t\t\t\t\t\t\tdata-localize=\"SUMMARY_DESKTOP_DESC\"\r\n\t\t\t\t\t\t\tparam1=\"{{instances_summary.instances_total || 0}}\"\r\n\t\t\t\t\t\t\tparam2=\"{{instances_summary.instances_running || 0}}\"\r\n\t\t\t\t\t\t\tparam3=\"{{instances_summary.instances_shutdown || 0}}\"\r\n\t\t\t\t\t\t></h2>\r\n\t\t\t\t\t</header>\r\n\t\t\t\t\t<div role=\"content\">\r\n\t\t\t\t\t\t<div class=\"widget-body\">\r\n\t\t\t\t\t\t\t<div class=\"height210\">\r\n\t\t\t\t\t\t\t\t<table class=\"table table-bordered nomargin\">\r\n\t\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>TOP 5</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"桌面\">桌面</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"持续运行时间\">持续运行时间</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"教室/所有人\">教室/所有人</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in top_instances_list\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td align=\"center\">{{item.top}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><p class=\"text-overflow\" style=\"width: 80px\" title=\"{{item.name}}\">{{item.name}}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{item.startup_at}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-overflow\" style=\"width: 100px\" ng-if=\"item.pool_name\" title=\"{{ (item.pool_name?item.pool_name:'')+(item.pool_name && item.inst_owner?'/':'')+(item.inst_owner?item.inst_owner:'')}}\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{item.pool_name}}<span ng-if=\"item.pool_name && item.inst_owner\">/</span>{{item.inst_owner}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-overflow\" style=\"width: 100px\" ng-if=\"!item.pool_name\" title=\"{{ item.inst_owner}}\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{item.inst_owner}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><a href=\"javascript:\" ng-click=\"view_desktop(item.id)\" data-localize=\"查看桌面\">查看桌面</a></td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<!-- <div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t\t\t\t<div class=\"jarviswidget jarviswidget-sortable\">\r\n\t\t\t\t\t<header role=\"heading\">\r\n\t\t\t\t\t\t<h2  data-localize=\"终端\">终端</h2>\r\n\t\t\t\t\t\t <h2\r\n                        \tdata-localize=\"SUMMARY_CLIENT_DESC\"\r\n                        \tparam1=\"{{clients_summary.clients_total || 0}}\"\r\n                        \tparam2=\"{{clients_summary.clients_running || 0}}\"\r\n                        \tparam3=\"{{clients_summary.clients_shutdown || 0}}\"\r\n                        ></h2>\r\n\t\t\t\t\t</header>\r\n\t\t\t\t\t<div role=\"content\">\r\n\t\t\t\t\t\t<div class=\"widget-body\">\r\n\t\t\t\t\t\t\t\t<div class=\"height210\">\r\n\t\t\t\t\t\t\t\t<table class=\"table table-bordered\">\r\n\t\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\">TOP 5</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th width=\"50%\" data-localize=\"终端\">终端</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th width=\"40%\" data-localize=\"持续开机时间\">持续开机时间</th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in top_clients_list\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td align=\"center\">{{item.top}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{item.name}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{item.access_at}}</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div> -->\r\n\t\t\t<div class=\"col-xs-12 col-sm-12 col-md-6 col-lg-6\">\r\n\t\t\t\t<div class=\"jarviswidget jarviswidget-sortable\">\r\n\t\t\t\t\t<header role=\"heading\" class=\"home-header\">\r\n\t\t\t\t\t\t<h2  data-localize=\"操作日志\">操作日志</h2>\r\n\t\t\t\t\t\t<!-- <a class=\"more\" href=\"#/system/logs\" data-localize=\"更多\">更多</a> -->\r\n\t\t\t\t\t</header>\r\n\t\t\t\t\t<div role=\"content\">\r\n\t\t\t\t\t\t<div class=\"widget-body\">\r\n\t\t\t\t\t\t\t\t<div class=\"height210\">\r\n\t\t\t\t\t\t\t\t<table class=\"table table-bordered nomargin\">\r\n\t\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作者\">操作者</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作内容\">操作内容</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作时间\">操作时间</th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in top_logs_list\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td align=\"center\">{{item.user}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td title=\"{{item.content}}\"><p class=\"text-overflow text-overflow-summary\">{{item.content}}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td class=\"nowrap\">{{item.datetime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<!-- end row -->\r\n\r\n\t</div>\r\n</section>\r\n              ","views/vdi/system/backup.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<!-- <form class=\"navbar-left ng-pristine no-margin\" role=\"search\" name=\"backupForm\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"pull-left margin-r-10 form-group\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input width=\"260\" class=\"form-control nodirty\"  data-localize=\"备份名为英文或数字\" name=\"isoname\" data-ng-pattern=\"/^[A-Za-z0-9]+$/\" maxlength=\"20\" type=\"text\" ng-model=\"backupname\" required>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<button ng-show=\"!submiting\" class=\"btn btn-primary\"  ng-class=\"{disabled:backupForm.isoname.$invalid}\" ng-click=\"add()\">\r\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa  icon-jj-Recovery-1\"></i>&nbsp;<span localize=\"备份\">备份</span>\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t<img ng-show=\"submiting\" width=\"32\" height=\"32\" ng-src=\"img/loadingtext.gif\" alt=\"\">\r\n\t\t\t\t\t\t\t\t\t</form> -->\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" ng-disabled=\"submitting\" ng-click=\"backup()\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"立即备份\">立即备份</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" ng-click=\"config()\"><i class=\"icon-jj-Recovery-1 fa\"></i> <span data-localize=\"备份配置\">备份配置</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger\" data-ng-class=\"{disabled:!checkOne()}\" ng-click=\"delete()\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\" data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('display_name', nameSort)\" localize=\"备份文件名\">备份文件名</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"大小\">大小</th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"timeSort\" ng-click=\"timeSort = !timeSort;sort('created_at', timeSort)\" localize=\"备份时间\">备份时间</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"备份方式\">备份方式</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\" ><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"break_all\" width=\"240\">{{ item.display_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.size }}MB</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.created_at |  date:\"yyyy-MM-dd HH:mm:ss\" }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td> <span localize=\"自动备份\" ng-show=\"item.is_auto_backup === true\">自动备份</span><span ng-show=\"item.is_auto_backup === false\" localize=\"手动备份\">手动备份</span></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><a class=\"btn btn-xs btn-default\" href=\"{{ getURL(item) }}\" localize-title=\"下载\"><i class=\"fa icon-jj-Download\"></i></a>&nbsp;<button class=\"btn btn-xs btn-default\" ng-click=\"delete(item)\" localize-title=\"删除\"><i class=\"fa icon-jj-delete\"></i></button></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- widget div end -->\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/system/deploy.html":"<div ng-if=\"hideStep\" role=\"content\" class=\"col-xs-8 clearfix\" style=\"padding-top: 10px;\">\r\n    <div data-wizard disable-nav=\"true\" data-last-text=\"完成\" class=\"widget-body fuelux\" style=\"position: relative; padding-bottom: 40px\">\r\n        <!-- 第一步 -->\r\n        <div class=\"step-pane active\" data-wizard-step data-name=\"init.import-img\">\r\n            <div ng-controller=\"importImageStepController\">\r\n            <form class=\"form-horizontal\" name=\"imgForm\" novalidate>\r\n                <div class=\"quick-deploy-toolbar clearfix\">\r\n                    <button style=\"float: left;\" class=\"btn btn-primary\" ng-click=\"importByServer()\"><i class=\"icon-jj-Import\"></i><span localize=\"button.import-by-server\"></span></button>\r\n                    <div ui-web-upload=\"img_upload\"\r\n                         ui-web-upload-name=\"src_file\"\r\n                         ui-upload-type=\"img\"\r\n                         ui-web-upload-params=\"{upload_type: 'remote'}\"\r\n                         ui-upload-btn-name=\"button.upload-img\"\r\n                         ui-upload-url=\"/thor/init/prepare_import_img\"\r\n                         btn-class=\"btn-primary quick-deploy-upload\"\r\n                         style=\"float: left;margin-left: 15px;\">\r\n                    </div>\r\n                </div>\r\n                \r\n                <ul class=\"diskimg-list\">\r\n                    <li ng-repeat=\"img in imglist track by $index\" ng-click=\"selectSysImage(img)\" ng-class=\"{'quick-deploy-selimg': selectedSysImage === img}\" title=\"{{img.filename}}\">{{img.filename|filename}}</li>\r\n                    <li class=\"quick-deploy-empty-imgs\" ng-if=\"ctrl.imglist.length === 0\" localize=\"quickdeploy.empty-imgs\"></li>\r\n                </ul>\r\n                <img src=\"img/loadingtext.gif\" ng-if=\"loading\" class=\"loadingtext\" style=\"width:24px;height:24px;\">\r\n\r\n                <p class=\"quick-deploy-helpmsg\" style=\"position: relative;top:100px;\" localize=\"quickdeploy.helpmsg\" ng-if=\"firstDeployTips\"></p>\r\n            </form>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"step-pane active\" data-wizard-step data-name=\"init.register-teach-tmpl\" next-btn-text=\"init.register-tmpl\">\r\n            <div ng-controller=\"registerTeachTemplateStepController\">\r\n            <form name=\"registerForm\" ng-class=\"{is_error:error}\" novalidate>\r\n                <div class=\"form-group \">\r\n                    <label class=\"col-xs-3 control-label required\" for=\"select-1\" data-localize=\"系统盘镜像\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <div style=\"border-color: transparent;background-color: transparent;\" class=\"form-control\" ng-bind=\"selectIsoName\"></div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-xs-3 control-label required\" data-localize=\"模板名\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <input class=\"form-control\"\r\n                            type=\"text\"\r\n                            name=\"name\"\r\n                            required\r\n                            data-ng-model=\"name\"\r\n                            data-ng-minlength=\"{{ min_namelength }}\"\r\n                            data-ng-maxlength=\"{{ max_namelength }}\"\r\n                            data-ng-trim=\"false\"\r\n                        >\r\n                    </div>\r\n                    <label class=\"col-xs-3 note\" data-localize=\"LENGTH_LIMIT\" param1=\"{{min_namelength}}\" param2=\"{{max_namelength}}\"></label>\r\n                </div>\r\n                <div class=\"form-group \">\r\n                    <label class=\"col-xs-3 control-label\" for=\"select-1\" data-localize=\"操作系统\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <select class=\"form-control\" ng-model=\"os_type\" data-ng-options=\"os_type.value for os_type in os_types track by os_type.key\"></select>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group \">\r\n                    <label class=\"col-xs-3 control-label\" for=\"select-1\" data-localize=\"所有人\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <select class=\"form-control\" ng-model=\"owner\" data-ng-options=\"owner.name for owner in users track by owner.id\"></select>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group \">\r\n                    <label class=\"col-xs-3 control-label required\" for=\"network\" data-localize=\"宿主机\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <select class=\"form-control\" required data-ng-options=\"host.host_name for host in hosts track by host.host_uuid\"\r\n                            required \r\n                            data-ng-disabled=\"host_loading\"\r\n                            data-ng-change=\"getNetwork(host)\"\r\n                            data-ng-model=\"host\">\r\n                            <option value=\"\" localize=\"--请选择--\"></option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group \">\r\n                    <label class=\"col-xs-3 control-label required\" for=\"network\" data-localize=\"网络\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <select class=\"form-control\" required data-ng-options=\"network.name for network in networks track by network.id\"\r\n                            data-ng-change=\"switchSubnet(network, this)\"\r\n                            data-ng-model=\"network\">\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group \">\r\n                    <label class=\"col-xs-3 control-label required\" for=\"subnet\" data-localize=\"子网\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <select class=\"form-control\" data-ng-disabled=\"network_loading\" data-ng-options=\"subnet.name+' ('+ subnet.start_ip + '~' + subnet.end_ip +')' for subnet in subnets track by subnet.id\"\r\n                            data-ng-change=\"switchIps(subnet, this)\"\r\n                            data-ng-model=\"subnet\">\r\n                            <option value=\"\" data-localize=\"不分配\"></option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-xs-3 control-label\" data-localize=\"绑定IP\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <div class=\"input-group\">\r\n                            <span class=\"input-group-addon\" style=\"padding: 0 4px;\">\r\n                                <label style=\"margin-top: 3px;\">\r\n                                    <select data-ng-model=\"bind_ip_type\" ng-disabled='bind_ip_type.value==\"none\"' ng-options=\"type.name for type in types track by type.value\" ng-change='bind_ip.value=nul'></select>\r\n                                </label>\r\n                            </span>\r\n                            <label class=\"text classroomNet \" data-ng-class=\"{bind_ip_able:bind_ip_type.value=='static' && subnets.length===0,bind_ip_disable:bind_ip_type.value!=='static' || subnets.length===0}\" style=\"margin: 0;\">\r\n                                <input type=\"text\" format-ip data-ng-if=\"bind_ip_type.value==='static'\" start=\"subnet.start_ip\" end=\"subnet.end_ip\" class=\"form-control\" ng-model=\"bind_ip.value\" required>\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            <div ng-show=\"registerFormLoading\" style=\"position: absolute;top:68px;left:-10px;right:-10px;bottom:-10px;background-color: #fafafa;z-index: 99;\">\r\n\r\n                <div class=\"row\">\r\n                    <div class=\"col-xs-12 col-sm-6 col-md-6 col-lg-6\" data-id=\"{{item.id}}\" data-ng-repeat=\"item in teachTemplates\">\r\n                        <div class=\"panel pricing-big relative\" data-ng-class=\"{'panel-darken':item.status!='alive','panel-primary':item.status=='alive'}\">\r\n                            <div class=\"panel-heading smart-form mypanelhead\">\r\n                                <div class=\"checkbox row\">\r\n                                    <h2 class=\"head-title col-md-12 col-sm-12 col-xs-12\">\r\n                                        <span title=\"{{item.image_id}}\">{{item.name}}</span>\r\n                                        <div title=\"{{ item.description }}\" class=\"desc\">{{ item.description }}</div>\r\n                                    </h2>\r\n                                </div>\r\n                                <div class=\"template panel-cont flex\">\r\n                                    <div class=\"panel-pic\" style=\"position: relative;bottom: 10px;\">\r\n                                        <div class=\"mynote\">\r\n                                            <span data-ng-if=\"item.status=='update failed'\" data-localize=\"TEMPLATE_UPDATE_FAILED\"></span>\r\n                                            <span data-ng-if=\"item.status=='updating'\" data-localize=\"TEMPLATE_UPDATING\"></span>\r\n                                            <span data-ng-if=\"item.status=='cloning'\" data-localize=\"TEMPLATE_CLONING\"></span>\r\n                                            <span data-ng-if=\"item.status=='sync failed'\" data-localize=\"TEMPLATE_SYNC_FAILED\"></span>\r\n                                            <span data-ng-if=\"item.status=='uploading'\" data-localize=\"UPLOADING\"></span>\r\n                                            <span data-ng-if=\"item.status=='register failed'\" data-localize=\"REGISTER_FAILED\"></span>\r\n                                            <span data-ng-if=\"item.status=='cloning failed'\" data-localize=\"CLONING_FAILED\"></span>\r\n                                            <span data-ng-if=\"item.status=='reset failed'\" data-localize=\"RESET_FAILED\"></span>\r\n                                            <span data-ng-if=\"item.status=='error'\" data-localize=\"CREATE_FAILED\"></span>\r\n\r\n                                            <span data-ng-if=\"item.status=='making'\" data-localize=\"MAKING\"></span>\r\n                                            <span data-ng-if=\"item.status=='saving'\" data-localize=\"SAVING\"></span>\r\n                                            <span data-ng-if=\"item.status=='saveAs'\" data-localize=\"SAVING\"></span>\r\n                                            <span data-ng-if=\"item.status=='installed'\" data-localize=\"INSTALLED\"></span>\r\n                                            <span data-ng-if=\"item.status=='syncing'\" data-localize=\"SYNCING\"></span>\r\n                                            <span data-ng-if=\"item.status=='building'\" data-localize=\"BUILDING\"></span>\r\n                                            <span data-ng-if=\"item.status=='making seed'\" data-localize=\"MAKING_SEED\"></span>\r\n                                            <span data-ng-if=\"item.status=='registering'\" data-localize=\"REGESTER\"></span>\r\n                                        </div>\r\n                                        <div class=\"pic-wrap\">\r\n                                            <img ng-src=\"img/ajax-loader.gif\" data-ng-if=\"item.status =='making' || item.status =='syncing' || item.status == 'making seed'\">\r\n                                            <img ng-src=\"img/{{ item.icon || 'win7.png' }}\" data-ng-if=\"item.status !== 'making' && item.status !== 'syncing' && item.status != 'making seed'\">\r\n                                        </div>\r\n                                        <div data-ng-if=\"item.status!='making' && item.status !='syncing' && item.status!='making seed'\">\r\n                                            <p class=\"pic-version\">{{item.os_type}}</p>\r\n                                            <p class=\"memsize\">{{item.is_64==true? 64:32}}Bit</p>\r\n                                        </div>\r\n                                        <div class=\"panel-status\" >\r\n                                            <span ng-if=\"item.instance_status=='running'\" localize-title=\"开机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='shutdown'\" localize-title=\"关机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='paused'\" localize-title=\"挂起状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='migrating'\" localize-title=\"迁移状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='building'\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='nostate'\" localize-title=\"未知状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='error' ||item.instance_status=='crashed'\" localize-title=\"错误状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='reboot'\" localize-title=\"重启中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                            <span ng-if=\"item.instance_status=='updating'\" localize-title=\"更新中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n                                         </div>\r\n                                    </div>\r\n                                    <ul class=\"panel-mess\">\r\n                                        <li class=\"panel-item\">\r\n                                            <label data-localize=\"系统盘\" data-localize-title=\"系统盘\"></label>\r\n                                            <div class=\"item-flex\">{{item.updateSize?item.updateSize:item.system_size_desc}}G/{{item.system_size_total}}G <span class=\"template\"></span></div>\r\n                                        </li>\r\n                                        <li class=\"panel-item\">\r\n                                            <label data-localize=\"数据盘\" data-localize-title=\"数据盘\"></label>\r\n                                            <div class=\"item-flex\">{{item.data_size_desc}}G/{{item.data_size_total}}G <span class=\"template\"></span></div>\r\n                                        </li>\r\n                                        <li class=\"panel-item\">\r\n                                            <label data-localize=\"关联桌面数\" data-localize-title=\"关联桌面数\"></label>\r\n                                            <div class=\"item-flex\">{{item.instance_count}}</div>\r\n                                        </li>\r\n                                        <li class=\"panel-item\">\r\n                                            <label data-localize=\"创建者\" data-localize-title=\"创建者\"></label>\r\n                                            <div class=\"item-flex\">{{item.owner_desc}}</div>\r\n                                        </li>\r\n                                        <li class=\"panel-item\">\r\n                                            <label data-localize=\"创建时间\" data-localize-title=\"创建时间\"></label>\r\n                                            <div class=\"item-flex\">{{item.created_at | date:'yyyy-MM-dd HH:mm:ss'}}</div>\r\n                                        </li>\r\n                                    </ul>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"panel-footbar\" data-ng-class=\"{'darken':item.status!='alive','primary':item.status=='alive'}\">\r\n                                <a href=\"javascript:void(0)\" class=\"icon\" data-ng-click=\"delete(item)\" ng-show=\"item.status === 'register failed'\"><i class=\"fa fa-trash-o\" data-localize-title=\"删除模版\"></i></a>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"tips\" data-ng-if=\"loadingTeachTemplates\" data-localize=\"LOADING_TEXT\"></div>\r\n                <div class=\"tips\" data-ng-if=\"!loadingTeachTemplates && teachTemplates.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n            </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"step-pane active\" data-wizard-step data-name=\"init.create-teach-scene\" next-btn-text=\"init.create-teach-scene\" prev-btn-text=\"\">\r\n            <div ng-controller=\"createTeachSceneController\">\r\n            <form class=\"form-horizontal\" name=\"createForm\" novalidate>\r\n                <div class=\"form-group\">\r\n                    <label  class=\"col-xs-3 control-label required\" localize=\"场景名\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <input type=\"text\" class=\"form-control\" data-ng-model=\"data.name\" data-localize=\"LENGTH_LIMIT\" maxlength=\"20\" ng-maxlength=\"20\" ng-minlength=\"2\" param1=\"2\" param2=\"20\" required>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"\" class=\"control-label required col-xs-3\" localize=\"桌面数\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <input type=\"number\" input-number class=\"form-control\" ng-model=\"data.instance_max\" max=\"{{data.max_instance || 100}}\" min=\"1\" required ng-pattern=\"/^[0-9]*$/\">\r\n                    </div>\r\n                    <label class=\"col-xs-3 note\"><span localize=\"最大\"></span>{{data.max_instance || 100}}</label>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label class=\"control-label col-xs-3\" data-localize=\"教室\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <select name=\"classroom\" ng-model=\"classroom\" class=\"form-control\" ng-options=\"classroom.name for classroom in classrooms\" required></select>\r\n                    </div>\r\n                </div>\r\n                <!-- 自定义教室 -->\r\n                <div ng-if=\"classroom.id === -1\">\r\n                    <div class=\"form-group\">\r\n                        <label class=\"col-xs-3 control-label required\" for=\"name\" data-localize=\"名称\"></label>\r\n                        <div class=\"col-xs-6\">\r\n                            <input class=\"form-control\"\r\n                                type=\"text\"\r\n                                name=\"name\"\r\n                                data-ng-minlength=\"{{min_namelength}}\" data-ng-maxlength=\"{{max_namelength}}\" data-localize=\"LENGTH_LIMIT\" param1=\"{{min_namelength}}\" param2=\"{{max_namelength}}\"\r\n                                required\r\n                                data-ng-model=\"data.classroomName\"\r\n                                data-ng-trim=\"true\"\r\n                            >\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label class=\"col-xs-3 control-label\" for=\"desc\" data-localize=\"描述\"></label>\r\n                        <div class=\"col-xs-6\">\r\n                            <textarea class=\"form-control\"\r\n                                style=\"height: 80px;\" \r\n                                rows=\"4\"\r\n                                name=\"desc\"\r\n                                data-localize=\"不能超过30位字符\"\r\n                                maxlength=\"30\"\r\n                                data-ng-maxlength=\"30\"\r\n                                data-ng-model=\"data.desc\"\r\n                                data-ng-trim=\"false\"\r\n                            >\r\n                            </textarea>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"form-group \">\r\n                        <label class=\"col-xs-3 control-label required\" for=\"network\" data-localize=\"网络\"></label>\r\n                        <div class=\"col-xs-6\">\r\n                            <select class=\"form-control\" data-ng-options=\"network.name for network in networks track by network.id\"\r\n                                data-ng-change=\"switchSubnet(data.network)\"\r\n                                data-ng-model=\"data.network\">\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"form-group \">\r\n                        <label class=\"col-xs-3 control-label required\" for=\"subnet\" data-localize=\"子网\"></label>\r\n                        <div class=\"col-xs-6\">\r\n                            <select class=\"form-control\" data-ng-disabled=\"network_loading\" data-ng-show=\"subnets.length!==0\" data-ng-options=\"subnet.name+' ('+ subnet.start_ip + '~' + subnet.end_ip +')' for subnet in subnets track by subnet.id\" data-ng-model=\"data.subnet\">\r\n                            </select>\r\n                            <select class=\"form-control\" data-ng-disabled=\"subnets.length===0\" data-ng-show=\"subnets.length===0\"><option data-localize=\"无\"></option></select>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-xs-3 control-label\" data-localize=\"硬件模板\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <select class=\"form-control\" data-ng-model=\"hardware\" data-ng-options=\"hardware.name for hardware in hardwareList track by hardware.id\" required></select>\r\n                        <div class=\"control-des\" ng-if=\"hardware.id !== -1\">\r\n                            <label class=\"control-label\"><span>CPU</span> {{hardware.cpu_num}}<span data-localize=\"核\">核</span></label>\r\n                            <label class=\"control-label\"><span data-localize=\"内存\"></span>{{hardware.memory_mb/1024}}G</label>\r\n                            <label class=\"control-label\"><span data-localize=\"系统盘\"></span>{{hardware.system_gb}}G</label>\r\n                            <label class=\"control-label\" ng-if=\"hardware.local_gb > 1\"><span data-localize=\"数据盘\"></span>{{hardware.local_gb}}G</label>\r\n                            <label class=\"control-label\" ng-if=\"hardware.local_gb1 > 1\"><span data-localize=\"数据盘\"></span>{{hardware.local_gb1}}G</label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <!-- 自定义模板 -->\r\n                <div ng-if=\"hardware.id === -1\">\r\n                    <div class=\"form-group\">\r\n                        <label class=\"col-xs-3 control-label required\" for=\"hardwareName\" data-localize=\"名称\"></label>\r\n                        <div class=\"col-xs-6\">\r\n                            <input class=\"form-control\" id=\"hardwareName\" type=\"text\"\r\n                                name=\"name\"\r\n                                required\r\n                                data-ng-model=\"data.hardwareName\"\r\n                                data-ng-minlength=\"{{min_namelength}}\" data-ng-maxlength=\"{{max_namelength}}\" data-localize=\"LENGTH_LIMIT\" param1=\"{{min_namelength}}\" param2=\"{{max_namelength}}\"\r\n                                data-ng-trim=\"true\"\r\n                            >\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label class=\"col-xs-3 control-label\" data-localize=\"CPU\"></label>\r\n                        <div class=\"col-xs-6 btn-group\">\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.cpu_num\" btn-radio=\"1\">1</label>\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.cpu_num\" btn-radio=\"2\">2</label>\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.cpu_num\" btn-radio=\"3\">3</label>\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.cpu_num\" btn-radio=\"4\">4</label>\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.cpu_num\" btn-radio=\"8\">8</label>\r\n                            <div class=\"input-group my_input_group\">\r\n                              <!-- <input class=\"form-control\" type=\"number\" name=\"cpu_num\"\r\n                                    required\r\n                                    data-ng-model=\"data.cpu_num\"\r\n                                    data-ng-pattern=\"/^\\s*([1-8])\\s*$/\"\r\n                                    data-ng-trim=\"false\"\r\n                              > -->\r\n                              <div class=\"input-number-wraper-sm\"><input ui-input-number step=\"1\" max=\"32\" min=\"1\" ng-model=\"data.cpu_num\" data-ng-trim=\"false\" required></div>\r\n                              <span></span>\r\n                              <div class=\"input-group-addon input-group-addon-disk\" data-localize=\"核\"></div>\r\n                            </div>\r\n                        </div>\r\n                        <label class=\"col-xs-3 note hardwarenote\">1~32<span data-localize=\"核\"></span></label>\r\n                    </div>\r\n\r\n                    <div class=\"form-group\">\r\n                        <label class=\"col-xs-3 control-label\" data-localize=\"内存\"></label>\r\n                        <div class=\"btn-group col-xs-6\">\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.memory_mb\" btn-radio=\"1.5\">1.5GB</label>\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.memory_mb\" btn-radio=\"2\">2GB</label>\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.memory_mb\" btn-radio=\"2.5\">2.5GB</label>\r\n                            <label class=\"btn btn-default\" data-ng-model=\"data.memory_mb\" btn-radio=\"3\">3GB</label>\r\n                            <div class=\"input-group my_input_group\">\r\n                             <!--  <input class=\"form-control\" type=\"number\" name=\"memory_mb\"\r\n                                    required\r\n                                    data-ng-model=\"data.memory_mb\"\r\n                                    data-ng-pattern=\"/^\\s*([1-8]|1.5|2.5|3.5|4.5|5.5|6.5|7.5)\\s*$/\"\r\n                                    data-ng-trim=\"false\"\r\n                              > -->\r\n                                  <div class=\"input-number-wraper-sm\"><input ui-input-number step=\"0.5\" max=\"64\" min=\"1\" ng-model=\"data.memory_mb\" ng-init=\"data.memory_mb = 3\" data-ng-trim=\"false\" required></div>\r\n                                  <span></span>\r\n                                  <div class=\"input-group-addon input-group-addon-disk\">GB</div>\r\n                            </div>\r\n                        </div>\r\n                        <label class=\"col-xs-3 note hardwarenote\">1-64GB</label>\r\n                    </div>\r\n                    <div class=\"form-group\" style=\"margin-bottom: 0;\">\r\n                        <label class=\"col-xs-3 control-label\" data-localize=\"系统盘\" style=\"white-space: nowrap;\"></label>\r\n                        <div class=\"col-xs-6\">\r\n                            <div class=\"btn-group\" style=\"width:100%;\">\r\n                                <label class=\"btn btn-default\" data-ng-model=\"data.system_gb\" btn-radio=\"10\">10GB</label>\r\n                                <label class=\"btn btn-default\" data-ng-model=\"data.system_gb\" btn-radio=\"20\">20GB</label>\r\n                                <label class=\"btn btn-default\" data-ng-model=\"data.system_gb\" btn-radio=\"30\">30GB</label>\r\n                                <label class=\"btn btn-default\" data-ng-model=\"data.system_gb\" btn-radio=\"40\">40GB</label>\r\n                                <div class=\"input-group my_input_group\">\r\n                                      <!-- <input class=\"form-control\" type=\"number\" name=\"system_gb\"\r\n                                            required\r\n                                            data-ng-model=\"data.system_gb\"\r\n                                            data-ng-pattern=\"/^\\s*([1-9][0-9]|100)\\s*$/\"\r\n                                            data-ng-trim=\"false\"\r\n                                      > -->\r\n                                      <div class=\"input-number-wraper-sm\"><input ui-input-number step=\"1\" max=\"500\" min=\"10\" ng-model=\"data.system_gb\" data-ng-trim=\"false\" required></div>\r\n                                      <span></span>\r\n                                      <div class=\"input-group-addon input-group-addon-disk\">GB</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <label class=\"col-xs-3 note hardwarenote\">10-500GB</label>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <div class=\"col-xs-offset-3 col-xs-6\">\r\n                            <div class=\"btn-group datapan\" style=\"width:100%; margin: 15px 0 0 0;\" data-ng-repeat=\"btndisk in btndisks\">\r\n                                <span data-localize=\"数据盘\" class=\"mydatapan\"></span>\r\n                                <label class=\"btn btn-default\" data-ng-model=\"btndisk.local_gb\" btn-radio=\"5\">5GB</label>\r\n                                <label class=\"btn btn-default\" data-ng-model=\"btndisk.local_gb\" btn-radio=\"10\">10GB</label>\r\n                                <label class=\"btn btn-default\" data-ng-model=\"btndisk.local_gb\" btn-radio=\"15\">15GB</label>\r\n                                <label class=\"btn btn-default\" data-ng-model=\"btndisk.local_gb\" btn-radio=\"20\">20GB</label>\r\n                                <div class=\"input-group my_input_group\">\r\n                                  <!-- <input class=\"form-control\" type=\"number\" name=\"local_gb\"\r\n                                         required\r\n                                         data-ng-model=\"btndisk.local_gb\"\r\n                                         data-ng-pattern=\"/^\\s*([1-9]|[1-9][0-9]|[1-4][0-9]{2}|500)\\s*$/\"\r\n                                         data-ng-trim=\"false\"\r\n                                  > -->\r\n                                    <div class=\"input-number-wraper-sm\">\r\n                                        <input ui-input-number step=\"1\" max=\"1024\" min=\"5\" ng-model=\"btndisk.local_gb\" data-ng-trim=\"false\" required>\r\n                                    </div>\r\n                                    <span></span>\r\n                                    <div class=\"input-group-addon input-group-addon-disk\">GB</div>\r\n                                </div>\r\n                                <label style=\"right: -70px;\" class=\"note hardwarenote myhardwarenote\">5-1024GB</label>\r\n                            </div>\r\n                                \r\n                            <div style=\"margin-top: 15px;\">\r\n                                <a ng-hide=\"btndisks.length>1\" href=\"javascript:void(0);\" class=\"btn btn-default txt-color-blueLight\" data-ng-click=\"addbtndisk()\"><i class=\"fa fa-plus fa-lg\"></i></a>\r\n                                <a ng-hide=\"!btndisks.length\" href=\"javascript:void(0);\" class=\"btn btn-default txt-color-blueLight\" data-ng-click=\"minusbtndisk()\"><i class=\"fa fa-minus fa-lg\"></i></a>\r\n                                <span class=\"control-label\">&nbsp;\r\n                                    <span data-localize=\"增加\" data-ng-if=\"btndisks.length<2\">增加</span><span data-ng-if=\"btndisks.length==1\">/ </span><span data-localize=\"删除2\" data-ng-if=\"btndisks.length\">删除</span><span data-localize=\"数据盘\"></span>&nbsp;&nbsp;\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-xs-3\"></label>\r\n                    <div class=\"col-xs-6\">\r\n                        <button type=\"button\" class=\"btn btn-default\" ng-click=\"showAdvanceSceneOptionDialog()\" localize=\"高级\"></button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- end widget content -->\r\n    <div class=\"quick-deploy-wait\" ng-if=\"unknowStep\">\r\n        <img src=\"img/loadingtext.gif\" class=\"loadingtext\"/>\r\n    </div>\r\n    <!--mask-->\r\n    <div ng-if=\"showMask\" class=\"deploy-mask\">\r\n        <p localize=\"DEPLOY-TIPS1\"></p>\r\n        <p localize=\"DEPLOY-TIPS2\"></p>\r\n    </div>\r\n</div>\r\n<script>setTimeout(function(){ pageSetUp(); })</script>","views/vdi/system/desktop_detail.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-sm-9\">\r\n\t\t\t\t\t\t<span localize=\"运行状态\">运行状态</span>：<select class=\"selectclassroomName filter\" ng-change=\"changeStatus()\" ng-model=\"select\" >\r\n\t\t\t\t\t\t\t<option value=\"\" localize=\"全部状态\">全部</option>\r\n\t\t\t\t\t\t\t<option value=\"running\" localize=\"开机状态\">开机</option>\r\n\t\t\t\t\t\t\t<option value=\"shutdown\" localize=\"关机状态\">关机</option>\r\n\t\t\t\t\t\t\t<option value=\"paused\" localize=\"挂起状态\">挂起</option>\r\n\t\t\t\t\t\t\t<option value=\"migrating\" localize=\"迁移状态\">迁移</option>\r\n\t\t\t\t\t\t\t<option value=\"building\" localize=\"创建中状态\">创建中</option>\r\n\t\t\t\t\t\t\t<option value=\"error\" localize=\"错误状态\">错误</option>\r\n\t\t\t\t\t\t\t<option value=\"crashed\" localize=\"异常状态\">异常</option>\r\n\t\t\t\t\t\t\t<option value=\"nostate\" localize=\"未知异常状态\">未知异常</option>\r\n\t\t\t\t\t\t</select>&nbsp;&nbsp;&nbsp;&nbsp;\r\n\t\t\t\t\t\t<span class=\"totalmess ng-binding\" localize=\"DESKTOP_TOTAL_MESS\"\r\n\t\t\t\t\t\t param1=\"{{(rows | filter:searchText | filter:{status:select}).length }}\"\r\n\t\t\t\t\t\t param2=\"{{(rows | filter:searchText | filter:{status:select} | filter:{status:'running'}).length }}\"\r\n\t\t\t\t\t\t param3=\"{{(rows | filter:searchText | filter:{status:select} | filter:{status:'shutdown'}).length }}\"></span>\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" href=\"#/system/desktop\"><i class=\"fa  icon-jj-recovery\"></i>&nbsp;<span localize=\"返回\">返回</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" href=\"javascript:\" ng-click=\"add()\"><i class=\"fa  icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></a>\r\n\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-primary\" data-ng-if=\"templateNum==0\" href=\"#/template/personal\"><i class=\"fa  icon-jj-addddd\"></i>&nbsp;<span localize=\"新增\">新增</span></a> -->\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"start()\" href=\"javascript:\"><i class=\"fa icon-jj-boot\"></i>&nbsp;<span localize=\"开机\">开机</span></a>\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-primary dropdown-toggle isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-shutdown\"></i>&nbsp;<span localize=\"关机\">关机</span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"forceShutdown()\" href=\"javascript:\" ><span localize=\"强制关机\">强制关机</span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li><a class=\"isBatch\" data-ng-click=\"natureShutdown()\" href=\"javascript:\"><span localize=\"自然关机\">自然关机</span></a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restart()\" href=\"javascript:\"><i class=\"fa  icon-jj-Restart\"></i>&nbsp;<span localize=\"重启\">重启</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"pause()\" href=\"javascript:\"><i class=\"fa icon-jj-pause\"></i>&nbsp;<span localize=\"暂停\">暂停</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"resume()\" href=\"javascript:\"><i class=\"fa  icon-jj-Recovery\"></i>&nbsp;<span localize=\"恢复\">恢复</span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" data-ng-model=\"pagesize\" ng-change=\"pageSizeChange()\" input-number></input> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\"  class=\"form-control\" ng-model=\"searchText\" data-localize-placeholder=\"桌面名\" ng-change=\"updataData()\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table\r\n\t\t\t\t\t\t\t\tclass=\"table table-vertical-center table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"desktopSort\" ng-click=\"desktopSort = !desktopSort;sort('display_name', desktopSort)\" localize=\"桌面名\">桌面</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"runStatus\" ng-click=\"runStatus = !runStatus;sort('status', runStatus)\"  localize=\"运行状态\">运行状态</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><span localize=\"桌面\"></span>IP/MAC</th>\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"CPU/内存\">CPU/内存</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"宿主机\">宿主机</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr\r\n\t\t\t\t\t\t\t\t\t\t\tdata-ng-repeat=\"item in rows  | filter:searchText| paging:currentPage:pagesize \"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-contextmenu\r\n\t\t\t\t\t\t\t\t\t\t\tdata-id=\"{{ item.id }}\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\"  type=\"checkbox\" ng-click=\"select_network(item,$index);\" name=\"checkbox-inline\"><i></i></label></td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<td><p title=\"{{item.instance_id}}\">{{ item.display_name }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.usb_redir \" class=\"fa icon-jj-usb flag-icon\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.ha_enabled\" class=\"fa icon-jj-HA flag-icon\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><span ng-if=\"item.status=='running'\" localize-title=\"开机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='shutdown'\" localize-title=\"关机状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='paused'\" localize-title=\"挂起状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='migrating'\" localize-title=\"迁移状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='building'\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span ng-if=\"item.status=='error' ||item.status=='crashed' || item.status=='nostate'\" localize-title=\"错误状态\" class=\"status32\" ng-class=\"item.status\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{ item.running_time }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><p>{{ item.ips }}</p><p>{{ item.mac }}</p></td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.vcpu }} <span localize='核'></span> / {{item.memory_mb/1024 }}GB</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.hostname }}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<td class=\"view_personal_desktop\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\"  data-ng-click=\"config(item)\" localize-title=\"配置桌面\"><i class=\"fa icon-jj-005\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" data-id=\"{{ item.image_id }}\" data-os-type=\"{{ item.os_type }}\" onclick=\"window.open('templateModify.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&system_desktop');return false;\" href=\"javascript:\" data-localize-title=\"编辑桌面\"><i class=\"fa icon-jj-Write\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.status!=='shutdown' && currentItem.status!=='suspended'\"  data-ng-click=\"start(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"开机\">开机</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ng-disabled=\"currentItem.status!=='running' && currentItem.status!=='suspended'\"><a class=\"menu_label\" href=\"javascript:\" ><span localize=\"关机\">关机</span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"forceShutdown(currentItem)\" ng-disabled=\"currentItem.status!=='running' && currentItem.status!=='suspended'\" ><a class=\"menu_label\" href=\"javascript:\" localize=\"强制关机\">强制关机</a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"natureShutdown(currentItem)\" ng-disabled=\"currentItem.status!=='running' && currentItem.status!=='suspended'\" ><a class=\"menu_label\" href=\"javascript:\" localize=\"自然关机\">自然关机</a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"restart(currentItem)\"  ng-disabled=\"currentItem.status!=='running' && currentItem.status!=='suspended'\"><a class=\"menu_label\" href=\"javascript:\" localize=\"重启\">重启</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"pause(currentItem)\" ng-disabled=\"currentItem.status!=='running'\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"暂停\">暂停</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"resume(currentItem)\" ng-disabled=\"currentItem.status!=='paused'\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"恢复\">恢复</a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"delete(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"删除\">删除</a></li>\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_split\"></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-click=\"view(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" localize=\"查看桌面\">查看桌面</a></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-model=\"currentItem\" data-dialog=\"dynamicMigrationPersonalDialog\" data-dialog-size=\"md\" data-dialog-url=\"desktop/personal_dynamic_migration.html\" ng-disabled=\"currentItem.status!=='running'\" data-error=\"开机状态才可进行动态迁移！\"><a class=\"menu_label\" href=\"javascript:\"localize=\"动态迁移\">动态迁移</a></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-model=\"currentItem\" data-dialog=\"alterPersonalDialog\" data-dialog-size=\"md\" data-dialog-url=\"desktop/personal_alter.html\" data-error=\"关机状态才可进行桌面修改！\"  ng-disabled=\"currentItem.status!=='shutdown'\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"桌面修改\">桌面修改</a></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-model=\"currentItem\"  data-dialog=\"saveTemplatePersonalDialog\" data-dialog-size=\"md\" data-dialog-url=\"desktop/personal_save_template.html\" ng-disabled=\"currentItem.status!=='shutdown'\" data-error=\"关机状态才可执行存为模板操作！\"><a class=\"menu_label\" href=\"javascript:\"  localize=\"COPY_TEM\">另存为模板</a></li> -->\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\" data-ng-model=\"currentItem\" data-dialog=\"snapshotPersonalDialog\" data-dialog-size=\"md\" data-dialog-url=\"desktop/personal_snapshot.html\"><a class=\"menu_label\" href=\"javascript:\" localize=\"快照管理\">快照管理</a></li> -->\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end item -->\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/system/desktop.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-sm-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-12\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-dialog=\"addTemplateDialog\" data-dialog-size=\"lg\" data-dialog-url=\"system/template_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-dialog=\"systemTemplateRegisterDialog\" data-dialog-size=\"lg\" data-dialog-url=\"system/template_register.html\" href=\"javascript:\"><i class=\"con-jj-zhuche fa\"></i> <span data-localize=\"注册系统桌面\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side\"></div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive noborderbottom\">\r\n\t\t\t\t\t\t\t<div class=\"padding-20\">\r\n\t\t\t\t\t\t\t\t<div class=\"row teach_myrow\">\r\n\t\t\t\t\t\t\t        <div class=\"col-xs-12 col-sm-6 col-md-6 col-lg-4\" data-id=\"{{item.id}}\" data-ng-repeat=\"item in rows\">\r\n\t\t\t\t\t\t\t            <div class=\"panel pricing-big relative\" data-ng-class=\"{'panel-darken':item.status!='alive','panel-primary':item.status=='alive'}\">\r\n\t\t\t\t\t\t\t                <div class=\"panel-heading smart-form mypanelhead\">\r\n\t\t\t\t\t\t\t                \t<div class=\"checkbox row\">\r\n\t\t\t\t\t\t\t                \t\t<div class=\"col-md-1 col-sm-1 col-xs-1\">\r\n\t\t\t\t\t\t\t                \t\t\t<label class=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\" class=\"checkbox style-0\"><span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t                \t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h2 class=\"head-title col-md-11 col-sm-11 col-xs-11\" title=\"{{item.image_id}}\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{{item.name}}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"desc\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t                    <div class=\"template panel-cont flex\">\r\n\t\t\t\t\t\t\t                    \t<div class=\"panel-pic\" style=\"position: relative;bottom: 10px;\">\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"mynote\">\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='update failed'\" data-localize=\"TEMPLATE_UPDATE_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='updating'\" data-localize=\"TEMPLATE_UPDATING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='cloning'\" data-localize=\"TEMPLATE_CLONING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='sync failed'\" data-localize=\"TEMPLATE_SYNC_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='uploading'\" data-localize=\"UPLOADING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='register failed'\" data-localize=\"REGISTER_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='cloning failed'\" data-localize=\"CLONING_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='reset failed'\" data-localize=\"RESET_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='error'\" data-localize=\"CREATE_FAILED\"></span>\r\n\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='making'\" data-localize=\"MAKING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='saving'\" data-localize=\"SAVING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='saveAs'\" data-localize=\"SAVING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='installed'\" data-localize=\"INSTALLED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='syncing'\" data-localize=\"SYNCING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='building'\" data-localize=\"BUILDING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='making seed'\" data-localize=\"MAKING_SEED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='registering'\" data-localize=\"REGESTER\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='rebuilding'\" data-localize=\"REBUILDING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"pic-wrap\">\r\n\t\t\t\t\t\t\t                    \t\t\t<img ng-src=\"img/ajax-loader.gif\" data-ng-if=\"item.status =='making' || item.status =='syncing' || item.status == 'making seed'\">\r\n\t\t\t\t\t\t\t                    \t\t\t<img ng-src=\"img/{{ item.icon || 'win7.png' }}\" data-ng-if=\"item.status !== 'making' && item.status !== 'syncing' && item.status != 'making seed'\">\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div data-ng-if=\"item.status!='making' && item.status !='syncing' && item.status!='making seed'\">\r\n\t\t\t\t\t\t\t                    \t\t\t<p class=\"pic-version\">{{item.os_type}}</p>\r\n\t\t\t\t\t\t\t                    \t\t\t<p class=\"memsize\">{{item.is_64==true? 64:32}}Bit</p>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"panel-status\" >\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='running'\" localize-title=\"开机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='shutdown'\" localize-title=\"关机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='paused'\" localize-title=\"挂起状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='migrating'\" localize-title=\"迁移状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='building'\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='nostate'\" localize-title=\"未知状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='error' ||item.instance_status=='crashed'\" localize-title=\"错误状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='reboot'\" localize-title=\"重启中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='updating'\" localize-title=\"更新中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t</div>\r\n\t\t\t\t\t\t\t                    \t</div>\r\n\t\t\t\t\t\t\t\t                  \t<ul class=\"panel-mess\">\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label localize-title=\"系统盘\" data-localize=\"系统盘\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.updateSize?item.updateSize:item.system_size_desc}}G/{{item.system_size_total}}G</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"数据盘\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.data_size_desc}}G/{{item.data_size_total}}G</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label localize-title=\"关联桌面数\" data-localize=\"关联桌面数\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.instance_count}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label localize-title=\"创建者\" data-localize=\"创建者\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.owner_desc}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label localize-title=\"创建时间\" data-localize=\"创建时间\"></label>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"item-flex\">{{item.created_at | date:'yyyy-MM-dd HH:mm:ss'}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t\t                </ul>\r\n\t\t\t\t\t\t\t                  \t</div>\r\n\t\t\t\t\t\t\t                </div>\r\n\r\n\t\t\t\t\t\t\t                 <div class=\"panel-footbar\" data-ng-class=\"{'darken':item.status!='alive','primary':item.status=='alive'}\">\r\n\t\t\t\t\t\t                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-ng-if=\"(item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed') && sync_mode == 'bt'\" onclick=\"window.open('templateModifybt.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name') + '&sytem_desktop');return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t\t\t\t\t                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-ng-if=\"(item.status=='alive' || item.status =='making' || item.status =='installed') && sync_mode == 'scp'\" onclick=\"window.open('templateModify.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name') + '&sytem_desktop');return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"icon\" data-ng-if=\"item.status=='alive'\" ng-class=\"{'limitItem': item.instance_status!=='shutdown'}\" data-ng-click=\"editSysdesktop(item)\" data-localize-title=\"配置桌面\"><i class=\"fa icon-jj-009\"></i></a>\t\r\n\t\t\t\t\t\t                \t<!-- <a href=\"javascript:void(0)\" data-ng-if=\"item.status=='alive'\" class=\"icon\" data-localize-title=\"另存为\" data-ng-click=\"copy(item)\"><i class=\"fa icon-jj-copy\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"more_list_container\">\r\n\t\t                \t                \t\t<a href=\"javascript:\" class=\"icon more_icon\" data-localize-title=\"MORE\"><i class=\"fa icon-jj-more\"></i></a>\r\n\t\t                \t                \t\t<div class=\"menu_wrapper my_menu_wrapper\">\r\n\t\t                \t                \t\t\t<div class=\"arraw\"></div>\r\n\t\t                \t                \t\t\t<ul class=\"menu_item_list\">\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-click=\"delete(item)\" href=\"javascript:void(0)\"><span class=\"fa fa-trash-o\"></span> <span data-localize=\"删除\"></span></a></li>\r\n\t\t                \t                \t\t\t</ul>\r\n\t\t                \t                \t\t</div>\r\n\t\t                \t                \t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a class=\"icon\" data-ng-if=\"item.status =='update failed'\" data-id=\"{{ item.id }}\" onclick=\"window.open('templateModify.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type'),'_new','location=no,menubar=no,resizable=yes,scrollbars=yes,status=no,toolbar=no');return false;\" href=\"javascript:\" data-localize-title=\"查看详情\"><i class=\"fa icon-jj-look\"></i></a> -->\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t\t        </div>\r\n\t\t\t\t\t    \t\t</div>\r\n\t\t\t\t\t    \t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n","views/vdi/system/device.html":"<section >\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 left-btn-group\"></div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\">\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"显示\"></span>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageSizeChange()\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-options=\"pagesize for pagesize in pagesizes\"\r\n\t\t\t\t\t\t\t\t\t></select>\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"项结果\"></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"设备名称\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"设备制造商\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>PID</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>VID</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"所属主机\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"透传到桌面\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"描述\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\" ><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.made }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.PID }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.VID }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.host }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.desktop }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.desc }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><a class=\"btn btn-xs btn-default\" data-ng-click=\"transmission()\" data-localize-title=\"透传\"><i class=\"fa icon-jj-Write\"></i></a></td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n\r\n<script>pageSetUp();</script>","views/vdi/system/endlogs.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-sm-9\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-sm-3 text-right\">\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left-btn-group left_side  col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\"  href=\"javascript:\"><i class=\"fa  icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-click=\"deleteAll()\" href=\"javascript:\"><i class=\"fa  icon-jj-Empty\"></i>&nbsp;<span localize=\"清空\">清空</span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<!-- <div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" class=\"mysmallinput\" type=\"number\" data-ng-model=\"pagesize\" data-ng-change=\"logPageSizeChange()\" data-ng-options=\"pagesize for pagesize in pagesizes\" input-number></input> <span localize=\"项结果\"></span> </div> -->\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"userSort\" ng-click=\"userSort = !userSort;sort('user', userSort)\" localize=\"操作者\">操作者</th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"contentSort\" ng-click=\"contentSort = !contentSort;sort('content', contentSort)\" localize=\"操作内容\">操作内容</th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"timeSort\" ng-click=\"timeSort = !timeSort;sort('datetime', timeSort)\" localize=\"操作时间\">操作时间</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.user }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td><p class=\"text-overflow text-overflow-log\">{{ item.content }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.datetime |  date:\"yyyy-MM-dd HH:mm:ss\" }}</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<div data-ng-show=\"totalCount > 0\" class=\"dt-toolbar-footer row\">\r\n\t\t\t\t\t\t\t<div data-grid-pagination class=\"col-sm-6 col-xs-12 hidden-xs\">\r\n\t\t\t\t\t\t\t\t<div class=\"dataTables_info\" role=\"status\"\r\n\t\t\t\t\t\t\t\t\tdata-localize=\"PAGE\" \r\n\t\t\t\t\t\t\t\t\tparam1=\"{{ getStart() }}\"\r\n\t\t\t\t\t\t\t\t\tparam2=\"{{ rows.length > 0 ? getStart() + rows.length - 1 : 0 }}\"\r\n\t\t\t\t\t\t\t\t\tparam3=\"{{ totalCount }} \"\r\n\t\t\t\t\t\t\t\t></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"dataTables_paginate paging_simple_numbers\">\r\n\t\t\t\t\t\t\t\t\t<pagination\r\n\t\t\t\t\t\t\t\t\t\tboundary-links=\"true\"\r\n\t\t\t\t\t\t\t\t\t\ttotal-items=\"totalCount\"\r\n\t\t\t\t\t\t\t\t\t\titems-per-page=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"currentPage\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"logPageChange()\"\r\n\t\t\t\t\t\t\t\t\t\trotate=\"true\"\r\n\t\t\t\t\t\t\t\t\t\tmax-size=\"10\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"pagination-sm\"\r\n\t\t\t\t\t\t\t\t\t\tprevious-text=\"&lsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\tnext-text=\"&rsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\tfirst-text=\"&laquo;\"\r\n\t\t\t\t\t\t\t\t\t\tlast-text=\"&raquo;\"\r\n\t\t\t\t\t\t\t\t\t></pagination>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- widget div end -->\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/system/iso.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"form-group col-xs-4 col-sm-5\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-xs-2\"><button class=\"btn btn-primary\" ng-disabled=\"isUploading\" ng-click=\"upload()\"><i class=\"icon icon-jj-Upload\"></i><span localize=\"上传\" ></span></button></div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-xs-9 upload-progress\" ng-show=\"isUploading\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"upload-cancel-icon icon  icon-jj-close-2\" ng-click=\"abortUpload()\"></span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"progress-percent\">{{progressPercent}}</span>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"progress progress-xs\"><div class=\"progress-bar bg-color-blue\" role=\"progressbar\" ng-style=\"{'width':progressPercent}\"></div></div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"upload-mess\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"progress-word\" title=\"{{progressName}}\">{{progressName}}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-8 col-sm-7\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\" data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div>\r\n\t\t\t\t\t\t\t\t\t<select class=\"pull-right selectclassroomName filter\" ng-model=\"select\" ng-change=\"updateData(searchText,select)\">\r\n\t\t\t\t\t\t\t\t\t\t<option localize=\"所有\" value=''></option>\r\n\t\t\t\t\t\t\t\t\t\t<option localize=\"系统包\" value='system'></option>\r\n\t\t\t\t\t\t\t\t\t\t<option localize=\"软件包\" value='package'></option>\r\n\t\t\t\t\t\t\t\t\t\t<option localize=\"其它\" value='other'></option>\r\n\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n                                        <th localize=\"路径\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"isoNameSort\" ng-click=\"isoNameSort = !isoNameSort;sort('name', isoNameSort)\" localize=\"ISO名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"大小\"></th>\r\n\r\n                                        <th ng-model=\"autoSort\" ng-click=\"autoSort = !autoSort;sort('support_auto_install', autoSort)\" localize=\"自动安装\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"系统类型\"></th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"isoTimeSort\" ng-click=\"isoTimeSort = !isoTimeSort;sort('created_at', isoTimeSort)\" localize=\"上传时间\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"nowrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t<p ng-show=\"!item.type_editable\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<b ng-if=\"item.type=='system'\" localize=\"系统包\"></b>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<b ng-if=\"item.type=='package'\" localize=\"软件包\"></b>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<b ng-if=\"item.type=='other'\" localize=\"其它\"></b>\r\n\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t<select ng-show=\"item.type_editable\" name=\"formSelectType\" ng-model=\"item.type\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"system\" localize=\"系统包\"></option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"package\" localize=\"软件包\"></option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"other\" localize=\"其它\"></option>\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<td><div class=\"break_all\">{{ item.name }}</div></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<span data-ng-if=\"item.size && item.size>=1024\">{{ item.size/1024 | number:2 }}GB</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span data-ng-if=\"item.size && item.size<1024\">{{ item.size | number:2 }}MB</span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\r\n                                        <td >\r\n                                        \t<span localize=\"支持\" ng-if=\"item.support_auto_install\"></span>\r\n                                        \t<span localize=\"不支持\" ng-if=\"!item.support_auto_install\"></span>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t\t<td >\r\n                                            <span ng-show=\"!item.os_editable\">{{item.os_type.value}}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<select ng-show=\"item.os_editable\" data-ng-model=\"item.os_type\" data-ng-options=\"os_type.value for os_type in os_types track by os_type.key\">\r\n\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.created_at | date:\"yyyy-MM-dd HH:mm:ss\"  }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"nowrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\" ng-show=\"!item._editstatus\" ng-click=\"item._editstatus = true;edit(item);\" localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\" ng-show=\"item._editstatus\" ng-click=\"item._editstatus = false;cancel(item)\" localize-title=\"取消\"><i class=\"fa icon-jj-recovery\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\" ng-show=\"item._editstatus\" ng-click=\"change(item);item._editstatus = false\" localize-title=\"保存\"><i class=\"fa icon-jj-Preservation\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" localize-title=\"下载\" href='{{ domain }}/download/iso/{{item.name}}' download=\"{{ item.name }}\"><i class=\"fa icon-jj-Download\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\" ng-click=\"delete(item)\" localize-title=\"删除\"><i class=\"fa icon-jj-delete\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- widget div end -->\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>\r\npageSetUp();\r\n</script>","views/vdi/system/logs.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left-btn-group left_side  col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\"  href=\"javascript:\"><i class=\"fa  icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-click=\"deleteAll()\" href=\"javascript:\"><i class=\"fa  icon-jj-Empty\"></i>&nbsp;<span localize=\"清空\">清空</span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<!-- <div class=\"pull-right filter\"> <span localize=\"显示\"></span> <input min=\"1\" class=\"mysmallinput\" type=\"number\" data-ng-model=\"pagesize\" data-ng-change=\"logPageSizeChange()\" data-ng-options=\"pagesize for pagesize in pagesizes\" input-number></input> <span localize=\"项结果\"></span> </div> -->\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" class=\"form-control\" ng-model=\"searchText\" data-ng-keyup='search($event)'></label></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"userSort\" ng-click=\"userSort = !userSort;sort('user', userSort)\" localize=\"操作者\">操作者</th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"contentSort\" ng-click=\"contentSort = !contentSort;sort('content', contentSort)\" localize=\"操作内容\">操作内容</th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"timeSort\" ng-click=\"timeSort = !timeSort;sort('datetime', timeSort)\" localize=\"操作时间\">操作时间</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows | paging:currentPage:pagesize\">\r\n\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.user }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td><p class=\"text-overflow text-overflow-log\" title=\"{{ item.content }}\">{{ item.content }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.datetime |  date:\"yyyy-MM-dd HH:mm:ss\" }}</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<div data-ng-show=\"totalCount > 0\" class=\"dt-toolbar-footer row\">\r\n\t\t\t\t\t\t\t<div data-grid-pagination class=\"col-sm-6 col-xs-12 hidden-xs\">\r\n\t\t\t\t\t\t\t\t<div class=\"dataTables_info\" role=\"status\"\r\n\t\t\t\t\t\t\t\t\tdata-localize=\"PAGE\" \r\n\t\t\t\t\t\t\t\t\tparam1=\"{{ getStart() }}\"\r\n\t\t\t\t\t\t\t\t\tparam2=\"{{ rows.length > 0 ? getStart() + rows.length - 1 : 0 }}\"\r\n\t\t\t\t\t\t\t\t\tparam3=\"{{ totalCount }} \"\r\n\t\t\t\t\t\t\t\t></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"dataTables_paginate paging_simple_numbers\">\r\n\t\t\t\t\t\t\t\t\t<pagination\r\n\t\t\t\t\t\t\t\t\t\tboundary-links=\"true\"\r\n\t\t\t\t\t\t\t\t\t\ttotal-items=\"totalCount\"\r\n\t\t\t\t\t\t\t\t\t\titems-per-page=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"currentPage\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"logPageChange()\"\r\n\t\t\t\t\t\t\t\t\t\trotate=\"true\"\r\n\t\t\t\t\t\t\t\t\t\tmax-size=\"10\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"pagination-sm\"\r\n\t\t\t\t\t\t\t\t\t\tprevious-text=\"&lsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\tnext-text=\"&rsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\tfirst-text=\"&laquo;\"\r\n\t\t\t\t\t\t\t\t\t\tlast-text=\"&raquo;\"\r\n\t\t\t\t\t\t\t\t\t></pagination>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- widget div end -->\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/system/set.html":"<section id=\"widget-grid\">\r\n    <div class=\"row\">\r\n        <article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n            <div data-widget-grid class=\"jarviswidget\">\r\n                <!-- widget div-->\r\n                <div class=\"noborder sysSet\">\r\n                    <div class=\"widget-body no-padding\">\r\n                        <div ng-controller=\"vdiSystemRecycleController as RecycleCtrl\">\r\n                            <h4 localize='资源回收'></h4>\r\n                            <span class=\"desk-border\">&nbsp;</span>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"col-xs-6\" style=\"padding-left: 25px;\">\r\n                                    <label class=\"col-xs-12 control-label\" for=\"time\" style=\"font-weight: 700\" localize=\"教学桌面\"></label>\r\n                                    <div class=\"col-xs-12\">\r\n                                        <div class=\"teach-desk\">\r\n                                            <label class=\"checkbox-inline checkbox-align week-label\">\r\n                                                <input \r\n                                                    class=\"checkbox\" \r\n                                                    type=\"checkbox\" \r\n                                                    name=\"start\" \r\n                                                    ng-model=\"RecycleCtrl.data.tecOpen\" \r\n                                                    ng-change='RecycleCtrl.setTechDefault(RecycleCtrl.data.tecOpen)'\r\n                                                    >\r\n                                                <span localize=\"启用\"></span>\r\n                                            </label>\r\n                                            <img src=\"img/loadingtext.gif\" data-ng-if=\"RecycleCtrl.techenabling\" height=\"24\" width=\"24\" alt=\"\"><br/>\r\n                                            <div class=\"offline-connect\">\r\n                                                <span localize=\"断开连接\"></span>&nbsp;\r\n                                                <input class=\"form-control inline\" input-number\r\n                                                    type=\"text\" \r\n                                                    name=\"hours\" \r\n                                                    style=\"width:70px;padding-left: 5px;\"\r\n                                                    data-ng-pattern=\"/^(00[5-9]|0[5-9]|[5-9]|0[1-9][0-9]|[1-9][0-9]|[1-6][0-9][0-9]|7[0-1][0-9]|720)$/\"\r\n                                                    placeholder=\"5-720\" \r\n                                                    maxlength=\"3\"\r\n                                                    min=\"5\"  \r\n                                                    max=\"720\" \r\n                                                    ng-model=\"RecycleCtrl.data.tecDesk\" \r\n                                                    ng-disabled=\"!RecycleCtrl.techEdit || RecycleCtrl.techSave\"\r\n                                                    >\r\n                                                <span localize=\"after-minutes\"></span>\r\n                                                <select class=\"form-control inline\"\r\n                                                    style=\"width: 100px\" \r\n                                                    ng-model=\"RecycleCtrl.data.tecStatus\" \r\n                                                    ng-disabled=\"!RecycleCtrl.techEdit || RecycleCtrl.techSave\">\r\n                                                    <option value=\"shutdown\" localize=\"自然关机\"></option>\r\n                                                    <option value=\"suspend\" localize=\"挂起\"></option>\r\n                                                </select><br/>\r\n                                            </div>\r\n                                            <img class='recycleLoading' src=\"img/loadingtext.gif\" data-ng-if=\"RecycleCtrl.techSave\" height=\"24\" width=\"24\" alt=\"\">\r\n                                            <div class=\"btn btn-primary btn-update\" ng-disabled=\"!RecycleCtrl.data.tecOpen\" ng-click=\"RecycleCtrl.techEdit = true\" ng-if=\"!RecycleCtrl.techEdit && !RecycleCtrl.techSave\" localize=\"更改\"></div>\r\n                                            <div class=\"btn btn-primary btn-save\" ng-disabled='RecycleCtrl.data.tecOpen && !RecycleCtrl.data.tecDesk' ng-click=\"RecycleCtrl.tecSave()\" ng-if=\"RecycleCtrl.techEdit && !RecycleCtrl.techSave\" localize=\"保存\"></div>\r\n                                            <div class=\"btn btn-primary btn-cencel\" ng-click=\"RecycleCtrl.techEdit = false;RecycleCtrl.getTech()\" ng-if=\"RecycleCtrl.techEdit && !RecycleCtrl.techSave\" localize=\"取消\"></div> \r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"col-xs-6\">\r\n                                    <label class=\"col-xs-12 control-label\" for=\"time\" style=\"font-weight: 700\" localize=\"个人桌面\"></label>\r\n                                    <div class=\"col-xs-12\">\r\n                                        <div class=\"teach-desk\">\r\n                                            <label class=\"checkbox-inline checkbox-align week-label\">\r\n                                                <input\r\n                                                    class=\"checkbox\"\r\n                                                    type=\"checkbox\"\r\n                                                    name=\"start\"\r\n                                                    ng-model=\"RecycleCtrl.submit.perOpen\"\r\n                                                    ng-change='RecycleCtrl.setPerDefault(RecycleCtrl.submit.perOpen)'\r\n                                                >\r\n                                                <span localize=\"启用\"></span>\r\n                                            </label>\r\n                                            <img src=\"img/loadingtext.gif\" data-ng-if=\"RecycleCtrl.perenabling\" height=\"24\" width=\"24\" alt=\"\"><br/>\r\n                                            <div class=\"offline-connect\">\r\n                                                <span localize=\"断开连接\"></span>&nbsp;\r\n                                                <input type=\"text\" class=\"form-control inline\" input-number\r\n                                                    name=\"hours\" \r\n                                                    style=\"width:70px;padding-left: 5px;\" \r\n                                                    data-ng-pattern=\"/^(0[1-9]|[1-9]|[1-3][0-9]|4[0-8])$/\" \r\n                                                    maxlength=\"2\"\r\n                                                    min=\"1\"  \r\n                                                    max=\"48\" \r\n                                                    placeholder=\"1-48\"\r\n                                                    ng-model=\"RecycleCtrl.submit.perDesk\"\r\n                                                    ng-disabled=\"!RecycleCtrl.personEdit || RecycleCtrl.personSave\"\r\n                                                    >\r\n                                                <span localize=\"after-hours\"></span>\r\n                                                <select class=\"form-control inline\" style=\"width: 100px\" \r\n                                                        ng-model=\"RecycleCtrl.submit.perStatus\"\r\n                                                        ng-disabled=\"!RecycleCtrl.personEdit || RecycleCtrl.personSave\">\r\n                                                    <option value=\"shutdown\" localize=\"自然关机\"></option>\r\n                                                    <option value=\"suspend\" localize=\"挂起\"></option>\r\n                                                </select><br/>\r\n                                            </div>\r\n                                            <img class='recycleLoading' src=\"img/loadingtext.gif\" data-ng-if=\"RecycleCtrl.personSave\" height=\"24\" width=\"24\" alt=\"\">\r\n                                            <div class=\"btn btn-primary btn-update\" ng-disabled=\"!RecycleCtrl.submit.perOpen\" ng-if=\"!RecycleCtrl.personEdit && !RecycleCtrl.personSave\" ng-click=\"RecycleCtrl.personEdit = true\" localize=\"更改\"></div>\r\n                                            <div class=\"btn btn-primary btn-save\" ng-disabled='RecycleCtrl.submit.perOpen && !RecycleCtrl.submit.perDesk' ng-if=\"RecycleCtrl.personEdit && !RecycleCtrl.personSave\" ng-click=\"RecycleCtrl.perSave()\" localize=\"保存\"></div>\r\n                                            <div class=\"btn btn-primary btn-cencel\" ng-if=\"RecycleCtrl.personEdit && !RecycleCtrl.personSave\" ng-click=\"RecycleCtrl.personEdit = false;RecycleCtrl.getPerson()\" localize=\"取消\"></div> \r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div ng-controller=\"vdiSystemOutsideController\" style=\"clear: both;\">\r\n                            <h4 localize='外网访问'></h4>\r\n                            <span class=\"desk-border\">&nbsp;</span>\r\n                            <div class=\"form-group\">\r\n                                <section class='outside'>\r\n                                    <form class=\"form-horizontal\" name=\"outsideFrom\" method=\"post\" ng-submit=\"outsideFrom.$valid\"  novalidate>\r\n                                        <div class=\"form-group\">\r\n                                            <label class=\"control-label col-xs-1\"></label>\r\n                                            <label class=\"control-label\">\r\n                                                <input type=\"checkbox\" data-ng-disabled=\"save_loading\" class=\"checkbox\" data-ng-change=\"start()\" data-ng-model=\"enable\">\r\n                                                <span data-localize=\"启用\"></span>\r\n                                                <img ng-show=\"enable_loading\" ng-src=\"img/loadingtext.gif\" width=\"16px\" height=\"16px\"/>\r\n                                            </label>\r\n                                        </div>\r\n                                        <div class=\"form-group\">\r\n                                            <label class=\"control-label col-xs-1\" data-localize=\"外网IP\"></label>\r\n                                            <div class=\"col-xs-2\" style=\"padding-left: 0\" data-ng-class=\"{'state-success':outsideFrom.IP.$valid && outsideFrom.IP.$dirty,'state-error':outsideFrom.IP.$invalid && outsideFrom.IP.$dirty, 'state-disabled': !enable}\">\r\n                                                <input class=\"form-control\" type=\"text\" name=\"IP\" format-ip ng-model=\"IP\">\r\n                                            </div>\r\n                                            <div>\r\n                                                <button type=\"submit\" name=\"button\" disabled=\"disabled\" class=\"btn btn-primary\"\r\n                                                        data-ng-disabled=\"outsideFrom.$invalid || !IP || !enable || enable_loading || save_loading || ips_loading\"\r\n                                                        data-ng-click=\"save()\" data-localize=\"保存\"></button>\r\n                                                <img ng-show=\"save_loading\" ng-src=\"img/loadingtext.gif\" width=\"16px\" height=\"16px\"/>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div class=\"form-group\">\r\n                                            <label class=\"control-label col-xs-1\"></label>\r\n                                            <button class=\"btn btn-primary\"\r\n                                                    data-ng-disabled=\"outsideFrom.$invalid || !IP  || !enable || enable_loading || save_loading\"\r\n                                                    data-dialog=\"outsideAdvancedDialog\"\r\n                                                    data-dialog-size=\"sm\"\r\n                                                    data-dialog-url=\"system/outside_advanced.html\"\r\n                                                    data-localize=\"高级\"></button>\r\n                                        </div>\r\n                                        <div class=\"form-group\">\r\n                                            <label class=\"control-label col-xs-1\" ></label>\r\n                                            <div class=\"col-xs-9\" style=\"padding-left: 0\">\r\n                                                <div class=\"tip\" data-localize='OUTER_IP_NOTE'></div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </form>\r\n                                </section>\r\n                            </div>\r\n                        </div>\r\n                        <div ng-controller=\"spiceConnectController as spiceCtrl\" style=\"clear: both;\">\r\n                            <h4 localize='连接模式'></h4>\r\n                            <span class=\"desk-border\">&nbsp;</span>\r\n                            <form class=\"form-horizontal\" name=\"spiceFrom\" method=\"post\" ng-submit=\"spiceFrom.$valid\"  novalidate>\r\n                                <div class=\"form-group\">\r\n                                    <label class=\"control-label col-xs-1\" data-localize=\"连接模式\"></label>\r\n                                    <div class=\"col-xs-2\" style=\"white-space: nowrap;\">\r\n                                        <select class=\"form-control inline\"\r\n                                            ng-model=\"spiceCtrl.mode\" \r\n                                            ng-disabled=\"!spiceCtrl.edit || spiceCtrl.save\">\r\n                                            <option value=\"always\" localize=\"高质量\"></option>\r\n                                            <option value=\"auto_glz\" localize=\"高流畅性\"></option>\r\n                                        </select>\r\n                                        <label>\r\n                                            <a href=\"javascript:void(0);\" style=\"margin-left: 10px\" rel=\"popover-hover\" data-ribbon-tips data-my-tips='spiceConnectTip' data-placement=\"right\" data-html=\"true\" data-content=\"\" data-original-title=\"\" title=\"\"><i class=\"fa fa-question-circle\"></i></a>\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"form-group\">\r\n                                    <label class=\"control-label col-xs-1\"></label>\r\n                                    <div class=\"col-xs-2 text-right\">\r\n                                        <img class='recycleLoading' src=\"img/loadingtext.gif\" data-ng-if=\"spiceCtrl.save\" height=\"24\" width=\"24\" alt=\"\">\r\n                                        <div class=\"btn btn-primary\" ng-disabled=\"spiceCtrl.loading\" ng-click=\"spiceCtrl.edit = true\" ng-if=\"!spiceCtrl.edit && !spiceCtrl.save\" localize=\"更改\"></div>\r\n                                        <div class=\"btn btn-primary\" ng-click=\"spiceCtrl.saveSpiceConnect()\" ng-if=\"spiceCtrl.edit && !spiceCtrl.save\" localize=\"保存\"></div>\r\n                                        <div class=\"btn btn-primary\" ng-click=\"spiceCtrl.edit = false;spiceCtrl.getSpiceConnect()\" ng-if=\"spiceCtrl.edit && !spiceCtrl.save\" localize=\"取消\" style=\"margin-left: 10px;\"></div> \r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                        <div ng-controller=\"vdiSystemtimeSyncController as SyncCtrl\">\r\n                            <h4 localize='时间同步'></h4>\r\n                            <span class=\"desk-border\">&nbsp;</span>\r\n                            <div class=\"form-group\">\r\n                                <section class='timeSync'>\r\n                                    <form class=\"form-horizontal\" name=\"timeSyncFrom\" style=\"float: left;\" novalidate>\r\n                                        <div class='col-xs-5'>\r\n                                            <label class=\"control-label\" for=\"time\" localize=\"时区\"></label>\r\n                                            <select style=\"margin: 10px 0;\" class=\"form-control\" ng-disabled='!SyncCtrl.modifyTime' ng-model=\"SyncCtrl.zone\" data-ng-options=\"'('+zone.offset+') '+zone.value for zone in SyncCtrl.zones\"></select>\r\n                                            <div  class='col-xs-12' style=\"padding: 0\">\r\n                                                <div class=\"col-xs-6\" style=\"padding-left: 0\">\r\n                                                    <p class=\"input-group\" style=\"margin: 0\">\r\n                                                        <span class=\"input-group-btn\">\r\n                                                            <button type=\"button\" class=\"btn btn-default\" ng-disabled='!SyncCtrl.modifyTime' data-ng-click=\"SyncCtrl.openStartDate($event)\" ><i class=\"glyphicon glyphicon-calendar\" ></i></button>\r\n                                                        </span>\r\n                                                        <input type=\"text\"\r\n                                                            scheduler-input\r\n                                                            placeholder=\"yyyy-mm-dd\" \r\n                                                            class=\"form-control\"\r\n                                                            datepicker-popup=\"yyyy-MM-dd\"\r\n                                                            data-ng-model=\"SyncCtrl.choose_time\"\r\n                                                            is-open=\"SyncCtrl.startDateOpened\"\r\n                                                            datepicker-options=\"SyncCtrl.startDateOptions\"\r\n                                                            show-weeks=\"false\"\r\n                                                            show-button-bar=\"false\"\r\n                                                            required\r\n                                                            ng-disabled='!SyncCtrl.modifyTime'\r\n                                                        >\r\n                                                    </p>\r\n                                                </div>\r\n                                                <div class=\"col-xs-2 hour\">\r\n                                                    <input input-number\r\n                                                        class=\"form-control\" \r\n                                                        type=\"text\" \r\n                                                        data-ng-pattern=\"/^(0[0-9]|[0-9]|1[0-9]|2[0-3])$/\" \r\n                                                        maxlength=\"2\"\r\n                                                        min=\"0\"\r\n                                                        max=\"23\"\r\n                                                        required\r\n                                                        ng-model=\"SyncCtrl.hours\"\r\n                                                        ng-disabled='!SyncCtrl.modifyTime'\r\n                                                        ng-change='SyncCtrl.loopTime=false'\r\n                                                        />\r\n                                                </div>\r\n                                                <div class=\"col-xs-2 minute\">\r\n                                                    <input input-number\r\n                                                        class=\"form-control\" \r\n                                                        type=\"text\"\r\n                                                        data-ng-pattern=\"/^(0[0-9]|[0-9]|[1-5][0-9])$/\" \r\n                                                        maxlength=\"2\"\r\n                                                        min=\"0\"\r\n                                                        max=\"59\"\r\n                                                        required\r\n                                                        ng-model=\"SyncCtrl.minutes\"\r\n                                                        ng-disabled='!SyncCtrl.modifyTime'\r\n                                                        ng-change='SyncCtrl.loopTime=false'\r\n                                                        />\r\n                                                </div>\r\n                                                <div class=\"col-xs-2 second\">\r\n                                                    <input input-number\r\n                                                        class=\"form-control\"\r\n                                                        data-ng-pattern=\"/^(0[0-9]|[0-9]|[1-5][0-9])$/\"\r\n                                                        maxlength=\"2\"\r\n                                                        min=\"0\"\r\n                                                        max=\"59\"\r\n                                                        required\r\n                                                        ng-model=\"SyncCtrl.seconds\"\r\n                                                        ng-disabled='!SyncCtrl.modifyTime'\r\n                                                        type=\"text\"\r\n                                                        ng-change='SyncCtrl.loopTime=false'\r\n                                                        />\r\n                                                </div>\r\n                                            </div>\r\n                                            <div class=\"col-xs-12 text-right\" style=\"padding: 0;margin: 15px 0 20px 0\">\r\n                                                <img src=\"img/loadingtext.gif\" data-ng-if=\"SyncCtrl.updating_zone\" height=\"24\" width=\"24\" alt=\"\">\r\n                                                <button class=\"btn btn-primary\" data-ng-disabled='SyncCtrl.loading_zone || SyncCtrl.loading_internet || SyncCtrl.loading_updateServer' ng-if=\"!SyncCtrl.modifyTime\" ng-click=\"SyncCtrl.modifyTime = true\" localize=\"更改\"></button>\r\n                                                <button class=\"btn btn-primary\" data-ng-disabled='!SyncCtrl.hours || !SyncCtrl.minutes || !SyncCtrl.seconds || !matchInput' ng-if=\"SyncCtrl.modifyTime && !SyncCtrl.updating_zone\" ng-click=\"SyncCtrl.updateZone()\" localize=\"保存\"></button>\r\n                                                <button class=\"btn btn-primary\" ng-if=\"SyncCtrl.modifyTime && !SyncCtrl.updating_zone\" ng-click=\"SyncCtrl.modifyTime = false;SyncCtrl.loadZone()\" localize=\"取消\" style=\"margin-left: 10px\"></button>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div class=\"col-xs-6 col-xs-offset-1 server\">\r\n                                            <div class=\"col-xs-12\">\r\n                                                <label>\r\n                                                    <input \r\n                                                        class=\"checkbox\" \r\n                                                        type=\"checkbox\" \r\n                                                        name=\"start\"\r\n                                                        ng-model=\"SyncCtrl.internetSync\" \r\n                                                        ng-disabled=\"SyncCtrl.loading_internet || SyncCtrl.loading_updateServer\"\r\n                                                        ng-change='SyncCtrl.setInternetSync(SyncCtrl.internetSync)'\r\n                                                        >\r\n                                                    <span localize=\"与Internet时间服务器同步(s)\"></span>\r\n                                                </label>\r\n                                                <img ng-if=\"SyncCtrl.loading_internet\" src=\"img/loadingtext.gif\" height=\"12\" width=\"12\">\r\n                                            </div>\r\n                                            <div class=\"col-xs-12\">\r\n                                                <label class=\"col-xs-3 control-label\" style=\"white-space: nowrap;\" for=\"network\" data-localize=\"服务器(E):\"></label>\r\n                                                <div class=\"col-xs-6\">\r\n                                                    <select class=\"form-control inline\" \r\n                                                            data-ng-options=\"server for server in SyncCtrl.servers\"\r\n                                                            ng-model=\"SyncCtrl.server\"\r\n                                                            ng-disabled='SyncCtrl.loading_updateServer'>\r\n                                                        <!-- <option value=\"\" localize=\"请选择\"></option> -->\r\n                                                    </select>\r\n                                                </div>\r\n                                                <div class=\"col-xs-3\">\r\n                                                    <img ng-if='SyncCtrl.loading_updateServer' src=\"img/loadingtext.gif\" height=\"24\" width=\"24\">\r\n                                                    <button ng-if='!SyncCtrl.loading_updateServer' class=\"btn btn-primary immediateSync\" ng-click=\"SyncCtrl.updateSyncServer()\" localize=\"立即同步\"></button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </form>\r\n                                </section>\r\n                            </div>\r\n                        </div>\r\n                        <div ng-controller='vdiSystemAutoclearController as clearCtrl'>\r\n                            <h4 localize='共享磁盘自动清理时间'></h4>\r\n                            <span class=\"desk-border\">&nbsp;</span>\r\n                            <form class=\"form-horizontal\" name=\"clearFrom\" method=\"post\" ng-submit=\"clearFrom.$valid\" style=\"padding-left: 25px\" novalidate>\r\n                                <div class=\"form-group col-xs-12\" style=\"font-weight: 700\" localize=\"教学桌面\"></div>\r\n                                <div class=\"form-group col-xs-5 clearTime\">\r\n                                    <label class=\"control-label col-xs-1\" data-localize=\"每\" style=\"padding-right: 0\"></label>\r\n                                    <div class=\"col-xs-5\">\r\n                                        <select class=\"form-control inline\" ng-disabled='!clearCtrl.edit || clearCtrl.save' ng-model=\"clearCtrl.day\">\r\n                                            <option value=\"Mon\" data-localize=\"周一\">周一</option>\r\n                                            <option value=\"Tue\" data-localize=\"周二\">周二</option>\r\n                                            <option value=\"Wed\" data-localize=\"周三\">周三</option>\r\n                                            <option value=\"Thu\" data-localize=\"周四\">周四</option>\r\n                                            <option value=\"Fri\" data-localize=\"周五\">周五</option>\r\n                                            <option value=\"Sat\" data-localize=\"周六\">周六</option>\r\n                                            <option value=\"Sun\" data-localize=\"周日\">周日</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div class=\"col-xs-2 hour\">\r\n                                        <input input-number\r\n                                            class=\"form-control\" \r\n                                            type=\"text\" \r\n                                            data-ng-pattern=\"/^(0[0-9]|[0-9]|1[0-9]|2[0-3])$/\" \r\n                                            maxlength=\"2\"\r\n                                            min=\"0\"\r\n                                            max=\"23\"\r\n                                            required\r\n                                            ng-model=\"clearCtrl.hours\"\r\n                                            ng-disabled='!clearCtrl.edit || clearCtrl.save'\r\n                                            />\r\n                                    </div>\r\n                                    <div class=\"col-xs-2 minute\">\r\n                                        <input input-number\r\n                                            class=\"form-control\" \r\n                                            type=\"text\"\r\n                                            data-ng-pattern=\"/^(0[0-9]|[0-9]|[1-5][0-9])$/\" \r\n                                            maxlength=\"2\"\r\n                                            min=\"0\"\r\n                                            max=\"59\"\r\n                                            required\r\n                                            ng-model=\"clearCtrl.minutes\"\r\n                                            ng-disabled='!clearCtrl.edit || clearCtrl.save'\r\n                                            />\r\n                                    </div>\r\n                                    <div class=\"col-xs-2 second\">\r\n                                        <input input-number\r\n                                            class=\"form-control\"\r\n                                            data-ng-pattern=\"/^(0[0-9]|[0-9]|[1-5][0-9])$/\"\r\n                                            maxlength=\"2\"\r\n                                            min=\"0\"\r\n                                            max=\"59\"\r\n                                            required\r\n                                            ng-model=\"clearCtrl.seconds\"\r\n                                            ng-disabled='!clearCtrl.edit || clearCtrl.save'\r\n                                            type=\"text\"\r\n                                            />\r\n                                    </div>\r\n                                    <div class=\"col-xs-12 text-right\" style=\"padding-right: 0;margin-top: 15px;\">\r\n                                        <img class='recycleLoading' src=\"img/loadingtext.gif\" data-ng-if=\"clearCtrl.save\" height=\"24\" width=\"24\" alt=\"\">\r\n                                        <div class=\"btn btn-primary\" ng-disabled=\"clearCtrl.loading\" ng-click=\"clearCtrl.edit = true\" ng-if=\"!clearCtrl.edit && !clearCtrl.save\" localize=\"更改\"></div>\r\n                                        <div class=\"btn btn-primary\" ng-disabled=\"!clearCtrl.hours || !clearCtrl.minutes || !clearCtrl.seconds\" ng-click=\"clearCtrl.saveClearTime()\" ng-if=\"clearCtrl.edit && !clearCtrl.save\" localize=\"保存\"></div>\r\n                                        <div class=\"btn btn-primary\" ng-click=\"clearCtrl.edit = false;clearCtrl.getClearTime()\" ng-if=\"clearCtrl.edit && !clearCtrl.save\" localize=\"取消\" style=\"margin-left: 10px;\"></div> \r\n                                    </div>\r\n                                </div>\r\n                                \r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <!-- widget div end -->\r\n            </div>\r\n        </article>\r\n    </div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n","views/vdi/system/snapshot.html":"<section >\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 left-btn-group\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs\" data-ng-click=\"add()\" href=\"javascript:\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-danger btn-xs isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\">\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"显示\"></span>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageSizeChange()\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-options=\"pagesize for pagesize in pagesizes\"\r\n\t\t\t\t\t\t\t\t\t></select>\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"项结果\"></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\" data-localize=\"名称\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"描述\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"resource_pool_nameSort = !resource_pool_nameSort;sort('resource_pool_name', resource_pool_nameSort)\" data-localize=\"资源池\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"dateSort\" ng-click=\"dateSort = !dateSort;sort('date', dateSort)\" data-localize=\"周期\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"activeSort\" ng-click=\"activeSort = !activeSort;sort('active', activeSort)\" data-localize=\"启用状态\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\" ><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.description }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.resource_pool_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td ng-if=\"item.period=='weekly'\"><span data-localize='每周{{ item.week_date }}'></span></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td ng-if=\"item.period=='monthly'\"><span data-localize='每月{{ item.month_date }}'></span></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"switch\" ng-if=\"!item.active_loadding\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"start_interval\" class=\"switch-checkbox\" id=\"start_interval{{$index}}\" ng-model=\"item.active\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"switch-label\" data-swchon-text=\"ON\" data-swchoff-text=\"OFF\" ng-click=\"active(item)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img ng-src=\"img/loadingtext.gif\" ng-if=\"item.active_loadding\" height=\"24\" width=\"24\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" ng-click=\"edit(item)\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" ng-click=\"view(item)\" data-localize-title=\"查看详情\"><i class=\"fa icon-jj-look\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a ng-click=\"edit(currentItem)\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a ng-click=\"view(currentItem)\" data-localize=\"查看详情\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-localize=\"删除\"></a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n\r\n<script>pageSetUp();</script>","views/vdi/system/through.html":"<section >\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 left-btn-group\">\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\">\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"显示\"></span>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageSizeChange()\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-options=\"pagesize for pagesize in pagesizes\"\r\n\t\t\t\t\t\t\t\t\t></select>\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"项结果\"></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"manufacturerSort\" ng-click=\"manufacturerSort = !manufacturerSort;sort('manufacturer', manufacturerSort)\" data-localize=\"设备名称\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"所属资源池/主机\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"桌面类型/透传桌面名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.manufacturer }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.resource_info }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><span localize=\"无\" ng-if=\"item.display_name == ''\"></span><span>{{ item.display_name }}</span></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" ng-if=\"item.display_name==''\" ng-click=\"through(item)\" data-localize-title=\"绑定桌面\"><i class=\"icon-041\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" ng-if=\"item.display_name!==''\" ng-click=\"editThrough(item)\" data-localize-title=\"编辑绑定桌面\"><i class=\"fa icon-jj-Write\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" ng-if=\"item.display_name!==''\" ng-click=\"cancelThrough(item)\" data-localize-title=\"取消绑定桌面\"><i class=\"fa icon-040\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li ng-if=\"currentItem.display_name==''\" class=\"menu_item\" ><a ng-click=\"through(currentItem)\" data-localize=\"绑定桌面\"></a></li>\r\n\t\t\t\t\t\t\t<li ng-if=\"currentItem.display_name!==''\" class=\"menu_item\" ><a ng-click=\"editThrough(currentItem)\" data-localize=\"编辑绑定桌面\"></a></li>\r\n\t\t\t\t\t\t\t<li ng-if=\"currentItem.display_name!==''\" class=\"menu_item\" ><a ng-click=\"cancelThrough(currentItem)\" data-localize=\"取消绑定桌面\"></a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n\r\n<script>pageSetUp();</script>","views/vdi/system/upgrade.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"类型\">类型</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"当前版本\">当前版本</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"升级包\">升级包</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"已升级组件数/组件总数\">已升级组件数/组件总数</th>\r\n\t\t\t\t\t\t\t\t\t\t<th localize=\"操作\">操作</th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr ng-repeat-start=\"arr in rows\"></tr>\r\n\t\t\t\t\t\t\t\t\t<tr ng-repeat=\"item in arr\">\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"nowrap\">{{ item.type }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.version }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.newer_version }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.new_client_count}}/{{ item.client_count }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td ng-show=\"$first\" rowspan=\"{{arr.length}}\" class=\"ver_middle\" width=\"340\" height=\"35\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"updata-btn-wraper\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default left margin-r-10\"  ng-click=\"upgrade(item)\" localize-title=\"立即升级\" data-ng-show=\"item.need_update && item.newer_version\"><i class=\"fa  icon-jj-update\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default left margin-r-10\" ng-click=\"viewDetail(item.owner)\" localize-title=\"查看未升级组件详情\" ng-show=\"(item.new_client_count < item.client_count) && (item.owner=='win_client' || item.owner=='lin_client' || item.owner=='arm_client' || item.owner=='android_client')\"><i class=\"fa icon-jj-look\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div ng-show=\"item.updatable\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t ui-web-upload=\"upgrade_bin_upload{{item._idx}}\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t ui-upload-config=\"uploadConfig\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t ui-upload-limit=\"10G\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t ui-upload-type=\"{{item.packtype}}\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t ui-upload-btn-name=\"上传系统包\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t template-url=\"views/vdi/common/ui-web-upload2.html\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t ui-upload-url=\"/thor/admin/upgrade/{{item.owner}}\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t finish-handel=\"finish()\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t></div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr ng-repeat-end></tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\"  localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t<!-- widget div end -->\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<style>\r\n\r\n#uploadISO-queue{\r\n\tfloat:left;\r\n\theight:32px;\r\n}\r\n</style>\r\n<script>pageSetUp();</script>","views/vdi/system/usb.html":"<section >\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 left-btn-group\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs\" data-dialog=\"addSystemUSBDialog\" data-dialog-size=\"md\" data-dialog-url=\"system/system_usb_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-danger btn-xs isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\">\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"显示\"></span>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageSizeChange()\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-options=\"pagesize for pagesize in pagesizes\"\r\n\t\t\t\t\t\t\t\t\t></select>\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"项结果\"></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <th ng-model=\"idSort\" ng-click=\"idSort = !idSort;sort('id', idSort)\" data-localize=\"id\"></th> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"class_idSort\" ng-click=\"class_idSort = !class_idSort;sortClass_id(class_idSort)\" data-localize=\"USB_GROUP\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"prioritySort\" ng-click=\"prioritySort = !prioritySort;sort('priority', prioritySort)\" data-localize=\"优先级\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"rule_nameSort\" ng-click=\"rule_nameSort = !rule_nameSort;sort('rule_name', rule_nameSort)\" data-localize=\"RULE_NAME\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"product_idSort\" ng-click=\"product_idSort = !product_idSort;sort('product_id', product_idSort)\" data-localize=\"PID\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"vendor_idSort\" ng-click=\"vendor_idSort = !vendor_idSort;sort('vendor_id', vendor_idSort)\" data-localize=\"VID\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"allowSort\" ng-click=\"allowSort = !allowSort;sort('allow', allowSort)\" data-localize=\"IS_REDIRECT\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\" ><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<!-- <td>{{ item.id }}</td> -->\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.class_id.value }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.priority }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.rule_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.product_id == -1? \"-1\": item.product_id.indexOf(\"0x\")>-1 ? item.product_id.substring(2): item.product_id}}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.vendor_id == -1? \"-1\": item.vendor_id.indexOf(\"0x\")>-1 ? item.vendor_id.substring(2): item.vendor_id }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td data-localize=\"{{ item.allow == true ? '是':'否' }}\"></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><a class=\"btn btn-xs btn-default\" data-dialog=\"editSystemUSBDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"system/system_usb_edit.html\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></a></td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a data-dialog=\"editSystemUSBDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"system/system_usb_edit.html\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-localize=\"删除\"></a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n\r\n<script>pageSetUp();</script>","views/vdi/template/hardware.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div class=\"jarviswidget\" data-widget-grid>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-sm-6\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs \" data-dialog=\"addHardwareTemplateDialog\" data-dialog-size=\"md\" data-dialog-url=\"template/template_hardware_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-danger btn-xs isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive noborderbottom\">\r\n\t\t\t\t\t\t\t<div class=\"padding-20\">\r\n\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t        <div class=\"col-xs-4 col-sm-3\" data-id=\"{{item.id}}\" data-ng-repeat=\"item in rows\">\r\n\t\t\t\t\t\t\t            <div class=\"panel pricing-big relative panel-primary\">\r\n\t\t\t\t\t\t\t                <div class=\"panel-heading smart-form mypanelhead hardwarepanelhead\">\r\n\t\t\t\t\t\t\t                \t<div class=\"checkbox row\">\r\n\t\t\t\t\t\t\t                \t\t<div class=\"col-md-2 col-sm-2 col-xs-2\">\r\n\t\t\t\t\t\t\t                \t\t\t<label class=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\" class=\"checkbox style-0\"><span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t                \t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h2 class=\"head-title col-md-10 col-sm-10 col-xs-10\" title=\"{{item.name}}\">{{item.name}}</h2>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t                    <div class=\"panel-cont panel-cont flex\">\r\n\t\t\t\t\t\t\t                    \t<img ng-src=\"img/hardware_model.png\" class=\"panel-picture\">\r\n\t\t\t\t\t\t\t\t                    <ul class=\"panel-mess mypanel-mess\">\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"CPU\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.cpu_num}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"内存\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.memory_mb/1024}}G</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"系统盘\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.system_gb}}G</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\" data-ng-if=\"item.local_gb>1\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"数据盘\"></label>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"item-flex\">{{item.local_gb}}G</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\" data-ng-if=\"item.local_gb1>1\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"数据盘\"></label>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"item-flex\">{{item.local_gb1}}G</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                  \t</ul>\r\n\t\t\t\t\t\t\t                  \t</div>\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t\t                <div class=\"panel-footbar primary hardware_panelfooter\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除模版\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\"></i></a>\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t\t        </div>\r\n\t\t\t\t\t    \t\t</div>\r\n\t\t\t\t\t    \t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n","views/vdi/template/personal.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-sm-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-xs-12\" style=\"padding-left: 8px;\">\r\n\t\t\t\t\t\t<span class=\"totalmess\"\r\n\t\t\t\t\t\t\tdata-localize=\"TEMPLATE_DESC\"\r\n\t\t                    data-localize-title=\"HELP\"\r\n\t\t                    param1=\"{{ (rows | filter:searchText).length }}\"\r\n\t\t                    param2=\"{{ (rows | filter:searchText | filter:{instance_status: 'running'}).length }}\"\r\n\t\t                    param3=\"{{ (rows | filter:searchText | filter:{instance_status: 'shutdown'}).length }}\">\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-dialog=\"addPersonalTemplateDialog\" data-dialog-size=\"md\" data-dialog-url=\"template/template_personal_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-dialog=\"registerPersonalTemplateDialog\" data-dialog-size=\"md\" data-dialog-url=\"template/template_teach_register.html\" href=\"javascript:\"><i class=\"icon-jj-zhuche fa\"></i> <span data-localize=\"注册\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"shutdown()\" href=\"javascript:\"><i class=\"icon-jj-shutdown fa\"></i> <span data-localize=\"关机\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n\t\t\t\t\t\t\t\t<select class=\"selectclassroomName filter\" ng-model=\"order\" data-ng-options=\"order.name for order in orders\" data-ng-change=\"sortTem(order.val)\"></select>\r\n\t\t\t\t\t\t\t\t<select class=\"selectclassroomName filter\" style=\"height: 22px;\" ng-model=\"select\">\r\n\t\t\t\t\t\t\t\t\t<option value=\"all\" data-localize=\"全部状态\"></option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"kvm\">kvm</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"hyper-v\">hyper-v</option>\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive noborderbottom\">\r\n\t\t\t\t\t\t\t<div class=\"padding-20\">\r\n\t\t\t\t\t\t\t\t<div class=\"row teach_myrow\">\r\n\t\t\t\t\t\t\t        <div class=\"col-xs-12 col-sm-6 col-md-6 col-lg-4\" data-id=\"{{item.id}}\" style=\"height: 289px;\" data-ng-repeat=\"item in rows | filter:searchText\">\r\n\t\t\t\t\t\t\t            <div class=\"panel pricing-big relative\" data-ng-class=\"{'panel-darken':item.status!='alive','panel-primary':item.status=='alive'}\">\r\n\t\t\t\t\t\t\t                <div class=\"panel-heading smart-form mypanelhead\">\r\n\t\t\t\t\t\t\t                \t<div class=\"checkbox row\">\r\n\t\t\t\t\t\t\t                \t\t<div class=\"col-md-1 col-sm-1 col-xs-1\">\r\n\t\t\t\t\t\t\t                \t\t\t<label class=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\" class=\"checkbox style-0\"><span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t                \t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h2 class=\"head-title col-md-11 col-sm-11 col-xs-11\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span title=\"{{item.image_id}}\">{{item.name}}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div title=\"{{ item.description }}\" class=\"desc\">{{ item.description }}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t                    <div class=\"template panel-cont flex\">\r\n\t\t\t\t\t\t\t                    \t<div class=\"panel-pic\" style=\"position: relative;bottom: 10px;\">\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"mynote\">\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='update failed'\" data-localize=\"TEMPLATE_UPDATE_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='updating'\" data-localize=\"TEMPLATE_UPDATING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='cloning'\" data-localize=\"TEMPLATE_CLONING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='sync failed'\" data-localize=\"TEMPLATE_SYNC_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='uploading'\" data-localize=\"UPLOADING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='register failed'\" data-localize=\"REGISTER_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='cloning failed'\" data-localize=\"CLONING_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='reset failed'\" data-localize=\"RESET_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='error'\" data-localize=\"CREATE_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='making'\" data-localize=\"MAKING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='saving'\" data-localize=\"SAVING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='saveAs'\" data-localize=\"SAVING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='installed'\" data-localize=\"INSTALLED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='syncing'\" data-localize=\"SYNCING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='building'\" data-localize=\"BUILDING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='registering'\" data-localize=\"REGESTER\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='rebuilding'\" data-localize=\"REBUILDING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"pic-wrap\">\r\n\t\t\t\t\t\t\t                    \t\t\t<img ng-src=\"img/ajax-loader.gif\" data-ng-if=\"item.status =='making' || item.status =='syncing'\">\r\n\t\t\t\t\t\t\t                    \t\t\t<img ng-src=\"img/{{ item.icon || 'win7.png' }}\" data-ng-if=\"item.status !== 'making' && item.status !== 'syncing'\">\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div data-ng-if=\"item.status!='making' && item.status !='syncing'\">\r\n\t\t\t\t\t\t\t                    \t\t\t<p class=\"pic-version\">{{item.os_type}}</p>\r\n\t\t\t\t\t\t\t                    \t\t\t<p class=\"memsize\">{{item.is_64==true? 64:32}}Bit</p>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"panel-status\" >\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='running'\" localize-title=\"开机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='shutdown'\" localize-title=\"关机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='paused'\" localize-title=\"挂起状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='migrating'\" localize-title=\"迁移状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='building'\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='nostate'\" localize-title=\"未知状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='error' ||item.instance_status=='crashed'\" localize-title=\"错误状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='reboot'\" localize-title=\"重启中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='updating'\" localize-title=\"更新中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t</div>\r\n\t\t\t\t\t\t\t                    \t</div>\r\n\t\t\t\t\t\t\t\t                    <ul class=\"panel-mess\">\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"系统盘\" data-localize-title=\"系统盘\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.updateSize?item.updateSize:item.system_size_desc}}G/{{item.system_size_total}}G <span class=\"template\"></span></div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"数据盘\" data-localize-title=\"数据盘\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.data_size_desc}}G/{{item.data_size_total}}G <span class=\"template\"></span></div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"关联桌面数\" data-localize-title=\"关联桌面数\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.instance_count}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"创建者\" data-localize-title=\"创建者\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.owner_desc}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"创建时间\" data-localize-title=\"创建时间\"></label>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"item-flex\">{{item.created_at | date:'yyyy-MM-dd HH:mm:ss'}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                  \t</ul>\r\n\t\t\t\t\t\t\t                  \t</div>\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t\t                <div class=\"panel-footbar\" data-ng-class=\"{'darken':item.status!='alive','primary':item.status=='alive'}\">\r\n\t\t                                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-instance-id=\"{{ item.instance_id}}\" data-ng-if=\"item.virtual_type=='kvm' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('templateModify.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name') +'&personal');return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t                                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-instance-id=\"{{ item.instance_id}}\" data-ng-if=\"item.virtual_type=='hyper-v' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('templateModify_rdp.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name') +'&personal');return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t\t\t\t\t                \t\t<a href=\"javascript:void(0)\" data-ng-if=\"item.status=='alive'\" class=\"icon\" data-localize-title=\"COPY_TEM\" data-ng-click=\"copy(item)\"><i class=\"fa icon-jj-copy\"></i></a>\r\n\t\t\t\t\t\t                \t\t<a href=\"javascript:void(0)\" data-ng-if=\"item.status=='alive'\" class=\"icon\" data-localize-title=\"下载模版\" download-url urls=\"{{item.download_image_uuid}}\"><i class=\"fa icon-jj-Download\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <span class=\"mylili\"><a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除模版\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\" data-ng-class=\"{disabled_ico:item.instance_count > 0? true:false}\"></i></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 0? true:false\" data-localize-title=\"TEMPLATE_DELETE_TIP\"></span></span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除模版\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"more_list_container\">\r\n\t\t                \t                \t\t<a href=\"javascript:\" class=\"icon more_icon\" data-localize-title=\"MORE\"><i class=\"fa icon-jj-more\"></i></a>\r\n\t\t                \t                \t\t<div class=\"menu_wrapper my_menu_wrapper\">\r\n\t\t                \t                \t\t\t<div class=\"arraw\"></div>\r\n\t\t                \t                \t\t\t<ul class=\"menu_item_list\">\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" ng-class=\"{disabled:item.instance_status!=='shutdown'}\" data-ng-if=\"item.status=='alive'\"><a class=\"menu_label\" data-ng-click=\"modify(item)\" ng-disabled=\"item.instance_status!=='shutdown'\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-009\"></span> <span data-localize=\"配置属性\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" data-ng-if=\"item.status=='alive' && !item.rbd_enabled\"><a class=\"menu_label\" data-ng-click=\"imgManage(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-Template\"></span> <span data-localize=\"镜像管理\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" data-ng-if=\"item.status=='alive'\"><a class=\"menu_label\" data-ng-click=\"resetTemp(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-Recovery\"></span> <span data-localize=\"重置模板\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" data-ng-if=\"item.status=='alive'\"><a class=\"menu_label\" data-ng-click=\"detail(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-013\"></span> <span data-localize=\"模板详情\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-click=\"delete(item)\" href=\"javascript:void(0)\"><span class=\"fa fa-trash-o\"></span> <span data-localize=\"删除模版\" style=\"padding-left: 3px\"></span></a></li>\r\n\t\t                \t                \t\t\t</ul>\r\n\t\t                \t                \t\t</div>\r\n\t\t                \t                \t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a class=\"icon\" data-ng-if=\"item.status =='update failed'\" data-id=\"{{ item.id }}\" onclick=\"window.open('templateModify.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type'));return false;\" href=\"javascript:\" data-localize-title=\"查看详情\"><i class=\"fa icon-jj-look\"></i></a> -->\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t\t        </div>\r\n\t\t\t\t\t    \t\t</div>\r\n\t\t\t\t\t    \t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n","views/vdi/template/teach.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-sm-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-xs-12\" style=\"padding-left: 8px;\">\r\n\t\t\t\t\t\t<span class=\"totalmess\"\r\n\t\t\t\t\t\t\tdata-localize=\"TEMPLATE_DESC\"\r\n\t\t                    data-localize-title=\"HELP\"\r\n\t\t                    param1=\"{{ (rows | filter:searchText).length }}\"\r\n\t\t                    param2=\"{{ (rows | filter:searchText | filter:{instance_status: 'running'}).length }}\"\r\n\t\t                    param3=\"{{ (rows | filter:searchText | filter:{instance_status: 'shutdown'}).length }}\">\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-dialog=\"addTeachTemplateDialog\" data-dialog-size=\"md\" data-dialog-url=\"template/template_teach_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-dialog=\"registerTeachTemplateDialog\" data-dialog-size=\"md\" data-dialog-url=\"template/template_teach_register.html\" href=\"javascript:\"><i class=\"icon-jj-zhuche fa\"></i> <span data-localize=\"注册\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"shutdown()\" href=\"javascript:\"><i class=\"icon-jj-shutdown fa\"></i> <span data-localize=\"关机\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n\t\t\t\t\t\t\t\t<select class=\"selectclassroomName filter\" ng-model=\"order\" data-ng-options=\"order.name for order in orders\" data-ng-change=\"sortTem(order.val)\"></select>\r\n\t\t\t\t\t\t\t\t<select class=\"selectclassroomName filter\" style=\"height: 22px;\" ng-model=\"select\">\r\n\t\t\t\t\t\t\t\t\t<option value=\"all\" data-localize=\"全部状态\"></option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"kvm\">kvm</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"hyper-v\">hyper-v</option>\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive noborderbottom\">\r\n\t\t\t\t\t\t\t<div class=\"padding-20\">\r\n\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t        <div class=\"col-xs-12 col-sm-6 col-md-6 col-lg-4\" data-id=\"{{item.id}}\" style=\"height: 289px;\" data-ng-repeat=\"item in rows | filter:searchText\">\r\n\t\t\t\t\t\t\t            <div class=\"panel pricing-big relative\" data-ng-class=\"{'panel-darken':item.status!='alive','panel-primary':item.status=='alive'}\">\r\n\t\t\t\t\t\t\t                <div class=\"panel-heading smart-form mypanelhead\">\r\n\t\t\t\t\t\t\t                \t<div class=\"checkbox row\">\r\n\t\t\t\t\t\t\t                \t\t<div class=\"col-md-1 col-sm-1 col-xs-1\">\r\n\t\t\t\t\t\t\t                \t\t\t<label class=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\" class=\"checkbox style-0\"><span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t                \t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h2 class=\"head-title col-md-11 col-sm-11 col-xs-11\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span title=\"{{item.image_id}}\">{{item.name}}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div title=\"{{ item.description }}\" class=\"desc\">{{ item.description }}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t                    <div class=\"template panel-cont flex\">\r\n\t\t\t\t\t\t\t                    \t<div class=\"panel-pic\" style=\"position: relative;bottom: 10px;\">\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"mynote\">\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='update failed'\" data-localize=\"TEMPLATE_UPDATE_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='updating'\" data-localize=\"TEMPLATE_UPDATING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='cloning'\" data-localize=\"TEMPLATE_CLONING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='sync failed'\" data-localize=\"TEMPLATE_SYNC_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='uploading'\" data-localize=\"UPLOADING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='register failed'\" data-localize=\"REGISTER_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='cloning failed'\" data-localize=\"CLONING_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='reset failed'\" data-localize=\"RESET_FAILED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='error'\" data-localize=\"CREATE_FAILED\"></span>\r\n\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='making'\" data-localize=\"MAKING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='saving'\" data-localize=\"SAVING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='saveAs'\" data-localize=\"SAVING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='installed'\" data-localize=\"INSTALLED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='syncing'\" data-localize=\"SYNCING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='building'\" data-localize=\"BUILDING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='making seed'\" data-localize=\"MAKING_SEED\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='registering'\" data-localize=\"REGESTER\"></span>\r\n\t\t\t\t\t\t\t                    \t\t\t<span data-ng-if=\"item.status=='rebuilding'\" data-localize=\"REBUILDING\"></span>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"pic-wrap\">\r\n\t\t\t\t\t\t\t                    \t\t\t<img ng-src=\"img/ajax-loader.gif\" data-ng-if=\"item.status =='making' || item.status =='syncing' || item.status == 'making seed'\">\r\n\t\t\t\t\t\t\t                    \t\t\t<img ng-src=\"img/{{ item.icon || 'win7.png' }}\" data-ng-if=\"item.status !== 'making' && item.status !== 'syncing' && item.status != 'making seed'\">\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div data-ng-if=\"item.status!='making' && item.status !='syncing' && item.status!='making seed'\">\r\n\t\t\t\t\t\t\t                    \t\t\t<p class=\"pic-version\">{{item.os_type}}</p>\r\n\t\t\t\t\t\t\t                    \t\t\t<p class=\"memsize\">{{item.is_64==true? 64:32}}Bit</p>\r\n\t\t\t\t\t\t\t                    \t\t</div>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"panel-status\" >\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='running'\" localize-title=\"开机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='shutdown'\" localize-title=\"关机状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='paused'\" localize-title=\"挂起状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='migrating'\" localize-title=\"迁移状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='building'\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='nostate'\" localize-title=\"未知状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='error' ||item.instance_status=='crashed'\" localize-title=\"错误状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='reboot'\" localize-title=\"重启中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t\t<span ng-if=\"item.instance_status=='updating'\" localize-title=\"更新中状态\" class=\"status50\" ng-class=\"item.instance_status\"></span>\r\n\t\t\t\t\t\t\t\t                    \t</div>\r\n\t\t\t\t\t\t\t                    \t</div>\r\n\t\t\t\t\t\t\t\t                    <ul class=\"panel-mess\">\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"系统盘\" data-localize-title=\"系统盘\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.updateSize?item.updateSize:item.system_size_desc}}G/{{item.system_size_total}}G <span class=\"template\"></span></div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"数据盘\" data-localize-title=\"数据盘\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.data_size_desc}}G/{{item.data_size_total}}G <span class=\"template\"></span></div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"关联桌面数\" data-localize-title=\"关联桌面数\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.instance_count}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"创建者\" data-localize-title=\"创建者\"></label>\r\n\t\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.owner_desc}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t\t                    \t\t<label data-localize=\"创建时间\" data-localize-title=\"创建时间\"></label>\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"item-flex\">{{item.created_at | date:'yyyy-MM-dd HH:mm:ss'}}</div>\r\n\t\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t                  \t</ul>\r\n\t\t\t\t\t\t\t                  \t</div>\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t\t                <div class=\"panel-footbar\" data-ng-class=\"{'darken':item.status!='alive','primary':item.status=='alive'}\" data-ng-if=\"sync_mode == 'bt'\">\r\n\t\t\t\t\t\t\t                \t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-ng-if=\"item.virtual_type=='kvm' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('templateModifybt.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!--html5 spice\t\t\t\t\t                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-instance-id=\"{{ item.instance_id}}\" data-ng-if=\"item.virtual_type=='kvm' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('js/vdi-spice/spiceModifybt.html#?id=' + this.getAttribute('data-id') + '&os_type=' + this.getAttribute('data-os-type') + '&name=' + this.getAttribute('data-name')+'&instance_id='+this.getAttribute('data-instance-id'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a> -->\r\n\t\t\t\t\t\t                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-ng-if=\"item.virtual_type=='hyper-v' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('templateModifybt_rdp.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!--html5 spice\t\t\t\t                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-instance-id=\"{{ item.instance_id}}\" data-ng-if=\"item.virtual_type=='hyper-v' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('js/vdi-spice/spiceModifybt_rdp.html#?id=' + this.getAttribute('data-id') + '&os_type=' + this.getAttribute('data-os-type') + '&name=' + this.getAttribute('data-name')+'&instance_id='+this.getAttribute('data-instance-id'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:\" class=\"icon\" data-ng-if=\"item.status=='alive' || item.status=='sync failed'\" data-localize-title=\"SYNC_TEM\" data-ng-click=\"sync(item)\"><i class=\"fa icon-jj-send\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a data-ng-if=\"item.sync_status.length\" href=\"javascript:\"  class=\"icon\" data-localize-title=\"模板分布\" data-ng-click=\"syncTem(item)\"><i data-ng-if=\"item.syncFaild\" class=\"fa icon-jj-back\"></i><i data-ng-if=\"!(item.syncFaild || item.syncing)\" class=\"fa icon-jj-look\"></i><i data-ng-if=\"item.syncing\" class=\"fa icon-jj-more\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a data-ng-if=\"item.sync_status.length\" href=\"javascript:\"  class=\"icon\" data-localize-title=\"模板分布\" data-ng-click=\"syncTem(item)\"><i data-ng-class=\"{'failed': item.sync_status.syncFaild, 'normal': !(item.sync_status.syncFaild || item.sync_status.syncing), 'syncing': item.sync_status.syncing}\" class=\"fa icon-jj-look syncTemIco\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a data-ng-if=\"item.sync_status.length\" href=\"javascript:\"  class=\"icon\" data-localize-title=\"模板分布\" data-ng-click=\"syncTem(item)\"><i class=\"fa icon-jj-look\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"icon\" data-ng-click=\"copy(item)\" data-ng-if=\"item.status=='alive'\"><i class=\"fa icon-jj-copy\" data-localize-title=\"COPY_TEM\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"more_list_container\" data-ng-if=\"item.status=='alive'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:\" class=\"icon more_icon\" data-localize-title=\"MORE\"><i class=\"fa icon-jj-more\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"menu_wrapper my_menu_wrapper\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"arraw\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ><a class=\"menu_label\" target=\"_blank\" href=\"{{ domain }}/thor/image/download/{{ item.id }}\"><span class=\"fa icon-jj-Download\"></span> <span data-localize=\"下载模版\"></span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ><a href=\"javascript:\" class=\"menu_label\" data-ng-if=\"item.status=='alive'\" data-localize-title=\"UNDO_SYNC_TEM\" data-ng-click=\"undoSync(item)\"><span class=\"fa icon-jj-back\"></span><span data-localize=\"UNDO_SYNC_TEM\"></span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- <li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{graydisabled:item.instance_count > 1? false:true}\" data-ng-click=\"update(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-update\"></span> <span data-localize=\"更新桌面\"></span></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 1? false:true\" data-localize-title=\"该模版未关联任何场景\"></span></li> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- <li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{graydisabled:item.instance_count > 0? true:false}\" data-ng-click=\"delete(item)\" href=\"javascript:void(0)\"><span class=\"fa fa-trash-o\"></span> <span data-localize=\"删除模版\"></span></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 0? true:false\" data-localize-title=\"TEMPLATE_DELETE_TIP\"></span></li> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-click=\"update(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-update\"></span> <span data-localize=\"更新桌面\"></span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-click=\"delete(item)\" href=\"javascript:void(0)\"><span class=\"fa fa-trash-o\"></span> <span data-localize=\"删除模版\"></span></a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a href=\"javascript:\" class=\"icon\" data-ng-show=\"item.status=='syncing' || item.status=='sync failed' || item.status=='making seed'\" data-localize-title=\"查看同步信息\" data-dialog=\"syncTemplateDialog\" data-dialog-size=\"md\" data-dialog-url=\"template/template_sync.html\" data-ng-click=\"syncTem(item)\"><i class=\"fa icon-jj-look\"></i></a> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- <span class=\"mylili\" data-ng-if=\"item.status!=='alive'\"><a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除模版\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\" data-ng-class=\"{disabled_ico:item.instance_count > 0? true:false}\"></i></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 0? true:false\" data-localize-title=\"TEMPLATE_DELETE_TIP\"></span></span> -->\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a data-ng-if=\"item.status!=='alive'\" href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除模版\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\"></i></a>\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t                \t                <div class=\"panel-footbar\" data-ng-class=\"{'darken':item.status!='alive','primary':item.status=='alive'}\" data-ng-if=\"sync_mode == 'scp'\">\r\n\t\t                \t                \t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-ng-if=\"item.virtual_type=='kvm' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('templateModify.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t                                \t\t<!-- html5-spice <a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-instance-id=\"{{ item.instance_id}}\" data-ng-if=\"item.virtual_type=='kvm' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('js/vdi-spice/spiceModify.html#?id=' + this.getAttribute('data-id') + '&os_type=' + this.getAttribute('data-os-type') + '&name=' + this.getAttribute('data-name')+'&instance_id='+this.getAttribute('data-instance-id'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a> -->\r\n\t\t                                \t\t<a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-ng-if=\"item.virtual_type=='hyper-v' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('templateModify_rdp.html#' + this.getAttribute('data-id') + '&' + this.getAttribute('data-os-type') + '&' + this.getAttribute('data-name'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t                                \t\t<!-- html5 spice <a data-id=\"{{ item.id }}\" data-name=\"{{ item.name }}\" data-os-type=\"{{ item.os_type }}\" data-instance-id=\"{{ item.instance_id}}\" data-ng-if=\"item.virtual_type=='hyper-v' && (item.status=='alive' || item.status =='making' || item.status =='installed' || item.status =='update failed')\" onclick=\"window.open('js/vdi-spice/spiceModify_rdp.html#?id=' + this.getAttribute('data-id') + '&os_type=' + this.getAttribute('data-os-type') + '&name=' + this.getAttribute('data-name')+'&instance_id='+this.getAttribute('data-instance-id'));return false;\" href=\"javascript:\" class=\"icon\" data-localize-title=\"编辑模板\"><i class=\"fa icon-jj-edit\"></i></a> -->\r\n\t\t                                \t\t<!-- <a href=\"javascript:\" class=\"icon\" data-localize-title=\"模板分布\" data-ng-click=\"syncTem(item)\"><i class=\"fa icon-jj-look\"></i></a> -->\r\n\t\t                                \t\t<a href=\"javascript:void(0)\" data-ng-if=\"item.status=='alive'\" class=\"icon\" data-localize-title=\"COPY_TEM\" data-ng-click=\"copy(item)\"><i class=\"fa icon-jj-copy\"></i></a>\r\n\t\t                \t                \t<a href=\"javascript:void(0)\" data-ng-if=\"item.status=='alive'\" class=\"icon\" data-localize-title=\"下载模版\" download-url urls=\"{{item.download_image_uuid}}\"><i class=\"fa icon-jj-Download\"></i></a>\r\n<!-- \t\t                \t                \t<div class=\"more_list_container\" data-ng-if=\"item.status=='alive'\">\r\n\t\t                \t                \t\t<a href=\"javascript:\" class=\"icon more_icon\" data-localize-title=\"MORE\"><i class=\"fa icon-jj-more\"></i></a>\r\n\t\t                \t                \t\t<div class=\"menu_wrapper my_menu_wrapper\">\r\n\t\t                \t                \t\t\t<div class=\"arraw\"></div>\r\n\t\t                \t                \t\t\t<ul class=\"menu_item_list\">\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" ><a class=\"menu_label\" target=\"_blank\" href=\"{{ domain }}/thor/image/download/{{ item.id }}\"><span class=\"fa icon-jj-Download\"></span> <span data-localize=\"下载模版\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{graydisabled:item.instance_count > 1? false:true}\" data-ng-click=\"update(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-update\"></span> <span data-localize=\"更新桌面\"></span></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 1? false:true\" data-localize-title=\"该模版未关联任何场景\"></span></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{graydisabled:item.instance_count > 0? true:false}\" data-ng-click=\"delete(item)\" href=\"javascript:void(0)\"><span class=\"fa fa-trash-o\"></span> <span data-localize=\"删除模版\"></span></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 0? true:false\" data-localize-title=\"TEMPLATE_DELETE_TIP\"></span></li>\r\n\t\t                \t                \t\t\t</ul>\r\n\t\t                \t                \t\t</div>\r\n\t\t                \t                \t</div> -->\r\n\t\t                \t                \t<!-- <span class=\"mylili\"><a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除模版\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\" data-ng-class=\"{disabled_ico:item.instance_count > 0? true:false}\"></i></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 0? true:false\" data-localize-title=\"TEMPLATE_DELETE_TIP\"></span></span> -->\r\n\t\t                \t                \t<!-- <a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除模版\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\"></i></a> -->\r\n\t\t                \t                \t<div class=\"more_list_container\">\r\n\t\t                \t                \t\t<a href=\"javascript:\" class=\"icon more_icon\" data-localize-title=\"MORE\"><i class=\"fa icon-jj-more\"></i></a>\r\n\t\t                \t                \t\t<div class=\"menu_wrapper my_menu_wrapper\">\r\n\t\t                \t                \t\t\t<div class=\"arraw\"></div>\r\n\t\t                \t                \t\t\t<ul class=\"menu_item_list\">\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" ng-class=\"{disabled:item.instance_status!=='shutdown'}\" data-ng-if=\"item.status=='alive'\"><a class=\"menu_label\" ng-disabled=\"item.instance_status!=='shutdown'\" data-ng-click=\"modify(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-009\"></span> <span data-localize=\"配置属性\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" data-ng-if=\"item.status=='alive' && !item.rbd_enabled\"><a class=\"menu_label\" data-ng-click=\"imgManage(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-Template\"></span> <span data-localize=\"镜像管理\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" data-ng-if=\"item.status=='alive'\"><a class=\"menu_label\" data-ng-click=\"resetTemp(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-Recovery\"></span> <span data-localize=\"重置模板\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\" data-ng-if=\"item.status=='alive'\"><a class=\"menu_label\" data-ng-click=\"detail(item)\" href=\"javascript:void(0)\"><span class=\"fa icon-jj-013\"></span> <span data-localize=\"模板详情\"></span></a></li>\r\n\t\t                \t                \t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-click=\"delete(item)\" href=\"javascript:void(0)\"><span class=\"fa fa-trash-o\"></span> <span data-localize=\"删除模版\" style=\"padding-left: 3px\"></span></a></li>\r\n\t\t                \t                \t\t\t</ul>\r\n\t\t                \t                \t\t</div>\r\n\t\t                \t                \t</div>\r\n\t\t                \t                </div>\r\n\t\t\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t\t        </div>\r\n\t\t\t\t\t    \t\t</div>\r\n\t\t\t\t\t    \t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/terminal/client.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-xs-12\" style=\"padding-left: 8px;\">\r\n\t\t\t\t\t\t<span data-localize=\"选择教室\"></span>&nbsp;&nbsp;<select class=\"selectclassroomName filter\" ng-model=\"select\" data-ng-options=\"item.name for item in classrooms\"></select>&nbsp;&nbsp;&nbsp;&nbsp;\r\n\t\t\t\t\t\t<span class=\"totalmess\"\r\n\t\t\t\t\t\t\tdata-localize=\"CLIENT_DESC\"\r\n\t\t                    data-localize-title=\"HELP\"\r\n\t\t                    param1=\"{{(rows | filter:searchText | filter:select.name).length}}\"\r\n\t\t                    param2=\"{{(rows | filter:searchText | filter:select.name | filter:{is_up:true}).length}}\"\r\n\t\t                    param3=\"{{(rows | filter:searchText | filter:select.name | filter:{is_up:false}).length}}\">\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\">\r\n\t\t\t\t\t\t<!-- This area used as dropdown edit box -->\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget edit box -->\r\n\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar makefloat\">\r\n\t\t\t\t\t\t\t<div class=\"left_side left-btn-group\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-dialog=\"configureClassroomDialog\" data-dialog-size=\"sm\" data-dialog-url=\"terminal/terminal_configureclassroom_edit.html\"><i class=\"fa icon-jj-classroom\"></i> <span data-localize=\"分配教室\"></span></a>\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t<button data-ng-class=\"{disabled:!checkOne()}\" class=\"btn btn-primary btn-xs dropdown-toggle isBatch\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-all\"></i> <span data-localize=\"排序\"></span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t<li style=\"cursor:pointer\"><a class=\"btn isBatch\" data-ng-click=\"clientManualSort()\" data-localize=\"人工排序\" data-dialog=\"clientSortDialog\" data-dialog-size=\"fs\" data-dialog-url=\"terminal/clientSort.html\" data-ng-class=\"{disabled:!checkOne()}\"><span class=\"parameterdisabled\" data-localize-title=\"vdiTerminalClientManage_TIP5\" data-ng-if=\"!checkOne()\"></span></a></li>\r\n                                        <li class=\"divider\"></li>\r\n                                        <li style=\"cursor:pointer; position:relative;\"><a class=\"btn isBatch\" data-ng-click=\"clientAutoSort()\" data-localize=\"自动排序\" data-dialog=\"clientSortDialog\" data-dialog-size=\"fs\" data-dialog-url=\"terminal/clientSort.html\" data-ng-class=\"{disabled:!checkOne()}\" ></a><span class=\"parameterdisabled\" data-localize-title=\"vdiTerminalClientManage_TIP5\" data-ng-if=\"!checkOne()\"></span></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t<button data-ng-class=\"{disabled:!checkOne()}\" class=\"btn btn-primary btn-xs dropdown-toggle isBatch\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-005\"></i> <span data-localize=\"设置终端\"></span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n                                        <li style=\"cursor:pointer; position:relative;\"><a class=\"btn isBatch\" data-ng-click=\"configurename()\" data-localize-title=\"vdiTerminalClientManage_TIP4\" data-ng-class=\"{disabled:!selectUp()}\" data-localize=\"修改终端名\"></a><span class=\"parameterdisabled\" data-localize-title=\"vdiTerminalClientManage_TIP3\" data-ng-if=\"!selectUp()\"></span></li>\r\n                                        <li class=\"divider\"></li>\r\n                                        <li style=\"cursor:pointer; position:relative;\"><a class=\"btn isBatch\" data-ng-click=\"configure()\" data-localize-title=\"vdiTerminalClientManage_TIP2\" data-ng-class=\"{disabled:!selectUp()}\" data-localize=\"设置运行参数\" data-dialog=\"configureTerminalParameterDialog\" data-dialog-size=\"md\" data-dialog-url=\"terminal/terminal_calculateconfigureparameter_edit.html\"></a><span class=\"parameterdisabled\" data-localize-title=\"vdiTerminalClientManage_TIP1\" data-ng-if=\"!selectUp()\"></span></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t<button data-ng-class=\"{disabled:!checkOne()}\" class=\"btn btn-primary btn-xs dropdown-toggle isBatch\" data-toggle=\"dropdown\"><i class=\"fa icon-jj-IP\"></i> <span data-localize=\"设置桌面IP\"></span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n                                        <li style=\"cursor:pointer\"><a class=\"btn isBatch\" data-localize=\"固定桌面IP\" data-dialog=\"clientBindingIpDialog\" data-dialog-size=\"sm\" data-dialog-url=\"terminal/terminal_clientbindingip_edit.html\"></a></li>\r\n                                        <li class=\"divider\"></li>\r\n                                        <li style=\"cursor:pointer\"><a class=\"btn isBatch\" data-ng-click=\"cancelBindingIp()\" data-localize=\"取消桌面IP\"></a></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-dialog=\"clientBindingIpDialog\" data-dialog-size=\"sm\" data-dialog-url=\"terminal/terminal_clientbindingip_edit.html\"><i class=\"fa icon-jj-IP\"></i> <span data-localize=\"固定桌面IP\"></span></a> -->\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"wakeup()\" href=\"javascript:\"><i class=\"fa icon-jj-boot\"></i> <span data-localize=\"唤醒\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"closeTerminal()\" data-ng-class=\"{graydisabled:ables}\"><i class=\"fa icon-jj-shutdown\"></i> <span data-localize=\"关机\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"rebootTerminal()\" data-ng-class=\"{graydisabled:ables}\"><i class=\"fa icon-jj-Restart\"></i> <span data-localize=\"重启\"></span></a>\r\n\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"terminate()\" href=\"javascript:\" data-ng-class=\"{graydisabled:ables}\"><i class=\"fa icon-jj-breakoff\"></i> <span data-localize=\"中断会话\"></span></a> -->\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" href=\"javascript:\" data-ng-click=\"delete()\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t<!-- <a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" href=\"javascript:\" data-ng-click=\"editPass()\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"终端密码\"></span></a> -->\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-click=\"dynamicPass()\"><i class=\"icon-jj-Key fa\"></i> <span data-localize=\"动态密码\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" style=\"width: 54px;\" type=\"number\" class=\"mysmallinput\" input-number data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updateData(searchText,select)\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-vertical-center table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"client_nameSort\" ng-click=\"client_nameSort = !client_nameSort;sort('client_name', client_nameSort)\" data-localize=\"终端名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"client_typeSort\" ng-click=\"client_typeSort = !client_typeSort;sortClientType(client_typeSort)\" data-localize=\"类型\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"orderSort\" ng-click=\"orderSort = !orderSort;sort('order', orderSort)\" data-localize=\"登录序号\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"终端IP/MAC\" ng-model=\"client_IPSort\" ng-click=\"client_IPSort = !client_IPSort;sortClientIP(client_IPSort)\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"固定桌面IP\" ng-model=\"target_IPSort\" ng-click=\"target_IPSort = !target_IPSort;sortTargetIP(target_IPSort)\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"is_upSort\" ng-click=\"is_upSort = !is_upSort;sort('is_up', is_upSort)\" data-localize=\"运行状态\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"inst_display_nameSort\" ng-click=\"inst_display_nameSort = !inst_display_nameSort;instNameSort('inst_display_name', inst_display_nameSort)\" data-localize=\"接入桌面\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"launched_atSort\" ng-click=\"launched_atSort = !launched_atSort;sort('launched_at', launched_atSort)\" data-localize=\"接入时间\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"running_timeSort\" ng-click=\"running_timeSort = !running_timeSort;sort('running_time', running_timeSort)\" data-localize=\"接入时长\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-id=\"{{item.id}}\"\r\n\t\t\t\t\t\t\t\t\t\tdata-contextmenu\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"item\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"checkbox-inline\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"item._selected\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata-ng-checked=\"item._selected\"  \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata-ng-value=\"item.id\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata-ng-click=\"addselect(item)\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<i></i>\r\n\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.client_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<span data-ng-if=\"item.client_type === 97\">android</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span data-ng-if=\"item.client_type === 98\">arm</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span data-ng-if=\"item.client_type === 99\">linux</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span data-ng-if=\"item.client_type === 1 || item.client_type === 999\">windows</span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.order }}<!-- <i data-ng-if=\"item.order_status == 2 && item.order != null\" class=\"fa icon-jj-lock\"> --></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.client_ip }}<br>{{ item.client_mac }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.target_ip }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td><span class=\"status32\" data-ng-class=\"{shutdown:!item.is_up,running:item.is_up}\"></span></td>\r\n\t\t\t\t\t\t\t\t\t\t<td title=\"{{ item.inst_name }}\" ng-if=\"!item.mode_id&&!item.person_pool_id\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a ng-show='item.can_jump_person' href=\"#/desktop/personal?name={{item.inst_display_name}}\">{{ item.inst_display_name }}</a>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show='!item.can_jump_person'>{{ item.inst_display_name }}</span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td title=\"{{ item.inst_name }}\" ng-if=\"item.mode_id&&!item.person_pool_id\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a ng-show='item.can_jump_teach' href=\"#/desktop/teach/{{ item.mode_id }}?name={{item.inst_display_name}}\">{{ item.inst_display_name }}</a>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show='!item.can_jump_teach'>{{ item.inst_display_name }}</span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td title=\"{{ item.inst_name }}\" ng-if=\"item.person_pool_id\">\r\n\t\t\t\t\t\t\t\t\t\t\t<a ng-show='item.can_jump_person_pool' href=\"#/desktop/poolList/{{item.person_pool_id}}?{{item.inst_display_name}}&&client={{item.person_pool_name}}\">{{ item.inst_display_name }}</a>\r\n\t\t\t\t\t\t\t\t\t\t\t<span ng-show='!item.can_jump_person_pool'>{{ item.inst_display_name }}</span>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.launched_at | date:'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.running_time }}</td>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-localize=\"分配教室\" data-dialog=\"configureClassroomDialog\" data-dialog-size=\"sm\" data-dialog-url=\"terminal/terminal_configureclassroom_edit.html\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{disabled:currentItem.status}\" href=\"javascript:\"><span data-localize=\"设置终端\"></span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{graydisabled:!currentItem.is_up}\" data-localize=\"修改终端名\" data-ng-click=\"configurename(currentItem)\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP1\" data-ng-if=\"!currentItem.is_up\"></span></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{graydisabled:!currentItem.is_up}\" data-ng-click=\"setSingle(true)\" data-dialog=\"configureTerminalParameterDialog\" data-dialog-size=\"md\" data-dialog-url=\"terminal/terminal_calculateconfigureparameter_edit.html\" data-localize=\"设置运行参数\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP2\" data-ng-if=\"!currentItem.is_up\"></span></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\"><span data-localize=\"设置桌面IP\"></span><i></i></a>\r\n\t\t\t\t\t\t\t\t<div class=\"menu_wrapper sub_menu\">\r\n\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-localize=\"固定桌面IP\" data-dialog=\"clientBindingIpDialog\" data-dialog-size=\"sm\" data-dialog-url=\"terminal/terminal_clientbindingip_edit.html\"></a></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" data-ng-class=\"{graydisabled:!currentItem.target_ip}\" data-localize=\"取消桌面IP\" data-ng-click=\"cancelBindingIp(currentItem)\"></a><span class=\"parameterdisabled\" data-localize-title=\"CANCELIP_TIP\" data-ng-if=\"!currentItem.target_ip\"></span></li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-dialog=\"clientBindingIpDialog\" data-dialog-size=\"sm\" data-dialog-url=\"terminal/terminal_clientbindingip_edit.html\" data-localize=\"固定桌面IP\"></a></li> -->\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"view(currentItem)\" data-ng-class=\"{graydisabled:!currentItem.inst_display_name}\" data-localize=\"查看桌面\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP7\" data-ng-if=\"!currentItem.inst_display_name\"></span></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"wakeup(currentItem)\" data-ng-class=\"{graydisabled:currentItem.is_up}\" data-localize=\"唤醒\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP3\" data-ng-if=\"currentItem.is_up\"></span></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"closeTerminal(currentItem)\" data-ng-class=\"{graydisabled:!currentItem.is_up}\" data-localize=\"关机\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP4\" data-ng-if=\"!currentItem.is_up\"></span></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"rebootTerminal(currentItem)\" data-ng-class=\"{graydisabled:!currentItem.is_up}\" data-localize=\"重启\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP4\" data-ng-if=\"!currentItem.is_up\"></span></li>\r\n\t\t\t\t\t\t\t<!-- <li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"terminate(currentItem)\" data-ng-class=\"{graydisabled:!currentItem.is_up}\" data-localize=\"中断会话\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP5\" data-ng-if=\"!currentItem.is_up\"></span></li> -->\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-ng-class=\"{graydisabled:currentItem.is_up}\" data-localize=\"删除\"></a><span class=\"parameterdisabled\" data-localize-title=\"CLIENT_TIP6\" data-ng-if=\"currentItem.is_up\"></span></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/terminal/schoolroom.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-sm-12\">\r\n\t\t\t<div class=\"jarviswidget\" data-widget-grid>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 left-btn-group\">\r\n\t\t\t\t\t\t\t\t<div data-ng-show=\"owner\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs\" data-dialog=\"addSchoolroomDialog\" data-dialog-size=\"md\" data-dialog-url=\"terminal/terminal_schoolroom_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-danger btn-xs isBatch\" data-ng-class=\"{disabled:!selectNoDefault()}\" data-ng-click=\"delete(item)\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs\" data-ng-class=\"{disabled:!onlyOneItem()}\" ng-click=\"sendMessage()\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"发布消息\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs\" data-ng-class=\"{disabled:!onlyOneItem()}\" ng-click=\"closeMessage()\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"关闭消息\"></span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" input-number data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_grid_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th ><label data-ng-show=\"owner\" class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\" data-localize=\"教室名称\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <th ng-model=\"resource_pool_nameSort\" ng-click=\"resource_pool_nameSort = !resource_pool_nameSort;sort('resource_pool_name', resource_pool_nameSort)\"  data-localize=\"资源池\"></th> -->\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"网络\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"终端IP范围\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"user_numSort\" ng-click=\"user_numSort = !user_numSort;sort('user_num', user_numSort)\" data-localize=\"授权管理员数\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"terminalCountSort\" ng-click=\"terminalCountSort = !terminalCountSort;sort('terminalCount', terminalCountSort)\" data-localize=\"当前终端数\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"sceneCountSort\" ng-click=\"sceneCountSort = !sceneCountSort;sort('sceneCount', sceneCountSort)\" data-localize=\"当前场景数\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"描述\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_grid_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-id=\"{{item.id}}\" data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t<td><label data-ng-if=\"owner\" class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <td>{{ item.resource_pool_name }}</td> -->\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.network_name }}<span data-ng-if=\"item.subnet_name\">/{{ item.subnet_name }} ({{ item.dhcp_start }}~{{ item.dhcp_end }})</span></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><span data-ng-if=\"item.ip_start\">{{item.ip_start + '-' + item.ip_end}}</span></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.user_num }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.terminalCount }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.sceneCount }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.desc }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td><a class=\"btn btn-xs btn-default\" data-dialog=\"editSchoolroomDialog\" data-dialog-size=\"md\" data-dialog-url=\"terminal/terminal_schoolroom_edit.html\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></a></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a data-dialog=\"editSchoolroomDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"terminal/terminal_schoolroom_edit.html\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t<li data-ng-if=\"owner\" class=\"menu_item\" data-ng-click=\"sendMessage(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" data-localize=\"发布消息\"></a></li>\r\n\t\t\t\t\t\t\t<li data-ng-if=\"owner\" class=\"menu_item\" data-ng-click=\"closeMessage(currentItem)\"><a ng-disabled=\"currentItem.message\" class=\"menu_label\" href=\"javascript:\" data-localize=\"关闭消息\"></a></li>\r\n\t\t\t\t\t\t\t<li data-ng-if=\"owner && currentItem.id != 1\" class=\"menu_item\" data-ng-click=\"delete(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" data-localize=\"删除\"></a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n\r\n","views/vdi/terminal/session.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div class=\"jarviswidget\" data-widget-grid>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-sm-6 left-btn-group\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"terminate()\" href=\"javascript:\"><i class=\"fa  icon-jj-breakoff\"></i> <span data-localize=\"中断会话\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-sm-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\">\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"显示\"></span>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageSizeChange()\"\r\n\t\t\t\t\t\t\t\t\t\tdata-ng-options=\"pagesize for pagesize in pagesizes\"\r\n\t\t\t\t\t\t\t\t\t></select>\r\n\t\t\t\t\t\t\t\t\t<span data-localize=\"项结果\"></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-vertical-center table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"接入终端\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"is_upSort\" ng-click=\"is_upSort = !is_upSort;sort('is_up', is_upSort)\" data-localize=\"运行状态\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"target_ipSort\" ng-click=\"target_ipSort = !target_ipSort;sort('target_ip', target_ipSort)\" data-localize=\"接入桌面\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"launched_atSort\" ng-click=\"launched_atSort = !launched_atSort;sort('launched_at', launched_atSort)\" data-localize=\"接入时间\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"running_timeSort\" ng-click=\"running_timeSort = !running_timeSort;sort('running_time', running_timeSort)\" data-localize=\"接入时长\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-id=\"{{item.id}}\" data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.client_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td><span class=\"status32\" data-ng-class=\"{shutdown:!item.is_up,running:item.is_up}\"></span></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.inst_display_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.launched_at | date:'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.running_time }}</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t<li class=\"menu_item\" data-ng-click=\"terminate(currentItem)\"><a class=\"menu_label\" href=\"javascript:\" data-localize=\"中断会话\"></a></li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/user/admin.html":"<section >\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 left-btn-group\">\r\n\t\t\t\t\t\t\t\t<div data-ng-show=\"owner\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs\" data-dialog=\"addUserAdminDialog\" data-dialog-size=\"md\" data-dialog-url=\"user/user_admin_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-danger btn-xs isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" input-number data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t<th><label class=\"checkbox\" data-ng-show=\"owner\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\" data-localize=\"登录名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"real_nameSort\" ng-click=\"real_nameSort = !real_nameSort;sort('real_name', real_nameSort)\" data-localize=\"姓名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"permissionSort\" ng-click=\"permissionSort = !permissionSort;sort('permission', permissionSort)\" data-localize=\"角色\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"instance_numSort\" ng-click=\"instance_numSort = !instance_numSort;sort('instance_num', instance_numSort)\" data-localize=\"关联桌面数\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"电子邮箱\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"联系电话\" ng-model=\"contactSort\" ng-click=\"contactSort = !contactSort;sort('contact', contactSort)\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"createdDateSort\" ng-click=\"createdDateSort = !createdDateSort;sort('createdDate', createdDateSort)\" data-localize=\"创建时间\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"上次登录IP\" ng-model=\"IPSort\" ng-click=\"IPSort = !IPSort;sortIP(IPSort)\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-contextmenu-disabled=\"{{ (owner && item.name=='admin') || (!owner && loginName != item.name) }}\" data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t<td data-ng-if=\"owner && item.name != 'admin' && item.name != loginName\"><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t<td data-ng-if=\"!(owner && item.name != 'admin' && item.name != loginName)\" data-ng-init=\"item._ignore=true\"><label style=\"display:none;\" class=\"checkbox\"><input data-ng-model=\"item._ignore\" data-ng-checked=\"item._ignore\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.real_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.permission }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.instance_num }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><p style=\"max-width: 200px;\" class='text-overflow' title=\"{{ item.email }}\">{{ item.email }}</p></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.contact }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.createdDate | date:'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.last_login }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td><a data-ng-if=\"(owner && item.name!='admin') || (!ower && loginName == item.name)\" class=\"btn btn-xs btn-default\" data-dialog=\"editUserAdminDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"user/user_admin_edit.html\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></a></td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a data-dialog=\"editUserAdminDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"user/user_admin_edit.html\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t<li data-ng-if=\"currentItem.name != 'admin' && loginName != currentItem.name\" class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li data-ng-if=\"currentItem.name != 'admin' && loginName != currentItem.name\" class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-ng-class=\"{graydisabled:currentItem.instance_num != 0}\" data-localize=\"删除\"></a><span class=\"parameterdisabled\" data-localize-title=\"ADMIN_TIP\" data-ng-if=\"currentItem.instance_num != 0\"></span></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n\r\n<script>pageSetUp();</script>","views/vdi/user/common.html":"<section id=\"teach-page\">\r\n\t<!-- row -->\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div data-widget-grid class=\"jarviswidget common\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div  class=\"noborder\">\r\n\t\t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t\t<div class=\"col-sm-9\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"col-sm-3 text-right\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</header>\r\n\t\t\t\t\t<!-- end widget edit box -->\r\n\r\n\t\t\t\t\t<!-- widget content -->\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<section class=\"dt-toolbar\" style=\"border:none;\">\r\n\t\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 uploadFile\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-ng-click=\"addDepartment()\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增用户组\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-click=\"modifyInfo()\" data-ng-class=\"{disabled: !selected}\"><i class=\"fa fa-pencil\"></i><span data-localize=\"修改\" style=\"margin-left: 3px;\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"{{ domain }}/thor/user/excel/template?file_name=users.xls\" download=\"users\"><i class=\"fa fa-cloud-download\"></i><span data-localize=\"下载模版\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<div ui-web-upload=\"user_upload\"\r\n\t\t\t\t\t\t\t\t\t\tui-upload-limit=\"10G\"\r\n\t\t\t\t\t\t\t\t\t\tui-upload-btn-name=\"导入\"\r\n\t\t\t\t\t\t\t\t\t\tui-upload-type=\"xlsx?\"\r\n\t\t\t\t\t\t\t\t\t\tui-upload-url=\"/thor/user/excel/import\"\r\n\t\t\t\t\t\t\t\t\t\tfinish-handel=\"finishUpload(response)\"\r\n\t\t\t\t\t\t\t\t\t\tbtn-class=\"btn-xs btn-primary\"\r\n\t\t\t\t\t\t\t\t\t\ticon-class=\"icon-jj-Import\"\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"display: inline-block;\">\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" data-ng-class=\"{disabled:!selected || !selected.user_num}\" href=\"{{ domain }}/thor/user/excel/export?department={{ selected.id }}\" download='{{ selected.name }}'><i class=\"fa icon-jj-Export-1\"></i> <span data-localize=\"导出\"></span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!selected || selected.user_num || selected.parent_name==''}\" data-ng-click=\"deleteDpartment()\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除用户组\"></span></a>\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t<div class=\"panel\" style=\"background-color: #fafafa;border: none\">\r\n\t\t\t\t\t\t\t\t<div class=\"panel-body no-padding\" style=\"margin:15px;border:1px solid #ccc;\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-xs-3\" style=\"padding: 0px;\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"panel panel-default\" style=\"margin-bottom: 0;border-top: none;border-left: none;border-bottom: none;background-color: #fafafa;\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"panel-heading\" style=\"line-height: 23px;\" data-localize=\"组织结构\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style=\"padding: 10px 15px\" data-ng-if=\"!treedata_loading && !treedata.length\" data-localize='无'></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style=\"padding: 10px 15px\" data-ng-if=\"treedata_loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"panel-body\" style=\"overflow-y: auto;overflow-x: auto;min-height: 96px;padding: 10px 10px 26px 10px;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<treecontrol\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"tree-classic no-padding userCommon-tree\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttree-model=\"treedata\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\toptions=\"opts\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ton-selection=\"showSelected(node, selected)\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\texpanded-nodes=\"expandnodes\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselected-node=\"selected\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span><i id=\"departmentIcon\"></i>{{ node.name }}&nbsp;({{ node.user_num }})</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</treecontrol>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>  \r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-xs-9\" style=\"padding: 0 0 20px 0;\">\r\n\t\t\t\t\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"left_side left-btn-group col-xs-6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-ng-class=\"{disabled:!islastGroup()}\" data-dialog=\"addUserCommonDialog\" data-dialog-size=\"md\" data-dialog-url=\"user/user_common_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\">新增</span></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"moveTo()\"><i class=\"fa icon-jj-move-1\"></i> <span data-localize=\"移动至\">移动至</span></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:;\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" input-number data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ></label></div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</section>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll()\" name=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i></i>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\" data-localize=\"登录名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"real_nameSort\" ng-click=\"real_nameSort = !real_nameSort;sort('real_name', real_nameSort)\" data-localize=\"姓名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"上次登录IP\" ng-model=\"IPSort\" ng-click=\"IPSort = !IPSort;sortIP(IPSort)\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-ng-repeat-start=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><i data-ng-if=\"item.status\" class=\"icon-jj-lock fa\"></i> {{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.real_name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.last_login }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default\" data-dialog=\"editUserCommonDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"user/user_common_edit.html\" data-localize-title=\"编辑\" localize-title=\"用户编辑\"><i class=\"fa icon-jj-Write\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"loading_detail\" class=\"btn btn-xs btn-default\" ng-show=\"!isFold\"  data-ng-click=\"isFold=!isFold\" localize-title=\"更多详情\"><i class=\"fa icon-jj-014\"></i></button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button ng-disabled=\"loading_detail\" class=\"btn btn-xs btn-default\" ng-show=\"isFold\" data-ng-click=\"isFold=!isFold\" ><i class=\"fa icon-jj-015\"></i></button></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr ng-show=\"isFold\" class=\"ng-scope\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"7\" style=\"border:none;padding:0 !important;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table class=\"table table-striped table-condensed table-hover vtop-table\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"33%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"detailsWrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.dept_full_path }}\"><span class=\"col-xs-3\" localize=\"所属组\"></span><span class=\"col-xs-9\">：{{ item.dept_full_path }}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.desc }}\"><span class=\"col-xs-3\" localize=\"描述\"></span><span class=\"col-xs-9\">：{{ item.desc }}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"33%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"detailsWrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.contact }}\"><span class=\"col-xs-3\" localize=\"联系电话\"></span><span class=\"col-xs-9\">：{{ item.contact }}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.email }}\"><span class=\"col-xs-3\" localize=\"电子邮箱\"></span><span class=\"col-xs-9\">：{{ item.email }}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width=\"33%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"detailsWrap\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.redactor }}\"><span class=\"col-xs-3\" localize=\"创建者\"></span><span class=\"col-xs-9\">：{{ item.redactor }}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.createdDate | date:'yyyy-MM-dd HH:mm:ss' }}\"><span class=\"col-xs-3\" localize=\"创建时间\"></span><span class=\"col-xs-9\">：{{ item.createdDate | date:'yyyy-MM-dd HH:mm:ss' }}</span></p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat-end></tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"user_loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!user_loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ><a data-ng-if=\"currentItem.id !== 1\" data-dialog=\"editUserCommonDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"user/user_common_edit.html\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-ng-class=\"{graydisabled:currentItem.instance_num != 0}\" data-localize=\"删除\"></a><span class=\"parameterdisabled\" data-localize-title=\"ADMIN_TIP\" data-ng-if=\"currentItem.instance_num != 0\"></span></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li class=\"menu_item\" ><a data-ng-click=\"moveTo(item)\" data-localize=\"移动至\"></a></li>\r\n\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/user/domain.html":"<section id=\"widget-grid\">\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"jarviswidget\"\r\n\t\t\t\tdata-widget-grid\r\n\t\t\t\tdata-widget-editbutton=\"true\"\r\n\t\t\t\tdata-widget-colorbutton=\"true\"\r\n\t\t\t\tdata-widget-togglebutton=\"true\"\r\n\t\t\t\tdata-widget-deletebutton=\"false\"\r\n\t\t\t\tdata-widget-fullscreenbutton=\"true\"\r\n\t\t\t\tdata-widget-custombutton=\"true\"\r\n\t\t\t\tdata-widget-collapsed=\"false\"\r\n\t\t\t\tdata-widget-sortable=\"true\">\r\n<!-- \t\t\t\t<header class=\"nobgheader\">\r\n\t\t\t\t\t<div class=\"col-sm-9\">\t\t\r\n\t\t\t\t\t\t<span class=\"totalmess\" \r\n\t\t\t\t\t\tlocalize=\"DOMAIN_TOTAL_MESS\" \r\n\t\t\t\t\t\tparam1=\"{{rows.length}}\"\r\n\t\t\t\t\t\tparam2=\"{{(rows | filter:{'status':true}).length}}\"\r\n\t\t\t\t\t\tparam3=\"{{(rows | filter:{'status':false}).length}}\"></span>\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-sm-3 text-right\">\r\n\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</header> -->\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer clearfix\">\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left_side col-xs-12 col-sm-12\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-dialog=\"addUserDomainDialog\" data-dialog-url=\"user/user_domain_add.html\" data-dialog-size=\"md\"><i class=\"fa icon-jj-addddd\"></i>&nbsp;<span localize=\"新增域\">新增域</span></a>\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" href=\"javascript:\" data-ng-click=\"delete()\"><i class=\"fa icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side hidden-xs\">\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<!--<a class=\"btn btn-xs btn-primary isBatch\" href=\"javascript:\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"restarVirtical\">重启虚拟化服务</a>-->\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"padding-20\">\r\n\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t        <div class=\"col-xs-12 col-sm-6 col-md-6 col-lg-4\" data-ng-repeat=\"item in rows\">\r\n\r\n\t\t\t\t\t\t            <div class=\"panel pricing-big panel-primary\">\r\n\t\t\t\t\t\t            \t<span class=\"ribbon\" ng-if=\"item.is_console\" data-ng-class=\"{'zh':currentLang.language === 'Chinese, Simplified','en':currentLang.language === 'English'}\"></span>\r\n\t\t\t\t\t\t            \t<!-- <img src=\"img/ribbon.png\" class=\"ribbon\" ng-if=\"item.is_console\"> -->\r\n\t\t\t\t\t\t                <div class=\"panel-heading smart-form\">\r\n\t\t\t\t\t\t                \t<div class=\"padding-left-15\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox-inline\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"checkbox style-0\" data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" data-ng-value=\"item.id\" ><span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t                    <div class=\"panel-cont domain-mess\">\r\n\t\t\t\t\t\t\t                    <ul class=\"panel-mess\">\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item panel-title\">\r\n\t\t\t\t\t\t                    \t\t\t<label><img  ng-show=\"item.submiting\" ng-src=\"img/ajax-loader.gif\" style=\"width:48px;height:48px;\"></label>\r\n\t\t\t\t\t\t\t                    \t\t<h2 class=\"item-flex\">\r\n\t\t\t\t\t\t\t                    \t\t\t<div class=\"host_title\" title=\"{{item.name}}\" style=\"text-transform: none;\">{{item.name}}</div><span class=\"small\" style=\"color:#fff;\">{{item.host}}</span>\r\n\t\t\t\t\t\t\t                    \t\t</h2>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label data-localize=\"关联用户数\" localize-title=\"关联用户数\">关联用户数</label>\r\n\t\t\t\t\t\t\t                    \t\t<div>{{item.user_num}} </div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                    \t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label data-localize=\"域管理员\" localize-title=\"域管理员\">域管理员</label>\r\n\t\t\t\t\t\t\t                    \t\t<div>{{item.user}} </div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li class=\"panel-item\">\r\n\t\t\t\t\t\t\t                    \t\t<label data-localize=\"描述\">描述</label>\r\n\t\t\t\t\t\t\t                    \t\t<div class=\"item-flex\">{{item.desc}} </div>\r\n\t\t\t\t\t\t\t                    \t</li>\r\n\t\t\t\t\t\t\t                  \t</ul>\r\n\t\t\t\t\t\t                  \t</div>\r\n\r\n\t\t\t\t\t\t                  \t<div class=\"primary panel-footbar user-domain-panel\">\r\n\t\t\t\t\t\t                \t\t<a data-id=\"{{ item.id }}\" href=\"javascript:void(0)\" data-dialog=\"editUserDomainDialog\" data-dialog-url=\"user/user_domain_edit.html\" data-dialog-size=\"md\" class=\"icon\" data-localize-title=\"编辑域控制器\"><i class=\"fa icon-jj-edit\"></i></a>\r\n\t\t\t\t\t\t                \t\t<!-- <span class=\"mylili\"><a data-ng-click=\"update(item)\" data-ng-if=\"item.status=='alive'\" href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"更新域用户\"><i class=\"fa icon-jj-update\" data-ng-class=\"{disabled_ico:item.instance_count > 1? false:true}\"></i></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 1? false:true\" data-localize-title=\"该模版未关联任何场景\"></span></span> -->\r\n\t\t\t\t\t\t                \t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"mylili\"><a href=\"javascript:void(0)\" class=\"icon\" data-localize-title=\"删除域控制器\"  data-ng-click=\"delete(item)\"><i class=\"fa fa-trash-o\" data-ng-class=\"{disabled_ico:item.instance_count > 1? true:false}\"></i></a><span class=\"parameterdisabled\" data-ng-if=\"item.instance_count > 1? true:false\" data-localize-title=\"TEMPLATE_DELETE_TIP\"></span></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a data-id=\"{{ item.id }}\" href=\"#/user/domain/{{item.id}}\" class=\"icon\" data-localize-title=\"域用户\"><i class=\"fa icon-jj-men\"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t                </div>\r\n\t\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t        </div>\r\n\t\t\t\t    \t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- end widget div -->\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t\t<!-- WIDGET END -->\r\n\t</div>\r\n\t<!-- end row -->\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/user/domainList.html":"<section>\r\n\t<!-- row -->\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\">\r\n\t\t\t<!-- Widget ID (each widget will need unique ID)-->\r\n\t\t\t<div data-widget-grid class=\"jarviswidget\">\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<!-- widget edit box -->\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<div class=\"form-inline no-footer\">\r\n\t\t\t\t\t\t\t<!-- toolbar -->\r\n\t\t\t\t\t\t\t<div class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t\t<div class=\"left-btn-group col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-primary\"  href=\"#/user/domain\"><i class=\" icon-jj-recovery fa\"></i>  &nbsp;<span  localize=\"返回\">返回</span></a>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-primary dropdown-toggle\"  data-toggle=\"dropdown\"><i class=\"fa icon-jj-Synchronous\"></i> &nbsp;<span localize=\"同步域用户\">同步域用户</span> <span class=\"caret\"></span></button>\r\n\t\t\t\t\t\t\t\t\t\t<ul class=\"dropdown-menu\">\r\n\t\t\t\t\t\t\t\t\t\t\t<li><a data-ng-click=\"oneKeySycing()\" href=\"javascript:\" localize=\"一键同步\">一键同步</a></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li class=\"divider\"></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"javascript:\" data-dialog=\"userDoaminAscingDialog\" data-dialog-url=\"user/user_domain_sycing.html\" data-dialog-size=\"md\" localize=\"自定义同步\">自定义同步</a></li>\r\n\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<a class=\"btn btn-xs btn-danger isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete()\" href=\"javascript:\"><i class=\"fa  icon-jj-delete\"></i>&nbsp;<span localize=\"删除\">删除</span></a>\r\n\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"right_side col-xs-6 col-sm-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" input-number type=\"number\" class=\"mysmallinput\" data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t\t<!-- <div class=\"pull-right filter\"> <span localize=\"显示\"></span> <select  ng-change=\"pageSizeChange()\" data-ng-model=\"pagesize\"data-ng-options=\"pagesize for pagesize in pagesizes\"></select> <span localize=\"项结果\"></span> </div> -->\r\n\t\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\" ng-change=\"updataData()\"></label></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<!-- toolbar end -->\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table data-vdi-grid\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<thead class=\"vdi_header\">\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\"  localize=\"域登录名\">域登录名</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"real_nameSort\" ng-click=\"real_nameSort = !real_nameSort;sort('real_name', real_nameSort)\" localize=\"姓名\">姓名</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"instance_numSort\" ng-click=\"instance_numSort = !instance_numSort;sort('instance_num', instance_numSort)\" localize=\"关联桌面数\">关联桌面数</th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th ng-model=\"group_nameSort\" ng-click=\"group_nameSort = !group_nameSort;sort('group_name', group_nameSort)\" localize=\"分组名\">分组名</th>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t<tbody class=\"vdi_body\">\r\n\t\t\t\t\t\t\t\t\t\t<tr data-ng-repeat=\"item in rows |filter:searchText | paging:currentPage:pagesize\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-id=\"{{ item.id }}\" ng-class=\"{warning:item.role==5}\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p title=\"{{ item.name }}\">{{ item.name }}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>{{item.real_name}}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.instance_num }}</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td>{{ item.group }}</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\"  localize=\"LOADING_TEXT\">数据正在加载...</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" localize=\"NO_MATCHING_DATA\">没有匹配数据</div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div data-grid-pagination class=\"dt-toolbar-footer row\">\r\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-xs-12 hidden-xs\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"dataTables_info\" role=\"status\"  data-localize=\"PAGE\"\r\n\t\t\t\t\t\t\t\t\tparam1=\"{{ getStart() }}\" \r\n\t\t\t\t\t\t\t\t\tparam2=\"{{ getEnd() }}\"\r\n\t\t\t\t\t\t\t\t\tparam3=\"{{ (rows | filter:searchText| filter:{'status':select} ).length }}\"\r\n\t\t\t\t\t\t\t\t\t></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"dataTables_paginate paging_simple_numbers\">\r\n\t\t\t\t\t\t\t\t\t\t<pagination\r\n\t\t\t\t\t\t\t\t\t\t\tboundary-links=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\ttotal-items=\"(rows | filter:searchText| filter:{'status':select} ).length\"\r\n\t\t\t\t\t\t\t\t\t\t\titems-per-page=\"pagesize\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-ng-model=\"currentPage\"\r\n\t\t\t\t\t\t\t\t\t\t\tdata-ng-change=\"pageChange()\"\r\n\t\t\t\t\t\t\t\t\t\t\trotate=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\tmax-size=\"10\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"pagination-sm\"\r\n\t\t\t\t\t\t\t\t\t\t\tprevious-text=\"&lsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\tnext-text=\"&rsaquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\tfirst-text=\"&laquo;\"\r\n\t\t\t\t\t\t\t\t\t\t\tlast-text=\"&raquo;\"\r\n\t\t\t\t\t\t\t\t\t\t></pagination>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!-- end widget content -->\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<!-- end widget -->\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>","views/vdi/user/role.html":"<section>\r\n\t<div class=\"row\">\r\n\t\t<article class=\"col-xs-12 col-sm-12 col-md-12 col-sm-12\">\r\n\t\t\t<div class=\"jarviswidget\" data-widget-grid>\r\n\t\t\t\t<!-- widget div-->\r\n\t\t\t\t<div class=\"noborder\">\r\n\t\t\t\t\t<div class=\"jarviswidget-editbox\"></div>\r\n\t\t\t\t\t<div class=\"widget-body no-padding\">\r\n\t\t\t\t\t\t<section class=\"dt-toolbar\">\r\n\t\t\t\t\t\t\t<div class=\"left_side col-xs-6 left-btn-group\">\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-primary btn-xs\" data-dialog=\"addUserRoleDialog\" data-dialog-size=\"md\" data-dialog-url=\"user/user_role_add.html\"><i class=\"icon-jj-addddd fa\"></i> <span data-localize=\"新增\"></span></a>\r\n\t\t\t\t\t\t\t\t<a class=\"btn btn-danger btn-xs isBatch\" data-ng-class=\"{disabled:!checkOne()}\" data-ng-click=\"delete(item)\" href=\"javascript:\"><i class=\"icon-jj-delete fa\"></i> <span data-localize=\"删除\"></span></a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right_side col-xs-6\">\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right filter\"> <span data-localize=\"显示\"></span> <input min=\"1\" max=\"500\" placeholder=\"1-500\" type=\"number\" class=\"mysmallinput\" input-number data-ng-model=\"pagesize\" data-ng-change=\"pageSizeChange()\"> <span data-localize=\"项结果\"></span></div>\r\n\t\t\t\t\t\t\t\t<div class=\"pull-right dataTables_filter search\"><label><span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-search\"></i></span> <input type=\"search\" maxlength=\"20\" class=\"form-control\" ng-model=\"searchText\"></label></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t<table\r\n\t\t\t\t\t\t\t\tclass=\"table table-striped table-condensed table-hover smart-form has-tickbox table-vertical-center\"\r\n\t\t\t\t\t\t\t\twidth=\"100%\">\r\n\t\t\t\t\t\t\t\t<thead class=\"vdi_grid_header\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th><label class=\"checkbox\"><input type=\"checkbox\" data-ng-model=\"checkedAll\" data-ng-change=\"selectAllChange(checkedAll)\" data-ng-checked=\"checkAll(all)\" name=\"checkbox-inline\"><i></i></label></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"nameSort\" ng-click=\"nameSort = !nameSort;sort('name', nameSort)\" data-localize=\"角色名\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"描述\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"user_numSort\" ng-click=\"user_numSort = !user_numSort;sort('user_num', user_numSort)\" data-localize=\"授权管理员数\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"redactorSort\" ng-click=\"redactorSort = !redactorSort;sort('redactor', redactorSort)\" data-localize=\"修改人\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th ng-model=\"updated_timeSort\" ng-click=\"updated_timeSort = !updated_timeSort;sort('updated_time', updated_timeSort)\" data-localize=\"修改时间\"></th>\r\n\t\t\t\t\t\t\t\t\t\t<th data-localize=\"操作\"></th>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody class=\"vdi_grid_body\">\r\n\t\t\t\t\t\t\t\t\t<tr data-contextmenu data-id=\"{{item.id}}\" data-contextmenu-disabled=\"{{ item.access_key == powers }}\" data-ng-repeat=\"item in rows | filter:searchText | paging:currentPage:pagesize\">\r\n\t\t\t\t\t\t\t\t\t\t<td data-ng-if='item.access_key != powers'><label class=\"checkbox\"><input data-ng-model=\"item._selected\" data-ng-checked=\"item._selected\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td data-ng-if='item.access_key == powers' data-ng-init=\"item._ignore = true\"><label style=\"display:none;\" class=\"checkbox\"><input data-ng-model=\"item._ignore\" data-ng-checked=\"item._ignore\" type=\"checkbox\" data-ng-value=\"item.id\" name=\"checkbox-inline\"><i></i></label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.name }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.desc }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.user_num }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.redactor }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>{{ item.updated_time | date:'yyyy-MM-dd HH:mm:ss' }}</td>\r\n\t\t\t\t\t\t\t\t\t\t<td ><a data-ng-if='item.access_key != powers' class=\"btn btn-xs btn-default\" data-dialog=\"editUserRoleDialog\" data-dialog-size=\"md\" data-dialog-url=\"user/user_role_edit.html\" data-localize-title=\"编辑\"><i class=\"fa icon-jj-Write\"></i></a></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"loading\" data-localize=\"LOADING_TEXT\"></div>\r\n\t\t\t\t\t\t<div class=\"tips\" data-ng-if=\"!loading && rows.length == 0\" data-localize=\"NO_MATCHING_DATA\"></div>\r\n\t\t\t\t\t\t<div data-ng-include=\"'includes/pagination.html'\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<section class=\"context_wrapper\">\r\n\t\t\t\t\t<div data-ng-if=\"currentItem\" class=\"menu_wrapper grid_context_menu\">\r\n\t\t\t\t\t\t<ul class=\"menu_item_list\">\r\n\t\t\t\t\t\t\t<li class=\"menu_item\" ><a data-dialog=\"editUserRoleDialog\" data-ng-model=\"currentItem\" data-dialog-size=\"md\" data-dialog-url=\"user/user_role_edit.html\" data-localize=\"编辑\"></a></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_split\"></li>\r\n\t\t\t\t\t\t\t<li class=\"menu_item\"><a class=\"menu_label\" href=\"javascript:\" data-ng-click=\"delete(currentItem)\" data-ng-class=\"{graydisabled:currentItem.user_num != 0}\" data-localize=\"删除\"></a><span class=\"parameterdisabled\" data-localize-title=\"ROEL_TIP\" data-ng-if=\"currentItem.user_num != 0\"></span></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\r\n\t\t\t</div>\r\n\t\t</article>\r\n\t</div>\r\n</section>\r\n<script>pageSetUp();</script>\r\n\r\n"};
	angular.module("ng").run(["$templateCache", function(c){
		Object.keys(views).forEach(function(key){
			c.put(key, views[key]);
		});
	}]);
	module.exports = views;

/***/ })
/******/ ]);
//# sourceMappingURL=index.map